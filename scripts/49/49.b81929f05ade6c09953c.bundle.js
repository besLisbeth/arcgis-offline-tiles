(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/support/RasterStorageInfo":"0GEy","esri/layers/support/rasterDatasets/RasterFactory":"20+E","esri/layers/support/rasterDatasets/MRFRaster":"2VC8","esri/layers/support/DimensionalDefinition":"7Rj3","esri/layers/support/RasterFunction":"97bx","esri/layers/support/rasterDatasets/CloudRaster":"ANQh","esri/layers/ImageryTileLayer":"EhmR","esri/layers/support/RasterJobHandler":"T/jF","esri/layers/support/imageryRendererUtils":"YM6P","esri/layers/support/rasterDatasets/BaseRaster":"bF83","esri/layers/support/rasterDatasets/xmlUtilities":"d9Lx","esri/layers/support/rasterDatasets/TIFFRaster":"f8aF","esri/layers/support/rasterDatasets/DBFParser":"huIg","esri/layers/support/rasterDatasets/ImageServerRaster":"xB1n"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{"0GEy":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("ycL1"),r("Vx27"),r("oxlp")],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.blockWidth=void 0,t.blockHeight=void 0,t.compression=null,t.origin=null,t.firstPyramidLevel=null,t.maximumPyramidLevel=null,t.pyramidScalingFactor=2,t.pyramidBlockWidth=null,t.pyramidBlockHeight=null,t.tileInfo=null,t.blockBoundary=null,t}return r.__extends(t,e),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"blockWidth",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"blockHeight",void 0),r.__decorate([i.property({type:String,json:{write:!0}})],t.prototype,"compression",void 0),r.__decorate([i.property({type:o,json:{write:!0}})],t.prototype,"origin",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"firstPyramidLevel",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"maximumPyramidLevel",void 0),r.__decorate([i.property()],t.prototype,"pyramidScalingFactor",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"pyramidBlockWidth",void 0),r.__decorate([i.property({type:Number,json:{write:!0}})],t.prototype,"pyramidBlockHeight",void 0),r.__decorate([i.property({json:{write:!0}})],t.prototype,"tileInfo",void 0),r.__decorate([i.property()],t.prototype,"blockBoundary",void 0),r.__decorate([i.subclass("esri.layers.support.RasterStorageInfo")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},"20+E":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("ma1f"),r("R2Zq"),r("ANQh"),r("xB1n"),r("2VC8"),r("f8aF")],void 0===(i=function(e,t,r,n,i,o,a,s,l){var u=new Map;return u.set("CRF",{desc:"Cloud Raster Format",constructor:o}),u.set("MRF",{desc:"Meta Raster Format",constructor:s}),u.set("TIFF",{desc:"GeoTIFF",constructor:l}),u.set("RasterTileServer",{desc:"Raster Tile Server",constructor:a}),function(){function e(){}return Object.defineProperty(e,"supportedFormats",{get:function(){var e=new Set;return u.forEach((function(t,r){return e.add(r)})),e},enumerable:!0,configurable:!0}),e.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,o,a,s,l,c,p,f,d,h,m;return r.__generator(this,(function(r){switch(r.label){case 0:return t=e.url,o=e.ioConfig,a=e.sourceJSON,null==(s=e.datasetFormat)&&t.lastIndexOf(".")&&(s=t.slice(t.lastIndexOf(".")+1).toUpperCase()),"OVR"===s||"TIF"===s?s="TIFF":t.toLowerCase().indexOf("/imageserver")>-1&&(s="RasterTileServer"),l={bandIds:null,sampling:null},c={url:t,sourceJSON:a,datasetFormat:s,ioConfig:o||l},this.supportedFormats.has(s)?(p=u.get(s).constructor,[4,(f=new p(c)).open({signal:e.signal})]):[3,2];case 1:return r.sent(),[2,f];case 2:if(s)throw new n("rasterfactory:open","not a supported format "+s);return d=i.keysOfMap(u),h=0,[2,(m=function(){return(s=d[h++])?(p=u.get(s).constructor,(f=new p(c)).open({signal:e.signal}).then((function(){return f})).catch((function(){return m()}))):null})()]}}))}))},e.register=function(e,t,r){u.has(e.toUpperCase())||u.set(e.toUpperCase(),{desc:t,constructor:r})},e}()}.apply(null,n))||(e.exports=i)},"2VC8":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("TMur"),r("ma1f"),r("LxLY"),r("qMld"),r("Vx27"),r("dXLH"),r("Kjnw"),r("0GEy"),r("bF83"),r("d9Lx")],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,p,f){var d,h,m=(d=new ArrayBuffer(4),h=new Uint8Array(d),new Uint32Array(d)[0]=1,1===h[0]),y=new Map;y.set("Int8","s8"),y.set("UInt8","u8"),y.set("Int16","s16"),y.set("UInt16","u16"),y.set("Int32","s32"),y.set("UInt32","u32"),y.set("Float32","f32"),y.set("Float64","f32"),y.set("Double64","f32");var g=new Map;return g.set("lerc",".lrc"),g.set("none",".til"),g.set("deflate",".pzp"),g.set("jpeg",".jzp"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._files=null,t._storageIndex=null,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,a,s,l,u,c,p,f,d,h,m,y,g,v,_,x,b,w,I;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),t=e?o.unwrap(e.signal):null,[4,this.request({url:this.url,responseType:"xml"},t)];case 2:return n=r.sent(),i=this._parseHeader(n),a=i.rasterInfo,s=i.files,this._set("rasterInfo",a),this._files=s,[4,this.request({url:s.index,responseType:"array-buffer"},t)];case 3:for(l=r.sent(),this._storageIndex=this._parseIndex(l),u=0,c=-1,d=this.rasterInfo.storageInfo,h=d.blockWidth,m=d.blockHeight,y=d.compression,g=this.rasterInfo.storageInfo.pyramidScalingFactor,v=this.rasterInfo,_=v.width,x=v.height,b=v.bandCount,w=[],I="none"===y?1:b;u<this._storageIndex.length;)c++,p=Math.ceil(_/h/Math.pow(g,c)),f=Math.ceil(x/m/Math.pow(g,c)),u+=p*f*I*4,w.push({maxRow:f,maxCol:p,minCol:0,minRow:0});return this.rasterInfo.storageInfo.blockBoundary=w,c>0&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=c),[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,s,u,c,p,f,d,h,m,y,g,v,_,x,b,w,I,S,T,R,C,F,k,O,P,M;return r.__generator(this,(function(r){switch(r.label){case 0:if(o=this.rasterInfo.storageInfo,s=o.blockWidth,u=o.blockHeight,c=o.blockBoundary,p=o.compression,!(f=c[e])||f.maxRow<t||f.maxCol<n||f.minRow>t||f.minCol>n)return[2,null];if(d=this.rasterInfo,h=d.bandCount,m=d.pixelType,y=this._getTileLocation(e,t,n),g=y.ranges,v=y.actualTileWidth,_=y.actualTileHeight,!g||0===g.length)return[2,null];if(0===g[0].from&&0===g[0].to)return M=new Uint8Array(s*u),[2,new l({width:s,height:u,pixels:null,mask:M,validPixelCount:0})];for(x=this.ioConfig.bandIds,b="none"===p?1:h,w=[],I=0,I=0;I<b;I++)(!x||x.indexOf[I]>-1)&&w.push(this.request({url:this._files.data,range:{from:g[I].from,to:g[I].to},responseType:"array-buffer"},i.signal));return[4,a.all(w)];case 1:for(S=r.sent(),T=S.map((function(e){return e.byteLength})).reduce((function(e,t){return e+t})),R=new Uint8Array(T),C=0,I=0;I<b;I++)R.set(new Uint8Array(S[I]),C),C+=S[I].byteLength;return F="lerc"===this.rasterInfo.storageInfo.compression?"lerc":"bip",[4,this.decodePixelBlock(R.buffer,{width:s,height:u,format:F,pixelType:m})];case 2:if(k=r.sent(),O=0,P=0,v!==s||_!==u)if(M=k.mask)for(I=0;I<u;I++)if(P=I*s,I<_)for(O=v;O<s;O++)M[P+O]=0;else for(O=0;O<s;O++)M[P+O]=0;else for(M=new Uint8Array(s*u),k.mask=M,I=0;I<_;I++)for(P=I*s,O=0;O<v;O++)M[P+O]=1;return[2,k]}}))}))},t.prototype._parseIndex=function(e){if(e.byteLength%16>0)throw"invalid array buffer must be multiples of 16";var t,r,n,i,o,a;if(m){for(r=new Uint8Array(e),i=new ArrayBuffer(e.byteLength),n=new Uint8Array(i),o=0;o<e.byteLength/4;o++)for(a=0;a<4;a++)n[4*o+a]=r[4*o+3-a];t=new Uint32Array(i)}else t=new Uint32Array(e);return t},t.prototype._getTileLocation=function(e,t,r){var n,i,o,a=this.rasterInfo.storageInfo,s=a.blockWidth,l=a.blockHeight,u=a.pyramidScalingFactor,c=a.compression,p=this.rasterInfo,f=p.width,d=p.height,h=p.bandCount,m="none"===c?1:h,y=0,g=0;for(o=0;o<e;o++)g=Math.pow(u,o),y+=(n=Math.ceil(f/s/g))*(i=Math.ceil(d/l/g));g=Math.pow(u,e),n=Math.ceil(f/s/g),i=Math.ceil(d/l/g),y+=t*n+r,y*=4*m;for(var v=this._storageIndex.subarray(y,y+4*m),_=0,x=0,b=[],w=0;w<m;w++)x=(_=v[4*w+0]*Math.pow(2,32)+v[4*w+1])+v[4*w+2]*Math.pow(2,32)+v[4*w+3],b.push({from:_,to:x});return{ranges:b,actualTileWidth:r<n-1?s:Math.ceil(f/g)-s*(n-1),actualTileHeight:t<i-1?l:Math.ceil(d/g)-l*(i-1)}},t.prototype._parseHeader=function(e){var t=f.getElement(e,"MRF_META/Raster");if(!t)throw new i("mrf:open","not a valid MRF format");var r=f.getElement(t,"Size"),o=parseInt(r.getAttribute("x"),10),a=parseInt(r.getAttribute("y"),10),s=parseInt(r.getAttribute("c"),10),l=(f.getElementValue(t,"Compression")||"none").toLowerCase();if(!l||-1===["none","lerc"].indexOf(l))throw new i("mrf:open","currently does not support compression "+l);var p=f.getElementValue(t,"DataType")||"UInt8",d=y.get(p);if(null==d)throw new i("mrf:open","currently does not support pixel type "+p);var h,m,v=f.getElement(t,"PageSize"),_=parseInt(v.getAttribute("x"),10),x=parseInt(v.getAttribute("y"),10),b=f.getElement(t,"DataValues");if(b&&null!=(m=b.getAttribute("NoData"))&&(h=m.trim().split(" ").map((function(e){return parseFloat(e)}))),f.getElement(e,"MRF_META/CachedSource"))throw new i("mrf:open","currently does not support MRF referencing other data files");var w=f.getElement(e,"MRF_META/GeoTags"),I=f.getElement(w,"BoundingBox");if(null==I)throw new i("mrf:open","missing node MRF_META/GeoTags/BoundingBox");var S,T=parseFloat(I.getAttribute("minx")),R=parseFloat(I.getAttribute("miny")),C=parseFloat(I.getAttribute("maxx")),F=parseFloat(I.getAttribute("maxy")),k=f.getElementValue(w,"Projection"),O=f.getElementValue(e,"datafile"),P=f.getElementValue(e,"IndexFile");"LOCAL_CS[]"!==k&&(S=new n.SpatialReference({wkt:k}));var M=new n.Extent(T,R,C,F);M.spatialReference=S;var N=f.getElement(e,"MRF_META/Rsets"),L=parseInt(N&&N.getAttribute("scale")||"2",10),E=new c({origin:new n.Point({x:M.xmin,y:M.ymax,spatialReference:S}),blockWidth:_,blockHeight:x,pyramidBlockWidth:_,pyramidBlockHeight:x,compression:l,pyramidScalingFactor:L}),A=new n.Point({x:(C-T)/o,y:(F-R)/a,spatialReference:S});return{rasterInfo:new u({width:o,height:a,extent:M,spatialReference:S,bandCount:s,pixelType:d,pixelSize:A,noDataValue:h,storageInfo:E}),files:{mrf:this.url,index:P||this.url.replace(".mrf",".idx"),data:O||this.url.replace(".mrf",g.get(l))}}},r.__decorate([s.property()],t.prototype,"_files",void 0),r.__decorate([s.property()],t.prototype,"_storageIndex",void 0),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([s.subclass("esri.layers.support.rasterIO.MRFRaster")],t)}(p)}.apply(null,n))||(e.exports=i)},"7Rj3":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("ycL1"),r("rg9i"),r("Vx27"),r("1dvD")],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(t){var r=e.call(this,t)||this;return r.variableName=null,r.dimensionName=null,r.values=[],r.isSlice=!1,r}var n;return r.__extends(t,e),n=t,t.prototype.clone=function(){return new n({variableName:this.variableName,dimensionName:this.dimensionName,values:i.clone(this.values),isSlice:this.isSlice})},r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"variableName",void 0),r.__decorate([o.property({type:String,json:{write:!0}})],t.prototype,"dimensionName",void 0),r.__decorate([o.property({type:a.types.array(a.types.oneOf([a.types.native(Number),a.types.array(a.types.native(Number))])),json:{write:!0}})],t.prototype,"values",void 0),r.__decorate([o.property({type:Boolean,json:{write:!0}})],t.prototype,"isSlice",void 0),n=r.__decorate([o.subclass("esri.layers.support.DimensionalDefinition")],t)}(n.JSONSupport)}.apply(null,n))||(e.exports=i)},"97bx":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("ycL1"),r("rg9i"),r("ULaq"),r("Vx27")],void 0===(i=function(e,t,r,n,i,o,a){var s,l=o.SetFromValues(["Raster","Raster2","DEM","FillRaster"]),u=o.SetFromValues(["Rasters"]),c=function(e){return e&&e.rasterFunction?f.fromJSON(e):e},p=function(e){return e&&e instanceof f?e.toJSON():e};!function(e){e[e.MOSAIC=0]="MOSAIC",e[e.GROUP=1]="GROUP",e[e.ITEM=2]="ITEM"}(s||(s={}));var f=function(e){function t(t){var r=e.call(this,t)||this;return r.functionArguments=null,r.functionName=null,r.outputPixelType="unknown",r.variableName=null,r.description=null,r.functionDefinition=null,r.thumbnail=null,r}var n;return r.__extends(t,e),n=t,t.prototype.readFunctionArguments=function(e,t){return function(e){if(null==e)return null;for(var t={},r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];l.has(i)?t[i]=c(e[i]):u.has(i)&&Array.isArray(e[i])?t[i]=e[i].map(c):t[i]=e[i]}return t}(t.arguments||t.rasterFunctionArguments)},t.prototype.writeFunctionArguments=function(e,t,r){for(var n={},i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];l.has(a)?n[a]=p(e[a]):u.has(a)&&Array.isArray(e[a])?n[a]=e[a].map(p):n[a]=p(e[a])}this.functionDefinition?t.arguments=n:t[r]=n},t.prototype.readFunctionName=function(e,t){var r=t.rasterFunctionInfos;return t.name||(r&&r.length&&"None"!==r[0].name?r[0].name:t.rasterFunction)},t.prototype.writeFunctionName=function(e,t,r){this.functionDefinition?t.name=e:t[r]=e},t.prototype.readFunctionType=function(e){return s[e]},t.prototype.writeFunctionType=function(e,t,r){t[r]=s[e]},t.prototype.clone=function(){return new n({functionName:this.functionName,functionArguments:i.clone(this.functionArguments),outputPixelType:this.outputPixelType,variableName:this.variableName,name:this.functionName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})},r.__decorate([a.property({json:{type:Object,write:{target:"rasterFunctionArguments"}}})],t.prototype,"functionArguments",void 0),r.__decorate([a.reader("functionArguments",["rasterFunctionArguments","arguments"])],t.prototype,"readFunctionArguments",null),r.__decorate([a.writer("functionArguments")],t.prototype,"writeFunctionArguments",null),r.__decorate([a.property({json:{type:String,write:{target:"rasterFunction"}}})],t.prototype,"functionName",void 0),r.__decorate([a.reader("functionName",["rasterFunction","rasterFunctionInfos","name"])],t.prototype,"readFunctionName",null),r.__decorate([a.writer("functionName")],t.prototype,"writeFunctionName",null),r.__decorate([a.enumeration({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),a.property({json:{default:"unknown"}})],t.prototype,"outputPixelType",void 0),r.__decorate([a.property({type:String,json:{read:!0,write:!0}})],t.prototype,"variableName",void 0),r.__decorate([a.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"description",void 0),r.__decorate([a.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"functionType",void 0),r.__decorate([a.reader("functionType")],t.prototype,"readFunctionType",null),r.__decorate([a.writer("functionType")],t.prototype,"writeFunctionType",null),r.__decorate([a.property({type:Object,json:{read:{source:"function"},write:{target:"function"},origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"functionDefinition",void 0),r.__decorate([a.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"thumbnail",void 0),n=r.__decorate([a.subclass("esri.layers.support.RasterFunction")],t)}(n.JSONSupport);return f}.apply(null,n))||(e.exports=i)},ANQh:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("TMur"),r("ma1f"),r("LxLY"),r("qMld"),r("Vx27"),r("Kjnw"),r("0GEy"),r("pMLx"),r("bF83"),r("huIg"),r("w1v0")],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,p,f,d){var h=new Map;return h.set("int16","esriFieldTypeSmallInteger"),h.set("int32","esriFieldTypeInteger"),h.set("int64","esriFieldTypeInteger"),h.set("float32","esriFieldTypeSingle"),h.set("float64","esriFieldTypeDouble"),h.set("text","esriFieldTypeString"),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.storageInfo=null,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,a,s,l,u;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e?o.unwrap(e.signal):null,[4,this.request({url:this.url+"/conf.json",responseType:"json"},t)];case 2:if(n=r.sent(),!this._validateHeader(n))throw new i("cloudraster:open","Invalid or unsupported conf.json.");return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),a=this._parseHeader(n),s=a.storageInfo,"thematic"!==(l=a.rasterInfo).dataType?[3,4]:[4,this._fetchAuxiliaryInformation()];case 3:u=r.sent(),l.attributeTable=u,r.label=4;case 4:return this._set("storageInfo",s),this._set("rasterInfo",l),this.ioConfig.retryCount=this.ioConfig.retryCount||0,[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,u,c,p;return r.__generator(this,(function(r){switch(r.label){case 0:return(o=this.rasterInfo.storageInfo.maximumPyramidLevel-e)<0?[2,null]:(a=this._buildCacheFilePath(o,t,n,i.multidimensionalDefinition),s=this._getIndexRecordFromBundle(t,n),[4,this.request({url:a,range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer"},i.signal)]);case 1:return(l=r.sent())?(u=new Uint8Array(l),0===(c=this._getTileEndAndContentType(u,s)).recordSize?[2,null]:[4,this.request({url:a,range:{from:c.position,to:c.position+c.recordSize},responseType:"array-buffer"},i.signal)]):[2,null];case 2:return(p=r.sent())?[2,this.decodePixelBlock(p,{width:this.rasterInfo.storageInfo.tileInfo.size[0],height:this.rasterInfo.storageInfo.tileInfo.size[1],planes:null,pixelType:null})]:[2,null]}}))}))},t.prototype._validateHeader=function(e){return e&&"RasterInfo"===e.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some((function(t){return!e[t]}))},t.prototype._parseHeader=function(e){var t,r,i,o,a=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][e.pixelType],s=e.bandCount,p=e.histograms,f=e.colormap,d=e.blockWidth,h=e.blockHeight,m=e.firstPyramidLevel,y=e.maximumPyramidLevel,g=e.statistics&&e.statistics.map((function(e){return{min:e.min,max:e.max,avg:e.mean,stddev:e.standardDeviation,median:e.median,mode:e.mode}})),v=new n.SpatialReference(e.extent.spatialReference||e.geodataXform.spatialReference),_=new n.Extent({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:v}),x=new n.Point({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:v}),b=e.properties,w=e.format.toLowerCase().replace("cache/",""),I=new n.Point(e.origin.x,e.origin.y,v);if(f&&f.colors)for(t=[],r=0;r<f.colors.length;r++)i=f.colors[r],o=f.values?f.values[r]:r,t.push([o,255&i,i<<16>>>24,i<<8>>>24,i>>>24]);var S=e.LODInfos,T=[];for(r=0;r<S.levels.length;r++)T.push({level:S.levels[r],resolution:S.resolutions[r],scale:96/.0254*S.resolutions[r]});var R=new c({dpi:96,lods:T,format:w,origin:I,size:[d,h],spatialReference:v}),C={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64},F=Math.round((_.xmax-_.xmin)/x.x),k=Math.round((_.ymax-_.ymin)/x.y),O=[{maxCol:Math.ceil(F/d)-1,maxRow:Math.ceil(k/h)-1,minCol:0,minRow:0}],P=2;if(y>0)for(r=0;r<y;r++)O.push({maxCol:Math.ceil(F/P/d)-1,maxRow:Math.ceil(k/P/h)-1,minCol:0,minRow:0}),P*=2;var M=e.mdInfo;return{storageInfo:C,rasterInfo:new l({width:F,height:k,pixelType:a,bandCount:s,extent:_,spatialReference:v,pixelSize:x,keyProperties:b,statistics:g,histograms:p,multidimensionalInfo:M,colormap:t,storageInfo:new u({blockWidth:d,blockHeight:h,pyramidBlockWidth:d,pyramidBlockHeight:h,origin:I,tileInfo:R,firstPyramidLevel:m,maximumPyramidLevel:y,blockBoundary:O})})}},t.prototype._fetchAuxiliaryInformation=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o,s,l,u,c;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this.request({url:this.url+"/conf.vat.json",responseType:"json"},e).then((function(e){return e})).catch((function(){return null})),n=this.request({url:this.url+"/conf.vat.dbf",responseType:"array-buffer"},e).then((function(e){return e})).catch((function(){return null})),[4,a.all([t,n])];case 1:return(i=r.sent())[0]&&(s=i[0].fields,l=i[0].values,s&&l&&(s=s.map((function(e){return{type:"OID"===e.name?"esriFieldTypeOID":h.get(e.type),name:e.name,alias:e.alias||e.name}})),u=l.map((function(e){return{attributes:e}})),s&&l&&(o={fields:s,features:u}))),!o&&i[1]&&(c=f.parse(i[1]),o=c.recordSet),[2,d.fromJSON(o)]}}))}))},t.prototype._buildCacheFilePath=function(e,t,r,n){var i=this.storageInfo.packetSize,o=Math.floor(t/i)*i,a=Math.floor(r/i)*i,s="R"+this._toHexString4(o)+"C"+this._toHexString4(a),l="L";l+=e>=10?e.toString():"0"+e.toString();var u=n&&n[0];if(!u)return this.url+"/_alllayers/"+l+"/"+s+".bundle";for(var c=this.rasterInfo.multidimensionalInfo.variables.filter((function(e){return e.name===u.variableName}))[0].dimensions[0].values.indexOf(u.values[0]).toString(16),p=4-c.length,f=0;f<p;f++)c="0"+c;return c="S"+c,this.url+"/_alllayers/"+u.variableName+"/"+c+"/"+l+"/"+s+".bundle"},t.prototype._getIndexRecordFromBundle=function(e,t){var r=this.storageInfo.packetSize,n=r*(e%r)+t%r;if(n<0)throw"Invalid level / row / col";return 20+n*this.storageInfo.recordSize+44},t.prototype._getTileEndAndContentType=function(e,t){var r,n=e.subarray(t,t+8),i=0;for(r=0;r<5;r++)i|=(255&n[r])<<8*r;var o=0xffffffffff&i;for(i=0,r=5;r<8;r++)i|=(255&n[r])<<8*(r-5);return{position:o,recordSize:0xffffffffff&i}},t.prototype._toHexString4=function(e){var t=e.toString(16);if(4!==t.length)for(var r=4-t.length;r-- >0;)t="0"+t;return t},r.__decorate([s.property({readOnly:!0})],t.prototype,"storageInfo",void 0),r.__decorate([s.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([s.subclass("esri.layers.support.rasterDatasets.CloudRaster")],t)}(p)}.apply(null,n))||(e.exports=i)},EhmR:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("TMur"),r("ifLZ"),r("+UAu"),r("zp6E"),r("ma1f"),r("ImIS"),r("qsST"),r("LxLY"),r("EUqE"),r("qMld"),r("Vx27"),r("1dvD"),r("nrlZ"),r("0RER"),r("FEX1"),r("QJ8R"),r("WaJo"),r("OXmT"),r("EtsK"),r("7Rj3"),r("KQcO"),r("YM6P"),r("T/jF"),r("pMLx"),r("20+E"),r("6PsE"),r("begh")],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,p,f,d,h,m,y,g,v,_,x,b,w,I,S,T,R,C,F,k){var O=l.strict()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"});function P(){return{enabled:!this.loaded||"RasterTileServer"===this.raster.datasetFormat&&"Raster"===this.raster.tileType}}var M=u.getLogger("esri.layers.ImageryTileLayer");return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.apply(this,t)||this;return n._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},n.bandIds=null,n.copyright=null,n.fullExtent=null,n.interpolation="nearest",n.legendEnabled=!0,n.isReference=null,n.listMode="show",n.raster=null,n.rasterInfo=null,n.sourceJSON=null,n.spatialReference=null,n.tileInfo=null,n.version=null,n.title=null,n.type="imagery-tile",n.url=null,n.operationalLayerType="ArcGISTiledImageServiceLayer",n.popupEnabled=!0,n.popupTemplate=null,n.symbolizer=null,n}return r.__extends(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?r.__assign({url:e},t):e},t.prototype.load=function(e){var t=this,r=c.isSome(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).then((function(){return t._openRaster(r)}),(function(){return t._openRaster(r)}))),f.resolve(this)},Object.defineProperty(t.prototype,"multidimensionalDefinition",{set:function(e){this.raster&&(this._sliceId=this.raster.getSliceIndex(e)),this._set("multidimensionalDefinition",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){var e,t,r=[new I({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})],n=null===(t=null===(e=this.rasterInfo)||void 0===e?void 0:e.attributeTable)||void 0===t?void 0:t.fields;if(n){var i=n.filter((function(e){return"oid"!==e.type&&"value"!==e.name.toLowerCase()})).map((function(e){var t=e.clone();return t.name="Raster."+e.name,t}));r=r.concat(i)}return r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{set:function(e){this._set("renderer",e),this.updateRenderer()},enumerable:!0,configurable:!0}),t.prototype.readRenderer=function(e,t,r){var n=t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,i=o.read(n,r)||void 0;if(null!=i)return i},t.prototype.createPopupTemplate=function(e){return k.createPopupTemplate(this,e)},t.prototype.updateRenderer=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return this.loaded?JSON.stringify(this._cachedRendererJson)===JSON.stringify(this.renderer)?[2]:(e=this._rasterJobHandler.instance)?(this.symbolizer.renderer=this.renderer,this.symbolizer.bind(),[4,e.updateSymbolizer(this.symbolizer)]):[2]:[2];case 1:return t.sent(),this._cachedRendererJson=this.renderer.toJSON(),[2]}}))}))},t.prototype.applyRenderer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a;return r.__generator(this,(function(s){switch(s.label){case 0:return(n=e&&e.pixelBlock)&&n.pixels&&n.pixels.length>0?(this.updateRenderer(),o=this._rasterJobHandler.instance,a=this.bandIds,o?[4,o.symbolize(r.__assign(r.__assign({},e),{simpleStretchParams:t,bandIds:a}))]:[3,2]):[2,null];case 1:return i=s.sent(),[3,3];case 2:i=this.symbolizer.symbolize(r.__assign(r.__assign({},e),{simpleStretchParams:t,bandIds:a})),s.label=3;case 3:return[2,i]}}))}))},t.prototype.getTileUrl=function(e,t,r){return"RasterTileServer"===this.raster.datasetFormat?this.url+"/tile/"+e+"/"+t+"/"+r:""},t.prototype.getCompatibleTileInfo=function(e,t){if(!this.loaded)return null;var r=m.getInfo(e);return R.create({size:256,spatialReference:e,origin:r?{x:r.origin[0],y:r.origin[1]}:{x:t.xmin,y:t.ymax}})},t.prototype.getCompatibleFullExtent=function(e){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(e)||(this._compatibleFullExtent=this.raster.computeExtent(e)),this._compatibleFullExtent):null},t.prototype.fetchTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,s;return r.__generator(this,(function(l){switch(l.label){case 0:return i.requestAsImageElement?(o=this.getTileUrl(e,t,n),[2,a(o,{responseType:"image",query:{sliceId:this._sliceId,_ts:i.timestamp},signal:i.signal}).then((function(e){return e.data}))]):[4,this._initJobHandler()];case 1:return l.sent(),this.multidimensionalDefinition&&(s=this._sliceId,i=r.__assign({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:s},i)),[2,this.raster.fetchTile(e,t,n,i)]}}))}))},t.prototype.fetchPixels=function(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(a){switch(a.label){case 0:return[4,this._initJobHandler()];case 1:return a.sent(),this.multidimensionalDefinition&&(o=this._sliceId,i=r.__assign({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:o},i)),[2,this.raster.fetchPixels(e,t,n,i)]}}))}))},t.prototype.identify=function(e,t){return void 0===t&&(t={}),this.raster.identify(e,t)},t.prototype.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++},t.prototype.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()},t.prototype.write=function(t,r){var n=this.raster;if(this.loaded?"RasterTileServer"===n.datasetFormat&&("Raster"===n.tileType||"Map"===n.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))return e.prototype.write.call(this,t,r);if(r&&r.messages){var i=r.origin+"/"+(r.layerContainerType||"operational-layers");r.messages.push(new s("layer:unsupported","Layers ("+this.title+", "+this.id+") of type '"+this.declaredClass+"' are not supported in the context of '"+i+"'",{layer:this}))}return null},t.prototype._initJobHandler=function(){var e=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;var t=new T;return this._rasterJobHandler.connectionPromise=t.initialize().then((function(){e._rasterJobHandler.instance=t,e.raster.rasterJobHandler=t,e.renderer&&e.updateRenderer()})).catch((function(){return null})),this._rasterJobHandler.connectionPromise},t.prototype._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null},t.prototype._openRaster=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,i,o,a,l,u,c,p,f,d;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,C.open(this.raster||{url:this.url,sourceJSON:this.sourceJSON,signal:e})];case 1:if(t=r.sent(),this.url||(this.url=t.url),this.raster=t,!(n=t.rasterInfo))throw new s("tile-imagery-layer:load","cannot load resources on "+this.url);if(this.sourceJSON=this.sourceJSON||this.raster.sourceJSON,null!=this.sourceJSON&&(this._set("version",this.sourceJSON.currentVersion),this._set("copyright",this.sourceJSON.copyrightText)),"Map"===this.raster.tileType&&(this.popupEnabled=!1),i=n.spatialReference,o=n.pixelSize,a=n.storageInfo,!(l=a.tileInfo)){for(u=[],c=a.maximumPyramidLevel||0,p=Math.max(o.x,o.y),f=1/.0254*96*p,d=0;d<=c;d++)u.push({level:c-d,resolution:p,scale:f}),p*=2,f*=2;l=new R({origin:a.origin,size:[a.blockWidth,a.blockHeight],spatialReference:i,lods:u}),a.tileInfo=l}return null==this.title&&(this.title=this.raster.datasetName),n.multidimensionalInfo&&(this._configDefaultSlice(),this._sliceId=this.raster.getSliceIndex(this.multidimensionalDefinition)),this._configDefaultRenderer(),[2,t]}}))}))},t.prototype._configDefaultSlice=function(){var e=this.raster.rasterInfo.multidimensionalInfo.variables[0],t=[];e.dimensions.forEach((function(r){t.push(new w({variableName:e.name,dimensionName:r.name,values:r.values[0],isSlice:!0}))})),this.multidimensionalDefinition=t},t.prototype._configDefaultRenderer=function(){var e=this.raster.rasterInfo,t=e.pixelType;this.bandIds||(this.bandIds=S.getDefaultBandCombination(e)),this.renderer||(this.renderer=S.createDefaultRenderer(e,this.bandIds)),"u8"===t&&this.renderer&&"stretchType"in this.renderer&&"min-max"===this.renderer.stretchType&&this.renderer.dynamicRangeAdjustment&&(this.renderer.dynamicRangeAdjustment=!1,this.renderer.statistics=this.renderer.statistics||[[0,255],[0,255],[0,255]]),this.symbolizer?(this.symbolizer.renderer=this.renderer,this.symbolizer.rasterInfo=e):this.symbolizer=new F({renderer:this.renderer,rasterInfo:e}),this.symbolizer.bind()||M.warn("ImageryTileLayer","The given renderer is not supported by the layer.")},r.__decorate([d.property()],t.prototype,"_cachedRendererJson",void 0),r.__decorate([d.property()],t.prototype,"_sliceId",void 0),r.__decorate([d.property()],t.prototype,"_compatibleFullExtent",void 0),r.__decorate([d.property()],t.prototype,"_rasterJobHandler",void 0),r.__decorate([d.property({type:[h.Integer],json:{write:{overridePolicy:P}}})],t.prototype,"bandIds",void 0),r.__decorate([d.property()],t.prototype,"copyright",void 0),r.__decorate([d.property({type:n.Extent}),d.aliasOf("rasterInfo.extent")],t.prototype,"fullExtent",void 0),r.__decorate([d.property({type:String,json:{read:{reader:O.read},write:{writer:O.write,overridePolicy:P}}})],t.prototype,"interpolation",void 0),r.__decorate([d.property(b.legendEnabled)],t.prototype,"legendEnabled",void 0),r.__decorate([d.property({type:Boolean,json:{read:!1}})],t.prototype,"isReference",void 0),r.__decorate([d.property({type:["show","hide"]})],t.prototype,"listMode",void 0),r.__decorate([d.property({type:[w]})],t.prototype,"multidimensionalDefinition",null),r.__decorate([d.property()],t.prototype,"raster",void 0),r.__decorate([d.property({readOnly:!0}),d.aliasOf("raster.rasterInfo")],t.prototype,"rasterInfo",void 0),r.__decorate([d.property()],t.prototype,"sourceJSON",void 0),r.__decorate([d.property({type:n.SpatialReference}),d.aliasOf("rasterInfo.spatialReference")],t.prototype,"spatialReference",void 0),r.__decorate([d.property({type:R,dependsOn:["rasterInfo"]}),d.aliasOf("rasterInfo.storageInfo.tileInfo")],t.prototype,"tileInfo",void 0),r.__decorate([d.property({readOnly:!0})],t.prototype,"version",void 0),r.__decorate([d.property()],t.prototype,"title",void 0),r.__decorate([d.property({readOnly:!0,json:{read:!1}})],t.prototype,"type",void 0),r.__decorate([d.property(b.url)],t.prototype,"url",void 0),r.__decorate([d.property({type:["ArcGISTiledImageServiceLayer"]})],t.prototype,"operationalLayerType",void 0),r.__decorate([d.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",overridePolicy:P,writer:function(e,t,r){t[r]=!e}}}})],t.prototype,"popupEnabled",void 0),r.__decorate([d.property({type:i,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:P}}})],t.prototype,"popupTemplate",void 0),r.__decorate([d.property({readOnly:!0,dependsOn:["title"]})],t.prototype,"defaultPopupTemplate",null),r.__decorate([d.property({readOnly:!0,type:[I],dependsOn:["rasterInfo"]})],t.prototype,"fields",null),r.__decorate([d.property({types:o.rasterRendererTypes,json:{read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:P}}})],t.prototype,"renderer",null),r.__decorate([d.reader("renderer")],t.prototype,"readRenderer",null),r.__decorate([d.property()],t.prototype,"symbolizer",void 0),r.__decorate([d.subclass("esri.layers.ImageryTileLayer")],t)}(x.ScaleRangeLayer(_.RefreshableLayer(g.OperationalLayer(v.PortalLayer(p.MultiOriginJSONMixin(y))))))}.apply(null,n))||(e.exports=i)},"T/jF":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("ma1f"),r("qMld"),r("8V7H"),r("dXLH")],void 0===(i=function(e,t,r,n,i,o,a){return function(){function e(){this._workerThread=null,this._destroyed=!1}return e.prototype.initialize=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return[4,o.open("RasterWorker")];case 1:return e=t.sent(),this._destroyed?e.close():this._workerThread=e,[2]}}))}))},e.prototype.destroy=function(){this._destroyed=!0,this._workerThread&&(this._workerThread.close(),this._workerThread=null)},e.prototype.decode=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("decode",e,t)];case 1:return[2,(i=r.sent())?new a(i):null]}}))}))},e.prototype.symbolize=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return i={extent:e.extent&&e.extent.toJSON(),pixelBlock:e.pixelBlock.toJSON(),simpleStretchParams:e.simpleStretchParams,bandIds:e.bandIds},[4,this._workerThread.invoke("symbolize",i,t)];case 1:return[2,(o=r.sent())?new a(o):null]}}))}))},e.prototype.updateSymbolizer=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return o=e&&e.renderer&&"raster-stretch"===e.renderer.type&&e.renderer.histograms,[4,i.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:e.toJSON(),histograms:o},t))];case 1:return r.sent(),[2]}}))}))},e.prototype.stretch=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return e&&e.pixelBlock?(i={srcPixelBlock:e.pixelBlock.toJSON(),stretchParams:e.stretchParams},[4,this._workerThread.invoke("stretch",i,t)]):[2,null];case 1:return[2,(o=r.sent())?new a(o):null]}}))}))},e.prototype.mosaicAndTransform=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(s){switch(s.label){case 0:if(!this._workerThread)throw new n("raster-jobhandler:no-connection","no available worker connection");return e&&e.srcPixelBlocks&&e.srcPixelBlocks.length>0?(i=r.__assign(r.__assign({},e),{srcPixelBlocks:e.srcPixelBlocks.map((function(e){return e?e.toJSON():null}))}),[4,this._workerThread.invoke("mosaicAndTransform",i,t)]):[2,null];case 1:return[2,(o=s.sent())?new a(o):null]}}))}))},e}()}.apply(null,n))||(e.exports=i)},YM6P:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("+UAu"),r("KY0m"),r("rg9i"),r("97bx"),r("UVEp"),r("hBcF"),r("i90+")],void 0===(i=function(e,t,r,n,i,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var u={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},c={type:"multipart",colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},p=l.fromJSON(a.PREDEFINED_JSON_COLOR_RAMPS[0]);t.isSupportedRendererType=function(e){return["raster-stretch","unique-value","class-breaks","raster-shaded-relief"].indexOf(e.type)>-1},t.combineRenderingRules=function(e,t){if(!e||!t)return i.clone(e||t);var r=i.clone(e);return"none"!==t.functionName.toLowerCase()&&((function e(t){var r=t.Raster;return r&&"esri.layers.support.RasterFunction"===r.declaredClass?e(r.functionArguments):t}(r.functionArguments)).Raster=t),r},t.convertRendererToRenderingRule=function(e,t){switch(t=t||{},e.type){case"raster-stretch":return function(e,t){var r=new o;r.functionName="Stretch";var n=f[s.stretchTypeJSONDict.toJSON(e.stretchType)],i={StretchType:n,Statistics:function(e){var t=[];return e.forEach((function(e){var r=e;if(Array.isArray(r))t.push(r);else{if(null==r.min||null==r.max)return;var n=[r.min,r.max,r.avg||0,r.stddev||0];t.push(n)}})),t}(e.statistics),DRA:e.dynamicRangeAdjustment,UseGamma:e.useGamma,Gamma:e.gamma,ComputeGamma:e.computeGamma};if(null!=e.outputMin&&(i.Min=e.outputMin),null!=e.outputMax&&(i.Max=e.outputMax),n===f.standardDeviation?(i.NumberOfStandardDeviations=e.numberOfStandardDeviations,r.outputPixelType="u8"):n===f.percentClip?(i.MinPercent=e.minPercent,i.MaxPercent=e.maxPercent,r.outputPixelType="u8"):n===f.minMax?r.outputPixelType="u8":n===f.sigmoid&&(i.SigmoidStrengthLevel=e.sigmoidStrengthLevel),r.functionArguments=i,r.variableName="Raster",e.colorRamp){var l=e.colorRamp,u=new o,c=a.getColorRampName(l);return c?u.functionArguments={colorRamp:c}:!t.convertColorRampToColormap||"algorithmic"!==l.type&&"multipart"!==l.type?u.functionArguments={colorRamp:e.colorRamp.toJSON()}:u.functionArguments={Colormap:a.convertColorRampToColormap(l,256)},u.variableName="Raster",u.functionName="Colormap",u.functionArguments.Raster=r,u}return r}(e,t);case"class-breaks":return function(e,t){var r=[],n=[],i=[],a=[],s=t.pixelType,l=t.rasterAttributeTable,u=l&&l.features,c=h(l);if(u&&Array.isArray(u)&&e.classBreakInfos){e.classBreakInfos.forEach((function(t,r){var n,i=t.symbol.color;i.a&&u.forEach((function(o){((n=o.attributes[e.field])>=t.minValue&&n<t.maxValue||r===e.classBreakInfos.length-1&&n>=t.minValue)&&a.push([o.attributes[c],i.r,i.g,i.b])}))}));var p=s?d(a,s):a,f=new o;return f.functionName="Colormap",f.functionArguments={},f.functionArguments.Colormap=p,f.variableName="Raster",f}e.classBreakInfos.forEach((function(e,t){var o=e.symbol&&e.symbol.color;o.a?(0===t?r.push(e.minValue,e.maxValue+1e-6):r.push(e.minValue+1e-6,e.maxValue+1e-6),n.push(t),a.push([t,o.r,o.g,o.b])):i.push(e.minValue,e.maxValue)}));var m=s?d(a,s):a,y=new o;y.functionName="Remap",y.functionArguments={InputRanges:r,OutputValues:n,NoDataRanges:i},y.variableName="Raster";var g=new o;return g.functionName="Colormap",g.functionArguments={Colormap:m,Raster:y},g}(e,t);case"unique-value":return function(e,t){var r=[],n=t.pixelType,i=t.rasterAttributeTable,a=i&&i.features,s=h(i),l=!1;if(e.uniqueValueInfos&&e.uniqueValueInfos.forEach((function(t){var n=t.symbol.color;n.a&&(e.field!==s&&a?a&&a.forEach((function(i){String(i.attributes[e.field])===String(t.value)&&r.push([i.attributes[s],n.r,n.g,n.b])})):isNaN(t.value)?l=!0:r.push([t.value,n.r,n.g,n.b]))})),l)return null;var u=n&&r.length>0?d(r,n):r,c=new o;return c.functionName="Colormap",c.functionArguments={},c.functionArguments.Colormap=u,c.variableName="Raster",c}(e,t);case"raster-colormap":return function(e,t){var r=e.extractColormap();if(r&&0!==r.length){var n=t.pixelType,i=n?d(r,n):r,a=new o;return a.functionName="Colormap",a.functionArguments={},a.functionArguments.Colormap=i,a}}(e,t);case"raster-shaded-relief":return function(e,t){if("elevation"!==t.dataType)return new o;var r=new o;r.functionName="Hillshade";var n="traditional"===e.hillshadeType?0:1,i="none"===e.scalingType?1:3,s={HillshadeType:n,SlopeType:i,ZFactor:e.zFactor};return 0===n&&(s.Azimuth=e.azimuth,s.Altitude=e.altitude),3===i&&(s.PSPower=e.pixelSizePower,s.PSZFactor=e.pixelSizeFactor),r.functionArguments=s,r.variableName="Raster",e.colorRamp&&(r.functionName="ShadedRelief",s.Colormap=a.convertColorRampToColormap(e.colorRamp,256)),r}(e,t)}},t.createDefaultRenderer=function(e,t){if(e){var n,i,o,s,l,u,f,d=e.attributeTable,h=e.dataType,m=e.bandCount,y=e.pixelType,g=e.colormap,v=e.statistics,_=e.histograms;if(t&&t.length>0&&(v=v?t.map((function(e){return v[e]})):null,_=_?t.map((function(e){return _[e]})):null),d&&(i=d.fields.filter((function(e){return"red"===e.name.toLowerCase()}))[0],o=d.fields.filter((function(e){return"green"===e.name.toLowerCase()}))[0],s=d.fields.filter((function(e){return"blue"===e.name.toLowerCase()}))[0],u=d.fields.filter((function(e){return"value"===e.name.toLowerCase()}))[0],(l=d.fields.filter((function(e){return"classname"===e.name.toLowerCase()||"class_name"===e.name.toLowerCase()}))[0])||(l=d.fields.filter((function(e){return"string"===e.type}))[0])||(l=u)),1===m&&(null==g?void 0:g.length)>0)d&&i&&o&&s&&(f={},d.features.forEach((function(e){var t=e.attributes;f[t[u.name]]=l?t[l.name]:t[u.name]}))),n=r.RasterColormapRenderer.createFromColormap(g,f);else if(1===m&&d){var x=void 0,b=d.features;if(i&&o&&s&&l)x=b.map((function(e){return{value:e.attributes[l.name],label:e.attributes[l.name],symbol:{type:"esriSFS",style:"esriSFSSolid",color:[e.attributes[i.name],e.attributes[o.name],e.attributes[s.name],255]}}}));else{var w=a.convertColorRampToColormap(p,b.length);x=b.map((function(e,t){return{value:e.attributes[u.name],label:e.attributes[u.name],symbol:{color:w[t].slice(1,4),type:"esriSFS",style:"esriSFSSolid"}}}))}x.sort((function(e,t){return e.value>t.value?1:-1})),n=r.UniqueValueRenderer.fromJSON({field1:l.name,uniqueValueInfos:x})}if(!n){var I=void 0,S=!1,T=void 0,R=void 0,C=void 0;"u8"===y&&"processed"===h?(I="none",v=1===m?[{min:0,max:255}]:[{min:0,max:255},{min:0,max:255},{min:0,max:255}]):"u8"===y||"elevation"===h?(I="min-max",S=!v):"scientific"===h?(I="min-max",S=!v,T=c):_&&_.length>0?(I="percent-clip",C=R=.25):v?I="min-max":(I="percent-clip",S=!0),n=r.RasterStretchRenderer.fromJSON({stretchType:I,dra:S,colorRamp:T,min:0,max:255,statistics:S?null:v,histograms:S?null:_,maxPercent:R,minPercent:C})}return n}},t.getDefaultBandCombination=function(e){var t=e.bandCount;if(1===t)return null;if(2===t)return[0];var r,n,i,o,a,s=e.keyProperties&&e.keyProperties.BandProperties;if(s&&s.length===t){for(var l=0;l<s.length;l++)s[l].BandName&&"red"===s[l].BandName.toLowerCase()&&(n=l),s[l].BandName&&"green"===s[l].BandName.toLowerCase()&&(i=l),s[l].BandName&&"blue"===s[l].BandName.toLowerCase()&&(o=l),s[l].BandName&&"nearinfrared"===s[l].BandName.toLowerCase()&&(a=l);void 0!==n&&void 0!==i&&void 0!==o?r=[n,i,o]:void 0!==n&&void 0!==i&&void 0!==a&&(r=[a,n,i])}return!r&&t>3&&(r=[0,1,2]),r};var f={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9};function d(e,t){var r=u[String(t).toLowerCase()];return r&&e.push([Math.floor(r[0]-1),0,0,0],[Math.ceil(r[1]+1),0,0,0]),e}function h(e){if(e){var t=e.fields,r=t&&n.find(t,(function(e){return e&&e.name&&"value"===e.name.toLowerCase()}));return r&&r.name}}}.apply(null,n))||(e.exports=i)},bF83:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("TMur"),r("zp6E"),r("ma1f"),r("ycL1"),r("LxLY"),r("SZNs"),r("qMld"),r("jfWY"),r("Vx27"),r("EtsK"),r("pMLx"),r("XOvD"),r("WSFd"),r("SAwq"),r("mnow")],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,p,f,d,h,m,y,g){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rasterJobHandler=null,t.datasetName=null,t.datasetFormat=null,t.rasterInfo=null,t.ioConfig={sampling:"closest"},t}return r.__extends(t,e),t.prototype.init=function(){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(t){switch(t.label){case 0:return e=g.load(),this.addResolvingPromise(e),[4,this.when()];case 1:return t.sent(),[2]}}))}))},t.prototype.normalizeCtorArgs=function(e){return e&&e.ioConfig&&(e=r.__assign(r.__assign({},e),{ioConfig:r.__assign({resolution:null,bandIds:null,sampling:"closest",tileInfo:d.create()},e.ioConfig)})),e},Object.defineProperty(t.prototype,"url",{set:function(e){var t=c.urlToObject(e);this._set("url",t.path)},enumerable:!0,configurable:!0}),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){throw new o("BaseRaster:open-not-implemented","open() is not implemented")}))}))},t.prototype.fetchTile=function(e,t,i,o){return void 0===o&&(o={}),r.__awaiter(this,void 0,void 0,(function(){var a,s,l,u;return r.__generator(this,(function(r){return a=o.tileInfo,s=a.lodAt(e),l=new n.Point({x:s.resolution,y:s.resolution,spatialReference:a.spatialReference}),u=this._getTileExtent(l,t,i,a),[2,this.fetchPixels(u,a.size[0],a.size[1],o)]}))}))},t.prototype.identify=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,l,u,c,p,f,d,m,y,v,_,x,b,w,I;return r.__generator(this,(function(r){switch(r.label){case 0:return n=this.rasterInfo,i=n.spatialReference,o=n.extent,a=t.datumTransformation,l=g.projectPoint(e,i,a),o.intersects(l)?(u=0,t.srcResolution?(c=g.snapPyramid(t.srcResolution,this.rasterInfo,this.ioConfig.sampling),u=c.pyramidLevel,[3,3]):[3,1]):[2,{location:l,value:null}];case 1:return[4,this.computeBestPyramidLevelForLocation(e,t)];case 2:if(null==(u=r.sent()))return[2,{location:l,value:null}];r.label=3;case 3:return null===(p=this.identifyPixelLocation(l,u,null))?[2,{location:l,value:null}]:(f=p.row,d=p.col,m=p.rowOffset,y=p.colOffset,v=this.url,_=u+"/"+f+"/"+d,x=h.getBlock(v,null,_),s.isSome(x)||(x=this.fetchRawTile(u,f,d,t),h.putBlock(v,null,_,x)),[4,x]);case 4:return(b=r.sent())&&b.pixels&&b.pixels.length>0?(w=m*this.rasterInfo.storageInfo.blockHeight+y,I=!b.mask||b.mask[w]?b.pixels.map((function(e){return e[w]})):null,[2,{location:l,value:I,pyramidLevel:u}]):[2,{location:l,value:null}]}}))}))},t.prototype.fetchPixels=function(e,t,i,o){return void 0===o&&(o={}),r.__awaiter(this,void 0,void 0,(function(){var a,s,l,u,c,p,f,d,h,m,v,_,x,b,w,I,S,T,R,C,F,k,O,P,M;return r.__generator(this,(function(r){switch(r.label){case 0:return a=e.clone().normalize(),e=a[0],s=this.rasterInfo.spatialReference,l=!e.spatialReference.equals(s),u=o.datumTransformation,c=new n.Point({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/i,spatialReference:e.spatialReference}),(p=o.srcResolution||(l?g.projectResolution(c,s,e,u):c))?(f=g.snapPyramid(p,this.rasterInfo,this.ioConfig.sampling),d=f.pyramidLevel,h=f.pyramidResolution,f.excessiveReading?[2,null]:(m=this.rasterInfo.storageInfo,null==(v=l?g.projectExtent(e,s,u):e)?[2,null]:(_={x:Math.floor((v.xmin-m.origin.x)/h.x+.1),y:Math.floor((m.origin.y-v.ymax)/h.y+.1)},x=Math.ceil((v.xmax-v.xmin)/h.x-.1),b=Math.ceil((v.ymax-v.ymin)/h.y-.1),x/t>8||b/i>8?[2,null]:[4,this.fetchRawPixels(d,_,{width:x,height:b},o)]))):[2,null];case 1:return(w=r.sent())?(I=d>0?m.pyramidBlockWidth:m.blockWidth,S=d>0?m.pyramidBlockHeight:m.blockHeight,l||1!==w.pixelBlocks.length||I!==t||S!==i||p.x!==c.x||p.y!==c.y?(T=g.getProjectionOffsetGrid(e,w.extent,c,u),C=!o.requestRawData,F={rows:T.spacing[0],cols:T.spacing[1]},k=w.pixelBlocks,O=w.mosaicSize,P=w.isPartiallyFilled,this.rasterJobHandler?[4,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:k,srcMosaicSize:O,destDimension:C?{width:t,height:i}:null,coefs:C?T.coefficients:null,sampleSpacing:C?F:null},o)]:[3,3]):[2,{extent:e,srcExtent:v,pixelBlock:w.pixelBlocks[0],transformGrid:null}]):[2,null];case 2:return R=r.sent(),[3,4];case 3:M=y.mosaic(k,O),R=C?y.approximateTransform(M,{width:t,height:i},T.coefficients,F):M,r.label=4;case 4:return[2,{srcExtent:v,pixelBlock:R,transformGrid:T,extent:e,isPartiallyFilled:P}]}}))}))},t.prototype.fetchRawPixels=function(e,t,i,o){return r.__awaiter(this,void 0,void 0,(function(){var a,s,l,c,p,f,d,h,m,y,g,v,_,x,b,w,I,S,T,R,C,F,k,O,P,M;return r.__generator(this,(function(r){switch(r.label){case 0:if(a=this.rasterInfo.storageInfo,s=a.origin,l=a.blockBoundary,c=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,p=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight,f=Math.floor(t.x/c),d=Math.floor(t.y/p),h=Math.floor((t.x+i.width-1)/c),m=Math.floor((t.y+i.height-1)/p),y=this.rasterInfo,g=y.pixelSize,v=y.spatialReference,!(_=l[e]))return[2,null];if(x=_.minRow,b=_.minCol,w=_.maxCol,I=_.maxRow,m<x||h<b||d>I||f>w)return[2,null];for(S=[],R=!1,C=d;C<=m;C++)for(F=f;F<=h;F++)C>=x&&F>=b&&I>=C&&w>=F?(T=this._fetchRawTile(e,C,F,o),this.ioConfig.allowPartialFill&&(T=u.create((function(e){T.then((function(t){return e(t)})).catch((function(){R=!0,e(null)}))}))),S.push(T)):S.push(null);return 0===S.length?[2,null]:[4,u.all(S)];case 1:return k=r.sent(),O={height:(m-d+1)*c,width:(h-f+1)*p},P=g.x*Math.pow(2,e),M=g.y*Math.pow(2,e),[2,{extent:new n.Extent({xmin:s.x+f*c*P,xmax:s.x+(h+1)*c*P,ymin:s.y-(m+1)*p*M,ymax:s.y-d*p*M,spatialReference:v}),pixelBlocks:k,mosaicSize:O,isPartiallyFilled:R}]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){throw new o("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}))}))},t.prototype.computeExtent=function(e){return g.projectExtent(this.rasterInfo.extent,e)},t.prototype.decodePixelBlock=function(e,t){return this.rasterJobHandler?this.rasterJobHandler.decode({data:e,options:t}):m.decode(e,t)},t.prototype.request=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var n,o,a,s,l,u,c;return r.__generator(this,(function(p){switch(p.label){case 0:n=this.ioConfig.customFetchParameters,o=e.url,a=e.range,s=e.query,l=e.responseType,null==e.retryCount&&this.ioConfig.retryCount&&(e.retryCount=this.ioConfig.retryCount),u=a?{Range:"bytes="+a.from+"-"+a.to}:null,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,i(o,{query:r.__assign(r.__assign({},s),n),headers:u,responseType:l,signal:t})];case 2:return[2,p.sent().data];case 3:if(c=p.sent(),e.retryCount>0)return e.retryCount--,[2,this.request(e,t)];throw c;case 4:return[2]}}))}))},t.prototype.getSliceIndex=function(e){var t=this.rasterInfo.multidimensionalInfo;if(!t||0===e.length)return null;for(var r=0,n=e[0].variableName,i=function(i){var o=t.variables[i],a=o.dimensions;if(o.name!==n)return r+=a.map((function(e){return e.values.length})).reduce((function(e,t){return e+t})),"break";for(var s=a.map((function(e){return e.values.length})),l=a.length,u=function(t){var n=e.filter((function(e){return e.dimensionName===a[t].name}))[0];if(null==n)return{value:null};var i=Array.isArray(n.values[0])?n.values[0][0]:n.values[0],o=a[t].values.indexOf(i);if(-1===o)return{value:null};s.shift(),r+=t===l-1?o:o*s.reduce((function(e,t){return e+t}))},c=0;c<l;c++){var p=u(c);if("object"==typeof p)return p}},o=0;o<t.variables.length;o++){var a=i(o);if("object"==typeof a)return a.value;if("break"===a)break}return r},t.prototype.computeBestPyramidLevelForLocation=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return[2,0]}))}))},t.prototype.identifyPixelLocation=function(e,t,r){var n=this.rasterInfo,i=n.spatialReference,o=n.pixelSize,a=n.extent,s=this.rasterInfo.storageInfo,l=s.blockWidth,u=s.blockHeight,c=s.maximumPyramidLevel,p=s.pyramidScalingFactor,f=s.origin,d=g.projectPoint(e,i,r);if(!a.intersects(d))return null;if(t<0||t>c)return null;var h=Math.pow(p,t),m=h*o.x,y=h*o.y,v=(f.y-d.y)/y/u,_=(d.x-f.x)/m/l,x=Math.min(u-1,Math.floor((v-Math.floor(v))*u)),b=Math.min(l-1,Math.floor((_-Math.floor(_))*l));return{pyramidLevel:t,row:Math.floor(v),col:Math.floor(_),rowOffset:x,colOffset:b,srcLocation:d}},t.prototype._getTileExtent=function(e,t,r,i){var o=i.origin,a=i.spatialReference,s=i.size[0],l=i.size[1],u=o.x+r*s*e.x,c=u+s*e.x,p=o.y-t*l*e.y,f=p-l*e.y;return new n.Extent({xmin:u,xmax:c,ymin:f,ymax:p,spatialReference:a})},t.prototype._fetchRawTile=function(e,t,n,i){var o=this.url,a=e+"/"+t+"/"+n,l=h.getBlock(o,i.registryId,a);if(!s.isSome(l)){var c=u.createAbortController();l=this.fetchRawTile(e,t,n,r.__assign(r.__assign({},i),{signal:c.signal})),h.putBlock(o,i.registryId,a,l,c),l.catch((function(){h.deleteBlock(o,i.registryId,a)}))}return i.signal&&u.onAbort(i,(function(){h.decreaseRefCount(o,i.registryId,a)})),l},r.__decorate([p.property(f.url)],t.prototype,"url",null),r.__decorate([p.property({type:String,json:{write:!0}})],t.prototype,"datasetName",void 0),r.__decorate([p.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([p.property()],t.prototype,"rasterInfo",void 0),r.__decorate([p.property()],t.prototype,"ioConfig",void 0),r.__decorate([p.property()],t.prototype,"sourceJSON",void 0),r.__decorate([p.subclass("esri.layers.support.rasterDatasets.BaseRaster")],t)}(l.EsriPromiseMixin(a.JSONSupport))}.apply(null,n))||(e.exports=i)},d9Lx:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){if(!e||!t)return[];var r,i=t;if(t.indexOf("/")>-1?(i=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="",!(r=t?n(e,i).getElementsByTagNameNS("*",t):e.getElementsByTagNameNS("*",i))||0===r.length)return[];for(var o=[],a=0;a<r.length;a++)o.push(r[a]||r.item[a]);return o}function n(e,t){if(!e||!t)return null;var i=t;t.indexOf("/")>-1?(i=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var o=r(e,i);return o.length>0?t?n(o[0],t):o[0]:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getElements=r,t.getElement=n,t.getElementValue=function(e,t){var r,i=n(e,t);return i&&(r=i.textContent||i.nodeValue||i.innerText)?r.trim():null},t.getElementValues=function(e,t){for(var n,i=r(e,t),o=[],a=0;a<i.length;a++)(n=i[a].textContent||i[a].nodeValue||i[a].innerText)&&""!==(n=n.trim())&&o.push(n);return o}}.apply(null,n))||(e.exports=i)},f8aF:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("TMur"),r("ma1f"),r("LxLY"),r("Vx27"),r("Kjnw"),r("0GEy"),r("bF83"),r("aS1B"),r("Jhq5")],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,p){var f=function(e,t){var r=e.get(t);return r&&r.values},d=function(e,t){var r=e.get(t);return r&&r.values[0]};return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._files=null,t._headerInfo=null,t._bufferSize=1048576,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,a,u,p,f,d,h,m,y,g,v,_,x,b,w,I,S,T,R,C,F,k,O,P,M,N,L;return r.__generator(this,(function(E){switch(E.label){case 0:return[4,this.init()];case 1:return E.sent(),t=e?o.unwrap(e.signal):null,[4,this.request({url:this.url,range:{from:0,to:this._bufferSize},responseType:"array-buffer"},t)];case 2:if(!(a=E.sent()))throw new i("tiffraster:open","failed to open url "+this.url);return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),u=c.parseSignature(a),p=u.littleEndian,f=u.firstIFD,d=[],[4,this.readIFDs(d,a,p,f,0,4,t)];case 3:if(E.sent(),h=c.getImageInfo(d),m=h.width,y=h.height,g=h.tileWidth,v=h.tileHeight,_=h.planes,x=h.pixelType,b=h.compression,w=h.firstPyramidLevel,I=h.maximumPyramidLevel,S=h.pyramidBlockWidth,T=h.pyramidBlockHeight,R=h.tileBoundary,C=h.metadata,F=n.Extent.fromJSON(h.extent),k=F.spatialReference,O=F?new n.Point({x:F.xmin,y:F.ymax,spatialReference:k}):new n.Point({x:0,y:0}),P=new l({blockWidth:g,blockHeight:v,pyramidBlockWidth:S,pyramidBlockHeight:T,compression:b,origin:O,firstPyramidLevel:w,maximumPyramidLevel:I,blockBoundary:R}),M=new n.Point({x:(F.xmax-F.xmin)/m,y:(F.ymax-F.ymin)/y,spatialReference:k}),N=C?{BandProperties:C.bandProperties,DataType:C.dataType}:null,L=new s({width:m,height:y,bandCount:_,pixelType:x,compression:b,pixelSize:M,storageInfo:P,spatialReference:k,keyProperties:N,extent:F,statistics:C?C.statistics:null}),this._set("rasterInfo",L),this._headerInfo=r.__assign({littleEndian:p,ifds:d},h),!this._headerInfo.isSupported)throw new i("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);return[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,u,c,p,f,d,h,m,y,g,v,_;return r.__generator(this,(function(r){switch(r.label){case 0:return!this._headerInfo&&this._headerInfo.isSupported?[2,null]:(o=this.rasterInfo.storageInfo.blockBoundary,a=e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,s=e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight,!(l=o[e])||l.maxRow<t||l.maxCol<n||l.minRow>t||l.minCol>n?[2,null]:(u=this.getTileLocation(e,t,n))?(c=u.range,p=u.actualTileWidth,f=u.actualTileHeight,d=u.ifd,[4,this.request({url:this.url,range:c,responseType:"array-buffer"},i.signal)]):[2,null]);case 1:return h=r.sent(),[4,this.decodePixelBlock(h,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:d,offset:0,size:0},width:a,height:s,planes:null,pixelType:null})];case 2:if(m=r.sent(),p!==a||f!==s)if(_=m.mask)for(y=0;y<s;y++)if(v=y*a,y<f)for(g=p;g<a;g++)_[v+g]=0;else for(g=0;g<a;g++)_[v+g]=0;else for(_=new Uint8Array(a*s),m.mask=_,y=0;y<f;y++)for(v=y*a,g=0;g<p;g++)_[v+g]=1;return[2,m]}}))}))},t.prototype.readIFDs=function(e,t,n,i,o,a,s){return void 0===a&&(a=4),r.__awaiter(this,void 0,void 0,(function(){var l;return r.__generator(this,(function(r){switch(r.label){case 0:return i?i>=t.byteLength||i<0?[4,this.request({url:this.url,range:{from:i+o,to:i+o+this._bufferSize},responseType:"array-buffer"},s)]:[3,2]:[2,null];case 1:t=r.sent(),o=i+o,i=0,r.label=2;case 2:return[4,this.readIFD(t,n,i,o,p.TIFF_TAGS,a,s)];case 3:return l=r.sent(),e.push(l.ifd),l.nextIFD?[4,this.readIFDs(e,t,n,l.nextIFD-o,o,a,s)]:[2,null];case 4:return r.sent(),[2]}}))}))},t.prototype.readIFD=function(e,t,n,i,o,a,s){return void 0===o&&(o=p.TIFF_TAGS),void 0===a&&(a=4),r.__awaiter(this,void 0,void 0,(function(){var l,u,f,d,h,m,y,g;return r.__generator(this,(function(r){switch(r.label){case 0:return e?(l=c.parseIFD(e,t,n,i,o,a)).success?(u=[],l.ifd.forEach((function(e){e.values||u.push(e)})),u.length>0?(f=u.map((function(e){return e.offlineOffsetSize})),d=Math.min.apply(null,f.map((function(e){return e[0]}))),Math.min.apply(null,f.map((function(e){return e[0]+e[1]})))-d<=this._bufferSize?[4,this.request({url:this.url,range:{from:d,to:d+this._bufferSize},responseType:"array-buffer"},s)]:[3,2]):[3,2]):[3,5]:[2,null];case 1:e=r.sent(),i=d,u.forEach((function(r){return c.parseFieldValues(e,t,r,i)})),r.label=2;case 2:return l.ifd.has("GEOKEYDIRECTORY")?(h=l.ifd.get("GEOKEYDIRECTORY"),(m=h.values)&&m.length>4?(y=m[0]+"."+m[1]+"."+m[2],[4,this.readIFD(e,t,h.valueOffset+6-i,i,p.GEO_KEYS,2,s)]):[3,4]):[3,4];case 3:g=r.sent(),h.data=g.ifd,h.data&&h.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[y]}),r.label=4;case 4:return[2,l];case 5:return l.requiredBufferSize&&l.requiredBufferSize!==e.byteLength?[4,this.request({url:this.url,range:{from:i,to:i+l.requiredBufferSize+4},responseType:"array-buffer"},s)]:[3,7];case 6:return(e=r.sent()).byteLength<l.requiredBufferSize?[2,null]:[2,this.readIFD(e,t,0,i,p.TIFF_TAGS,4,s)];case 7:return[2]}}))}))},t.prototype.getTileLocation=function(e,t,r){var n=this.rasterInfo.storageInfo,i=n.firstPyramidLevel,o=n.blockBoundary,a=0===e?0:e-(i-1),s=this._headerInfo.ifds[a];if(!s)return null;var l=f(s,"TILEOFFSETS");if(void 0===l)return null;var u=f(s,"TILEBYTECOUNTS"),c=o[a],p=c.minRow,h=c.minCol,m=c.maxRow,y=c.maxCol;if(t>m||r>y||t<p||r<h)return null;var g=d(s,"IMAGEWIDTH"),v=d(s,"IMAGELENGTH"),_=d(s,"TILEWIDTH"),x=d(s,"TILELENGTH"),b=t*(y+1)+r,w=l[b],I=u[b];return null==w||null==I?null:{range:{from:w,to:w+I-1},ifd:s,actualTileWidth:r===y?g%_:_,actualTileHeight:t===m?v%x:x}},r.__decorate([a.property()],t.prototype,"_files",void 0),r.__decorate([a.property()],t.prototype,"_headerInfo",void 0),r.__decorate([a.property()],t.prototype,"_bufferSize",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([a.subclass("esri.layers.support.rasterDatasets.TIFFRaster")],t)}(u)}.apply(null,n))||(e.exports=i)},huIg:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("n7Tx")],void 0===(i=function(e,t,r){return function(){function e(){}return Object.defineProperty(e,"supportedVersions",{get:function(){return[5]},enumerable:!0,configurable:!0}),e.parse=function(e){var t=new DataView(e),n=3&t.getUint8(0);if(3!==n)return{header:{version:n},recordSet:null};var i,o=t.getUint32(4,!0),a=t.getUint16(8,!0),s=t.getUint16(10,!0),l={version:n,recordCount:o,headerByteCount:a,recordByteCount:s},u=32,c=[],p=[];if(3===n){for(;13!==t.getUint8(u);)i=String.fromCharCode(t.getUint8(u+11)).trim(),c.push({name:r.bytesToUTF8(new Uint8Array(e,u,11)),type:i,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(i)],length:t.getUint8(u+16)}),u+=32;if(u+=1,c.length>0)for(var f=function(){var n=[];32===t.getUint8(u)?(u+=1,c.forEach((function(t){if("C"===t.type)n.push(r.bytesToUTF8(new Uint8Array(e,u,t.length)).trim());else if("N"===t.type)n.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim(),10));else if("F"===t.type)n.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim()));else if("D"===t.type){var i=String.fromCharCode.apply(null,new Uint8Array(e,u,t.length)).trim();n.push(new Date(parseInt(i.substring(0,4),10),parseInt(i.substring(4,6),10)-1,parseInt(i.substring(6,8),10)))}u+=t.length})),p.push(n)):u+=s};p.length<o&&e.byteLength-u>s;)f()}var d=function(e){var t=e.fields,r=e.records,n=t.some((function(e){return"oid"===e.name.toLowerCase()}))?"OBJECTID":"OID",i=[{name:n,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((function(e){return{name:e.name,type:"esriFieldType"+e.typeName,alias:e.name}}))),o=i.map((function(e){return e.name})),a=[],s=0,l=0;return r.forEach((function(e){var t={};for(t[n]=s++,l=1;l<o.length;l++)t[o[l]]=e[l-1];a.push({attributes:t})})),{displayFieldName:"",fields:i,features:a}}({fields:c,records:p});return{header:l,fields:c,records:p,recordSet:d}},e}()}.apply(null,n))||(e.exports=i)},xB1n:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zOht"),r("TMur"),r("zp6E"),r("ma1f"),r("LxLY"),r("qMld"),r("jfWY"),r("Vx27"),r("Kjnw"),r("0GEy"),r("ddAr"),r("pMLx"),r("Cobz"),r("bF83"),r("SAwq"),r("w1v0")],void 0===(i=function(e,t,r,n,i,o,a,s,l,u,c,p,f,d,h,m,y,g){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._levelOffset=0,t._slices=null,t._tilemapCache=null,t}return r.__extends(t,e),t.prototype.open=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,s,u,c,m,y,g,v,_,x,b,w,I,S,T,R,C,F,k,O,P,M,N,L;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this.init()];case 1:return r.sent(),t=e&&e.signal,this.sourceJSON?(s={data:this.sourceJSON},[3,4]):[3,2];case 2:return[4,i(this.url,{responseType:"json",query:{f:"json"},signal:t})];case 3:s=r.sent(),r.label=4;case 4:if((n=s).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),u=n.data,this.sourceJSON=u,c=["jpg","jpeg","png","png8","png24","png32","mixed"],this.tileType=u.cacheType,null===this.tileType&&(c.indexOf(u.tileInfo.format.toLowerCase())>-1?this.tileType="Map":"lerc"===u.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster"),!u)throw new o("imageserverraster:open","cannot initialize tiled image service, missing service info");if(!u.tileInfo)throw new o("imageserverraster:open","use ImageryLayer to open non-tiled image services");return this.datasetName=u.name,[4,this._fetchRasterInfo({signal:t})];case 5:if(m=r.sent(),!a.isSome(m))throw new o("image-server-raster:open","cannot initialize image service");if(y="Map"===this.tileType?f.readServiceTileInfo(u.tileInfo,u,null):d.fromJSON(u.tileInfo),g=m.extent,v=m.pixelSize,_=.5/m.width*v.x,x=void 0,b=void 0,w=y.lodAt(Math.max.apply(null,y.lods.map((function(e){return e.level})))),"Map"!==this.tileType&&0!==u.maxScale&&("Raster"===this.tileType?(x=y.lods.filter((function(e){return e.resolution===v.x}))[0])||(x=y.lods.filter((function(e){return e.resolution>v.x})).sort((function(e,t){return e.resolution>t.resolution?1:-1}))[0]):(x=y.lods.filter((function(e){return Math.abs(e.scale-u.maxScale)<_}))[0])||(x=y.lods.filter((function(e){return e.scale>u.maxScale})).sort((function(e,t){return e.scale>t.scale?1:-1}))[0]),v.x=v.y=x.resolution,m.width=Math.ceil((g.xmax-g.xmin)/v.x-.1),m.height=Math.ceil((g.ymax-g.ymin)/v.y-.1)),x||(x=w),I=y.lodAt(Math.min.apply(null,y.lods.map((function(e){return e.level})))),"Map"===this.tileType?this._levelOffset=y.lods[0].level:0!==u.minScale&&"Elevation"===this.tileType&&(b=y.lods.filter((function(e){return Math.abs(e.scale-u.minScale)<_}))[0],this._levelOffset=b.level-I.level),b||(b=I),S=Math.max(v.x,v.y),(Math.abs(v.x-v.y)>_||!y.lods.some((function(e){return Math.abs(e.resolution-S)<_})))&&(v.x=v.y=x.resolution,m.width=Math.ceil((g.xmax-g.xmin)/v.x-.1),m.height=Math.ceil((g.ymax-g.ymin)/v.y-.1)),T=x.level-b.level,R=y.size,C=R[0],F=R[1],k=y.origin,O=v.x,P=v.y,M=[{minCol:Math.floor((g.xmin-k.x+.1*O)/C/O),maxCol:Math.floor((g.xmax-k.x-.1*O)/C/O),minRow:Math.floor((k.y-g.ymax+.1*P)/F/P),maxRow:Math.floor((k.y-g.ymin-.1*P)/F/P)}],T>0)for(N=0;N<T;N++)O*=2,P*=2,M.push({minCol:Math.floor((g.xmin-k.x+.1*O)/C/O),maxCol:Math.floor((g.xmax-k.x-.1*O)/C/O),minRow:Math.floor((k.y-g.ymax+.1*P)/F/O),maxRow:Math.floor((k.y-g.ymin-.1*P)/F/O)});return m.storageInfo=new p({blockWidth:y.size[0],blockHeight:y.size[1],pyramidBlockWidth:y.size[0],pyramidBlockHeight:y.size[1],compression:y.format,origin:y.origin,firstPyramidLevel:1,maximumPyramidLevel:T,tileInfo:y,blockBoundary:M}),this._set("rasterInfo",m),u.capabilities.toLowerCase().indexOf("tilemap")>-1&&(L={tileInfo:m.storageInfo.tileInfo,parsedUrl:l.urlToObject(this.url),url:this.url,tileServers:[],type:"tile"},this._tilemapCache=new h.TilemapCache({layer:L})),[2]}}))}))},t.prototype.fetchRawTile=function(e,t,n,i){return void 0===i&&(i={}),r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,u,c,p,f,d,h,m,g,v,_,x,b,w,I,S,T,R,C;return r.__generator(this,(function(r){switch(r.label){case 0:return o=this.rasterInfo,a=o.storageInfo,s=o.extent,l=o.pixelSize,u=a.maximumPyramidLevel-e+this._levelOffset,c=this.url+"/tile/"+u+"/"+t+"/"+n,p=this._slices?{sliceId:i.sliceId||0}:null,[4,this.request({url:c,query:p,responseType:"array-buffer"},i.signal)];case 1:return(f=r.sent())?[4,this.decodePixelBlock(f,{width:a.tileInfo.size[0],height:a.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType})]:[2,null];case 2:return d=r.sent(),h=a.blockBoundary[e],"jpg"!==a.compression||n>h.minCol&&n<h.maxCol&&t>h.minRow&&t<h.maxRow||(m=a.origin,g=a.blockWidth,v=a.blockHeight,_=Math.pow(2,e),x=Math.round((s.xmin-m.x)/(l.x*_))%g,b=Math.round((s.xmax-m.x)/(l.x*_))%g,w=Math.round((m.y-s.ymax)/(l.x*_))%v,I=Math.round((m.y-s.ymin)/(l.x*_))%v,S=n===h.minCol?x:0,T=t===h.minRow?w:0,R=n===h.maxCol?b:g,C=t===h.maxRow?I:v,y.setValidBoundary(d,{x:S,y:T},{width:R-S,height:C-T})),[2,d]}}))}))},t.prototype.getSliceIndex=function(e){for(var t=e,r=0;r<this._slices.length;r++){var n=this._slices[r].multidimensionalDefinition;if(n.length===t.length&&!n.some((function(e){var r=t.filter((function(t){return e.variableName===t.variableName&&t.dimensionName===e.dimensionName}))[0];return r?(Array.isArray(e.values[0])?e.values[0][0]:e.values[0])!==(Array.isArray(r.values[0])?r.values[0][0]:r.values[0]):null})))return r}return null},t.prototype.computeBestPyramidLevelForLocation=function(e,t){return void 0===t&&(t={}),r.__awaiter(this,void 0,void 0,(function(){var n,i,o,a,s;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this._tilemapCache)return[2,0];if(null===(n=this.identifyPixelLocation(e,0,t.datumTransformation)))return[2,null];i=0,o=this.rasterInfo.storageInfo.maximumPyramidLevel,a=o-i+this._levelOffset,s=n.srcLocation,r.label=1;case 1:if(!(a>=0))return[3,6];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._tilemapCache.fetchAvailability(a,n.row,n.col,t)];case 3:return"available"===r.sent()?[3,6]:[3,5];case 4:return r.sent(),[3,5];case 5:return a--,i++,null===(n=this.identifyPixelLocation(s,i,t.datumTransformation))?[2,null]:[3,1];case 6:return-1===a||null==n?[2,null]:[2,i]}}))}))},t.prototype._fetchRasterInfo=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,o,a,l,u,p,f,d,h,m,y,v,_=this;return r.__generator(this,(function(r){return t=this.sourceJSON,o=Math.ceil((t.extent.xmax-t.extent.xmin)/t.pixelSizeX-.1),a=Math.ceil((t.extent.ymax-t.extent.ymin)/t.pixelSizeY-.1),l=n.SpatialReference.fromJSON(t.spatialReference||t.extent.spatialReference),"Map"===this.tileType?[2,new c({width:o,height:a,bandCount:3,extent:n.Extent.fromJSON(t.extent),spatialReference:l,pixelSize:new n.Point({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:l}),pixelType:"u8",statistics:null})]:(u=e.slice,p=e.signal,f=!!t.hasRasterAttributeTable&&i(this.url+"/rasterAttributeTable",{query:{slice:u,f:"json"},signal:p}).then((function(e){return g.fromJSON(e.data)})).catch((function(){return null})),d=!!t.hasColormap&&i(this.url+"/colormap",{query:{slice:u,f:"json"},signal:p}).then((function(e){return e.data&&e.data.colormap})),h=!!t.hasHistograms&&i(this.url+"/histograms",{query:{slice:u,f:"json"},signal:p}).then((function(e){return e.data&&e.data.histograms})),m=i(this.url+"/keyProperties",{query:{f:"json"},signal:p}).then((function(e){return e.data})).catch((function(){})),y=!!t.hasMultidimensions&&i(this.url+"/multidimensionalInfo",{query:{f:"json"},signal:p}).then((function(e){return e.data&&e.data.multidimensionalInfo})),v=!!t.hasMultidimensions&&i(this.url+"/slices",{query:{f:"json"},signal:p}).then((function(e){return e.data&&e.data.slices})).catch((function(){})),[2,s.all([f,d,h,m,y,v]).then((function(e){var r=null;if(t.minValues&&t.minValues.length===t.bandCount){r=[];for(var i=0;i<t.minValues.length;i++)r.push({min:t.minValues[i],max:t.maxValues[i],avg:t.meanValues[i],stddev:t.stdvValues[i]})}return _._slices=e[5]||null,new c({width:o,height:a,bandCount:t.bandCount,extent:n.Extent.fromJSON(t.extent),spatialReference:l,pixelSize:new n.Point({x:t.pixelSizeX,y:t.pixelSizeY,spatialReference:l}),pixelType:t.pixelType.toLowerCase(),statistics:r,attributeTable:e[0]||null,colormap:e[1]||null,histograms:e[2]||null,keyProperties:e[3]||null,multidimensionalInfo:e[4]||null})}))])}))}))},r.__decorate([u.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0),r.__decorate([u.property()],t.prototype,"tileType",void 0),r.__decorate([u.subclass("esri.layers.support.rasterDatasets.ImageServerRaster")],t)}(m)}.apply(null,n))||(e.exports=i)}}]);