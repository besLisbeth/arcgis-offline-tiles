(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/data/BoundsStore":"2xGR","esri/layers/graphics/data/QueryEngineCapabilities":"4/qq","esri/layers/graphics/data/AttributesBuilder":"700l","esri/layers/graphics/sources/support/clientSideDefaults":"DaHD","esri/geometry/support/aaBoundingBox":"WRgd","esri/layers/graphics/data/executeTileQuery":"ZGAQ","esri/layers/graphics/data/QueryEngine":"ZooB","esri/layers/graphics/data/QueryEngineResult":"d81A","esri/layers/graphics/data/FeatureStore":"rfv1","esri/layers/support/PromiseQueue":"tZaU"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"2xGR":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("H1tY"),r("jEml"),r("2Kdy")],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n={minX:0,minY:0,maxX:0,maxY:0},s=function(){function e(){var e=this;this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=i(9,r("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(e._indexInvalid){var t=new Array(e._idByBounds.size),r=0;e._idByBounds.forEach((function(e,i){t[r++]=i})),e._indexInvalid=!1,e._index.clear(),e._index.load(t)}else e._boundsToLoad.length&&(e._index.load(e._boundsToLoad.filter((function(t){return e._idByBounds.has(t)}))),e._boundsToLoad.length=0)}}return e.prototype.clear=function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()},e.prototype.delete=function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))},e.prototype.forEachInBounds=function(e,t){this._loadIndex();for(var r=0,i=function(e,t){return n.minX=t[0],n.minY=t[1],n.maxX=t[2],n.maxY=t[3],e.search(n)}(this._index,e);r<i.length;r++){var s=i[r];t(this._idByBounds.get(s))}},e.prototype.get=function(e){return this._boundsById.get(e)},e.prototype.has=function(e){return this._boundsById.has(e)},e.prototype.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)},e.prototype.set=function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))},e}();t.BoundsStore=s}.apply(null,i))||(e.exports=n)},"4/qq":function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}}.apply(null,i))||(e.exports=n)},"700l":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("LxLY"),r("Ytki")],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=e.returnDistinctValues,this.fieldsIndex=r,this.featureAdapter=t;var n=e.outFields;if(n&&-1===n.indexOf("*")){this.outFields=n;for(var s=0,o=0,a=n;o<a.length;o++){var u=a[o],c=i.getExpressionFromFieldName(u),l=this.fieldsIndex.get(c),h=l?null:i.getWhereClause(c,r),d=l?l.name:i.getAliasFromFieldName(u)||"FIELD_EXP_"+s++;this._fieldDataCache.set(u,{alias:d,clause:h})}}}return e.prototype.getAttributes=function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t,r){var n=r?r.name:t,s=null;return this._fieldDataCache.has(n)?s=this._fieldDataCache.get(n).clause:r||(s=i.getWhereClause(t,this.fieldsIndex),this._fieldDataCache.set(n,{alias:n,clause:s})),r?this.featureAdapter.getAttribute(e,n):s.calculateValue(e,this.featureAdapter)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testFeature(e,this.featureAdapter)},e.prototype.validateItems=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t,this.fieldsIndex)}),this._fieldDataCache.get(t).clause.testSet(e,this.featureAdapter)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!t||!t.length)return this.featureAdapter.getAttributes(e);for(var r={},i=0,n=t;i<n.length;i++){var s=n[i],o=this._fieldDataCache.get(s),a=o.alias,u=o.clause;r[a]=u?u.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,a)}return r},e.prototype._processAttributesForDistinctValues=function(e){if(r.isNone(e)||!this.returnDistinctValues)return e;var t=this.outFields,i=[];if(t)for(var n=0,s=t;n<s.length;n++){var o=s[n],a=this._fieldDataCache.get(o).alias;i.push(e[a])}else for(var a in e)i.push(e[a]);var u=(t||["*"]).join(",")+"="+i.join(","),c=this._returnDistinctMap.get(u)||0;return this._returnDistinctMap.set(u,++c),c>1?null:e},e}();t.default=n}.apply(null,i))||(e.exports=n)},DaHD:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("H1tY"),r("rg9i"),r("35hF")],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.createDrawingInfo=function(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?s.defaultPointSymbolJSON:"esriGeometryPolyline"===e?s.defaultPolylineSymbolJSON:s.defaultPolygonSymbolJSON}}},t.createDefaultAttributesFunction=function(e,t){if(i("csp-restrictions"))return function(){var i;return r.__assign(((i={})[t]=null,i),e)};try{var n="this."+t+" = null;";for(var s in e)n+="this."+s+" = "+JSON.stringify(e[s])+";";var o=new Function(n);return function(){return new o}}catch(i){return function(){var i;return r.__assign(((i={})[t]=null,i),e)}}},t.createDefaultTemplate=function(e){return void 0===e&&(e={}),[{name:"New Feature",description:"",prototype:{attributes:n.clone(e)}}]}}.apply(null,i))||(e.exports=n)},WRgd:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("LxLY"),r("N7S/"),r("lRq4")],void 0===(n=function(e,t,r,i,n){function s(e){return void 0===e&&(e=t.ZERO),[e[0],e[1],e[2],e[3],e[4],e[5]]}function o(e,t,r,i,n,o,a){return void 0===a&&(a=s()),a[0]=e,a[1]=t,a[2]=r,a[3]=i,a[4]=n,a[5]=o,a}function a(e){return e[0]>=e[3]?0:e[3]-e[0]}function u(e){return e[1]>=e[4]?0:e[4]-e[1]}function c(e){return e[2]>=e[5]?0:e[5]-e[2]}function l(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function h(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function d(e){return 6===e.length}Object.defineProperty(t,"__esModule",{value:!0}),t.create=s,t.fromValues=o,t.fromExtent=function(e,t){return void 0===t&&(t=s()),t[0]=e.xmin,t[1]=e.ymin,t[2]=e.zmin,t[3]=e.xmax,t[4]=e.ymax,t[5]=e.zmax,t},t.toExtent=function(e,t){var r=isFinite(e[2])||isFinite(e[5]);return new i(r?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})},t.fromMinMax=function(e,t,r){return void 0===r&&(r=s()),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=t[0],r[4]=t[1],r[5]=t[2],r},t.expandPointInPlace=function(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[3]&&(e[3]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[4]&&(e[4]=t[1]),t[2]<e[2]&&(e[2]=t[2]),t[2]>e[5]&&(e[5]=t[2])},t.expand=function(e,t,r){return void 0===r&&(r=e),d(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r[4]=Math.max(e[4],t[4]),r[5]=Math.max(e[5],t[5])):n.is(t)?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[3]=Math.max(e[3],t[2]),r[4]=Math.max(e[4],t[3])):2===t.length?(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[3]=Math.max(e[3],t[0]),r[4]=Math.max(e[4],t[1])):3===t.length&&(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r[3]=Math.max(e[3],t[0]),r[4]=Math.max(e[4],t[1]),r[5]=Math.max(e[5],t[2])),r},t.expandWithBuffer=function(e,t,r,i,n){void 0===r&&(r=0),void 0===i&&(i=t.length/3),void 0===n&&(n=e);for(var s=e[0],o=e[1],a=e[2],u=e[3],c=e[4],l=e[5],h=0;h<i;h++)s=Math.min(s,t[r+3*h]),o=Math.min(o,t[r+3*h+1]),a=Math.min(a,t[r+3*h+2]),u=Math.max(u,t[r+3*h]),c=Math.max(c,t[r+3*h+1]),l=Math.max(l,t[r+3*h+2]);return n[0]=s,n[1]=o,n[2]=a,n[3]=u,n[4]=c,n[5]=l,n},t.expandWithOffset=function(e,t,r,i,n){return void 0===n&&(n=e),n[0]=Math.min(e[0],e[0]+t),n[3]=Math.max(e[3],e[3]+t),n[1]=Math.min(e[1],e[1]+r),n[4]=Math.max(e[4],e[4]+r),n[2]=Math.min(e[2],e[2]+i),n[5]=Math.max(e[5],e[5]+i),n},t.expandWithNestedArray=function(e,t,r,i){void 0===i&&(i=e);var n=t.length,s=e[0],o=e[1],a=e[2],u=e[3],c=e[4],l=e[5];if(r)for(var h=0;h<n;h++){var d=t[h];s=Math.min(s,d[0]),o=Math.min(o,d[1]),a=Math.min(a,d[2]),u=Math.max(u,d[0]),c=Math.max(c,d[1]),l=Math.max(l,d[2])}else for(h=0;h<n;h++)d=t[h],s=Math.min(s,d[0]),o=Math.min(o,d[1]),u=Math.max(u,d[0]),c=Math.max(c,d[1]);return i[0]=s,i[1]=o,i[2]=a,i[3]=u,i[4]=c,i[5]=l,i},t.allFinite=function(e){for(var t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0},t.width=a,t.depth=u,t.height=c,t.diameter=function(e){var t=a(e),r=c(e),i=u(e);return Math.sqrt(t*t+r*r+i*i)},t.center=function(e,t){return void 0===t&&(t=[0,0,0]),t[0]=e[0]+a(e)/2,t[1]=e[1]+u(e)/2,t[2]=e[2]+c(e)/2,t},t.size=function(e,t){return void 0===t&&(t=[0,0,0]),t[0]=a(e),t[1]=u(e),t[2]=c(e),t},t.maximumDimension=function(e){return Math.max(a(e),c(e),u(e))},t.containsPoint=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]},t.containsPointWithMargin=function(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[2]>=e[2]-r&&t[0]<=e[3]+r&&t[1]<=e[4]+r&&t[2]<=e[5]+r},t.contains=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]},t.intersects=l,t.intersectsClippingArea=function(e,t){return!!r.isNone(t)||l(e,t)},t.offset=function(e,t,r,i,n){return void 0===n&&(n=e),n[0]=e[0]+t,n[1]=e[1]+r,n[2]=e[2]+i,n[3]=e[3]+t,n[4]=e[4]+r,n[5]=e[5]+i,n},t.getMin=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.getMax=function(e,t){return t[0]=e[3],t[1]=e[4],t[2]=e[5],t},t.setMin=function(e,t,r){return void 0===r&&(r=e),r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r},t.setMax=function(e,t,r){return void 0===r&&(r=e),r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e},t.set=h,t.empty=function(e){return e?h(e,t.NEGATIVE_INFINITY):s(t.NEGATIVE_INFINITY)},t.toRect=function(e,t){return t||(t=n.create()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t},t.fromRect=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e},t.is=d,t.isPoint=function(e){return 0===a(e)&&0===u(e)&&0===c(e)},t.equals=function(e,t,i){if(r.isNone(e)||r.isNone(t))return e===t;if(!d(e)||!d(t))return!1;if(i){for(var n=0;n<e.length;n++)if(!i(e[n],t[n]))return!1}else for(n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},t.wrap=function(e,t,r,i,n,s){return o(e,t,r,i,n,s,f)},t.POSITIVE_INFINITY=[-1/0,-1/0,-1/0,1/0,1/0,1/0],t.NEGATIVE_INFINITY=[1/0,1/0,1/0,-1/0,-1/0,-1/0],t.ZERO=[0,0,0,0,0,0];var f=s()}.apply(null,i))||(e.exports=n)},ZGAQ:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("lRq4"),r("+6sX"),r("Jvs9"),r("ZooB"),r("zDti")],void 0===(n=function(e,t,r,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});var a=new n.default,u={esriGeometryPoint:i.convertToPoint,esriGeometryPolyline:i.convertToPolyline,esriGeometryPolygon:i.convertToPolygon,esriGeometryMultipoint:i.convertToMultipoint};t.executeTileQueryForIds=function(e,t,i){var n=i.pixelBuffer*t.resolution,s=r.pad(t.bounds,n,r.create()),o=[];return e.featureStore.forEachInBounds(s,(function(t){return o.push(e.featureAdapter.getObjectId(t))})),o},t.createTileFeatures=function(e,t,r,i,n,h,d,f,p){var y=u[r.geometryType],m=c[r.geometryType],_="esriGeometryPolygon"===r.geometryType&&!f,g=r.hasZ?r.hasM?4:3:r.hasM?3:2;d&&!h?i.forEachInBounds(n,(function(i){return function(e,t,r,i,n){if(!t.has(r.objectId)){var a=o.getCentroid(i,r,n),u=r.attributes;a&&(t.add(r.objectId),e.push(new s.Feature(u,r.localId,null,a)))}}(e,t,i,r,p)})):h&&!d?i.forEachInBounds(n,(function(r){return function(e,t,r,i,n,o,u,c){if(!t.has(r.objectId)){var h=r.attributes,d=i(l(a,r.geometry,n,o,c,u),!1,!1);d&&(t.add(r.objectId),e.push(new s.Feature(h,r.localId,d,null)))}}(e,t,r,y,g,m,p,_)})):i.forEachInBounds(n,(function(i){return function(e,t,r,i,n,u,c,h,d){if(!t.has(r.objectId)){var f=o.getCentroid(i,r,n),p=r.attributes,y=u(l(a,r.geometry,c,h,d,n),!1,!1);y&&f&&(t.add(r.objectId),e.push(new s.Feature(p,r.localId,y,f)))}}(e,t,i,r,p,y,g,m,_)}))};var c={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0};function l(e,t,r,n,s,o){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;var a,u,c,l,h=t.coords,d=t.lengths;if(!d.length)return e.coords[0]=i.quantizeX(o,h[0]),e.coords[1]=i.quantizeY(o,h[1]),e.coords.length=r,e;for(var f=0,p=0,y=p,m=0,_=d;m<_.length;m++){var g=_[m];if(!(g<n))if(p=y,c=a=i.quantizeX(o,h[f]),l=u=i.quantizeY(o,h[f+1]),e.coords[p]=c,e.coords[p+1]=l,f+=r,1!==g){var v=(c=i.quantizeX(o,h[f]))-a,x=(l=i.quantizeY(o,h[f+1]))-u,I=x/v;p+=2,e.coords[p]=v,e.coords[p+1]=x,a=c,u=l,f+=r;for(var b=2;b<g;b++){if(c=i.quantizeX(o,h[f]),l=i.quantizeY(o,h[f+1]),c!==a||l!==u){var F=c-a,M=l-u,S=M/F;I!==S&&(isFinite(I)||isFinite(S))||!(s||(x>=0&&M>=0||x<=0&&M<=0)&&(v>=0&&F>=0||v<=0&&F<=0))?(v=F,x=M,p+=2):(v+=F,x+=M),e.coords[p]=v,e.coords[p+1]=x,I=S,a=c,u=l}f+=r}var E=(p+2-y)/2;E>=n&&(e.lengths.push(E),y=p+2)}else e.lengths.push(1),y=p+2}return e.coords.length>y&&(e.coords.length=y),e.coords.length?e:null}t.quantizeOptimizedGeometryForDisplay=l}.apply(null,i))||(e.exports=n)},ZooB:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("ma1f"),r("rg9i"),r("LxLY"),r("r7jh"),r("qMld"),r("ULaq"),r("8uEs"),r("WRgd"),r("lRq4"),r("hBh5"),r("Lzvl"),r("nrlZ"),r("Ytki"),r("Q2Em"),r("4/qq"),r("d81A"),r("V1i6"),r("/61J"),r("zDti"),r("I90O"),r("tZaU")],void 0===(n=function(e,t,r,i,n,s,o,a,u,c,l,h,d,f,p,y,m,_,g,v,x,I,b,F){Object.defineProperty(t,"__esModule",{value:!0});t.Feature=function(e,t,r,i,n){void 0===t&&(t=null),this.attributes=e,this.geometry=r,this.centroid=i,this.filterFlags=n,this.groupId=-1,this.localId=t};var M=new Set,S=new o.MemCacheStorage(2e6),E=0,T=function(){function e(e){var t=this;this.capabilities={query:_.queryCapabilities},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this._changeHandle=this.featureStore.events.on("changed",(function(){return t.clearCache()})),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new o.MemCache(E+++"$$",S)),this.fieldsIndex=new b(e.fields),e.scheduler&&e.task&&(this._frameQueue=new F.default,this._frameTask=e.scheduler.registerTask(e.task,(function(e){return t._update(e)}),(function(){return t._frameQueue.length>0})))}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null),this.fieldsIndex.destroy()},Object.defineProperty(e.prototype,"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:I.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeExtent",{get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=x.getTimeExtent(this.timeInfo,this.featureStore)),this._timeExtent):null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},e.prototype.executeQuery=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,s,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=n.clone(e),r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return I.normalizeQuery(t,o.definitionExpression,o.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return o._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return o._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),[3,9];case 8:if((s=r.sent())!==I.QUERY_ENGINE_EMPTY_RESULT)throw s;return i=new g.default([],null,this),[3,9];case 9:return[2,i.createQueryResponse(t)]}}))}))},e.prototype.executeQueryForCount=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,s,o=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=n.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return I.normalizeQuery(t,o.definitionExpression,o.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return o._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return o._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return[2,(i=r.sent()).size];case 8:if((s=r.sent())!==I.QUERY_ENGINE_EMPTY_RESULT)throw s;return[2,0];case 9:return[2]}}))}))},e.prototype.executeQueryForExtent=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,s,o,a,u,h,d,f=this;return r.__generator(this,(function(r){switch(r.label){case 0:t=n.clone(e),s=t.outSR,r.label=1;case 1:return r.trys.push([1,8,,9]),[4,this._schedule((function(){return I.normalizeQuery(t,f.definitionExpression,f.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return f._checkQuerySupport(t)}))];case 3:return(t=r.sent()).returnGeometry=!0,t.returnCentroid=!1,t.outSR=null,[4,this._reschedule((function(){return f._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),(o=i.size)?(l.set(Q,l.NEGATIVE_INFINITY),this.featureStore.forEachBounds(i.items,(function(e){return l.expand(Q,e)}),w),a={xmin:Q[0],ymin:Q[1],xmax:Q[3],ymax:Q[4],spatialReference:I.cleanFromGeometryEngine(this.spatialReference)},this.hasZ&&isFinite(Q[2])&&isFinite(Q[5])&&(a.zmin=Q[2],a.zmax=Q[5]),(u=m.project(a,i.spatialReference,s)).spatialReference=I.cleanFromGeometryEngine(s||this.spatialReference),u.xmax-u.xmin==0&&(h=c.getMetersPerUnitForSR(u.spatialReference),u.xmin-=h,u.xmax+=h),u.ymax-u.ymin==0&&(h=c.getMetersPerUnitForSR(u.spatialReference),u.ymin-=h,u.ymax+=h),this.hasZ&&null!=u.zmin&&null!=u.zmax&&u.zmax-u.zmin==0&&(h=c.getMetersPerUnitForSR(u.spatialReference),u.zmin-=h,u.zmax+=h),[2,{count:o,extent:u}]):[2,{count:o,extent:null}];case 8:if((d=r.sent())===I.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw d;case 9:return[2]}}))}))},e.prototype.executeQueryForIds=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(r){return[2,this.executeQueryForIdSet(e,t).then((function(e){return u.valuesOfSet(e)}))]}))}))},e.prototype.executeQueryForIdSet=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,i,s,o,a,u=this;return r.__generator(this,(function(r){switch(r.label){case 0:(t=n.clone(e)).returnGeometry=!1,t.returnCentroid=!1,t.outSR=null,r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return I.normalizeQuery(t,u.definitionExpression,u.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return u._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return u._executeGeometryQuery(t)}))];case 4:return i=r.sent(),[4,this._reschedule((function(){return i.executeObjectIdsQuery(t)}))];case 5:return i=r.sent(),[4,this._reschedule((function(){return i.executeTimeQuery(t)}))];case 6:return i=r.sent(),[4,this._reschedule((function(){return i.executeAttributesQuery(t)}))];case 7:return i=r.sent(),s=i.items,o=new Set,[4,this._reschedule((function(){for(var e=0,t=s;e<t.length;e++){var r=t[e];o.add(i.featureAdapter.getObjectId(r))}}))];case 8:return r.sent(),[2,o];case 9:if((a=r.sent())===I.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw a;case 10:return[2]}}))}))},e.prototype.executeQueryForLatestObservations=function(e,t){return void 0===e&&(e={}),r.__awaiter(this,void 0,void 0,(function(){var t,s,o,a=this;return r.__generator(this,(function(r){switch(r.label){case 0:if(!this.timeInfo||!this.timeInfo.trackIdField)throw new i("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});t=n.clone(e),r.label=1;case 1:return r.trys.push([1,9,,10]),[4,this._schedule((function(){return I.normalizeQuery(t,a.definitionExpression,a.spatialReference)}))];case 2:return t=r.sent(),[4,this._reschedule((function(){return a._checkQuerySupport(t)}))];case 3:return t=r.sent(),[4,this._reschedule((function(){return a._executeGeometryQuery(t)}))];case 4:return s=r.sent(),[4,this._reschedule((function(){return s.executeObjectIdsQuery(t)}))];case 5:return s=r.sent(),[4,this._reschedule((function(){return s.executeTimeQuery(t)}))];case 6:return s=r.sent(),[4,this._reschedule((function(){return s.executeAttributesQuery(t)}))];case 7:return s=r.sent(),[4,this._reschedule((function(){return s.filterLatest()}))];case 8:return s=r.sent(),[3,10];case 9:if((o=r.sent())!==I.QUERY_ENGINE_EMPTY_RESULT)throw o;return s=new g.default([],null,this),[3,10];case 10:return[2,s.createQueryResponse(t)]}}))}))},e.prototype._schedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.push(e)]:[2,e()]}))}))},e.prototype._reschedule=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._frameQueue?[2,this._frameQueue.unshift(e)]:[2,e()]}))}))},e.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue&&this._frameQueue.process();)e.madeProgress();this._budget=null},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new g.default(e,null,this)}return this._allItems},e.prototype._executeGeometryQuery=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,i,n,o,a,u,c,l,h,d,f,y,m,_,x,I,b,F,M,S=this;return r.__generator(this,(function(E){switch(E.label){case 0:if(t=e.geometry,i=e.outSR,n=e.spatialRel,o=p.isValid(i)&&!p.equals(this.spatialReference,i),(a=this._geometryQueryCache?o?JSON.stringify({geometry:t,spatialRelationship:n,outSpatialReference:i}):JSON.stringify({geometry:t,spatialRelationship:n}):null)&&(u=this._geometryQueryCache.get(a),!s.isUndefined(u)))return[2,u];if(c=function(t){return r.__awaiter(S,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return o&&(e.returnGeometry||e.returnCentroid)?[4,t.project(i)]:[3,2];case 1:return n=r.sent(),a&&this._geometryQueryCache.put(a,n,n.size||1),[2,n];case 2:return a&&this._geometryQueryCache.put(a,t,t.size||1),[2,t]}}))}))},!t)return[2,c(this._getAll())];if(l=this.featureAdapter,"esriSpatialRelDisjoint"!==n)return[3,3];if(!(h=this._searchFeatures(this._getQueryBBoxes(t))).length)return[2,c(this._getAll())];for(y=new Set,m=0,_=h;m<_.length;m++)x=_[m],y.add(l.getObjectId(x));return[4,this._reschedule((function(){var e=0;d=new Array(y.size),S.featureStore.forEach((function(t){return d[e++]=t})),f=y}))];case 1:return E.sent(),[4,this._reschedule((function(){return r.__awaiter(S,void 0,void 0,(function(){var e,i,s;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,v.getSpatialQueryOperator(n,t,this.geometryType,this.hasZ,this.hasM)];case 1:return e=r.sent(),i=function(t){return!f.has(l.getObjectId(t))||e(l.getGeometry(t))},s=g.default.bind,[4,this._runSpatialFilter(d,i)];case 2:return[2,new(s.apply(g.default,[void 0,r.sent(),t,this]))]}}))}))}))];case 2:return b=E.sent(),[2,c(b)];case 3:return(I=this._searchFeatures(this._getQueryBBoxes(t))).length?this._canExecuteSoloPass(t,e)?[2,c(new g.default(I,t,this))]:[4,v.getSpatialQueryOperator(n,t,this.geometryType,this.hasZ,this.hasM)]:(b=new g.default([],t,this),a&&this._geometryQueryCache.put(a,b,b.size||1),[2,b]);case 4:return F=E.sent(),[4,this._runSpatialFilter(I,(function(e){return F(l.getGeometry(e))}))];case 5:return M=E.sent(),[2,c(new g.default(M,t,this))]}}))}))},e.prototype._runSpatialFilter=function(e,t){return r.__awaiter(this,void 0,void 0,(function(){var i,n,s,o=this;return r.__generator(this,(function(a){return t?this._budget?(i=0,n=new Array,s=function(){return r.__awaiter(o,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:return i<e.length?(o=e[i],t(o)&&n.push(o),this._budget.done?[4,this._reschedule((function(){return s()}))]:[3,2]):[3,3];case 1:r.sent(),r.label=2;case 2:return++i,[3,0];case 3:return[2]}}))}))},[2,this._reschedule((function(){return s()})).then((function(){return n}))]):[2,e.filter((function(e){return t(e)}))]:[2,e]}))}))},e.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,i=t.spatialRel;return v.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))},e.prototype._getQueryBBoxes=function(e){if(v.canQueryWithRBush(e)){if(f.isExtent(e))return[h.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(f.isPolygon(e))return e.rings.map((function(e){return h.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[d.getBoundsXY(h.create(),e)]},e.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.featureStore.forEachInBounds(i,(function(e){M.add(e)}))}var n=new Array(M.size),s=0;return M.forEach((function(e){return n[s++]=e})),M.clear(),n},e.prototype._checkQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new i("feature-store:unsupported-query","Unsupported query options",{query:e});return[2,a.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),v.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),m.checkProjectionSupport(this.spatialReference,e.outSR)]).then((function(){return e}))]}))}))},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,s=e.outStatistics,o=s?s.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})):[];if(r&&r.length>0){var a=r.map((function(e){var t=e.toLowerCase();return t.indexOf(" asc")>-1?t.split(" asc")[0]:t.indexOf(" desc")>-1?t.split(" desc")[0]:e})).filter((function(e){return-1===o.indexOf(e)}));y.validateFields(this.fieldsIndex,a,"orderByFields contains missing fields")}if(t&&t.length>0)y.validateFields(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new i("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});y.validateWhere(this.fieldsIndex,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n,s,o,a,u,c,l,h,d,f;return r.__generator(this,(function(r){if(t=e.outStatistics,n=e.groupByFieldsForStatistics,s=e.having,o=n&&n.length,a=t&&t.length,s){if(!o||!a)throw new i("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});y.validateHaving(this.fieldsIndex,s,t)}if(a){if(!function(e){return e.every((function(e){return"exceedslimit"!==e.statisticType}))}(t))return[2];for(u=t.map((function(e){return e.onStatisticField})),y.validateFields(this.fieldsIndex,u,"onStatisticFields contains missing fields"),o&&y.validateFields(this.fieldsIndex,n,"groupByFieldsForStatistics contains missing fields"),c=0,l=t;c<l.length;c++)if(h=l[c],d=h.onStatisticField,"percentile_disc"!==(f=h.statisticType)&&"percentile_cont"!==f||!("statisticParameters"in h)){if("count"!==f&&d&&y.hasInvalidFieldType(d,this.fieldsIndex))throw new i("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:h,query:e})}else if(!h.statisticParameters)throw new i("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:h,query:e})}return[2]}))}))},e}();t.default=T;var w=l.create(),Q=l.create()}.apply(null,i))||(e.exports=n)},d81A:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("R2Zq"),r("LxLY"),r("qMld"),r("ULaq"),r("u90+"),r("nrlZ"),r("+6sX"),r("700l"),r("Ytki"),r("Q2Em"),r("/61J"),r("zDti")],void 0===(n=function(e,t,r,i,n,s,o,a,u,c,l,h,d,f,p){function y(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function m(e,t,r){return(r?e>t:e<t)?-1:(r?e<t:e>t)?1:0}function _(e,t,r){return r?t-e:e-t}function g(e,t,r,i){if(r&&"esriFieldTypeDate"===r.type){var n=new Date(e).getTime(),s=new Date(t).getTime();if(!isNaN(n)&&!isNaN(s))return _(n,s,i)}return"number"==typeof e&&"number"==typeof t?_(e,t,i):"string"==typeof e&&"string"==typeof t?(n=e.toUpperCase(),s=t.toUpperCase(),!r||"esriFieldTypeGUID"!==r.type&&"esriFieldTypeGlobalID"!==r.type?m(n,s,i):m(y(n),y(s),i)):i?1:-1}Object.defineProperty(t,"__esModule",{value:!0});var v=function(){function e(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsIndex=r.fieldsIndex,this.timeInfo=r.timeInfo,this.featureAdapter=r.featureAdapter}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(u.isValid(e.outSR)&&!u.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=p.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},d.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=p.cleanFromGeometryEngine(r.__assign({spatialReference:e.outSR},this.queryGeometry))),t},e.prototype.executeAttributesQuery=function(t){var r=h.getWhereClause(t.where,this.fieldsIndex);if(!r)return s.resolve(this);if(r.isStandardized){for(var i=0,n=[],o=0,a=this.items;o<a.length;o++){var u=a[o];r.testFeature(u,this.featureAdapter)&&(n[i++]=u)}var c=new e(n,this.queryGeometry,this);return c.definitionExpression=t.where,s.resolve(c)}return s.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(t){if(!t.objectIds||!t.objectIds.length)return s.resolve(this);var r=o.SetFromValues(t.objectIds),i=this.featureAdapter.getObjectId;return s.resolve(new e(this.items.filter((function(e){return r.has(i(e))})),this.queryGeometry,this))},e.prototype.executeTimeQuery=function(t){var r=f.getTimeOperator(this.timeInfo,t.timeExtent,this.featureAdapter);if(!n.isSome(r))return s.resolve(this);var i=this.items.filter(r);return s.resolve(new e(i,this.queryGeometry,this))},e.prototype.filterLatest=function(){for(var t=this.timeInfo,r=t.trackIdField,n=t.startTimeField,o=t.endTimeField||n,a=new Map,u=this.featureAdapter.getAttribute,c=0,l=this.items;c<l.length;c++){var h=l[c],d=u(h,r),f=u(h,o),p=a.get(d);(!p||f>u(p,o))&&a.set(d,h)}var y=i.valuesOfMap(a);return s.resolve(new e(y,this.queryGeometry,this))},e.prototype.project=function(t){return r.__awaiter(this,void 0,void 0,(function(){var i,n=this;return r.__generator(this,(function(r){switch(r.label){case 0:return!t||u.equals(this.spatialReference,t)?[2,this]:(i=this.featureAdapter,[4,d.projectMany(this.items.map((function(e){return p.getGeometry(n.geometryType,n.hasZ,n.hasM,i.getGeometry(e))})),this.spatialReference,t)]);case 1:return[2,new e(r.sent().map((function(e,t){return i.cloneWithGeometry(n.items[t],c.convertFromGeometry(e,n.hasZ,n.hasM))})),this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:t,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}}))}))},e.prototype._sortFeatures=function(e,t,r){if(e.length>1&&t&&t.length)for(var i=function(t){var i=t.split(" "),s=i[0],o=n.fieldsIndex.get(s),a=i[1]&&"desc"===i[1].toLowerCase();e.sort((function(e,t){return g(r(e,s,o),r(t,s,o),o,a)}))},n=this,s=0,o=t.reverse();s<o.length;s++)i(o[s])},e.prototype._createFeatureQueryResponse=function(e){var t=this,i=this.items,n=this,s=n.geometryType,o=n.hasM,u=n.hasZ,c=n.objectIdField,l=n.spatialReference,h=e.outFields,d=e.outSR,f=e.quantizationParameters,y=e.resultRecordCount,m=e.resultOffset,_=e.returnZ,g=e.returnM,v=!1;if(null!=y&&null!=m){var x=m+y;v=i.length>x,i=i.slice(m,Math.min(i.length,x))}var I=h&&(h.indexOf("*")>-1?r.__spreadArrays(this.fieldsIndex.fields):h.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:v,features:this._createFeatures(e,i),fields:I,geometryType:s,hasM:o&&g,hasZ:u&&_,objectIdFieldName:c,spatialReference:p.cleanFromGeometryEngine(d||l),transform:f&&a.toQuantizationTransform(f)||null}},e.prototype._createFeatures=function(e,t){var r=new l.default(e,this.featureAdapter,this.fieldsIndex),i=this.hasM,n=this.hasZ,s=e.orderByFields,o=e.quantizationParameters,u=e.returnGeometry,c=e.returnCentroid,h=e.maxAllowableOffset,d=e.returnZ,f=void 0!==d&&d,y=e.returnM,m=n&&f,_=i&&void 0!==y&&y,g=[],v=0;if(u||c){var x=a.toQuantizationTransform(o);if(u&&!c)for(var I=0,b=t;I<b.length;I++)Q=b[I],g[v++]={attributes:r.getAttributes(Q),geometry:p.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(Q),h,x,m,_)};else if(!u&&c)for(var F=0,M=t;F<M.length;F++)Q=M[F],g[v++]={attributes:r.getAttributes(Q),centroid:p.transformCentroid(this,this.featureAdapter.getCentroid(Q,this),x)};else for(var S=0,E=t;S<E.length;S++)Q=E[S],g[v++]={attributes:r.getAttributes(Q),centroid:p.transformCentroid(this,this.featureAdapter.getCentroid(Q,this),x),geometry:p.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(Q),h,x,m,_)}}else for(var T=0,w=t;T<w.length;T++){var Q=w[T],R=r.getAttributes(Q);R&&(g[v++]={attributes:R})}return this._sortFeatures(g,s,(function(e,t,i){return r.getFieldValue(e,t,i)})),g},e.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,s=0,o=e.outStatistics;s<o.length;s++){var a=o[s];if("exceedslimit"===a.statisticType){r=null!=a.maxPointCount?a.maxPointCount:Number.POSITIVE_INFINITY,i=null!=a.maxRecordCount?a.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=a.maxVertexCount?a.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{var u=this.hasZ?this.hasM?4:3:this.hasM?3:2,c=this.featureAdapter;t=this.items.reduce((function(e,t){var r=c.getGeometry(t);return e+(r&&r.coords.length||0)}),0)/u>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=this,r={attributes:{}},n=[],s=new Map,o=new Map,a=new Map,u=new Map,c=new l.default(e,this.featureAdapter,this.fieldsIndex),h=e.outStatistics,d=e.groupByFieldsForStatistics,f=e.having,p=e.orderByFields,y=d&&d.length,m=!!y,_=m&&d[0],g=m&&!this.fieldsIndex.get(_),v=0,x=h;v<x.length;v++){var I=x[v],b=I.outStatisticFieldName,F=I.statisticType,M=I,S="exceedslimit"!==F?I.onStatisticField:void 0,E="percentile_disc"===F||"percentile_cont"===F,T=m&&1===y&&(S===_||g)&&"count"===F;if(m){if(!a.has(S)){for(var w=[],Q=0,R=d;Q<R.length;Q++){var P=R[Q],B=this._getAttributeValues(c,P,s);w.push(B)}a.set(S,this._calculateUniqueValues(w))}var A=a.get(S),j=function(e){var r=A[e],i=r.count,n=r.data,o=r.items,a=r.itemPositions,l=n.join(",");if(!f||c.validateItems(o,f)){var h=u.get(l)||{attributes:{}},p=null;if(T)p=i;else{var y=N._getAttributeValues(c,S,s),m=a.map((function(e){return y[e]}));p=E&&"statisticParameters"in M?N._getPercentileValue(M,m):N._getStatisticValue(M,m)}h.attributes[b]=p,d.forEach((function(e,r){return h.attributes[t.fieldsIndex.get(e)?e:"EXPR_"+(r+1)]=n[r]})),u.set(l,h)}},N=this;for(var G in A)j(G)}else B=this._getAttributeValues(c,S,s),r.attributes[b]=E&&"statisticParameters"in M?this._getPercentileValue(M,B):this._getStatisticValue(M,B,o);n.push({name:b,alias:b,type:"esriFieldTypeDouble"})}var C=m?i.valuesOfMap(u):[r];return this._sortFeatures(C,p,(function(e,t){return e.attributes[t]})),{fields:n,features:C}},e.prototype._getStatisticValue=function(e,t,r){var i=e.onStatisticField,n=e.statisticType,s=r&&r.has(i)?r.get(i):this._calculateStatistics(t);return r&&r.set(i,s),s["var"===n?"variance":n]},e.prototype._getPercentileValue=function(e,t){var i=e.onStatisticField,n=e.statisticParameters,s=e.statisticType,o=n.value,a="desc"===n.orderBy,u=this.fieldsIndex.get(i),c=r.__spreadArrays(t).sort((function(e,t){return g(e,t,u,a)}));return this._calculatePercentile(c,o,"percentile_disc"===s)},e.prototype._getAttributeValues=function(e,t,r){if(r.has(t))return r.get(t);var i=this.fieldsIndex.get(t),n=this.items.map((function(r){return e.getFieldValue(r,t,i)}));return r.set(t,n),n},e.prototype._calculateStatistics=function(e){for(var t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,i=null,n=null,s=null,o=null,a=[],u=0,c=0,l=e;c<l.length;c++)"string"==typeof(p=l[c])?u++:null==p||isNaN(p)||(i+=p,t=Math.min(t,p),r=Math.max(r,p),a.push(p),u++);if(u){n=i/u;for(var h=0,d=0,f=a;d<f.length;d++){var p=f[d];h+=Math.pow(p-n,2)}o=u>1?h/(u-1):0,s=Math.sqrt(o)}else t=null,r=null;return{avg:n,count:u,max:r,min:t,stddev:s,sum:i,variance:o}},e.prototype._calculateUniqueValues=function(e){for(var t={},r=this.items,i=r.length,n=0;n<i;n++){for(var s=r[n],o=[],a=0,u=e;a<u.length;a++){var c=u[a];o.push(c[n])}var l=o.join(",");null==t[l]?t[l]={count:1,data:o,items:[s],itemPositions:[n]}:(t[l].count++,t[l].items.push(s),t[l].itemPositions.push(n))}return t},e.prototype._calculatePercentile=function(e,t,r){if(0===e.length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];var i=(e.length-1)*t,n=Math.floor(i),s=n+1,o=i%1,a=e[n],u=e[s];return s>=e.length||r||"string"==typeof a||"string"==typeof u?a:a*(1-o)+u*o},e}();t.default=v}.apply(null,i))||(e.exports=n)},rfv1:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("zOht"),r("ma1f"),r("BcWh"),r("qsST"),r("LxLY"),r("WRgd"),r("lRq4"),r("nrlZ"),r("+6sX"),r("2xGR"),r("ZGAQ"),r("yLD6")],void 0===(n=function(e,t,r,i,n,s,o,a,u,c,l,h,d,f){Object.defineProperty(t,"__esModule",{value:!0});var p=s.getLogger("esri.layers.graphics.data.FeatureStore"),y=function(){function e(e){this.geometryInfo=e,this._boundsStore=new h.BoundsStore,this._featuresById=new Map,this._markedIds=new Set,this.events=new n,this.featureAdapter=f.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this.geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this.geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this.geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){var e=this;if(!this.numFeatures)return null;var t=u.create(u.NEGATIVE_INFINITY);return this._featuresById.forEach((function(r){var i=e._boundsStore.get(r.objectId);i&&(t[0]=Math.min(i[0],t[0]),t[1]=Math.min(i[1],t[1]),t[2]=Math.max(i[2],t[2]),t[3]=Math.max(i[3],t[3]))})),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeStatistics",{get:function(){var e=0;return this._featuresById.forEach((function(t){t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e),this._emitChanged()},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._add(i)}this._emitChanged()},e.prototype.clear=function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null},e.prototype.removeManyById=function(e){this._boundsStore.invalidateIndex();for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this._featuresById.get(i);n&&this._remove(n)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var s=n[i],o=this._boundsStore.get(s.objectId);o&&t(a.fromRect(r,o))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach((function(t){return e(t)}))},e.prototype.forEachInBounds=function(e,t){var r=this;this._boundsStore.forEachInBounds(e,(function(e){t(r._featuresById.get(e))}))},e.prototype.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()},e.prototype.sweep=function(){var e=this,t=!1;this._featuresById.forEach((function(r,i){e._markedIds.has(i)||(t=!0,e._remove(r))})),this._markedIds.clear(),t&&this._emitChanged()},e.prototype.executeTileQuery=function(e,t,i){return r.__awaiter(this,void 0,void 0,(function(){var n,s,o,a,l,h,f,p,y,m,_,g,v,x;return r.__generator(this,(function(r){return n=i.returnGeometry,s=i.returnCentroid,o=i.returnOutline,a=i.pixelBuffer,l=new Set,h=[],f=a*e.resolution,p=u.pad(e.bounds,f,u.create()),d.createTileFeatures(h,l,this.geometryInfo,this,p,n,s,o,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}),("esriGeometryPoint"===this.geometryType||s)&&(y=c.getInfo(t))&&(m=y.valid,_=m[0],g=m[1],p[0]<_&&(v=u.fromValues(g-f,p[1],g,p[3]),d.createTileFeatures(h,l,this.geometryInfo,this,v,n,s,o,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[g,e.bounds[3]]})),p[2]>g&&(x=u.fromValues(_,p[1],_+f,p[3]),d.createTileFeatures(h,l,this.geometryInfo,this,x,n,s,o,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[_-g+e.bounds[0],e.bounds[3]]}))),h.sort((function(e,t){return e.localId-t.localId})),[2,{features:h,objectIds:l}]}))}))},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e){if(e){var t=e.objectId;if(null!=t){var r,n=this._featuresById.get(t);if(this._markedIds.add(t),n?(e.localId=n.localId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):o.isSome(this.onFeatureAdd)&&this.onFeatureAdd(e),!e.geometry||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=l.getBoundsOptimizedGeometry(r||u.create(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),this._boundsStore.set(t,r),this._featuresById.set(t,e)}else p.error(new i("featurestore:invalid-feature","feature id is missing",{feature:e}))}},e.prototype._remove=function(e){return o.isSome(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e},e}();t.default=y}.apply(null,i))||(e.exports=n)},tZaU:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("qMld")],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._tasks=new Array}return Object.defineProperty(e.prototype,"length",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0}),e.prototype.push=function(e){var t=this;return r.create((function(r,i){return t._tasks.push(new n(r,i,e))}))},e.prototype.unshift=function(e){var t=this;return r.create((function(r,i){return t._tasks.unshift(new n(r,i,e))}))},e.prototype.process=function(){if(0===this._tasks.length)return!1;var e=this._tasks.shift();try{var t=e.callback();t&&"then"in t&&"function"==typeof t.then?t.then(e.resolve,e.reject):e.resolve(t)}catch(t){e.reject(t)}return!0},e.prototype.cancelAll=function(){for(var e=r.createAbortError(),t=0,i=this._tasks;t<i.length;t++)i[t].reject(e);this._tasks.length=0},e}();t.default=i;var n=function(e,t,r){this.resolve=e,this.reject=t,this.callback=r}}.apply(null,i))||(e.exports=n)}}]);