(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/sources/geojson/geojson":"9K5t","esri/core/libs/quickselect/quickselect":"FT4I","esri/core/libs/rbush/rbush":"jEml","esri/layers/graphics/sources/support/sourceUtils":"jJpZ","esri/layers/graphics/sources/geojson/GeoJSONSourceWorker":"vXbj"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{"9K5t":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("zOht"),n("ma1f"),n("/COu"),n("Jvs9")],void 0===(r=function(e,t,n,i,r,a){Object.defineProperty(t,"__esModule",{value:!0});var s={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function o(e){var t,i,r;return n.__generator(this,(function(n){switch(n.label){case 0:switch(e.type){case"Feature":return[3,1];case"FeatureCollection":return[3,3]}return[3,7];case 1:return[4,e];case 2:return n.sent(),[3,7];case 3:t=0,i=e.features,n.label=4;case 4:return t<i.length?(r=i[t])?[4,r]:[3,6]:[3,7];case 5:n.sent(),n.label=6;case 6:return t++,[3,4];case 7:return[2]}}))}function u(e){for(var t=0,n=0;n<e.length;n++){var i=e[n],r=e[(n+1)%e.length];t+=i[0]*r[1]-r[0]*i[1]}return t<=0}function l(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function c(e,t,n){var i=l(t);u(i)?h(e,i,n):f(e,i,n)}function d(e,t,n){var i=l(t);u(i)?f(e,i,n):h(e,i,n)}function h(e,t,n){for(var i=0,r=t;i<r.length;i++)p(e,r[i],n);e.lengths.push(t.length)}function f(e,t,n){for(var i=t.length-1;i>=0;i--)p(e,t[i],n);e.lengths.push(t.length)}function p(e,t,n){var i=t[0],r=t[1],a=t[2];e.coords.push(i,r),n.hasZ&&e.coords.push(a||0)}function m(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}t.validateGeoJSON=function(e){if(!e)throw new i("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new i("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});var t=e.crs;if(t){var n="string"==typeof t?t:"name"===t.type?t.properties.name:null,r=new RegExp(".*(CRS84H?|4326)$","i");if(!n||!r.test(n))throw new i("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}},t.inferLayerProperties=function(e,t){void 0===t&&(t={});for(var i=o(e),r=[],a=new Set,u=new Set,l=!1,c=Number.NEGATIVE_INFINITY,d=null,h=!1,f=void 0,p=t.geometryType,y=void 0===p?null:p,g=!1,v=function(){var e,t,o=i.next(),p=o.value;if(o.done){var v=d&&1===d.length&&d[0]||null;if(v)for(var _=0,b=r;_<b.length;_++){var x=b[_];x.name===v&&(x.type="esriFieldTypeOID")}return{value:{fields:r,geometryType:y,hasZ:l,maxObjectId:Math.max(0,c),objectIdFieldName:v,objectIdFieldType:f,unknownFields:(e=u,t=[],e.forEach((function(e){return t.push(e)})),t)}}}var F=p.geometry,I=p.properties,w=p.id;if(F&&(y||(y=s[F.type]),s[F.type]!==y))return"continue";if(!l){var j=function(e){var t,i,r,a,s,o,u,l,c;return n.__generator(this,(function(d){switch(d.label){case 0:if(!e)return[2,null];switch(e.type){case"Point":return[3,1];case"LineString":case"MultiPoint":return[3,3];case"MultiLineString":case"Polygon":return[3,5];case"MultiPolygon":return[3,10]}return[3,17];case 1:return[4,e.coordinates];case 2:return d.sent(),[3,17];case 3:return[5,n.__values(e.coordinates)];case 4:return d.sent(),[3,17];case 5:t=0,i=e.coordinates,d.label=6;case 6:return t<i.length?(r=i[t],[5,n.__values(r)]):[3,9];case 7:d.sent(),d.label=8;case 8:return t++,[3,6];case 9:return[3,17];case 10:a=0,s=e.coordinates,d.label=11;case 11:if(!(a<s.length))return[3,16];o=s[a],u=0,l=o,d.label=12;case 12:return u<l.length?(c=l[u],[5,n.__values(c)]):[3,15];case 13:d.sent(),d.label=14;case 14:return u++,[3,12];case 15:return a++,[3,11];case 16:return[3,17];case 17:return[2]}}))}(F);l=function(e){for(;;){var t=e.next(),n=t.value;if(t.done)return!1;if(n.length>2)return!0}}(j)}if(h||(h=null!=w)&&"number"==(f=typeof w)&&(d=Object.keys(I).filter((function(e){return I[e]===w}))),h&&"number"===f&&null!=w&&(c=Math.max(c,w),d.length>1?d=d.filter((function(e){return I[e]===w})):1===d.length&&(d=I[d[0]]===w?d:[])),!g&&I){var E=!0;for(var M in I)if(!a.has(M)){var T=I[M];if(null!=T){var S=m(T);"unknown"!==S?(u.delete(M),a.add(M),r.push({name:M,alias:M,type:S})):u.add(M)}else E=!1,u.add(M)}g=E}};;){var _=v();if("object"==typeof _)return _.value}},t.createOptimizedFeatures=function(e,t){return function(e){for(var t=[];;){var n=e.next(),i=n.value;if(n.done)return t;t.push(i)}}(function(e,t){var i,o,u,l,f,m,y,g;return void 0===t&&(t={}),n.__generator(this,(function(n){switch(n.label){case 0:i=t.geometryType,o=t.objectIdFieldName,n.label=1;case 1:return u=e.next(),l=u.value,u.done?[2]:(f=l.geometry,m=l.properties,y=l.id,f&&s[f.type]!==i?[3,1]:(g=m||{},o&&null!=y&&!g[o]&&(g[o]=y),[4,new r.default(f?function(e,t,n){switch(t.type){case"LineString":return function(e,t,n){return h(e,t.coordinates,n),e}(e,t,n);case"MultiLineString":return function(e,t,n){for(var i=0,r=t.coordinates;i<r.length;i++){h(e,r[i],n)}return e}(e,t,n);case"MultiPoint":return function(e,t,n){return h(e,t.coordinates,n),e}(e,t,n);case"MultiPolygon":return function(e,t,n){for(var i=0,r=t.coordinates;i<r.length;i++){var a=r[i];c(e,a[0],n);for(var s=1;s<a.length;s++)d(e,a[s],n)}return e}(e,t,n);case"Point":return function(e,t,n){return p(e,t.coordinates,n),e}(e,t,n);case"Polygon":return function(e,t,n){var i=t.coordinates;c(e,i[0],n);for(var r=1;r<i.length;r++)d(e,i[r],n);return e}(e,t,n)}}(new a.default,f,t):null,g)]));case 2:return n.sent(),[3,1];case 3:return[2]}}))}(o(e),t))}}.apply(null,i))||(e.exports=r)},FT4I:function(e,t,n){var i;void 0===(i=function(){"use strict";function e(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function t(e,t){return e<t?-1:e>t?1:0}return function(n,i,r,a,s){!function t(n,i,r,a,s){for(;a>r;){if(a-r>600){var o=a-r+1,u=i-r+1,l=Math.log(o),c=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*c*(o-c)/o)*(u-o/2<0?-1:1);t(n,i,Math.max(r,Math.floor(i-u*c/o+d)),Math.min(a,Math.floor(i+(o-u)*c/o+d)),s)}var h=n[i],f=r,p=a;for(e(n,r,i),s(n[a],h)>0&&e(n,r,a);f<p;){for(e(n,f,p),f++,p--;s(n[f],h)<0;)f++;for(;s(n[p],h)>0;)p--}0===s(n[r],h)?e(n,r,p):e(n,++p,a),p<=i&&(r=p+1),i<=p&&(a=p-1)}}(n,i,r||0,a||n.length-1,s||t)}}.apply(null,[]))||(e.exports=i)},jEml:function(e,t,n){var i,r;i=[n("FT4I")],void 0===(r=function(e){"use strict";function t(e,n){if(!(this instanceof t))return new t(e,n);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&("function"==typeof n?this.toBBox=n:this._initFormat(n)),this.clear()}function n(e,t,n){if(!n)return t.indexOf(e);for(var i=0;i<t.length;i++)if(n(e,t[i]))return i;return-1}function i(e,t){r(e,0,e.children.length,t,e)}function r(e,t,n,i,r){r||(r=h(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var s,o=t;o<n;o++)s=e.children[o],a(r,e.leaf?i(s):s);return r}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function s(e,t){return e.minX-t.minX}function o(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function l(e){return e.maxX-e.minX+(e.maxY-e.minY)}function c(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function d(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function h(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(t,n,i,r,a){for(var s,o=[n,i];o.length;)(i=o.pop())-(n=o.pop())<=r||(s=n+Math.ceil((i-n)/r/2)*r,e(t,s,n,i,a),o.push(n,s,s,i))}return t.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,n=[],i=this.toBBox;if(!d(e,t))return n;for(var r,a,s,o,u=[];t;){for(r=0,a=t.children.length;r<a;r++)s=t.children[r],d(e,o=t.leaf?i(s):s)&&(t.leaf?n.push(s):c(e,o)?this._all(s,n):u.push(s));t=u.pop()}return n},collides:function(e){var t=this.data,n=this.toBBox;if(!d(e,t))return!1;for(var i,r,a,s,o=[];t;){for(i=0,r=t.children.length;i<r;i++)if(a=t.children[i],d(e,s=t.leaf?n(a):a)){if(t.leaf||c(e,s))return!0;o.push(a)}t=o.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=h([]),this},remove:function(e,t){if(!e)return this;for(var i,r,a,s,o=this.data,u=this.toBBox(e),l=[],d=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],i=d.pop(),s=!0),o.leaf&&-1!==(a=n(e,o.children,t)))return o.children.splice(a,1),l.push(o),this._condense(l),this;s||o.leaf||!c(o,u)?r?(i++,o=r.children[i],s=!1):o=null:(l.push(o),d.push(i),i=0,r=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:s,compareMinY:o,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},_build:function(e,t,n,r){var a,s=n-t+1,o=this._maxEntries;if(s<=o)return i(a=h(e.slice(t,n+1)),this.toBBox),a;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),(a=h([])).leaf=!1,a.height=r;var u,l,c,d,p=Math.ceil(s/o),m=p*Math.ceil(Math.sqrt(o));for(f(e,t,n,m,this.compareMinX),u=t;u<=n;u+=m)for(f(e,u,c=Math.min(u+m-1,n),p,this.compareMinY),l=u;l<=c;l+=p)d=Math.min(l+p-1,c),a.children.push(this._build(e,l,d,r-1));return i(a,this.toBBox),a},_chooseSubtree:function(e,t,n,i){for(var r,a,s,o,l,c,d,h,f,p;i.push(t),!t.leaf&&i.length-1!==n;){for(d=h=1/0,r=0,a=t.children.length;r<a;r++)l=u(s=t.children[r]),f=e,p=s,(c=(Math.max(p.maxX,f.maxX)-Math.min(p.minX,f.minX))*(Math.max(p.maxY,f.maxY)-Math.min(p.minY,f.minY))-l)<h?(h=c,d=l<d?l:d,o=s):c===h&&l<d&&(d=l,o=s);t=o||t.children[0]}return t},_insert:function(e,t,n){var i=this.toBBox,r=n?e:i(e),s=[],o=this._chooseSubtree(r,this.data,t,s);for(o.children.push(e),a(o,r);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(r,s,t)},_split:function(e,t){var n=e[t],r=n.children.length,a=this._minEntries;this._chooseSplitAxis(n,a,r);var s=this._chooseSplitIndex(n,a,r),o=h(n.children.splice(s,n.children.length-s));o.height=n.height,o.leaf=n.leaf,i(n,this.toBBox),i(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(n,o)},_splitRoot:function(e,t){this.data=h([e,t]),this.data.height=e.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,n){var i,a,s,o,l,c,d,h,f,p,m,y,g,v;for(c=d=1/0,i=t;i<=n-t;i++)f=a=r(e,0,i,this.toBBox),p=s=r(e,i,n,this.toBBox),void 0,void 0,void 0,void 0,m=Math.max(f.minX,p.minX),y=Math.max(f.minY,p.minY),g=Math.min(f.maxX,p.maxX),v=Math.min(f.maxY,p.maxY),o=Math.max(0,g-m)*Math.max(0,v-y),l=u(a)+u(s),o<c?(c=o,h=i,d=l<d?l:d):o===c&&l<d&&(d=l,h=i);return h},_chooseSplitAxis:function(e,t,n){var i=e.leaf?this.compareMinX:s,r=e.leaf?this.compareMinY:o;this._allDistMargin(e,t,n,i)<this._allDistMargin(e,t,n,r)&&e.children.sort(i)},_allDistMargin:function(e,t,n,i){e.children.sort(i);var s,o,u=this.toBBox,c=r(e,0,t,u),d=r(e,n-t,n,u),h=l(c)+l(d);for(s=t;s<n-t;s++)o=e.children[s],a(c,e.leaf?u(o):o),h+=l(c);for(s=n-t-1;s>=t;s--)o=e.children[s],a(d,e.leaf?u(o):o),h+=l(d);return h},_adjustParentBBoxes:function(e,t,n){for(var i=n;i>=0;i--)a(t[i],e)},_condense:function(e){for(var t,n=e.length-1;n>=0;n--)0===e[n].children.length?n>0?(t=e[n-1].children).splice(t.indexOf(e[n]),1):this.clear():i(e[n],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},t}.apply(null,i))||(e.exports=r)},jJpZ:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("zOht"),n("nrlZ"),n("k7g7"),n("2Kdy")],void 0===(r=function(e,t,i,r,a){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){this.code=null,this.description=null},o=function(e){this.error=new s,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e};function u(e){return new o(e)}t.createFeatureEditErrorResult=u;var l=function(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e};t.createFeatureEditSuccessResult=function(e){return new l(e)};var c,d=new Set;function h(e,t){var n=t;return"string"==typeof t&&a.isNumericField(e)?n=parseFloat(t):null!=t&&a.isStringField(e)&&"string"!=typeof t&&(n=String(t)),a.sanitizeNullFieldValue(n)}function f(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return c?[2,c]:[4,new Promise((function(e,t){Promise.all([n.e(8),n.e(25)]).then(function(){var t=[n("tNTp")];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))];case 1:return[2,c=e.sent()]}}))}))}t.mixAttributes=function(e,t,n,i,r,s){for(var o in void 0===r&&(r=!1),d.clear(),i){var l=e.get(o);if(l){var c=i[o],f=h(l,c);if(f!==c&&s&&s.push({name:"invalid-value-type",message:"attribute value was converted to match the field type",details:{field:l,originalValue:c,sanitizedValue:f}}),d.add(l.name),l&&(r||l.editable)){var p=a.validateFieldValue(l,f);if(p)return u(a.validationErrorToString(p,l,f));n[l.name]=f}}}for(var m=0,y=t;m<y.length;m++){var g=y[m];if(!d.has(g.name))return u('missing required field "'+g.name+'"')}return null},t.simplify=function(e,t){if(!e||!r.isValid(t))return e;if("rings"in e||"paths"in e){if(!c)throw new TypeError("geometry engine not loaded");return c.simplify(t,e)}return e},t.loadGeometryEngine=f,t.loadGeometryEngineForSimplify=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(n){switch(n.label){case 0:return!r.isValid(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t?[3,2]:[4,f()];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))}}.apply(null,i))||(e.exports=r)},vXbj:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("zOht"),n("zp6E"),n("ma1f"),n("qMld"),n("Lzvl"),n("nrlZ"),n("+6sX"),n("rfv1"),n("Q2Em"),n("ZooB"),n("9K5t"),n("DaHD"),n("jJpZ"),n("I90O"),n("Q3lp"),n("k7g7")],void 0===(r=function(e,t,n,i,r,a,s,o,u,l,c,d,h,f,p,m,y,g){Object.defineProperty(t,"__esModule",{value:!0});var v={hasAttachments:!1,capabilities:"query, editing, create, delete, update",useStandardizedQueries:!0,supportsCoordinatesQuantization:!0,supportsReturningQueryGeometry:!0,advancedQueryCapabilities:{supportsQueryAttachments:!1,supportsStatistics:!0,supportsPercentileStatistics:!0,supportsReturningGeometryCentroid:!0,supportsQueryWithDistance:!0,supportsDistinct:!0,supportsReturningQueryExtent:!0,supportsReturningGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQueryWithResultType:!1,supportsSqlExpression:!0,supportsDisjointSpatialRel:!0}},_=function(){function e(){this._queryEngine=null}return e.prototype.destroy=function(){this._queryEngine&&this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=this._requiredFields=this._fieldsIndex=this._createDefaultAttributes=null},e.prototype.load=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,a,s,p,_,b,x,F,I,w,j,E,M,T,S,q,B,X,O,Y,P,R,D,k,G,J;return n.__generator(this,(function(N){switch(N.label){case 0:return t=[],[4,this._checkProjection(e.spatialReference)];case 1:return N.sent(),a=null,e.url?[4,i(e.url,{responseType:"json"})]:[3,4];case 2:return s=N.sent(),a=s.data,[4,h.validateGeoJSON(a)];case 3:N.sent(),N.label=4;case 4:if(p=h.inferLayerProperties(a,{geometryType:e.geometryType}),_=e.fields||p.fields||[],b=null!=e.hasZ?e.hasZ:p.hasZ,x=p.geometryType,F=e.objectIdField||("number"===p.objectIdFieldType?p.objectIdFieldName:"OBJECTID")||"OBJECTID",I=e.spatialReference||o.WGS84,w=e.timeInfo,!x)throw new r("geojson-layer:missing-property","geometryType not set and couldn't be inferred from the provided features");for("string"===p.objectIdFieldType&&t.push({name:"geojson-layer:unsupported-id-type",message:"Feature ids are of type string and can't be honored."}),_===p.fields&&p.unknownFields.length>0&&t.push({name:"geojson-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:p.unknownFields}}),F&&(j=null,_.some((function(e){return e.name===F&&(j=e,!0)}))?(j.type="esriFieldTypeOID",j.editable=!1,j.nullable=!1):_.unshift({alias:F,name:F,type:"esriFieldTypeOID",editable:!1,nullable:!1})),E=0,M=_;E<M.length;E++){if(null==(B=M[E]).name&&(B.name=B.alias),null==B.alias&&(B.alias=B.name),!B.name)throw new r("geojson-layer:invalid-field-name","field name is missing",{field:B});if(B.name===F&&(B.type="esriFieldTypeOID"),-1===y.kebabDict.jsonValues.indexOf(B.type))throw new r("geojson-layer:invalid-field-type",'invalid type for field "'+B.name+'"',{field:B})}for(T={},this._requiredFields=[],S=0,q=_;S<q.length;S++)"esriFieldTypeOID"!==(B=q[S]).type&&"esriFieldTypeGlobalID"!==B.type&&(B.editable=null==B.editable||!!B.editable,B.nullable=null==B.nullable||!!B.nullable,X=g.getFieldDefaultValue(B),B.nullable||void 0!==X?T[B.name]=X:this._requiredFields.push(B));if(this._fieldsIndex=new m(_),w&&(w.startTimeField&&((O=this._fieldsIndex.get(w.startTimeField))?(w.startTimeField=O.name,O.type="esriFieldTypeDate"):w.startTimeField=null),w.endTimeField&&((Y=this._fieldsIndex.get(w.endTimeField))?(w.endTimeField=Y.name,Y.type="esriFieldTypeDate"):w.endTimeField=null),w.trackIdField&&((P=this._fieldsIndex.get(w.trackIdField))?w.trackIdField=P.name:(w.trackIdField=null,t.push({name:"geojson-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:w}}))),w.startTimeField||w.endTimeField||(t.push({name:"geojson-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:w}}),w=null)),R={warnings:t,featureErrors:[],layerDefinition:n.__assign(n.__assign({},v),{drawingInfo:f.createDrawingInfo(x),templates:f.createDefaultTemplate(T),extent:null,geometryType:x,objectIdField:F,fields:_,hasZ:!!b,timeInfo:w})},this._queryEngine=new d.default({fields:_,geometryType:x,hasM:!1,hasZ:b,objectIdField:F,spatialReference:I,timeInfo:w,featureStore:new l.default({geometryType:x,hasM:!1,hasZ:b})}),this._createDefaultAttributes=f.createDefaultAttributesFunction(T,F),this._nextObjectId=p.maxObjectId+1,D=h.createOptimizedFeatures(a,{geometryType:x,hasZ:b,objectIdFieldName:"number"===p.objectIdFieldType?F:null}),!o.equals(I,o.WGS84))for(k=0,G=D;k<G.length;k++)(J=G[k]).geometry&&(J.geometry=u.convertFromGeometry(c.project(u.convertToGeometry(J.geometry,x,b,!1),o.WGS84,I)));return this._loadInitialFeatures(R,D),[2,R]}}))}))},e.prototype.applyEdits=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,i,r;return n.__generator(this,(function(n){switch(n.label){case 0:return t=this._queryEngine,i=t.spatialReference,r=t.geometryType,[4,a.all([p.loadGeometryEngineForSimplify(i,r),c.checkProjectionSupport(e.adds,i),c.checkProjectionSupport(e.updates,i)])];case 1:return n.sent(),[2,this._applyEdits(e)]}}))}))},e.prototype.queryFeatures=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){return[2,this._queryEngine.executeQuery(e,t.signal)]}))}))},e.prototype.queryFeatureCount=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){return[2,this._queryEngine.executeQueryForCount(e,t.signal)]}))}))},e.prototype.queryObjectIds=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){return[2,this._queryEngine.executeQueryForIds(e,t.signal)]}))}))},e.prototype.queryExtent=function(e,t){return void 0===e&&(e={}),void 0===t&&(t={}),n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){return[2,this._queryEngine.executeQueryForExtent(e,t.signal)]}))}))},e.prototype._loadInitialFeatures=function(e,t){for(var n=this._queryEngine,i=n.featureStore,r=n.objectIdField,a=[],s=0,o=t;s<o.length;s++){var u=o[s],l=this._createDefaultAttributes(),c=p.mixAttributes(this._fieldsIndex,this._requiredFields,l,u.attributes,!0,e.warnings);c?e.featureErrors.push(c):(this._assignObjectId(l,u.attributes,!0),u.attributes=l,u.objectId=l[r],a.push(u))}if(i.addMany(a),e.layerDefinition.extent=this._queryEngine.fullExtent,e.layerDefinition.timeInfo){var d=this._queryEngine.timeExtent,h=d.start,f=d.end;e.layerDefinition.timeInfo.timeExtent=[h,f]}return e},e.prototype._applyEdits=function(e){var t=e.adds,n=e.updates,i=e.deletes,r={addResults:[],deleteResults:[],updateResults:[],uidToObjectId:{}};if(t&&t.length&&this._applyAddEdits(r,t),n&&n.length&&this._applyUpdateEdits(r,n),i&&i.length){for(var a=0,s=i;a<s.length;a++){var o=s[a];r.deleteResults.push(p.createFeatureEditSuccessResult(o))}this._queryEngine.featureStore.removeManyById(i)}return{fullExtent:this._queryEngine.fullExtent,timeExtent:this._queryEngine.timeExtent,featureEditResults:r}},e.prototype._applyAddEdits=function(e,t){for(var n=e.addResults,i=this._queryEngine,r=i.geometryType,a=i.hasM,o=i.hasZ,l=i.objectIdField,d=i.spatialReference,h=i.featureStore,f=[],m=0,y=t;m<y.length;m++){var g=y[m];if(g.geometry&&r!==s.getJsonType(g.geometry))n.push(p.createFeatureEditErrorResult("Incorrect geometry type."));else{var v=this._createDefaultAttributes(),_=p.mixAttributes(this._fieldsIndex,this._requiredFields,v,g.attributes);if(_)n.push(_);else{if(this._assignObjectId(v,g.attributes),g.attributes=v,null!=g.uid){var b=g.attributes[l];e.uidToObjectId[g.uid]=b}g.geometry&&(g.geometry=c.project(p.simplify(g.geometry,d),g.geometry.spatialReference,d)),f.push(g),n.push(p.createFeatureEditSuccessResult(g.attributes[l]))}}}h.addMany(u.convertFromFeatures([],f,r,o,a,l))},e.prototype._applyUpdateEdits=function(e,t){for(var n=e.updateResults,i=this._queryEngine,r=i.geometryType,a=i.hasM,o=i.hasZ,l=i.objectIdField,d=i.spatialReference,h=i.featureStore,f=0,m=t;f<m.length;f++){var y=m[f],g=y.attributes,v=y.geometry,_=g&&g[l];if(null!=_)if(h.has(_)){var b=u.convertToFeature(h.getFeature(_),r,o,a);if(v){if(r!==s.getJsonType(v)){n.push(p.createFeatureEditErrorResult("Incorrect geometry type."));continue}b.geometry=c.project(p.simplify(v,d),v.spatialReference,d)}if(g){var x=p.mixAttributes(this._fieldsIndex,this._requiredFields,b.attributes,g);if(x){n.push(x);continue}}h.add(u.convertFromFeature(b,r,o,a,l)),n.push(p.createFeatureEditSuccessResult(_))}else n.push(p.createFeatureEditErrorResult("Feature with object id "+_+" missing"));else n.push(p.createFeatureEditErrorResult("Identifier field "+l+" missing"))}},e.prototype._assignObjectId=function(e,t,n){void 0===n&&(n=!1);var i=this._queryEngine.objectIdField;n&&isFinite(t[i])?e[i]=t[i]:e[i]=this._nextObjectId++},e.prototype._checkProjection=function(e){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,c.checkProjectionSupport(o.WGS84,e)];case 1:return t.sent(),[3,3];case 2:throw t.sent(),new r("geojson-layer","Projection not supported");case 3:return[2]}}))}))},e}();t.default=_}.apply(null,i))||(e.exports=r)}}]);