(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/layers/features/processors/BaseProcessor":"68TM","esri/views/2d/layers/features/batchUtils":"SCaX","esri/views/2d/layers/features/processors/SymbolProcessor":"dh9Z","esri/layers/support/labelFormatUtils":"y/j/"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{"68TM":function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r("zOht"),r("7MDj"),r("Vx27")],void 0===(o=function(e,t,r,n,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initialize=function(){},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null},enumerable:!0,configurable:!0}),r.__decorate([o.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),r.__decorate([o.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"service",void 0),r.__decorate([o.property({dependsOn:["tileStore.tileScheme.spatialReference"]})],t.prototype,"spatialReference",null),r.__decorate([o.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r.__decorate([o.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r.__decorate([o.subclass("esri.views.2d.layers.features.processors.BaseProcessor")],t)}(n.HandleOwner);t.default=a}.apply(null,n))||(e.exports=o)},SCaX:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r("qMld")],void 0===(o=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.executeForEachAsync=function(e,t,n){var o,a=null!==(o=null==n?void 0:n.batchSize)&&void 0!==o?o:100,i=r.createResolver(),s=0,l=function(){for(var o=Date.now(),u=!1,c=0;!u&&c<500;){try{for(n&&r.throwIfAborted(n);s<Math.min(s+a,e.length);s++)t(e[s])}catch(e){i.reject(e)}c=Date.now()-o,u=s>=e.length}u?i.resolve():setTimeout(l,0)};return l(),i.promise}}.apply(null,n))||(e.exports=o)},dh9Z:function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r("zOht"),r("ma1f"),r("H1tY"),r("qsST"),r("LxLY"),r("qMld"),r("Vx27"),r("Z4y+"),r("5WBt"),r("y/j/"),r("hz/Y"),r("YaB4"),r("WEAo"),r("MtZC"),r("SCaX"),r("rAGl"),r("68TM"),r("lvbU")],void 0===(o=function(e,t,r,n,o,a,i,s,l,u,c,p,f,d,y,h,g,v,_,b){Object.defineProperty(t,"__esModule",{value:!0});var m=a.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor"),w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._symbolToMosaicItemMap=new Map,t._visualSetPromises=new Map,t.type="symbol",t}return r.__extends(t,e),t.prototype.initialize=function(){this._factory=this._createFactory()},t.prototype.destroy=function(){this._visualSetPromises.clear(),this._symbolToMosaicItemMap.clear(),this.notifyChange("updating")},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelingInfo",{get:function(){return!this.config||i.isNone(this.config.labelingInfo)?null:this.config.labelingInfo.map((function(e){return c.fromJSON(e)}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelingInfoFeatureReduction",{get:function(){var e,t;if(!this.config||i.isNone(this.config.featureReduction))return null;var r=this.config.featureReduction;return"cluster"===r.type&&i.isSome(null===(e=r.drawingInfo)||void 0===e?void 0:e.labelingInfo)?null===(t=r.drawingInfo)||void 0===t?void 0:t.labelingInfo.map((function(e){return c.fromJSON(e)})):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasLabels",{get:function(){return!(!this.labelingInfo&&!this.labelingInfoFeatureReduction)},enumerable:!0,configurable:!0}),t.prototype._updateLabelClassInfos=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,t,o,a,l,u=this;return r.__generator(this,(function(c){switch(c.label){case 0:return i.isNone(this.labelingInfo)&&i.isNone(this.labelingInfoFeatureReduction)?[2,s.resolve()]:(e=function(e){return r.__awaiter(u,void 0,void 0,(function(){var t,o,a;return r.__generator(this,(function(r){switch(r.label){case 0:t=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,p.createLabelFunction(e,this.service.fields,this.spatialReference)];case 2:return t=r.sent(),[3,4];case 3:return o=r.sent(),a=e.where?"where":"arcade",m.error(new n("mapview-labeling","Failed to evaluate "+a+" expression",{labelClass:e,error:o})),[3,4];case 4:return[2,t]}}))}))},t=[],i.isSome(this.labelingInfo)&&t.push.apply(t,this.labelingInfo.map((function(t,n){return r.__awaiter(u,void 0,void 0,(function(){var o;return r.__generator(this,(function(r){switch(r.label){case 0:return o=i.andThen,[4,e(t)];case 1:return[2,o.apply(void 0,[r.sent(),function(e){return{type:"feature",labelClass:t,index:n,minScale:t.minScale,maxScale:t.maxScale,builder:e,symbol:t.symbol,symbolJSON:t.symbol.toJSON()}}])]}}))}))}))),i.isSome(this.labelingInfoFeatureReduction)&&(o=t.length,t.push.apply(t,this.labelingInfoFeatureReduction.map((function(t,n){return r.__awaiter(u,void 0,void 0,(function(){var a;return r.__generator(this,(function(r){switch(r.label){case 0:return a=i.andThen,[4,e(t)];case 1:return[2,a.apply(void 0,[r.sent(),function(e){return{type:"aggregate",labelClass:t,index:o+n,minScale:t.minScale,maxScale:t.maxScale,builder:e,symbol:t.symbol,symbolJSON:t.symbol.toJSON()}}])]}}))}))})))),[4,s.all(t)]);case 1:return a=c.sent(),l=a.filter((function(e){return e})),this._labelClassInfos=l,[2]}}))}))},Object.defineProperty(t.prototype,"hydrate",{get:function(){return y.createHydrateFactory(this.service.geometryType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?f.fromJSON(this.config.renderer):(o("esri-2d-debug"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._visualSetPromises.size>0},enumerable:!0,configurable:!0}),t.prototype.update=function(e){return r.__awaiter(this,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return t=this._getMeshHash(),this._set("config",e),[4,this._updateLabelClassInfos()];case 1:return r.sent(),t!==this._getMeshHash()&&(this._factory=this._createFactory()),n=this._labelClassInfos,this._factory.update(n,this.renderer,this.tileStore.tileScheme.tileInfo),[2]}}))}))},t.prototype.onTileData=function(e,t,r){var n=this,o=this._onTileData(e,t,r);return this._visualSetPromises.set(e,o),s.always(o,(function(){return n._cleanPromise(e)})),this.notifyChange("updating"),o},t.prototype.onTileError=function(e,t,r){var n=this,o=r.signal,a={tileKey:e.id,error:t},i=this.remoteClient.invoke("tileRenderer.onTileError",a,{signal:o});return this._visualSetPromises.set(e,i),s.always(i,(function(){return n._cleanPromise(e)})),this.notifyChange("updating"),i},t.prototype._getMeshHash=function(){var e=h.getVVFlags("visualVariables"in this.renderer&&this.renderer.visualVariables||[]);return this.renderer.getMeshHash()+"."+e},t.prototype._createFactory=function(){var e=this,t=this.service,r=t.geometryType,n=t.objectIdField,o={geometryType:r,fields:t.fields,spatialReference:u.fromJSON(this.spatialReference)},a=new d.WGLTemplateStore((function(t,r){return e.remoteClient.invoke("tileRenderer.getMaterialItems",t,r)}),!1);return this._store=a,this._matcher=d.createMatcher(a,o,this.renderer),new d.WGLMeshFactory(r,n,this.renderer,a)},t.prototype._cleanPromise=function(e){this._visualSetPromises.delete(e),this.notifyChange("updating")},t.prototype._onTileData=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,u,c,p,f,d,y,h;return r.__generator(this,(function(r){switch(r.label){case 0:o=t.addOrUpdate,a=t.remove,s=t.clear,l=this._processFeatures(e,o,t.transformParams,n),u=n.signal,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,l];case 2:return c=r.sent(),p=i.andThen(c,(function(e){return e.message})),f=i.andThen(c,(function(e){return e.transferList}))||[],d={addOrUpdate:p,remove:a,clear:s},y={transferList:i.unwrap(f)||[],signal:u},[2,this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:d},y)];case 3:return h=r.sent(),this._handleError(e,h,n),[3,4];case 4:return[2]}}))}))},t.prototype._processFeatures=function(e,t,n,o){return r.__awaiter(this,void 0,void 0,(function(){var a,i,l,u,c;return r.__generator(this,(function(r){switch(r.label){case 0:return t&&t.length?(a=this._factory,i={viewingMode:"",scale:e.scale},[4,this._matcher]):[2,null];case 1:return l=r.sent(),[4,this._getLabelInfos(e,t,n)];case 2:return u=r.sent(),[4,a.analyze(t,l,n,i)];case 3:return c=r.sent(),s.throwIfAborted(o),[2,this._writeFeatures(e,c,n,u,a,o)]}}))}))},t.prototype._writeFeatures=function(e,t,a,s,l,u){return r.__awaiter(this,void 0,void 0,(function(){var c,p,f;return r.__generator(this,(function(d){switch(d.label){case 0:return c=l.createMeshData(t.length),p={viewingMode:"",scale:e.scale},f=r.__assign(r.__assign({},u),{batchSize:200}),[4,g.executeForEachAsync(t,(function(t){try{var r=i.isSome(s)?s.get(t.localId):null;l.write(c,t,a,p,e.level,r)}catch(e){o("esri-2d-debug")&&m.error(new n("mapview-mesh-factory","Failed to write feature",{error:e,feature:t}))}}),f)];case 1:return d.sent(),[2,this._encodeDisplayData(c)]}}))}))},t.prototype._encodeDisplayData=function(e){var t={},r=new Array;return e.encode(t,r),{message:t,transferList:r}},t.prototype._handleError=function(e,t,r){if(!s.isAbortError(t)){var n={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",n,{signal:r.signal})}},t.prototype._getLabelClassInfosForScale=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,this._labelClassInfos.filter((function(t){var r=t.minScale,n=t.maxScale;return(!r||r>=e||0===r)&&(!n||n<=e||0===n)}))]}))}))},t.prototype._shouldDiscard=function(e,t){switch(this.service.geometryType){case"esriGeometryPoint":var r=t.geometry,n=r.x,o=r.y;return e.checkOverlap(n,o);case"esriGeometryPolygon":var a=t.centroid;return n=a.x,o=a.y,e.checkOverlap(n,o);default:return!1}},t.prototype._markUsed=function(e,t){switch(this.service.geometryType){case"esriGeometryPoint":var r=t.geometry,n=r.x,o=r.y;return e.markUsed(n,o);case"esriGeometryPolygon":var a=t.centroid;return n=a.x,o=a.y,e.markUsed(n,o)}},t.prototype._getLabelInfos=function(e,t,n){return r.__awaiter(this,void 0,void 0,(function(){var o,a,s,l,c,p,f,y,h;return r.__generator(this,(function(g){switch(g.label){case 0:return this.hasLabels&&t&&0!==t.length?[4,this._getLabelClassInfosForScale(e.scale)]:[2,null];case 1:if(0===(o=g.sent()).length)return[2,null];for(a=new Map,s=new d.CollisionGrid(d.definitions.COLLISION_EARLY_REJECT_BUCKET_SIZE),l=function(e){var t=e.localId;if(c._shouldDiscard(s,e))return a.has(t)||a.set(t,null),"continue";for(var l=function(e,t){for(var r=new Array(e),n=0;n<r.length;n++)r[n]=null;return r}(o.length),p=!1,f=function(a){var s,f=o[a],y=f.type,h=f.index,g=f.builder,_=f.symbolJSON;if((b.isAggregateId(t)&&e.attributes.cluster_count>1?"aggregate":"feature")!==y)return"continue";if(!n)return m.error("mapview-labeling","Tried to evaluate geometry expression but no transformation found"),{value:void 0};var w=n.transform,S=n.hasZ,O=n.hasM,I=c.hydrate(e.geometry,w,S,O),x=r.__assign(r.__assign({},e),{geometry:I});I.spatialReference=u.fromJSON(c.spatialReference),s=x;var F=g.evaluate(s);if(i.isNone(F)||""===F)return"continue";var T=d.bidiText(F),M=T[0],P=T[1];p=!0,c._store.getMosaicItem(_,!1,v.codepoints(M)).then((function(e){l[h]={glyphs:e.glyphMosaicItems,rtl:P,classIndex:h}}))},y=0;y<o.length;y++){var h=f(y);if("object"==typeof h)return h}a.set(t,l),p&&c._markUsed(s,e)},c=this,p=0,f=t;p<f.length;p++)if(y=f[p],"object"==typeof(h=l(y)))return[2,h.value];return[2,a]}}))}))},r.__decorate([l.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),r.__decorate([l.property()],t.prototype,"config",void 0),r.__decorate([l.property({dependsOn:["config"]})],t.prototype,"labelingInfo",null),r.__decorate([l.property({dependsOn:["config"]})],t.prototype,"labelingInfoFeatureReduction",null),r.__decorate([l.property({dependsOn:["labelingInfo","labelingInfoFeatureReduction"]})],t.prototype,"hasLabels",null),r.__decorate([l.property({dependsOn:["service"]})],t.prototype,"hydrate",null),r.__decorate([l.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r.__decorate([l.property({readOnly:!0})],t.prototype,"updating",null),r.__decorate([l.subclass("esri.views.2d.layers.features.processors.SymbolProcessor")],t)}(_.default);t.default=w}.apply(null,n))||(e.exports=o)},"y/j/":function(e,t,r){var n,o;n=[r.dj.c(e.i),t,r("zOht"),r("ma1f"),r("qsST"),r("hCwm"),r("ICCr"),r("I90O"),r("k7g7"),r("L924"),r("sCbS"),r("2Kdy")],void 0===(o=function(e,t,n,o,a,i,s,l,u,c,p){Object.defineProperty(t,"__esModule",{value:!0});var f=a.getLogger("esri.layers.support.labelFormatUtils"),d={type:"simple",evaluate:function(){return null}};function y(e,t,r,n){var o=u.getField(n,e);if(!o)return t;if(null==r[o.name])return"";var a=o.domain;if(a)if("codedValue"===a.type||"coded-value"===a.type)for(var l=r[o.name],c=0,p=a.codedValues;c<p.length;c++){var f=p[c];if(f.code===l)return f.name}else if("range"===a.type){var d=+r[o.name],y="range"in a?a.range[0]:a.minValue,h="range"in a?a.range[1]:a.maxValue;if(y<=d&&d<=h)return a.name}var g=r[o.name];return"date"===o.type||"esriFieldTypeDate"===o.type?g=i.formatDate(g,i.convertDateFormatToIntlOptions("short-date")):u.isNumericField(o)&&(g=s.formatNumber(+g)),g||""}t.createLabelFunction=function(e,t,a){return n.__awaiter(this,void 0,void 0,(function(){var i,s,u,h,g,v,_,b;return n.__generator(this,(function(n){switch(n.label){case 0:return e&&e.symbol?(i=e.where,s=e.getLabelExpression(),i?[4,new Promise((function(e,t){r.e(6).then(function(){var t=[r("1eyA")];e.apply(null,t)}.bind(this)).catch(t.bind(this))}))]:[3,2]):[2,d];case 1:return h=n.sent(),[3,3];case 2:h=null,n.label=3;case 3:return u=h,"arcade"!==s.type?[3,5]:[4,p.createLabelExpression(s.expression,a,t)];case 4:return v=n.sent(),g={type:"arcade",evaluate:function(e){try{var t=v.evaluate({$feature:v.repurposeFeature(e)});if(null!=t)return t.toString()}catch(t){f.error(new o("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:e,expression:s}))}return null},needsHydrationToEvaluate:function(){return null==c.getSingleFieldArcadeExpression(s.expression)}},[3,6];case 5:g={type:"simple",evaluate:function(e){var r=e&&e.attributes;return r?s.expression.replace(/{[^}]*}/g,(function(e){return y(e.slice(1,-1),e,r,t)})):null}},n.label=6;case 6:if(i){try{_=u.WhereClause.create(i,new l(t))}catch(e){return[2,d]}b=g.evaluate,g.evaluate=function(e){return _.testFeature(e)?b(e):null}}return[2,g]}}))}))},t.formatField=y}.apply(null,n))||(e.exports=o)}}]);