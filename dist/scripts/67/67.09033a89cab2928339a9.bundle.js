(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/layers/features/tileRenderers/SymbolTileRenderer":"IBem","esri/views/2d/engine/webgl/WGLFeatureView":"KYAh","esri/views/webgl/BufferObject":"QFi0","esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":"Rt18","esri/views/2d/engine/webgl/rendererInfoUtils":"tPaR"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{IBem:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("9opi"),i("qKT0"),i("2Atf"),i("OXG3"),i("Gtr7"),i("qsST"),i("LxLY"),i("jBNx"),i("Vx27"),i("lRq4"),i("7Kvv"),i("3568"),i("tPaR"),i("G59t"),i("KYAh"),i("AP+j"),i("Rt18")],void 0===(n=function(e,t,i,r,n,a,o,s,l,u,f,p,c,h,d,y,v,g,b){function _(e){for(var t in e.diff){var i=e.diff[t];if("partial"===i.type&&_(i))return!0;if("complete"===i.type&&"valueExpression"===t)return!0}return!1}function w(e){for(var t in e.diff){var i=e.diff[t];if("collection"===i.type){if(0!==i.changed.length||0!==i.added.length||0!==i.removed.length)return!0}else{if("visualVariables"!==t&&"authoringInfo"!==t)return!0;if("visualVariables"===t){if("complete"===i.type)return!0;if(_(i))return!0}}}return!1}function V(e){if(!("visualVariables"in e&&e.visualVariables&&e.visualVariables.length))return e;var t=e.clone(),i=t.visualVariables.map(function(e){return m(e)?T(e):e});return t.visualVariables=i,t}function m(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function T(e){return e.stops=R(e.type,e.stops),e}function x(e,t,i){return(1-i)*e+i*t}function I(e,t){for(var i=t[0],r=t.slice(1),n=r.pop(),a=r[0].value,o=r[r.length-1].value,s=(o-a)/S,l=[],f=a;f<o;f+=s){for(var p=0;f>=r[p].value;)p++;var c=r[p],h=t[p-1],d=f-h.value,y=c.value===h.value?1:d/(c.value-h.value);if("color"===e){var v=r[p],g=t[p-1],b=v.color.clone();b.r=x(g.color.r,b.r,y),b.g=x(g.color.g,b.g,y),b.b=x(g.color.b,b.b,y),b.a=x(g.color.a,b.a,y),l.push({value:f,color:b,label:v.label})}else if("size"===e){var _=r[p],w=t[p-1],V=u.toPt(_.size),m=x(u.toPt(w.size),V,y);l.push({value:f,size:m,label:_.label})}else{var T=r[p],I=x(t[p-1].opacity,T.opacity,y);l.push({value:f,opacity:I,label:T.label})}}return[i].concat(l,[n])}function F(e){for(var t=e[0],i=e.slice(1),r=i.pop();i.length>S;){for(var n=0,a=0,o=1;o<i.length;o++){var s=i[o-1],l=i[o],u=Math.abs(l.value-s.value);u>a&&(a=u,n=o)}i.splice(n,1)}return[t].concat(i,[r])}function R(e,t){return t.length<=O?t:(L.warn("Found "+t.length+" Visual Variable stops, but MapView only supports "+O+". Displayed stops will be simplified."),t.length>2*O?I(e,t):F(t))}Object.defineProperty(t,"__esModule",{value:!0});var L=s.getLogger("esri.views.2d.layers.features.tileRenderer.SymbolTileRenderer"),O=8,S=O-2,C=function(e){function t(t){return e.call(this)||this}return i(t,e),t.prototype.createTile=function(e){var t=p.create();return this.tileInfoView.getTileBounds(t,e),new g(e,t)},t.prototype.disposeTile=function(e){this.featuresView.removeChild(e)},t.prototype.updateHighlight=function(){this.featuresView.updateHighlight()},t.prototype.hitTest=function(e,t){return this.featuresView.hitTest(e,t)},t.prototype.supportsRenderer=function(e){return null!=e&&-1!==["simple","class-breaks","unique-value","dot-density"].indexOf(e.type)},t.prototype.getProcessorConfiguration=function(){var e=this.layer,t=e.definitionExpression,i=e.gdbVersion,r=e.historicMoment,n=e.labelingInfo,a=this.layerView.availableFields,o=V(this.layer.renderer);return{type:"symbol",renderer:o.toJSON(),devicePixelRatio:window.devicePixelRatio||1,definitionExpression:t,availableFields:a,gdbVersion:i,historicMoment:r&&r.getTime(),labelingInfo:n&&n.map(function(e){return e.toJSON()}),hasGeometryExpr:h.hasGeometryOperations(o)||n&&n.some(function(e){return h.hasGeometryOperations(e)})}},t.prototype.needsProcessorReconfiguration=function(e){var t=this.wouldClear(e),i=this.configuration;return this.configuration=e,t||i.definitionExpression!==e.definitionExpression},t.prototype.wouldClear=function(e){var t=this.configuration;if(!t||t.availableFields.join()!==e.availableFields.join()||c.diff(t.labelingInfo,e.labelingInfo))return!0;var i=this.configuration&&a.fromJSON(this.configuration.renderer)||null,r=e&&a.fromJSON(e.renderer)||null;if(r&&"dot-density"===r.type)return(i&&i.getControllerHash())!==(r&&r.getControllerHash());var n=c.diff(i,r);if(l.isNone(n))return!1;switch(n.type){case"complete":return!0;case"partial":if(w(n))return!0;if(n.diff.visualVariables){var o=this.featuresView.visualVariablesInfo,s=this.tileInfoView.tileInfo.spatialReference,u={fields:this.layer.fields.map(function(e){return e.toJSON()})},f=d.getNormalizedRenderer(r,s,u),p=y.convertVisualVariables(f.visualVariables).vvFields;return!!c.diff(o.vvFields,p)}}},t.prototype.clear=function(){this.featuresView.disposeWebGLResources()},t.prototype.applyConfiguration=function(e){var t=a.fromJSON(e.renderer),i={fields:this.layer.fields.map(function(e){return e.toJSON()})},r=d.getNormalizedRenderer(t,this.tileInfoView.tileInfo.spatialReference,i);this.configuration=e,this.featuresView.visualVariablesInfo=y.convertVisualVariables(r.visualVariables)},t.prototype.install=function(e){var t=new v.default({tileInfoView:this.tileInfoView,layer:this.layer,layerView:this.layerView});this.featuresView=t,e.addChild(t)},t.prototype.uninstall=function(e){e.removeChild(this.featuresView),this.featuresView=null},t.prototype.onTileData=function(e){var t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileData(t,e.data)},t.prototype.onTileError=function(e){var t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileError(t)},t.prototype.getMaterialItems=function(e){return this.featuresView.getMaterialItems(e)},t.prototype.setFilterFlag=function(e,t,i,r){this.featuresView.setFilterFlag(e,t,i,r)},r([f.subclass()],t)}(f.declared(o,b.default));t.default=C}.apply(null,r))||(e.exports=n)},KYAh:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("2Atf"),i("xhoE"),i("LxLY"),i("qMld"),i("qMld"),i("oxlp"),i("1Mg+"),i("rYkQ"),i("JNkf"),i("apbF"),i("oDRR")],void 0===(n=function(e,t,i,r,n,a,o,s,l,u,f,p,c){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(t){var i=e.call(this)||this;return i._rendererInfo=new c,i._pointToCallbacks=new Map,i._invisibleFeatures=new Set,i._displayWidth=0,i._displayHeight=0,i.layer=null,i.tileInfoView=t.tileInfoView,i.layer=t.layer,i._layerView=t.layerView,i}return r(t,e),t.prototype.dispose=function(){this.removeAllChildren();for(var e=0,t=this.children;e<t.length;e++)t[e].dispose()},t.prototype.disposeWebGLResources=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].clear()},t.prototype.displayWidth=function(){return this._displayWidth},Object.defineProperty(t.prototype,"displayHeight",{get:function(){return this._displayHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visualVariablesInfo",{get:function(){return this._visualVariablesInfo},set:function(e){this._visualVariablesInfo=e,this.requestRender()},enumerable:!0,configurable:!0}),t.prototype.hitTest=function(e,t){var i=this,r=[e,t];return a.create(function(e,t){i._pointToCallbacks.set(r,{resolve:e,reject:t}),i.requestRender()},function(){i._pointToCallbacks.has(r)&&i._pointToCallbacks.delete(r)})},t.prototype.setFilterFlag=function(e,t,i,r){if(void 0===r&&(r=!0),r){t||(t=[]),i||(i=[]);for(var n=this._invisibleFeatures,a=0,o=t;a<o.length;a++){var s=o[a];n.has(s)&&n.delete(s)}for(var l=0,u=i;l<u.length;l++){var f=u[l];n.add(f)}for(var p=0,c=this.children;p<c.length;p++)(y=c[p]).data&&y.setFilterFlag(0,t,i)}else for(var h=0,d=this.children;h<d.length;h++){var y;(y=d[h]).data&&y.setFilterFlag(e,t,i)}},t.prototype.whenAttached=function(){var e=this;return this.attached?a.resolve():a.create(function(t){return e.once("attached",function(){return t()})})},t.prototype.getMaterialItems=function(e){var t=this;return this.whenAttached().then(function(){var i=e;if(t.stage&&i&&0!==i.length){for(var r=[],n=t.stage.painter.textureManager,a=0,s=i;a<s.length;a++){var l=s[a];r.push(n.rasterizeItem(l.symbol,l.glyphIds))}return o.all(r).then(function(t){return t.map(function(t,i){return{id:e[i].id,mosaicItem:t}})})}})},t.prototype.onTileData=function(e,t){var r=!(!this.layer.labelingInfo||!this.layer.labelingInfo.length),n=t.addOrUpdate&&u.decode(t.addOrUpdate),a=i({},t,{addOrUpdate:n});e.setData(a,r,this.layer.labelsVisible),e.resetVisibility(this._invisibleFeatures),e.buildHLList(this._layerView.highlightIDs),this.contains(e)||this.addChild(e),this.requestRender(),this._layerView&&this._layerView.view.labelManager.requestUpdate()},t.prototype.onTileError=function(e){e.clear(),e.buildHLList(this._layerView.highlightIDs),this.contains(e)||this.addChild(e),this.requestRender()},t.prototype.addChild=function(t){var i=e.prototype.addChild.call(this,t);return this.layer.labelingInfo&&this._layerView&&this._layerView.view.labelManager.addTile(this.layer.uid,t),this._buildHLList(),i},t.prototype.removeChild=function(t){var i=e.prototype.removeChild.call(this,t);return this.layer.labelingInfo&&this._layerView&&this._layerView.view.labelManager.removeTile(this.layer.uid,t.key.id),this._buildHLList(),i},t.prototype.renderChildren=function(e){var t=this,r=this.stage.painter;this._updateTilesTransform(e.state,this.tileInfoView.getClosestInfoForScale(e.state.scale).level),this._rendererInfo.update(e.state,this.layer.renderer,this._visualVariablesInfo.vvRanges,this._layerView.effects);var a=this.tileInfoView.getClosestInfoForScale(e.state.scale).level,o=this.tileInfoView.tileInfo.scaleToZoom(e.state.scale),s=i({},e,{rendererInfo:this._rendererInfo,requiredLevel:a,displayLevel:o,context:this.stage.context,painter:this.stage.painter});this.sortChildren(function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col});var l=s.drawPhase;if(l&(f.WGLDrawPhase.LABEL|f.WGLDrawPhase.LABEL_ALPHA)){var u=this.layer;if(!(u.labelsVisible&&u.labelingInfo&&0<u.labelingInfo.length))return;this._updateTilesTransform(s.state,s.requiredLevel)}r.draw(s,this.children,l,this._painterOptions),0<this._layerView.highlightIDs.size&&r.highlight(s,this.children),this._pointToCallbacks.forEach(function(e,i){e.resolve(t._hitTest(s,i[0],i[1]))}),this._pointToCallbacks.clear(),this._layerView.effects&&this._layerView.effects.some(function(e){return n.isSome(e)&&!e.done})&&this.requestRender()},t.prototype.updateHighlight=function(){this._buildHLList()},t.prototype._hitTest=function(e,t,i){var r=this.stage,n=r.painter,a=r.context,o=e.requiredLevel,l=[0,0];e.state.toMap(l,[t,i]);var u=e.state.clone(),c=u.viewpoint.clone();return c.targetGeometry=new s(l[0],l[1],e.state.spatialReference),u.viewpoint=c,u.size=[p.C_HITTEST_SEARCH_SIZE,p.C_HITTEST_SEARCH_SIZE],this._updateTilesTransform(u,o),n.hitTest({globalOpacity:1,painter:n,context:a,drawPhase:f.WGLDrawPhase.HITTEST,pixelRatio:e.pixelRatio,displayLevel:e.displayLevel,rendererInfo:this._rendererInfo,requiredLevel:o,state:u,stationary:e.stationary},this.children)},t.prototype._updateTilesTransform=function(e,t){for(var i=0,r=this.children;i<r.length;i++){var n=r[i],a=this.tileInfoView.tileInfo.lods[n.key.level].resolution,o=a/(e.resolution*e.pixelRatio);n.setTransform(e,o),n.setLabelTransform(e,a)}},t.prototype._buildHLList=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].buildHLList(this._layerView.highlightIDs);this.requestRender()},t}(l.Container);t.default=h}.apply(null,r))||(e.exports=n)},QFi0:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("H1tY"),i("rusB")],void 0===(n=function(e,t,i,r){return function(){function e(t,r,n,a,o){this._context=null,this._glName=null,this._bufferType=void 0,this._usage=35044,this._size=-1,this._indexType=void 0,this._context=t,this._bufferType=r,this._usage=n,this._id=e._nextId++,this._glName=this._context.gl.createBuffer(),i("esri-webgl-debug")&&t.instanceCounter.incrementCount(1),a&&this.setData(a,o)}return e.createIndex=function(t,i,r,n){return new e(t,34963,i,r,n)},e.createVertex=function(t,i,r){return new e(t,34962,i,r)},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),i("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(1),this._context=null)},e.prototype.setData=function(e,t){if(e){if("number"==typeof e){if(34963===this._bufferType&&t)switch(this._indexType=t,this._size=e,t){case 5123:e*=2;break;case 5125:e*=4}}else{var i=e.byteLength;r.isUint16Array(e)&&(i/=2,this._indexType=5123),r.isUint32Array(e)&&(i/=4,this._indexType=5125),this._size=i}var n=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this),this._context.gl.bufferData(this._bufferType,e,this._usage),this._context.bindVAO(n)}},e.prototype.setSubData=function(e,t,i,n){if(void 0===t&&(t=0),void 0===i&&(i=0),e){t<0||this._size;var a=t,o=i,s=n,l=e.byteLength;r.isUint16Array(e)&&(l/=2,a*=2,o*=2,s*=2),r.isUint32Array(e)&&(l/=4,a*=4,o*=4,s*=4),void 0===n&&(n=l-1),this._size;var u=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);var f=this._context.gl,p=ArrayBuffer.isView(e)?e.buffer:e;f.bufferSubData(this._bufferType,a,p.slice(o,s)),this._context.bindVAO(u)}},e._nextId=0,e}()}.apply(null,r))||(e.exports=n)},Rt18:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("9opi"),i("qKT0"),i("Gtr7"),i("7MDj"),i("Vx27")],void 0===(n=function(e,t,i,r,n,a,o){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var i=e.call(this)||this;return i.tiles=new Map,i.layer=null,i}return i(t,e),t.prototype.destroy=function(){this.tiles.clear(),this.layer=this.layerView=this.tileInfoView=this.configuration=this.tiles=null},Object.defineProperty(t.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!0,configurable:!0}),t.prototype.acquireTile=function(e){var t=this,i=this.createTile(e);return i.once("isReady",function(){return t.notifyChange("updating")}),this.tiles.set(e.id,i),i},t.prototype.forEachTile=function(e){this.tiles.forEach(e)},t.prototype.releaseTile=function(e){this.tiles.delete(e.key.id),this.disposeTile(e)},t.prototype.isUpdating=function(){var e=!0;return this.tiles.forEach(function(t){e=e&&t.isReady}),!e},t.prototype.requestUpdate=function(){this.layerView.requestUpdate()},r([o.property()],t.prototype,"configuration",void 0),r([o.property()],t.prototype,"layer",void 0),r([o.property()],t.prototype,"layerView",void 0),r([o.property()],t.prototype,"tileInfoView",void 0),r([o.property()],t.prototype,"updating",null),r([o.subclass()],t)}(o.declared(n,a));t.default=s}.apply(null,r))||(e.exports=n)},tPaR:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i("2Atf"),i("jZlN"),i("T8lH"),i("3568"),i("JNkf"),i("G59t")],void 0===(n=function(e,t,i,r,n,a,o,s){Object.defineProperty(t,"__esModule",{value:!0});var l=new n;function u(e,t,i){if(!e)return null;var n=0,o={},s=e.clone(),u=s.visualVariables,f=null;if("simple"!==s.type&&"dot-density"!==s.type){var p=s.field,c=s.valueExpression;if(!p&&c){var h="$$fake"+n++,d=a.createFunction(c);o[h]=function(e,r){return l.repurposeFromGraphicLikeObject(e.geometry,e.attributes,i),a.executeFunction(d,{vars:{$feature:l,$view:a.getViewInfo(r)},spatialReference:t})},s.field=h,s.valueExpression=null,f=function(e,t){return t.attributes[h]=o[h](t),e.valueExpression?e.getSymbol(r.fromJSON(t)):e.getSymbol(t)}}}return u&&(s.visualVariables=u.map(function(e){var r="size"===e.type&&e.valueExpression&&"$view.scale"===e.valueExpression;if(e.normalizationField){var s=e.field,u=e.normalizationField,f="$$fake"+n++;return o[f]=function(e,t){return e.attributes[s]/e.attributes[u]},(p=e.clone()).field=f,p.normalizationField=null,p}if(!e.valueExpression||r)return e;var p,c=e.valueExpression,h=(f="$$fake"+n++,a.createFunction(c));return o[f]=function(e,r){return l.repurposeFromGraphicLikeObject(e.geometry,e.attributes,i),a.executeFunction(h,{vars:{$feature:l,$view:a.getViewInfo(r)},spatialReference:t})},(p=e.clone()).field=f,p.valueExpression=null,p})),{renderer:s,normalizingFunctions:o,getSymbolFunction:f}}t.createRendererInfo=function(e,t,i){var r=u(e,t,i)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null},n=r&&r.normalizingFunctions,a=r&&r.getSymbolFunction;e=r&&r.renderer||e;var o=s.convertVisualVariables(e.visualVariables);return{renderer:e,vvFields:o.vvFields,vvRanges:o.vvRanges,getValue:function(e,t){var i=n[t];return i?i(e):e.attributes[t]},getSymbol:function(e){return a?a(this.renderer,e):this.renderer.getSymbol?this.renderer.getSymbol.call(this.renderer,e):null}}},t.getNormalizedRenderer=function(e,t,i){var r=u(e,t,i)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null};return r&&r.renderer||e},t.getSymbol=function(e,t){return e.getSymbol(t)},t.isRendererWebGLCompatible=function(e){if(!e)return!1;if(-1===["simple","class-breaks","unique-value","heatmap"].indexOf(e.type))return!1;if("visualVariables"in e&&e.visualVariables)for(var t=0,i=e.visualVariables;t<i.length;t++){var r=i[t];switch(r.type){case"color":case"opacity":if(r.stops&&8<r.stops.length)return!1;break;case"size":if(s.getTypeOfSizeVisualVariable(r)===o.WGLVVFlag.SIZE_FIELD_STOPS&&r.stops&&6<r.stops.length)return!1}}return!0}}.apply(null,r))||(e.exports=n)}}]);