(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/support/ExportImageParameters":"VTDq","esri/layers/MapImageLayer":"d+WR","esri/geometry/support/scaleUtils":"qDpW"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{VTDq:function(e,r,t){var a,n;a=[t.dj.c(e.i),r,t("2Atf"),t("9opi"),t("qKT0"),t("Gtr7"),t("Vx27"),t("IlDW")],void 0===(n=function(e,r,t,a,n,i,o,s){Object.defineProperty(r,"__esModule",{value:!0});var l={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},p=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.scale=0,r}return a(r,e),Object.defineProperty(r.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var e=this.visibleSublayers.map(function(e){return e.toExportImageJSON()});return e.length?JSON.stringify(e):null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hasDynamicLayers",{get:function(){return s.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layer",{set:function(e){var r=this;this._get("layer")!==e&&(this._set("layer",e),this._layerHandles&&(this._layerHandles.forEach(function(e){return e.remove()}),this._layerHandles.length=0),e&&(this._layerHandles=[e.allSublayers.on("change",function(){return r.notifyChange("visibleSublayers")}),e.on("sublayer-update",function(e){return r.notifyChange(l[e.propertyName])})]))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layers",{get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map(function(e){return e.id}).join(","):"show:-1":null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"layerDefs",{get:function(){var e=this.visibleSublayers.filter(function(e){return null!=e.definitionExpression});return e.length?JSON.stringify(e.reduce(function(e,r){return e[r.id]=r.definitionExpression,e},{})):null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"version",{get:function(){return(this._get("version")||0)+1},set:function(e){this._set("version",e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"visibleSublayers",{get:function(){var e=this,r=this.layer.sublayers,t=[],a=function(r){var n=e.scale,i=0===n,o=0===r.minScale||n<=r.minScale,s=0===r.maxScale||n>=r.maxScale;r.visible&&(i||o&&s)&&(r.sublayers?r.sublayers.forEach(a):t.unshift(r))};return r&&r.forEach(a),t},enumerable:!0,configurable:!0}),r.prototype.toJSON=function(){var e=this.layer,r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r=t({},r,{layers:this.layers,layerDefs:this.layerDefs}),r},n([o.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],r.prototype,"dynamicLayers",null),n([o.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],r.prototype,"hasDynamicLayers",null),n([o.property()],r.prototype,"layer",null),n([o.property({readOnly:!0,dependsOn:["visibleSublayers"]})],r.prototype,"layers",null),n([o.property({readOnly:!0,dependsOn:["visibleSublayers"]})],r.prototype,"layerDefs",null),n([o.property({type:Number})],r.prototype,"scale",void 0),n([o.property({dependsOn:["layers","layerDefs","dynamicLayers","layer.dpi","layer.imageFormat","layer.imageTransparency","layer.gdbVersion"]})],r.prototype,"version",null),n([o.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],r.prototype,"visibleSublayers",null),n([o.subclass("esri.layers.mixins.ExportImageParameters")],r)}(o.declared(i));r.ExportImageParameters=p}.apply(null,a))||(e.exports=n)},"d+WR":function(e,r,t){var a,n;a=[t.dj.c(e.i),r,t("2Atf"),t("9opi"),t("qKT0"),t("dxjN"),t("zp6E"),t("ma1f"),t("qMld"),t("Vx27"),t("N7S/"),t("qDpW"),t("0RER"),t("G/Nd"),t("FEX1"),t("QJ8R"),t("WaJo"),t("OXmT"),t("Blfj"),t("EtsK"),t("VTDq")],void 0===(n=function(e,r,a,n,i,o,s,l,p,y,u,c,d,m,h,f,g,b,v,S,x){return function(e){function r(r,t){var a=e.call(this)||this;return a.alwaysRefetch=!1,a.dpi=96,a.gdbVersion=null,a.imageFormat="png24",a.imageMaxHeight=2048,a.imageMaxWidth=2048,a.imageTransparency=!0,a.labelsVisible=!1,a.operationalLayerType="ArcGISMapServiceLayer",a.resourceInfo=null,a.sublayers=null,a.type="map-image",a.url=null,a}return n(r,e),r.prototype.normalizeCtorArgs=function(e,r){return"string"==typeof e?a({url:e},r):e},r.prototype.load=function(){var e=this;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]}).then(function(){return e._fetchService()})),this.when()},r.prototype.readImageFormat=function(e,r){var t=r.supportedImageFormatTypes;return t&&t.indexOf("PNG32")>-1?"png32":"png24"},r.prototype.createExportImageParameters=function(e,r,t,n){var i=n&&n.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());var o=new x.ExportImageParameters({layer:this,scale:c.getScale({extent:e,width:r})*i}),s=o.toJSON();o.layer=null,o.destroy();var l=!n||!n.rotation||this.version<10.3?{}:{rotation:-n.rotation},p=e&&e.spatialReference,y=p.wkid||JSON.stringify(p.toJSON());s.dpi*=i;var u={};if(n&&n.timeExtent){var d=n.timeExtent.toJSON(),m=d.start,h=d.end;m&&h&&m===h?u.time=""+m:null==m&&null==h||(u.time=(null==m?"null":m)+","+(null==h?"null":h))}return a({bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:y,imageSR:y,size:r+","+t},s,l,u)},r.prototype.fetchImage=function(e,r,t,n){var i={responseType:"image"};n&&n.timestamp&&(i.query={_ts:n.timestamp});var o,y,u=this.getImageUrl(e,r,t,n);if(u)y=p.when(u).then(function(e){return s(o=e,i)});else{o=this.parsedUrl.path+"/export";var c=a({},this.parsedUrl.query,this.createExportImageParameters(e,r,t,n),{f:"image",_ts:this.alwaysRefetch?Date.now():null});if(null!=c.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return p.reject(new l("mapimagelayer:dynamiclayer-not-supported","service "+this.url+" doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.",{query:c}));i.query?i.query=a({},c,i.query):i.query=c,y=s(o,i)}return y.then(function(e){return e.data}).catch(function(e){if(e&&"cancel"===e.dojoType)throw e;throw new l("mapimagelayer:image-fetch-error","Unable to load image: "+o,{error:e})})},r.prototype.getImageUrl=function(e,r,t,a){return null},r.prototype.importLayerViewModule=function(e){switch(e.type){case"2d":return p.create(function(e){return Promise.all([t.e(18),t.e(71)]).then(function(){var r=[t("bT5A")];e.apply(null,r)}.bind(this)).catch(t.oe)});case"3d":return p.create(function(e){return Promise.all([t.e(0),t.e(1),t.e(7),t.e(16),t.e(65)]).then(function(){var r=[t("QYP8")];e.apply(null,r)}.bind(this)).catch(t.oe)})}},r.prototype._fetchService=function(){var e=this;return p.resolve().then(function(){return e.resourceInfo?{ssl:!1,data:e.resourceInfo}:s(e.parsedUrl.path,{query:a({f:"json"},e.parsedUrl.query)})}).then(function(r){r.ssl&&(e.url=e.url.replace(/^http:/i,"https:")),e.read(r.data,{origin:"service",url:e.parsedUrl})})},i([y.property()],r.prototype,"alwaysRefetch",void 0),i([y.property()],r.prototype,"dpi",void 0),i([y.property()],r.prototype,"gdbVersion",void 0),i([y.property()],r.prototype,"imageFormat",void 0),i([y.reader("imageFormat",["supportedImageFormatTypes"])],r.prototype,"readImageFormat",null),i([y.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],r.prototype,"imageMaxHeight",void 0),i([y.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],r.prototype,"imageMaxWidth",void 0),i([y.property()],r.prototype,"imageTransparency",void 0),i([y.property({json:{read:!1,write:!1}})],r.prototype,"labelsVisible",void 0),i([y.property({type:["ArcGISMapServiceLayer"]})],r.prototype,"operationalLayerType",void 0),i([y.property()],r.prototype,"resourceInfo",void 0),i([y.property()],r.prototype,"sublayers",void 0),i([y.property({type:["show","hide","hide-children"]})],r.prototype,"listMode",void 0),i([y.property({json:{read:!1},readOnly:!0,value:"map-image"})],r.prototype,"type",void 0),i([y.property(S.url)],r.prototype,"url",void 0),i([o(0,y.cast(u))],r.prototype,"getImageUrl",null),i([y.subclass("esri.layers.MapImageLayer")],r)}(y.declared(d,m,v.default,h,f,g,b))}.apply(null,a))||(e.exports=n)},qDpW:function(e,r,t){var a,n;a=[t.dj.c(e.i),r,t("0J3i"),t("8uEs")],void 0===(n=function(e,r,t,a){function n(e,r){return e/(a.getMetersPerUnitForSR(r)*a.inchesPerMeter*t.screenDPI)}Object.defineProperty(r,"__esModule",{value:!0}),r.getScale=function(e,r){var n=r||e.extent,i=e.width,o=a.getMetersPerUnit(n&&n.spatialReference);return n&&i?n.width/i*(o||a.decDegToMeters)*a.inchesPerMeter*t.screenDPI:0},r.getResolutionForScale=n,r.getExtentForScale=function(e,r){var t=e.extent,a=e.width,i=n(r,t.spatialReference);return t.clone().expand(i*a/t.width)}}.apply(null,a))||(e.exports=n)}}]);