(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/layers/WMTSLayerView3D":"5BPv","esri/core/HandleOwner":"7MDj","esri/views/layers/RefreshableLayerView":"7XLS","esri/core/requireUtils":"ADZV","esri/layers/ElevationLayer":"GAgw","esri/layers/support/LercWorker":"S+mV"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[64,30],{"5BPv":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("ma1f"),r("eIBl"),r("qsST"),r("qMld"),r("8MXS"),r("Vx27"),r("T4YA"),r("7XLS")],void 0===(i=function(e,t,r,n,i,o,a,l,s,p,u,c){var d=a.getLogger("esri.views.3d.layers.WMTSLayerView3d");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new o,t}return r(t,e),t.prototype.initialize=function(){var e=this,t=s.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeDone").then(function(){var t=function(){return new i("layerview:no-compatible-tiling-scheme","None of the tiling schemes supported by the service are compatible with the scene.")};if(!e.view.basemapTerrain.tilingSchemeLocked)return l.reject(t());var r,n=e.view.basemapTerrain.tilingScheme,o=e.layer.activeLayer;if(o&&o.tileMatrixSet){var a=(r=o.tileMatrixSet).tileInfo,s=e._getTileInfoSupportError(a,r.fullExtent)||e._getTileInfoCompatibilityError(a,n);if(s)return l.reject(s)}else{if(!(r=e._getCompatibleTileMatrixSet()))return l.reject(t());o.tileMatrixSetId=r.id}e.tileInfo=r.tileInfo,e.fullExtent=r.fullExtent,e._updateMinMaxDataLevel()});this.addResolvingPromise(t),this.when(function(){return e._initialized()})},t.prototype.destroy=function(){this._handles.removeAll()},t.prototype.refresh=function(){this.emit("data-changed")},t.prototype.canResume=function(){if(!this.inherited(arguments))return!1;var e=this.layer.activeLayer.tileMatrixSet;return e&&!this._getTileInfoError(e.tileInfo,e.fullExtent)},t.prototype.doRefresh=function(){this.suspended||this.emit("data-changed")},t.prototype._initialized=function(){var e=this;this._handles.add(this.watch("layer.activeLayer.styleId, tileMatrixSet",function(){return e.refresh()})),this._handles.add(this.layer.watch("activeLayer",function(t){var r=t.tileMatrixSet;if(r){var n=e._getTileInfoError(r.tileInfo,r.fullExtent);n&&(d.error("The selected tile matrix set is not compatible with the view",n),r=null)}else(r=e._getCompatibleTileMatrixSet())?t.tileMatrixSetId=r.id:d.error("The layer does not provide a tiling scheme that is compatible with the view");e.notifyChange("suspended"),e.canResume()&&e.refresh()}))},t.prototype._getCompatibleTileMatrixSet=function(){var e=this;return this.layer.activeLayer.tileMatrixSets.find(function(t){var r=t.tileInfo;return!e._getTileInfoError(r,t.fullExtent)})},t.prototype._getTileInfoError=function(e,t){return this._getTileInfoSupportError(e,t)||this._getTileInfoCompatibilityError(e,this.view.basemapTerrain.tilingScheme)},n([p.property({aliasOf:"layer.fullExtent"})],t.prototype,"fullExtent",void 0),n([p.property()],t.prototype,"layer",void 0),n([p.property({dependsOn:["layer.activeLayer"]})],t.prototype,"suspended",void 0),n([p.property({aliasOf:"layer.tileInfo"})],t.prototype,"tileInfo",void 0),n([p.subclass("esri.views.3d.layers.WMTSLayerView3D")],t)}(p.declared(u,c))}.apply(null,n))||(e.exports=i)},"7MDj":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("eIBl"),r("Vx27")],void 0===(i=function(e,t,r,n,i,o,a){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=e.call(this)||this;return n.handles=new o,n}return r(t,e),t.prototype.destroy=function(){this.handles.destroy()},n([a.property({readOnly:!0})],t.prototype,"handles",void 0),n([a.subclass("esri.core.HandleOwner")],t)}(a.declared(i))}.apply(null,n))||(e.exports=i)},"7XLS":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("Vx27")],void 0===(i=function(e,t,r,n,i,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshTimestamp=null,t}return r(t,e),t.prototype.refresh=function(e){void 0===e&&(e=Date.now()),this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh()},n([o.property()],t.prototype,"layer",void 0),n([o.aliasOf("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),n([o.property({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),n([o.subclass("esri.layers.mixins.RefreshableLayerView")],t)}(o.declared(i))}.apply(null,n))||(e.exports=i)},ADZV:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qMld")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.when=function e(t,n){return Array.isArray(n)?r.create(function(e){t(n,function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e(t)})}):e(t,[n]).then(function(e){return e[0]})},t.getAbsMid=function(e,t,r){return t.toAbsMid?t.toAbsMid(e):r.id.replace(/\/[^\/]*$/gi,"/")+e}}.apply(null,n))||(e.exports=i)},GAgw:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("9opi"),r("qKT0"),r("gyO4"),r("eMAb"),r("zp6E"),r("ma1f"),r("qMld"),r("Vx27"),r("MFVu"),r("0RER"),r("WhPF"),r("FEX1"),r("QJ8R"),r("EtsK"),r("S+mV")],void 0===(i=function(e,t,n,i,o,a,l,s,p,u,c,d,y,h,f,v,m,w){return function(e){function t(t){var r=e.call(this)||this;return r.copyright=null,r.heightModelInfo=null,r.path=null,r.opacity=1,r.operationalLayerType="ArcGISTiledElevationServiceLayer",r.type="elevation",r.url=null,r.version=null,r._lercWorker=w.acquireInstance(),r}return i(t,e),t.prototype.normalizeCtorArgs=function(e,t){return"string"==typeof e?n({url:e},t):e},t.prototype.destroy=function(){w.releaseInstance(this._lercWorker),this._lercWorker=null},Object.defineProperty(t.prototype,"minScale",{get:function(){},set:function(e){this.constructed&&l.deprecated(this.declaredClass+".minScale support has been removed.","","4.5")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxScale",{get:function(){},set:function(e){this.constructed&&l.deprecated(this.declaredClass+".maxScale support has been removed.","","4.5")},enumerable:!0,configurable:!0}),t.prototype.readVersion=function(e,t){var r=t.currentVersion;return r||(r=9.3),r},t.prototype.load=function(){var e=this;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(e){for(var t=0;t<e.typeKeywords.length;t++)if("elevation 3d layer"===e.typeKeywords[t].toLowerCase())return!0;throw new p("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}}).then(function(){return e._fetchImageService()},function(){return e._fetchImageService()})),this.when()},t.prototype.fetchTile=function(e,t,r,n){var i=this;return void 0===n&&(n=0),this.load().then(function(){return i._fetchTileAvailability(e,t,r)}).then(function(){return s(i.getTileUrl(e,t,r),{responseType:"array-buffer"})}).then(function(e){return i._lercWorker.decode(e.data,{noDataValue:n,returnFileInfo:!0})}).then(function(e){return{values:e.pixelData,width:e.width,height:e.height,maxZError:e.fileInfo.maxZError,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue}})},t.prototype.getTileUrl=function(e,t,r){var i=!this.tilemapCache&&this.supportsBlankTile,o=a.objectToQuery(n({},this.parsedUrl.query,{blankTile:!i&&null}));return this.parsedUrl.path+"/tile/"+e+"/"+t+"/"+r+(o?"?"+o:"")},t.prototype.queryElevation=function(e,t){var r=this;return this._importElevationQuery().then(function(n){return(new n.ElevationQuery).query(r,e,t)})},t.prototype.createElevationSampler=function(e,t){var r=this;return this._importElevationQuery().then(function(n){return(new n.ElevationQuery).createSampler(r,e,t)})},t.prototype.importLayerViewModule=function(e){switch(e.type){case"2d":return u.reject(new p("elevation-layer:view-not-supported","ElevationLayer is only supported in 3D"));case"3d":return u.create(function(e){return Promise.all([r.e(0),r.e(6),r.e(9),r.e(72)]).then(function(){var t=[r("ujdx")];e.apply(null,t)}.bind(this)).catch(r.oe)})}},t.prototype._fetchTileAvailability=function(e,t,r){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,t,r):u.resolve("unknown")},t.prototype._fetchImageService=function(){var e=this;return u.resolve().then(function(){if(e.resourceInfo)return e.resourceInfo;var t={query:n({f:"json"},e.parsedUrl.query),responseType:"json"};return s(e.parsedUrl.path,t)}).then(function(t){t.ssl&&(e.url=e.url.replace(/^http:/i,"https:")),e.read(t.data,{origin:"service",url:e.parsedUrl})})},t.prototype._importElevationQuery=function(){return u.create(function(e){r.e(34).then(function(){var t=[r("T16p")];e.apply(null,t)}.bind(this)).catch(r.oe)})},o([c.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),o([c.property({readOnly:!0,type:d})],t.prototype,"heightModelInfo",void 0),o([c.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],t.prototype,"path",void 0),o([c.property({type:["show","hide"]})],t.prototype,"listMode",void 0),o([c.property({json:{read:!1,write:!1}})],t.prototype,"minScale",null),o([c.property({json:{read:!1,write:!1}})],t.prototype,"maxScale",null),o([c.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"opacity",void 0),o([c.property({type:["ArcGISTiledElevationServiceLayer"]})],t.prototype,"operationalLayerType",void 0),o([c.property()],t.prototype,"resourceInfo",void 0),o([c.property({json:{read:!1},value:"elevation",readOnly:!0})],t.prototype,"type",void 0),o([c.property(m.url)],t.prototype,"url",void 0),o([c.property()],t.prototype,"version",void 0),o([c.reader("version",["currentVersion"])],t.prototype,"readVersion",null),o([c.subclass("esri.layers.ElevationLayer")],t)}(c.declared(y,h,f,v))}.apply(null,n))||(e.exports=i)},"S+mV":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("qMld"),r("ADZV"),r("8V7H"),r.dj.m(e)],void 0===(i=function(e,t,n,i,o,a,l){function s(){return i.create(function(e){r.e(89).then(function(){var t=[r("Rc7o")];e.apply(null,t)}.bind(this)).catch(r.oe)})}Object.defineProperty(t,"__esModule",{value:!0});var p=function(){function e(){}return e.prototype._decode=function(e){return s().then(function(t){var r=(0,t.decode)(e.buffer,e.options);return{result:r,transferList:[r.pixelData.buffer]}})},e}(),u=function(t){function r(r){var n=t.call(this)||this;return n.scheduler=r,n._thread=void 0,a.open(o.getAbsMid("./LercWorker",e,l),{strategy:"dedicated",scheduler:r}).then(function(e){void 0===n._thread?n._thread=e:e.close()}),n}return n(r,t),r.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},r.prototype.decode=function(e,t){return e&&0!==e.byteLength?this._thread?this._thread.invoke("_decode",{buffer:e,options:t},{transferList:[e]}):s().then(function(r){return(0,r.decode)(e,t)}):i.resolve(null)},r}(p),c=new Map;t.acquireInstance=function(e){var t=c.get(e);return t||(t={instance:new u(e),ref:0},c.set(e,t)),++t.ref,t.instance},t.releaseInstance=function(e){if(null!=e){var t=e.scheduler,r=c.get(t);r&&--r.ref<=0&&(r.instance.destroy(),c.delete(t))}},t.default=function(){return new p}}.apply(null,n))||(e.exports=i)}}]);