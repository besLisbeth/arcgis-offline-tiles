(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/webgl-engine/shaders/EdgeRendererPrograms":"+YS2","esri/views/3d/webgl-engine/lib/geometryDataUtils":"+nCE","esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":"+wMf","esri/views/3d/webgl-engine/lib/glUtil3D":"/Bau","esri/views/webgl/FramebufferObject":"/f24","esri/views/3d/webgl-engine/lib/ModelContentType":"05NA","esri/views/3d/webgl-engine/shaders/OffscreenPrograms":"1CCn","esri/views/3d/webgl-engine/lib/depthRangeUtils":"1bVs","esri/views/3d/webgl-engine/lib/doublePrecisionUtils":"1f+t","esri/core/TimeProfiler":"23eD","esri/views/3d/webgl-engine/lib/ProgramRepository":"2A3h","esri/views/3d/support/buffer/InterleavedLayout":"2B1V","esri/views/3d/webgl-engine/lib/SliceHelper":"2CPm","esri/views/3d/webgl-engine/lighting/SphericalHarmonics":"2Mej","esri/views/3d/webgl-engine/lib/HighlightHelper":"2f4f","esri/views/3d/webgl-engine/shaders/MiscPrograms":"31XB","esri/views/webgl/capabilities/load":"37NJ","esri/views/webgl/RenderingContext":"3KT0","esri/views/3d/webgl-engine/lib/BoundingInfo":"3RHn","esri/core/libs/gl-matrix-2/factories/vec4f32":"3gjc","esri/views/3d/webgl-engine/lib/GeometryUtil":"4ziW","esri/views/3d/webgl-engine/lib/RenderPluginManager":"6wId","esri/views/layers/RefreshableLayerView":"7XLS","esri/views/webgl/capabilities/isWebGL2Context":"7laH","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":"8fHt","esri/views/3d/webgl-engine/lib/GLTextureRep":"8nmy","esri/views/3d/webgl-engine/lib/intersectorUtils":"9DjX","esri/views/3d/webgl-engine/lib/GLMaterialTexture":"9FJH","esri/views/3d/support/buffer/utils/vec2":"9o4r","esri/views/3d/webgl-engine/lib/depthRange":"9pvv","esri/views/3d/webgl-engine/lib/IntervalUtilities":"AASg","esri/views/3d/webgl-engine/lib/GeometryData":"AgDx","esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":"B294","esri/views/3d/support/meshProcessing":"BIt0","esri/views/3d/webgl-engine/lib/edgeRendering/util":"BtPY","esri/views/3d/webgl-engine/shaders/DefaultPrograms":"C2Ab","esri/views/3d/webgl-engine/lib/GeometryRecord":"Cvn+","esri/views/3d/webgl-engine/lib/InstanceBufferData":"D8s1","esri/views/3d/webgl-engine/lib/webgl-debug":"DXwx","esri/views/3d/support/debugFlags":"Dk48","esri/views/webgl/capabilities/Instancing":"DlJW","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":"E/UE","esri/views/3d/webgl-engine/lib/DefaultTextureUnits":"EiD/","esri/views/3d/webgl-engine/lib/DDSUtil":"EyQ4","esri/views/3d/webgl-engine/lib/Renderer":"FM7k","esri/views/3d/webgl-engine/shaders/ColorPrograms":"FMAd","esri/views/3d/webgl-engine/lib/Material":"FNtW","esri/views/3d/layers/DynamicLayerView3D":"FRff","esri/views/3d/webgl-engine/lib/GLMaterialRep":"FU3N","esri/views/3d/support/buffer/workerHelper":"Fsr7","esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":"Geb9","esri/views/3d/support/buffer/types":"GntT","esri/views/3d/support/buffer/utils/vec4":"Gz8v","esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":"HSGS","esri/views/3d/webgl-engine/parts/Model":"I67D","esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":"IfBv","esri/views/3d/webgl-engine/parts/View":"JUgm","esri/views/3d/webgl-engine/lib/LongVectorMath":"KPBO","esri/views/3d/webgl-engine/lib/SSAOHelper":"Lb4W","esri/views/3d/support/buffer/internals/Vec4":"MI3s","esri/views/3d/support/buffer/glUtil":"MzcX","esri/views/3d/layers/support/overlayImageUtils":"OZYi","esri/views/3d/layers/LayerView3D":"Ondo","esri/views/3d/webgl-engine/materials/renderers/utils":"PwS/","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":"Q55v","esri/views/3d/webgl-engine/lighting/SceneLighting":"QDiq","esri/views/3d/webgl-engine/parts/Viewport":"QJWI","esri/views/3d/webgl-engine/lib/DrapedRenderer":"QWGo","esri/views/3d/webgl-engine/materials/RibbonLineMaterial":"RC9r","esri/views/3d/webgl-engine/lib/RenderContext":"Raj5","esri/views/webgl/Renderbuffer":"Rrc3","esri/views/3d/webgl-engine/lib/Camera":"RsYQ","esri/views/webgl/InstanceCounter":"TCFx","esri/views/3d/webgl-engine/materials/DefaultMaterial":"TP2F","esri/views/3d/webgl-engine/shaders/SSAOPrograms":"TZB2","esri/views/3d/webgl-engine/shaders/globalOptions":"Teen","esri/views/3d/support/buffer/utils":"TqPN","esri/views/webgl/capabilities/DisjointTimerQuery":"U6iw","esri/views/3d/webgl-engine/lib/LocalOriginManager":"UD5A","esri/views/3d/webgl-engine/shaders/RibbonLinePrograms":"UtTF","esri/views/3d/webgl-engine/shaders/sources/shaderRepository":"VVgn","esri/views/3d/support/buffer/BufferView":"VfPl","esri/views/3d/webgl-engine/lib/IdGen":"W0kZ","esri/views/3d/support/buffer/utils/vec3":"W5Zm","esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":"W7eI","esri/views/layers/LayerView":"WsO6","esri/views/3d/webgl-engine/lib/Float32ArrayList":"XCS5","esri/views/3d/webgl-engine/lib/ModelDirtySet":"Xih7","esri/views/3d/webgl-engine/shaders/HUDPrograms":"Yr/n","esri/views/3d/webgl-engine/lib/Object3D":"ZJC8","esri/views/3d/webgl-engine/lib/Layer":"ZO6V","esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":"ZeO9","esri/views/webgl/Texture":"Zp3t","esri/views/3d/support/buffer/internals/Vec2":"bduU","esri/views/3d/webgl-engine/lib/RenderGeometry":"cjy9","esri/views/3d/support/buffer/utils/scalar":"cza4","esri/views/3d/support/buffer/utils/mat4":"dB/a","esri/views/webgl/Profiling":"deO7","esri/views/3d/webgl-engine/lib/ShadowMap":"doLD","esri/views/3d/webgl-engine/lib/localOrigin":"eHCP","esri/views/3d/support/buffer/utils/mat3":"f3AO","esri/views/3d/webgl-engine/lib/ManagingDisposable":"fHD9","esri/views/3d/support/buffer/internals/Mat4":"fHyw","esri/views/3d/webgl-engine/materials/renderers/HardwareInstancedRenderer":"fPnv","esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":"ff/U","esri/views/3d/support/buffer/internals/Vec3":"hQPx","esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":"hkmr","esri/views/3d/webgl-engine/materials/internal/bufferWriters":"hnAi","esri/views/3d/webgl-engine/shaders/HighlightPrograms":"i9pz","esri/core/libs/gl-matrix-2/vec4f32":"j2SP","esri/views/3d/webgl-engine/lib/SmaaRenderPass":"jlKI","esri/geometry/support/meshUtils/deduplicate":"jmRc","esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":"kfwU","esri/views/3d/webgl-engine/Stage":"krVM","esri/views/3d/webgl-engine/lib/Octree":"mYMs","esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":"nBma","esri/views/3d/webgl-engine/materials/ColorMaterial":"o5p5","esri/views/3d/layers/support/projectExtentUtils":"ocJ8","esri/views/3d/webgl-engine/lib/localOriginHelper":"p23x","esri/views/3d/webgl-engine/lib/RenderTargetHelper":"pBV3","esri/views/3d/support/buffer/internals/Mat3":"pIuP","esri/views/3d/webgl-engine/materials/renderers/Instance":"pbva","esri/views/3d/webgl-engine/lib/tracer":"pgjK","esri/views/3d/webgl-engine/lib/edgeRendering/strokes":"qC//","esri/views/3d/webgl-engine/lighting/Lightsources":"qUb7","esri/views/webgl/renderState":"qbr3","esri/core/libs/gl-matrix-2/types/mat4":"qvwY","esri/views/3d/webgl-engine/materials/internal/MaterialUtil":"s6rJ","esri/views/3d/webgl-engine/lib/GLMaterial":"tUyH","esri/views/3d/webgl-engine/materials/renderers/InstancedRenderer":"uNX8","esri/views/webgl/enums":"uwSd","esri/views/webgl/capabilities/VertexArrayObjects":"veTl","esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":"wKWA","esri/views/3d/support/imageUtils":"weRx","esri/views/3d/webgl-engine/materials/HUDMaterial":"xFEL","esri/views/3d/webgl-engine/lib/FxaaRenderPass":"xgKb","esri/views/3d/webgl-engine/lib/HighlightUtils":"xsp2","esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":"yBJI","esri/views/3d/webgl-engine/lib/Texture":"yqrJ","esri/views/3d/webgl-engine/lib/Geometry":"ys4y","esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":"zZCp","esri/views/3d/webgl-engine/shaders/sources/resolver":"zbgD","esri/views/3d/support/buffer/internals/Scalar":"zlCF"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"+YS2":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("zbgD"),n("U+8K")],void 0===(r=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return i.glslifyDefineMap({MODE:{value:e.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:e.silhouette,ANTIALIASING:e.antialiasing,SLICE:e.slice})};t.program={name:"edges",shaders:function(e){return{vertexShader:r(e)+n.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:r(e)+n.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}}.apply(null,i))||(e.exports=r)},"+nCE":function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=1,i=null;t.generateDefaultIndexArray=function(e){if(e>n||null==i){for(;e>n;)n*=2;i=new Uint32Array(n);for(var t=0;t<n;t++)i[t]=t}return new Uint32Array(i.buffer,0,e)};var r=0;t.getNewId=function(){return r++}}.apply(null,i))||(e.exports=r)},"+wMf":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("wPX3"),n("AzkI")],void 0===(r=function(e,t,n,i){function r(e){return Math.abs(e*e*e)}function o(e,t,n,i){void 0===i&&(i=d);var o=n.parameters,a=n.paddingPixelsOverride;return i.scale=Math.min(o.divisor/(t-o.offset),1),i.factor=r(e),i.minPixelSize=o.minPixelSize,i.paddingPixels=a,i}function a(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function s(e,t){return Math.max(i.lerp(e*t.scale,e,t.factor),a(e,t))}function l(e,t,n){var i=o(e,t,n);return i.minPixelSize=0,i.paddingPixels=0,s(1,i)}Object.defineProperty(t,"__esModule",{value:!0}),t.getSettings=function(e){return new c(e,t.defaultDescription)},t.getLabelSettings=function(e){var n=t.defaultDescription.curvatureDependent,i=t.defaultDescription.scaleStart,r=t.defaultDescription.scaleFallOffRange;return new c(e,{curvatureDependent:{min:{curvature:n.min.curvature,tiltAngle:n.min.tiltAngle,scaleFallOffFactor:u.curvatureDependent.min.scaleFallOffFactor},max:{curvature:n.max.curvature,tiltAngle:n.max.tiltAngle,scaleFallOffFactor:u.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:r,minPixelSize:u.minPixelSize})},t.perspectiveFactor=r,t.scaleFactor=o,t.applyScaleFactor=s,t.applyScaleFactorVec2=function(e,t,n){void 0===n&&(n=[0,0]);var r=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return n[0]=i.lerp(e[0]*r,e[0],t.factor),n[1]=i.lerp(e[1]*r,e[1],t.factor),n},t.precomputeScale=l,t.precomputeScaleFactor=function(e,t,n,i){return i.scale=l(e,t,n),i.factor=0,i.minPixelSize=n.parameters.minPixelSize,i.paddingPixels=n.paddingPixelsOverride,i},t.applyPrecomputedScaleFactorVec2=function(e,t,n){void 0===n&&(n=[0,0]);var i=Math.min(Math.max(t.scale,a(e[1],t)/e[1]),1);return n[0]=e[0]*i,n[1]=e[1]*i,n},t.scale=function(e,t,n,i){return s(e,o(t,n,i))};var c=function(){function e(e,t,n,i){void 0===n&&(n={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}),this.viewingMode=e,this.description=t,this.parameters=n,this._paddingPixelsOverride=i,"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}return Object.defineProperty(e.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0}),e.prototype.update=function(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this.calculateParameters(e,this.parameters),0))},e.prototype.overridePadding=function(t){return t!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.parameters,t):this},e.prototype.calculateParameters=function(e,t){var n=this.description,i=n.scaleStart,r=n.scaleFallOffRange,o=n.minPixelSize,a=e.fovY,s=e.distance,l=this.calculateCurvatureDependentParameters(e),c=this.coverageCompensation(e,l),u=l.tiltAngle,d=l.scaleFallOffFactor,f=Math.sin(u)*s,p=.5*Math.PI-u-a*(.5-i*c),h=f/Math.cos(p),v=p+a*r*c,g=(h-d*(f/Math.cos(v)))/(1-d);return t.camera.fovY=e.fovY,t.camera.distance=e.distance,t.offset=g,t.divisor=h-g,t.minPixelSize=o,t},e.prototype.calculateCurvatureDependentParametersLocal=function(e,t){return void 0===t&&(t=f),t.tiltAngle=this.description.curvatureDependent.min.tiltAngle,t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,t},e.prototype.calculateCurvatureDependentParametersGlobal=function(e,t){void 0===t&&(t=f);var r=this.description.curvatureDependent,o=1+e.distance/n.earthRadius,a=Math.sqrt(o*o-1),s=[r.min.curvature,r.max.curvature],l=s[0],c=s[1],u=i.clamp((a-l)/(c-l),0,1),d=[r.min,r.max],p=d[0],h=d[1];return t.tiltAngle=i.lerp(p.tiltAngle,h.tiltAngle,u),t.scaleFallOffFactor=i.lerp(p.scaleFallOffFactor,h.scaleFallOffFactor,u),t},e.prototype.surfaceCoverageCompensationLocal=function(e,t){return(e.fovY-t.tiltAngle)/e.fovY},e.prototype.surfaceCoverageCompensationGlobal=function(e,t){var i=n.earthRadius*n.earthRadius,r=t.tiltAngle+.5*Math.PI,o=e.fovY,a=e.distance,s=a*a+i-2*Math.cos(r)*a*n.earthRadius,l=Math.sqrt(s),c=Math.sqrt(s-i);return(Math.acos(c/l)-Math.asin(n.earthRadius/(l/Math.sin(r)))+.5*o)/o},e}();t.defaultDescription={curvatureDependent:{min:{curvature:i.deg2rad(10),tiltAngle:i.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:i.deg2rad(70),tiltAngle:i.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var u={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};t.copyParameters=function(e,t){return t.camera.distance=e.camera.distance,t.camera.fovY=e.camera.fovY,t.divisor=e.divisor,t.offset=e.offset,t.minPixelSize=e.minPixelSize,t};var d={scale:0,factor:0,minPixelSize:0,paddingPixels:0},f={tiltAngle:0,scaleFallOffFactor:0}}.apply(null,i))||(e.exports=r)},"/Bau":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("ff/U"),n("zZCp"),n("QFi0"),n("Zp3t"),n("z2+Q")],void 0===(r=function(e,t,n,i,r,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuadVAO=function(e,t){void 0===t&&(t=i.Pos2);var o=null;switch(t){case i.Pos3Tex:o=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case i.Pos3:o=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case i.Pos2Tex:o=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;case i.Pos2:default:o=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new a(e,n.Default3D,{geometry:t},{geometry:r.createVertex(e,35044,o)})};var s=4;t.createEmptyTexture=function(e,t){return void 0===t&&(t=s),new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,n){void 0===n&&(n=s);for(var i=new Uint8Array(n*n*4),r=0;r<i.length;r+=4)i[r+0]=255*t[0],i[r+1]=255*t[1],i[r+2]=255*t[2],i[r+3]=255*t[3];return new o(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:n,height:n},i)}}.apply(null,i))||(e.exports=r)},"/f24":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("H1tY"),n("Rrc3"),n("Zp3t")],void 0===(r=function(e,t,n,i,r){return function(){function e(t,o,a,s){if(this._context=null,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachment=null,this._initialized=!1,this._context=t,this._desc={colorTarget:o.colorTarget,depthStencilTarget:o.depthStencilTarget,width:o.width,height:o.height,multisampled:o.multisampled},this._id=e._nextId++,n("esri-webgl-debug")&&t.instanceCounter.incrementCount(4),a){var l=void 0;a instanceof r?(this._colorAttachment=a,l=a.descriptor):(l=a,this._colorAttachment=new r(this._context,l)),this._desc.colorTarget,e._validateTextureDimensions(l,this._desc)}if(s instanceof i)2===o.depthStencilTarget?this._stencilAttachment=s:(1===o.depthStencilTarget||3===o.depthStencilTarget)&&(this._depthAttachment=s),e._validateBufferDimensions(s.descriptor,this._desc);else if(s){this._context.capabilities.depthTexture;var c=void 0;s instanceof r?(this._depthStencilTexture=s,c=this._depthStencilTexture.descriptor):(c=s,this._depthStencilTexture=new r(this._context,c)),e._validateTextureDimensions(c,this._desc)}}return e.create=function(t,n){return new e(t,n)},e.createWithAttachments=function(t,n,i,r){return new e(t,i,n,r)},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof r?this._colorAttachment:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorAttachment",{get:function(){return this._colorAttachment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthStencilAttachment",{get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(this._context){var e=this._context,t=e.getBoundFramebufferObject();this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._glName&&(e.gl.deleteFramebuffer(this._glName),this._glName=null),n("esri-webgl-debug")&&e.instanceCounter.decrementCount(4),e.bindFramebuffer(t),this._context=null}},e.prototype.attachColorTexture=function(t){if(t){var n=t.descriptor;if(e._validateTextureDimensions(n,this._desc),this._disposeColorAttachment(),this._initialized){this._context.bindFramebuffer(this);var i=this._context.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t.glName,0)}this._colorAttachment=t}},e.prototype.detachColorTexture=function(){var e=void 0;if(this._colorAttachment instanceof r){if(e=this._colorAttachment,this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;this._context.gl.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)}this._colorAttachment=null}return e},e.prototype.attachDepthStencilTexture=function(t){if(t){var n=t.descriptor;if(n.pixelFormat,n.dataType,this._context.capabilities.depthTexture,e._validateTextureDimensions(n,this._desc),4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);var i=this._context.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,t.glName,0)}this._depthStencilTexture=t}},e.prototype.detachDepthStencilTexture=function(){var e=this._depthStencilTexture;if(e&&this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;this._context.gl.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,null,0)}return this._depthStencilTexture=null,e},e.prototype.attachDepthStencilBuffer=function(t){if(t){var n=t.descriptor;if(34041!==n.internalFormat&&n.internalFormat,e._validateBufferDimensions(n,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===n.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);var i=this._context.gl,r=1===this._desc.depthStencilTarget?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(i.FRAMEBUFFER,r,i.RENDERBUFFER,t.glName)}this._depthAttachment=t}},e.prototype.detachDepthStencilBuffer=function(){var e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);var n=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,null)}return this._depthAttachment=null,t},e.prototype.copyToTexture=function(e,t,n,i,r,o,a){var s=this._desc,l=a.descriptor;a.descriptor.target,e+n>s.width||t+i>s.height||r+n>l.width||l.height;var c=this._context;c.bindTexture(a),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(3553,0,r,o,e,t,n,i)},e.prototype.readPixels=function(e,t,n,i,r,o,a){this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,n,i,r,o,a)},e.prototype.resize=function(t,n){var i=this._desc;if(i.width!==t||i.height!==n){if(!this._initialized){if(i.width=t,i.height=n,this._colorAttachment instanceof r)(o=this._colorAttachment).resize(t,n);return void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,n))}var o,a;if(i.width=t,i.height=n,this._colorAttachment instanceof r)(a=(o=this._colorAttachment).descriptor).width=t,a.height=n,this._colorAttachment.dispose(),this._colorAttachment=new r(this._context,a),e._validateTextureDimensions(o.descriptor,this._desc);else this._colorAttachment&&this._disposeColorAttachment();if(null!=this._depthStencilTexture)(a=this._depthStencilTexture.descriptor).width=t,a.height=n,this._depthStencilTexture.dispose(),this._depthStencilTexture=new r(this._context,a);else(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments();this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}},e.prototype.initialize=function(){if(this._initialized)return!1;var e=this._context.gl;this._glName&&e.deleteFramebuffer(this._glName);var t=e.createFramebuffer(),n=this._desc;if(e.bindFramebuffer(e.FRAMEBUFFER,t),!this._colorAttachment)if(0===n.colorTarget){var o={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:n.width,height:n.height};this._colorAttachment=new r(this._context,o)}else{var a=new i(this._context,{internalFormat:32854,width:n.width,height:n.height});e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,a.glName),this._colorAttachment=a}if(this._colorAttachment instanceof r){var s=this._colorAttachment;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s.glName,0)}switch(n.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new i(this._context,{internalFormat:1===n.depthStencilTarget?33189:34041,width:n.width,height:n.height}));var l=1===n.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new i(this._context,{internalFormat:36168,width:n.width,height:n.height})),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){this._context.capabilities.depthTexture;var c={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:n.width,height:n.height};this._depthStencilTexture=new r(this._context,c)}e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,this._depthStencilTexture.glName,0)}return e.checkFramebufferStatus(e.FRAMEBUFFER),e.FRAMEBUFFER_COMPLETE,this._glName=t,this._initialized=!0,!0},e.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof r){var e=this._colorAttachment;if(this._initialized)this._context.bindFramebuffer(this),(n=this._context.gl).framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0);e.dispose()}else if(this._colorAttachment instanceof WebGLRenderbuffer){var t=this._colorAttachment,n=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(t)}this._colorAttachment=null},e.prototype._disposeDepthStencilAttachments=function(){var e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);var t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)},e._validateBufferDimensions=function(e,t){void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&(t.height,e.height):(t.width=e.width,t.height=e.height)},e._validateTextureDimensions=function(e,t){e.target,void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&(t.height,e.height):(t.width=e.width,t.height=e.height)},e._nextId=0,e}()}.apply(null,i))||(e.exports=r)},"05NA":function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){return function(){function e(){}return e.LAYER="layers",e.OBJECT="objects",e.GEOMETRY="geometries",e.MATERIAL="materials",e.TEXTURE="textures",e}()}.apply(null,i))||(e.exports=r)},"1CCn":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("ff/U"),n("zbgD")],void 0===(r=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.composite={name:"offscreen-composite",shaders:{vertexShader:i.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:i.resolveIncludes("renderer/offscreen/composite.frag")},attributes:n.Default3D},t.compositeTransparentToHUDVisibility={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:i.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:i.resolveIncludes("renderer/offscreen/compositeTransparentToHUDVisibility.frag")},attributes:n.Default3D},t.compositeOccluded={name:"offscreen-composite-occluded",shaders:{vertexShader:i.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:i.resolveIncludes("renderer/offscreen/compositeOccluded.frag")},attributes:n.Default3D}}.apply(null,i))||(e.exports=r)},"1bVs":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("KBgh"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("AzkI"),n("rjU6"),n("9pvv"),n("CIy2")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p){function h(e,t){if(t.isVisible){var n=f.empty(),i=t.getObjects();return t.getSpatialQueryAccelerator()?v(n,e,t.getSpatialQueryAccelerator()):g(n,e,i),n}}function v(e,t,n){var i=t.eye,r=t.viewForward,o=t.frustum,a=function(e){return!e.areAllComponentsHidden()},s=n.objectCount;if(s<S)f.set(M,t.near,Math.min(e.near,t.far)),n.forEachInDepthRange(i,r,"front-to-back",M,function(n,i){m(e,t,n),M.far=e.near,i.setRange(M)},o,a),f.set(M,Math.max(e.far,t.near),t.far),n.forEachInDepthRange(i,r,"back-to-front",M,function(n,i){m(e,t,n),M.near=e.far,i.setRange(M)},o,a);else{var l=Math.max(Math.min(s,w),Math.ceil(s*T)),c=n.findClosest(r,"front-to-back",o,a,l),u=n.findClosest(r,"back-to-front",o,a,l);c&&u&&(b(e,t,c.getCenter(),c.getBSRadius()),b(e,t,u.getCenter(),u.getBSRadius()))}}function g(e,t,n){D.clear(),n.forEach(function(e){e.areAllComponentsHidden()||D.add(e)}),D.empty||(D.sort(t),f.set(M,t.near,Math.min(e.near,t.far)),D.forEachInDepthRange(M,"front-to-back",function(n,i,r){i<e.near&&m(e,t,n)}),f.set(M,Math.max(e.far,t.near),t.far),D.forEachInDepthRange(M,"back-to-front",function(t,n,i){e.far=Math.max(e.far,i)}))}function m(e,t,n){if(!n.areAllComponentsHidden()&&c.frustum.intersectsSphere(t.frustum.planes,c.sphere.wrap(n.getBSRadius(),n.getCenter()))){var r=n.objectTransformation,o=R;n.geometryRecords.forEach(function(n){i.mat4.multiply(o,r,n.getShaderTransformation());var a=u.maxScale(o);y(e,t,n.geometry.boundingInfo,o,a)})}}function y(e,t,n,i,r){var a=t.eye,s=t.viewForward;o.vec3.transformMat4(O,n.center,i);var l=s[0]*(O[0]-a[0])+s[1]*(O[1]-a[1])+s[2]*(O[2]-a[2]),u=n.bsRadius*r;if(!(l-u>e.near&&l+u<e.far)&&c.frustum.intersectsSphere(t.frustum.planes,c.sphere.wrap(u,O)))if(n.bsRadius>_&&n.getChildren())for(var d=n.getChildren(),f=0;f<8;++f)d[f]&&y(e,t,d[f],i,r);else L.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,i,n.bbMin,n.bbMax)}function b(e,t,n,i){var r=t.eye,o=t.viewForward,a=(n[0]-r[0])*o[0]+(n[1]-r[1])*o[1]+(n[2]-r[2])*o[2];e.near=Math.min(e.near,a-i),e.far=Math.max(e.far,a+i)}Object.defineProperty(t,"__esModule",{value:!0});var x=1e4,_=100,S=500,w=500,T=.1;t.depthRangeFromScene=function(e,t,n){if(t.size<x)return I.compute(e,t);var i=f.empty();for(var r in n){var o=n[r];o.isVisible&&f.union(i,h(e,o))}return i},t.depthRangeFromLayer=h;var E=function(){function e(){this._items=new n({allocator:function(e){return e||{obj:null,distance:0,near:0,far:0}},deallocator:function(e){return e.obj=null,e.distance=0,e.near=0,e.far=0,e}})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items.clear()},e.prototype.add=function(e){this._items.pushNew().obj=e},e.prototype.sort=function(e){var t=e.eye,n=e.viewForward;this._items.forEach(function(e){var i=e.obj,r=i.getCenter(),o=i.getBSRadius(),a=(r[0]-t[0])*n[0]+(r[1]-t[1])*n[1]+(r[2]-t[2])*n[2];e.distance=a,e.near=a-o,e.far=a+o}),this._items.sort(function(e,t){return e.distance-t.distance})},e.prototype.forEachInDepthRange=function(e,t,n){if("front-to-back"===t)for(var i=0;i<this._items.length;++i){(r=this._items.data[i]).far<e.near||r.near>e.far||n(r.obj,r.near,r.far)}else for(i=this._items.length-1;i>=0;--i){var r;(r=this._items.data[i]).far<e.near||r.near>e.far||n(r.obj,r.near,r.far)}},e}(),P=function(){function e(){this.view=r.mat4f64.create(),this.viewProj=r.mat4f64.create(),this.frustum=c.frustum.create(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}return e.prototype.compute=function(e,t){var n=this;this.reset(),i.mat4.copy(this.view,e.viewMatrix),i.mat4.multiply(this.viewProj,e.projectionMatrix,this.view),c.frustum.copy(e.frustum,this.frustum);var r=this.view,o=r[2],a=r[6],s=r[10],l=r[14],u=this.range,f=0;if(t.forEach(function(e){var t=e.instanceParameters.componentVisibilities,i=e.componentOffsets;if(!d.isAllHidden(t,i)&&e.castShadow){var r,c;e.hasShaderTransformation?(r=e.getBoundingSphere(e.getShaderTransformation(),1,O),c=O):(r=e.bsRadius,c=e.center);var u=o*c[0]+a*c[1]+s*c[2]+l,p=u-r,h=u+r;n.geometries[f]=e,n.near[f]=-h,n.far[f]=-p,++f}}),0===this.geometries.length)return u;for(var p=0;p<this.geometries.length;++p)this.near[p]>u.far&&(u.far=this.near[p]),this.near[p]>2&&this.far[p]<u.near&&(u.near=this.far[p]);var h=this.looseRange;h.near=Math.max(.5*u.near,2),h.far=2*u.far;var v=0,g=0;for(p=0;p<this.geometries.length;++p)this.near[p]<u.near&&(this.near[p]>=h.near?u.near=this.near[p]:this.nearCandidates[v++]=p),this.far[p]>u.far&&(this.far[p]<=h.far?u.far=this.far[p]:this.farCandidates[g++]=p);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return u;this.nearCandidates.sort(function(e,t){return n.near[e]<n.near[t]?-1:n.near[e]>n.near[t]?1:0}),this.farCandidates.sort(function(e,t){return n.far[e]<n.far[t]?1:n.far[e]>n.far[t]?-1:0});for(p=0;p<this.nearCandidates.length;++p){var m=this.nearCandidates[p];if(this.near[m]<u.near){var y=(b=this.geometries[m]).boundingInfo;this.includeNearBoundingInfoRec(y,b.getShaderTransformation())}}for(p=0;p<this.farCandidates.length;++p){m=this.farCandidates[p];if(this.far[m]>u.far){var b;y=(b=this.geometries[m]).boundingInfo;this.includeFarBoundingInfoRec(y,b.getShaderTransformation())}}return u},e.prototype.reset=function(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE},e.prototype.includeNearBoundingInfoRec=function(e,t){var n=e.getBSRadius(),i=e.getCenter();o.vec3.transformMat4(O,i,t);var r=u.maxScale(t),a=O[0],s=O[1],l=O[2];n*=r;var c=this.frustum.planes;if(!(c[0][0]*a+c[0][1]*s+c[0][2]*l+c[0][3]>n||c[1][0]*a+c[1][1]*s+c[1][2]*l+c[1][3]>n||c[2][0]*a+c[2][1]*s+c[2][2]*l+c[2][3]>n||c[3][0]*a+c[3][1]*s+c[3][2]*l+c[3][3]>n)){var d=this.view[2]*a+this.view[6]*s+this.view[10]*l+this.view[14],f=d+n;if(!(-(d-n)<2||-f>=this.range.near)){if(-f>this.looseRange.near)return void(this.range.near=-f);if(n>_){var p=e.getChildren();if(void 0!==p){for(var h=0;h<8;++h)void 0!==p[h]&&this.includeNearBoundingInfoRec(p[h],t);return}}L.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e.prototype.includeFarBoundingInfoRec=function(e,t){var n=e.getBSRadius(),i=e.getCenter();o.vec3.transformMat4(O,i,t);var r=u.maxScale(t),a=O[0],s=O[1],l=O[2];n*=r;var c=this.frustum.planes;if(!(c[0][0]*a+c[0][1]*s+c[0][2]*l+c[0][3]>n||c[1][0]*a+c[1][1]*s+c[1][2]*l+c[1][3]>n||c[2][0]*a+c[2][1]*s+c[2][2]*l+c[2][3]>n||c[3][0]*a+c[3][1]*s+c[3][2]*l+c[3][3]>n)){var d=this.view[2]*a+this.view[6]*s+this.view[10]*l+this.view[14]-n;if(!(-d<=this.range.far)){if(-d<this.looseRange.far)return void(this.range.far=-d);if(n>_){var f=e.getChildren();if(void 0!==f){for(var p=0;p<8;++p)void 0!==f[p]&&this.includeFarBoundingInfoRec(f[p],t);return}}L.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e}();t.DepthRangeFromRenderGeometries=P;var C=function(){function e(){this.modelViewProj=r.mat4f64.create(),this.clipPosition=[l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create()]}return e.prototype.unionDepthRangeWithAABB=function(e,t,n,r,o){var a=this.modelViewProj;i.mat4.multiply(a,t,n);for(var s=!1,l=0;l<8;++l){var c=this.clipPosition[l],u=0===l||3===l||4===l||7===l?r[0]:o[0],d=0===l||1===l||4===l||5===l?r[1]:o[1],f=l<4?r[2]:o[2];c[0]=a[0]*u+a[4]*d+a[8]*f+a[12],c[1]=a[1]*u+a[5]*d+a[9]*f+a[13],c[2]=a[2]*u+a[6]*d+a[10]*f+a[14],c[3]=a[3]*u+a[7]*d+a[11]*f+a[15]}for(l=0;l<12;++l){for(var p=this.clipPosition[A[l][0]],h=this.clipPosition[A[l][1]],v=this.clipPosition[A[l][2]],g=this.clipTriangle(p,h,v),m=!0,y=0;y<g.length;++y){if((b=g[y][3])>=2){m=!1;break}}if(!m){s=!0;for(y=0;y<g.length;++y){var b;(b=g[y][3])<e.near&&(e.near=b),b>e.far&&(e.far=b)}}}return s},e.prototype.inside=function(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void p.assert(!1)},e.prototype.intersect=function(e,t,n){var i=0;return 0===n?i=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===n?i=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===n?i=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===n&&(i=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),s.vec4.lerp(l.vec4f64.create(),e,t,i)},e.prototype.clipTriangle=function(e,t,n){for(var i=[e,t,n],r=0;r<4;++r){var o=i;i=[];for(var a=0;a<o.length;++a){var s=o[a],l=o[(a+1)%o.length];this.inside(l,r)?(this.inside(s,r)||i.push(this.intersect(s,l,r)),i.push(l)):this.inside(s,r)&&i.push(this.intersect(s,l,r))}}return i},e}(),A=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],O=a.vec3f64.create(),R=r.mat4f64.create(),M=f.empty(),D=new E,I=new P,L=new C}.apply(null,i))||(e.exports=r)},"1f+t":function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){function n(e,t,n){for(var i=0;i<n;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDouble=function(e,t){r[0]=e,r[1]=e-r[0],t[0]=r[0],t[1]=r[1]},t.encodeDoubleArray=n,t.decodeDoubleArray=function(e,t,n){for(var i=0;i<n;++i)t[i]=e[2*i]+e[2*i+1]},t.encodeDoubleArraySplit=function(e,t,o,a){for(var s=0;s<a;++s)i[0]=e[s],n(i,r,1),t[s]=r[0],o[s]=r[1]};var i=new Float64Array(1),r=new Float32Array(2)}.apply(null,i))||(e.exports=r)},"23eD":function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){var n=function(){function e(e,t){void 0===t&&(t=.9),this._alpha=.9,this._name=e,this._alpha=t,this.reset()}return e.prototype.reset=function(){this._count=0,this._sum=0,this._smooth=0,this._min=1/0,this._max=0},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._count>0?this._sum/this._count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),e.prototype.begin=function(){this._startTime=performance.now()},e.prototype.end=function(){var e=performance.now()-this._startTime;this._count+=1,this._sum+=e,this._smooth=this._alpha*e+(1-this._alpha)*this._smooth,this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)},e.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}},e}();return function(e){function t(t){return t in r||(r[t]=new e(t)),r[t]}function n(e){}var i=1e3,r={},o={};e.get=t,e.begin=function(e){t(e).begin()},e.end=function(e,n){void 0===n&&(n=!0),t(e).end();var r=performance.now();!n||e in o&&!(r>=o[e]+i)||(o[e]=r)},e.log=n,e.logAll=function(){for(var e in r);}}(n||(n={})),n}.apply(null,i))||(e.exports=r)},"2A3h":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("CIy2"),n("U+8K")],void 0===(r=function(e,t,n,i){return function(){function e(e,t){void 0===t&&(t=""),this._rctx=e,this._shaderPrefix=t,this._programCacheByTemplate=new Map,this._programRefCount=[],this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}return e.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(e){e.programs.forEach(function(e){e.dispose()})}),this._programCacheByTemplate=null,this._programRefCount=null,this._commonUniforms=null,this._rctx=null},e.prototype.getProgram=function(e,t){var n=this;return this._programCacheByTemplate.has(e)||this.addProgramTemplate(e,function(t){return i.createProgram(n._rctx,e,t,n._shaderPrefix)}),this.getProgramTemplateInstance(e,t)},e.prototype.addProgramTemplate=function(e,t){this._programCacheByTemplate.set(e,{constructor:t,programs:new Map})},e.prototype.getProgramTemplateInstance=function(e,t){var n=this._programCacheByTemplate.get(e);if(n){var i=t?JSON.stringify(t):"default";if(!n.programs.has(i)){var r=n.constructor(t);n.programs.set(i,r)}return n.programs.get(i)}return null},e.prototype.getProgramsUsingUniform=function(e){return this._commonUniforms[e]||[]},e.prototype.increaseRefCount=function(e){var t=e.id;this._programRefCount[t]?this._programRefCount[t]++:(this._programRefCount[t]=1,this._findCommonUniforms(e))},e.prototype.decreaseRefCount=function(e){var t=e.id;this._programRefCount[t]>1?this._programRefCount[t]--:(this._forgetCommonUniforms(e),this._programRefCount[t]=0)},e.prototype._findCommonUniforms=function(e){for(var t in this._commonUniforms)e.hasUniform(t)&&(n.assert(-1===this._commonUniforms[t].indexOf(e),"common uniforms of program have already been determined"),this._commonUniforms[t].push(e))},e.prototype._forgetCommonUniforms=function(e){for(var t in this._commonUniforms){var n=this._commonUniforms[t],i=n.indexOf(e);i>-1&&(n[i]=n[n.length-1],n.pop())}},e}()}.apply(null,i))||(e.exports=r)},"2B1V":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("VfPl"),n("GntT")],void 0===(r=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(var n=0,i=e.fieldNames;n<i.length;n++){var r=i[n],o=e.fields.get(r);this[r]=new o.constructor(this.buffer,o.offset,this.stride)}}return Object.defineProperty(e.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteLength",{get:function(){return this.buffer.byteLength},enumerable:!0,configurable:!0}),e.prototype.getField=function(e,t){var n=this[e];return n&&n.elementCount===t.ElementCount&&n.elementType===t.ElementType?n:null},e.prototype.slice=function(t,n){return new e(this.layout,this.buffer.slice(t*this.stride,n*this.stride))},e.prototype.copyFrom=function(e,t,n,i){var r=this.stride;if(r%4==0){var o=new Uint32Array(e.buffer,t*r,i*r/4);new Uint32Array(this.buffer,n*r,i*r/4).set(o)}else{o=new Uint8Array(e.buffer,t*r,i*r);new Uint8Array(this.buffer,n*r,i*r).set(o)}},e}();t.InterleavedBuffer=r;var o=function(){function e(){this.stride=0,this.fields=new Map,this.fieldNames=[]}return e.prototype.vec2f=function(e,t){return this.appendField(e,n.BufferViewVec2f,t),this},e.prototype.vec2f64=function(e,t){return this.appendField(e,n.BufferViewVec2f64,t),this},e.prototype.vec3f=function(e,t){return this.appendField(e,n.BufferViewVec3f,t),this},e.prototype.vec3f64=function(e,t){return this.appendField(e,n.BufferViewVec3f64,t),this},e.prototype.vec4f=function(e,t){return this.appendField(e,n.BufferViewVec4f,t),this},e.prototype.vec4f64=function(e,t){return this.appendField(e,n.BufferViewVec4f64,t),this},e.prototype.mat3f=function(e,t){return this.appendField(e,n.BufferViewMat3f,t),this},e.prototype.mat3f64=function(e,t){return this.appendField(e,n.BufferViewMat3f64,t),this},e.prototype.mat4f=function(e,t){return this.appendField(e,n.BufferViewMat4f,t),this},e.prototype.mat4f64=function(e,t){return this.appendField(e,n.BufferViewMat4f64,t),this},e.prototype.vec4u8=function(e,t){return this.appendField(e,n.BufferViewVec4u8,t),this},e.prototype.f32=function(e,t){return this.appendField(e,n.BufferViewFloat,t),this},e.prototype.f64=function(e,t){return this.appendField(e,n.BufferViewFloat64,t),this},e.prototype.u8=function(e,t){return this.appendField(e,n.BufferViewUint8,t),this},e.prototype.u16=function(e,t){return this.appendField(e,n.BufferViewUint16,t),this},e.prototype.i8=function(e,t){return this.appendField(e,n.BufferViewInt8,t),this},e.prototype.vec2i8=function(e,t){return this.appendField(e,n.BufferViewVec2i8,t),this},e.prototype.vec2i16=function(e,t){return this.appendField(e,n.BufferViewVec2i16,t),this},e.prototype.vec2u8=function(e,t){return this.appendField(e,n.BufferViewVec2u8,t),this},e.prototype.vec4u16=function(e,t){return this.appendField(e,n.BufferViewVec4u16,t),this},e.prototype.u32=function(e,t){return this.appendField(e,n.BufferViewUint32,t),this},e.prototype.appendField=function(e,t,n){var r=t.ElementCount*i.elementTypeSize(t.ElementType),o=this.stride;this.fields.set(e,{size:r,constructor:t,offset:o,optional:n}),this.stride+=r,this.fieldNames.push(e)},e.prototype.alignTo=function(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this},e.prototype.hasField=function(e){return this.fieldNames.indexOf(e)>=0},e.prototype.createBuffer=function(e){return new r(this,e)},e.prototype.createView=function(e){return new r(this,e)},e.prototype.clone=function(){var t=new e;return t.stride=this.stride,t.fields=new Map,this.fields.forEach(function(e,n){return t.fields.set(n,e)}),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t},e}();t.InterleavedLayout=o,t.newLayout=function(){return new o}}.apply(null,i))||(e.exports=r)},"2CPm":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("aWgr")],void 0===(r=function(e,t,n){var i=n.boundedPlane.create();return function(){function e(){this._worldPlane=i}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.plane!==i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"plane",{get:function(){return this._worldPlane},set:function(e){this._worldPlane=e||i},enumerable:!0,configurable:!0}),e}()}.apply(null,i))||(e.exports=r)},"2Mej":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("0LE5"),n("Rdxj"),n("AzkI"),n("KPBO"),n("qUb7")],void 0===(r=function(e,t,n,i,r,o,a){function s(e){return(e+1)*(e+1)}function l(e){return r.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function c(e,t,n){var i=e[0],r=e[1],o=e[2],a=n||[];return a.length=s(t),t>=0&&(a[0]=.28209479177),t>=1&&(a[1]=.4886025119*i,a[2]=.4886025119*o,a[3]=.4886025119*r),t>=2&&(a[4]=1.09254843059*i*r,a[5]=1.09254843059*r*o,a[6]=.31539156525*(3*o*o-1),a[7]=1.09254843059*i*o,a[8]=.54627421529*(i*i-r*r)),a}function u(e,t){var n=s(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=n;for(var r=0;r<n;r++)i.r[r]=i.g[r]=i.b[r]=0;return i}function d(e,t){for(var i=l(t.r.length),r=0,a=e;r<a.length;r++){var s=a[r];n.vec3.negate(y,s.direction),c(y,i,g),o.elementwiseProduct(g,b),o.scalarProduct(g,s.intensity[0],m),o.add(t.r,m),o.scalarProduct(g,s.intensity[1],m),o.add(t.g,m),o.scalarProduct(g,s.intensity[2],m),o.add(t.b,m)}return t}function f(e,t){c(y,0,g);for(var n=0,i=e;n<i.length;n++){var r=i[n];t.r[0]+=g[0]*b[0]*r.intensity[0]*4*Math.PI,t.g[0]+=g[0]*b[0]*r.intensity[1]*4*Math.PI,t.b[0]+=g[0]*b[0]*r.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.numberOfCoefficients=s,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=l,t.computeCoefficients=c,t.initSHCoefficients=u,t.projectFillLights=d,t.projectAmbientLights=f,t.combineLights=function(e,t,i,r){u(t,r.sh),n.vec3.set(i.intensity,0,0,0);var s=!1,l=p,c=h,g=v;l.length=0,c.length=0,g.length=0;for(var m=0,y=e;m<y.length;m++)(_=y[m])instanceof a.MainLight&&!s?(n.vec3.copy(i.direction,_.direction),i.intensity[0]=_.intensity[0],i.intensity[1]=_.intensity[1],i.intensity[2]=_.intensity[2],i.castShadows=_.castShadows,s=!0):_ instanceof a.MainLight||_ instanceof a.FillLight?l.push(_):_ instanceof a.AmbientLight?c.push(_):_ instanceof a.SphericalHarmonicsLight&&g.push(_);d(l,r.sh),f(c,r.sh);for(var b=0,x=g;b<x.length;b++){var _=x[b];o.add(r.sh.r,_.sh.r),o.add(r.sh.g,_.sh.g),o.add(r.sh.b,_.sh.b)}};var p=[],h=[],v=[],g=[0],m=[0],y=i.vec3f64.create(),b=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}.apply(null,i))||(e.exports=r)},"2f4f":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("2fXB"),n("j2SP"),n("O7NG"),n("Dk48"),n("ff/U"),n("zZCp"),n("/Bau"),n("CIy2"),n("i9pz"),n("QFi0"),n("/f24"),n("qbr3"),n("Kfys"),n("z2+Q")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v){var g=5;return function(){function e(e,t){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0},this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null,this._rctx=t,this.viewportToRestore=r.vec4f64.create(),this.defaultOptions={color:i.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05},this.blurProgram=e.getProgram(u.blurPass,{gaussianSamples:g}),this.blurGridProgram=e.getProgram(u.blurPass,{gaussianSamples:g,gridOptimization:!0}),this.applyProgram=e.getProgram(u.applyPass),this.applyGridProgram=e.getProgram(u.applyPass,{gridOptimization:!0}),this.applyGridDebugProgram=e.getProgram(u.applyPass,{gridOptimization:!0,gridDebug:!0}),this.downsampleProgram=e.getProgram(u.downsamplePass),this.preprocessPipelineState=p.makePipelineState({colorWrite:p.defaultColorWriteParams}),this.applyPipelineState=p.makePipelineState({blending:p.separateBlendingParams(770,1,771,771),colorWrite:p.defaultColorWriteParams})}return Object.defineProperty(e.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"profilingCallback",{get:function(){return o.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(e){}:null},enumerable:!0,configurable:!0}),e.prototype.setDefaultOptions=function(e){this.defaultOptions=e},e.prototype.render=function(e,t,i){var r=e.pixelRatio,a=!o.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,s=o.HIGHLIGHTS_VISUALIZE_BLOCKS,l=this._rctx;c.assert(this.enabled),n.vec4.copy(this.viewportToRestore,e.fullViewport);var u=e.fullWidth,d=e.fullHeight,f=Math.ceil(u/r),p=Math.ceil(d/r);this.blur0Fbo.resize(f,p),this.blur1Fbo.resize(f,p),l.bindVAO(this.quadVAO),l.setPipelineState(this.preprocessPipelineState);var v=null,g=null,m=null,y=null;if(a){var b=this._grid;this._gridUpdateResources(t,32),this._gridComputeMipmap(),m=b.vao,y=4,v=this.blurGridProgram,l.bindProgram(v),l.bindTexture(b.coverageMipmap[b.mipmapLevels].colorTexture,1),v.setUniform1i("coverageTex",1)}else m=this.quadVAO,y=5,v=this.blurProgram,l.bindProgram(v);if(l.bindVAO(m),l.bindFramebuffer(this.blur0Fbo),l.setViewport(0,0,f,p),l.setClearColor(0,0,0,0),l.clear(16384),v.setUniform1i("tex",0),l.bindTexture(t.colorTexture,0),v.setUniform2f("blurSize",1/f,0),l.drawArrays(y,0,h.vertexCount(m,"geometry")),l.bindFramebuffer(this.blur1Fbo),l.clear(16384),l.bindTexture(this.blur0Fbo.colorTexture,0),v.setUniform2f("blurSize",0,1/p),l.drawArrays(y,0,h.vertexCount(m,"geometry")),l.bindFramebuffer(i),l.setPipelineState(this.applyPipelineState),l.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),a){g=s?this.applyGridDebugProgram:this.applyGridProgram,l.bindProgram(g),g.setUniform1i("coverageTex",2);var x=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;l.bindTexture(x,2)}else g=this.applyProgram,l.bindProgram(g);g.setUniform1i("tex",0),l.bindTexture(this.blur1Fbo.colorTexture,0),g.setUniform1i("origin",1),l.bindTexture(t.colorTexture,1),g.setUniform4fv("color",this.defaultOptions.color),g.setUniform1f("outlineSize",8.6),g.setUniform1f("blurSize",.4),g.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded),l.drawArrays(y,0,h.vertexCount(m,"geometry")),l.bindVAO(null)},e.prototype.enable=function(){if(!this.enabled){this.quadVAO=l.createQuadVAO(this._rctx);var e={colorTarget:0,depthStencilTarget:0,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=f.createWithAttachments(this._rctx,t,e),this.blur1Fbo=f.createWithAttachments(this._rctx,t,e)}},e.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null)},e.prototype._gridUpdateResources=function(e,t){var n=this._rctx,i=this._grid,r=!1;if(null===i.coverageMipmap&&(i.coverageMipmap=[e],r=!0),i.viewportWidth===e.width&&i.viewportHeight===e.height||(r=!0,i.viewportWidth=e.width,i.viewportHeight=e.height),i.coverageMipmap[0]=e,i.cellPixelSize!==t&&(i.cellPixelSize=t,r=!0),r){for(var o=1;o<i.coverageMipmap.length;o++)i.coverageMipmap[o].dispose();i.mipmapLevels=Math.ceil(Math.log(i.cellPixelSize)*Math.LOG2E),i.coverageMipmap.length=i.mipmapLevels+1;for(o=0;o<i.mipmapLevels;o++){var l=i.coverageMipmap[o],c={target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},u={colorTarget:0,depthStencilTarget:0,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},p=f.createWithAttachments(n,c,u);i.coverageMipmap[o+1]=p}}var h=Math.ceil(e.height/i.cellPixelSize),g=Math.ceil(e.width/i.cellPixelSize);if(!i.vao||i.verticalCellCount!==h||i.horizontalCellCount!==g){i.verticalCellCount=h,i.horizontalCellCount=g;for(var m=h+1,y=g+1,b=1/h,x=1/g,_=new Float32Array(24*m*y),S=0,w=0;w<m;w++)for(var T=0;T<y;T++)_[S+0]=(T-.5)*x*2-1,_[S+1]=(w-.5)*b*2-1,_[S+2]=T*x,_[S+3]=w*b,_[S+4]=(T+.5)*x*2-1,_[S+5]=(w-.5)*b*2-1,_[S+6]=T*x,_[S+7]=w*b,_[S+8]=(T-.5)*x*2-1,_[S+9]=(w+.5)*b*2-1,_[S+10]=T*x,_[S+11]=w*b,_[S+12]=(T-.5)*x*2-1,_[S+13]=(w+.5)*b*2-1,_[S+14]=T*x,_[S+15]=w*b,_[S+16]=(T+.5)*x*2-1,_[S+17]=(w-.5)*b*2-1,_[S+18]=T*x,_[S+19]=w*b,_[S+20]=(T+.5)*x*2-1,_[S+21]=(w+.5)*b*2-1,_[S+22]=T*x,_[S+23]=w*b,S+=24;i.vao&&i.vao.dispose(!0),i.vao=new v(n,a.Default3D,{geometry:s.Pos2Tex},{geometry:d.createVertex(n,35044,_)})}},e.prototype._gridComputeMipmap=function(){var e=this._rctx,t=this._grid,n=this.downsampleProgram;e.bindVAO(this.quadVAO);for(var i=0;i<t.mipmapLevels;i++){e.bindFramebuffer(t.coverageMipmap[i+1]),e.bindTexture(t.coverageMipmap[i].colorTexture,0);var r=t.coverageMipmap[i+1].width,o=t.coverageMipmap[i+1].height;e.bindProgram(n),n.setUniform1i("tex",0),n.setUniform2f("invFramebufferDim",1/r,1/o),e.setViewport(0,0,r,o),e.drawArrays(5,0,h.vertexCount(this.quadVAO,"geometry"))}},e.prototype.getGpuMemoryUsage=function(){var e=h.getGpuMemoryUsage(this.blur0Fbo)+h.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(var t=0,n=this._grid.coverageMipmap;t<n.length;t++){var i=n[t];e+=h.getGpuMemoryUsage(i)}return e},e}()}.apply(null,i))||(e.exports=r)},"31XB":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("ff/U"),n("zbgD")],void 0===(r=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.blendLayers={name:"blend-layers",shaders:{vertexShader:i.resolveIncludes("misc/blendLayers.vert"),fragmentShader:i.resolveIncludes("misc/blendLayers.frag")},attributes:n.Default3D},t.texOnly={name:"tex-only",shaders:{vertexShader:i.resolveIncludes("misc/texOnly.vert"),fragmentShader:i.resolveIncludes("misc/texOnly.frag")},attributes:n.Default3D}}.apply(null,i))||(e.exports=r)},"37NJ":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("U6iw"),n("DlJW"),n("7laH"),n("veTl")],void 0===(r=function(e,t,n,i,r,o){function a(e,t){if(t.compressedTextureS3TC)return null;var n=e.getExtension("WEBGL_compressed_texture_s3tc");return n?{COMPRESSED_RGB_S3TC_DXT1:n.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:n.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:n.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:n.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function s(e,t){if(r.default(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;var n=e.getExtension("EXT_blend_minmax");return n?{MIN:n.MIN_EXT,MAX:n.MAX_EXT}:null}function l(e,t){if(t.textureFilterAnisotropic)return null;var n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return n?{MAX_TEXTURE_MAX_ANISOTROPY:n.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:n.TEXTURE_MAX_ANISOTROPY_EXT}:null}function c(e,t){if(r.default(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT};if(e instanceof WebGLRenderingContext){var n=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!n,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:n?n.HALF_FLOAT_OES:void 0}}}function u(e,t){if(r.default(e)){var n=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float");return n||i?{textureFloat:!!i,textureHalfFloat:!!n,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){n=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),i=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float");return n||i?{textureFloat:!!i,textureHalfFloat:!!n,RGBA16F:n?n.RGBA16F_EXT:void 0,RGB16F:n?n.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}}function d(e,t,n,i,o){if(i&&r.default(e))return!0;if(t[n])return!1;for(var a=0,s=o;a<s.length;a++){var l=s[a];if(e.getExtension(l))return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.loadCapabilities=function(e,t){var r=t&&t.disabledExtensions||{};return d(e,r,"standardDerivatives",!0,["OES_standard_derivatives"]),{instancing:i.load(e),vao:o.load(e,r),compressedTextureS3TC:a(e,r),textureFilterAnisotropic:l(e,r),disjointTimerQuery:n.load(e,r),textureFloat:c(e,r),colorBufferFloat:u(e,r),blendMinMax:s(e,r),depthTexture:d(e,r,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:d(e,r,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),fragDepth:d(e,r,"fragDepth",!0,["EXT_frag_depth"])}}}.apply(null,i))||(e.exports=r)},"3KT0":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("H1tY"),n("uwSd"),n("TCFx"),n("qbr3"),n("7laH"),n("37NJ")],void 0===(r=function(e,t,n,i,r,o,a,s){function l(e,t){switch(e){case 0:return 2*t;case 4:return t/3;case 5:case 6:return t-2}return 0}return function(){function e(e,t){var i=this;this.gl=null,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap={},this._numOfDrawCalls=0,this._numOfTriangles=0,this.contextVersion=a.default(e)?"webgl2":"webgl",this.gl=e,e instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=s.loadCapabilities(e,t);var l=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:l[0],y:l[1],width:l[2],height:l[3]};var c=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:c?this.gl.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)},n("esri-webgl-debug")&&(this.instanceCounter=new r),this._stateTracker=new o.StateTracker({setBlending:function(e){if(e){i.setBlendingEnabled(!0),i.setBlendEquationSeparate(e.opRgb,e.opAlpha),i.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);var t=e.color;i.setBlendColor(t.r,t.g,t.b,t.a)}else i.setBlendingEnabled(!1)},setCulling:function(e){e?(i.setFaceCullingEnabled(!0),i.setCullFace(e.face),i.setFrontFace(e.mode)):i.setFaceCullingEnabled(!1)},setPolygonOffset:function(e){e?(i.setPolygonOffsetFillEnabled(!0),i.setPolygonOffset(e.factor,e.units)):i.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(e){e?(i.setDepthTestEnabled(!0),i.setDepthFunction(e.func)):i.setDepthTestEnabled(!1)},setStencilTest:function(e){if(e){i.setStencilTestEnabled(!0);var t=e.function;i.setStencilFunction(t.func,t.ref,t.mask);var n=e.operation;i.setStencilOp(n.fail,n.zFail,n.zPass)}else i.setStencilTestEnabled(!1)},setDepthWrite:function(e){e?(i.setDepthWriteEnabled(!0),i.setDepthRange(e.zNear,e.zFar)):i.setDepthWriteEnabled(!1)},setColorWrite:function(e){e?i.setColorMask(e.r,e.g,e.b,e.a):i.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(e){e?i.setStencilWriteMask(e.mask):i.setStencilWriteMask(0)}}),this.enforceState()}return Object.defineProperty(e.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap={},n("esri-webgl-debug")&&this.instanceCounter.printResourceCount(),this.gl=null},e.prototype.setPipelineState=function(e){this._stateTracker.setPipeline(e)},e.prototype.setBlendingEnabled=function(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e,this._stateTracker.invalidateBlending())},e.prototype.setBlendColor=function(e,t,n,i){e===this._blendColorState.r&&t===this._blendColorState.g&&n===this._blendColorState.b&&i===this._blendColorState.a||(this.gl.blendColor(e,t,n,i),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=n,this._blendColorState.a=i,this._stateTracker.invalidateBlending())},e.prototype.setBlendFunction=function(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t,this._stateTracker.invalidateBlending())},e.prototype.setBlendFunctionSeparate=function(e,t,n,i){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===n&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===i||(this.gl.blendFuncSeparate(e,t,n,i),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=n,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=i,this._stateTracker.invalidateBlending())},e.prototype.setBlendEquation=function(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e,this._stateTracker.invalidateBlending())},e.prototype.setBlendEquationSeparate=function(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t,this._stateTracker.invalidateBlending())},e.prototype.setColorMask=function(e,t,n,i){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===n&&this._colorMaskState.a===i||(this.gl.colorMask(e,t,n,i),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=n,this._colorMaskState.a=i,this._stateTracker.invalidateColorWrite())},e.prototype.setClearColor=function(e,t,n,i){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===n&&this._clearColor.a===i||(this.gl.clearColor(e,t,n,i),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=n,this._clearColor.a=i)},e.prototype.setFaceCullingEnabled=function(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e,this._stateTracker.invalidateCulling())},e.prototype.setPolygonOffsetFillEnabled=function(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e,this._stateTracker.invalidatePolygonOffset())},e.prototype.setPolygonOffset=function(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())},e.prototype.setCullFace=function(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e,this._stateTracker.invalidateCulling())},e.prototype.setFrontFace=function(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e,this._stateTracker.invalidateCulling())},e.prototype.setScissorTestEnabled=function(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)},e.prototype.setScissorRect=function(e,t,n,i){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===n&&this._scissorRect.height===i||(this.gl.scissor(e,t,n,i),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=n,this._scissorRect.height=i)},e.prototype.setDepthTestEnabled=function(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e,this._stateTracker.invalidateDepthTest())},e.prototype.setClearDepth=function(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)},e.prototype.setDepthFunction=function(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e,this._stateTracker.invalidateDepthTest())},e.prototype.setDepthWriteEnabled=function(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e,this._stateTracker.invalidateDepthWrite())},e.prototype.setDepthRange=function(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())},e.prototype.setStencilTestEnabled=function(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e,this._stateTracker.invalidateStencilTest())},e.prototype.setClearStencil=function(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)},e.prototype.setStencilFunction=function(e,t,n){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===n||(this.gl.stencilFunc(e,t,n),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())},e.prototype.setStencilFunctionSeparate=function(e,t,n,i){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===n&&this._stencilFunction.mask===i||(this.gl.stencilFuncSeparate(e,t,n,i),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=n,this._stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())},e.prototype.setStencilWriteMask=function(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())},e.prototype.setStencilOp=function(e,t,n){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===n||(this.gl.stencilOp(e,t,n),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())},e.prototype.setStencilOpSeparate=function(e,t,n,i){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===n&&this._stencilOperation.zPass===i||(this.gl.stencilOpSeparate(e,t,n,i),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=n,this._stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())},e.prototype.setActiveTexture=function(e){var t=this._activeTextureUnit;return e>=0&&e!==this._activeTextureUnit&&(this.gl.activeTexture(i.BASE_TEXTURE_UNIT+e),this._activeTextureUnit=e),t},e.prototype.clear=function(e){e&&this.gl.clear(e)},e.prototype.clearSafe=function(e){e&&(16384&e&&this.setColorMask(!0,!0,!0,!0),256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(255),this.gl.clear(e))},e.prototype.drawArrays=function(e,t,i){n("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=l(e,i)),this.gl.drawArrays(e,t,i)},e.prototype.drawElements=function(e,t,i,r){n("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=l(e,t)),5123!==i?5125===i&&this.gl.drawElements(e,t,i,r):this.gl.drawElements(e,t,i,r)},e.prototype.logIno=function(){n("esri-webgl-debug")},Object.defineProperty(e.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0}),e.prototype.setViewport=function(e,t,n,i){var r=this._viewport;r.x===e&&r.y===t&&r.width===n&&r.height===i||(r.x=e,r.y=t,r.width=n,r.height=i,this.gl.viewport(e,t,n,i))},e.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}},e.prototype.bindProgram=function(e){if(!e)return this.gl.useProgram(null),void(this._activeShaderProgram=null);this._activeShaderProgram!==e&&(e.initialize(),this.gl.useProgram(e.glName),this._activeShaderProgram=e)},e.prototype.bindTexture=function(t,n){void 0===n&&(n=0),-1===e._MAX_TEXTURE_IMAGE_UNITS&&(e._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)),e._MAX_TEXTURE_IMAGE_UNITS;var i=this._textureUnitMap[n];return this.setActiveTexture(n),null==t||null==t.glName?(null!=i&&(this.gl.bindTexture(i.descriptor.target,null),i.setBoundToUnit(n,!1)),void(this._textureUnitMap[n]=null)):i&&i.id===t.id?void t.applyChanges():(this.gl.bindTexture(t.descriptor.target,t.glName),t.setBoundToUnit(n,!0),t.applyChanges(),void(this._textureUnitMap[n]=t))},e.prototype.bindFramebuffer=function(e){if(!e)return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);this._activeFramebuffer!==e&&(e.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.glName),this._activeFramebuffer=e)},e.prototype.bindBuffer=function(t){t&&(34962===t.bufferType?this._activeVertexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeIndexBuffer))},e.prototype.bindRenderbuffer=function(e){var t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)},e.prototype.unbindBuffer=function(t){34962===t?this._activeVertexBuffer=e._bindBuffer(this.gl,null,t,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,null,t,this._activeIndexBuffer)},e.prototype.bindVAO=function(e){e?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===e.id||(e.bind(),this._activeVertexArrayObject=e):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)},e.prototype.getBoundTexture=function(e){return this._textureUnitMap[e]},e.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer},e.prototype.getBoundVAO=function(){return this._activeVertexArrayObject},e.prototype.resetState=function(){this.bindProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(var e=0;e<this.parameters.maxTextureImageUnits;e++)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)},e.prototype.enforceState=function(){var e=this.gl,t=this._capabilities.vao;t&&t.bindVertexArray(null);for(var r=0;r<this.parameters.maxVertexAttributes;r++)e.disableVertexAttribArray(r);if(this._activeVertexBuffer?e.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):e.bindBuffer(34962,null),this._activeIndexBuffer?e.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):e.bindBuffer(34963,null),t&&this._activeVertexArrayObject){var o=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(o)}e.bindFramebuffer(e.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null),e.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null),e.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),e.bindRenderbuffer(e.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),e.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),e.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),e.clearDepth(this._clearDepth),e.clearStencil(this._clearStencil),e.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),e.cullFace(this._cullFace),e.depthFunc(this._depthFunction),e.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._depthWriteEnabled),e.frontFace(this._frontFace),e.lineWidth(1),!0===this._polygonCullingEnabled?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),e.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._stencilWriteMask);for(var a=0;a<this.parameters.maxTextureImageUnits;a++){e.activeTexture(i.BASE_TEXTURE_UNIT+a),e.bindTexture(3553,null);var s=this._textureUnitMap[a];s&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(i.BASE_TEXTURE_UNIT+this._activeTextureUnit),e.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height),n("esri-webgl-debug")&&(this._numOfDrawCalls=0,this._numOfTriangles=0)},e._bindBuffer=function(e,t,n,i){return t?i===t?i:(e.bindBuffer(n,t.glName),t):(e.bindBuffer(n,null),null)},e._MAX_TEXTURE_IMAGE_UNITS=-1,e}()}.apply(null,i))||(e.exports=r)},"3RHn":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("KBgh"),n("0LE5"),n("Rdxj"),n("CIy2")],void 0===(r=function(e,t,n,i,r,o){var a=function(){function e(t,n,a,s){o.assert(t.length>=1),o.assert(a.length%n==0),o.assert(a.length>=t.length*n),o.assert(3===s.size||4===s.size),this.primitiveIndices=t,this.indices=a,this._position=s,this._numIndexPerPrimitive=n;var l=s.data,c=s.offsetIdx,u=s.strideIdx,d=0,f=t.length,p=c+u*a[n*t[d]];for(e.tmpIndices.clear(),e.tmpIndices.push(p),this.bbMin=r.vec3f64.fromValues(l[p],l[p+1],l[p+2]),this.bbMax=r.vec3f64.clone(this.bbMin);d<f;++d)for(var h=n*t[d],v=0;v<n;++v){p=c+u*a[h+v],e.tmpIndices.push(p);var g=l[p];this.bbMin[0]=Math.min(g,this.bbMin[0]),this.bbMax[0]=Math.max(g,this.bbMax[0]),g=l[p+1],this.bbMin[1]=Math.min(g,this.bbMin[1]),this.bbMax[1]=Math.max(g,this.bbMax[1]),g=l[p+2],this.bbMin[2]=Math.min(g,this.bbMin[2]),this.bbMax[2]=Math.max(g,this.bbMax[2])}this.center=r.vec3f64.create(),i.vec3.lerp(this.center,this.bbMin,this.bbMax,.5),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var m=this.bsRadius*this.bsRadius;for(d=0;d<e.tmpIndices.length;++d){var y=l[p=e.tmpIndices.data[d]]-this.center[0],b=l[p+1]-this.center[1],x=l[p+2]-this.center[2],_=y*y+b*b+x*x;if(!(_<=m)){var S=Math.sqrt(_),w=.5*(S-this.bsRadius);this.bsRadius=this.bsRadius+w,m=this.bsRadius*this.bsRadius;var T=w/S;this.center[0]+=y*T,this.center[1]+=b*T,this.center[2]+=x*T}}e.tmpIndices.clear()}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this.children)return this.children;if(i.vec3.squaredDistance(this.bbMin,this.bbMax)>1){for(var t=i.vec3.lerp(r.vec3f64.create(),this.bbMin,this.bbMax,.5),n=this.primitiveIndices.length,o=new Uint8Array(n),a=new Array(8),s=0;s<8;++s)a[s]=0;var l=this._position,c=l.data,u=l.offsetIdx,d=l.strideIdx;for(s=0;s<n;++s){for(var f=0,p=this._numIndexPerPrimitive*this.primitiveIndices[s],h=u+d*this.indices[p],v=c[h],g=c[h+1],m=c[h+2],y=1;y<this._numIndexPerPrimitive;++y){var b=c[h=u+d*this.indices[p+y]],x=c[h+1],_=c[h+2];b<v&&(v=b),x<g&&(g=x),_<m&&(m=_)}v<t[0]&&(f|=1),g<t[1]&&(f|=2),m<t[2]&&(f|=4),o[s]=f,++a[f]}var S=0;for(s=0;s<8;++s)a[s]>0&&++S;if(S<2)return;var w=new Array(8);for(s=0;s<8;++s)w[s]=a[s]>0?new Uint32Array(a[s]):void 0;for(s=0;s<8;++s)a[s]=0;for(s=0;s<n;++s){w[f=o[s]][a[f]++]=this.primitiveIndices[s]}this.children=new Array(8);for(s=0;s<8;++s)void 0!==w[s]&&(this.children[s]=new e(w[s],this._numIndexPerPrimitive,this.indices,this._position))}return this.children},e}();return(a||(a={})).tmpIndices=new n({deallocator:null}),a}.apply(null,i))||(e.exports=r)},"3gjc":function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return new Float32Array(4)},t.clone=function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,n,i){var r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r},t.createView=function(e,t){return new Float32Array(e,t,4)}}.apply(null,i))||(e.exports=r)},"4ziW":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("0LE5"),n("vlC2"),n("Rdxj"),n("aWgr"),n("83/a"),n("AgDx"),n("CIy2")],void 0===(r=function(e,t,n,i,r,o,a,s,l){var c,u,d,f,p=a.Vec3Compact;!function(e){for(var t=.5,n=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],i=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],r=[0,0,1,0,1,1,0,1],o=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],a=new Array(36),c=0;c<6;c++)for(var u=0;u<6;u++)a[6*c+u]=c;var d=new Array(36);for(c=0;c<6;c++)d[6*c+0]=0,d[6*c+1]=1,d[6*c+2]=2,d[6*c+3]=2,d[6*c+4]=3,d[6*c+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(24),c=0;c<8;c++)t[3*c]=n[c][0]*e[0],t[3*c+1]=n[c][1]*e[1],t[3*c+2]=n[c][2]*e[2];var u={};u[l.VertexAttrConstants.POSITION]=new Uint32Array(o),u[l.VertexAttrConstants.NORMAL]=new Uint32Array(a),u[l.VertexAttrConstants.UV0]=new Uint32Array(d);var f={};return f[l.VertexAttrConstants.POSITION]={size:3,data:t},f[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(i)},f[l.VertexAttrConstants.UV0]={size:2,data:new Float32Array(r)},new s(f,u)}}(c||(c={})),function(e){var t=.5,n=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],i=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],r=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],o=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(18),a=0;a<6;a++)t[3*a]=n[a][0]*e[0],t[3*a+1]=n[a][1]*e[1],t[3*a+2]=n[a][2]*e[2];var c={};c[l.VertexAttrConstants.POSITION]=new Uint32Array(r),c[l.VertexAttrConstants.NORMAL]=new Uint32Array(o);var u={};return u[l.VertexAttrConstants.POSITION]={size:3,data:t},u[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(i)},new s(u,c)}}(u||(u={})),function(e){var t=i.vec3f32.fromValues(-.5,0,-.5),r=i.vec3f32.fromValues(.5,0,-.5),o=i.vec3f32.fromValues(0,0,.5),a=i.vec3f32.fromValues(0,.5,0),c=i.vec3f32.create(),u=i.vec3f32.create(),d=i.vec3f32.create(),f=i.vec3f32.create(),p=i.vec3f32.create();n.vec3.subtract(c,t,a),n.vec3.subtract(u,t,r),n.vec3.cross(d,c,u),n.vec3.normalize(d,d),n.vec3.subtract(c,r,a),n.vec3.subtract(u,r,o),n.vec3.cross(f,c,u),n.vec3.normalize(f,f),n.vec3.subtract(c,o,a),n.vec3.subtract(u,o,t),n.vec3.cross(p,c,u),n.vec3.normalize(p,p);var h=[t,r,o,a],v=[0,-1,0,d[0],d[1],d[2],f[0],f[1],f[2],p[0],p[1],p[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],m=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(12),n=0;n<4;n++)t[3*n]=h[n][0]*e[0],t[3*n+1]=h[n][1]*e[1],t[3*n+2]=h[n][2]*e[2];var i={};i[l.VertexAttrConstants.POSITION]=new Uint32Array(g),i[l.VertexAttrConstants.NORMAL]=new Uint32Array(m);var r={};return r[l.VertexAttrConstants.POSITION]={size:3,data:t},r[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(v)},new s(r,i)}}(d||(d={})),function(e){function t(e,t,i,r,o){return!(Math.abs(n.vec3.dot(t,e))>o||(n.vec3.cross(i,e,t),n.vec3.normalize(i,i),n.vec3.cross(r,i,e),n.vec3.normalize(r,r),0))}function f(e,n,i,r,o,a,s){return t(e,n,o,a,s)||t(e,i,o,a,s)||t(e,r,o,a,s)}e.createBoxGeometry=c.createGeometry,e.createDiamondGeometry=u.createGeometry,e.createTetrahedronGeometry=d.createGeometry,e.createSphereGeometry=function(e,t,n,i,r,o,a){e=e||50,i=void 0!==i?i:-Math.PI,r=void 0!==r?r:2*Math.PI,o=void 0!==o?o:.5*-Math.PI,a=void 0!==a?a:Math.PI;for(var c=Math.max(3,Math.floor(t)||8),u=Math.max(2,Math.floor(n)||6),d=(c+1)*(u+1),f=new Float32Array(3*d),p=new Float32Array(3*d),h=new Float32Array(2*d),v=[],g=0,m=0;m<=u;m++){for(var y=[],b=m/u,x=o+b*a,_=Math.cos(x),S=0;S<=c;S++){var w=S/c,T=i+w*r,E=Math.cos(T)*_,P=Math.sin(x),C=-Math.sin(T)*_;f[3*g]=E*e,f[3*g+1]=P*e,f[3*g+2]=C*e,p[3*g]=E,p[3*g+1]=P,p[3*g+2]=C,h[2*g]=w,h[2*g+1]=b,y.push(g),++g}v.push(y)}var A=new Uint32Array(2*c*(u-1)*3);for(g=0,m=0;m<u;m++)for(S=0;S<c;S++){var O=v[m][S],R=v[m][S+1],M=v[m+1][S+1],D=v[m+1][S];0===m?(A[g++]=O,A[g++]=M,A[g++]=D):m===u-1?(A[g++]=O,A[g++]=R,A[g++]=M):(A[g++]=O,A[g++]=R,A[g++]=M,A[g++]=M,A[g++]=D,A[g++]=O)}l.assert(g===A.length);var I={};I[l.VertexAttrConstants.POSITION]=A,I[l.VertexAttrConstants.NORMAL]=A,I[l.VertexAttrConstants.UV0]=A;var L={};return L[l.VertexAttrConstants.POSITION]={size:3,data:f},L[l.VertexAttrConstants.NORMAL]={size:3,data:p},L[l.VertexAttrConstants.UV0]={size:2,data:h},new s(L,I)},e.createPolySphereGeometry=function(e,t,n){function i(t,n){var i;t>n&&(t=(i=[n,t])[0],n=i[1]);var o=t.toString()+"."+n.toString();if(d[o])return d[o];var a=r.length;return r.length+=3,p.add(r,3*t,r,3*n,r,a),p.scale(r,a,e/p.length(r,a)),a/=3,d[o]=a,a}var r,o,a=e;if(n)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],o=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var c=a*(1+Math.sqrt(5))/2;r=[-a,c,0,a,c,0,-a,-c,0,a,-c,0,0,-a,c,0,a,c,0,-a,-c,0,a,-c,c,0,-a,c,0,a,-c,0,-a,-c,0,a],o=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var u=0;u<r.length;u+=3)p.scale(r,u,e/p.length(r,u));var d={};for(u=0;u<t;u++){for(var f=o.length,h=new Uint32Array(4*f),v=0;v<f;v+=3){var g=o[v],m=o[v+1],y=o[v+2],b=i(g,m),x=i(m,y),_=i(y,g),S=4*v;h[S]=g,h[S+1]=b,h[S+2]=_,h[S+3]=m,h[S+4]=x,h[S+5]=b,h[S+6]=y,h[S+7]=_,h[S+8]=x,h[S+9]=b,h[S+10]=x,h[S+11]=_}o=h,d={}}var w=new Float32Array(r);for(u=0;u<w.length;u+=3)p.normalize(w,u);var T={};T[l.VertexAttrConstants.POSITION]=o,T[l.VertexAttrConstants.NORMAL]=o;var E={};return E[l.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(r)},E[l.VertexAttrConstants.NORMAL]={size:3,data:w},new s(E,T)},e.createPointGeometry=function(e,t,n,i,r,o,a){var c=t?new Float64Array([t[0],t[1],t[2]]):new Float32Array([0,0,0]),u=e?new Float32Array([e[0],e[1],e[2]]):new Float32Array([0,0,1]),d=o?new Float32Array(o):new Float32Array([0,0]),f=n?new Uint8Array([255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]):new Uint8Array([255,255,255,255]),p=null!=i&&2===i.length?new Float32Array(i):new Float32Array([1,1]),h=new Uint32Array([0]),v={};v[l.VertexAttrConstants.POSITION]=h,v[l.VertexAttrConstants.NORMAL]=h,v[l.VertexAttrConstants.UV0]=h,v[l.VertexAttrConstants.COLOR]=h,v[l.VertexAttrConstants.SIZE]=h;var g={};if(g[l.VertexAttrConstants.POSITION]={size:3,data:c},g[l.VertexAttrConstants.NORMAL]={size:3,data:u},g[l.VertexAttrConstants.UV0]={size:d.length,data:d},g[l.VertexAttrConstants.COLOR]={size:4,data:f},g[l.VertexAttrConstants.SIZE]={size:2,data:p},null!=r){var m=new Float32Array([r[0],r[1],r[2],r[3]]);v[l.VertexAttrConstants.AUXPOS1]=h,g[l.VertexAttrConstants.AUXPOS1]={size:4,data:m}}if(null!=a){var y=new Float32Array([a[0],a[1],a[2],a[3]]);v[l.VertexAttrConstants.AUXPOS2]=h,g[l.VertexAttrConstants.AUXPOS2]={size:4,data:y}}return new s(g,v,s.DefaultOffsets,"point")},e.createPointArrayGeometry=function(e,t){for(var n=new Float32Array(3*e.length),i=new Float32Array(t?3*e.length:3),r=new Uint32Array(e.length),o=new Uint32Array(e.length),a=0;a<e.length;a++)n[3*a]=e[a][0],n[3*a+1]=e[a][1],n[3*a+2]=e[a][2],t&&(i[3*a]=t[a][0],i[3*a+1]=t[a][1],i[3*a+2]=t[a][2]),r[a]=a,o[a]=0;t||(i[0]=0,i[1]=1,i[2]=0);var c=new Float32Array(2);c[0]=0,c[1]=0;var u={};u[l.VertexAttrConstants.POSITION]=r,u[l.VertexAttrConstants.NORMAL]=t?r:o,u[l.VertexAttrConstants.UV0]=o;var d={};return d[l.VertexAttrConstants.POSITION]={size:3,data:n},d[l.VertexAttrConstants.NORMAL]={size:3,data:i},d[l.VertexAttrConstants.UV0]={size:2,data:c},new s(d,u,s.DefaultOffsets,"point")},e.createTriangleGeometry=function(){var e=new Float32Array([0,0,0,0,0,100,100,0,0]),t=new Uint32Array([0,1,2]),n=new Float32Array([0,1,0]),i=new Uint32Array([0,0,0]),r=new Float32Array([0,0]),o=new Uint32Array([0,0,0]),a={};a[l.VertexAttrConstants.POSITION]=t,a[l.VertexAttrConstants.NORMAL]=i,a[l.VertexAttrConstants.UV0]=o;var c={};return c[l.VertexAttrConstants.POSITION]={size:3,data:e},c[l.VertexAttrConstants.NORMAL]={size:3,data:n},c[l.VertexAttrConstants.UV0]={size:2,data:r},new s(c,a)},e.createSquareGeometry=function(e){var t=new Float32Array(12);if(e)for(var n=0;n<4;n++)for(var i=0;i<3;i++)t[3*n+i]=e[n][i];else t[0]=-1,t[1]=-1,t[2]=0,t[3]=1,t[4]=-1,t[5]=0,t[6]=1,t[7]=1,t[8]=0,t[9]=-1,t[10]=1,t[11]=0;var r=new Uint32Array([0,1,2,2,3,0]),o=new Float32Array([0,0,1]),a=new Uint32Array([0,0,0,0,0,0]),c=new Float32Array([0,0,1,0,1,1,0,1]),u=new Uint8Array([255,255,255,255]),d={};d[l.VertexAttrConstants.POSITION]=r,d[l.VertexAttrConstants.NORMAL]=a,d[l.VertexAttrConstants.UV0]=r,d[l.VertexAttrConstants.COLOR]=a;var f={};return f[l.VertexAttrConstants.POSITION]={size:3,data:t},f[l.VertexAttrConstants.NORMAL]={size:3,data:o},f[l.VertexAttrConstants.UV0]={size:2,data:c},f[l.VertexAttrConstants.COLOR]={size:4,data:u},new s(f,d)},e.createConeGeometry=function(e,t,n,r,o,a){void 0===o&&(o=!0),void 0===a&&(a=!0);var c=0,u=t,d=e,f=i.vec3f32.fromValues(0,c,0),p=i.vec3f32.fromValues(0,c+d,0),h=i.vec3f32.fromValues(0,-1,0),v=i.vec3f32.fromValues(0,1,0);r&&(c=d,p=i.vec3f32.fromValues(0,0,0),f=i.vec3f32.fromValues(0,c,0),h=i.vec3f32.fromValues(0,1,0),v=i.vec3f32.fromValues(0,-1,0));var g=[p,f],m=[h,v],y=n+2,b=Math.sqrt(d*d+u*u);if(r)for(var x=n-1;x>=0;x--){var _=x*(2*Math.PI/n),S=i.vec3f32.fromValues(Math.cos(_)*u,c,Math.sin(_)*u);g.push(S);var w=i.vec3f32.fromValues(d*Math.cos(_)/b,-u/b,d*Math.sin(_)/b);m.push(w)}else for(x=0;x<n;x++)_=x*(2*Math.PI/n),S=i.vec3f32.fromValues(Math.cos(_)*u,c,Math.sin(_)*u),g.push(S),w=i.vec3f32.fromValues(d*Math.cos(_)/b,u/b,d*Math.sin(_)/b),m.push(w);var T=new Uint32Array(2*(n+2)*3),E=new Uint32Array(2*(n+2)*3),P=0,C=0;if(o){for(x=3;x<g.length;x++)T[P++]=1,T[P++]=x-1,T[P++]=x,E[C++]=0,E[C++]=0,E[C++]=0;T[P++]=g.length-1,T[P++]=2,T[P++]=1,E[C++]=0,E[C++]=0,E[C++]=0}if(a){for(x=3;x<g.length;x++)T[P++]=x,T[P++]=x-1,T[P++]=0,E[C++]=x,E[C++]=x-1,E[C++]=1;T[P++]=0,T[P++]=2,T[P++]=g.length-1,E[C++]=1,E[C++]=2,E[C++]=m.length-1}var A=new Float32Array(3*y);for(x=0;x<y;x++)A[3*x]=g[x][0],A[3*x+1]=g[x][1],A[3*x+2]=g[x][2];var O=new Float32Array(3*y);for(x=0;x<y;x++)O[3*x]=m[x][0],O[3*x+1]=m[x][1],O[3*x+2]=m[x][2];var R={};R[l.VertexAttrConstants.POSITION]=T,R[l.VertexAttrConstants.NORMAL]=E;var M={};return M[l.VertexAttrConstants.POSITION]={size:3,data:A},M[l.VertexAttrConstants.NORMAL]={size:3,data:O},new s(M,R)},e.createCylinderGeometry=function(e,t,r,o,a,c){var u=o?i.vec3f32.clone(o):i.vec3f32.fromValues(1,0,0),d=a?i.vec3f32.clone(a):i.vec3f32.fromValues(0,0,0),f=void 0===c||c,p=i.vec3f32.create();n.vec3.normalize(p,u);var h=i.vec3f32.create();n.vec3.scale(h,p,Math.abs(e));var v=i.vec3f32.create();n.vec3.scale(v,h,-.5),n.vec3.add(v,v,d);var g=i.vec3f32.fromValues(0,1,0);Math.abs(1-n.vec3.dot(p,g))<.2&&n.vec3.set(g,0,0,1);var m=i.vec3f32.create();n.vec3.cross(m,p,g),n.vec3.normalize(m,m),n.vec3.cross(g,m,p);var y=2*r+(f?2:0),b=r+(f?2:0),x=new Float32Array(3*y),_=new Float32Array(3*b),S=new Float32Array(2*y),w=new Uint32Array(3*r*(f?4:2)),T=new Uint32Array(3*r*(f?4:2));f&&(x[3*(y-2)+0]=v[0],x[3*(y-2)+1]=v[1],x[3*(y-2)+2]=v[2],S[2*(y-2)]=0,S[2*(y-2)+1]=0,x[3*(y-1)+0]=x[3*(y-2)+0]+h[0],x[3*(y-1)+1]=x[3*(y-2)+1]+h[1],x[3*(y-1)+2]=x[3*(y-2)+2]+h[2],S[2*(y-1)]=1,S[2*(y-1)+1]=1,_[3*(b-2)+0]=-p[0],_[3*(b-2)+1]=-p[1],_[3*(b-2)+2]=-p[2],_[3*(b-1)+0]=p[0],_[3*(b-1)+1]=p[1],_[3*(b-1)+2]=p[2]);for(var E=function(e,t,n){w[e]=t,T[e]=n},P=0,C=i.vec3f32.create(),A=i.vec3f32.create(),O=0;O<r;O++){var R=O*(2*Math.PI/r);n.vec3.scale(C,g,Math.sin(R)),n.vec3.scale(A,m,Math.cos(R)),n.vec3.add(C,C,A),_[3*O+0]=C[0],_[3*O+1]=C[1],_[3*O+2]=C[2],n.vec3.scale(C,C,t),n.vec3.add(C,C,v),x[3*O+0]=C[0],x[3*O+1]=C[1],x[3*O+2]=C[2],S[2*O+0]=O/r,S[2*O+1]=0,x[3*(O+r)+0]=x[3*O+0]+h[0],x[3*(O+r)+1]=x[3*O+1]+h[1],x[3*(O+r)+2]=x[3*O+2]+h[2],S[2*(O+r)+0]=O/r,S[2*O+1]=1;var M=(O+1)%r;E(P++,O,O),E(P++,O+r,O),E(P++,M,M),E(P++,M,M),E(P++,O+r,O),E(P++,M+r,M)}if(f){for(O=0;O<r;O++)M=(O+1)%r,E(P++,y-2,b-2),E(P++,O,b-2),E(P++,M,b-2);for(O=0;O<r;O++)M=(O+1)%r,E(P++,O+r,b-1),E(P++,y-1,b-1),E(P++,M+r,b-1)}var D={};D[l.VertexAttrConstants.POSITION]=w,D[l.VertexAttrConstants.NORMAL]=T,D[l.VertexAttrConstants.UV0]=w;var I={};return I[l.VertexAttrConstants.POSITION]={size:3,data:x},I[l.VertexAttrConstants.NORMAL]={size:3,data:_},I[l.VertexAttrConstants.UV0]={size:2,data:S},new s(I,D)},e.createTubeGeometry=function(t,n,i,r,o){i=i||10,r=null==r||r,l.assert(t.length>1);for(var a=[],s=[],c=0;c<i;c++){a.push([0,-c-1,-(c+1)%i-1]);var u=c/i*2*Math.PI;s.push([Math.cos(u)*n,Math.sin(u)*n])}return e.createPathExtrusionGeometry(s,t,[[0,0,0]],a,r,o)},e.createPathExtrusionGeometry=function(e,t,a,c,u,d){void 0===d&&(d=i.vec3f32.fromValues(0,0,0));var p=e.length,v=new Float32Array(t.length*p*3+(6*a.length||0)),g=new Float32Array(t.length*p+(2*a.length||0)),m=new Float32Array(t.length*p*3+(a?6:0)),y=(t.length-1)*p*6+3*c.length*2,b=new Uint32Array(y),x=new Uint32Array(y),_=0,S=0,w=0,T=0,E=0,P=i.vec3f32.create(),C=i.vec3f32.create(),A=i.vec3f32.create(),O=i.vec3f32.create(),R=i.vec3f32.create(),M=i.vec3f32.create(),D=i.vec3f32.create(),I=r.vec3f64.create(),L=i.vec3f32.create(),V=i.vec3f32.create(),F=i.vec3f32.create(),B=i.vec3f32.create(),N=i.vec3f32.create(),z=o.plane.create();n.vec3.set(L,0,1,0),n.vec3.subtract(C,t[1],t[0]),n.vec3.normalize(C,C),u?(n.vec3.add(I,t[0],d),n.vec3.normalize(A,I)):n.vec3.set(A,0,0,1),f(C,A,L,L,R,A,h),n.vec3.copy(O,A),n.vec3.copy(B,R);for(var U=0;U<a.length;U++)n.vec3.scale(M,R,a[U][0]),n.vec3.scale(I,A,a[U][2]),n.vec3.add(M,M,I),n.vec3.add(M,M,t[0]),v[_++]=M[0],v[_++]=M[1],v[_++]=M[2],g[w++]=0;for(m[S++]=-C[0],m[S++]=-C[1],m[S++]=-C[2],U=0;U<c.length;U++)b[T++]=c[U][0]>0?c[U][0]:-c[U][0]-1+a.length,b[T++]=c[U][1]>0?c[U][1]:-c[U][1]-1+a.length,b[T++]=c[U][2]>0?c[U][2]:-c[U][2]-1+a.length,x[E++]=0,x[E++]=0,x[E++]=0;for(var j=a.length,G=a.length-1,H=0;H<t.length;H++){var k=!1;H>0&&(n.vec3.copy(P,C),H<t.length-1?(n.vec3.subtract(C,t[H+1],t[H]),n.vec3.normalize(C,C)):k=!0,n.vec3.add(V,P,C),n.vec3.normalize(V,V),n.vec3.add(F,t[H-1],O),o.plane.fromPositionAndNormal(t[H],V,z),o.plane.intersectRay(z,o.ray.wrap(F,P),I)?(n.vec3.subtract(I,I,t[H]),n.vec3.normalize(A,I),n.vec3.cross(R,V,A),n.vec3.normalize(R,R)):f(V,O,B,L,R,A,h),n.vec3.copy(O,A),n.vec3.copy(B,R)),u&&(n.vec3.add(I,t[H],d),n.vec3.normalize(N,I));for(var W=0;W<p;W++)if(n.vec3.scale(M,R,e[W][0]),n.vec3.scale(I,A,e[W][1]),n.vec3.add(M,M,I),n.vec3.normalize(D,M),m[S++]=D[0],m[S++]=D[1],m[S++]=D[2],g[w++]=u?n.vec3.dot(M,N):M[2],n.vec3.add(M,M,t[H]),v[_++]=M[0],v[_++]=M[1],v[_++]=M[2],!k){var X=(W+1)%p;b[T++]=j+W,b[T++]=j+p+W,b[T++]=j+X,b[T++]=j+X,b[T++]=j+p+W,b[T++]=j+p+X;for(var q=0;q<6;q++)x[E++]=b[T-6+q]-G}j+=p}var Y=t[t.length-1];for(U=0;U<a.length;U++)n.vec3.scale(M,R,a[U][0]),n.vec3.scale(I,A,a[U][1]),n.vec3.add(M,M,I),n.vec3.add(M,M,Y),v[_++]=M[0],v[_++]=M[1],v[_++]=M[2],g[w++]=0;var Z=S/3;m[S++]=C[0],m[S++]=C[1],m[S++]=C[2];var K=j-p;for(U=0;U<c.length;U++)b[T++]=c[U][0]>=0?j+c[U][0]:-c[U][0]-1+K,b[T++]=c[U][2]>=0?j+c[U][2]:-c[U][2]-1+K,b[T++]=c[U][1]>=0?j+c[U][1]:-c[U][1]-1+K,x[E++]=Z,x[E++]=Z,x[E++]=Z;var Q={};Q[l.VertexAttrConstants.POSITION]=b,Q[l.VertexAttrConstants.NORMAL]=x;var J={};return J[l.VertexAttrConstants.POSITION]={size:3,data:v},J.zOffset={size:1,data:g},J[l.VertexAttrConstants.NORMAL]={size:3,data:m},new s(J,Q)},e.createPolylineGeometry=function(e,t){l.assert(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),l.assert(3===e[0].length,"createPolylineGeometry(): malformed vertex"),l.assert(void 0===t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),l.assert(void 0===t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var n=new Float32Array(3*e.length),i=new Uint32Array(2*(e.length-1)),r=0,o=0,a=0;a<e.length;a++){for(var c=0;c<3;c++)n[r++]=e[a][c];a>0&&(i[o++]=a-1,i[o++]=a)}var u={},d={};if(u[l.VertexAttrConstants.POSITION]=i,d[l.VertexAttrConstants.POSITION]={size:3,data:n},t){var f=new Float32Array(3*t.length),p=0;for(a=0;a<e.length;a++)for(c=0;c<3;c++)f[p++]=t[a][c];u[l.VertexAttrConstants.NORMAL]=i,d[l.VertexAttrConstants.NORMAL]={size:3,data:f}}return new s(d,u,s.DefaultOffsets,"line")},e.createExtrudedTriangle=function(e,t,n,i){for(var r,o,a=new Float32Array(18),c=[[-t,0,i/2],[n,0,i/2],[0,e,i/2],[-t,0,-i/2],[n,0,-i/2],[0,e,-i/2]],u=0;u<6;u++)a[3*u]=c[u][0],a[3*u+1]=c[u][1],a[3*u+2]=c[u][2];var d=((r={})[l.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),r),f=((o={})[l.VertexAttrConstants.POSITION]={size:3,data:a},o);return new s(f,d)},e.transformInPlace=function(e,t){for(var i=e.vertexAttributes[l.VertexAttrConstants.POSITION].data,r=0;r<i.length;r+=3){var o=i[r],a=i[r+1],s=i[r+2];n.vec3.set(v,o,a,s),n.vec3.transformMat4(v,v,t),i[r]=v[0],i[r+1]=v[1],i[r+2]=v[2]}},e.addVertexColors=function(e,t){var n=t||[1,1,1,1],i=new Uint8Array(4);i[0]=255*n[0],i[1]=255*n[1],i[2]=255*n[2],i[3]=255*(n.length>3?n[3]:1);var r={},o=e.getVertexAttr();for(var a in o)r[a]=o[a];r[l.VertexAttrConstants.COLOR]={size:4,data:i};var c={};for(var a in e.indices)c[a]=e.indices[a];var u=c[l.VertexAttrConstants.POSITION].length;return c[l.VertexAttrConstants.COLOR]=new Uint32Array(u),new s(r,c,e.componentOffsets,e.primitiveType)},e.addNormals=function(e){for(var t=e.getVertexAttr(),i=e.indices,r=a.Vec3Compact.subtract,o=i.position.length/3,s=new Float32Array(3*o),c=t.position.data,u=0,d=i.position,f=new Uint32Array(d.length),p=0;p<d.length;p+=3){r(c,3*d[p],c,3*d[p+2],g,0),r(c,3*d[p],c,3*d[p+1],v,0),n.vec3.cross(v,v,g),n.vec3.normalize(v,v);var h=u/3;s[u++]=v[0],s[u++]=v[1],s[u++]=v[2],f[p]=h,f[p+1]=h,f[p+2]=h}t[l.VertexAttrConstants.NORMAL]={size:3,data:s,offsetIdx:0,strideIdx:3},i[l.VertexAttrConstants.NORMAL]=f},e.cgToGIS=function(e,t){void 0===t&&(t=e);var n=e.getVertexAttr(),i=n.position.data,r=n.normal.data,o=t.getVertexAttr(),a=o.position.data,s=o.normal.data;if(r)for(var l=0;l<r.length;l+=3){var c=r[l+1];s[l+1]=-r[l+2],s[l+2]=c}if(i)for(l=0;l<i.length;l+=3)c=i[l+1],a[l+1]=-i[l+2],a[l+2]=c;return t},e.makeOrthoBasisDirUp=t,e.makeOrthoBasisDirUpFallback=f}(f||(f={}));var h=.99619469809,v=i.vec3f32.create(),g=i.vec3f32.create();return f}.apply(null,i))||(e.exports=r)},"6wId":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("9pvv")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.pluginContext=e,this.pluginsChanged=!1,this.renderPlugins=new Array,this.slots=[];for(var t=0;t<19;++t)this.slots[t]=[]}return e.prototype.add=function(e,t){this.renderPlugins.push(t);for(var n=0;n<e.length;++n){var i=e[n];this.slots[i].push(t)}t.initializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.remove=function(e){this.renderPlugins=this.renderPlugins.filter(function(t){return t!==e});for(var t=0;t<this.slots.length;++t)this.slots[t]=this.slots[t].filter(function(t){return t!==e});e.uninitializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.prepareRender=function(e){for(var t=0,n=this.renderPlugins;t<n.length;t++){var i=n[t];i.prepareRender&&i.prepareRender(e)}},e.prototype.render=function(e,t){t.slot=e;for(var n=!1,i=0,r=this.slots[e];i<r.length;i++){var o=r[i];o.render(t)&&(o.didRender=!0,n=!0)}return n},e.prototype.queryDepthRange=function(e){var t=r;t.near=1/0,t.far=-1/0;for(var i=0,o=this.renderPlugins;i<o.length;i++){var a=o[i];if(a.queryDepthRange){var s=a.queryDepthRange(e);s&&n.union(t,s,t)}}return t},e.prototype.needsRender=function(){if(this.pluginsChanged)return!0;for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsRender)return!0;return!1},e.prototype.needsHighlight=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsHighlight)return!0;return!1},e.prototype.needsLinearDepth=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsLinearDepth)return!0;return!1},e.prototype.resetNeedsRender=function(){this.pluginsChanged=!1;for(var e=0,t=this.renderPlugins;e<t.length;e++){var n=t[e];n.resetNeedsRender?n.resetNeedsRender():n.didRender&&(n.needsRender=!1,n.didRender=!1)}},e}();t.RenderPluginManager=i;var r={near:0,far:0}}.apply(null,i))||(e.exports=r)},"7XLS":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("9opi"),n("qKT0"),n("Gtr7"),n("Vx27")],void 0===(r=function(e,t,n,i,r,o){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshTimestamp=null,t}return n(t,e),t.prototype.refresh=function(e){void 0===e&&(e=Date.now()),this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh()},i([o.property()],t.prototype,"layer",void 0),i([o.aliasOf("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),i([o.property({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),i([o.subclass("esri.layers.mixins.RefreshableLayerView")],t)}(o.declared(r))}.apply(null,i))||(e.exports=r)},"7laH":function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}}.apply(null,i))||(e.exports=r)},"8fHt":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("HZ3d"),n("Q2wQ"),n("rusB"),n("jmRc"),n("BIt0"),n("Fsr7"),n("W7eI"),n("HSGS"),n("kfwU")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u){return function(){function e(){this.regularWriter=new c.RegularEdgeBufferWriter,this.silhouetteWriter=new c.SilhouetteEdgeBufferWriter}return e.prototype.process=function(e,t){return n(this,void 0,void 0,function(){var n,r,o;return i(this,function(i){switch(i.label){case 0:return t?(n=new Array,r=this.packInput(e,n),this.wrappedWork,[4,t.invoke("wrappedWork",r,{transferList:n})]):[3,2];case 1:return o=i.sent(),[2,this.unpackOutput(o)];case 2:return[2,this.work(e)]}})})},e.prototype.wrappedWork=function(e){return n(this,void 0,void 0,function(){var t,n,r;return i(this,function(i){return t=this.unpackInput(e),n=this.work(t),r=new Array,this.packInputTransferables(t,r),[2,{result:this.packOutput(n,r),transferList:r}]})})},e.prototype.work=function(e){var t=this.extractEdgeInformation(e.data,e.skipDeduplicate,e.originalIndices);return this.regularWriter.updateSettings(e.writerSettings),this.silhouetteWriter.updateSettings(e.writerSettings),u.extractEdges(t,this.regularWriter,this.silhouetteWriter)},e.prototype.packInputTransferables=function(e,t){t.push(e.data.buffer)},e.prototype.packInput=function(e,t){this.packInputTransferables(e,t);var n={dataBuffer:e.data.buffer,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate};return e.originalIndices&&(n.originalIndicesBuffer=e.originalIndices.buffer,n.originalIndicesType=r.isUint32Array(e.originalIndices)?"Uint32Array":"Uint16Array"),n},e.prototype.unpackInput=function(e){return{data:l.EdgeInputBufferLayout.createView(e.dataBuffer),originalIndices:"Uint32Array"===e.originalIndicesType?new Uint32Array(e.originalIndicesBuffer):"Uint16Array"===e.originalIndicesType?new Uint16Array(e.originalIndicesBuffer):void 0,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}},e.prototype.packOutput=function(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:s.packInterleavedBuffer(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:s.packInterleavedBuffer(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}},e.prototype.unpackOutput=function(e){return{regular:{instancesData:s.unpackInterleavedBuffer(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:s.unpackInterleavedBuffer(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}},e.prototype.extractEdgeInformation=function(e,t,n){if(t&&n)return{faces:n,neighbors:r=a.computeNeighbors(n,e.count),vertices:e};var i=o.default(e.buffer,e.stride/4,n),r=a.computeNeighbors(i.indices,i.uniqueCount);return{faces:i.indices,neighbors:r,vertices:l.EdgeInputBufferLayout.createView(i.buffer)}},e}()}.apply(null,i))||(e.exports=r)},"8nmy":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("qsST"),n("CIy2"),n("Zp3t")],void 0===(r=function(e,t,n,i,r){var o=n.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),a=function(){function e(e,t,n,i){this.NUM_PARALLEL=8,this._fallbackTexture=null,this._fallbackTextureTransparent=null,this.textures=e,this._programRepository=t,this.getViewportToRestore=n,this._rctx=i,this.NUM_PARALLEL=8,this.id2textureRef={},this.loading={},this._queue=[],this.listeners=[],this.afExt=i.capabilities.textureFilterAnisotropic,this.maxMaxAnisotropy=this.afExt?i.parameters.maxMaxAnisotropy:1,this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy),this._needsRender=!0,this._fallbackTextureData=new Uint8Array(256),this._fallbackTextureTransparentData=new Uint8Array(256);for(var r=0;r<this._fallbackTextureData.length;++r)this._fallbackTextureData[r]=255,this._fallbackTextureTransparentData[r]=(r+1)%4!=0?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}return e.prototype.resetNeedsRender=function(){this._needsRender=!1},e.prototype.needsRender=function(){return this._needsRender},e.prototype.aquire=function(t,n,r){var a=this,s=this.id2textureRef[t];if(null==s){var l=this.textures[t];i.assert(void 0!==l),l.setUnloadFunc(this._unload.bind(this));var c=!0===n,u=this._createGLTextureDescription(l);if(s=new e.TextureRef(null),i.assert(null==this.id2textureRef[t]),this.id2textureRef[t]=s,l.initializeThroughRender){var d=l.initializeThroughRender(this._rctx,u);s.setGLTexture(d),r&&r(s)}else if(l.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(t,u,r):this._queue.push([t,u,r]);else try{l.initializeThroughUpload(this._rctx,u,this._programRepository,this.getViewportToRestore(),function(e){s.setGLTexture(e),a._needsRender=!0,r&&r(s)})}catch(e){o.error("#aquire","Error loading texture: "+e.toString())}null==s.getGLTexture()&&s.setGLTexture(c?this.fallbackTextureTransparent:this.fallbackTexture),this._needsRender=!0}return s.incRefCnt(),s},e.prototype.release=function(e){var t=this.id2textureRef[e];void 0!==t&&(t.decRefCnt(),i.assert(t.getRefCnt()>=0))},e.prototype.getLoadingCount=function(){return Object.keys(this.loading).length},e.prototype.getTexture=function(e){return this.textures[e]},e.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy},e.prototype._unload=function(e){var t=this.id2textureRef[e];if(void 0!==t){var n=t.getGLTexture();n&&n.dispose(),delete this.id2textureRef[e]}this.next(e)},e.prototype._createGLTextureDescription=function(e){var t=e.params&&e.params.wrap;return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&e.params&&e.params.mipmap&&!e.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:t}},e.prototype.next=function(e){if(e in this.loading){delete this.loading[e];var t=Object.keys(this.id2textureRef),n=Object.keys(this.loading);this.listeners.forEach(function(i){i(e,t,n)}),this.processQueue()}},e.prototype._loadImage=function(e,t,n){var r=this;i.assert(null==this.loading[e]),this.loading[e]=!0;var o=this.textures[e];i.assert(void 0!==o),setTimeout(function(){var i=r.id2textureRef[e];i&&i.getRefCnt()&&o.initializeThroughUpload(r._rctx,t,r._programRepository,r.getViewportToRestore(),function(t){r.next(e),r._needsRender=!0,i&&i.getRefCnt()&&(i.setGLTexture(t),n&&n(i))})},0)},e.prototype.processQueue=function(){for(var e=[],t=0;t<this._queue.length;++t){var n=this._queue[t][0],i=this.id2textureRef[n];void 0!==i&&(0===i.getRefCnt()?(i.getGLTexture().dispose(),delete this.id2textureRef[n]):e.push(this._queue[t]))}this._queue=e;var r=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(t=0;t<r;++t)this._loadImage(this._queue[t][0],this._queue[t][1],this._queue[t][2]);this._queue.splice(0,r)},Object.defineProperty(e.prototype,"fallbackTexture",{get:function(){return this._fallbackTexture||(this._fallbackTexture=new r(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData)),this._fallbackTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fallbackTextureTransparent",{get:function(){return this._fallbackTextureTransparent||(this._fallbackTextureTransparent=new r(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData)),this._fallbackTextureTransparent},enumerable:!0,configurable:!0}),e}();return function(e){var t=function(){function e(e){this._glTexture=null,this._refCount=0,this._glTexture=e}return e.prototype.incRefCnt=function(){++this._refCount},e.prototype.decRefCnt=function(){--this._refCount,i.assert(this._refCount>=0)},e.prototype.getRefCnt=function(){return this._refCount},e.prototype.setGLTexture=function(e){this._glTexture=e},e.prototype.getGLTexture=function(){return this._glTexture},e}();e.TextureRef=t}(a||(a={})),a}.apply(null,i))||(e.exports=r)},"9DjX":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("jZlN"),n("LxLY"),n("YX1r"),n("51bw"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("2eYJ"),n("ZJC8")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h){function v(e,t){return i.isNone(e)||null==e.layerUid?null:i.isSome(t.graphicsView)&&e.layerUid===t.graphicsView.mockLayerId?t.graphics:t.map.findLayerByUid(e.layerUid)}function g(e,t,n){if(i.isNone(e))return null;var r=v(e,t);if(i.isNone(r))return null;if(r===t.graphics)return i.isSome(t.graphicsView)?i.expect(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;var o=t.allLayerViews.find(function(e){return e.layer===r});return o?m(o,e,n):null}function m(e,t,n){return!e||e.suspended?null:i.isSome(n)&&"getGraphicFromStageObject"in e?e.getGraphicFromStageObject(n.obj,n.triangleNr):"getGraphicFromGraphicUid"in e&&null!=t.graphicUid?e.getGraphicFromGraphicUid(t.graphicUid):null}function y(e,t){var n=e.metadata.layerUid;return null!=n?t.map.findLayerByUid(n):null}function b(e,t){var i=t.computeMapPointFromVec3d(e.point),r=new n(i),o=e.metadata.layerUid;if(null!=o){var a=t.map.findLayerByUid(o);r.layer=a,r.sourceLayer=a}return r}Object.defineProperty(t,"__esModule",{value:!0}),t.sliceFilterPredicate=function(e){return function(t,n,i){return l.vec3.lerp(E,t,n,i),!p.extrusionContainsPoint(e,E)}};var x=function(){this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.storeTerrainResults=!0,this.storeAll=!0};t.EnableIntersectorOptions=x;var _=function(){function e(){this._transform=s.mat4f64.create(),this._transformInverse=new S({value:this._transform},a.mat4.invert,s.mat4f64.create),this._transformInverseTranspose=new S(this._transformInverse,a.mat4.transpose,s.mat4f64.create),this._transformTranspose=new S({value:this._transform},a.mat4.transpose,s.mat4f64.create),this._transformInverseRotation=new S({value:this._transform},r.mat3.normalFromMat4Legacy,o.mat3f64.create)}return e.prototype.invalidateLazyTransforms=function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()},Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0}),e.prototype.setTransformMatrix=function(e){a.mat4.copy(this._transform,e)},e.prototype.multiplyTransform=function(e){a.mat4.multiply(this._transform,this._transform,e)},e.prototype.set=function(e){a.mat4.copy(this._transform,e),this.invalidateLazyTransforms()},e.prototype.setAndInvalidateLazyTransforms=function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()},e}();t.IntersectorTransform=_;var S=function(){function e(e,t,n){this.original=e,this.update=t,this.dirty=!0,this.transform=n()}return e.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform},enumerable:!0,configurable:!0}),e}(),w=function(){function e(){this.min=new T,this.max=new T,this.hud=new T,this.terrain=new T}return e.prototype.init=function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.terrain.init(e),this.all=[]},e}();t.IntersectorResults=w;var T=function(){function e(e){this.normal=c.vec3f64.create(),this.transformation=s.mat4f64.create(),this._ray=f.ray.create(),this.init(e)}return Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return l.vec3.scale(P,this.ray.direction,this.dist),l.vec3.length(P)},enumerable:!0,configurable:!0}),e.prototype.getIntersectionPoint=function(e){return!!this.hasIntersectionPoint&&(l.vec3.scale(P,this.ray.direction,this.dist),l.vec3.add(e,this.ray.origin,P),!0)},e.prototype.getTransformedNormal=function(e){return l.vec3.copy(C,this.normal),C[3]=0,u.vec4.transformMat4(C,C,this.transformation),l.vec3.copy(e,C),l.vec3.normalize(e,e),e},e.prototype.set=function(e,t,n,i,r,o,s,u,d,f){e instanceof h&&(e={type:"stage",obj:e}),this.dist=n,l.vec3.copy(this.normal,i),a.mat4.copy(this.transformation,r),this.target=e,this.name=t,this.drapedLayerOrder=o,this.center=s?c.vec3f64.clone(s):null,this.geometryId=u,this.triangleNr=d,this.drapedLayerGraphicOrder=f},e.prototype.copyFrom=function(e){f.ray.copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?c.vec3f64.clone(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,l.vec3.copy(this.normal,e.normal),a.mat4.copy(this.transformation,e.transformation)},e.prototype.init=function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?f.ray.copy(e,this._ray):this._ray=f.ray.create()},e.prototype.toOwner=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return v(this.target.obj.getMetadata(),e);case"external":switch(this.intersector){case"PointRenderer":return y(this.target,e);case"LodRenderer":case"DrapedRenderer":return v(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null},e.prototype.toGraphic=function(e){if(!this.target)return null;switch(this.target.type){case"stage":var t=this.target.obj,n=this.triangleNr;return g(t.getMetadata(),e,{obj:t,triangleNr:n});case"external":switch(this.intersector){case"PointRenderer":return b(this.target,e);case"LodRenderer":case"DrapedRenderer":return g(this.target.metadata,e,null)}}return null},e}();t.IntersectorResult=T,t.TERRAIN_ID="terrain";var E=c.vec3f64.create(),P=c.vec3f64.create(),C=d.vec4f64.create()}.apply(null,i))||(e.exports=r)},"9FJH":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("xhoE"),n("EiD/"),n("tUyH"),n("s6rJ")],void 0===(r=function(e,t,n,i,r,o){return function(e){function t(t,n,i,r,a,s){void 0===s&&(s=!1);var l=e.call(this,t,n)||this;return l.textureRep=i,l.textureId=r,l.initTransparent=s,l.glTextureRef=o.aquireIfNotUndefined(l.textureId,i,l.initTransparent),a&&(l.glTextureRefNormal=o.aquireIfNotUndefined(a,i,l.initTransparent)),l}return n(t,e),t.prototype.dispose=function(){o.releaseIfNotUndefined(this.textureId,this.textureRep)},t.prototype.updateTexture=function(e){e!==this.textureId&&(o.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=e,this.glTextureRef=o.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))},t.prototype.bindTexture=function(e,t){null!=this.glTextureRef&&(t.setUniform1i("tex",i.DefaultTextureUnits.DIFFUSE),e.bindTexture(this.glTextureRef.getGLTexture(),i.DefaultTextureUnits.DIFFUSE),this.glTextureRefNormal&&(t.setUniform1i("texNormal",i.DefaultTextureUnits.NORMAL),e.bindTexture(this.glTextureRefNormal.getGLTexture(),i.DefaultTextureUnits.NORMAL)))},t.prototype.bindTextureSize=function(e,t){if(null!=this.glTextureRef){var n=this.glTextureRef.getGLTexture();t.setUniform2f("texSize",n.descriptor.width,n.descriptor.height)}},t.prototype.bindTextureScale=function(e,t){var n=this.glTextureRef&&this.glTextureRef.getGLTexture();n&&n.descriptor.textureCoordinateScaleFactor?t.setUniform2fv("textureCoordinateScaleFactor",n.descriptor.textureCoordinateScaleFactor):t.setUniform2f("textureCoordinateScaleFactor",1,1)},t}(r)}.apply(null,i))||(e.exports=r)},"9o4r":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("GntT")],void 0===(r=function(e,t,n){function i(e,t,n){for(var i=e.typedBuffer,r=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=n?n.count:t.count,l=(n&&n.dstIndex?n.dstIndex:0)*r,c=(n&&n.srcIndex?n.srcIndex:0)*a,u=0;u<s;++u)i[l]=o[c],i[l+1]=o[c+1],l+=r,c+=a}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=i,t.normalizeIntegerBuffer=function(e,t,r){var o=e.typedBuffer,a=e.typedBufferStride,s=t.typedBuffer,l=t.typedBufferStride,c=r?r.count:t.count,u=(r&&r.dstIndex?r.dstIndex:0)*a,d=(r&&r.srcIndex?r.srcIndex:0)*l;if(n.isInteger(t.elementType)){var f=n.maximumValue(t.elementType);if(n.isSigned(t.elementType))for(var p=0;p<c;++p)o[u]=Math.max(s[d]/f,-1),o[u+1]=Math.max(s[d+1]/f,-1),u+=a,d+=l;else for(p=0;p<c;++p)o[u]=s[d]/f,o[u+1]=s[d+1]/f,u+=a,d+=l}else i(e,t,r);return e}}.apply(null,i))||(e.exports=r)},"9pvv":function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){function n(e,t){return{near:e,far:t}}function i(e,t,n){return e.near=t,e.far=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.empty=function(e){return e?i(e,1/0,-1/0):n(1/0,-1/0)},t.set=i,t.union=function(e,t,n){return void 0===n&&(n=e),n.near=Math.min(e.near,t.near),n.far=Math.max(e.far,t.far),n}}.apply(null,i))||(e.exports=r)},AASg:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){return function(){function e(){}return e.copyIntervals=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];t.push([i[0],i[1]])}return t},e.convertFaceToIndexRange=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];i[0]=i[0]*t,i[1]=i[1]*t+(t-1)}},e.sortIntervals=function(e){return e.sort(function(e,t){return e[0]===t[0]?e[1]>t[1]?1:e[1]<t[1]?-1:0:e[0]>t[0]?1:e[0]<t[0]?-1:0})},e.intersectIntervals=function(e,t){if(e.length<=0)return[];for(var n=[],i=0;i<e.length;i++){var r=e[i];if(!(r[1]<t[0]||r[0]>t[1])){var o=[r[0],r[1]];o[0]<t[0]&&(o[0]=t[0]),o[1]>t[1]&&(o[1]=t[1]),n.push(o)}}return n},e.mergeIntervals=function(e){if(e.length<=0)return[];var t=[];e=this.sortIntervals(e),t.push(e[0]);for(var n=1;n<e.length;n++){var i=t[t.length-1];i[1]+1<e[n][0]?t.push(e[n]):i[1]<e[n][1]&&(i[1]=e[n][1],t.pop(),t.push(i))}return t},e.invertIntervals=function(e,t){for(var n=[],i=0,r=0;r<e.length;r++){var o=e[r];o[0]>i&&n.push([i,o[0]-1]),i=o[1]+1}return i<=t&&n.push([i,t]),n},e.offsetIntervals=function(e,t){for(var n=[],i=0;i<e.length;i++){var r=e[i];n.push([r[0]+t,r[1]+t])}return n},e}()}.apply(null,i))||(e.exports=r)},AgDx:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("rjU6"),n("+nCE"),n("CIy2")],void 0===(r=function(e,t,n,i,r){function o(e){var t=r.getFirstObjectValue(e);return t.data.length/t.size}return function(){function e(t,r,a,s){void 0===r&&(r=e.DefaultIndices),void 0===a&&(a=e.DefaultOffsets),void 0===s&&(s="triangle"),this.preinterleaved=!1;var l={};for(var c in t){var u=t[c],d=u.data,f=u.size;l[c]={data:d,size:f,offsetIdx:0,strideIdx:f}}if(r===e.DefaultIndices){var p=o(l),h=i.generateDefaultIndexArray(p);for(var v in r={},l)r[v]=h}this._id=i.getNewId(),this._vertexAttributes=l,this._indices=r,this._componentOffsets=n.createOffsets(a),this._primitiveType=s}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){return r.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0}),e.prototype.getVertexAttr=function(){return this.vertexAttributes},e.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}},e.prototype.getIndices=function(e){return this._indices[e]},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){var e=0;if(this._indices.position){var t=3;e+=this._indices.position.length*t*4}if(this._indices.normal){t=3;e+=this._indices.normal.length*t*4}if(this._indices.uv0){t=2;e+=this._indices.uv0.length*t*4}if(this._indices.color){t=1;e+=this._indices.color.length*t*4}return e},e.DefaultIndices={},e.DefaultOffsets=new Uint32Array(0),e}()}.apply(null,i))||(e.exports=r)},B294:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("VfPl"),n("Zp3t")],void 0===(r=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new i(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1}),this.data=new n.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}return e.prototype.dispose=function(){this.texture.dispose(),this.texture=void 0,this.data=void 0},e.prototype.setData=function(e,t,n,i,r,o){var a=e*this.fieldCount+t;this.dirty=!0,this.data.set(a,0,n),this.data.set(a,1,i),this.data.set(a,2,r),this.data.set(a,3,o)},e.prototype.setDataElement=function(e,t,n,i){var r=e*this.fieldCount+t;this.dirty=!0,this.data.set(r,n,i)},e.prototype.resizeToFit=function(e){var t=e*this.fieldCount;if(t>=this.data.count){var i=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,r=new n.BufferViewVec4u8(new ArrayBuffer(4*i));r.typedBuffer.set(this.data.typedBuffer),this.data=r}},e.prototype.updateTexture=function(){if(this.dirty){var e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}},e.prototype.bind=function(e,t){this.rctx.bindTexture(this.texture,t.unit),e.setUniform1i(t.texName,t.unit),e.setUniform2f(t.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)},e}();t.TextureBackedBuffer=r}.apply(null,i))||(e.exports=r)},BIt0:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.computeNeighbors=function(e,t){for(var n=e.length/3,i=new Uint32Array(t+1),r=new Uint32Array(t+1),o=function(e,t){e<t?i[e+1]++:r[t+1]++},a=0;a<n;a++){var s=e[3*a],l=e[3*a+1],c=e[3*a+2];o(s,l),o(l,c),o(c,s)}var u=0,d=0;for(a=0;a<t;a++){var f=i[a+1],p=r[a+1];i[a+1]=u,r[a+1]=d,u+=f,d+=p}var h=new Uint32Array(6*n),v=i[t],g=function(e,t,n){if(e<t){var o=i[e+1]++;h[2*o]=t,h[2*o+1]=n}else o=r[t+1]++,h[2*v+2*o]=e,h[2*v+2*o+1]=n};for(a=0;a<n;a++)s=e[3*a],l=e[3*a+1],c=e[3*a+2],g(s,l,a),g(l,c,a),g(c,s,a);var m=function(e,t){for(var n=2*e,i=t-e,r=1;r<i;r++){for(var o=h[n+2*r],a=h[n+2*r+1],s=r-1;s>=0&&h[n+2*s]>o;s--)h[n+2*s+2]=h[n+2*s],h[n+2*s+3]=h[n+2*s+1];h[n+2*s+2]=o,h[n+2*s+3]=a}};for(a=0;a<t;a++)m(i[a],i[a+1]),m(v+r[a],v+r[a+1]);var y=new Int32Array(3*n),b=function(t,n){return t===e[3*n]?0:t===e[3*n+1]?1:t===e[3*n+2]?2:-1},x=function(e,t){var n=b(e,t);y[3*t+n]=-1};for(a=0;a<t;a++){for(var _=i[a],S=i[a+1],w=r[a],T=r[a+1];_<S&&w<T;){var E=h[2*_];E===(P=h[2*v+2*w])?(function(e,t,n,i){var r=b(e,t);y[3*t+r]=i;var o=b(n,i);y[3*i+o]=t}(a,h[2*_+1],P,h[2*v+2*w+1]),_++,w++):E<P?(x(a,h[2*_+1]),_++):(x(P,h[2*v+2*w+1]),w++)}for(;_<S;)x(a,h[2*_+1]),_++;for(;w<T;){var P;x(P=h[2*v+2*w],h[2*v+2*w+1]),w++}}return y}}.apply(null,i))||(e.exports=r)},BtPY:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("KY0m"),n("LxLY"),n("rusB")],void 0===(r=function(e,t,n,i,r){function o(e){return e.size*e.color[3]*e.opacity>0}function a(e,t){var i=n.binaryIndexOf(e,t,!0);return-1===i?t<e[0]?0:e.length:i}Object.defineProperty(t,"__esModule",{value:!0}),t.determineRendererType=function(e){for(var t=null,n=0,r=e;n<r.length;n++){var a=r[n],s=a.type;if(o(a))if(i.isNone(t))t=s;else if(t!==s)return"uber"}return i.isSome(t)?t:"solid"},t.determineAllTransparent=function(e){if(0===e.length)return!0;for(var t=0;t<e.length;t++)if(o(e[t].material))return!1;return!0},t.cloneIndices=function(e){if(Uint16Array.from)return r.isUint16Array(e)?Uint16Array.from(e):Uint32Array.from(e);for(var t=r.isUint16Array(e)?new Uint16Array(e.length):new Uint32Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return t},t.estimateLengthAtDistance=function(e,t,n,i){return n*(i/e)*2*Math.tan(.5*t)},t.findLowerBoundIndex=a,t.computeEdgeCount=function(e,t,n){return e.length-a(e,t*n.minimumEdgeLength)},t.fillComponenBufferIndices=function(e,t,n,i){for(var r=0;r<e.length;r++){var o=e[r].index,a=t[r],s=t[r+1];if(i)for(var l=a;l<s;l++){var c=i[l];n.set(c,o)}else for(l=a;l<s;l++)n.set(l,o)}}}.apply(null,i))||(e.exports=r)},C2Ab:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("ff/U"),n("zbgD"),n("U+8K")],void 0===(r=function(e,t,n,i,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return r.glslifyDefineMap({TEXTURING:"none"!==e.textureMode,TEXTURE_ATLAS:"AtlasTextured"===e.textureMode,VERTEXCOLORS:e.vertexColors,SYMBOLVERTEXCOLORS:e.symbolColors,FLIPV:e.flipV,DOUBLESIDED:e.doubleSided,WINDINGORDERDOUBLESIDED:e.windowOrderDoubleSided,INSTANCED:e.instanced,INSTANCED_DOUBLE_PRECISION:e.instancedDoublePrecision,INSTANCEDCOLOR:e.instancedColor,RECEIVE_SHADOWS:e.receiveShadows,RECEIVE_SSAO:e.receiveSSAO,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,SLICE:e.slice,GROUND_NORMAL_SHADING:e.groundNormalShading,NORMALS:{value:e.normals,options:{default:"NORMALS_DEFAULT",compressed:"NORMALS_COMPRESSED",screenDerivative:"NORMALS_SCREEN_DERIVATIVE"}},COMPONENTCOLORS:e.componentColor,TEXTURE_ALPHA_MODE_MASK:"mask"===e.textureAlphaMode,TEXTURE_ALPHA_MODE_MASK_BLEND:"maskBlend"===e.textureAlphaMode,TEXTURE_ALPHA_MODE_OPAQUE:"opaque"===e.textureAlphaMode,BIAS_SHADOWMAP:e.shadowMap,VERTEX_TANGENTS:"vertex"===e.tangents,TEXTURE_NORMALS:!!e.normalTexture,TEXTURE_COORDINATES:!!e.normalTexture||"none"!==e.textureMode,TREE_RENDERING:e.treeRendering,IOS_SAFARI_FIX:e.iosSafariFix,TEXTURE_ALPHA_PREMULTIPLIED:!!e.textureAlphaPremultiplied})};t.colorPass={name:"default-color",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("materials/defaultMaterial/colorPass.vert"),fragmentShader:o(e)+i.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:n.Default3D},t.depthPass={name:"default-depth",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("materials/defaultMaterial/depthPass.vert"),fragmentShader:o(e)+i.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},attributes:n.Default3D},t.normalPass={name:"default-normal",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("materials/defaultMaterial/normalPass.vert"),fragmentShader:o(e)+i.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:n.Default3D},t.highlightPass={name:"default-highlight",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),fragmentShader:o(e)+i.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},attributes:n.Default3D}}.apply(null,i))||(e.exports=r)},"Cvn+":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("W0kZ")],void 0===(r=function(e,t,n){return function(){function e(t,n,i,r,o,a){this.id=e._idGen.gen(t.id),this.geometry=t,this.material=n,this.transformation=i,this.instanceParameters=r,this.origin=o,this.shaderTransformation=a}return e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation},e._idGen=new n,e}()}.apply(null,i))||(e.exports=r)},D8s1:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("xoE+")],void 0===(r=function(e,t,n){return function(){function e(e,t){void 0===t&&(t=0),this.capacity=0,this.count=0,this.emptySlots=[],this.emptySlotCount=0,this.id2slot=new Map,this.slot2id=[],this.layout=e,this.resize(t)}return e.prototype.prepareAllocate=function(e){var t=this.count+e;t>this.capacity&&this.resize(t)},e.prototype.allocate=function(e){this.count>=this.capacity&&this.resize(this.count+1);var t=this.emptySlotCount>0?this.emptySlots[--this.emptySlotCount]:this.count;return this.id2slot.set(e,t),this.slot2id[t]=e,this.count++,t},e.prototype.prepareFree=function(e){this.emptySlots.length+=e},e.prototype.free=function(e){var t=this.id2slot.get(e);null!=t&&(this.emptySlots.length<=this.emptySlotCount&&(this.emptySlots.length=this.emptySlotCount+1),this.emptySlots[this.emptySlotCount++]=t,this.id2slot.delete(e),this.slot2id[t]=null,this.count--)},e.prototype.getCount=function(){return this.count},e.prototype.getSlot=function(e){return this.id2slot.get(e)},e.prototype.hasSlot=function(e){return this.id2slot.has(e)},e.prototype.getBuffer=function(){return this.buffer},e.prototype.compact=function(){if(this.emptySlotCount>0){var e=this.emptySlots,t=this.emptySlotCount,n=this.count+t;for(e.length=t,e.sort(function(e,t){return e-t});t>0;){if(e[t-1]!==n-1){var i=n-1,r=e[t-1];this.buffer.copyFrom(this.buffer,i,r,1);var o=this.slot2id[i];this.slot2id[i]=null,this.slot2id[r]=o,this.id2slot.set(o,r)}t--,n--}}this.emptySlotCount=0,this.emptySlots.length=0,this.resize(this.count)},e.prototype.resize=function(e){var t=this.capacity;if((e=Math.max(0,e))>0&&(e=n.nextHighestPowerOfTwo(e)),e>t){var i=this.layout.createBuffer(e);this.buffer&&i.copyFrom(this.buffer,0,0,t),this.buffer=i}else if(e<t){(i=this.layout.createBuffer(e)).copyFrom(this.buffer,0,0,e),this.buffer=i}this.buffer||(this.buffer=this.layout.createBuffer(0)),this.capacity=e,this.slot2id.length=e},e}()}.apply(null,i))||(e.exports=r)},DXwx:function(e,t,n){var i;void 0===(i=function(){function e(e){if(null==c)for(var t in c={},u={},e)"number"==typeof e[t]&&(c[e[t]]=t,u[t]=e[t])}function t(){if(null==c)throw"WebGLDebugUtils.init(ctx) not called"}function n(e){t();var n=c[e];return void 0!==n?"gl."+n:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function i(e,t,i,r){var o;if(void 0!==(o=l[e])&&(void 0!==(o=o[t])&&o[i])){if("object"==typeof o[i]&&void 0!==o[i].enumBitwiseOr){for(var a=o[i].enumBitwiseOr,s=0,c=[],d=0;d<a.length;++d){var f=u[a[d]];0!=(r&f)&&(s|=f,c.push(n(f)))}return s===r?c.join(" | "):n(r)}return n(r)}return null===r?"null":void 0===r?"undefined":r.toString()}function r(e,t,n){e.__defineGetter__(n,function(){return t[n]}),e.__defineSetter__(n,function(e){t[n]=e})}function o(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var i=0;i<t;++i)e.disableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(i,0);e.deleteBuffer(n);var r=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(i=0;i<r;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}var a=function(e){window.console&&window.console.log&&window.console.log(e)},s=function(e){window.console&&window.console.error?window.console.error(e):a(e)},l={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},c=null,u=null;return{init:e,mightBeEnum:function(e){return t(),void 0!==c[e]},glEnumToString:n,glFunctionArgToString:i,glFunctionArgsToString:function(e,t){for(var n="",r=t.length,o=0;o<r;++o)n+=(0==o?"":", ")+i(e,r,o,t[o]);return n},makeDebugContext:function t(o,a,l,c){function u(e,t){return function(){l&&l(t,arguments);var n=e[t].apply(e,arguments),i=c.getError();return 0!=i&&(d[i]=!0,a(i,t,arguments)),n}}c=c||o,e(o),a=a||function(e,t,r){for(var o="",a=r.length,l=0;l<a;++l)o+=(0==l?"":", ")+i(t,a,l,r[l]);s("WebGL error "+n(e)+" in "+t+"("+o+")")};var d={},f={};for(var p in o)if("function"==typeof o[p])if("getExtension"!=p)f[p]=u(o,p);else{var h=u(o,p);f[p]=function(){return t(h.apply(o,arguments),a,l,c)}}else r(f,o,p);return f.getError=function(){for(var e in d)if(d.hasOwnProperty(e)&&d[e])return d[e]=!1,e;return o.NO_ERROR},f},makeLostContextSimulatingCanvas:function(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function n(){for(var e=Object.keys(_),t=0;t<e.length;++t)delete _[e]}function i(){++y,v||m==y&&e.loseContext()}function a(e,t){var n=e[t];return function(){if(i(),!v)return n.apply(e,arguments)}}function s(){for(var e=0;e<g.length;++e){var t=g[e];t instanceof WebGLBuffer?u.deleteBuffer(t):t instanceof WebGLFramebuffer?u.deleteFramebuffer(t):t instanceof WebGLProgram?u.deleteProgram(t):t instanceof WebGLRenderbuffer?u.deleteRenderbuffer(t):t instanceof WebGLShader?u.deleteShader(t):t instanceof WebGLTexture&&u.deleteTexture(t)}}function l(e){return{statusMessage:e,preventDefault:function(){b=!0}}}function c(e){for(var t in e)"function"==typeof e[t]?p[t]=a(e,t):r(p,e,t);p.getError=function(){if(i(),!v)for(;e=u.getError();)_[e]=!0;for(var e in _)if(_[e])return delete _[e],e;return p.NO_ERROR};for(var n=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],o=0;o<n.length;++o)p[c=n[o]]=function(t){return function(){if(i(),v)return null;var n=t.apply(e,arguments);return n.__webglDebugContextLostId__=h,g.push(n),n}}(e[c]);var s=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(o=0;o<s.length;++o)p[c=s[o]]=function(t){return function(){return i(),v?null:t.apply(e,arguments)}}(p[c]);var l=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(o=0;o<l.length;++o){var c;p[c=l[o]]=function(t){return function(){return i(),!v&&t.apply(e,arguments)}}(p[c])}return p.checkFramebufferStatus=function(t){return function(){return i(),v?p.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(p.checkFramebufferStatus),p.getAttribLocation=function(t){return function(){return i(),v?-1:t.apply(e,arguments)}}(p.getAttribLocation),p.getVertexAttribOffset=function(t){return function(){return i(),v?0:t.apply(e,arguments)}}(p.getVertexAttribOffset),p.isContextLost=function(){return v},p}var u,d=[],f=[],p={},h=1,v=!1,g=[],m=0,y=0,b=!1,x=0,_={};e.getContext=function(t){return function(){var n=t.apply(e,arguments);if(n instanceof WebGLRenderingContext){if(n!=u){if(u)throw"got different context";p=c(u=n)}return p}return n}}(e.getContext);var S=function(e){d.push(t(e))},w=function(e){f.push(t(e))};return function(e){var t=e.addEventListener;e.addEventListener=function(n,i,r){switch(n){case"webglcontextlost":S(i);break;case"webglcontextrestored":w(i);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!v){for(v=!0,m=0,++h;u.getError(););n(),_[u.CONTEXT_LOST_WEBGL]=!0;var t=l("context lost"),i=d.slice();setTimeout(function(){for(var n=0;n<i.length;++n)i[n](t);x>=0&&setTimeout(function(){e.restoreContext()},x)},0)}},e.restoreContext=function(){v&&f.length&&setTimeout(function(){if(!b)throw"can not restore. webglcontestlost listener did not call event.preventDefault";s(),o(u),v=!1,y=0,b=!1;for(var e=f.slice(),t=l("context restored"),n=0;n<e.length;++n)e[n](t)},0)},e.loseContextInNCalls=function(e){if(v)throw"You can not ask a lost contet to be lost";m=y+e},e.getNumCalls=function(){return y},e.setRestoreTimeout=function(e){x=e},e},resetToInitialState:o}}.apply(null,[]))||(e.exports=i)},Dk48:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("9opi"),n("qKT0"),n("Gtr7"),n("Vx27")],void 0===(r=function(e,t,n,i,r,o){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_VISUALIZE_BLOCKS=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_OUTLINES=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_TEST_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING=!1,t.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1,t.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,t.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t.DISABLE_FAST_UPDATES=!1,t.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,t.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,t}return n(t,e),i([o.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),i([o.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),i([o.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),i([o.property()],t.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0),i([o.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),i([o.property()],t.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0),i([o.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),i([o.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),i([o.property()],t.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0),i([o.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),i([o.property()],t.prototype,"TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING",void 0),i([o.property()],t.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0),i([o.property()],t.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),i([o.property()],t.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0),i([o.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),i([o.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),i([o.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),i([o.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),i([o.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),i([o.property()],t.prototype,"DISABLE_FAST_UPDATES",void 0),i([o.property()],t.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),i([o.property()],t.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),i([o.subclass()],t)}(o.declared(r)))}.apply(null,i))||(e.exports=r)},DlJW:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("7laH")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e){if(n.default(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};var t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}}.apply(null,i))||(e.exports=r)},"E/UE":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("2Atf"),n("xhoE"),n("YX1r"),n("51bw"),n("AzkI"),n("s6rJ"),n("+YS2")],void 0===(r=function(e,t,n,i,r,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.LINE_WIDTH_FRACTION_FACTOR=8,t.EXTENSION_LENGTH_OFFSET=128;var c={type:"uber",slicePlaneEnabled:!1,strokesTexture:null},u=function(){function e(){this._value=0}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.increment=function(){this._value++},e.prototype.decrement=function(){this._value--},e}(),d=function(){function e(t,i,r){this.rctx=t,this.programRepository=i,this.refCount=new u,this.renderables=new Set,this.depthBiasZ=-4e-4,this.depthBiasXY=.5,this.tmpViewToWorldNormalMatrix=o.mat3f64.create(),this.settings=n({},c,r),this.key=e.getKey(this.settings.type,this.settings.slicePlaneEnabled);var a=this.settings.strokesTexture.variants;this.writerSettings={variants:a},this.createPrograms()}return e.prototype.dispose=function(){for(var e in this.programs){var t=this.programs[e];t&&(this.programRepository.decreaseRefCount(t),this.programs[e]=null)}},e.prototype.addRenderable=function(e){this.renderables.add(e)},e.prototype.removeRenderable=function(e){this.renderables.delete(e)},e.prototype.forEachRenderable=function(e){this.renderables.forEach(e)},e.prototype.bindRegularEdges=function(e,t){this.bind(this.programs.regular,e,t)},e.prototype.bindSilhouetteEdges=function(e,t){this.bind(this.programs.silhouette,e,t)},e.prototype.bind=function(e,t,n){this.rctx.bindProgram(e),e.setUniformMatrix4fv("uProj",t.proj),e.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ),e.setUniform2f("uPixelToNDC",2/t.viewport[2],2/t.viewport[3]),e.setUniform2f("uNDCToPixel",t.viewport[2]/2,t.viewport[3]/2),e.setUniform1f("uDistanceFalloffFactor",n.distanceFalloffFactor),e.setUniform2f("uViewportDimInv",1/t.viewport[2],1/t.viewport[3]),e.setUniform1f("uPixelRatio",t.pixelRatio||1)},e.prototype.renderRegularEdges=function(e,t,n){this.render(this.programs.regular,e,e.regular.vao,t,n)},e.prototype.renderSilhouetteEdges=function(e,t,n){this.render(this.programs.silhouette,e,e.silhouette.vao,t,n)},e.prototype.render=function(e,t,n,i,r){this.setUniforms(e,t,i);var o=this.rctx;o.bindVAO(n),o.capabilities.instancing.drawArraysInstanced(6,0,4,r)},e.prototype.setUniforms=function(e,n,i){n.components.buffer.textureBuffer.bind(e,t.componentDataBindParameters),e.setUniformMatrix4fv("uView",i.view),e.setUniformMatrix4fv("uModel",n.transform.modelMatrix);var o=i.viewInvTransp,a=r.mat3.fromMat4(this.tmpViewToWorldNormalMatrix,o);e.setUniform3f("uCameraPosition",o[3],o[7],o[11]),e.setUniformMatrix3fv("uViewToWorldNormalMatrix",a),"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(e),e.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(i.fovY/2)/(i.viewport[3]/2)),e.setUniform3fv("uLocalOrigin",n.transform.origin.vec3),this.settings.slicePlaneEnabled&&s.bindSlicePlane(n.transform.origin.vec3,i.slicePlane,e)},e.prototype.setSketchUniforms=function(e){var t=this.settings.strokesTexture,n=t.texture;this.rctx.bindTexture(n,0),e.setUniform1i("uStrokesTexture",0),e.setUniform2f("uStrokesTextureScale",1/n.descriptor.width,1/n.descriptor.height),e.setUniform1f("uStrokesLog2Resolution",a.log2(t.resolution)),e.setUniform1f("uStrokesNormalizationScale",t.normalizationScale),e.setUniform1f("uStrokesAmplitude",t.amplitude),e.setUniform1f("uStrokeVariants",t.variants)},e.prototype.getOptions=function(e){return n({},e,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.type,slice:this.settings.slicePlaneEnabled})},e.prototype.createPrograms=function(){var e=this.programRepository.getProgram(l.program,this.getOptions({silhouette:!1})),t=this.programRepository.getProgram(l.program,this.getOptions({silhouette:!0}));this.programRepository.increaseRefCount(e),this.programRepository.increaseRefCount(t),this.programs={regular:e,silhouette:t}},e.getKey=function(e,t){return"edges-t:"+e+":"+t},e}();t.EdgeRenderer=d,t.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}}.apply(null,i))||(e.exports=r)},"EiD/":function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultTextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2}}.apply(null,i))||(e.exports=r)},EyQ4:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("Zp3t")],void 0===(r=function(e,t,n){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}Object.defineProperty(t,"__esModule",{value:!0});var r=542327876,o=131072,a=4,s=33776,l=33778,c=33779,u=i("DXT1"),d=i("DXT3"),f=i("DXT5"),p=31,h=0,v=1,g=2,m=3,y=4,b=7,x=20,_=21;t.createDDSTexture=function(e,t,i,S){var w,T,E=new Int32Array(i,0,p);if(E[h]!==r)return null;if(!(E[x]&a))return null;switch(E[_]){case u:w=8,T=s;break;case d:w=16,T=l;break;case f:w=16,T=c;break;default:return null}var P=1;E[g]&o&&!1!==S&&(P=Math.max(1,E[b]));for(var C,A,O=E[y],R=E[m],M=E[v]+4,D=[],I=0;I<P;++I)A=Math.floor((O+3)/4)*Math.floor((R+3)/4)*w,C=new Uint8Array(i,M,A),D.push(C),M+=A,O=Math.max(1,O>>1),R=Math.max(1,R>>1);t.samplingMode=P>1?9987:9729,t.hasMipmap=P>1,t.width=E[y],t.height=E[m],t.internalFormat=T;var L=new n(e,t,{type:"compressed",levels:D});return e.bindTexture(L),L}}.apply(null,i))||(e.exports=r)},FM7k:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("LxLY"),n("23eD"),n("DIqE"),n("Dk48"),n("CIy2"),n("3RHn"),n("9pvv"),n("1bVs"),n("xgKb"),n("2f4f"),n("nBma"),n("Raj5"),n("6wId"),n("doLD"),n("2CPm"),n("jlKI"),n("Lb4W"),n("CIy2"),n("Q55v"),n("QDiq"),n("xFEL"),n("deO7"),n("Zp3t")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v,g,m,y,b,x,_,S,w,T){function E(e,t){var n=new Map,i=null,r=null,o=function(e){if(e===i)return r;var t=n.get(e);return t||(t={toAdd:[],toRemove:[],toUpdate:[]},n.set(e,t)),i=e,r=t,t};e.toAdd.forEach(function(e){P(e)&&o(e.material).toAdd.push(e)}),e.toRemove.forEach(function(e){P(e)&&o(e.material).toRemove.push(e)});var a=0;return e.toUpdate.forEach(function(e){P(e.renderGeometry)&&(o(e.renderGeometry.material).toUpdate.push(e),a|=e.updateType)}),t&&(t.updateTypes=a),n}function P(e){return C(e.data)>=1}function C(e){return!1===e.preinterleaved?b.getFirstObjectValue(e.indices).length:e.indexCount}function A(e,t){return e.isVisible()&&e.isVisibleInPass(t.pass)&&0!=(e.renderOccluded&t.renderOccludedMask)}var O=function(){function e(t,n,i,r,o,a){var s=this;this._materialRenderers=new Map,this._orderedMaterialRenderers=[],this._hasHighlights=!1,this._lighting=new _.SceneLighting,this._content=new Map,this._isRendering=!1,this._needsRender=!0,this._fallbackDepthStencilTexture=null,this._stats=new e.RenderStats,this._edgeView=null,this.renderOptions={antialiasing:"smaa"},this._programRep=t,this._materialRep=n,this._rctx=r,this._mode=o,this._stage=a,this._fxaaPass=new u(r),this._smaaPass=new m(r),this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null},this._offscreenRendering=new f(t,this._rctx),this._sliceHelper=new g,"scene"===this._mode&&(this._shadowMap=new v(this._rctx),this._ssaoHelper=new y(t,this._rctx,function(){s._needsRender=!0}),this._highlightHelper=new d(t,this._rctx)),this._renderPlugins=new h.RenderPluginManager({rctx:r,programRep:t,textureRep:i,materialRep:n}),this._renderContext=new p(r,this._offscreenRendering,this._lighting.getOld(),this._shadowMap,this._ssaoHelper,this._sliceHelper)}return e.prototype.dispose=function(){this._materialRenderers.forEach(function(e){e.dispose()}),this._materialRenderers=null,this._orderedMaterialRenderers=null,this._edgeView&&(this._edgeView.destroy(),this._edgeView=null),this._offscreenRendering.enabled=!1,this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null),this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose()),this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose()),this._highlightHelper&&(this._highlightHelper.enabled=!1),s.tmpIndices.prune(),this._content.clear(),this._content=null},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.ensureEdgeView=function(){var e=this;return null==this._edgeView&&(this._edgeView=new x.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){return e._needsRender=!0}}),this._edgeView.initialize()),this._edgeView},Object.defineProperty(e.prototype,"edgeView",{get:function(){return this._edgeView},enumerable:!0,configurable:!0}),e.prototype.setLighting=function(e){this._lighting.set(e)},e.prototype.setRenderParams=function(e){void 0!==e.shadowMapResolution&&!1===this._shadowMap.enabled&&(this._shadowMap.textureResolution=e.shadowMapResolution),void 0!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap),void 0!==e.shadowMapMaxCascades&&(this._shadowMap.maxCascades=e.shadowMapMaxCascades),this._highlightHelper.enabled=!0,void 0!==e.ssao&&(this._ssaoHelper.enabled=e.ssao),void 0!==e.ssaoAttenuation&&(this._ssaoHelper.attenuation=e.ssaoAttenuation),void 0!==e.ssaoRadius&&(this._ssaoHelper.radius=e.ssaoRadius),e.ssaoFilterRadius,void 0!==e.ssaoSamples&&(this._ssaoHelper.samples=e.ssaoSamples),e.background&&(this._offscreenRendering.background=e.background),void 0!==e.antialiasingEnabled&&(this.renderOptions.antialiasing=e.antialiasingEnabled?"smaa":"none"),void 0!==e.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(e.defaultHighlightOptions),void 0!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane),this._needsRender=!0},Object.defineProperty(e.prototype,"hasSlicePlane",{get:function(){return!!this._sliceHelper.plane},enumerable:!0,configurable:!0}),e.prototype.getRenderParams=function(){var e={};return this._shadowMap&&(e.shadowMap=this._shadowMap.enabled,e.shadowMapResolution=this._shadowMap.textureResolution,e.shadowMapMaxCascades=this._shadowMap.maxCascades),this._ssaoHelper&&this._ssaoHelper.isSupported&&(e.ssao=this._ssaoHelper.enabled,e.ssaoAttenuation=this._ssaoHelper.attenuation,e.ssaoRadius=this._ssaoHelper.radius,e.ssaoFilterRadius=this._ssaoHelper.filterRadius,e.ssaoSamples=this._ssaoHelper.samples),e},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderPlugins.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderPlugins.needsRender()},e.prototype.getCombinedStats=function(){return this._stats.VBOallocatedSize=0,this._stats.VBOoptimalSize=0,this._stats.VBOusedSize=0,this._stats.VBOallocatedSize*=4/1024,this._stats.VBOusedSize*=4/1024,this._stats.VBOoptimalSize*=4/1024,this._stats},e.prototype.getFramebufferTexture=function(e){switch(e){case"color":return this._offscreenRendering.colorTexture;case"hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case"shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();case"linearDepth":return this._offscreenRendering.linearDepthTexture;case"normals":return this._offscreenRendering.normalTexture;case"highlight":return this._offscreenRendering.highlightTexture}return null},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._materialRenderers.size},e.prototype.modify=function(e,t,n,i){var r=this;void 0===n&&(n=[]),this._isRendering;for(var o=0;o<t.length;++o)this._content.delete(t[o].uniqueName);for(o=0;o<e.length;++o)this._content.set(e[o].uniqueName,e[o]);if(n)for(o=0;o<n.length;++o)a.assert(this._content.get(n[o].renderGeometry.uniqueName)===n[o].renderGeometry);if(e.length||t.length||n.length){var s=E({toAdd:e,toRemove:t,toUpdate:n}),l=!1;s.forEach(function(e,t){var n=r._materialRenderers.get(t);!n&&e.toAdd.length>0&&(n=t.createRenderer(r._rctx,r._materialRep),r._materialRenderers.set(t,n),r._orderedMaterialRenderers.push(n),r.sortOrderedMaterialRenderers()),n&&(n.modify(e),n.isEmpty&&(l=!0))}),l&&this._materialRenderers.forEach(function(e,t){e.isEmpty&&(r._materialRenderers.delete(t),r._orderedMaterialRenderers.splice(r._orderedMaterialRenderers.indexOf(e),1),e.dispose())});var c=!1;this._materialRenderers.forEach(function(e){c=c||e.hasHighlights}),c!==this._hasHighlights&&(this.onHasHighlightsChanged&&this.onHasHighlightsChanged(c),this._hasHighlights=c),this._needsRender=!0}i&&(i.forEach(function(e){r._materialRep.updateMaterialParameters(e)}),this._needsRender=!0)},e.prototype.modifyRenderOrder=function(e){"draped"===this._mode&&(this.sortOrderedMaterialRenderers(),this._needsRender=!0)},e.prototype.render=function(e){switch(this._mode){case"scene":this.renderScene(e);break;case"draped":this.renderDraped(e)}this.onPostRender&&this.onPostRender()},e.prototype.renderPass=function(e,t){this.renderGeometryPass(e,t)},e.prototype.renderScene=function(e){var t=this;this._isRendering=!0;var n=this._rctx,i=this._offscreenRendering,r=this._ssaoHelper,o=e.camera,a=e.fbo,s=this._sliceHelper.plane;e.disableSlice&&(this._sliceHelper.plane=null),this.prepareRender(o),this.renderShadowMap(e),i.enabled=!0,i.initializeFrame(o,a),this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth()?i.renderToTargets(function(){t.renderGeometryPass(1,e)},i.linearDepth,i.tmpDepth,[0,0,0,0],!0):i.disposeTarget(i.linearDepth),this._ssaoHelper.enabled?i.renderToTargets(function(){t.renderGeometryPass(2,e)},i.normal,i.tmpDepth,[0,0,0,0],!0):i.disposeTarget(i.normal),this._ssaoHelper.enabled&&r.computeSSAO(o,i.linearDepthTexture,i.normalTexture),r.bindAll(this._programRep),this._stats.reset(),this.updateGlobalUniforms(o.projectionMatrix),this._renderContext.pass=0,this._renderContext.camera=o,this._renderContext.options=this.renderOptions,i.bindTarget(i.mainColor,i.mainDepth),this._renderPlugins.render(0,this._renderContext),this.renderGeometrySlotsPt1(this._renderContext),this._edgeView&&this._edgeView.shouldRender()&&i.renderSeparateAndComposite(function(){return t._edgeView.render(t._bindParameters)},void 0,"alpha");var l={hudVisibility:!1,transparentTerrain:!1};l.hudVisibility=this.renderHUDVisibility(this._renderContext),this.renderInternalSlot(17,this._renderContext),l.transparentTerrain=this.renderTransparentTerrain(this._renderContext),l.transparentTerrain&&l.hudVisibility&&(i.compositeTransparentTerrainOntoHUDVisibility(),i.renderToTargets(function(){return t.renderHUD("occluded")},i.mainColor,i.tmpDepth,void 0,!0)),l.transparentTerrain&&i.compositeTransparentTerrainOntoMain(),i.renderToTargets(function(){t.renderInternalSlot(9,t._renderContext),t._renderPlugins.render(13,t._renderContext),t._renderPlugins.render(14,t._renderContext)},i.mainColor,i.mainDepth),this.renderOccluded();var c=this.renderOptions.antialiasing;"smaa"===c&&this._smaaPass.loadResources(function(){t._needsRender=!0}),"smaa"===c&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:i.colorTexture},a)):"fxaa"===c&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:i.colorTexture},a)):(i.composite(),this._fxaaPass.disable(),this._smaaPass.disable()),n.bindFramebuffer(a),this.renderHUD("notOccluded"),this.renderHighlights(e,a),this._sliceHelper.plane=s,this._isRendering=!1},e.prototype.renderDraped=function(e){this._stats.reset(),this.renderGeometryPass(0,e)},e.prototype.prepareRender=function(e){this._renderPlugins.prepareRender(e)},e.prototype.renderShadowMap=function(e){var t=this._shadowMap,n=e.camera,r=e.fbo,a=e.lightDirection;if(t.enabled){o.ENABLE_PROFILE_DEPTH_RANGE&&i.begin("depthRange");var s=this.computeDepthRange(n);o.ENABLE_PROFILE_DEPTH_RANGE&&i.end("depthRange"),t.prepare(n,a,s);for(var l=t.getCascades(),c=0;c<l.length;++c){var u=l[c];u.camera.setGLViewport(this._rctx),e.camera=u.camera,this.renderGeometryPass(3,e)}e.camera=n,t.finish(r),n.setGLViewport(this._rctx)}t.bindAll(this._programRep)},e.prototype.computeDepthRange=function(e){var t=c.depthRangeFromScene(e,this._content,this._stage.getLayers());return l.union(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t},e.prototype.renderGeometryPass=function(e,t){this._isRendering=!0;var n=t.camera;this.updateGlobalUniforms(n.projectionMatrix),this._renderContext.pass=e,this._renderContext.camera=n,"draped"===this._mode?this.renderGeometryPassDraped(this._renderContext):this.renderGeometryPassScene(this._renderContext),this._isRendering=!1},e.prototype.renderGeometryPassDraped=function(e){var t=this,n=e.camera;this._bindParameters.view=n.viewMatrix,this._bindParameters.proj=n.projectionMatrix,this._bindParameters.viewInvTransp=n.viewInverseTransposeMatrix,R[0]=n.near,R[1]=n.far,this._bindParameters.nearFar=R,this._bindParameters.lightingData=e.lightingData,this._bindParameters.viewport=n.fullViewport,this._bindParameters.pixelRatio=n.pixelRatio,this._bindParameters.slicePlane=e.sliceHelper&&e.sliceHelper.plane,this._bindParameters.highlightDepthTexture=this.getFallbackDepthTexture(),this._orderedMaterialRenderers.forEach(function(n){n.render(null,e,t._bindParameters)})},e.prototype.renderGeometryPassScene=function(e){this.renderGeometrySlotsPt1(e),this.renderTransparentTerrain(e)},e.prototype.renderGeometrySlotsPt1=function(e){this._renderPlugins.render(1,e),this.renderInternalSlot(2,e),this._renderPlugins.render(3,e),this.renderInternalSlot(4,e),this._renderPlugins.render(5,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep),this._renderPlugins.render(12,this._renderContext),this.renderInternalSlot(6,e),this._renderPlugins.render(7,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep)},e.prototype.renderTransparentTerrain=function(e){return this._renderPlugins.render(8,e)},e.prototype.renderHUDVisibility=function(e){var t=this,n=S.shouldRenderVisibilityDuringRenderPass(e.pass),i=e.offscreenRenderingHelper&&e.offscreenRenderingHelper.enabled,r=!1;return n&&i&&e.offscreenRenderingHelper.renderHUDVisibility(function(){r=t.renderInternalSlot(10,e)}),r},e.prototype.renderHUD=function(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this.renderInternalSlot(18,this._renderContext),this.renderInternalSlot(15,this._renderContext),this.renderInternalSlot(16,this._renderContext)},e.prototype.renderHighlights=function(e,t){var n=this,i=this._highlightHelper;if(i&&i.enabled&&(this.hasHighlights||this._renderPlugins.needsHighlight())){var r=null;i.profilingCallback&&(r=w.startMeasurement(this._renderContext.rctx));var o=this._offscreenRendering,a=o.renderToTargets(function(){n.renderGeometryPass(4,e),n._rctx.clearSafe(256),n.renderHUD("both")},o.highlight,o.tmpDepth,[0,0,0,0],!0);i.render(e.camera,a,t),null!==r&&i.profilingCallback&&r.stop(function(e){i.profilingCallback&&i.profilingCallback(e)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)},e.prototype.renderOccluded=function(){var e=this;if(this._materialRenderers.forEach(function(e,t){t&&t.isVisible()&&1!==t.renderOccluded&&M.push(t)}),0!==M.length){var t=this._offscreenRendering,n=this._renderContext,i=function(i,r){n.renderOccludedMask=r,t.renderToTargets(function(){e.renderInternalSlot(4,n,M),e.renderInternalSlot(6,n,M),e.renderInternalSlot(9,n,M)},t.tmpColor,t.tmpDepth,[0,0,0,0],!0),n.resetRenderOccludedMask(),t.compositeOccludedOntoMain(i)};n.pass=0,i(.4,4),i(.5,2),i(1,8),M.length=0}},e.prototype.renderInternalSlot=function(e,t,n){this._bindParameters.view=t.camera.viewMatrix,this._bindParameters.proj=t.camera.projectionMatrix,this._bindParameters.viewInvTransp=t.camera.viewInverseTransposeMatrix,this._bindParameters.cameraAboveGround=t.camera.aboveGround,this._bindParameters.fovY=t.camera.fovY,R[0]=t.camera.near,R[1]=t.camera.far;var i=this._renderContext.offscreenRenderingHelper;return this._bindParameters.nearFar=R,this._bindParameters.lightingData=t.lightingData,this._bindParameters.viewport=t.camera.fullViewport,this._bindParameters.shadowMap=t.shadowMap,this._bindParameters.shadowMappingEnabled=!!t.shadowMap&&t.shadowMap.enabled,this._bindParameters.ssaoEnabled=!!t.ssaoHelper&&t.ssaoHelper.enabled,this._bindParameters.pixelRatio=t.camera.pixelRatio,this._bindParameters.slicePlane=t.sliceHelper&&t.sliceHelper.plane,this._bindParameters.hudVisibilityTexture=i?i.hudVisibilityTexture:null,this._bindParameters.highlightDepthTexture=i&&i.depthTexture||this.getFallbackDepthTexture(),this.renderInternalSlotMaterials(e,t,n)},e.prototype.renderInternalSlotMaterials=function(e,t,i){var r=this,o=!1;return n.isSome(i)?i.forEach(function(n){if(A(n,t)){var i=r._materialRenderers.get(n);o=i.render(e,t,r._bindParameters)||o}}):this._materialRenderers.forEach(function(n,i){A(i,t)&&(o=n.render(e,t,r._bindParameters)||o)}),o},e.prototype.updateGlobalUniforms=function(e){for(var t=this._programRep.getProgramsUsingUniform("proj"),n=0;n<t.length;n++)t[n].setUniformMatrix4fv("proj",e);if(this._lighting){t=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(n=0;n<t.length;n++)this._lighting.setUniforms(t[n]);t=this._programRep.getProgramsUsingUniform("lightDirection");for(n=0;n<t.length;n++)this._lighting.setUniforms(t[n])}},e.prototype.sortOrderedMaterialRenderers=function(){"draped"===this._mode&&this._orderedMaterialRenderers.sort(function(e,t){return t.renderPriority()-e.renderPriority()})},e.prototype.getFallbackDepthTexture=function(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new T(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))),this._fallbackDepthStencilTexture},e.prototype.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}},e.prototype.forEachRenderGeometry=function(e){this._content.forEach(function(t,n){e(t)})},e}();!function(e){var t=function(){function e(){this.reset()}return e.prototype.reset=function(){this.trianglesRendered=0,this.drawCallsInstanced=0,this.drawCallsAngleInstanced=0,this.drawCallsMerged=0,this.drawCallsPreinterleaved=0,this.drawCallsFragmented=0,this.drawCallsHighlight=0,this.instancesDrawnAngle=0,this.VBOallocatedSize=0,this.VBOoptimalSize=0,this.VBOusedSize=0},e}();e.RenderStats=t}(O||(O={}));var R=r.vec2f64.create(),M=[];return O}.apply(null,i))||(e.exports=r)},FMAd:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("ff/U"),n("zbgD"),n("U+8K")],void 0===(r=function(e,t,n,i,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return r.glslifyDefineMap({VERTEX_COLORS:e.vertexColors,SLICE:e.slice})};t.colorPass={name:"color-color",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("materials/color/color.vert"),fragmentShader:o(e)+i.resolveIncludes("materials/color/color.frag")}},attributes:n.Default3D}}.apply(null,i))||(e.exports=r)},FNtW:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("W0kZ"),n("05NA")],void 0===(r=function(e,t,n,i){return function(){function e(t){this.supportsEdges=!1,this._parentStage=null,this._visible=!0,this._renderOccluded=1,this._renderPriority=0,this.id=e._idGen.gen(t)}return Object.defineProperty(e.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0}),e.prototype.addParentStage=function(e){this._parentStage=e},e.prototype.removeParentStage=function(e){this._parentStage=null},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),e.prototype.isVisibleInPass=function(e){return!0},e.prototype.isVisible=function(){return this._visible},e.prototype.notifyDirty=function(e){this.parentStage&&this.parentStage.notifyDirty(i.MATERIAL,this,e)},e._idGen=new n,e}()}.apply(null,i))||(e.exports=r)},FRff:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("9opi"),n("qKT0"),n("qsST"),n("qMld"),n("8MXS"),n("Vx27"),n("1m5D"),n("N7S/"),n("lRq4"),n("Ondo"),n("OZYi"),n("ocJ8"),n("Dk48"),n("krVM"),n("cjy9"),n("yqrJ"),n("TP2F"),n("7XLS")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v,g,m,y,b){var x=r.getLogger("esri.views.3d.layers.DynamicLayerView3D"),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.supportsDraping=!0,t.hasDraped=!0,t.fullExtentInLocalViewSpatialReference=null,t.overlayUpdating=!1,t.maximumDataResolution=null,t._images=[],t._extents=[],t.updateWhenStationary=!0,t}return n(t,e),Object.defineProperty(t.prototype,"drawingOrder",{get:function(){return this._get("drawingOrder")},set:function(e){if(e!==this._get("drawingOrder")){this._set("drawingOrder",e);var t=new Set;this._images.forEach(function(n){n&&n.material&&(n.material.renderPriority=e,t.add(n.material.id))}),t.size>0&&(this.view._stage.getDrapedRenderer().updateRenderOrder(t),this.emit("draped-data-change"))}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this.addResolvingPromise(p.toViewIfLocal(this).then(function(t){return e._set("fullExtentInLocalViewSpatialReference",t)})),this.handles.add(this.watch("suspended",function(){return e._suspendedChangeHandler()})),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks(function(){e._isScaleRangeActive()&&e.notifyChange("suspended")},function(){})),this._isScaleRangeLayer()&&this.handles.add([this.layer.watch("minScale",function(){return e.notifyChange("suspended")}),this.layer.watch("maxScale",function(){return e.notifyChange("suspended")})],"layer"),this.handles.add([this.watch("fullOpacity",this._opacityChangeHandler.bind(this)),this.layer.on("redraw",this._layerRedrawHandler.bind(this))],"layer")},t.prototype.destroy=function(){this.clear()},t.prototype.setDrapingExtent=function(e,t,n,i,r,o){var a=this._extentAndSizeAtResolution(t,n,i),s=a.size,l=a.extent;if(o*=this.view.pixelRatio,"imageMaxWidth"in this.layer||"imageMaxHeight"in this.layer){var c=this.layer.imageMaxWidth,d=this.layer.imageMaxHeight;if(s.width>c){var f=c/s.width;s.height=Math.floor(s.height*f),s.width=c,o*=f}if(s.height>d){f=d/s.height;s.width=Math.floor(s.width*f),s.height=d,o*=f}}var p=this._extents[e];p&&u.equals(p.extent,l)&&!this._imageSizeDiffers(l,n,p.imageSize,s)||(this._extents[e]={extent:u.create(l),spatialReference:n,imageSize:s,renderLocalOrigin:r,pixelRatio:o},this.suspended||this._fetch(e))},t.prototype.getGraphicFromGraphicUid=function(e){return null},t.prototype.clear=function(){for(var e=0;e<this._images.length;e++)this._clearImage(e)},t.prototype.doRefresh=function(){this.suspended||this.refetch()},t.prototype.canResume=function(){if(!this.inherited(arguments))return!1;if(this._isScaleRangeLayer()){var e=this.layer,t=e.minScale,n=e.maxScale;if(t>0||n>0){var i=this.view.scale;if(i<n||t>0&&i>t)return!1}}return!0},t.prototype.isUpdating=function(){if(this.overlayUpdating)return!0;for(var e=0,t=this._images;e<t.length;e++)if(t[e].loadingPromise)return!0;return!1},t.prototype.processResult=function(e,t){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)},t.prototype.updateImage=function(e){return!1},t.prototype.refetch=function(){for(var e=0;e<this._extents.length;e++)this._extents[e]&&this._fetch(e)},t.prototype.beforeFetch=function(){},t.prototype.findExtentInfoAt=function(e){for(var t=0,n=this._extents;t<n.length;t++){var i=n[t],r=i.extent;if(new c(r[0],r[1],r[2],r[3],i.spatialReference).contains(e))return i}return null},t.prototype._imageSizeDiffers=function(e,t,n,i){if(!this.maximumDataResolution)return!0;if(h.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)return!0;var r=u.width(e)/this.maximumDataResolution.x,o=u.height(e)/this.maximumDataResolution.y,a=r/n.width,s=o/n.height,l=r/i.width,c=o/i.height,d=Math.abs(a-l),f=Math.abs(s-c);return d>1.5||f>1.5},t.prototype._fetch=function(e){var t=this;if(!this.suspended){this.beforeFetch();var n=this._extents[e],i=n.extent,r=new c(i[0],i[1],i[2],i[3],n.spatialReference);this._images[e]||(this._images[e]={texture:null,material:null,rendergeometry:null,loadingPromise:null,image:null,pixelData:null,renderExtent:u.create(i)});var o=this._images[e];if(o.loadingPromise&&o.loadingPromise.cancel(),0===r.width||0===r.height)return void this._clearImage(e);o.loadingPromise=this._waitFetchReady().then(function(){return t.layer.fetchImage(r,n.imageSize.width,n.imageSize.height,{requestAsImageElement:!0,pixelRatio:n.pixelRatio})}),o.loadingPromise.then(function(n){u.set(o.renderExtent,i),t.processResult(o,n),t._createStageObjects(e,o.image),0===e&&t._images[1]&&t._images[1].rendergeometry&&t._createStageObjects(1,null),t.notifyChange("updating"),t.emit("draped-data-change")}).catch(function(e){e&&"CancelError"!==e.name&&"cancel"!==e.dojoType&&x.error(e),t.notifyChange("updating")}).then(function(){o.loadingPromise=null},function(){o.loadingPromise=null}),this.notifyChange("updating")}},t.prototype._clearImage=function(e){var t=this._images[e],n=this.view._stage;t&&(t.rendergeometry&&(n.getDrapedRenderer().removeRenderGeometries([t.rendergeometry]),t.rendergeometry=null),t.texture&&(n.remove(v.ModelContentType.TEXTURE,t.texture.id),t.texture=null),t.material&&(n.remove(v.ModelContentType.MATERIAL,t.material.id),t.material=null),t.loadingPromise&&(t.loadingPromise.cancel(),t.loadingPromise=null),t.image=null,t.pixelData=null)},t.prototype._createStageObjects=function(e,t){var n=this.view._stage,i=this._images[e];t&&(i.texture&&n.remove(v.ModelContentType.TEXTURE,i.texture.id),i.texture=new m(t,"dynamicLayer",{width:t.width,height:t.height,wrap:{s:33071,t:33071}}),n.add(v.ModelContentType.TEXTURE,i.texture)),i.material?t&&i.material.setParameterValues({textureId:i.texture.id}):(i.material=new y({ambient:[1,1,1],diffuse:[0,0,0],transparent:!0,opacity:this.fullOpacity,textureId:i.texture.id,receiveSSAO:!1},"dynamicLayer"),i.material.renderPriority=this.drawingOrder,n.add(v.ModelContentType.MATERIAL,i.material));var r,o=this._extents[e].renderLocalOrigin;if(0===e)r=f.createGeometryForExtent(i.renderExtent,-1);else{if(1!==e)return;var a=this._images[0].renderExtent;if(!a)return;r=f.createOuterImageGeometry(a,i.renderExtent,-1)}var s=new g(r);s.material=i.material,s.origin=o,s.transformation=l.mat4f64.create(),s.name="dynamicLayer",s.uniqueName="dynamicLayer#"+r.id;var c=n.getDrapedRenderer();c.addRenderGeometries([s]),i.rendergeometry&&c.removeRenderGeometries([i.rendergeometry]),i.rendergeometry=s},t.prototype._isScaleRangeLayer=function(){return"minScale"in this.layer&&"maxScale"in this.layer},t.prototype._isScaleRangeActive=function(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)},t.prototype._extentAndSizeAtResolution=function(e,t,n){var i=u.width(e)/u.height(e),r={width:n,height:n};i>1.0001?r.height=n/i:i<.9999&&(r.width=n*i);var o=this._clippedExtent(e,t,S);return r.width=Math.round(r.width/(u.width(e)/u.width(o))),r.height=Math.round(r.height/(u.height(e)/u.height(o))),{size:r,extent:o}},t.prototype._clippedExtent=function(e,t,n){if("local"!==this.view.viewingMode)return u.set(n,e);var i=this.view.basemapTerrain,r=i.extent;return i.ready&&r?u.intersection(e,r,n):u.set(n,e)},t.prototype._opacityChangeHandler=function(e){for(var t=0,n=this._images;t<n.length;t++){var i=n[t];i&&i.material&&i.material.setParameterValues({opacity:e})}this.emit("draped-data-change")},t.prototype._layerRedrawHandler=function(){for(var e=!1,t=0;t<this._images.length;t++){var n=this._images[t];this.updateImage(n)&&(e=!0,this._createStageObjects(t,n.image))}e&&this.emit("draped-data-change")},t.prototype._suspendedChangeHandler=function(){if(this.suspended)this.clear(),this.emit("draped-data-change");else for(var e=0;e<this._extents.length;e++)this._fetch(e)},t.prototype._waitFetchReady=function(){return this.updateWhenStationary?a.whenOnce(this.view,"stationary"):o.resolve()},i([s.property()],t.prototype,"layer",void 0),i([s.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),i([s.property({type:Boolean})],t.prototype,"supportsDraping",void 0),i([s.property({type:Boolean})],t.prototype,"hasDraped",void 0),i([s.property({value:0,type:Number})],t.prototype,"drawingOrder",null),i([s.property({readOnly:!0})],t.prototype,"fullExtentInLocalViewSpatialReference",void 0),i([s.property()],t.prototype,"overlayUpdating",void 0),i([s.property({dependsOn:["overlayUpdating"]})],t.prototype,"updating",void 0),i([s.subclass("esri.views.3d.layers.DynamicLayerView3D")],t)}(s.declared(d,b)),S=u.create();return _}.apply(null,i))||(e.exports=r)},FU3N:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("pcDC"),n("CIy2")],void 0===(r=function(e,t,n,i){function r(e,t){return e+"_"+t}var o=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,i.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}(),a=function(){function e(e,t){this._textureRep=e,this._programRep=t,this._id2glMaterialRef=new Map}return e.prototype.aquire=function(e,t){var n,i=r(e.id,t),a=this._id2glMaterialRef.get(i);if(null==a){var s=e.getGLMaterials()[t];n=s?new s(e,this._programRep,this._textureRep):void 0,a=new o(n),this._id2glMaterialRef.set(i,a)}else n=a.getGLMaterial();return a.incRefCnt(),n&&this.increaseProgramReferences(n),n},e.prototype.release=function(e,t){var n=r(e,t),i=this._id2glMaterialRef.get(n);if(i.decRefCnt(),0===i.getRefCnt()){var o=i.getGLMaterial();o&&(this.decreaseProgramReferences(o),o.dispose()),this._id2glMaterialRef.delete(n)}},e.prototype.updateMaterialParameters=function(e){for(var t=0,n=s;t<n.length;t++){var i=n[t],o=this._id2glMaterialRef.get(r(e,i));o&&o.getGLMaterial()&&this.updateParamsForMat(o.getGLMaterial())}},e.prototype.updateParamsForMat=function(e){e.updateParameters&&(this.decreaseProgramReferences(e),e.updateParameters(),this.increaseProgramReferences(e))},e.prototype.increaseProgramReferences=function(e){for(var t=e.getPrograms(),n=this._programRep,i=0;i<t.length;i++)n.increaseRefCount(t[i])},e.prototype.decreaseProgramReferences=function(e){for(var t=e.getPrograms(),n=this._programRep,i=0;i<t.length;i++)n.decreaseRefCount(t[i])},e}(),s=n.tuple("color","depth","depthShadowMap","normal","highlight");return a}.apply(null,i))||(e.exports=r)},Fsr7:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("2Atf"),n("VfPl"),n("2B1V")],void 0===(r=function(e,t,n,i,r){function o(e){var t=new Array;return e.fields.forEach(function(e,i){var r=n({},e,{constructor:s(e.constructor)});t.push([i,r])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function a(e){var t=r.newLayout();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(function(e){return t.fields.set(e[0],n({},e[1],{constructor:l(e[1].constructor)}))}),t}function s(e){return e.ElementType+"_"+e.ElementCount}function l(e){return u.get(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.packInterleavedBuffer=function(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:o(e.layout)}},t.unpackInterleavedBuffer=function(e){return a(e.layout).createView(e.buffer)},t.packLayout=o,t.unpackLayout=a;var c=[i.BufferViewFloat,i.BufferViewVec2f,i.BufferViewVec3f,i.BufferViewVec4f,i.BufferViewMat3f,i.BufferViewMat4f,i.BufferViewFloat64,i.BufferViewVec2f64,i.BufferViewVec3f64,i.BufferViewVec4f64,i.BufferViewMat3f64,i.BufferViewMat4f64,i.BufferViewUint8,i.BufferViewVec2u8,i.BufferViewVec3u8,i.BufferViewVec4u8,i.BufferViewUint16,i.BufferViewVec2u16,i.BufferViewVec3u16,i.BufferViewVec4u16,i.BufferViewUint32,i.BufferViewVec2u32,i.BufferViewVec3u32,i.BufferViewVec4u32,i.BufferViewInt8,i.BufferViewVec2i8,i.BufferViewVec3i8,i.BufferViewVec4i8,i.BufferViewInt16,i.BufferViewVec2i16,i.BufferViewVec3i16,i.BufferViewVec4i16,i.BufferViewInt32,i.BufferViewVec2i32,i.BufferViewVec3i32,i.BufferViewVec4i32],u=new Map;c.forEach(function(e){return u.set(s(e),e)})}.apply(null,i))||(e.exports=r)},Geb9:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("wKWA"),n("B294")],void 0===(r=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_INDEX_COUNT=65536;var r=function(){function e(e,r){void 0===r&&(r=1),this.textureBuffer=new i.TextureBackedBuffer(e,r),this.indexManager=new n.SimpleIndexManager(t.MAX_INDEX_COUNT)}return e.prototype.dispose=function(){this.textureBuffer.dispose(),this.textureBuffer=void 0},Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0}),e.prototype.aquireIndex=function(){var e=this.indexManager.aquire();return this.textureBuffer.resizeToFit(e),e},e.prototype.releaseIndex=function(e){this.indexManager.release(e)},e}();t.ManagedTextureBackedBuffer=r}.apply(null,i))||(e.exports=r)},GntT:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("pcDC")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.elementTypeSize=function(e){switch(e){case"u8":return 1;case"u16":return 2;case"u32":return 4;case"i8":return 1;case"i16":return 2;case"i32":case"f32":return 4;case"f64":return 8;default:n.neverReached(e)}},t.isSigned=function(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:n.neverReached(e)}},t.isInteger=function(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:n.neverReached(e)}},t.maximumValue=function(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:n.neverReached(e)}}}.apply(null,i))||(e.exports=r)},Gz8v:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,n){for(var i=e.typedBuffer,r=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=n?n.count:t.count,l=(n&&n.dstIndex?n.dstIndex:0)*r,c=(n&&n.srcIndex?n.srcIndex:0)*a,u=0;u<s;++u)i[l]=o[c],i[l+1]=o[c+1],i[l+2]=o[c+2],i[l+3]=o[c+3],l+=r,c+=a},t.fill=function(e,t,n,i,r,o){for(var a=e.typedBuffer,s=e.typedBufferStride,l=o?o.count:e.count,c=(o&&o.dstIndex?o.dstIndex:0)*s,u=0;u<l;++u)a[c]=t,a[c+1]=n,a[c+2]=i,a[c+3]=r,c+=s}}.apply(null,i))||(e.exports=r)},HSGS:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("2Atf"),n("xhoE"),n("4w2c"),n("0LE5"),n("Rdxj"),n("MzcX"),n("W7eI")],void 0===(r=function(e,t,n,i,r,o,a,s,l){function c(e){var t=f;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],h[0]=5381;for(var n=0;n<p.length;n++)h[0]=31*h[0]+p[n];return h[0]}function u(e,t){var n=e<0?-1:1;return Math.pow(Math.abs(e),t)*n}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(){}return e.prototype.updateSettings=function(e){this.settings=e},e.prototype.write=function(e,t,n){var i=c(n);v.seed=i;var r=v.getIntRange(0,255),o=v.getIntRange(0,this.settings.variants-1),a=v.getFloat(),s=255*(.5*u(-(1-Math.min(a/.7,1))+Math.max(0,a-.7)/(1-.7),1.2)+.5);e.position0.setVec(t,n.position0),e.position1.setVec(t,n.position1),e.componentIndex.set(t,n.componentIndex),e.variantOffset.set(t,r),e.variantStroke.set(t,o),e.variantExtension.set(t,s)},e.prototype.trim=function(e,t){return e.slice(0,t)},e}();t.CommonBufferWriter=d;var f=new Float32Array(6),p=new Uint32Array(f.buffer),h=new Uint32Array(1),v=new r,g=function(){function e(){this.commonWriter=new d}return e.prototype.updateSettings=function(e){this.commonWriter.updateSettings(e)},e.prototype.allocate=function(e){return l.RegularEdgeInstancesLayout.createBuffer(e)},e.prototype.write=function(e,t,n){this.commonWriter.write(e,t,n),o.vec3.add(y,n.faceNormal0,n.faceNormal1),o.vec3.normalize(y,y),e.normal.setVec(t,y)},e.prototype.trim=function(e,t){return this.commonWriter.trim(e,t)},e.Layout=l.RegularEdgeInstancesLayout,e.glLayout=s.glLayout(l.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1}),e}();t.RegularEdgeBufferWriter=g;var m=function(){function e(){this.commonWriter=new d}return e.prototype.updateSettings=function(e){this.commonWriter.updateSettings(e)},e.prototype.allocate=function(e){return l.SilhouetteEdgeInstancesLayout.createBuffer(e)},e.prototype.write=function(e,t,n){this.commonWriter.write(e,t,n),e.normalA.setVec(t,n.faceNormal0),e.normalB.setVec(t,n.faceNormal1)},e.prototype.trim=function(e,t){return this.commonWriter.trim(e,t)},e.Layout=l.SilhouetteEdgeInstancesLayout,e.glLayout=s.glLayout(l.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1}),e}();t.SilhouetteEdgeBufferWriter=m;var y=a.vec3f64.create()}.apply(null,i))||(e.exports=r)},I67D:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("xTBS"),n("AzkI"),n("eHCP"),n("05NA"),n("Xih7"),n("cjy9"),n("CIy2")],void 0===(r=function(e,t,n,i,r,o,a,s,l){var c=l.assert,u=l.logWithBase;return function(){function e(){for(var e in this.dirtySet=new a(this),this._uniqueIdx=0,this._id2origin={},this.content={},o)this.content[o[e]]={}}return e.prototype.getAll=function(e){var t=this.content[e];return c(void 0!==t),t},e.prototype.get=function(e,t){return this.getAll(e)[t]},e.prototype.add=function(e,t){var n=this.content[e];c(void 0!==n);var i=t.id;c(null==n[i],"Model/Stage already contains object to be added"),n[i]=t,e===o.LAYER&&this.notifyDirty(e,t,"layerAdded")},e.prototype.remove=function(e,t){var n=this.content[e];c(void 0!==n);var i=n[t];return c(void 0!==i,"Model/Stage doesn't contain object to be removed"),delete n[t],e===o.TEXTURE&&i.unload(),e===o.LAYER&&this.notifyDirty(e,i,"layerRemoved"),i},e.prototype.getDirtySet=function(){return this.dirtySet},e.prototype.notifyDirty=function(e,t,n,i){this.dirtySet.handleUpdate(t,n,i)},e.prototype.getOrigin=function(e,t,n){void 0===n&&(n=10);var i=0,o=t*n/1e4;o>1&&(i=Math.ceil(u(o,2)));var a=1e4*Math.pow(2,i),s=Math.round(e[0]/a),l=Math.round(e[1]/a),c=Math.round(e[2]/a),d=i+"_"+s+"_"+l+"_"+c,f=this._id2origin[d];return null==f&&(f=r.fromValues(s*a,l*a,c*a,d),this._id2origin[d]=f),f},e.prototype.getGeometryRenderGeometries=function(e,t,n){var r=e.id,o=t.geometry,a=e.getCombinedStaticTransformation(t),l=i.maxScale(a),c=t.origin,u=t.id,d=this._uniqueIdx++,f=new s(o.data,o.boundingInfo,t.material,a,t.shaderTransformation,l,e.getCastShadow(),!!o.singleUse,r,u,d);f.origin=c||this.getOrigin(f.center,f.bsRadius),f.instanceParameters=t.instanceParameters,n.push(f)},e.prototype.updateRenderGeometryTransformation=function(e,t,n){e.getCombinedStaticTransformation(t,n.transformation),n.updateTransformation(n.transformation);var i=this.getOrigin(n.center,n.bsRadius);return n.origin!==i},e.prototype.formatDebugInfo=function(e){var t=[];if(e){for(var i in t[0]="<table>",o){var r=o[i];t[0]+="<tr><td>"+r+'</td><td style="text-align: right">'+Object.keys(this.getAll(r)).length+"</td></tr>"}t[0]+="</table>",t[1]=this.dirtySet.formatDebugInfo(!0)}else{for(var i in t[0]="",o){r=o[i];t[0]+=n.pad(String(Object.keys(this.getAll(r)).length),6," ")+" "+r+", "}t[1]=this.dirtySet.formatDebugInfo(!1)}return t},e.prototype.validateObject=function(e){for(var t=e.geometryRecords,n=0;n<t.length;++n){var i=t[n];c(null!=this.get(o.GEOMETRY,i.geometry.id)),c(null!=this.get(o.MATERIAL,i.material.id))}},e.prototype.validateLayer=function(e){for(var t=e.getObjects(),n=0;n<t.length;++n){var i=this.get(o.OBJECT,t[n].id);c(null!=i)}},e.ContentType=o,e}()}.apply(null,i))||(e.exports=r)},IfBv:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("Geb9")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.buffers=[]}return e.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(e){return 0!==e.activeCount||(e.dispose(),!1)})},e.prototype.getBuffer=function(e){for(var t=0,i=this.buffers;t<i.length;t++){var r=i[t];if(r.availableCount>=e)return r}if(e>n.MAX_INDEX_COUNT)return null;var o=new n.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);return this.buffers.push(o),o},e.prototype.updateTextures=function(){for(var e=0,t=this.buffers;e<t.length;e++)t[e].textureBuffer.updateTexture()},e}();t.BufferManager=i}.apply(null,i))||(e.exports=r)},JUgm:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("2Atf"),n("H1tY"),n("qsST"),n("qMld"),n("0LE5"),n("Rdxj"),n("O7NG"),n("QWGo"),n("FU3N"),n("8nmy"),n("2A3h"),n("pgjK"),n("qUb7"),n("I67D"),n("QJWI"),n("Teen"),n("dlMz"),n("qLgY"),n("/f24"),n("3KT0")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v,g,m,y,b,x,_){var S=r.getLogger("esri.views.3d.webgl-engine.parts.View"),w=function(){function e(e,t,n,i){var r=this;this.options=i,this._backgroundColor=l.vec4f64.fromValues(1,1,1,1),this._lightDirection=s.vec3f64.fromValues(0,1,0),this._didRender=!1,this._needsRender=!0,this._idleSuspend=!0,this._shouldRender=!1,this._supersampleScreenshots=!0,this._screenshotQueue=[],this._container=e,this._stage=t,this._initializeContext(i);var o=m.glslifyGlobalOptions({viewingMode:i.viewingMode});this._programRepository=new f(this._rctx,o);this._textureRep=new d(t.getAll(v.ContentType.TEXTURE),this._programRepository,function(){return r._viewport.getCamera().viewport},this._rctx),this._materialRep=new u(this._textureRep,this._programRepository),this._viewport=new g(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx),this._initializeViewportCamera(),this._drapedRenderer=new c(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,n),this._initializeFrameTask()}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype._initializeFrameTask=function(){var e=this;this._frameTask={preRender:function(){p.begin(),e._stage.processDirty(),e.needsRender()?(e._shouldRender=!0,e._viewport.getCamera().setGLViewport(e._rctx),e._rctx.setClearColor.apply(e._rctx,e._backgroundColor),e._rctx.clearSafe(16640)):e._shouldRender=!1},render:function(){e._shouldRender&&(e._didRender=!0,T.lightDirection=e._lightDirection,T.disableSlice=!1,e._viewport.render(T))},postRender:function(){p.end()},update:function(){e.resetNeedsRender(),e._performScreenshots()}}},e.prototype._initializeViewportCamera=function(){var e=this._container.getBoundingClientRect(),t=this._viewport.getCamera();t.viewport[2]=e.width,t.viewport[3]=e.height,this._viewport.setCamera(t)},e.prototype._initializeContext=function(e){this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==e.stencil||e.stencil},n=b.createContextOrErrorHTML(this._canvas,t,e.renderContext);this._gl=p.instrumentContext(n);var r={disabledExtensions:e.deactivatedWebGLExtensions||{}};this._rctx=new _(this._gl,r),!e.alpha&&this._rctx.contextAttributes.alpha&&S.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&i("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas),null!=e.supersampleScreenshots&&(this._supersampleScreenshots=e.supersampleScreenshots)},e.prototype.dispose=function(){this._viewport.dispose(),this._viewport=null,this._drapedRenderer.dispose(),this._drapedRenderer=null,this._programRepository.dispose(),this._programRepository=null,this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._container=null,this._canvas=null,this._gl=null,this._frameTask=null},e.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()},e.prototype.setNeedsRender=function(){this._didRender=!1,this._needsRender=!0},e.prototype.resetNeedsRender=function(){this._didRender&&(this._needsRender=!1,this._didRender=!1),this._viewport.resetNeedsRender(),this._textureRep.resetNeedsRender()},e.prototype.needsRender=function(){var e=this._viewport.getCamera();return 0!==e.fullWidth&&0!==e.fullHeight&&(this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender())},e.prototype.getFrameTask=function(){return this._frameTask},e.prototype.setLighting=function(e){a.vec3.set(this._lightDirection,0,0,0);for(var t=0,n=e.lights;t<n.length;t++){var i=n[t];if(i instanceof h.MainLight){a.vec3.negate(this._lightDirection,i.direction);break}}this._viewport.setLighting(e),this._needsRender=!0},e.prototype.ensureEdgeView=function(){return this._viewport.ensureEdgeView()},Object.defineProperty(e.prototype,"edgeView",{get:function(){return this._viewport.edgeView},enumerable:!0,configurable:!0}),e.prototype.getMainLightDirection=function(){return this._lightDirection},e.prototype.setViewParams=function(e){"backgroundColor"in e&&(this._needsRender=!0,this._backgroundColor=e.backgroundColor),"supersampleScreenshots"in e&&(this._supersampleScreenshots=e.supersampleScreenshots)},e.prototype.setRenderParams=function(e){this._needsRender=!0,void 0!==e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend),this._viewport.setRenderParams(e)},e.prototype.getRenderParams=function(){var e=this._viewport.getRenderParams();return e.anisotropicFiltering=this._textureRep.getMaxAnisotropy(),e.idleSuspend=this._idleSuspend,e},Object.defineProperty(e.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return"s3tc"===e?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===e&&!!this._rctx.capabilities.shaderTextureLOD},e.prototype.modify=function(e,t,n,i){this._viewport.modify(e,t,n,i)},e.prototype.setCamera=function(e){this._viewport.setCamera(e)},e.prototype.getCamera=function(){return this._viewport.getCamera()},e.prototype.getCanvas=function(){return this._canvas},e.prototype.getDrapedRenderer=function(){return this._drapedRenderer},e.prototype.takeScreenshot=function(e){var t=this,n=o.createResolver(function(){t._screenshotQueue=t._screenshotQueue.filter(function(e){return e.resolver!==n})});return this._screenshotQueue.push({settings:e,resolver:n}),this._needsRender=!0,n.promise},e.prototype.getFramebufferTexture=function(e){return this._viewport.getFramebufferTexture(e)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._viewport.renderPlugins},enumerable:!0,configurable:!0}),e.prototype._renderScreenshotOverlay=function(e,t,n){if(this.options.renderScreenshotOverlay){e.width=t.width,e.height=t.height;var i=e.getContext("2d"),r=this._viewport.getCamera().pixelRatio*n.pixelRatio;i.save(),i.translate(0,t.height),i.scale(1,-1),n.region&&i.translate(-n.region.x,-n.region.y),i.scale(r,r),this.options.renderScreenshotOverlay(e,t),i.restore()}},e.prototype._readbackScreenshot=function(e){return e.resample?this._readbackScreenshotResampled(e):this._readbackScreenshotImmediate(e)},e.prototype._readbackScreenshotResampled=function(e){var t=e.framebufferWidth,i=e.framebufferHeight,r=e.region,o=e.resample,a=this._ensureScreenshotEncodeCanvas(),s=y.createEmptyImageData(t,i,a);this._gl.readPixels(0,0,t,i,6408,5121,new Uint8Array(s.data.buffer)),this._renderScreenshotOverlay(a,s,n({},e,{region:null}));var l=y.createEmptyImageData(r.width,r.height,a);return y.resampleHermite(s,l,!0,o.region.x,i-(o.region.y+o.region.height),o.region.width,o.region.height)},e.prototype._readbackScreenshotImmediate=function(e){var t=e.framebufferHeight,n=e.region,i=this._ensureScreenshotEncodeCanvas(),r=y.createEmptyImageData(n.width,n.height,i);return this._gl.readPixels(n.x,t-(n.y+n.height),n.width,n.height,6408,5121,new Uint8Array(r.data.buffer)),this._renderScreenshotOverlay(i,r,e),r},e.prototype._renderScreenshot=function(e){var t=null,n=this._viewport.getCamera(),i=y.screenshotSuperSampleSettings(e,this._supersampleScreenshots),r=i.framebufferWidth,o=i.framebufferHeight,a=!1,s=this._viewport.hasSlicePlane&&e.disableSlice,l=r!==n.fullWidth||o!==n.fullHeight||s;if(l){var c=n.copy();c.fullWidth=r,c.fullHeight=o,c.pixelRatio*=i.pixelRatio;var u=n.fovX-c.fovX,d=n.fovY-c.fovY;u<0&&u<d?c.fovX=n.fovX:d<0&&d<u&&(c.fovY=n.fovY),this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(c),a=!0,t=new x(this._rctx,{width:c.fullWidth,height:c.fullHeight,colorTarget:0,depthStencilTarget:3}),this._rctx.bindFramebuffer(t),c.setGLViewport(this._rctx),this._rctx.setClearColor.apply(this._rctx,this._backgroundColor),this._rctx.clearSafe(16640),this._viewport.render({lightDirection:this._lightDirection,fbo:t,camera:c,disableSlice:e.disableSlice})}var f=this._readbackScreenshot(i);if(l&&!this._rctx.contextAttributes.alpha)for(var p=3;p<f.data.length;p+=4)f.data[p]=255;return t&&t.dispose(),this._rctx.bindFramebuffer(null),a&&this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(n),f},e.prototype._performScreenshots=function(){if(0!==this._screenshotQueue.length){for(var e=0,t=this._screenshotQueue;e<t.length;e++){var n=t[e],i=n.settings;if(this._gl){var r=this._ensureScreenshotEncodeCanvas(),o=this._renderScreenshot(i),a=y.encodeResult(o,i,r,{flipY:!0,premultipliedAlpha:!0});n.resolver(a)}else n.resolver.reject()}this._screenshotQueue=[]}},e.prototype._ensureScreenshotEncodeCanvas=function(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas},Object.defineProperty(e.prototype,"test",{get:function(){return{viewport:this._viewport}},enumerable:!0,configurable:!0}),e.prototype.getGpuMemoryUsage=function(){return n({},this._viewport.getGpuMemoryUsage(),{draped:this._drapedRenderer?this._drapedRenderer.getGpuMemoryUsage():0})},e}(),T={fbo:null,camera:null,lightDirection:s.vec3f64.create(),disableSlice:!1};return w}.apply(null,i))||(e.exports=r)},KPBO:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dotProduct=function(e,t){for(var n=0,i=0;i<e.length;i++)n+=e[i]*t[i];return n},t.elementwiseProduct=function(e,t,n){(n=n||e).length=e.length;for(var i=0;i<e.length;i++)n[i]=e[i]*t[i];return n},t.scalarProduct=function(e,t,n){(n=n||e).length=e.length;for(var i=0;i<e.length;i++)n[i]=e[i]*t;return n},t.add=function(e,t,n){(n=n||e).length=e.length;for(var i=0;i<e.length;i++)n[i]=e[i]+t[i];return n}}.apply(null,i))||(e.exports=r)},Lb4W:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("qsST"),n("DIqE"),n("0LE5"),n("2fXB"),n("O7NG"),n("weRx"),n("/Bau"),n("CIy2"),n("TZB2"),n("/f24"),n("qbr3"),n("Zp3t"),n("Kfys")],void 0===(r=function(e,t,i,r,o,a,s,l,c,u,d,f,p,h,v){var g=i.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper"),m=function(){function e(e,t,n){this._enabled=!1,this._BLUR_F=2,this._attenuation=.5,this._radius=3,this._samples=16,this._viewportToRestore=s.vec4f64.create(),this._rctx=t,this._programRep=e,this._requestRender=n,this._emptyTexture=c.createEmptyTexture(t)}return e.prototype.dispose=function(){this._emptyTexture.dispose(),this._emptyTexture=null},Object.defineProperty(e.prototype,"isSupported",{get:function(){var e=this._rctx,t=-1!==e.parameters.versionString.indexOf("WebGL 0.93"),n=-1!==e.parameters.versionString.indexOf("WebGL 0.94");return!(t||n)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attenuation",{get:function(){return this._attenuation},set:function(e){this._attenuation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e,this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0}),e.prototype.computeSSAO=function(e,t,n){if(this._noiseTexture){u.assert(this.enabled);var i=this._rctx,r=e.fullViewport,s=r[2],l=r[3],d=s/this._BLUR_F,f=l/this._BLUR_F;this._ssaoFBO.resize(s,l),this._blur0FBO.resize(d,f),this._blur1FBO.resize(d,f);var p=1*s,h=1*l;i.bindFramebuffer(this._ssaoFBO),a.vec4.copy(this._viewportToRestore,e.fullViewport),i.setViewport(0,0,s,l);var g=this._ssaoProgram,m=this._blurProgram;g.setUniform2f("rnmScale",s/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height),g.setUniform3fv("pSphere",this._samples<=8?this._data.random8:this._samples<=16?this._data.random16:this._samples<=32?this._data.random32:this._data.random64),i.bindProgram(g),i.setPipelineState(this._pipelineState);var x=this._data.minDiscrepancy,_=this._samples<x.length?x[this._samples]:5779;g.setUniform1f("numSpiralTurns",_);var S=b,w=y;u.inverseProjectionInfo(e.projectionMatrix,e.fullWidth,e.fullHeight,S,w),g.setUniform4fv("projInfo",S),g.setUniform2fv("zScale",w),g.setUniform2f("nearFar",e.near,e.far);var T=1/e.computeRenderPixelSizeAtDist(1);g.setUniform1f("projScale",1*T),g.setUniform2f("screenDimensions",p,h);var E=2*this._radius,P=o.vec3.distance(e.eye,e.center);E=20*e.computeRenderPixelSizeAtDist(P),E=Math.max(.1,E),g.setUniform1f("radius",E),g.setUniform1f("intensity",4*this._attenuation/Math.pow(E,6)),g.setUniform1i("rnm",0),g.setUniform1i("normalMap",1),g.setUniform1i("depthMap",2),i.bindTexture(this._noiseTexture,0),i.bindTexture(n,1),i.bindTexture(t,2);var C=c.createQuadVAO(this._rctx);i.bindVAO(C),i.drawArrays(5,0,v.vertexCount(C,"geometry")),i.bindTexture(this._ssaoFBO.colorTexture,0),i.setViewport(0,0,p/this._BLUR_F,h/this._BLUR_F),i.bindFramebuffer(this._blur0FBO),m.setUniform2f("screenDimensions",p,h),m.setUniform1i("tex",0),m.setUniform1i("normalMap",1),m.setUniform1i("depthMap",2),m.setUniform2f("blurSize",0,1*this._BLUR_F/h),m.setUniform1i("radius",4),m.setUniform1f("g_BlurFalloff",.08),m.setUniform2f("nearFar",e.near,e.far),P>5e4&&(T=Math.max(0,T-(P-5e4))),m.setUniform1f("projScale",T),m.setUniform2f("zScale",1,0),i.drawArrays(5,0,v.vertexCount(C,"geometry")),m.setUniform2f("blurSize",1*this._BLUR_F/p,0),i.bindFramebuffer(this._blur1FBO),i.bindTexture(this._blur0FBO.colorTexture,0),i.drawArrays(5,0,v.vertexCount(C,"geometry")),i.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}},e.prototype.setUniforms=function(e){var t=this.enabled&&this._noiseTexture,n=this._rctx;n.bindTexture(t?this._blur1FBO.colorTexture:this._emptyTexture,6),n.setActiveTexture(0),e.setUniform1i("ssaoTex",6),t?e.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):e.setUniform4f("viewportPixelSz",-1,-1,-1,-1)},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("viewportPixelSz"),n=0;n<t.length;n++)this.setUniforms(t[n])},e.prototype.selectPrograms=function(){var e=this._samples<=8?8:this._samples<=16?16:this._samples<=32?32:64;this._ssaoProgram=this._programRep.getProgram(d.ssaoPass,{samples:e}),this._blurProgram=this._programRep.getProgram(d.blurPass,{radius:4}),this._pipelineState=p.makePipelineState({colorWrite:p.defaultColorWriteParams})},e.prototype.enable=function(){var e=this;if(!this.enabled){if(!this.isSupported)return void g.warn("SSAO is not supported for this browser or hardware");this._enabled=!0,this.loadResources(function(){e._enabled&&e.initialize()})}},e.prototype.loadResources=function(e){var t=this;this._data?e():n.e(93).then(function(){var i=[n("vPu4")];(function(n){t._data=n,e()}).apply(null,i)}).catch(n.oe)},e.prototype.initialize=function(){var e=this,t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},n={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=f.createWithAttachments(this._rctx,t,n),this._blur0FBO=f.createWithAttachments(this._rctx,t,n),this._blur1FBO=f.createWithAttachments(this._rctx,t,n),l.requestImage(this._data.noiseTexture).then(function(t){e._enabled&&(e._noiseTexture=new h(e._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:t.width,height:t.height},t),e._requestRender())}),this.selectPrograms()},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))},e.prototype.getGpuMemoryUsage=function(){return v.getGpuMemoryUsage(this._blur0FBO)+v.getGpuMemoryUsage(this._blur1FBO)+v.getGpuMemoryUsage(this._ssaoFBO)},e}(),y=r.vec2f64.create(),b=s.vec4f64.create();return m}.apply(null,i))||(e.exports=r)},MI3s:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("2fXB")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n,i,r){void 0===n&&(n=0),this.TypedArrayConstructor=e,this.elementCount=4;var o=this.TypedArrayConstructor;void 0===i&&(i=4*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,a):new o(t,a,(r-n)/o.BYTES_PER_ELEMENT),this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return n.vec4.set(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1],this.typedBuffer[e*this.typedBufferStride+2],this.typedBuffer[e*this.typedBufferStride+3])},e.prototype.setVec=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1],this.typedBuffer[e*this.typedBufferStride+2]=t[2],this.typedBuffer[e*this.typedBufferStride+3]=t[3]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n},e.prototype.copyFrom=function(e,t,n){var i=this.typedBuffer,r=t.typedBuffer,o=e*this.typedBufferStride,a=n*t.typedBufferStride;i[o]=r[a],i[o+1]=r[a+1],i[o+2]=r[a+2],i[o+3]=r[a+3]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=4,e}();t.BufferViewVec4Impl=i}.apply(null,i))||(e.exports=r)},MzcX:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("2Atf")],void 0===(r=function(e,t,n){function i(e){return"a"+e[0].toUpperCase()+e.substr(1)}function r(e){var t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}Object.defineProperty(t,"__esModule",{value:!0});var o={divisor:0,prefixA:!1};t.glLayout=function(e,t){void 0===t&&(t={}),t=n({},o,t);var a=e.stride;return e.fieldNames.filter(function(t){var n=e.fields.get(t).optional;return!(n&&n.glPadding)}).map(function(n){var o=e.fields.get(n),s=o.constructor.ElementCount,l=r(o.constructor.ElementType),c=o.offset,u=!(!o.optional||!o.optional.glNormalized);return{name:t.prefixA?i(n):n,stride:a,count:s,type:l,offset:c,normalized:u,divisor:t.divisor}})};var a={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}}.apply(null,i))||(e.exports=r)},OZYi:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("lRq4"),n("AgDx"),n("4ziW"),n("CIy2")],void 0===(r=function(e,t,n,i,r,o){function a(e,t){var n=[[e[0],e[1],t],[e[2],e[1],t],[e[2],e[3],t],[e[0],e[3],t]];return r.createSquareGeometry(n)}Object.defineProperty(t,"__esModule",{value:!0});var s=new Float32Array([0,0,1]);t.createGeometryForExtent=a,t.createOuterImageGeometry=function(e,t,r){if(!n.intersects(e,t))return a(t,r);for(var l=[e[1]-t[1],Math.min(e[3],t[3])-Math.max(e[1],t[1]),t[3]-e[3],123456],c=[e[0]-t[0],Math.min(e[2],t[2])-Math.max(e[0],t[0]),t[2]-e[2],123456],u=t[2]-t[0],d=t[3]-t[1],f=c[0]>0&&c[2]>0?3:2,p=l[0]>0&&l[2]>0?3:2,h=(p+1)*(f+1),v=new Float32Array(3*h),g=new Float32Array(2*h),m=new Uint32Array(6*(p*f-1)),y=0,b=0,x=0,_=0,S=0,w=0;w<4;w++){var T=l[w];if(!(T<=0)){for(var E=0,P=0;P<4;P++){var C=c[P];C<=0||(v[b++]=t[0]+E,v[b++]=t[1]+y,v[b++]=r,g[x++]=E/u,g[x++]=y/d,P<3&&w<3&&(1!==P||1!==w)&&(m[S++]=_,m[S++]=_+1,m[S++]=_+f+1,m[S++]=_+1,m[S++]=_+f+2,m[S++]=_+f+1),_++,E+=C)}y+=T}}var A={};A[o.VertexAttrConstants.POSITION]={size:3,data:v},A[o.VertexAttrConstants.NORMAL]={size:3,data:s},A[o.VertexAttrConstants.UV0]={size:2,data:g};for(var O={},R=new Uint32Array(m.length),M=0;M<R.length;M++)R[M]=0;return O[o.VertexAttrConstants.POSITION]=m,O[o.VertexAttrConstants.NORMAL]=R,O[o.VertexAttrConstants.UV0]=m,new i(A,O)}}.apply(null,i))||(e.exports=r)},Ondo:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("9opi"),n("qKT0"),n("qMld"),n("8MXS"),n("Vx27"),n("niw0"),n("WsO6")],void 0===(r=function(e,t,n,i,r,o,a,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return n(t,e),t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return r.create(function(t,n){o.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var i=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);i?n(i):t()})})},i([a.property()],t.prototype,"view",void 0),i([a.property()],t.prototype,"slicePlaneEnabled",void 0),i([a.subclass("esri.views.3d.layers.LayerView3D")],t)}(a.declared(l))}.apply(null,i))||(e.exports=r)},"PwS/":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("FXVB"),n("1m5D"),n("rjU6"),n("CIy2"),n("Kfys")],void 0===(r=function(e,t,n,i,r,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.generateRenderGeometryVisibleIndexRanges=function(e){if(e.instanceParameters.hidden)return[];var t=e.instanceParameters.componentVisibilities,n=e.componentOffsets;return r.generateVisibleIndexRanges(t,n)},t.generateRenderGeometryHighlightRanges=function(e){if(e.instanceParameters.hidden)return null;var t=e.instanceParameters.componentVisibilities,n=e.instanceParameters.componentHighlights,i=e.componentOffsets;return r.generateHighlightedIndexRanges(t,n,i)},t.doesRenderGeometryHaveHighlights=function(e){if(e.instanceParameters.hidden)return!1;var t=e.instanceParameters.componentVisibilities,n=e.instanceParameters.componentHighlights,i=e.componentOffsets;return r.hasHighlights(t,n,i)},t.isRenderGeometryHidden=function(e){if(e.instanceParameters.hidden)return!0;var t=e.instanceParameters.componentVisibilities,n=e.componentOffsets;return r.isAllHidden(t,n)},t.drawArrays=function(e,t,n,i,r){e.drawArrays(t,n,i),r&&(r.drawCalls++,4===t&&(r.triangles+=i))},t.drawElements=function(e,t,n,i,r,o){var s=a.getBytesPerElement(n);e.drawElements(t,r,n,i*s),o&&(o.drawCalls++,4===t&&(o.triangles+=r))},t.drawArraysFaceRange=function(e,t,n,i,r){for(var o=0,a=0,s=t;a<s.length;a++){var l=s[a],c=l[0]+n,u=l[1]-l[0]+1;o+=u,e.drawArrays(i,c,u)}r&&(r.drawCalls+=t.length,4===i&&(r.triangles=o/3))},t.drawElementsFaceRange=function(e,t,n,i,r,o){for(var s=a.getBytesPerElement(r),l=0,c=0,u=t;c<u.length;c++){var d=u[c],f=d[0]+n,p=d[1]-d[0]+1;l+=p,e.drawElements(i,p,r,f*s)}o&&(o.drawCalls+=t.length,4===i&&(o.triangles+=l/3))},t.acquireMaterials=function(e,t){var n=new Map;return n.set(0,t.aquire(e,"color")),n.set(3,t.aquire(e,"depthShadowMap")),n.set(2,t.aquire(e,"normal")),n.set(1,t.aquire(e,"depth")),n.set(4,t.aquire(e,"highlight")),n},t.releaseMaterials=function(e,t){t.release(e.id,"color"),t.release(e.id,"depthShadowMap"),t.release(e.id,"normal"),t.release(e.id,"depth"),t.release(e.id,"highlight")},t.calculateTransformRelToOrigin=function(e,t,i){var r=e.origin.vec3;o.setMatrixTranslation3(s,-r[0],-r[1],-r[2]),n.mat4.multiply(t,s,e.transformation),i&&(n.mat4.invert(i,t),n.mat4.transpose(i,i))};var s=i.mat4f64.create()}.apply(null,i))||(e.exports=r)},Q55v:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("2Atf"),n("HZ3d"),n("Q2wQ"),n("KY0m"),n("qMld"),n("ADZV"),n("rusB"),n("8V7H"),n("1m5D"),n("0LE5"),n("Rdxj"),n("O7NG"),n("AzkI"),n("VfPl"),n("TqPN"),n("hkmr"),n("p23x"),n("UD5A"),n("yBJI"),n("IfBv"),n("W7eI"),n("HSGS"),n("8fHt"),n("E/UE"),n("qC//"),n("BtPY"),n("QFi0"),n("qbr3"),n("z2+Q"),n.dj.m(e)],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v,g,m,y,b,x,_,S,w,T,E,P,C,A,O,R,M){Object.defineProperty(t,"__esModule",{value:!0});var D=function(){function t(e,t,n){this.rctx=e,this.programRepository=t,this.callbacks=n,this.profilingCallback=null,this.perObjectData=new Map,this.renderers=new Map,this.localOrigins=new b.LocalOriginManager(new m),this.numberOfRenderedEdges=0,this.gpuMemoryUsage=0,this.worker=new T,this.workerThread=null,this.destroyed=!1,this.tmpModelPosition=f.vec3f64.create(),this.tmpCameraPosition=f.vec3f64.create(),this.componentColorManager=new _.BufferManager(this.rctx,2)}return t.prototype.initialize=function(){var t=this;c.open(s.getAbsMid("./EdgeProcessingWorker",e,M)).then(function(e){t.destroyed?e.close():t.workerThread=e});for(var n=S.VertexLayout.createBuffer(4),i=0;i<4;i++)n.sideness.set(i,0,0===i||3===i?0:1),n.sideness.set(i,1,0===i||1===i?0:1);this.verticesBufferObject=A.createVertex(this.rctx,35044,n.buffer);var r=this.rctx.capabilities.blendMinMax;this.pipelineState=r?O.makePipelineState({blending:O.separateBlendingParams(1,1,0,1,32774,r.MAX),depthTest:{func:515},colorWrite:O.defaultColorWriteParams}):O.makePipelineState({depthTest:{func:515},depthWrite:O.defaultDepthWriteParams,colorWrite:O.defaultColorWriteParams})},t.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)},t.prototype.getUsedMemory=function(){return this.gpuMemoryUsage},Object.defineProperty(t.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0}),t.prototype.shouldRender=function(){return this.renderers.size>0},t.prototype.addObject=function(e,t,n,o,s){return i(this,void 0,void 0,function(){var i,l,c,u,d,f;return r(this,function(r){switch(r.label){case 0:if(this.hasObject(e))return[2];if(i=new Array,c={loaded:a.create(function(e){return l=e}),renderables:[]},this.perObjectData.set(e,c),s&&s.mergeGeometries&&e.geometries.length>1&&this.canMergeGeometries(e))i.push(this.addObjectMergedGeometries(e,c,t,n));else for(u=0;u<e.geometries.length;u++)d=e.geometries[u],f=e.geometryRecords[u],f.material.supportsEdges&&(d.data instanceof x?i.push(this.addGeometryPreinterleaved(e,c,d,d.data,f,t,n,o)):i.push(this.addGeometryNonPreinterleaved(e,c,d,d.data,f,t[0],n,o)));return[4,a.all(i)];case 1:return r.sent(),this.callbacks.setNeedsRender(),l(),[2]}})})},t.prototype.hasObject=function(e){return this.perObjectData.has(e)},t.prototype.updateAllComponentOpacities=function(e,t){return i(this,void 0,void 0,function(){var n,i;return r(this,function(r){switch(r.label){case 0:return[4,this.getObjectEntry(e)];case 1:return n=r.sent(),i=t instanceof Array?function(e){return t[e]}:function(e){return t},n.renderables.forEach(function(e){for(var t=e.components.meta.length,n=0;n<t;n++){var r=i(n),o=e.components.meta[n],a=o.index;o.material.opacity=r,e.components.buffer.textureBuffer.setDataElement(a,1,3,255*r)}e.allTransparent=C.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateAllComponentMaterials=function(e,t,n,o){return void 0===o&&(o=!0),i(this,void 0,void 0,function(){var i,a,s,l,c=this;return r(this,function(r){switch(r.label){case 0:return[4,this.getObjectEntry(e)];case 1:return i=r.sent(),a=n.slicePlaneEnabled||!1,s=C.determineRendererType(t),l=E.EdgeRenderer.getKey(s,a),i.renderables.forEach(function(e){if(l!==e.rendererKey){var n=c.renderers.get(e.rendererKey),i=c.acquireRenderer(s,a);n.removeRenderable(e),n.refCount.decrement(),e.rendererKey=l,i.addRenderable(e)}for(var r=0;r<t.length;r++)e.components.meta[r].material=t[r];o&&c.updateComponentBuffer(e.components),e.allTransparent=C.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateObjectVisibility=function(e,t){return i(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return[4,this.getObjectEntry(e)];case 1:return n.sent().renderables.forEach(function(e){e.visible=t}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.removeObject=function(e){var t=this,n=this.perObjectData.get(e);n&&(this.perObjectData.delete(e),n.loaded.then(function(){n.renderables.forEach(function(e){t.removeRenderable(e)}),t.callbacks.setNeedsRender()}))},t.prototype.getObjectEntry=function(e){return i(this,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:if(!(t=this.perObjectData.get(e)))throw"no object";return[4,t.loaded];case 1:return n.sent(),[2,t]}})})},t.prototype.removeAll=function(){var e=this;this.perObjectData.forEach(function(t,n){e.removeObject(n)})},t.prototype.createSolidEdgeMaterial=function(e){return n({},I,e,{type:"solid"})},t.prototype.createSketchEdgeMaterial=function(e){return n({},L,e,{type:"sketch"})},t.prototype.render=function(e){var t=this;this.localOrigins.updateViewMatrices(e.view),this.renderers.forEach(function(e){0===e.refCount.value&&(t.renderers.delete(e.key),e.dispose())}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures();var n=e.view,i=0,r=0;this.renderers.forEach(function(e){e.forEachRenderable(function(e){i+=e.statistics.averageEdgeLength,r++})});var o={distanceFalloffFactor:40*(i/r),minimumEdgeLength:C.estimateLengthAtDistance(e.viewport[3],e.fovY,1,3.5*e.pixelRatio)};this.rctx.setPipelineState(this.pipelineState),this.updateObjectCameraDistances(e),this.numberOfRenderedEdges=0,this.renderers.forEach(function(n){t.renderRegularEdges(n,e,o),t.renderSilhouetteEdges(n,e,o)}),e.view=n},t.prototype.computeModelTransformWithLocalOrigin=function(e,t,n){if(e.getCombinedStaticTransformation(t,n),t.origin)this.localOrigins.register(t.origin);else{var i=d.vec3.set(this.tmpModelPosition,n[12],n[13],n[14]);t.origin=this.localOrigins.aquire(i)}return y.applyToModelMatrix(t.origin.vec3,n),n},t.prototype.updateComponentBuffer=function(e){for(var t=e.meta,n=e.buffer,i=0;i<t.length;i++){var r=t[i].material,o=t[i].index,a=h.clamp(Math.round(r.size*E.LINE_WIDTH_FRACTION_FACTOR),0,255),s=h.clamp(r.extensionLength,-E.EXTENSION_LENGTH_OFFSET,255-E.EXTENSION_LENGTH_OFFSET)+E.EXTENSION_LENGTH_OFFSET,l="solid"===r.type?0:1,c=255*r.opacity,u=r.color,d=255*u[0],f=255*u[1],p=255*u[2],v=255*u[3];n.textureBuffer.setData(o,0,d,f,p,v),n.textureBuffer.setData(o,1,a,s,l,c)}},t.prototype.createComponentBuffers=function(e){for(var t=[],n=this.componentColorManager.getBuffer(e.length),i=0;i<e.length;i++){var r=e[i],o=n.aquireIndex();t.push({index:o,material:r})}var a={meta:t,buffer:n};return this.updateComponentBuffer(a),a},t.prototype.extractEdges=function(e,t,n,i,r){return this.worker.process({data:t,originalIndices:r,writerSettings:e,skipDeduplicate:n},i?null:this.workerThread)},t.prototype.createEdgeResources=function(e){var t={};if(e.regular.lodInfo.lengths.length>0){var n=new R(this.rctx,S.EdgeShaderAttributeLocations,{vertices:S.glVertexLayout,instances:w.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:A.createVertex(this.rctx,35044,e.regular.instancesData.buffer)});t.regular={vao:n,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){n=new R(this.rctx,S.EdgeShaderAttributeLocations,{vertices:S.glVertexLayout,instances:w.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:A.createVertex(this.rctx,35044,e.silhouette.instancesData.buffer)});t.silhouette={vao:n,lod:e.silhouette.lodInfo}}return t},t.prototype.disposeEdgeResources=function(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)},t.prototype.addGeometryNonPreinterleaved=function(e,t,n,o,a,s,l,c){return i(this,void 0,void 0,function(){var n,i,d,f;return r(this,function(r){return n=o.getAttribute("position"),i=this.computeModelTransformWithLocalOrigin(e,a,u.mat4f64.create()),d=a.origin,f={position:n,indices:o.getIndices("position"),modelTransform:i,origin:d},[2,this.addNonPreinterleaved(e,t,f,s,l,c)]})})},t.prototype.addNonPreinterleaved=function(e,t,n,o,a,s){return void 0===s&&(s=!1),i(this,void 0,void 0,function(){var e,i,l,c,u,d,f,p,h,v,g,m,y,b,x;return r(this,function(r){switch(r.label){case 0:for(e=this.acquireRenderer(o.type,a.slicePlaneEnabled||!1),i=n.modelTransform,l=n.origin,c=n.indices,u=n.position,d=u.data.length/u.strideIdx,f=S.EdgeInputBufferLayout.createBuffer(d),p=0;p<d;p++)f.position.set(p,0,u.data[u.offsetIdx+p*u.strideIdx+0]),f.position.set(p,1,u.data[u.offsetIdx+p*u.strideIdx+1]),f.position.set(p,2,u.data[u.offsetIdx+p*u.strideIdx+2]);return h=this.createComponentBuffers([o]),C.fillComponenBufferIndices(h.meta,[0,f.componentIndex.count],f.componentIndex),[4,this.extractEdges(e.writerSettings,f,!1,s,c)];case 1:return v=r.sent(),g=this.createEdgeResources(v),m=g.regular,y=g.silhouette,b=(m?m.vao.size:0)+(y?y.vao.size:0),x={regular:m,silhouette:y,transform:{modelMatrix:i,origin:l},statistics:{gpuMemoryUsage:b,averageEdgeLength:v.averageEdgeLength},components:h,visible:!0,allTransparent:C.determineAllTransparent(h.meta),distanceToCamera:0,rendererKey:e.key},t.renderables.push(x),e.addRenderable(x),this.gpuMemoryUsage+=b,[2]}})})},t.prototype.addGeometryPreinterleaved=function(e,t,n,o,a,s,c,d){return i(this,void 0,void 0,function(){var n,i,f,p,h,m,y,b,x,_,w,T,E,P,A,O;return r(this,function(r){switch(r.label){case 0:return(n=o.getAttribute("position"))&&l.isFloat32Array(n.data)?(i=C.determineRendererType(s),f=this.acquireRenderer(i,c.slicePlaneEnabled||!1),p=this.computeModelTransformWithLocalOrigin(e,a,u.mat4f64.create()),h=a.origin,m=o.getIndices("position"),y=new v.BufferViewVec3f(n.data.buffer,4*n.offsetIdx,4*n.strideIdx),b=S.EdgeInputBufferLayout.createBuffer(y.count),g.vec3.copy(b.position,y),x=this.createComponentBuffers(s),C.fillComponenBufferIndices(x.meta,o.componentOffsets,b.componentIndex,m),_=o.hasPositionData,[4,this.extractEdges(f.writerSettings,b,_,d,m)]):[2];case 1:return w=r.sent(),T=this.createEdgeResources(w),E=T.regular,P=T.silhouette,A=(E?E.vao.size:0)+(P?P.vao.size:0),O={regular:E,silhouette:P,transform:{modelMatrix:p,origin:h},statistics:{gpuMemoryUsage:A,averageEdgeLength:w.averageEdgeLength},components:x,visible:!e.isHidden(a),allTransparent:C.determineAllTransparent(x.meta),distanceToCamera:0,rendererKey:f.key},t.renderables.push(O),f.addRenderable(O),this.gpuMemoryUsage+=A,[2]}})})},t.prototype.canMergeGeometries=function(e){for(var t=null,n=null,i=0;i<e.geometries.length;i++){var r=e.geometries[i],a=e.geometryRecords[i];if(a.material.supportsEdges){if(r.data instanceof x)return!1;if(t){if(!o.equals(t,a.transformation))return!1}else t=a.transformation;if(!n&&a.origin)n=a;else if(n&&a.origin&&n.origin.id!==a.origin.id)return!1}}return!0},t.prototype.addObjectMergedGeometries=function(e,t,n,o){return i(this,void 0,void 0,function(){var i,a,s,c,d,f,p,h,v,g,m,y,b,x,_,S,w,T,E,P;return r(this,function(r){switch(r.label){case 0:for(i=new Map,a=0,s=null,c=null,E=0;E<e.geometries.length;E++)v=e.geometries[E],d=e.geometryRecords[E],d.material.supportsEdges&&(!c&&d.origin&&(c=d),y=v.data.getIndices("position"),a+=y?y.length:0,(y&&null==s||s===Uint16Array)&&(s=l.isUint16Array(y)?Uint16Array:Uint32Array));for(f=a?new s(a):null,p=[],h=0,E=0;E<e.geometries.length;E++)if(v=e.geometries[E],g=e.geometryRecords[E],g.material.supportsEdges){if(m=v.data.getAttribute("position"),y=v.data.getIndices("position"),null==(b=i.get(m.data))){for(b=p.length/3,x=m.offsetIdx;x<m.data.length;x+=m.strideIdx)p.push(m.data[x+0]),p.push(m.data[x+1]),p.push(m.data[x+2]);i.set(m.data,b)}if(y)for(_=0;_<y.length;_++)f[h++]=b+y[_]}for(S=c||e.geometryRecords[0],w=this.computeModelTransformWithLocalOrigin(e,S,u.mat4f64.create()),T=S.origin,E=0;E<e.geometryRecords.length;E++)e.geometryRecords[E].origin=T;return P={position:{data:p,offsetIdx:0,strideIdx:3},indices:f,modelTransform:w,origin:T},[4,this.addNonPreinterleaved(e,t,P,n[0],o)];case 1:return r.sent(),[2]}})})},t.prototype.acquireRenderer=function(e,t){var n=E.EdgeRenderer.getKey(e,t),i=this.renderers.get(n);return this.strokesTexture||(this.strokesTexture=P.generateStrokesTexture(this.rctx)),i||(i=new E.EdgeRenderer(this.rctx,this.programRepository,{type:e,slicePlaneEnabled:t,strokesTexture:this.strokesTexture}),this.renderers.set(n,i)),i.refCount.increment(),i},t.prototype.removeRenderable=function(e){var t=this.renderers.get(e.rendererKey);t.removeRenderable(e),t.refCount.decrement(),this.disposeEdgeResources(e),this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.gpuMemoryUsage;for(var n=0,i=e.components.meta;n<i.length;n++){var r=i[n];e.components.buffer.releaseIndex(r.index)}},t.prototype.updateObjectCameraDistances=function(e){var t=this,n=e.viewInvTransp;d.vec3.set(this.tmpCameraPosition,n[3],n[7],n[11]),this.perObjectData.forEach(function(e,n){var i=d.vec3.distance(n.getCenter(),t.tmpCameraPosition);e.renderables.forEach(function(e){return e.distanceToCamera=i})})},t.prototype.renderRegularEdges=function(e,t,n){var i=this;e.bindRegularEdges(t,n),e.forEachRenderable(function(r){if(r.visible&&r.regular&&!r.allTransparent){var o=C.computeEdgeCount(r.regular.lod.lengths,r.distanceToCamera,n);t.view=i.localOrigins.getViewMatrix(r.transform.origin),e.renderRegularEdges(r,t,o),i.numberOfRenderedEdges+=o}})},t.prototype.renderSilhouetteEdges=function(e,t,n){var i=this;e.bindSilhouetteEdges(t,n),e.forEachRenderable(function(r){if(r.visible&&r.silhouette&&!r.allTransparent){var o=C.computeEdgeCount(r.silhouette.lod.lengths,r.distanceToCamera,n);t.view=i.localOrigins.getViewMatrix(r.transform.origin),e.renderSilhouetteEdges(r,t,o),i.numberOfRenderedEdges+=o}})},t}();t.EdgeView=D;var I={color:p.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1},L={color:p.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1}}.apply(null,i))||(e.exports=r)},QDiq:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("0LE5"),n("Rdxj"),n("O7NG"),n("2Mej")],void 0===(r=function(e,t,n,i,r,o){Object.defineProperty(t,"__esModule",{value:!0});var a=i.vec3f64.create(),s=function(){function e(){this._renderLighting={main:{intensity:i.vec3f64.create(),direction:i.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldDirection=i.vec3f64.create(),this._oldSpecular=r.vec4f64.create(),this._oldDiffuse=r.vec4f64.create(),this._oldAmbient=r.vec4f64.create()}return e.prototype.setUniforms=function(e,t){if(void 0===t&&(t=!1),t||e.getDefine("GROUND_NORMAL_SHADING")){var n=(1-this._info.groundLightingFactor)*(1-this._info.globalFactor);e.setUniform1f("lightingFixedFactor",n)}else e.setUniform1f("lightingFixedFactor",0);e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var i=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",i.r[0],i.r[1],i.r[2],i.r[3]),e.setUniform4f("lightingAmbientSH_G",i.g[0],i.g[1],i.g[2],i.g[3]),e.setUniform4f("lightingAmbientSH_B",i.b[0],i.b[1],i.b[2],i.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]),e.setUniform4f("lightingAmbientSH_R1",i.r[1],i.r[2],i.r[3],i.r[4]),e.setUniform4f("lightingAmbientSH_G1",i.g[1],i.g[2],i.g[3],i.g[4]),e.setUniform4f("lightingAmbientSH_B1",i.b[1],i.b[2],i.b[3],i.b[4]),e.setUniform4f("lightingAmbientSH_R2",i.r[5],i.r[6],i.r[7],i.r[8]),e.setUniform4f("lightingAmbientSH_G2",i.g[5],i.g[6],i.g[7],i.g[8]),e.setUniform4f("lightingAmbientSH_B2",i.b[5],i.b[6],i.b[7],i.b[8])),e.setUniform3fv("lightDirection",this._oldDirection)},e.prototype.set=function(e){this._info=e,o.combineLights(e.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics),n.vec3.negate(this._oldDirection,this._renderLighting.main.direction);var t=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldAmbient[3]=1,this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*t,this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*t,this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*t,this._oldDiffuse[3]=1;var i=n.vec3.copy(a,this._oldDiffuse);n.vec3.scale(i,i,.4*this._info.globalFactor),n.vec3.add(this._oldAmbient,this._oldAmbient,i)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),e.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}},e}();t.SceneLighting=s}.apply(null,i))||(e.exports=r)},QJWI:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("H1tY"),n("VCyw"),n("Rdxj"),n("RsYQ"),n("FM7k")],void 0===(r=function(e,t,n,i,r,o,a){var s=n("dojo-debug-messages"),l=function(){function e(e,t,n,i,s){this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,renderTimeTotal:0,renderTimeLast:0,frameCount:0},this._needsRender=!0,this._rctx=s,this._renderer=new a(t,n,i,s,"scene",e),this._camera=new o(r.vec3f64.fromValues(0,100,-100))}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){var e=this._rctx.gl,t={},n=this._renderer.getCombinedStats();for(var i in n)t[i]=n[i];if(t.renderGeometriesTotal=this._stats.renderGeometriesTotal,t.renderGeometriesVisible=this._stats.renderGeometriesVisible,s&&(t.totalRenderTime=this._stats.renderTimeTotal,t.currentRenderTime=this._stats.renderTimeLast,t.totalNumFramesRendered=this._stats.frameCount),void 0!==e.getUsedTextureMemory&&(t.textureMemory=e.getUsedTextureMemory()),void 0!==e.getUsedRenderbufferMemory&&(t.renderbufferMemory=e.getUsedRenderbufferMemory()),void 0!==e.getUsedVBOMemory&&(t.VBOMemory=e.getUsedVBOMemory()),void 0!==e.getUsedTextureMemoryStats){var r=e.getUsedTextureMemoryStats();for(var o in r)t["texMem type: "+o]=r[o]}return t},e.prototype.dispose=function(){this._renderer.dispose(),this._renderer=null},e.prototype.setLighting=function(e){this._renderer.setLighting(e)},e.prototype.setRenderParams=function(e){this._renderer.setRenderParams(e)},e.prototype.getRenderParams=function(){return this._renderer.getRenderParams()},e.prototype.ensureEdgeView=function(){return this._renderer.ensureEdgeView()},Object.defineProperty(e.prototype,"hasSlicePlane",{get:function(){return this._renderer.hasSlicePlane},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeView",{get:function(){return this._renderer.edgeView},enumerable:!0,configurable:!0}),e.prototype.modify=function(e,t,n,i){this._renderer.modify(e,t,n,i)},e.prototype.setCamera=function(e){this._camera.copyFrom(e),this._needsRender=!0},e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0}),e.prototype.getFramebufferTexture=function(e){return this._renderer.getFramebufferTexture(e)},e.prototype.render=function(e){var t;s&&(t=i()),c.camera=e.camera||this._camera,c.fbo=e.fbo,c.lightDirection=e.lightDirection,c.disableSlice=e.disableSlice||!1,this._renderer.render(c),s&&(this._stats.renderTimeLast=i()-t,this._stats.renderTimeTotal+=this._stats.renderTimeLast,this._stats.frameCount++)},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()},Object.defineProperty(e.prototype,"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0}),e.prototype.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()},e}(),c={fbo:null,lightDirection:null,camera:null,disableSlice:!1};return l}.apply(null,i))||(e.exports=r)},QWGo:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("FXVB"),n("Rdxj"),n("O7NG"),n("Dk48"),n("9DjX"),n("RsYQ"),n("zZCp"),n("/Bau"),n("hkmr"),n("FM7k"),n("qUb7"),n("o5p5"),n("xFEL"),n("RC9r"),n("31XB"),n("/f24"),n("qbr3"),n("Zp3t"),n("Kfys")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v,g,m,y,b,x){var _,S=function(){function e(e,t,n,o,a,s){var l=this;this._renderTargets={},this._clearColor=r.vec4f64.fromValues(0,0,0,0),this._uniqueIdx=0,this._localOrigins=new u,this._rctx=e,this._canvas=t,this._programRep=n,this._modelDirtySet=s,this._modelDirtySet.onMaterialChanged=function(e){return l.materialChanged(e)},this._renderer=new d(n,o,a,this._rctx,"draped"),this._renderer.onHasHighlightsChanged=function(e){l.onHasHighlightsChanged&&l.onHasHighlightsChanged(e)},this._renderer.setLighting({lights:[new f.AmbientLight(i.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})}return e.prototype.dispose=function(){for(var e in this._renderTargets)this._renderTargets[e].dispose();this._renderTargets=null,this._renderer.dispose(),this._renderer=null},e.prototype.createRenderTarget=function(e){return this.createRenderTargetInternal(e,!0)},e.prototype.createHighlightRenderTarget=function(e){return this.createRenderTargetInternal(e,!1)},e.prototype.disposeRenderTarget=function(e){var t=this._renderTargets[e];t&&t.dispose(),delete this._renderTargets[e]},e.prototype.getRenderTargetTexture=function(e){var t=this._renderTargets[e];return t?t.colorTexture:null},e.prototype.addRenderGeometries=function(e){var t=this;e.forEach(function(e){null==e.origin&&(e.origin=t._localOrigins.getOrigin(e.center)),e.idx=t._uniqueIdx++}),this._renderer.modify(e,[]),this.onContentChanged&&this.onContentChanged()},e.prototype.removeRenderGeometries=function(e){this._renderer.modify([],e),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderGeometries=function(e,t){var n=e.map(function(e){return{renderGeometry:e,updateType:t}});this._renderer.modify([],[],n),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderOrder=function(e){e.size>0&&(this._renderer.modifyRenderOrder(e),this.onContentChanged&&this.onContentChanged())},e.prototype.setBackgroundColor=function(e){this._clearColor=e,this.onContentChanged&&this.onContentChanged()},e.prototype.updateHighlights=function(e){this.updateRenderGeometries(e,16)},e.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!o.OVERLAY_DRAW_TEST_TEXTURE},e.prototype.processDirtyMaterials=function(){var e=this._modelDirtySet.getDirtyMaterials();e&&this._renderer.modify([],[],[],e),this._modelDirtySet.clearDirtyMaterials()},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0}),e.prototype.draw=function(e,t){return this.drawPass(0,e,t)},e.prototype.drawHighlights=function(e,t){return this.drawPass(4,e,t)},e.prototype.drawPass=function(e,t,i){if(_=i.pixelRatio*Math.abs(i.views[0].extent[2]-i.views[0].extent[0])/Math.abs(i.views[0].viewport[2]-i.views[0].viewport[0]),this.isEmpty()||4===e&&!this.hasHighlights)return!1;if(this.processDirtyMaterials(),!i.views.some(function(e){return e.extent[0]!==e.extent[2]&&e.extent[1]!==e.extent[3]}))return!1;var r=this._renderTargets[t];if(!r)return!1;var a=this._rctx,s=i.width,l=i.height;r.width===s&&r.height===l||(r.resize(s,l),r.colorTexture.setSamplingMode(9729));var c=T.camera;T.fbo=r,c.near=1,c.far=1e4,c.pixelRatio=i.pixelRatio||1,a.bindFramebuffer(r),a.setClearColor.apply(a,this._clearColor),a.clearSafe(16384);for(var u=0;u<i.views.length;u++){var d=i.views[u];c.viewport=d.viewport,n.mat4.ortho(c.projectionMatrix,0,d.extent[2]-d.extent[0],0,d.extent[3]-d.extent[1],c.near,c.far),n.mat4.identity(c.viewMatrix),n.mat4.translate(c.viewMatrix,c.viewMatrix,[-d.extent[0],-d.extent[1],0]),c.setGLViewport(this._rctx),o.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(s,l,w[i.index%w.length]),this._renderer.renderPass(e,T)}return a.bindFramebuffer(null),a.setViewport(0,0,this._canvas.width,this._canvas.height),r.colorTexture.descriptor.hasMipmap&&r.colorTexture.generateMipmap(),!0},e.prototype._drawTestTexture=function(e,t,n){var i=this._rctx;if(!this._testPatternTexture){for(var r=new Uint8Array(e*t*4),o=0,a=0;a<t;a++)for(var s=0;s<e;s++){var u=Math.floor(s/10),d=Math.floor(a/10);u<2||d<2||10*u>e-20||10*d>t-20?(r[o++]=255,r[o++]=255,r[o++]=255,r[o++]=255):(r[o++]=255,r[o++]=255,r[o++]=255,r[o++]=1&u&&1&d?1&s^1&a?0:255:1&u^1&d?0:128)}this._testPatternTexture=new b(i,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},r),this._testPatternProgram=this._programRep.getProgram(g.texOnly),this._testPatternPipelineState=y.makePipelineState({blending:y.separateBlendingParams(770,1,771,771),colorWrite:y.defaultColorWriteParams}),this._quadVAO=c.createQuadVAO(i,l.Pos3Tex)}var f=this._testPatternProgram;i.bindProgram(f),i.setPipelineState(this._testPatternPipelineState),f.setUniform4f("color",n[0],n[1],n[2],1),f.setUniform1i("tex",0),i.bindTexture(this._testPatternTexture,0),i.bindVAO(this._quadVAO),i.drawArrays(5,0,x.vertexCount(this._quadVAO,"geometry"))},e.prototype.materialChanged=function(e){this.onContentChanged&&this.onContentChanged()},e.prototype.createRenderTargetInternal=function(e,t){for(var n=e,i=0;this._renderTargets[n];)n=e+"_"+ ++i;return this._renderTargets[n]=m.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0}),n},e.prototype.getGpuMemoryUsage=function(){var e=0;for(var t in this._renderTargets){var n=this._renderTargets[t];e+=x.getGpuMemoryUsage(n)}return e},e.prototype.intersect=function(e,t,n){var i=this,r=0;this._renderer.forEachRenderGeometry(function(o){if(!n||n(o)){if(o.material instanceof p||o.material instanceof v||o.material instanceof h){var a=o.transformation[12],s=o.transformation[13];E[0]=t[0]-a,E[1]=t[1]-s,E[2]=1,P[0]=t[0]-a,P[1]=t[1]-s,P[2]=0,o.pixelRatio=_,o.material.intersect(o,null,o.getShaderTransformation(),e,E,P,function(t,n,a,s,l,c){i.addIntersectionResult(t,n,a,o.material.renderPriority,r,l,c,e,o.data.layerUid,o.data.graphicUid)},o.calculateShaderTransformation,!0)}r++}})},e.prototype.addIntersectionResult=function(e,t,n,i,r,o,s,l,c,u){var d={type:"external",metadata:{layerUid:c,graphicUid:u}},f=function(e){e.set(d,null,l.results.terrain.dist,l.results.terrain.normal,l.results.terrain.transformation,i,null,null,n,r),e.intersector="DrapedRenderer"};if((null==l.results.min.drapedLayerOrder||i>=l.results.min.drapedLayerOrder)&&(null==l.results.min.dist||l.results.terrain.dist<=l.results.min.dist)&&f(l.results.min),(null==l.results.max.drapedLayerOrder||i<l.results.max.drapedLayerOrder)&&(null==l.results.max.dist||l.results.terrain.dist>l.results.max.dist)&&f(l.results.max),l.enable.storeAll){var p=new a.IntersectorResult(l.ray);f(p),l.results.all.push(p)}},e}(),w=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],T={fbo:null,camera:new s,lightDirection:i.vec3f64.fromValues(0,0,1)},E=i.vec3f64.create(),P=i.vec3f64.create();return S}.apply(null,i))||(e.exports=r)},RC9r:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("xhoE"),n("qsST"),n("jBNx"),n("W9tT"),n("0LE5"),n("Rdxj"),n("aWgr"),n("2B1V"),n("rjU6"),n("tUyH"),n("FNtW"),n("CIy2"),n("s6rJ"),n("uNX8"),n("ZeO9"),n("UtTF"),n("qbr3")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v,g,m,y){var b=i.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),x=function(e){function t(t,n){var i=e.call(this,n)||this;return i.params=h.copyParameters(t,w),"miter"!==i.params.join&&(i.params.miterLimit=0),i.numVertsAtJoin="wall"===i.params.type?2:4,i.numVertsAtCap=2,i.canBeMerged="screen"===i.params.type&&null==i.params.stippleLength,i}return n(t,e),t.prototype.getColor=function(){return this.params.color},t.prototype.dispose=function(){},t.prototype.setParameterValues=function(e){for(var t in e)p.assert("type"!==t,"RibbonLineMaterial: type cannot be changed after creation"),p.assert("stippleLength"!==t||null!=e[t]==(null!=this.params[t]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[t]=e[t];"miter"!==this.params.join&&(this.params.miterLimit=0),this.notifyDirty("matChanged")},t.prototype.getParameters=function(){return this.params},t.prototype.intersect=function(e,t,n,i,r,o,a,s,l){l?h.intersectDrapedRenderLineGeometry(e,t,n,i,r,o,this.params.width,a):this.intersectLineGeometry(e,t,n,i,r,o,a)},t.prototype.intersectLineGeometry=function(e,t,n,i,r,s,c,d){if(i.enable.selectionMode&&!u.isAllHidden(t.componentVisibilities,e.componentOffsets)){if(!p.isTranslationMatrix(n))return void b.error("intersection assumes a translation-only matrix");var f=e.data,h=f.getVertexAttr()[p.VertexAttrConstants.POSITION].data,v=f.getVertexAttr()[p.VertexAttrConstants.SIZE],g=v&&v.data[0],m=i.camera,y=V;o.vec2.copy(y,i.point);var x=(g+this.params.width*m.pixelRatio)/2+4*m.pixelRatio;a.vec3.set(G[0],y[0]-x,y[1]+x,0),a.vec3.set(G[1],y[0]+x,y[1]+x,0),a.vec3.set(G[2],y[0]+x,y[1]-x,0),a.vec3.set(G[3],y[0]-x,y[1]-x,0);for(var _=0;_<4;_++)m.unprojectPoint(G[_],H[_]);l.plane.fromPoints(m.eye,H[0],H[1],k),l.plane.fromPoints(m.eye,H[1],H[2],W),l.plane.fromPoints(m.eye,H[2],H[3],X),l.plane.fromPoints(m.eye,H[3],H[0],q);var S=Number.MAX_VALUE;for(_=0;_<h.length-5;_+=3)if(M[0]=h[_]+n[12],M[1]=h[_+1]+n[13],M[2]=h[_+2]+n[14],D[0]=h[_+3]+n[12],D[1]=h[_+4]+n[13],D[2]=h[_+5]+n[14],!(l.plane.signedDistance(k,M)<0&&l.plane.signedDistance(k,D)<0||l.plane.signedDistance(W,M)<0&&l.plane.signedDistance(W,D)<0||l.plane.signedDistance(X,M)<0&&l.plane.signedDistance(X,D)<0||l.plane.signedDistance(q,M)<0&&l.plane.signedDistance(q,D)<0)){if(m.projectPoint(M,F),m.projectPoint(D,B),F[2]<0&&B[2]>0){a.vec3.subtract(I,M,D);var w=m.frustum,T=-l.plane.signedDistance(w.planes[4],M)/a.vec3.dot(I,w.planes[4]);a.vec3.scale(I,I,T),a.vec3.add(M,M,I),m.projectPoint(M,F)}else if(F[2]>0&&B[2]<0){a.vec3.subtract(I,D,M);w=m.frustum,T=-l.plane.signedDistance(w.planes[4],D)/a.vec3.dot(I,w.planes[4]);a.vec3.scale(I,I,T),a.vec3.add(D,D,I),m.projectPoint(D,B)}else if(F[2]<0&&B[2]<0)continue;F[2]=0,B[2]=0;var E=l.lineSegment.distance2(l.lineSegment.fromPoints(F,B,U),y);E<S&&(S=E,a.vec3.copy(N,M),a.vec3.copy(z,D))}var P=i.rayBeginPoint,C=i.rayEndPoint;if(S<x*x){var A=Number.MAX_VALUE;if(l.lineSegment.closestLineSegmentPoint(l.lineSegment.fromPoints(N,z,U),l.lineSegment.fromPoints(P,C,j),L)){a.vec3.subtract(L,L,P);var O=a.vec3.length(L);a.vec3.scale(L,L,1/O),A=O/a.vec3.distance(P,C)}c(A,L)}}},t.prototype.createBufferWriter=function(){return"wall"===this.params.type?new C:new E(this.canBeMerged)},t.prototype.createRenderer=function(e,t){return this.canBeMerged?new g(e,t,this):new v(e,t,this)},t.prototype.getGLMaterials=function(){return{color:_,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:S}},t.prototype.getAllTextureIds=function(){return[]},t}(f),_=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.updateParameters(),i}return n(t,e),t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.selectProgram()},t.prototype.beginSlot=function(e){return e===(this.params.writeDepth?6:9)},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(m.colorPass,{screenScale:"screen"===e.type,wall:"wall"===e.type,stipple:null!=e.stippleLength,slice:e.slicePlaneEnabled}),this.pipelineState=y.makePipelineState({blending:y.separateBlendingParams(770,1,771,771),polygonOffset:e.polygonOffset&&A,depthTest:{func:513},depthWrite:e.color[3]>=1&&e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.bind=function(e,t){var n=this.program,i=this.params;if(e.bindProgram(n),e.setPipelineState(this.pipelineState),n.setUniform4fv("eColor",i.color),n.setUniform1f("miterLimit",i.miterLimit),n.setUniform1f("nearPlane",t.nearFar[0]),n.setUniform1f("pixelRatio",t.pixelRatio),n.setUniform1f("extLineWidth",i.width),"screen"===i.type&&n.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),null!=i.stippleLength){var r=i.stippleLength?1/(2*i.stippleLength):0;n.setUniform1f("stippleLengthDoubleInv",r)}},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var n=this.program,i=this.params;h.bindView(t.origin,t.view,n),i.slicePlaneEnabled&&h.bindSlicePlane(t.origin,t.slicePlane,n)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 5},t}(d),S=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.updateParameters(),i}return n(t,e),t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.selectProgram()},t.prototype.beginSlot=function(e){return 4===e},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(m.highlightPass,{screenScale:"screen"===e.type,wall:"wall"===e.type,stipple:null!=e.stippleLength,slice:e.slicePlaneEnabled}),this.pipelineState=y.makePipelineState({polygonOffset:e.polygonOffset&&A,depthTest:{func:513},depthWrite:e.color[3]>=1&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.bind=function(e,t){var n=this.program,i=this.params;if(e.bindProgram(n),e.setPipelineState(this.pipelineState),h.bindHighlightRendering(e,t,n),n.setUniform4fv("eColor",i.color),n.setUniform1f("miterLimit",i.miterLimit),n.setUniform1f("nearPlane",t.nearFar[0]),n.setUniform1f("pixelRatio",t.pixelRatio),n.setUniform1f("extLineWidth",i.width),"screen"===i.type&&n.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),null!=i.stippleLength){var r=i.stippleLength?1/(2*i.stippleLength):0;n.setUniform1f("stippleLengthDoubleInv",r)}},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var n=this.program,i=this.params;h.bindView(t.origin,t.view,n),i.slicePlaneEnabled&&h.bindSlicePlane(t.origin,t.slicePlane,n)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 5},t}(d),w={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,writeDepth:!0,polygonOffset:!1,stippleLength:null,slicePlaneEnabled:!1},T=c.newLayout().vec3f(p.VertexAttrConstants.POSITION).vec2f(p.VertexAttrConstants.UV0).vec3f(p.VertexAttrConstants.AUXPOS1).vec3f(p.VertexAttrConstants.AUXPOS2).vec4f(p.VertexAttrConstants.COLOR).f32(p.VertexAttrConstants.SIZE),E=function(){function e(e){this.canBeMerged=e,this.vertexBufferLayout=T,this.numVertsAtJoin=4,this.numVertsAtCap=2}return e.prototype.allocate=function(e){return T.createBuffer(e)},e.prototype.elementCount=function(e){var t=(e.indices[p.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;return this.canBeMerged&&(t+=2),t},e.prototype.write=function(e,t,n,i,r){var o=t.vertexAttr[p.VertexAttrConstants.POSITION].data,a=t.indices&&t.indices[p.VertexAttrConstants.POSITION];a&&(a.length,o.length);var s=t.vertexAttr[p.VertexAttrConstants.COLOR]?t.vertexAttr[p.VertexAttrConstants.COLOR].data:O,l=t.vertexAttr[p.VertexAttrConstants.SIZE]?t.vertexAttr[p.VertexAttrConstants.SIZE].data:R,c=o.length/3,u=e.transformation,d=i.position.typedBuffer,f=0,h=this.vertexBufferLayout.stride/4,v=r*h,g=v;this.canBeMerged&&(v+=h);var m=o[0],y=o[1],b=o[2];if(u){var x=m,_=y,S=b;m=u[0]*x+u[4]*_+u[8]*S+u[12],y=u[1]*x+u[5]*_+u[9]*S+u[13],b=u[2]*x+u[6]*_+u[10]*S+u[14]}var w=o[3],T=o[4],E=o[5];if(u){x=w,_=T,S=E;w=u[0]*x+u[4]*_+u[8]*S+u[12],T=u[1]*x+u[5]*_+u[9]*S+u[13],E=u[2]*x+u[6]*_+u[10]*S+u[14]}for(var P=m,C=y,A=b,M=0;M<c;M++){var D=3*M;if(M<c-1&&(w=o[D+3],T=o[D+4],E=o[D+5],u)){x=w,_=T,S=E;w=u[0]*x+u[4]*_+u[8]*S+u[12],T=u[1]*x+u[5]*_+u[9]*S+u[13],E=u[2]*x+u[6]*_+u[10]*S+u[14]}f+=Math.sqrt((P-m)*(P-m)+(C-y)*(C-y)+(A-b)*(A-b)),d[v++]=P,d[v++]=C,d[v++]=A,d[v++]=f,d[v++]=0===M?-1.2:-1,d[v++]=m,d[v++]=y,d[v++]=b,d[v++]=w,d[v++]=T,d[v++]=E,d[v++]=s[0],d[v++]=s[1],d[v++]=s[2],d[v++]=s[3],d[v++]=l[0],d[v++]=P,d[v++]=C,d[v++]=A,d[v++]=f,d[v++]=0===M?1.2:1,d[v++]=m,d[v++]=y,d[v++]=b,d[v++]=w,d[v++]=T,d[v++]=E,d[v++]=s[0],d[v++]=s[1],d[v++]=s[2],d[v++]=s[3],d[v++]=l[0],M>0&&M<c-1&&(d[v++]=P,d[v++]=C,d[v++]=A,d[v++]=f,d[v++]=-1.2,d[v++]=m,d[v++]=y,d[v++]=b,d[v++]=w,d[v++]=T,d[v++]=E,d[v++]=s[0],d[v++]=s[1],d[v++]=s[2],d[v++]=s[3],d[v++]=l[0],d[v++]=P,d[v++]=C,d[v++]=A,d[v++]=f,d[v++]=1.2,d[v++]=m,d[v++]=y,d[v++]=b,d[v++]=w,d[v++]=T,d[v++]=E,d[v++]=s[0],d[v++]=s[1],d[v++]=s[2],d[v++]=s[3],d[v++]=l[0]),m=P,y=C,b=A,P=w,C=T,A=E}if(this.canBeMerged){for(M=g;M<g+h;M++)d[M]=d[M+h];var I=v-h;for(M=0;M<h;M++)d[v++]=d[I++]}},e}(),P=c.newLayout().vec3f(p.VertexAttrConstants.POSITION).vec2f(p.VertexAttrConstants.UV0),C=function(){function e(){this.vertexBufferLayout=P,this.numVertsAtJoin=2,this.numVertsAtCap=2,this.tmpCurrent=s.vec3f64.create(),this.tmpLast=s.vec3f64.create()}return e.prototype.allocate=function(e){return T.createBuffer(e)},e.prototype.elementCount=function(e){return(e.indices[p.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap},e.prototype.write=function(e,t,n,i,r){var o=t.vertexAttr[p.VertexAttrConstants.POSITION].data,s=t.indices&&t.indices[p.VertexAttrConstants.POSITION];s&&(s.length,o.length);var l=o.length/3,c=e.transformation,u=0,d=this.tmpCurrent,f=this.tmpLast;a.vec3.set(d,o[0],o[1],o[2]);for(var h=r,v=0;v<l;v++){var g=3*v;a.vec3.copy(f,d),a.vec3.set(d,o[g],o[g+1],o[g+2]),c&&a.vec3.transformMat4(d,d,c),u+=a.vec3.squaredDistance(f,d),i.position.setVec(h,d),i.uv0.set(h,0,u),i.uv0.set(h,1,-1),++h,i.position.setVec(h,d),i.uv0.set(h,0,u),i.uv0.set(h,1,1),++h}},e}(),A={factor:0,units:-4},O=[255,255,255,255],R=[0,0,0,0],M=s.vec3f64.create(),D=s.vec3f64.create(),I=s.vec3f64.create(),L=s.vec3f64.create(),V=s.vec3f64.create(),F=r.createRenderScreenPointArray3(),B=r.createRenderScreenPointArray3(),N=s.vec3f64.create(),z=s.vec3f64.create(),U=l.lineSegment.create(),j=l.lineSegment.create(),G=[r.createRenderScreenPointArray3(),r.createRenderScreenPointArray3(),r.createRenderScreenPointArray3(),r.createRenderScreenPointArray3()],H=[s.vec3f64.create(),s.vec3f64.create(),s.vec3f64.create(),s.vec3f64.create()],k=l.plane.create(),W=l.plane.create(),X=l.plane.create(),q=l.plane.create();return x}.apply(null,i))||(e.exports=r)},Raj5:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){var n=function(){function e(e,t,n,r,o,a){this.camera=null,this.pass=0,this.slot=0,this.options=null,this.renderOccludedMask=i,this.rctx=e,this.offscreenRenderingHelper=t,this.lightingData=n,this.shadowMap=r,this.ssaoHelper=o,this.sliceHelper=a}return e.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=i},Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0}),e}(),i=5;return n}.apply(null,i))||(e.exports=r)},Rrc3:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("H1tY")],void 0===(r=function(e,t,n){return function(){function e(t,i){this._context=t,this._desc=i,this._glName=null,this._id=-1;var r=this._context.gl;n("esri-webgl-debug")&&this._context.instanceCounter.incrementCount(5),this._id=++e._nextId,this._glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this),r.renderbufferStorage(r.RENDERBUFFER,i.internalFormat,i.width,i.height)}return Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t){var n=this._context.gl,i=this._desc;i.width===e&&i.height===t||(i.width=e,i.height=t,this._context.bindRenderbuffer(this),n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height))},e.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null),n("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(5),this._context=null},e._nextId=0,e}()}.apply(null,i))||(e.exports=r)},RsYQ:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("jBNx"),n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("aWgr"),n("AzkI"),n("18xY"),n("CIy2")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f){function p(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],o=t[3]-e[3];return n*n+i*i+r*r+o*o}function h(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function v(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}var g=function(){function e(e,t,n){void 0===e&&(e=a.vec3f64.create()),void 0===t&&(t=a.vec3f64.create()),void 0===n&&(n=a.vec3f64.fromValues(0,0,1)),this._viewUp=a.vec3f64.create(),this._viewForward=a.vec3f64.create(),this._viewRight=a.vec3f64.create(),this._ray=c.ray.createWrapper(),this._viewport=l.vec4f64.fromValues(0,0,1,1),this._padding=l.vec4f64.fromValues(0,0,0,0),this._fov=55/180*Math.PI,this._near=1,this._far=1e3,this._viewDirty=!0,this._viewMatrix=r.mat4f64.create(),this._projectionDirty=!0,this._projectionMatrix=r.mat4f64.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=r.mat4f64.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=r.mat4f64.create(),this._frustumDirty=!0,this._frustum=c.frustum.create(),this._fullViewport=null,this.pixelRatio=1,this.relativeElevation=0,this._eye=a.vec3f64.clone(e),this._center=a.vec3f64.clone(t),this._up=a.vec3f64.clone(n),this._padding=l.vec4f64.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=a.vec3f64.create()),o.vec3.subtract(this._ray.direction,this.center,this.eye),this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){i.mat4.copy(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(this._near=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._far=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=l.vec4f64.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),s.vec4.copy(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(i.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2),r=n*this.aspect;i.mat4.frustum(this._projectionMatrix,-r*(1+2*this._padding[3]/e),r*(1+2*this._padding[1]/e),-n*(1+2*this._padding[2]/t),n*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){i.mat4.copy(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return f.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=f.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return f.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=f.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return o.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustum",{get:function(){return this._recomputeFrustum(),this._frustum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=r.mat4f64.create()),i.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),i.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation>=0},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){return o.vec3.copy(this._eye,e._eye),o.vec3.copy(this._center,e._center),o.vec3.copy(this._up,e._up),s.vec4.copy(this._viewport,e._viewport),s.vec4.copy(this._padding,e._padding),this._near=e._near,this._far=e._far,this._fov=e._fov,this.relativeElevation=e.relativeElevation,this._viewDirty=e._viewDirty,this._viewDirty||(i.mat4.copy(this._viewMatrix,e._viewMatrix),o.vec3.copy(this._viewRight,e._viewRight),o.vec3.copy(this._viewUp,e._viewUp),o.vec3.copy(this._viewForward,e._viewForward)),e._projectionDirty?this._projectionDirty=!0:(i.mat4.copy(this._projectionMatrix,e._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(c.frustum.copy(e._frustum,this._frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?i.mat4.copy(this._viewInverseTransposeMatrix,e._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=r.mat4f64.clone(e._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),e._fullViewport?this._fullViewport?s.vec4.copy(this._fullViewport,e._fullViewport):this._fullViewport=l.vec4f64.clone(e._fullViewport):this._fullViewport=null,this.pixelRatio=e.pixelRatio,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.copy=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equals=function(e){return h(this._eye,e._eye)&&h(this._center,e._center)&&h(this._up,e._up)&&v(this._viewport,e._viewport)&&v(this._padding,e._padding)&&this._near===e._near&&this._far===e._far&&this._fov===e._fov&&this.pixelRatio===e.pixelRatio},e.prototype.almostEquals=function(e,t,n){void 0===n&&(n=!1);var i,r=o.vec3.distance(this._eye,this._center)*(t||5e-4),a=r*r;return n?(u.directionFromTo(b,e._eye,e._center),u.directionFromTo(x,this._eye,this._center),i=1e-10):(o.vec3.copy(b,e._center),o.vec3.copy(x,this._center),i=a),o.vec3.squaredDistance(e._eye,this._eye)<a&&o.vec3.squaredDistance(b,x)<i&&Math.abs(e._fov-this._fov)<.001&&p(e._padding,this._padding)<.5&&p(e._viewport,this._viewport)<.5&&this.pixelRatio===e.pixelRatio},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0},e.prototype.computeRenderPixelSizeAt=function(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.computeRenderPixelSizeAtDist=function(e){return e*this.perRenderPixelRatio},e.prototype.computeScreenPixelSizeAt=function(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.viewDirectionDistance=function(e){return Math.abs(d.projectPointSignedLength(this.viewForward,o.vec3.subtract(b,e,this._eye)))},e.prototype.computeScreenPixelSizeAtDist=function(e){return e*this.perScreenPixelRatio},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.getScreenCenter=function(e){return void 0===e&&(e=n.createScreenPointArray()),e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[2]+this.height/2)/this.pixelRatio,e},e.prototype.getRenderCenter=function(e){return e||(e=n.createRenderScreenPointArray3()),e[0]=this.padding[3]+this.width/2,e[1]=this.padding[2]+this.height/2,e.length>2&&(e[2]=.5),e},e.prototype.setGLViewport=function(e){var t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])},e.prototype.applyProjection=function(e,t,n){void 0===n&&(n=!1),e!==m&&o.vec3.copy(m,e),m[3]=1,n&&(t[2]=-m[2]),s.vec4.transformMat4(m,m,this.projectionMatrix),o.vec3.scale(m,m,1/Math.abs(m[3]));var i=this.fullViewport;return t[0]=u.lerp(0,i[0]+i[2],.5+.5*m[0]),t[1]=u.lerp(0,i[1]+i[3],.5+.5*m[1]),n||(t[2]=.5*(m[2]+1)),t},e.prototype.projectPoint=function(e,t){if(m[0]=e[0],m[1]=e[1],m[2]=e[2],m[3]=1,s.vec4.transformMat4(m,m,this.viewProjectionMatrix),0===m[3])return null;o.vec3.scale(m,m,1/Math.abs(m[3]));var n=this.fullViewport;return"x"in t?(t.x=u.lerp(0,n[0]+n[2],.5+.5*m[0]),t.y=u.lerp(0,n[1]+n[3],.5+.5*m[1])):(t[0]=u.lerp(0,n[0]+n[2],.5+.5*m[0]),t[1]=u.lerp(0,n[1]+n[3],.5+.5*m[1]),t.length>2&&(t[2]=.5*(m[2]+1))),t},e.prototype.unprojectPoint=function(e,t){if(i.mat4.multiply(y,this.projectionMatrix,this.viewMatrix),!i.mat4.invert(y,y))return null;var n=this.fullViewport;return m[0]=2*(e[0]-n[0])/n[2]-1,m[1]=2*(e[1]-n[1])/n[3]-1,m[2]=2*e[2]-1,m[3]=1,s.vec4.transformMat4(m,m,y),0===m[3]?null:(t[0]=m[0]/m[3],t[1]=m[1]/m[3],t[2]=m[2]/m[3],t)},e.prototype.computeUp=function(e){"global"===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.screenToRender=function(e,t){var n=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=n,t[1]=i,t},e.prototype.renderToScreen=function(e,t){var n=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;return t[0]=n,t[1]=i,t},e.prototype.computeUpGlobal=function(){o.vec3.subtract(b,this.center,this.eye);var e=o.vec3.length(this.center);e<1?(o.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(o.vec3.dot(b,this.center))>.9999*o.vec3.length(b)*e||(o.vec3.cross(this.up,b,this.center),o.vec3.cross(this.up,this.up,b),o.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){u.directionFromTo(b,this.eye,this.center),Math.abs(b[2])<=.9999&&(o.vec3.scale(b,b,b[2]),o.vec3.set(this.up,-b[0],-b[1],1-b[2]),o.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){h(e,t)||(o.vec3.copy(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)},e.prototype._recomputeFrustum=function(){this._frustumDirty&&(c.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)},e.prototype._ensureViewClean=function(){this._viewDirty&&(i.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),o.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),o.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),o.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}(),m=l.vec4f64.create(),y=r.mat4f64.create(),b=a.vec3f64.create(),x=a.vec3f64.create();return g}.apply(null,i))||(e.exports=r)},TCFx:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){return function(){function e(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}return e.prototype.incrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}},e.prototype.decrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}},e.prototype.printResourceCount=function(){},e}()}.apply(null,i))||(e.exports=r)},TP2F:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("xhoE"),n("2Atf"),n("H1tY"),n("51bw"),n("0LE5"),n("Rdxj"),n("2B1V"),n("9FJH"),n("FNtW"),n("CIy2"),n("hnAi"),n("s6rJ"),n("s6rJ"),n("fPnv"),n("ZeO9"),n("C2Ab"),n("qbr3")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v,g,m,y){function b(e,t){return e?t?6:9:4}function x(e,t){var n=t.vvSizeEnabled;t.vvSizeEnabled?(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)):n&&e.setUniform3fv("vvSizeValue",t.vvSizeValue),n&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",t.vvSymbolRotationMatrix)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}function _(e){return!e.slicePlaneEnabled&&(e.cullFace?"none"!==e.cullFace:!e.transparent&&!e.doubleSided)}var S=d.assert,w=function(e){function t(n,i){var r=e.call(this,i)||this;return r.supportsEdges=!0,r.params=h.copyParameters(n,O),r.vertexBufferLayout=t.getVertexBufferLayout(r.params),r.instanceBufferLayout=n.instanced?t.getInstanceBufferLayout(r.params):null,r.textureMode=r.vertexBufferLayout.hasField("uv0")?"Textured":"none",r}return n(t,e),t.prototype.isVisibleInPass=function(e){return 3!==e||this.params.castShadows},t.prototype.isVisible=function(){var t=this.params;if(!e.prototype.isVisible.call(this)||0===t.layerOpacity)return!1;var n=t.instanced,i=t.vertexColors,r=t.symbolColors,o=!!n&&n.indexOf("color")>-1,a=t.vvColorEnabled,s="replace"===t.colorMixMode,l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return i&&(o||a||r)?!!s||l:i?s?c:l:o||a||r?!!s||l:s?c:l},t.prototype.setParameterValues=function(e){var t=this.params;for(var n in e)"instanced"===n&&S(e.instanced===t.instanced,"Can not change instanced attributes"),"textureId"===n&&S(t.textureId,"Can only change texture of material that already has a texture"),"vertexColors"===n&&!0===e[n]&&e[n]!==t[n]&&S(t.vertexColors,"Can not enable vertex colors after DefaultMaterial creation"),t[n]=e[n];this.notifyDirty("matChanged")},t.prototype.getParameters=function(){return this.params},t.prototype.intersect=function(e,t,n,i,r,o,s,l){if(null!==this.params.verticalOffset){var c=i.camera;a.vec3.set(z,n[12],n[13],n[14]);var u=a.vec3.subtract(U,z,c.eye),d=a.vec3.length(u),f=a.vec3.scale(u,u,1/d),p=null,v=null;switch(i.viewingMode){case"global":v=a.vec3.normalize(B,z);break;case"local":v=a.vec3.copy(B,F)}this.params.screenSizePerspective&&(p=a.vec3.dot(v,f));var g=h.verticalOffsetAtDistance(c,d,this.params.verticalOffset,p,this.params.screenSizePerspective);a.vec3.scale(v,v,g),a.vec3.transformMat3(N,v,i.transform.inverseRotation),r=a.vec3.subtract(L,r,N),o=a.vec3.subtract(V,o,N)}h.intersectTriangleGeometry(e,t,n,i,r,o,s)},t.prototype.getGLMaterials=function(){return{color:T,depthShadowMap:P,normal:C,depth:E,highlight:A}},t.prototype.getAllTextureIds=function(){var e=new Array;return this.params.textureId&&e.push(this.params.textureId),this.params.normalTextureId&&e.push(this.params.normalTextureId),[]},t.prototype.createRenderer=function(e,t){return this.params.instanced&&this.params.instanced.length>0?new v(e,t,this):new g(e,t,this)},t.prototype.createBufferWriter=function(){return new R(this.vertexBufferLayout,this.instanceBufferLayout)},t.getVertexBufferLayout=function(e){var t=l.newLayout().vec3f("position").vec3f("normal");return e.vertexTangents&&t.vec4f("aTangent"),e.textureId&&t.vec2f("uv0"),e.vertexColors&&t.vec4u8("color"),e.symbolColors&&t.vec4u8("symbolColor"),t},t.getInstanceBufferLayout=function(e){var t=l.newLayout();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t},t}(u),T=function(e){function t(t,n,i){var r=this,o=t.getParameters();(r=e.call(this,t,n,i,o.textureId,o.normalTextureId,o.textureInitTransparent)||this).params=h.copyParameters(o);var a=r.params;r.slot=b(a.transparent,a.writeDepth),r.textureMode=t.textureMode;var s=a.instanced;return r.instanced=!!s,r.instancedColor=!!s&&s.indexOf("color")>-1,r._createPrograms(),r.selectPipeline(),r}return n(t,e),t.prototype._createPrograms=function(){var e=this;this.programs=p.BindParametersMap.create(this.params,function(t){return e._createProgram(t)})},t.prototype._createProgram=function(e){var t=this.params;return this.programRep.getProgram(m.colorPass,{treeRendering:!!t.treeRendering,textureMode:this.textureMode,normalTexture:!!t.normalTextureId,tangents:t.vertexTangents?"vertex":"none",vertexColors:t.vertexColors,symbolColors:t.symbolColors,flipV:t.flipV,doubleSided:t.doubleSided&&"normal"===t.doubleSidedType,windowOrderDoubleSided:t.doubleSided&&"winding-order"===t.doubleSidedType,instanced:!!this.instanced,instancedDoublePrecision:t.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:e.receiveShadows,receiveSSAO:e.receiveSSAO,vvSize:t.vvSizeEnabled,vvColor:t.vvColorEnabled,verticalOffset:null!==t.verticalOffset,screenSizePerspective:null!==t.screenSizePerspective,slice:t.slicePlaneEnabled,normals:t.normals,textureAlphaMode:t.textureAlphaMode,textureAlphaPremultiplied:!!t.textureAlphaPremultiplied,iosSafariFix:I})},t.prototype.selectPipeline=function(){var e=this.params;this.pipelineState=y.makePipelineState({blending:M(e),culling:D(e),depthTest:{func:513},depthWrite:e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program||this.getPrograms()[0]},t.prototype.getPrograms=function(){return p.BindParametersMap.programs(this.programs)},t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.slot=b(this.params.transparent,this.params.writeDepth),this.updateTexture(this.params.textureId),this._createPrograms(),this.selectPipeline()},t.prototype.bind=function(e,t){var n=this.params,i=this.program=p.BindParametersMap.lookup(this.programs,t);e.bindProgram(i),e.setPipelineState(this.pipelineState),i.setUniform3fv("ambient",n.ambient),i.setUniform3fv("diffuse",n.diffuse),i.setUniform3fv("specular",n.specular),i.setUniform4fv("externalColor",n.externalColor),i.setUniform1i("colorMixMode",h.colorMixModes[n.colorMixMode]),i.setUniform1f("opacity",n.opacity),i.setUniform1f("layerOpacity",n.layerOpacity),h.bindVerticalOffset(n.verticalOffset,t,i),h.bindScreenSizePerspective(n.screenSizePerspective,i),x(i,n),this.bindTexture(e,i),"none"!==this.textureMode&&this.bindTextureSize(e,i),"mask"!==n.textureAlphaMode&&"maskBlend"!==n.textureAlphaMode||i.setUniform1f("textureAlphaCutoff",n.textureAlphaCutoff)},t.prototype.release=function(e,t){},t.prototype.bindView=function(e,t){var n=this.program=p.BindParametersMap.lookup(this.programs,t),i=this.params,r=i.instancedDoublePrecision?s.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(r,t.view,n),h.bindCamPos(r,t.viewInvTransp,n),i.instancedDoublePrecision&&h.bindViewOriginDouble(r,n),i.slicePlaneEnabled&&h.bindSlicePlane(r,t.slicePlane,n),t.shadowMappingEnabled&&t.shadowMap.bindView(n,r)},t.prototype.bindInstance=function(e,t){var n=this.program;n.setUniformMatrix4fv("model",t.transformation),n.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(c),E=function(e){function t(t,n,i,r){void 0===r&&(r=!1);var o=e.call(this,t,n,i,t.getParameters().textureId)||this;return o.textureMode=t.textureMode,o.biased=r,o.updateParameters(),o}return n(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(m.depthPass,{textureMode:this.textureMode,normalTexture:!!e.normalTextureId,tangents:e.vertexTangents?"vertex":"none",flipV:e.flipV,instanced:!!e.instanced,instancedDoublePrecision:e.instancedDoublePrecision,shadowMap:this.biased,vvSize:e.vvSizeEnabled,verticalOffset:null!==e.verticalOffset,screenSizePerspective:null!==e.screenSizePerspective,slice:e.slicePlaneEnabled,textureAlphaMode:e.textureAlphaMode,normals:e.normals,iosSafariFix:I}),this.pipelineState=y.makePipelineState({culling:D(e),depthTest:{func:513},depthWrite:e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.selectSlot=function(){this.slot=b(this.params.transparent,this.params.writeDepth)},t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var n=this.program,i=this.params;e.bindProgram(n),e.setPipelineState(this.pipelineState),n.setUniform2fv("nearFar",t.nearFar),h.bindVerticalOffset(i.verticalOffset,t,n),h.bindScreenSizePerspective(i.screenSizePerspective,n),x(n,i),"mask"!==i.textureAlphaMode&&"maskBlend"!==i.textureAlphaMode||n.setUniform1f("textureAlphaCutoff",i.textureAlphaCutoff),this.bindTexture(e,n)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var n=this.program,i=this.params,r=i.instancedDoublePrecision?s.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(r,t.view,n),i.slicePlaneEnabled&&h.bindSlicePlane(r,t.slicePlane,n),i.screenSizePerspective&&h.bindCamPos(r,t.viewInvTransp,n),i.instancedDoublePrecision&&h.bindViewOriginDouble(r,n)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 4},t}(c),P=function(e){function t(t,n,i){return e.call(this,t,n,i,!0)||this}return n(t,e),t}(E),C=function(e){function t(t,n,i){var r=e.call(this,t,n,i,t.getParameters().textureId)||this;return r.params=h.copyParameters(t.getParameters()),r.textureMode=t.textureMode,r.selectProgram(),r.selectSlot(),r}return n(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(m.normalPass,{textureMode:this.textureMode,normalTexture:!!e.normalTextureId,tangents:e.vertexTangents?"vertex":"none",flipV:e.flipV,instanced:!!e.instanced,instancedDoublePrecision:e.instancedDoublePrecision,vvSize:e.vvSizeEnabled,verticalOffset:null!==e.verticalOffset,screenSizePerspective:null!==e.screenSizePerspective,slice:e.slicePlaneEnabled,textureAlphaMode:e.textureAlphaMode,normals:e.normals,iosSafariFix:I}),this.pipelineState=y.makePipelineState({culling:D(e),depthTest:{func:513},depthWrite:e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.selectSlot=function(){this.slot=b(this.params.transparent,this.params.writeDepth)},t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var n=this.program,i=this.params;e.bindProgram(n),e.setPipelineState(this.pipelineState),this.bindTexture(e,n),h.bindVerticalOffset(i.verticalOffset,t,n),h.bindScreenSizePerspective(i.screenSizePerspective,n),x(n,i),"mask"!==i.textureAlphaMode&&"maskBlend"!==i.textureAlphaMode||n.setUniform1f("textureAlphaCutoff",i.textureAlphaCutoff)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var n=this.program,i=this.params,r=i.instancedDoublePrecision?s.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(r,t.view,n),n.setUniformMatrix4fv("viewNormal",t.viewInvTransp),i.slicePlaneEnabled&&h.bindSlicePlane(r,t.slicePlane,n),i.screenSizePerspective&&h.bindCamPos(r,t.viewInvTransp,n),i.instancedDoublePrecision&&h.bindViewOriginDouble(r,n)},t.prototype.bindInstance=function(e,t){var n=this.program;n.setUniformMatrix4fv("model",t.transformation),n.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(c),A=function(e){function t(t,n,i){var r=e.call(this,t,n,i,t.getParameters().textureId)||this;return r.textureMode=t.textureMode,r.updateParameters(),r}return n(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(m.highlightPass,{textureMode:this.textureMode,normalTexture:!!e.normalTextureId,tangents:e.vertexTangents?"vertex":"none",flipV:e.flipV,instanced:!!e.instanced,instancedDoublePrecision:e.instancedDoublePrecision,vvSize:e.vvSizeEnabled,verticalOffset:null!==e.verticalOffset,screenSizePerspective:null!==e.screenSizePerspective,slice:e.slicePlaneEnabled,textureAlphaMode:e.textureAlphaMode,normals:e.normals,iosSafariFix:I}),this.pipelineState=y.makePipelineState({culling:D(e),depthTest:{func:513},depthWrite:e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.selectSlot=function(){this.slot=b(this.params.transparent,this.params.writeDepth)},t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var n=this.program,i=this.params;e.bindProgram(n),e.setPipelineState(this.pipelineState),h.bindHighlightRendering(e,t,n),this.bindTexture(e,n),h.bindVerticalOffset(i.verticalOffset,t,n),h.bindScreenSizePerspective(i.screenSizePerspective,n),x(n,i),"mask"!==i.textureAlphaMode&&"maskBlend"!==i.textureAlphaMode||n.setUniform1f("textureAlphaCutoff",i.textureAlphaCutoff)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var n=this.program,i=this.params,r=i.instancedDoublePrecision?s.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(r,t.view,n),i.slicePlaneEnabled&&h.bindSlicePlane(r,t.slicePlane,n),i.screenSizePerspective&&h.bindCamPos(r,t.viewInvTransp,n),i.instancedDoublePrecision&&h.bindViewOriginDouble(r,n)},t.prototype.bindInstance=function(e,t){var n=this.program;n.setUniformMatrix4fv("model",t.transformation),n.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(c);(w||(w={})).COLOR_GAMMA=2.1;var O={textureId:void 0,textureInitTransparent:!1,normalTextureId:void 0,vertexTangents:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:o.mat3f64.create(),transparent:!1,writeDepth:!0,textureAlphaMode:"blend",textureAlphaCutoff:.1,textureAlphaPremultiplied:!1},R=function(){function e(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices.position.length},e.prototype.write=function(e,t,n,i,r){f.writeDefaultAttributes(t,n,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)},e}(),M=function(e){return e.transparent&&y.separateBlendingParams(770,1,771,771)},D=function(e){return _(e)&&{face:"front"===e.cullFace?1028:1029,mode:2305}},I=!!r("ios")&&!!r("safari"),L=s.vec3f64.create(),V=s.vec3f64.create(),F=s.vec3f64.fromValues(0,0,1),B=s.vec3f64.create(),N=s.vec3f64.create(),z=s.vec3f64.create(),U=s.vec3f64.create();return w}.apply(null,i))||(e.exports=r)},TZB2:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("ff/U"),n("zbgD")],void 0===(r=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return"#define SAMPLES "+e.samples+"\n"},o=function(e){return"#define RADIUS "+e.radius+"\n"};t.ssaoPass={name:"ssao",shaders:function(e){return{vertexShader:i.resolveIncludes("util/quad.vert"),fragmentShader:r(e)+i.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:n.Default3D},t.blurPass={name:"ssao-blur",shaders:function(e){return{vertexShader:i.resolveIncludes("util/quad.vert"),fragmentShader:o(e)+i.resolveIncludes("renderer/ssao/blur.frag")}},attributes:n.Default3D}}.apply(null,i))||(e.exports=r)},Teen:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("U+8K")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.glslifyGlobalOptions=function(e){return n.glslifyDefineMap({VIEWING_MODE:{value:e.viewingMode,options:{global:"VIEWING_MODE_GLOBAL",local:"VIEWING_MODE_LOCAL"}}})}}.apply(null,i))||(e.exports=r)},TqPN:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("GntT"),n("f3AO"),n("dB/a"),n("cza4"),n("9o4r"),n("W5Zm"),n("Gz8v")],void 0===(r=function(e,t,n,i,r,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=i,t.mat4=r,t.scalar=o,t.vec2=a,t.vec3=s,t.vec4=l,t.createBuffer=function(e,t){return new e(new ArrayBuffer(t*e.ElementCount*n.elementTypeSize(e.ElementType)))}}.apply(null,i))||(e.exports=r)},U6iw:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("7laH")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(t.disjointTimerQuery)return null;var i=e.getExtension("EXT_disjoint_timer_query")||e.getExtension("EXT_disjoint_timer_query_webgl2");return i?n.default(e)?{createQuery:function(){return e.createQuery()},resultAvailable:function(t){return e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)},getResult:function(t){return e.getQueryParameter(t,e.QUERY_RESULT)},disjoint:function(){return e.getParameter(i.GPU_DISJOINT_EXT)},beginTimeElapsed:function(t){return e.beginQuery(i.TIME_ELAPSED_EXT,t)},endTimeElapsed:function(){return e.endQuery(i.TIME_ELAPSED_EXT)},createTimestamp:function(e){return i.queryCounterEXT(e,i.TIMESTAMP_EXT)},timestampBits:function(){return e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return i.createQueryEXT()},resultAvailable:function(e){return i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(e){return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)},disjoint:function(){return e.getParameter(i.GPU_DISJOINT_EXT)},beginTimeElapsed:function(e){return i.beginQueryEXT(i.TIME_ELAPSED_EXT,e)},endTimeElapsed:function(){return i.endQueryEXT(i.TIME_ELAPSED_EXT)},createTimestamp:function(e){return i.queryCounterEXT(e,i.TIMESTAMP_EXT)},timestampBits:function(){return i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)}}:null}}.apply(null,i))||(e.exports=r)},UD5A:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("FXVB"),n("1m5D"),n("p23x")],void 0===(r=function(e,t,n,i,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.factory=e,this.originData=new Map}return e.prototype.aquire=function(e){return this.register(this.factory.getOrigin(e))},e.prototype.register=function(e){var t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:i.mat4f64.create(),origin:e}),e)},e.prototype.release=function(e){var t=this.originData.get(e.id);t&&0==--t.refCount&&this.originData.delete(e.id)},e.prototype.updateViewMatrices=function(e){this.originData.forEach(function(t){n.mat4.copy(t.viewMatrix,e),r.applyToViewMatrix(t.origin.vec3,t.viewMatrix)})},e.prototype.getViewMatrix=function(e){return this.originData.get(e.id).viewMatrix},e}();t.LocalOriginManager=o}.apply(null,i))||(e.exports=r)},UtTF:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("ff/U"),n("zbgD"),n("U+8K")],void 0===(r=function(e,t,n,i,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return r.glslifyDefineMap({WALL:e.wall,SCREENSCALE:e.screenScale,STIPPLE:e.stipple,SLICE:e.slice})};t.colorPass={name:"ribbon-line-color",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:o(e)+i.resolveIncludes("materials/ribbonLine/colorPass.frag")}},attributes:n.Default3D},t.highlightPass={name:"ribbon-line-highlight",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:o(e)+i.resolveIncludes("materials/ribbonLine/highlightPass.frag")}},attributes:n.Default3D}}.apply(null,i))||(e.exports=r)},VVgn:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){return{edgeRenderer:{"adjustProjectedPosition.glsl":"uniform vec2 uDepthBias;\nuniform vec2 uViewportDimInv;\n\n// Utility function to check for NaN values\nbool isNaN(float val) {\n  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;\n  // important: some nVidias failed to cope with version below.\n  // Probably wrong optimization.\n  /*return ( val <= 0.0 || 0.0 <= val ) ? false : true;*/\n}\n\n// An offset in xy screen space, along the projected normal of the edge\n// This reduces depth fighting when looking at a face from a flat angle\nvec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\n  float offsetXY = uDepthBias.x;\n  float offsetZ  = uDepthBias.y;\n\n  // screen space pixel offset\n  // we multiply by two to account for the fact that NDC go from -1 to 1\n  // we multiply by projPos.w to compensate for the perspective divison that happens later\n  // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n  // towards the camera\n  vec4 projNormal = uProj * uView * vec4(worldNormal, 0.0);\n\n  return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n}\n\n// A z-offset, using a depth based heuristic.\nfloat calculateProjectedBiasZ(vec4 projPos) {\n  float offsetZ = uDepthBias.y;\n  return sqrt(projPos.z) * offsetZ;\n}\n\nvec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n  vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);\n\n  // we currently have to do this check because some geometries come with 0 length edge normals.\n  // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n  if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {\n    projPos.xy += offsetXY;\n  }\n\n  projPos.z += calculateProjectedBiasZ(projPos);\n\n  return projPos;\n}\n","edgeRenderer.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nvarying vec4 vColor;\nvarying float vRadius;\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vLineLengthPixels;\nvarying float vSizeFalloffFactor;\nvarying float vLineIndex;\n\n// At which coverage threshold we discard a fragment completely\n#define COVERAGE_TEST_THRESHOLD 0.01\n\n#include <edgeRenderer/lineOffset.glsl>\n\nvec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n  float lineOffset = calculateLineOffset();\n  float positionX = position.x - lineOffset;\n\n  if (radius < 1.0) {\n    // Handle this specifically for subpixel sizes:\n    // 1. Compute correct coverage (note coverage is computed by\n    //    0.5 - dist, so we make sure that that will lead to correct\n    //    subpixel coverage\n    // 2. Ignore rounded caps\n    float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n    float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n    float coverage = min(coverageX, coverageY);\n\n    return vec2(0.5 - coverage, 0.0);\n  }\n  else {\n    // Between -radius -> 0 for start cap, 0 for line, 0 -> radius\n    float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);\n\n    vec2 lineToPosition = vec2(positionX, positionOnCap);\n    return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n  }\n}\n\nvoid main() {\n\n  float radius = vRadius * calculateLinePressure();\n\n  vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n  float coverage = clamp(0.5 - distance.x, 0.0, 1.0);\n\n#ifdef ANTIALIASING\n\n  const float coverageLimit = COVERAGE_TEST_THRESHOLD;\n\n#else /* ANTIALIASING */\n\n  // Use subpixel coverage computation when lines get subpixel widths\n  // so we still render them appropriately. Otherwise discard anything\n  // that is not fully within the line\n  float coverageLimit = radius <= 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\n\n#endif /* ANTIALIASING */\n\n  if (coverage < coverageLimit) {\n    discard;\n  }\n\n  discardBySlice(vWorldPosition);\n\n  float alpha = vColor.a * coverage;\n\n  gl_FragColor = vec4(vColor.rgb, alpha);\n}\n","edgeRenderer.vert":"#include <util/vsPrecision.glsl>\n\n// Transformations\nuniform mat4 uProj;\nuniform mat4 uView;\nuniform mat4 uModel;\nuniform vec3 uCameraPosition;\n\n// Line configuration\n\n// Conversion constants\nuniform vec2 uPixelToNDC;\nuniform vec2 uNDCToPixel;\nuniform float uPixelRatio;\n\n// Inputs\nattribute vec3 aPosition0;\nattribute vec3 aPosition1;\nattribute float aVariantOffset;\nattribute float aVariantStroke;\nattribute float aVariantExtension;\n\n#ifdef SILHOUETTE\n\nattribute vec3 aNormalA;\nattribute vec3 aNormalB;\n\n#else /* SILHOUETTE */\n\nattribute vec3 aNormal;\n\n#endif /* SILHOUETTE */\n\nattribute vec2 aSideness;\nattribute vec2 aPackedAttributes;\n\nstruct UnpackedAttributes {\nvec2 sideness;\nvec2 sidenessNorm;\nfloat lineWidthPixels;\nfloat extensionLengthPixels;\n\n#if (MODE == MODE_UBER)\n\nfloat type;\n\n#endif\n};\n\n// Output required to compute color\nvarying vec4 vColor;\n\n// Output required to compute distance to line/caps\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vRadius;\nvarying float vLineLengthPixels;\nvarying float vSizeFalloffFactor;\n\n#include <edgeRenderer/adjustProjectedPosition.glsl>\n#include <edgeRenderer/styleOutputs.glsl>\n#include <edgeRenderer/lineAmplitude.glsl>\n#include <edgeRenderer/util.glsl>\n\nvec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  vec2 sideness = unpackedAttributes.sideness;\n  vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n  vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n  vec4 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);\n  vec4 projPosV0 = uProj * viewPosV0;\n  vec4 projPosV1 = uProj * viewPosV1;\n  vec4 projPos = uProj * viewPos;\n\n  vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n  vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;\n  float lineLengthPixels = length(screenSpaceLinePixels);\n\n  float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;\n  vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;\n  vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n  float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n  float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;\n\n  float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n  float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n  vSizeFalloffFactor = falloffFactor;\n\n  float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n  float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n#ifdef ANTIALIASING\n\n  const float aaPaddingPixels = 1.0;\n\n  // Line size with padding\n  float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n  float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;\n\n  // Line length with padding\n  float aaPaddedLineLengthPixels = extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\n  float halfAAPaddedLineLengthPixels = aaPaddedLineLengthPixels * 0.5;\n\n#else /* ANTIALIASING */\n\n  // Even if there is no AA, we still want to do proper <1px rendering,\n  // so we effectively clamp the pixel sizes to minimum of 1px and compute\n  // coverage in the fragment shader\n  float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n  float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;\n\n  float halfAAPaddedLineLengthPixels = max(extendedLineLengthPixels, 1.0) * 0.5;\n\n#endif /* ANTIALIASING */\n\n  // Half line width in NDC including padding for anti aliasing\n  vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n  vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;\n  vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;\n\n  // Compute screen space position of vertex, offsetting for line size and end caps\n  vec2 ndcOffset = (\n      screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n    + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n  );\n\n  projPos.xy += ndcOffset * projPos.w;\n  projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n  projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n  // Line length with end caps\n  float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n  float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n  // Position in pixels with origin at first vertex of line segment\n  vPosition = vec3(\n    halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n    pixelPositionAlongLine,\n    pixelPositionAlongLine / extendedLineLengthPixels\n  );\n\n  // The line width radius in pixels\n  vRadius = lineWidthPixels * 0.5;\n  vLineLengthPixels = extendedLineLengthPixels;\n\n#ifdef SILHOUETTE\n\n  gl_Position = isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10.0, 10.0, 10.0, 1.0);\n\n#else /* SILHOUETTE */\n\n  gl_Position = projPos;\n\n#endif /* SILHOUETTE */\n\n#if (MODE == MODE_UBER)\n\n  if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) {\n    gl_Position = vec4(10.0, 10.0, 10.0, 1.0);\n  }\n\n#elif (MODE == MODE_SKETCH)\n\n  if (lineLengthPixels <= 3.0) {\n    gl_Position = vec4(10.0, 10.0, 10.0, 1.0);\n  }\n\n#endif\n\n  return projPos;\n}\n\n#if (MODE == MODE_UBER)\n\nUnpackedAttributes unpackAttributes(ComponentData component) {\n\n  vec2 sidenessNorm = aSideness;\n  vec2 sideness = sidenessNorm * 2.0 - 1.0;\n\n  float fType = component.type;\n  float extensionLengthPixels = component.extensionLength;\n  float lineWidth = component.lineWidth;\n\n  if (fType <= 0.0) {\n    extensionLengthPixels *= aVariantExtension * 2.0 - 1.0;\n  }\n\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n}\n\n#else /* (MODE == MODE_UBER) */\n\nUnpackedAttributes unpackAttributes(ComponentData component) {\n  vec2 sidenessNorm = aSideness;\n  vec2 sideness = sidenessNorm * 2.0 - 1.0;\n  float extensionLengthPixels = component.extensionLength;\n\n#if (MODE == MODE_SKETCH)\n\n  extensionLengthPixels *= aVariantExtension * 2.0 - 1.0;\n\n#endif\n\n  float lineWidth = component.lineWidth;\n\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n}\n\n#endif /* (MODE == MODE_UBER) */\n\nvoid main() {\n  ComponentData component = readComponentData();\n  UnpackedAttributes unpackedAttributes = unpackAttributes(component);\n\n  vec4 worldPosV0 = uModel * vec4(aPosition0, 1.0);\n  vec4 worldPosV1 = uModel * vec4(aPosition1, 1.0);\n\n  vec4 viewPosV0 = uView * worldPosV0;\n  vec4 viewPosV1 = uView * worldPosV1;\n\n#ifdef SILHOUETTE\n\n  vec3 worldNormal = silhouetteWorldNormal(aNormalA, aNormalB);\n\n#else /* SILHOUETTE */\n\n  vec3 worldNormal = modelToWorldNormal(aNormal);\n\n#endif /* SILHOUETTE */\n\n  // General geometric computation for all types of edges\n  vec4 projPos = calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\n\n  // Component color\n  vColor = component.color;\n\n  // Specific computation for different edge styles\n  calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\n}\n","lineAmplitude.glsl":"// Solid\n\n#if (MODE == MODE_UBER || MODE == MODE_SOLID)\n\n  float calculateLineAmplitudeSolid() {\n    return 0.0;\n  }\n\n#endif\n\n#if (MODE == MODE_SOLID)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSolid();\n  }\n\n#endif\n\n// Sketch\n\n#if (MODE == MODE_UBER || MODE == MODE_SKETCH)\n\n  uniform float uStrokesAmplitude;\n\n  float calculateLineAmplitudeSketch() {\n    return uStrokesAmplitude;\n  }\n\n#endif\n\n#if (MODE == MODE_SKETCH)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSketch();\n  }\n\n#endif\n\n// Uber\n\n#if (MODE == MODE_UBER)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    float type = unpackedAttributes.type;\n\n    if (type <= 0.0) {\n      return calculateLineAmplitudeSketch();\n    }\n    else {\n      return calculateLineAmplitudeSolid();\n    }\n  }\n\n#endif\n","lineOffset.glsl":"#include <util/encoding.glsl>\n\n// Sketch\n\n#if (MODE == MODE_UBER || MODE == MODE_SKETCH)\n\n  uniform sampler2D uStrokesTexture;\n  uniform float uStrokesNormalizationScale;\n\n  varying vec2 vStrokeUV;\n\n  float calculateLineOffsetSketch() {\n    float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n  }\n\n  float calculateLinePressureSketch() {\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n  }\n\n#endif\n\n#if (MODE == MODE_SKETCH)\n\n  float calculateLineOffset() {\n    return calculateLineOffsetSketch();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureSketch();\n  }\n\n#endif\n\n// Solid\n\n#if (MODE == MODE_UBER || MODE == MODE_SOLID)\n\n  float calculateLineOffsetSolid() {\n    return 0.0;\n  }\n\n  float calculateLinePressureSolid() {\n    return 1.0;\n  }\n\n#endif\n\n#if (MODE == MODE_SOLID)\n\n  float calculateLineOffset() {\n    return calculateLineOffsetSolid();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureSolid();\n  }\n\n#endif\n\n// Uber\n\n#if (MODE == MODE_UBER)\n  varying float vType;\n\n  float calculateLineOffset() {\n    if (vType <= 0.0) {\n      return calculateLineOffsetSketch();\n    }\n    else {\n      return calculateLineOffsetSolid();\n    }\n  }\n\n  float calculateLinePressure() {\n    if (vType <= 0.0) {\n      return calculateLinePressureSketch();\n    }\n    else {\n      return calculateLinePressureSolid();\n    }\n  }\n#endif\n","styleOutputs.glsl":"#if (MODE == MODE_UBER || MODE == MODE_SKETCH)\n\n  uniform vec2 uStrokesTextureScale;\n  uniform float uStrokesLog2Resolution;\n  uniform float uStrokeVariants;\n\n  varying vec2 vStrokeUV;\n  varying float vLineIndex;\n\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n    vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n    float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n    vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\n    vStrokeUV.x += aVariantOffset;\n\n    vLineIndex = lineIndex;\n  }\n#endif\n\n#if (MODE == MODE_SOLID)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  }\n#elif (MODE == MODE_SKETCH)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n  }\n#elif (MODE == MODE_UBER)\n  varying float vType;\n\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    vType = unpackedAttributes.type;\n\n    if (unpackedAttributes.type <= 0.0) {\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n    }\n  }\n#endif\n","util.glsl":"uniform float uDistanceFalloffFactor;\n\nfloat distanceBasedPerspectiveFactor(float distance) {\n  return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n}\n\nuniform sampler2D uComponentDataTex;\nuniform vec2 uComponentDataTexInvDim;\n\nattribute float aComponentIndex;\n\n#define COMPONENT_COLOR_FIELD_OFFSET 0.0\n#define COMPONENT_OTHER_FIELDS_OFFSET 1.0\n#define COMPONENT_FIELD_COUNT 2.0\n\n#define LINE_WIDTH_FRACTION_FACTOR 8.0\n#define EXTENSION_LENGTH_OFFSET 128.0\n\n#define COMPONENT_TEX_WIDTH 4096.0\n\nvec2 componentTextureCoords(float componentIndex, float fieldOffset) {\n  float fieldIndex = COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n  float rowIndex = floor(fieldIndex / COMPONENT_TEX_WIDTH);\n  float colIndex = mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n  vec2 linearIndex = vec2(\n    (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n    (rowIndex + 0.5) * uComponentDataTexInvDim.y\n  );\n\n  return linearIndex;\n}\n\nstruct ComponentData {\n  vec4 color;\n  float lineWidth;\n  float extensionLength;\n  float type;\n};\n\nComponentData readComponentData() {\n  vec2 colorIndex = componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n  vec2 otherIndex = componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n  vec4 colorValue = texture2D(uComponentDataTex, colorIndex);\n  vec4 otherValue = texture2D(uComponentDataTex, otherIndex);\n\n  return ComponentData(\n    vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n    otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n    otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n    -(otherValue.z * 255.0) + 0.5 // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;\n  );\n}\n\nvec3 modelToWorldNormal(vec3 normal) {\n  return (uModel * vec4(normal, 0.0)).xyz;\n}\n\nvec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\n  return modelToWorldNormal(normalize(normalA + normalB));\n}\n\n// Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\n// fall-off exponentially\nfloat calculateExtensionLength(float extensionLength, float lineLength) {\n  return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n}\n\n#ifdef SILHOUETTE\n\n// #uniforms: uView, uModel\nbool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\n  // transform the two face normals\n  vec3 viewNormalA = (uView * uModel * vec4(normalA, 0.0)).xyz;\n  vec3 viewNormalB = (uView * uModel * vec4(normalB, 0.0)).xyz;\n\n  // compute the direction from the edge to the camera\n  vec3 viewDir = -viewPos.xyz;\n\n  // check which of the two faces are visible\n  // display the edge if exactly one of the two is visible\n  float faceAVisible = dot(viewDir, viewNormalA); // positive if visible\n  float faceBVisible = dot(viewDir, viewNormalB); // positive if visible\n\n  // 1 if exactly one face visible, 0 otherwise\n  return faceAVisible * faceBVisible < 0.0;\n}\n\n#endif /* SILHOUETTE */\n"},environment:{"realisticAtmosphere.frag":"#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/color.glsl>\n\n// Light\nuniform vec3 v3LightDir;      // The direction vector to the light source\nuniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\n\n// Atmosphere\nconst float fKrESun = 0.075;        // Kr * ESun = 0.005 * 15.0\nconst float fKmESun = 0.015;        // Km * ESun = 0.005 * 15\n\n// Radii\nuniform vec4 v4Radii; // (fInnerRadius, fInnerRadius^2, fOuterRadius, fOuterRadius^2)\n\n// The inner (planetary) radius\n#define fInnerRadius v4Radii[0]\n// fInnerRadius^2\n#define fInnerRadius2 v4Radii[1]\n// The outer (atmosphere) radius\n#define fOuterRadius v4Radii[2]\n// fOuterRadius^2\n#define fOuterRadius2 v4Radii[3]\n\n// Atmosphere parameters:\n// fScale:                    1.0 / (fOuterRadius - fInnerRadius)\n// fScaleDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n// fScaleOverScaleDepth:      fScale / fScaleDepth\n// fOneOverScaleDepth:        1.0 / fScaleDepth\n\n// fScaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n// fScaleOverScaleDepthBlue:  fScale / fScaleDepthBlue\n// fOneOverScaleDepthBlue;    1.0 / fScaleDepthBlue\n\nuniform vec4 v4AtmosParams1; // (fScale, fScaleDepth, fScaleOverScaleDepth, fOneOverScaleDepth)\nuniform vec4 v4AtmosParams2; // (g, fScaleDepthBlue, fScaleOverScaleDepthBlue, fOneOverScaleDepthBlue)\n\n#define fScale v4AtmosParams1.x\n// fScaleDepth, fScaleDepthBlue\n#define v2ScaleDepth vec2(v4AtmosParams1.y,v4AtmosParams2.y)\n// fScaleOverScaleDepth, fScaleOverScaleDepthBlue\n#define v2ScaleOverScaleDepth vec2(v4AtmosParams1.z,v4AtmosParams2.z)\n// fOneOverScaleDepth, fOneOverScaleDepthBlue\n#define v2OneOverScaleDepth vec2(v4AtmosParams1.w,v4AtmosParams2.w)\n\n#ifndef HAZE\nuniform vec4 v4AtmosParams3; // (g2, fMiePhaseCoefficients, fLowerAlphaBlendBound, fOneOverOuterRadiusMinusAlphaBlendBound)\nuniform float fInnerFadeDistance;\nuniform float fAltitudeFade;\n\n#define fg v4AtmosParams2.x\n#define fg2 v4AtmosParams3.x\n#define fMiePhaseCoefficients v4AtmosParams3.y\n#define fLowerAlphaBlendBound v4AtmosParams3.z\n#define fOneOverOuterRadiusMinusAlphaBlendBound v4AtmosParams3.w\n#endif\n\n// Camera\nuniform vec3 v3CameraPos;     // The camera's current position\nuniform vec2 nearFar;\n\nuniform vec4 v4SphereComp;              // (fCameraHeight, fCameraHeight2, fC, fCSur)\n// The camera's current height\n#define fCameraHeight v4SphereComp[0]\n// fCameraHeight^2\n#define fCameraHeight2 v4SphereComp[1]\n// fCameraHeight2 - fOuterRadius2; // C = ||o-c||^2 - r^2\n#define fC v4SphereComp[2]\n// fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C = ||o-c||^2 - r^2\n#define fCSur v4SphereComp[3]\n\n// Camera HDR\n#ifdef HAZE\nconst float fExposure = 1.5;\n#else\nconst float fExposure = 2.0;\n#endif\n\n#ifdef HAZE\n// Depth texture\nuniform sampler2D tDepth;\n#endif\n\n// Testing variables\nuniform float showTest;\n\n// Varyings\nvarying vec3 v3EyeDir;\nvarying vec3 v3WorldRay;\nvarying vec2 vtc;\n\n// Loop constants for integral approximation\nconst float fSamples = 5.0;\nconst int maxSamples = 5;\n\n#ifdef HAZE\n  const float fOneOverGamma = 1.0;//Gamma = 1.0\n#else\n  const float fOneOverGamma = 0.454545; // Gamma = 2.2\n#endif\n\nconst vec3 v3OneOverGamma = vec3(fOneOverGamma);\n\n// ToneMapping operators\nvec3 expTM(vec3 inputColor,float exposure){\n    return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\n}\n\n#ifndef HAZE\nvec3 reinhardTM(vec3 inputColor, float exposure){\n  vec3 intermediate = inputColor *exposure;\n  intermediate /= (1.0+intermediate);\n  return pow(intermediate, v3OneOverGamma);\n}\n#endif\n\n// Approximation for inner integral based on a radii ratio of 10.25:10\nfloat scale(float fCos){\n  float x = 1.0 - fCos;\n  return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main() {\n  vec3 cameraPosition = v3CameraPos;\n\n  // Debug variables\n  vec3 test = vec3(0.0,0.0,0.0);\n\n  // Obtain ray from Camera\n  vec3 worldSpaceRay = normalize(v3WorldRay);\n\n  // Compute Atmosphere intersection; i.e. ray/sphere intersection\n  float B = 2.0 * dot(cameraPosition, worldSpaceRay); // B = 2(l * (o-c))\n  float det = B*B - 4.0 * fC; // det = B^2 - 4.0* C\n\n  // idealized sphere intersection to discard early some pixels\n  float detSur = B*B - 4.0 * fCSur; // det = B^2 - 4.0* C\n\n  // the minimal sample start position:\n  // at the camera by default, on the earth radius surface if the camera is underground.\n  float fMinRayStart = 0.0;\n#ifndef HAZE\n  // When the ray intersects the earth surface, fade the sky to a simple light direction\n  // based color. This is used to make sure we have a white background in underground\n  // mode (at noon).\n  float fSurfaceBlend = 0.0;\n  vec4 surfaceColor = vec4(0.0);\n  if (detSur >= 0.0) {\n    float nearSurfaceT = max(0.0, 0.5 *(-B - sqrt(detSur)));\n    float farSurfaceT = max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n    if (nearSurfaceT == 0.0) {\n      fMinRayStart = farSurfaceT;\n    }\n\n    // Compute lighting at the point where the ray enters the earth surface\n    // Lighting computation is copied from the terrain shader.\n    vec3 vPos = cameraPosition + worldSpaceRay * nearSurfaceT;\n    float fLightAngle = dot(v3LightDir, normalize(vPos));\n    float fBrightness = max(0.0, (smoothstep(-1.0, 0.8, 2.0 * fLightAngle)));\n\n    // Make the surface transparent based on altitude\n    surfaceColor = vec4(fBrightness, fBrightness, fBrightness, 1.0 - fAltitudeFade);\n\n    // Fade based on the distance the ray travels below the earth surface\n    float fRelDist = (farSurfaceT - nearSurfaceT) / fInnerFadeDistance;\n\n    // early exit\n    if (fRelDist > 1.0) {\n      gl_FragColor = surfaceColor;\n      return;\n    }\n\n    fSurfaceBlend = smoothstep(0.0, 1.0, fRelDist * fRelDist);\n  }\n#endif\n\n  // Inside Atmosphere\n  if (det >= 0.0) {\n#ifdef HAZE\n    // only use red channel from depth texture.\n    // see 'Issues' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\n    float depthSample = texture2D(tDepth, vtc).r;\n\n    float zNear = nearFar[0];\n    float zFar = nearFar[1];\n\n    // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n    float zNorm = 2.0 * depthSample - 1.0;\n    float linDepth = 2.0 * zNear * zFar /\n      (zFar + zNear - zNorm * (zFar - zNear));\n\n    float rayEndT;\n    float altitudeAlpha = 1.0;\n\n    // find intersections with ground, but only between the near and far\n    // clipping planes.\n    if (depthSample < 1.0 && depthSample > 0.0) {\n      vec3 cameraSpaceRay = normalize(v3EyeDir);\n      cameraSpaceRay /= cameraSpaceRay.z;\n      cameraSpaceRay *= linDepth;\n\n      float cameraSpaceRayLength = length(cameraSpaceRay);\n\n      vec3 v3World = cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n      float v3WorldRadius2 = dot(v3World, v3World);\n\n      // Handle tall structures:\n      // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n      float transitionStart = fInnerRadius + 20000.0;\n      float transitionHeight = 25000.0;\n      float transitionEnd = transitionStart + transitionHeight;\n\n      float edge0 = transitionStart * transitionStart;\n      float edge1 = transitionEnd * transitionEnd;\n\n      altitudeAlpha = 1.0 - clamp((v3WorldRadius2 - edge0) / (edge1 - edge0), 0.0, 1.0);\n      rayEndT = cameraSpaceRayLength;\n\n      if (altitudeAlpha > 0.0 && detSur > 0.0) {\n        float nearSurfaceT = 0.5 *(-B - sqrt(detSur));\n        float interp = clamp(((fCameraHeight - fInnerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n        rayEndT = mix(cameraSpaceRayLength, nearSurfaceT, interp);\n      }\n    }\n#endif\n\n    float rayStartT = 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n#ifdef HAZE\n    float nearT = abs(rayStartT);\n    float farT = abs(rayEndT);\n#else\n    float rayEndT = 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\n\n#endif\n\n    float fDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStartT < fMinRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStartT = fMinRayStart;\n#ifndef HAZE\n      // clamp to value at inner radius altitude\n      fDistance = fScale * min(0.0, fInnerRadius - fCameraHeight);\n#endif\n    }\n#ifndef HAZE\n    else\n    { // outside atmosphere\n      fDistance = -1.0;\n    }\n#endif\n\n    // Initialize the scattering loop variables\n    vec3 v3Start = cameraPosition + worldSpaceRay * rayStartT;\n\n#ifdef HAZE\n    vec3 v3End = cameraPosition + worldSpaceRay * rayEndT;\n\n    float fEndLength = length(v3End);\n    float fAltitudeEnd = fEndLength - fInnerRadius;\n    float fAltitudeStart = length(v3Start) - fInnerRadius;\n\n    // for camera positions below altitude 0, invert the altitudes, to achieve\n    // a similar haze as above ground. Note that there is a small but visible change\n    // when the camera passes altitude 0.\n    if (fAltitudeStart < 0.0) {\n      fAltitudeStart = -fAltitudeStart;\n      fAltitudeEnd = -fAltitudeEnd;\n    }\n\n    // computed for the original end point to get consistent light angles after possible inversions\n    float fLightAngle = dot(v3LightDir, v3End) / fEndLength;\n\n    if (nearT > farT)\n    {\n      if (fAltitudeStart < fAltitudeEnd)\n      {\n        // Switch positive slopes for flipped rays\n        v3End = cameraPosition + worldSpaceRay * rayStartT;\n        v3Start = cameraPosition + worldSpaceRay * rayEndT;\n        worldSpaceRay *= -1.0;\n        float fTmp = fAltitudeStart;\n        fAltitudeStart = fAltitudeEnd;\n        fAltitudeEnd = fTmp;\n      }\n      else if (fAltitudeStart == fAltitudeEnd)\n      { // create minuscule fake slope for integration if the slope is zero\n        fAltitudeStart += 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n        // slope for the camera function\n      }\n    }\n\n    // Calculate its scattering offset\n    // Assumes camera constrains of WSV 3.8\n    float fCameraDepth;\n    float fCameraDepthBlue;\n    if (fAltitudeStart > fOuterRadius - fInnerRadius)\n    { // outside atmosphere\n      fDistance = fInnerRadius - fOuterRadius;\n    } else\n    {\n      fDistance = fAltitudeEnd - fAltitudeStart;\n    }\n\n#endif\n    vec2 v2OpticalStartDepth = exp(fDistance * v2OneOverScaleDepth);\n\n    float fRayLength = rayEndT - rayStartT;\n    float fSampleLength = fRayLength / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = worldSpaceRay * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n#ifdef HAZE\n    float fCameraAngle = dot(-worldSpaceRay, v3End) / length(v3End);\n    float fScaleCameraAngle = scale(fCameraAngle);\n    vec2 v2CameraOffset = fScaleCameraAngle*v2OpticalStartDepth;\n\n    float scaledValues = scale(fLightAngle) + fScaleCameraAngle;\n    vec2 v2ScaledValuesDepth = scaledValues * v2ScaleDepth;\n#else\n    float fCameraAngle = dot(worldSpaceRay, v3Start / length(v3Start));\n    float angleMultiplier = fCameraAngle>0.0?fCameraAngle:0.0;\n\n    float fScaleCameraAngle = scale(fCameraAngle);\n    vec2 v2CameraOffset = fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\n#endif\n\n    // Loop variables\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    vec3 v3FrontColorBlue = vec3(0.0, 0.0, 0.0);\n    vec3 v3Attenuate= vec3(0.0, 0.0, 0.0);\n    vec3 v3AttenuateBlue = vec3(0.0, 0.0, 0.0);\n\n    // Now loop through the sample rays\n    for(int i=0; i<maxSamples; i++) {\n      float fHeight = length(v3SamplePoint);\n      float fAltitude = abs(fHeight - fInnerRadius);\n\n      vec2 v2Depth = exp(-fAltitude * v2ScaleOverScaleDepth);\n#ifdef HAZE\n      vec2 v2Scatter = v2Depth*v2ScaledValuesDepth-v2CameraOffset;\n#else\n      float fLightAngle = dot(v3LightDir, v3SamplePoint) / fHeight;\n      float fCameraAngle = dot(worldSpaceRay, v3SamplePoint) / fHeight;\n      float fTempScaledValues = scale(fLightAngle) - scale(fCameraAngle);\n      vec2 v2Scatter = v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\n#endif\n      v3Attenuate = exp(-v2Scatter.x * v3InvWavelengthScaled);\n      v3AttenuateBlue = exp(-v2Scatter.y * v3InvWavelengthScaled);\n\n      v3FrontColor += v3Attenuate * v2Depth.x;\n      v3FrontColorBlue += v3AttenuateBlue * v2Depth.y;\n\n      v3SamplePoint += v3SampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos == -1.0 (and close values) to display fake sun\n    float fCos = clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\n    float fOnePlusCos2 = fCos*fCos + 1.0;\n#ifdef HAZE\n    // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n    vec3 colorCoefficients = (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\n\n    // Scaled Length is only applied afterwards to save multiplications\n    vec3 v3Color = colorCoefficients *v3FrontColor;\n    vec3 v3ColorBlue = colorCoefficients *v3FrontColorBlue;\n#else\n    vec3 v3RayleighCoefficients = (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\n    float fMieCoefficients = fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + fg2 - 2.0*fg*fCos, 1.5);\n\n    // Calculate the attenuation factor for the ground\n    vec3 v3Color = v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\n    vec3 v3ColorBlue = v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\n#endif\n\n    // HDR to LDR conversion\n    vec3 ldrBlue = expTM(v3ColorBlue,2.0*fExposure);\n    vec3 ldrRed = expTM(v3Color,fExposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR = mix(ldrBlue,ldrRed,0.2);\n#ifdef HAZE\n    LDR *= (1.0-fCameraAngle);\n    vec3 hsv = rgb2hsv(LDR);\n    hsv.y = clamp(hsv.y*1.5,0.0,1.0); // boost haze saturation by 50%\n    LDR = hsv2rgb(hsv);\n    vec3 finalColor = LDR;\n    // when rendering we specify the blend functions such that\n    // newDestColor = oldDestColor*(1.0-finalColor) + finalColor\n#else\n    // reinhard tonemapper for looking upwards\n    vec3 ldrReinhard = reinhardTM(v3Color,fExposure);\n    LDR += angleMultiplier*ldrReinhard;\n\n    // height dependent parameter to smooth out reddish atmosphere\n    float side = (rayEndT+rayStartT)*0.5;\n    float atmoHeight = sqrt(fCameraHeight2 - side*side);\n    float h2 = clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\n\n    vec3 finalColor = LDR*h2;\n    vec3 hsv = rgb2hsv(finalColor);\n    hsv.y = clamp(hsv.y*1.5,0.0,1.0); // boost sky saturation by 50%\n    finalColor = hsv2rgb(hsv);\n#endif\n\n#ifndef HAZE\n    float atmosStrength = clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\n    gl_FragColor = vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\n    if (fSurfaceBlend > 0.0) {\n      gl_FragColor = mix(gl_FragColor, surfaceColor, fSurfaceBlend);\n    }\n#else\n    gl_FragColor = vec4(finalColor, 1.0) * altitudeAlpha;\n#endif\n\n    // Debug variable overlay\n    if(showTest>0.0){\n      gl_FragColor = vec4(test,1.0);\n    }\n  } else { // Outside Atmosphere\n    gl_FragColor = vec4(0.0);\n  }\n}\n","realisticAtmosphere.vert":"#include <util/vsPrecision.glsl>\n\n// Camera\nuniform vec2 halfSizeNearPlane;\nuniform vec3 v3CameraUp;\nuniform vec3 v3CameraRight;\nuniform vec3 v3CameraDir;\nuniform vec2 v2CameraCenterOffset;\n\n// Attributes\nattribute vec3 position;\nattribute vec2 uv0;\n\n// Varyings\nvarying vec3 v3WorldRay;\nvarying vec2 vtc;\n\n#ifdef HAZE\nvarying vec3 v3EyeDir;\n#endif\n\nvoid main(void) {\n  vec3 v3Pos = position;\n  vtc = uv0;\n  vec2 rayvtc = uv0 - v2CameraCenterOffset;\n\n#ifdef HAZE\n  v3EyeDir = vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\n#else\n  vec3 v3EyeDir = vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\n#endif\n  v3WorldRay = v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\n  gl_Position = vec4(v3Pos, 1.0);\n}\n","simpleAtmosphere.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\n\nvarying vec2 vtc;\nvarying float falloff;\n\n#ifndef PANORAMIC\nuniform float altitudeFade;\nvarying float innerFactor;\n#endif\n\nvoid main() {\n  vec4 texColor = texture2D(tex, vtc);\n\n#ifdef PANORAMIC\n  gl_FragColor = texColor * falloff;\n#else\n  vec4 atmosphereColor = texColor * falloff;\n  vec4 innerColor = vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n  gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n#endif\n}\n","simpleAtmosphere.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\n\n#ifndef PANORAMIC\nconst float TWICEPI = 2.0*3.14159265;\nconst float ATMOSPHERE_RIM_SEGMENTS = 128.0;\n\nuniform vec3 silCircleCenter;\nuniform vec3 silCircleV1;\nuniform vec3 silCircleV2;\nuniform vec2 texV;\n\nuniform float innerScale;  // scale for inner rim\nvarying float innerFactor; // 0: outer atmosphere, 1: inner atmosphere\n#endif\n\nuniform vec3 lightDirection;\n\nattribute vec3 position;\nvarying vec2 vtc;\nvarying float falloff;\n\nvoid main(void) {\n\n#ifdef PANORAMIC\n\n  vec3 pos = position;\n  float ndotl = lightDirection.z;\n  vtc = vec2(0.0, position.z+0.05);\n\n#else\n\n  innerFactor = clamp(-position.z, 0.0, 1.0);\n  float scale = position.y * (1.0 + innerFactor * innerScale);\n  float phi = position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n  vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n  float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightDirection);\n\n  vtc.x = position.x / ATMOSPHERE_RIM_SEGMENTS;\n  vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;\n\n#endif\n\n  falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n  gl_Position = proj * view * vec4(pos, 1.0);\n  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane\n}\n","simpleAtmosphereFade.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n","simpleAtmosphereFade.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\n\nuniform vec3 lightDirection;\nuniform vec3 cameraPosition;\n\nuniform float undergroundFadeAlpha;\n\nvarying vec4 color;\n\nvoid main(void) {\n  float ndotl = dot(normalize(cameraPosition), lightDirection);\n  float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n  color = vec4(vec3(lighting), undergroundFadeAlpha);\n\n  gl_Position = vec4(position.xy, 1.0, 1.0); // on the far plane\n}\n","stars.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec4 vcolor;\nvarying float vsize;\n\nvoid main() {\n  float cap = 0.7;\n  float scale = 1.0/cap;\n  float helper = clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\n  float alpha = clamp((cap-helper)*scale,0.0,1.0);\n  float intensity = alpha*alpha*alpha;\n  if (vsize < 3.0)\n    intensity *= 0.5;\n  gl_FragColor = vec4(1.0,1.0,1.0,intensity);\n  gl_FragColor.xyz *= vcolor.xyz;\n}\n","stars.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform vec4 viewport;\nuniform float pixelRatio;\n\nattribute vec3 position;\nattribute vec4 color;\nattribute float size;\n\nvarying vec4 vcolor;\nvarying float vsize;\n\nvoid main(void) {\n  vec4 posProj = proj * view * model*vec4(position*1.0e25,1.0);//move infinitely far away\n  gl_Position = alignToPixelCenter(posProj, viewport.zw); //pixel align position\n  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane\n  vcolor = color / 1.2;\n  vsize = size * 5.0 * pixelRatio;\n  gl_PointSize = vsize;\n}\n"},materials:{checkerBoard:{"checkerBoard.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n\nuniform vec2 size;\nuniform vec4 color1;\nuniform vec4 color2;\n\nvarying vec2 vUV;\n\nvoid main() {\n  vec2 uvScaled = vUV / (2.0 * size);\n\n  vec2 uv = fract(uvScaled - 0.25);\n  vec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\n  float fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\n  float t = mix(abs(ab.x + ab.y), 0.5, fade);\n\n  gl_FragColor = mix(color2, color1, t);\n}\n","checkerBoard.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec2 vUV;\n\nvoid main(void) {\n  vUV = uv0;\n  gl_Position = proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n}\n"},color:{"color.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nuniform vec4 eColor;\n#ifdef VERTEX_COLORS\nvarying vec4 vColor;\n#endif\n\nvarying vec3 vpos;\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef VERTEX_COLORS\n  gl_FragColor = vColor * eColor;\n#else\n  gl_FragColor = eColor;\n#endif\n\n  gl_FragColor = highlightSlice(gl_FragColor, vpos);\n}\n","color.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\n#ifdef VERTEX_COLORS\nattribute vec4 color;\n\nvarying vec4 vColor;\n#endif\n\nvarying vec3 vpos;\n\nvoid main(void) {\n#ifdef VERTEX_COLORS\n  vColor = color * 0.003921568627451; // = 1/255;\n#endif\n  vpos = (model * vec4(position, 1.0)).xyz;\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n}\n"},defaultMaterial:{"colorMixMode.glsl":"#include <util/color.glsl>\n\n/*\n * The color mix modes are encoded in the symbol color as follows:\n *  - Fully transparent symbols are represented with alpha 0 for\n *    all color mix modes (except ignore).\n *  - color mix mode ignore is encoded as multiply with white\n *  - the other 3 color mix modes (tint, replace, multiply) are\n *    equally distributed on the remaining 255 alpha values, which\n *    gives us 85 possible alpha values\n *\n * alpha             0 : fully transparent\n * alpha in [  1 -  85]: tint\n * alpha in [ 86 - 170]: replace\n * alpha in [171 - 255]: multiply\n * \n */\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha = 0.0;\n\n  const float maxTint = 85.0;\n  const float maxReplace = 170.0;\n  const float scaleAlpha = 3.0;\n\n  if (symbolColor.a > maxReplace) {\n    colorMixMode = 1;  // multiply\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n  } else if (symbolColor.a > maxTint) {\n    colorMixMode = 3; // replace\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n  } else if (symbolColor.a > 0.0) {\n    colorMixMode = 0; // tint\n    symbolAlpha = scaleAlpha * symbolColor.a;\n  } else {\n    colorMixMode = 1; // fully transparent -> multiply\n    symbolAlpha = 0.0;\n  }\n\n  return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n}\n\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  vec3 internalMixed = internalColor * textureColor;\n  vec3 allMixed = internalMixed * externalColor;\n\n  if (mode == 1 /* multiply */) {\n    return allMixed;\n  }\n  else if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalColor;\n  }\n  else {\n    // tint (or something invalid)\n    vec3 hsvIn = rgb2hsv(internalMixed);\n    vec3 hsvTint = rgb2hsv(externalColor);\n    vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\n\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  float internalMixed = internalOpacity * textureOpacity;\n  float allMixed = internalMixed * externalOpacity;\n\n  if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalOpacity;\n  }\n  else {\n    // multiply or tint (or something invalid)\n    return allMixed;\n  }\n}\n","colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/sceneLighting.glsl>\n\n#ifdef TEXTURING\n#include <materials/defaultMaterial/texturingInputs.glsl>\n#endif\n\n#define FRAGMENT_SHADER\n#include <materials/defaultMaterial/vertexTangents.glsl>\n#include <materials/defaultMaterial/textureNormals.glsl>\n\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n\n// material parameters\n//////////////////////////////////////////\nuniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float opacity;\nuniform float layerOpacity;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#else\nuniform int colorMixMode;\n#endif\n\n#ifdef RECEIVE_SHADOWS\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\n#endif\n\n#ifdef RECEIVE_SSAO\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\n#endif\n\nvarying vec3 vpos;\n\n#if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n  varying vec3 vnormal;\n#endif\n\n#if defined(VERTEXCOLORS)\nvarying vec4 vcolor;\n#endif\nvarying vec4 vcolorExt;\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#include <util/shadow.glsl>\n#endif\n\n#ifdef TREE_RENDERING\n  uniform mat4 view;\n#endif\n\n#ifdef TEXTURING\n#include <materials/defaultMaterial/texturing.glsl>\n#endif\n\n#include <materials/defaultMaterial/colorMixMode.glsl>\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  vec4 texColor = textureLookup(tex, vtc);\n\n  #if defined(TEXTURE_ALPHA_PREMULTIPLIED)\n    texColor.rgb /= texColor.a;\n  #endif\n\n  discardOrAdjustTextureAlpha(texColor);\n#else /* TEXTURING */\n  vec4 texColor = vec4(1.0);\n#endif /* TEXTURING */\n\n  vec3 viewDir = vpos - camPos;\n\n  // compute normal\n  // TODO: this is not in sync with the normal pass\n#ifdef GROUND_NORMAL_SHADING\n  #if VIEWING_MODE == VIEWING_MODE_GLOBAL\n    vec3 normal = normalize(vpos + localOrigin);\n  #else\n    vec3 normal = vec3(0.0, 0.0, 1.0);\n  #endif\n#else\n  #if (NORMALS == NORMALS_SCREEN_DERIVATIVE)\n    vec3 normal = normalize(cross(dFdx(vpos),dFdy(vpos)));\n  #else\n    #ifdef DOUBLESIDED\n      vec3 normal = dot(vnormal, viewDir)>0.0 ? -vnormal : vnormal;\n    #elif defined(WINDINGORDERDOUBLESIDED)\n      vec3 normal = gl_FrontFacing ? vnormal : -vnormal;\n    #else\n      vec3 normal = vnormal;\n    #endif\n    normal = normalize(normal);\n  #endif\n#endif\n\n  // compute ssao\n#ifdef RECEIVE_SSAO\n  float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  ssao = viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n#else\n  float ssao = 1.0;\n#endif\n\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\n  float additionalAmbientScale;\n  vec3 additionalLight = sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n\n  // compute shadowing\n  float shadow = 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow = evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#elif VIEWING_MODE == VIEWING_MODE_GLOBAL\n  // at global scale (and in global scenes) we fall back to this approximation\n  // to shadow objects on the dark side of the earth\n  shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);\n#endif\n\n  vec3 matColor = max(ambient, diffuse); // combine the old material parameters into a single one\n#if defined(VERTEXCOLORS)\n  // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\n  vec3 albedo_ = mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ = layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n#else\n  // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\n  vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n#endif\n  albedo_+= 0.25 * specular; // don't completely ignore specular for now\n\n\n  #if defined(TEXTURE_NORMALS)\n    mat3 tangentSpace = computeTangentSpace(normal);\n    vec3 shadingNormal = computeTextureNormal(tangentSpace);\n  #else\n    vec3 shadingNormal = normal;\n  #endif\n\n  #ifdef TREE_RENDERING\n    // make sure we use unflipped normal\n    shadingNormal = normalize(vnormal);\n\n    // make tree 20% brighter\n    albedo_ *= 1.2;\n\n    // view forward vector in global coordinates\n    vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\n\n    // factor indicating how aligned the lighting direction and view axis are\n    float alignmentLightView = clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n\n    // we approximate the tree crown transmittance based on view direction and tree crown normal\n    float transmittance = 1.0 - clamp(dot(-viewForward, shadingNormal), 0.0, 1.0);\n\n    float treeRadialFalloff = vcolor.r;\n    float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n    additionalLight += backLightFactor * lightingMainIntensity;\n  #endif\n\n  vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo_, shadow, 1.0 - ssao, additionalLight);\n  gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n}\n","colorPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\n#define VERTEX_SHADER\n#include <materials/defaultMaterial/vertexTangents.glsl>\n\n#ifdef INSTANCEDCOLOR\nattribute vec4 instanceColor;\n#endif\nattribute vec3 position;\n\n#if (NORMALS == NORMALS_COMPRESSED)\n  attribute vec2 normalCompressed;\n  varying vec3 vnormal;\n#elif (NORMALS == NORMALS_DEFAULT)\n  attribute vec3 normal;\n  varying vec3 vnormal;\n#endif\n\nvarying vec3 vpos;\n\n#ifdef TEXTURING\n    attribute vec2 uv0;\n    varying vec2 vtc;\n  #ifdef TEXTURE_ATLAS\n    attribute vec4 region;\n    varying vec4 regionV;\n  #endif\n#endif\n\n#ifdef COMPONENTCOLORS\n#include <materials/defaultMaterial/componentColors.glsl>\n#endif\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n\n#ifdef VERTEXCOLORS\nattribute vec4 color;\n#endif\n\n#ifdef SYMBOLVERTEXCOLORS\nattribute vec4 symbolColor;\n#endif\n\n#if defined(VERTEXCOLORS)\nvarying vec4 vcolor;\n#endif\n\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\n// This should be further cleaned up later with through the following issue:\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\nuniform vec4 externalColor;\nvarying vec4 vcolorExt;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#endif\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_SIZE) || defined(VV_COLOR)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/colorMixMode.glsl>\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/constants.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n#include <materials/defaultMaterial/localNormal.glsl>\n\nvoid main() {\n\n#ifdef VERTEXCOLORS\n  vcolor = color * 0.003921568627451; // = 1/255\n#endif\n\n  vcolorExt = externalColor;\n\n#ifdef INSTANCEDCOLOR\n  vcolorExt *= instanceColor;\n#endif\n\n#ifdef VV_COLOR\n  vcolorExt *= vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n#endif\n\n#ifdef SYMBOLVERTEXCOLORS\n  int symbolColorMixMode;\n  vcolorExt *= decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n  colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n\n#ifdef COMPONENTCOLORS\n  int symbolColorMixMode;\n  vcolorExt *= decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n  colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n\n  if (vcolorExt.a < SYMBOL_ALPHA_CUTOFF) {\n    // Discard this vertex\n    gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n  }\n  else {\n    vpos = calculateVPos();\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  #if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n    vnormal = normalize(modelNormal * localNormal().xyz);\n  #endif\n\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  #ifdef IOS_SAFARI_FIX\n    originDelta = originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\n  #endif\n  vpos -= originDelta;\n\n  #ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz + originDelta;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n  #endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n  #if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n    vnormal = normalize((modelNormal * localNormal()).xyz);\n  #endif\n\n  #ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n  #endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n    #if defined(VERTEX_TANGENTS)\n      transformVertexTangent(mat3(modelNormal));\n    #endif\n\n    gl_Position = proj * view * vec4(vpos, 1.0);\n  }\n\n#ifdef RECEIVE_SHADOWS\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\n  // issues on iPad/iPhone with the 'w' component require the depth to be\n  // passed as varying to properly drive the cascading shadow map index.\n  linearDepth = gl_Position.w;\n#endif\n\n\n#ifdef TEXTURING\n  #ifndef FLIPV\n    vtc = uv0;\n  #else\n    vtc = vec2(uv0.x, 1.0-uv0.y);\n  #endif\n  #ifdef TEXTURE_ATLAS\n    regionV = region;\n  #endif\n#endif /* TEXTURING */\n\n}\n","commonFunctions.glsl":"#include <materials/defaultMaterial/localPosition.glsl>\n#include <util/doublePrecision.glsl>\n\nvec3 calculateVPos() {\n#ifdef INSTANCED_DOUBLE_PRECISION\n  return model * localPosition().xyz;\n#else\n  return (model * localPosition()).xyz;\n#endif\n}\n\n#ifdef VERTICAL_OFFSET\n#ifdef SCREEN_SIZE_PERSPECTIVE\n#include <util/screenSizePerspective.glsl>\n#endif\n\nvec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n  float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n  float verticalOffsetOffsetDistance = verticalOffset.x * viewDistance;\n\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n  vec3 worldNormal = normalize(worldPos + localOrigin);\n#else\n  vec3 worldNormal = vec3(0.0, 0.0, 1.0);\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n\n  float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\n#else\n  float verticalOffsetScreenHeight = verticalOffset.x;\n#endif\n\n  // Screen sized offset in world space, used for example for line callouts\n  float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n\n  return worldNormal * worldOffset;\n}\n#endif\n","commonInputs.glsl":"uniform mat4 proj;\nuniform mat4 view;\n#ifdef INSTANCED_DOUBLE_PRECISION\nuniform vec3 viewOriginHi;\nuniform vec3 viewOriginLo;\n#endif\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n\n#ifdef INSTANCED\n#ifdef INSTANCED_DOUBLE_PRECISION\nattribute vec3 modelOriginHi;\nattribute vec3 modelOriginLo;\nattribute mat3 model;\nattribute mat3 modelNormal;\n#else /* INSTANCED_DOUBLE_PRECISION */\nattribute mat4 model;\nattribute mat4 modelNormal;\n#endif /* INSTANCED_DOUBLE_PRECISION */\n#else /* INSTANCED */\nuniform mat4 model;\nuniform mat4 modelNormal;\n#endif /* INSTANCED */\n\n#ifdef VERTICAL_OFFSET\n// [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\nuniform vec4 verticalOffset;\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspectiveAlignment;\n#endif\n#endif\n","componentColors.glsl":"\nuniform sampler2D uComponentColorTex;\nuniform vec2 uComponentColorTexInvDim;\n\nattribute float componentIndex;\n\nvec4 readComponentColor() {\n  float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n  vec2 indexCoord = vec2(\n    mod(normalizedIndex, 1.0),\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n  );\n  vec4 componentColor = texture2D(uComponentColorTex, indexCoord);\n  // NB: we clear the least significant bit of the blue channel as this contains\n  // the castShadows flag\n  return vec4( componentColor.r, componentColor.g, componentColor.b - mod(componentColor.b*255.0, 2.0)/255.0, componentColor.a);\n}\n\n// returns 1.0 if shadowCasting is enabled and 0.0 otherwise\n// this is found by reading the least significant bit of the\n// componentColors blue color channel which contains the castShadows flag\nbool readComponentCastShadowsFlag(){\n  float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n  vec2 indexCoord = vec2(\n    mod(normalizedIndex, 1.0),\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n  );\n  if( mod(texture2D(uComponentColorTex, indexCoord).b*255.0, 2.0) < 1.0 )\n      return false;\n  return true;\n}\n","constants.glsl":"#define SYMBOL_ALPHA_CUTOFF 0.001\n","depthPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/depth.glsl>\n#include <util/slice.glsl>\n\nvarying float depth;\nvarying vec3 vpos;\n\n#if defined(TEXTURING)\n  #include <materials/defaultMaterial/texturingInputs.glsl>\n  #include <materials/defaultMaterial/texturing.glsl>\n#endif\n\n\nvoid main() {\n  discardBySlice(vpos);\n\n  #if defined(TEXTURING)\n    vec4 texColor = textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n\n  #ifndef BIAS_SHADOWMAP\n    gl_FragColor = float2rgba(depth);\n  #else\n    gl_FragColor = float2rgba(calcFragDepth(depth));\n  #endif\n}\n","depthPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\nuniform vec2 nearFar;\nattribute vec3 position;\n\nvarying float depth;\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n\n#if defined(COMPONENTCOLORS)\n#include <materials/defaultMaterial/componentColors.glsl>\n#endif\n\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n\n\n#if defined(COMPONENTCOLORS)\n  if( !readComponentCastShadowsFlag() ){\n    // discard vertex so that it doesnt show up in depth buffer\n    gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n  }else\n  {\n#endif\n\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n#ifdef IOS_SAFARI_FIX\n  originDelta = originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\n#endif\n  vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = model * localCenter().xyz + originDelta;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = (model * localCenter()).xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n  vec4 eye = view * vec4(vpos, 1.0);\n\n  gl_Position = proj * eye;\n  depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n\n#if defined(COMPONENTCOLORS)\n  } // if readComponentCastShadowsFlag==true\n#endif\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","highlightPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/highlight.glsl>\n\nvarying vec3 vpos;\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\n#if defined(TEXTURING)\n  #include <materials/defaultMaterial/texturingInputs.glsl>\n  #include <materials/defaultMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n  #if defined(TEXTURING)\n    vec4 texColor = textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}\n","highlightPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\nattribute vec3 position;\n\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n#ifdef IOS_SAFARI_FIX\n  originDelta = originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\n#endif\n  vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = model * localCenter().xyz + originDelta;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = (model * localCenter()).xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","localCenter.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vvTransformPosition(vec3(0.0), instanceFeatureAttribute); }\n# endif\n#else\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vec4(vec3(0.0), 1.0); }\n# endif\n#endif\n","localNormal.glsl":"#include <util/normalEncoding.glsl>\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  # if (NORMALS == NORMALS_COMPRESSED)\n    vec4 localNormal() { return vvTransformNormal(decodeNormal(normalCompressed), instanceFeatureAttribute); }\n  # elif (NORMALS == NORMALS_DEFAULT)\n    vec4 localNormal() { return vvTransformNormal(normal, instanceFeatureAttribute); }\n  # endif\n#else\n  # if (NORMALS == NORMALS_COMPRESSED)\n    vec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\n  # elif (NORMALS == NORMALS_DEFAULT)\n    vec4 localNormal() { return vec4(normal, 1.0); }\n  # endif\n#endif\n","localPosition.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\nvec4 localPosition() { return vvTransformPosition(position, instanceFeatureAttribute); }\n#else\nvec4 localPosition() { return vec4(position, 1.0); }\n#endif\n","normalPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\n#if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n  varying vec3 vnormal;\n#endif\n\nvarying vec3 vpos;\n\n#if defined(TEXTURING)\n  #include <materials/defaultMaterial/texturingInputs.glsl>\n  #include <materials/defaultMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n  #if defined(TEXTURING)\n    vec4 texColor = textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n\n#if (NORMALS == NORMALS_SCREEN_DERIVATIVE)\n  vec3 normal = normalize(cross(dFdx(vpos),dFdy(vpos)));\n#else\n  vec3 normal = normalize(vnormal);\n  if (gl_FrontFacing == false) normal = -normal;\n#endif\n\n  #ifndef ALPHA_ZERO\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n  #else\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n  #endif\n}\n","normalPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\nuniform mat4 viewNormal;\nattribute vec3 position;\n\n#if (NORMALS == NORMALS_COMPRESSED)\n  attribute vec2 normalCompressed;\n  varying vec3 vnormal;\n#elif (NORMALS == NORMALS_DEFAULT)\n  attribute vec3 normal;\n  varying vec3 vnormal;\n#endif\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n\nvarying vec3 vpos;\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n#include <materials/defaultMaterial/localNormal.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  #if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n    vnormal = normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\n  #endif\n\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n\n  #ifdef IOS_SAFARI_FIX\n    originDelta = originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\n  #endif\n  vpos -= originDelta;\n\n  #ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz + originDelta;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n  #endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n  #if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n    vnormal = normalize((viewNormal * modelNormal * localNormal()).xyz);\n  #endif\n\n  #ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n  #endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","textureNormals.glsl":"#if defined(TEXTURE_NORMALS)\n  uniform sampler2D texNormal;\n\n  vec3 computeTextureNormal(mat3 tangentSpace) {\n    vec3 rawNormal = texture2D(texNormal, vtc).rgb * 2.0 - 1.0;\n    return tangentSpace * rawNormal;\n  }\n#endif","texturing.glsl":'float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n  // from:\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\n  //   - http://www.linedef.com/virtual-texture-demo.html\n  float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\n}\n\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\n  //[umin, vmin, umax, vmax]\n  vec2 atlasScale = region.zw - region.xy;\n  vec2 uvAtlas = fract(uv) * atlasScale + region.xy;\n\n  vec4 texColor;\n\n  // calculate derivative of continuous texture coordinate\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\n  vec2 dUVdx = dFdx(uv) * atlasScale;\n  vec2 dUVdy = dFdy(uv) * atlasScale;\n\n#ifdef GL_EXT_shader_texture_lod\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\n#else\n  // use bias to compensate for difference in automatic vs desired mipmap level\n  vec2 dUVdxAuto = dFdx(uvAtlas);\n  vec2 dUVdyAuto = dFdy(uvAtlas);\n  float mipMapLevel = calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\n  float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\n\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}\n\nvec4 textureLookup(sampler2D tex, vec2 uv) {\n#ifdef TEXTURE_ATLAS\n  return textureAtlasLookup(tex, uv, regionV, texSize);\n#else\n  return texture2D(tex, uv);\n#endif\n}\n\n/**\n * Based on the texture alpha mode:\n * - discards fragments if necessary\n * - adjusts read texture alpha if necessary\n */\nvoid discardOrAdjustTextureAlpha(inout vec4 texColor) {\n  // if the texture alpha mode is set to "mask"\n  // the resulting alpha is either 0.0 (discard) or 1.0\n  #if defined(TEXTURE_ALPHA_MODE_MASK)\n    if (texColor.a < textureAlphaCutoff) {\n      discard;\n    } else {\n      texColor.a = 1.0;\n    }\n  // if the texture alpha mode is set to "maskBlend"\n  // the resulting alpha is either 0.0 (discard) or untouched for further use in blending\n  #elif defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\n    if (texColor.a < textureAlphaCutoff) {\n      discard;\n    }\n  // if the texture alpha mode is set to "opaque"\n  // the resulting alpha is always 1.0\n  #elif defined(TEXTURE_ALPHA_MODE_OPAQUE)\n    texColor.a = 1.0;\n  // for "blend" we don\'t need to do anyting\n  #else // defined(TEXTURE_ALPHA_MODE_BLEND)\n\n  #endif\n}\n\n\n\n',"texturingInputs.glsl":"#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\n\n#if defined(TEXTURE_ALPHA_MODE_MASK) || defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\nuniform float textureAlphaCutoff;\n#endif\n\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n\n#endif\n\n#if defined(TEXTURING) || defined(TEXTURE_COORDINATES)\nvarying vec2 vtc;\n#endif\n","vertexTangents.glsl":"#if defined(VERTEX_SHADER)\n\n  #if defined(VERTEX_TANGENTS)\n    attribute vec4 aTangent;\n    varying vec4 vTangent;\n\n    void transformVertexTangent(mat3 modelTransformForNormals) {\n      vTangent.xyz = modelTransformForNormals * aTangent.xyz;\n      vTangent.w = aTangent.w;\n    }\n  #endif // VERTEX_TANGENTS\n\n#elif defined(FRAGMENT_SHADER)\n\n  #if defined(VERTEX_TANGENTS)\n    varying vec4 vTangent;\n\n    #if defined(WINDINGORDERDOUBLESIDED)\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    #else // WINDINGORDERDOUBLESIDED\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = vTangent.w;\n        vec3 tangent = normalize(vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    #endif // WINDINGORDERDOUBLESIDED\n  #endif // VERTEX_TANGENTS\n\n#endif // VERTEX_SHADER\n"},hud:{"colorPass.frag":"#include <materials/hud/hudHeader.glsl>\n\nvoid main() {\n#include <materials/hud/hudMain.glsl>\n}\n","highlightPass.frag":"#include <materials/hud/hudHeader.glsl>\n#include <util/highlight.glsl>\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\nvoid main() {\n#include <materials/hud/hudMain.glsl>\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  // Instead of deciding on a per-pixel basis if the highlight is occluded,\n  // do it for all highlight pixel based on the centroid occlusion. This\n  // is a temporary solution for:\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\n  if (voccluded == 1.0) {\n    gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n  } else {\n    gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n  }\n#else\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n#endif\n}\n","hud.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n#include <util/hud.glsl>\n#include <util/visualVariables.glsl>\n#include <util/slice.glsl>\n\nuniform vec2 screenOffset;\nuniform vec2 anchorPos;\n\n// textureCoordinateScaleFactor can be used when there is a uniform texture scaling per material.\n// This is used in the case where we enforce a POT texture (for mipmaps) and the effective\n// texture is only in a subregion of the full POT texture.\nuniform vec2 textureCoordinateScaleFactor;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspective;\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\nvarying vec3 debugBorderCoords;\n#endif\n\nattribute vec2 uv0;\nattribute vec4 color;\nattribute vec2 size;\nattribute vec4 auxpos2;\n\nvarying vec4 vcolor;\n\nvarying vec2 vtc;\nvarying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvarying float voccluded;\n#endif\n\nvoid main(void) {\n  ProjectHUDAux projectAux;\n  vec4 posProj = projectPositionHUD(projectAux);\n\n  if (rejectBySlice(projectAux.posModel)) {\n    // Project outside of clip plane\n    gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    return;\n  }\n\n  vec2 inputSize;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n\n  vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n\n#else\n\n  inputSize = size;\n\n  vec2 screenOffsetScaled = screenOffset;\n#endif\n\n#ifdef VV_SIZE\n  // only use width (.xx) for proportional scaling\n  // (if no width was defined in vv, width\n  //  will be a copy of height vv)\n  inputSize *= vvGetScale(auxpos2).xx;\n#endif\n\n  vec2 combinedSize = inputSize * pixelRatio;\n  vec4 quadOffset = vec4(0.0);\n\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\n  bool visible = testVisibilityHUD(posProj);\n#endif\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvoccluded = visible ? 0.0 : 1.0;\n#endif\n\n#ifdef OCCL_TEST\n  if (visible) {\n#endif\n    // UV goes from 0 to 1.99999, where the integer part is used\n    // for the normalized vertex coordinates, and the fractional\n    // part is used for texture sampling\n    vec2 uv01 = floor(uv0);\n    vec2 uv = uv0 - uv01;\n\n    // Displace icon based on anchor position (normalized for size) and\n    // absolute screen offset. anchorPos is [-0.5, 0.5]\n    quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n\n#ifdef SIGNED_DISTANCE_FIELD\n\n    // SDF primitives might be scaled so that the SDF texture resolution does\n    // not match the resolution of the canvas, but we still want to render\n    // outline-only ('cross' and 'x') primitives cleanly. Aligning to a screen\n    // pixel border at the geometry center achieves this, since SDF textures\n    // always have power of 2 dimensions.\n    posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\n#else\n    posProj += quadOffset;\n\n    // Aligning vertex positions to the nearest (using 'floor') screen pixel\n    // border renders textures with pixel-perfect results. If the texture\n    // resolution does not match the canvas resolution then aligning is\n    // redundant.\n    if (inputSize.x == size.x) {\n      posProj = alignToPixelOrigin(posProj, viewport.zw);\n    }\n#endif\n\n    gl_Position = posProj;\n\n    vtc = uv * textureCoordinateScaleFactor;\n\n#ifdef DEBUG_DRAW_BORDER\n    debugBorderCoords = vec3(uv01, 1.0 / combinedSize);\n#endif\n\n    vsize = inputSize;\n#ifdef OCCL_TEST\n  } else {\n    vtc = vec2(.0);\n\n#ifdef DEBUG_DRAW_BORDER\n    debugBorderCoords = vec3(0.0);\n#endif\n\n  }\n#endif\n\n  gl_Position = posProj;\n\n#ifdef VV_COLOR\n  vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors);\n#else\n  vcolor = color / 255.0;\n#endif\n}\n","hudHeader.glsl":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/color.glsl>\n\nuniform sampler2D tex;\nuniform vec4 overrideColor;\nuniform vec4 outlineColor;\nuniform float outlineSize;\n\nvarying vec4 vcolor;\n\nvarying vec2 vtc;\nvarying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvarying float voccluded;\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\nvarying vec3 debugBorderCoords;\n#endif\n","hudMain.glsl":"#ifdef SIGNED_DISTANCE_FIELD\n  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\n  vec4 fillPixelColor = overrideColor * vcolor;\n\n  // Attempt to sample texel centers to avoid that thin cross outlines\n  // disappear with large symbol sizes.\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n  const float txSize = 128.0;\n  const float texelSize = 1.0 / txSize;\n  // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n  vec2 scaleFactor = (vsize - txSize) * texelSize;\n  vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n  // Get distance and map it into [-0.5, 0.5]\n  float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n  // Distance in output units (i.e. pixels)\n  float dist = d * vsize.x;\n\n  // Create smooth transition from the icon into its outline\n  fillPixelColor.a *= clamp(0.5 - dist, 0.0, 1.0);\n\n  if (outlineSize > 0.25) {\n    vec4 outlinePixelColor = outlineColor;\n    float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n    // Create smooth transition around outline\n    outlinePixelColor.a *= clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n\n    // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n    float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n    vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n      vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n    gl_FragColor = vec4(compositeColor, compositeAlpha);\n  }\n  else {\n    gl_FragColor = premultiplyAlpha(fillPixelColor);\n  }\n\n  // visualize SDF:\n  // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n#else\n\n  // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\n  // fragment color. Input textures should already be pre-multiplied and so\n  // don't require adjustment, but the override and vertex colors must be\n  // modulated by their alpha values.\n\n  gl_FragColor = texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);\n\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n   float isBorder = float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\n   gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);\n#endif\n\n  if (gl_FragColor.a < 0.1) {\n    discard;\n  }\n","occlusionTest.frag":"#include <util/fsPrecision.glsl>\n\nuniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n","occlusionTest.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n#include <util/hud.glsl>\n#include <util/slice.glsl>\n\nvoid main(void) {\n  vec4 posProjCenter;\n\n  // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\n  // are removed before the VBO is recompacted. If this is the case, then we just project outside\n  // of clip space.\n  if (dot(position, position) > 0.0) {\n    // Render single point to center of the pixel to avoid subpixel filtering to affect\n    // the marker color\n    ProjectHUDAux projectAux;\n    vec4 posProj = projectPositionHUD(projectAux);\n    posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n    vec3 vpos = projectAux.posModel;\n    if (rejectBySlice(vpos)) {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n  }\n  else {\n    // Project out of clip space\n    posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n  }\n\n  gl_Position = posProjCenter;\n  gl_PointSize = 1.0;\n}\n"},lineCallout:{"lineCallout.frag":"#include <util/fsPrecision.glsl>\n\nuniform vec4 color;\nuniform vec4 borderColor;\n\nvarying vec4 coverageSampling;\nvarying vec2 lineSizes;\n\nvoid main() {\n  // Mix between line and border coverage offsets depending on whether we need\n  // a border (based on the sidedness).\n  vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n  // Mix between border and line color based on the line coverage (conceptually the line\n  // blends on top of the border background).\n  //\n  // Anti-alias by blending final result using the full (including optional border) coverage\n  // and the color alpha\n  float borderAlpha = color.a * borderColor.a * coverage.y;\n  float colorAlpha = color.a * coverage.x;\n\n  float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);\n\n#ifdef DEPTH_HUD\n\n  if (finalAlpha < 0.01) {\n    discard;\n  }\n\n#else\n\n  // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n  // need to divide by finalAlpha). We avoid the division here by setting the\n  // appropriate blending function in the material.\n  vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n\n  gl_FragColor = vec4(finalRgb, finalAlpha);\n\n#endif\n\n}\n","lineCallout.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n#include <util/hud.glsl>\n#include <util/slice.glsl>\n\nattribute vec2 uv0;\n\nuniform float lineSize;\nuniform vec2 pixelToNDC;\nuniform float borderSize;\nuniform vec2 screenOffset;\n\nvarying vec4 coverageSampling;\nvarying vec2 lineSizes;\n\nvoid main(void) {\n\n  ProjectHUDAux projectAux;\n  vec4 endPoint = projectPositionHUD(projectAux);\n\n  vec3 vpos = projectAux.posModel;\n  if (rejectBySlice(vpos)) {\n    gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n    return;\n  }\n\n#ifdef OCCL_TEST\n  if (!testVisibilityHUD(endPoint)) {\n    gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n    return;\n  }\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n  vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n#else\n  vec2 screenOffsetScaled = screenOffset;\n#endif\n\n  // Add view dependent polygon offset to get exact same original starting point. This is mostly\n  // used to get the correct depth value\n  vec3 posView = (view * (model * vec4(position, 1.0))).xyz;\n  applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n\n  vec4 startPoint = proj * vec4(posView, 1.0);\n\n  // Apply screen offset to both start and end point\n  vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;\n\n  startPoint.xy += screenOffsetNorm * startPoint.w;\n  endPoint.xy += screenOffsetNorm * endPoint.w;\n\n  // Align start and end to pixel origin\n  vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);\n  vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);\n\n#ifdef DEPTH_HUD\n\n#ifdef DEPTH_HUD_ALIGN_START\n  endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\n#else\n  startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\n#endif\n\n#endif\n\n  vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);\n\n  // The direction of the line in screen space\n  vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n  vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n  float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n\n#else\n\n  float lineSizeScaled = lineSize;\n  float borderSizeScaled = borderSize;\n\n#endif\n\n  float halfPixelSize = lineSizeScaled * 0.5;\n  // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n  // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n  // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n  // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n  float halfWholePixelSize = floor(lineSizeScaled) * 0.5;\n  float halfPixelSizeInt = floor(halfWholePixelSize);\n\n  // Sub-pixel offset if we need to grow sub-pixels to the left\n  float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);\n\n  // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n  float pixelOffset = -halfPixelSizeInt + subpixelOffset;\n\n  // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n  float padding = 1.0 + borderSizeScaled;\n  vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n  // Offset x/y from the center of the line in screen space\n  projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n  // Compute a coverage varying which we can use in the fragment shader to determine\n  // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n  // This works by computing two coordinates that can be linearly interpolated and then\n  // subtracted to find out how far away from the line edge we are.\n  float edgeDirection = (uv0.x * 2.0 - 1.0);\n\n  float halfBorderSize = 0.5 * borderSizeScaled;\n  float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;\n  float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n  float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);\n\n  coverageSampling = vec4(\n    // Edge coordinate\n    outerEdgeCoverageSampler,\n\n    // Border edge coordinate\n    outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n    // Line offset\n    halfPixelSize - 0.5,\n\n    // Border offset\n    halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n  );\n\n  lineSizes = vec2(lineSizeScaled, borderSizeScaled);\n\n  gl_Position = projectedPosition;\n}\n"},measurementArrow:{"measurementArrow.frag":"#include <util/fsPrecision.glsl>\n\nuniform float outlineSize;\nuniform vec4 outlineColor;\nuniform float stripeLength;\nuniform vec4 stripeEvenColor;\nuniform vec4 stripeOddColor;\n\nvarying vec2 vtc;\nvarying float vlength;\nvarying float vradius;\n\n#define INV_SQRT2 (1.0 / sqrt(2.0))\n\nvec4 arrowColor(vec2 tc, float len) {\n  float d = INV_SQRT2 * (tc.x - abs(tc.y));\n  d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n  d = min(d, 1.0 - abs(tc.y));\n\n  if (d < 0.0) {\n    return vec4(0.0);\n  } else if (d < outlineSize) {\n    return outlineColor;\n  } else {\n    return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n  }\n}\n\nvoid main(void) {\n  vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n  vec4 color = arrowColor(ntc, vlength / vradius);\n  if (color.a == 0.0) {\n    discard;\n  }\n  gl_FragColor = color;\n}\n","measurementArrow.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nuniform float width;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv0;\nattribute float auxpos1;\n\nvarying vec2 vtc;\nvarying float vlength;\nvarying float vradius;\n\nvoid main(void) {\n  vec3 bitangent = normal;\n\n  vtc = uv0;\n  vlength = auxpos1;\n  vradius = 0.5 * width;\n\n  vec4 pos = view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\n  gl_Position = proj * pos;\n}\n"},nativeLine:{"colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nuniform vec4 constantColor;\n\nvarying vec3 vpos;\n\n#ifdef VERTEXCOLORS\nvarying vec4 vcolor;\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n#ifdef VERTEXCOLORS\n  gl_FragColor = highlightSlice(vcolor, vpos);\n#else\n  gl_FragColor = highlightSlice(constantColor, vpos);\n#endif\n}\n","highlightPass.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/highlight.glsl>\n\nvarying vec3 vpos;\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\nvoid main() {\n  discardBySlice(vpos);\n\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}\n","nativeLine.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\n\n#ifdef VERTEXCOLORS\nattribute vec4 color;\n#endif\n\n\nvarying vec3 vpos;\n\n#ifdef VERTEXCOLORS\nvarying vec4 vcolor;\n#endif\n\n\nvoid main(void) {\n  vpos = (model * vec4(position, 1.0)).xyz;\n  #ifdef VERTEXCOLORS\n    vcolor = color * 0.003921568627451; // = 1/255\n  #endif\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n}\n"},pathMaterial:{"colorMixMode.glsl":"#include <util/color.glsl>\n\n/*\n * The color mix modes are encoded in the symbol color as follows:\n *  - Fully transparent symbols are represented with alpha 0 for\n *    all color mix modes (except ignore).\n *  - color mix mode ignore is encoded as multiply with white\n *  - the other 3 color mix modes (tint, replace, multiply) are\n *    equally distributed on the remaining 255 alpha values, which\n *    gives us 85 possible alpha values\n *\n * alpha             0 : fully transparent\n * alpha in [  1 -  85]: tint\n * alpha in [ 86 - 170]: replace\n * alpha in [171 - 255]: multiply\n */\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha = 0.0;\n\n  const float maxTint = 85.0;\n  const float maxReplace = 170.0;\n  const float scaleAlpha = 3.0;\n\n  if (symbolColor.a == 0.0) {\n    colorMixMode = 1; // fully transparent -> multiply\n    symbolAlpha = 0.0;\n  }\n  else if (symbolColor.a <= maxTint) {\n    colorMixMode = 0; // tint\n    symbolAlpha = scaleAlpha * symbolColor.a;\n  }\n  else if (symbolColor.a <= maxReplace) {\n    colorMixMode = 3; // replace\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n  }\n  else {\n    colorMixMode = 1;  // multiply\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n  }\n\n  return vec4(symbolColor.rgb, symbolAlpha);\n}\n\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  vec3 internalMixed = internalColor * textureColor;\n  vec3 allMixed = internalMixed * externalColor;\n\n  if (mode == 1 /* multiply */) {\n    return allMixed;\n  }\n  else if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalColor;\n  }\n  else {\n    // tint (or something invalid)\n    vec3 hsvIn = rgb2hsv(internalMixed);\n    vec3 hsvTint = rgb2hsv(externalColor);\n    vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\n\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  float internalMixed = internalOpacity * textureOpacity;\n  float allMixed = internalMixed * externalOpacity;\n\n  if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalOpacity;\n  }\n  else {\n    // multiply or tint (or something invalid)\n    return allMixed;\n  }\n}\n","colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/sceneLighting.glsl>\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n\n// material parameters\n//////////////////////////////////////////\nuniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float opacity;\nuniform float layerOpacity;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#else\nuniform int colorMixMode;\n#endif\n\n#ifdef RECEIVE_SHADOWS\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\n#endif\n\n#ifdef RECEIVE_SSAO\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\n#endif\n\nvarying vec3 vpos;\nvarying vec3 vnormal;\n// the vertex color variable will contain vvColor and/or vvOpacity or 1,1,1,1\nvarying vec4 vcolor; \nvarying vec4 vcolorExt;\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#include <util/shadow.glsl>\n#endif\n\n#ifdef TEXTURING\n#include <materials/pathMaterial/texturing.glsl>\n#endif\n\n#include <materials/pathMaterial/colorMixMode.glsl>\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  vec4 texColor = textureLookup(tex, vtc);\n  if (texColor.a < ALPHA_THRESHOLD) {\n    discard;\n  }\n#else /* TEXTURING */\n  vec4 texColor = vec4(1.0);\n#endif /* TEXTURING */\n\n  vec3 viewDir = vpos - camPos;\n\n  // compute normal\n  // TODO: this is not in sync with the normal pass\n#ifdef GROUND_NORMAL_SHADING\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n  vec3 normal = normalize(vpos + localOrigin);\n#else\n  vec3 normal = vec3(0.0, 0.0, 1.0);\n#endif\n#else\n#ifdef DOUBLESIDED\n  vec3 normal = dot(vnormal, viewDir)>0.0 ? -vnormal : vnormal;\n#elif defined(WINDINGORDERDOUBLESIDED)\n  vec3 normal = gl_FrontFacing ? vnormal : -vnormal;\n#else\n  vec3 normal = vnormal;\n#endif\n  normal = normalize(normal);\n#endif\n\n  // compute ssao\n#ifdef RECEIVE_SSAO\n  float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  ssao = viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n#else\n  float ssao = 1.0;\n#endif\n\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\n  float additionalAmbientScale;\n  vec3 additionalLight = sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n\n  // compute shadowing\n  float shadow = 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow = evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#elif VIEWING_MODE == VIEWING_MODE_GLOBAL\n  // at global scale (and in global scenes) we fall back to this approximation\n  // to shadow objects on the dark side of the earth\n  shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);\n#endif\n\n  vec3 matColor = max(ambient, diffuse); // combine the old material parameters into a single one\n\n  vec3 albedo_ = mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ = layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n  albedo_+= 0.25 * specular; // don't completely ignore specular for now\n\n#ifdef TRANSPARENCY_DISCARD\n  if (opacity_ < 0.001) {\n    discard;\n  }\n#endif\n\n  vec3 shadedColor = evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n  gl_FragColor = vec4(shadedColor, opacity_);\n  gl_FragColor = highlightSlice(gl_FragColor, vpos);\n}\n","colorPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/pathMaterial/commonInputs.glsl>\n\nattribute vec3 position;\nattribute vec4 auxpos1; // direction offset\n#ifdef COMPRESSED_NORMALS\nattribute vec2 normalCompressed;\n#else\nattribute vec3 normal;\n#endif\nvarying vec3 vpos;\nvarying vec3 vnormal;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#ifdef COMPONENTCOLORS\nuniform sampler2D uComponentColorTex;\nuniform vec2 uComponentColorTexInvDim;\n\nattribute float componentIndex;\n\nvec4 readComponentColor() {\n  float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n  vec2 indexCoord = vec2(\n    mod(normalizedIndex, 1.0),\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n  );\n  return texture2D(uComponentColorTex, indexCoord);\n}\n#endif\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n\n#ifdef SYMBOLVERTEXCOLORS\nattribute vec4 symbolColor;\n#endif\n\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\n// This should be further cleaned up later with through the following issue:\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\nuniform vec4 externalColor;\n// the vertex color variable will contain vvColor and/or vvOpacity or 1,1,1,1\nvarying vec4 vcolor;\nvarying vec4 vcolorExt;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#endif\n\n#include <materials/pathMaterial/visualVariables.glsl>\n\n#if defined(VV_SIZE) || defined(VV_COLOR) || defined(VV_OPACITY)\nattribute vec4 auxpos2;\n#endif\n\n#include <materials/pathMaterial/commonFunctions.glsl>\n#include <materials/pathMaterial/localNormal.glsl>\n#include <materials/pathMaterial/colorMixMode.glsl>\n\nvoid main() {\n  vpos = calculateVPos();\n\n  vnormal = normalize((modelNormal * localNormal()).xyz);\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\n  // issues on iPad/iPhone with the 'w' component require the depth to be\n  // passed as varying to properly drive the cascading shadow map index.\n  linearDepth = gl_Position.w;\n#endif\n\n  vcolorExt = externalColor;\n\n  vcolor = vec4(1.0, 1.0, 1.0, 1.0);\n#ifdef VV_COLOR\n  vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors);\n#endif\n#ifdef VV_OPACITY\n  // there might be opacity values in vvColor but according to the logic in graphicUtils.mixinColorAndOpacity,\n  // this value will be overridden by vvOpacity so we do the same here\n  vcolor.a = vvGetOpacity(auxpos2, vvOpacityValues, vvOpacityOpacities);\n#endif\n\n\n#ifdef SYMBOLVERTEXCOLORS\n  int symbolColorMixMode;\n  vcolorExt *= decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n  colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n\n#ifdef COMPONENTCOLORS\n  int symbolColorMixMode;\n  vcolorExt *= decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n  colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n\n#ifdef TEXTURING\n  // the v coordinate is stored in auxpos1.w\n#ifndef FLIPV\n  vtc = vec2(uv0.x, auxpos1.w);\n#else\n  vtc = vec2(uv0.x, 1.0-auxpos1.w);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","commonFunctions.glsl":"#include <materials/pathMaterial/localPosition.glsl>\n#include <util/doublePrecision.glsl>\n\nvec3 calculateVPos() {\n  return (model * localPosition()).xyz;\n}","commonInputs.glsl":"uniform mat4 proj;\nuniform mat4 view;\n\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n\nuniform mat4 model;\nuniform mat4 modelNormal;\n\nuniform float size;\n\n// ---------------------------------------------- ++","depthPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/depth.glsl>\n#include <util/slice.glsl>\n\nvarying float depth;\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\n#ifdef TEXTURING\n#include <materials/pathMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  if (textureLookup(tex, vtc).a < ALPHA_THRESHOLD) {\n    discard;\n  }\n#endif\n\n#ifndef BIAS_SHADOWMAP\n  gl_FragColor = float2rgba(depth);\n#else\n  gl_FragColor = float2rgba(calcFragDepth(depth));\n#endif\n}\n","depthPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/pathMaterial/commonInputs.glsl>\n\nuniform vec2 nearFar;\nattribute vec3 position;\nattribute vec4 auxpos1; // direction offset\n\nvarying float depth;\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#include <materials/pathMaterial/visualVariables.glsl>\n\n#if defined(VV_SIZE)\nattribute vec4 auxpos2;\n#endif\n\n#include <materials/pathMaterial/commonFunctions.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n  vec4 eye = view * vec4(vpos, 1.0);\n\n  gl_Position = proj * eye;\n  depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","highlightPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/highlight.glsl>\n\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\n#ifdef TEXTURING\n#include <materials/pathMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  if (textureLookup(tex, vtc).a < ALPHA_THRESHOLD) {\n    discard;\n  }\n#endif\n\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}\n","highlightPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/pathMaterial/commonInputs.glsl>\n\nattribute vec3 position;\nattribute vec4 auxpos1; // direction offset\n\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#include <materials/pathMaterial/visualVariables.glsl>\n\n#if defined(VV_SIZE)\nattribute vec4 auxpos2;\n#endif\n\n#include <materials/pathMaterial/commonFunctions.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","localNormal.glsl":"#include <util/normalEncoding.glsl>\n\n# ifdef COMPRESSED_NORMALS\nvec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\n# else\nvec4 localNormal() { return vec4(normal, 1.0); }\n# endif\n","localPosition.glsl":"#ifdef VV_SIZE\nvec4 localPosition() {\n    vec3 sizeScale = vvGetScale(auxpos2);\n    vec3 positionOffset = auxpos1.xyz*sizeScale;\n    return vec4( position+positionOffset, 1.0 );\n}\n#else\nvec4 localPosition() {\n    vec3 sizeScale = vec3(size);\n    vec3 positionOffset = auxpos1.xyz*sizeScale;\n    return vec4(position+positionOffset, 1.0);\n}\n#endif\n","normalPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\n#ifdef TEXTURING\n#include <materials/pathMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  if (textureLookup(tex, vtc).a < ALPHA_THRESHOLD) {\n    discard;\n  }\n#endif\n\n  vec3 normal = normalize(vnormal);\n  if (gl_FrontFacing == false) normal = -normal;\n\n#ifndef ALPHA_ZERO\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n}\n","normalPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/pathMaterial/commonInputs.glsl>\n\nuniform mat4 viewNormal;\nattribute vec3 position;\nattribute vec4 auxpos1; // direction offset\n#ifdef COMPRESSED_NORMALS\nattribute vec2 normalCompressed;\n#else\nattribute vec3 normal;\n#endif\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\n#include <materials/pathMaterial/visualVariables.glsl>\n\n#if defined(VV_SIZE)\nattribute vec4 auxpos2;\n#endif\n\n#include <materials/pathMaterial/commonFunctions.glsl>\n#include <materials/pathMaterial/localNormal.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n  vnormal = normalize((viewNormal * modelNormal * localNormal()).xyz);\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","texturing.glsl":"float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n  // from:\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\n  //   - http://www.linedef.com/virtual-texture-demo.html\n  float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\n}\n\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\n  //[umin, vmin, umax, vmax]\n  vec2 atlasScale = region.zw - region.xy;\n  vec2 uvAtlas = fract(uv) * atlasScale + region.xy;\n\n  // calculate derivative of continuous texture coordinate\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\n  vec2 dUVdx = dFdx(uv) * atlasScale;\n  vec2 dUVdy = dFdy(uv) * atlasScale;\n\n#ifdef GL_EXT_shader_texture_lod\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\n#else\n  // use bias to compensate for difference in automatic vs desired mipmap level\n  vec2 dUVdxAuto = dFdx(uvAtlas);\n  vec2 dUVdyAuto = dFdy(uvAtlas);\n  float mipMapLevel = calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\n  float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\n\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}\n\nvec4 textureLookup(sampler2D tex, vec2 uv) {\n#ifdef TEXTURE_ATLAS\n  return textureAtlasLookup(tex, uv, regionV, texSize);\n#else\n  return texture2D(tex, uv);\n#endif\n}\n\n","visualVariables.glsl":"\n#if defined(VV_SIZE)\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n\n  vec3 vvGetScale(vec4 featureAttribute) {\n    // the 0.5 factor comes from the fact that the generated profiles have radius of 1\n    // but the old implementation of the Graphics3DPathSymbolLayer actually had a profile radius of 0.5\n    // for constant size values the 0.5 is applied in Graphcis3DPathSymbolLayer when setting material parms\n    // we might want to change the path geometry generation so that it produces profile radius of 0.5 too\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize)*0.5;\n  }\n#endif\n\n#ifdef VV_COLOR\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n    float value = featureAttribute.y;\n    if (value <= values[0]) {\n      return colors[0];\n    }\n\n    for (int i = 1; i < VV_COLOR_N; ++i) {\n      if (values[i] >= value) {\n        float f = (value - values[i-1]) / (values[i] - values[i-1]);\n        return mix(colors[i-1], colors[i], f);\n      }\n    }\n\n    return colors[VV_COLOR_N - 1];\n  }\n#endif\n\n\n#ifdef VV_OPACITY\n  #define VV_OPACITY_N 8\n  uniform float vvOpacityValues[VV_OPACITY_N];\n  uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n  float vvGetOpacity(vec4 featureAttribute, float values[VV_OPACITY_N], float opacities[VV_OPACITY_N]) {\n    float value = featureAttribute.z;\n    if (value <= values[0]) {\n      return opacities[0];\n    }\n\n    for (int i = 1; i < VV_OPACITY_N; ++i) {\n      if (values[i] >= value) {\n        float f = (value - values[i-1]) / (values[i] - values[i-1]);\n        return mix(opacities[i-1], opacities[i], f);\n      }\n    }\n\n    return opacities[VV_OPACITY_N - 1];\n  }\n#endif\n\n"},ribbonLine:{"colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nuniform vec4 eColor;\nvarying vec4 vColor;\nvarying vec2 vtc;\nvarying vec3 vpos;\n\n#ifdef STIPPLE\nuniform float stippleLengthDoubleInv;\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef STIPPLE\n  if (fract(vtc.x * stippleLengthDoubleInv) > 0.5) {\n    discard;\n  }\n#endif\n\n  gl_FragColor = highlightSlice(eColor * vColor, vpos);\n}\n","highlightPass.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nvarying vec2 vtc;\nvarying vec3 vpos;\n\n#ifdef STIPPLE\nuniform float stippleLengthDoubleInv;\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef STIPPLE\n  if (fract(vtc.x * stippleLengthDoubleInv) > 0.5) {\n    discard;\n  }\n#endif\n\n  gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}\n","ribbonLine.vert":'#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nuniform float extLineWidth;\nuniform float nearPlane;\nuniform float pixelRatio;\n\nattribute vec3 position;\nattribute vec2 uv0;\nattribute vec4 color;\n\nvarying vec2 vtc;\nvarying vec4 vColor;\nvarying vec3 vpos;\n\nattribute float size;\n\n#ifndef WALL\nuniform float miterLimit;\nattribute vec3 auxpos1;\nattribute vec3 auxpos2;\n#endif\n\n#ifdef SCREENSCALE\nuniform vec2 screenSize;\n\nvec4 toScreenCoords(vec3 vertex) {\n  vec4 vClipSpace = proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\n  vClipSpace.xy *= screenSize;\n  return vClipSpace/abs(vClipSpace.w);\n}\n\n#define VECTYPE vec2\n#define ZEROVEC vec2(0.0, 0.0)\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0\n\n#else //ifdef SCREENSCALE\n\n#define VECTYPE vec3\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\n// these macros are only valid for "strip" type lines:\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*uv0.y < 0.0\n\n#endif //ifdef SCREENSCALE\n\nfloat interp(float ncp, vec4 a, vec4 b) {\n  return (-ncp - a.z) / (b.z - a.z);\n}\n\n#ifdef SCREENSCALE\n\nvoid clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\n  float vnp = nearPlane*0.99;\n\n  //We have four vertices per point on the line. Start and end vertices\n  //are treated differently --\x3e d > 0, d < 0\n  float d = abs(uv0.y) - 1.1;\n\n  //current pos behind ncp --\x3e we need to clip\n  if(pos.z > -nearPlane) {\n    if (d < 0.0) {\n      //previous in front of ncp\n      if(prev.z < -nearPlane) {\n        pos = mix(prev, pos, interp(vnp, prev, pos));\n        next = pos;\n      } else {\n        pos = vec4(0.0, 0.0, 0.0, 1.0);\n      }\n    }\n    //next in front of ncp\n    if(d > 0.0) {\n      if(next.z < -nearPlane) {\n        pos = mix(pos, next, interp(vnp, pos, next));\n        prev = pos;\n      } else {\n        pos = vec4(0.0, 0.0, 0.0, 1.0);\n      }\n    }\n  } else {\n    //current position visible\n    //previous behind ncp\n    if (prev.z > -nearPlane) {\n      prev = mix(pos, prev, interp(vnp, pos, prev));\n    }\n    //next behind ncp\n    if (next.z > -nearPlane) {\n      next = mix(next, pos, interp(vnp, next, pos));\n    }\n  }\n\n  pos= proj * pos;\n  pos.xy *= screenSize;\n  pos /= pos.w;\n\n  next = proj * next;\n  next.xy *= screenSize;\n  next /= next.w;\n\n  prev = proj * prev;\n  prev.xy *= screenSize;\n  prev /= prev.w;\n}\n\n#endif // SCREENSCALE\n\nvoid main(void) {\n  vpos = (model * vec4(position, 1.0)).xyz;\n\n#ifdef SCREENSCALE\n// Check for special value of uv0.y which is used by the Renderer when graphics\n// are removed before the VBO is recompacted. If this is the case, then we just\n// project outside of clip space.\nif (uv0.y == 0.0) {\n  // Project out of clip space\n  gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n}\nelse {\n#endif\n\nfloat lineWidth = (extLineWidth + size) * pixelRatio;\n\n#ifdef SCREENSCALE\n\n#if 0\n  vec4 pos = toScreenCoords(position.xyz);\n  vec2 left = (pos - toScreenCoords(auxpos1)).xy;\n  vec2 right = (toScreenCoords(auxpos2) - pos).xy;\n#else\n  vec4 pos  = view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\n  vec4 prev = view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\n  vec4 next = view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\n\n  clipAndTransform(pos, prev, next);\n\n  vec2 left = (pos - prev).xy;\n  vec2 right = (next - pos).xy;\n#endif\n\n#else // ifdef SCREENSCALE\n  vec4 pos = vec4(position, 1.0);\n#ifndef WALL\n  vec3 left = position.xyz - auxpos1;\n  vec3 right = auxpos2 - position.xyz;\n  vec3 up = normalize(position.xyz);\n#endif // ifndef WALL\n#endif // ifdef SCREENSCALE\n\n#ifdef WALL\n  float displacementLen = lineWidth;\n  vec3 displacementDir = normalize(position.xyz);//vec3(0.0, 1.0, 0.0);\n#else // ifdef WALL\n\n  float leftLen = length(left);\n  left = (leftLen > 0.001) ? left/leftLen : ZEROVEC;\n\n  float rightLen = length(right);\n  right = (rightLen > 0.001) ? right/rightLen : ZEROVEC;\n\n  // determine if vertex is on the "outside or "inside" of the join\n  bool isOutside = ISOUTSIDE;\n\n  // compute miter join position first\n  float displacementLen = lineWidth;\n  VECTYPE displacementDir = normalize(left + right);\n  displacementDir = PERPENDICULAR(displacementDir);\n  if (leftLen > 0.001 && rightLen > 0.001) {\n    float nDotSeg = dot(displacementDir, left);\n    displacementLen /= length(nDotSeg*left - displacementDir);\n\n    // limit displacement of inner vertices\n    if (!isOutside) {\n      displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n    }\n  }\n\n  if (isOutside && (displacementLen > miterLimit*lineWidth)) {\n    // convert to bevel join if miterLimit is exceeded\n    if (leftLen < 0.001) {\n      displacementDir = right;\n    }\n    else if (rightLen < 0.001) {\n      displacementDir = left;\n    }\n    else {\n      displacementDir = (abs(uv0.y) - 1.1 < 0.0) ? left : right;\n    }\n    displacementDir = normalize(displacementDir);\n    displacementDir = PERPENDICULAR(displacementDir);\n    displacementLen = lineWidth;\n  }\n\n#endif // ifdef WALL\n\n#ifdef SCREENSCALE\n  pos.xy += displacementDir * floor(uv0.y + 0.5) * displacementLen;\n  pos.xy /= screenSize;\n#else\n  pos.xyz += displacementDir * floor(uv0.y + 0.5) * displacementLen;\n  pos = proj * view * model * pos;\n#endif\n\n  vtc = uv0;\n  vColor = color * 0.003921568627451; // = 1/255\n  gl_Position = pos;\n\n#ifdef SCREENSCALE\n  }\n#endif\n}\n'},slicePlane:{"slicePlane.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n\nuniform vec4 backgroundColor;\nuniform vec4 gridColor;\nuniform float ratio;\nuniform float gridWidth;\n\nvarying vec2 vUV;\n\nvoid main() {\n  const float LINE_WIDTH = 1.0;\n\n  vec2 uvScaled = vUV * gridWidth;\n  vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\n  vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\n\n  // mask aliasing along edges\n  grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\n  grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\n\n  float gridFade = max(grid.x, grid.y);\n\n  float gridAlpha = gridColor.a * gridFade;\n\n  // premultiply alpha in output\n  gl_FragColor =\n    vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\n    vec4(gridColor.rgb, 1.0) * gridAlpha;\n}\n","slicePlane.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec2 vUV;\n\nvoid main(void) {\n  vUV = uv0;\n  gl_Position = proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n}\n"}},misc:{"blendLayers.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec2 uv;\n\nuniform sampler2D tex;\nuniform float opacity;\n\nvoid main() {\n  vec4 color = texture2D(tex, uv);\n\n  // Note: output in pre-multiplied alpha for correct alpha compositing\n  gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;\n}\n","blendLayers.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nuniform float scale;\nuniform vec2 offset;\n\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(position, 1.0);\n  uv = uv0 * scale + offset;;\n}\n","texOnly.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\nuniform vec4 color;\nvarying vec2 vtc;\n\nvoid main() {\n  vec4 texColor = texture2D(tex, vtc);\n  gl_FragColor = texColor * color;\n}\n","texOnly.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec2 vtc;\n\nvoid main(void) {\n  gl_Position = vec4(position, 1.0);\n  vtc = uv0;\n}\n"},pointRenderer:{"pointRenderer.frag":"#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n\n#ifdef DEPTH_PASS\nvarying float depth;\n#else\nvarying vec3 vColor;\n#endif\n\nvoid main(void) {\n  vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);\n  float r2 = dot(vOffset, vOffset);\n\n  if (r2 > 0.25) {\n    discard;\n  }\n\n#ifdef DEPTH_PASS\n  gl_FragColor = float2rgba(depth);\n#else\n  gl_FragColor = vec4(vColor, 1.0);\n#endif\n}\n","pointRenderer.vert":"#include <util/slice.glsl>\n#include <util/vsPrecision.glsl>\n\nattribute vec3 aPosition;\nattribute vec3 aColor;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform vec2 uScreenMinMaxSize;\nuniform vec2 uPointScale;\nuniform vec3 uClipMin;\nuniform vec3 uClipMax;\n\n#ifdef DEPTH_PASS\nuniform vec2 nearFar;\n\nvarying float depth;\n#else\nvarying vec3 vColor;\n#endif\n\nvoid main(void) {\n\n  // Move clipped points outside of clipspace\n  if (aPosition.x < uClipMin.x || aPosition.y < uClipMin.y || aPosition.z < uClipMin.z ||\n      aPosition.x > uClipMax.x || aPosition.y > uClipMax.y || aPosition.z > uClipMax.z) {\n    gl_Position = vec4(0.0,0.0,0.0,2.0);\n    gl_PointSize = 0.0;\n    return;\n  }\n\n  if (rejectBySlice(aPosition)) {\n    gl_Position = vec4(0.0,0.0,0.0,2.0);\n    gl_PointSize = 0.0;\n    return;\n  }\n\n  // Position in camera space\n  vec4 camera = uModelViewMatrix * vec4(aPosition, 1.0);\n\n  float pointSize = uPointScale.x;\n  vec4 position = uProjectionMatrix * camera;\n\n  // Calculate Size\n#ifdef DRAW_SCREEN_SIZE\n    float clampedScreenSize = pointSize;\n#else\n    float pointRadius = 0.5 * pointSize;\n    vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);\n    vec4 positionOffset = uProjectionMatrix * cameraOffset;\n    float radius = abs(positionOffset.y - position.y);\n\n    float viewHeight = uPointScale.y;\n\n    // screen diameter = (2 * r / w) * (h / 2)\n    float screenPointSize = (radius / position.w) * viewHeight;\n    float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n\n    // Shift towards camera, to move rendered point out of terrain i.e. to\n    // the camera-facing end of the virtual point when considering it as a\n    // 3D sphere.\n    camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n    position = uProjectionMatrix * camera;\n#endif\n\n  gl_PointSize = clampedScreenSize;\n  gl_Position = position;\n\n#ifdef DEPTH_PASS\n  depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n#else\n  vColor = aColor;\n#endif\n}\n"},renderer:{highlight:{"apply.frag":"#include <util/fsPrecision.glsl>\n\n// ===============================================================================\n// Merging blurred outlines with source image, advanced version\n\n// Defines:\n// GRID_OPTIMIZATION (set or !set)\n// GRID_DEBUG (set or !set)\n// ===============================================================================\n\nuniform sampler2D tex;\nuniform sampler2D origin;\n\nuniform vec4 color;\nuniform float outlineSize;\nuniform float blurSize;\nuniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\n\nvarying vec2 uv;\n\nvoid main() {\n  #if defined(GRID_OPTIMIZATION) && defined(GRID_DEBUG)\n    gl_FragColor = vec4(uv, 0.0, 1.0);\n  #else\n    // Read the highlight intensity from the blurred highlight image\n    vec4 blurredHighlightValue = texture2D(tex, uv);\n    float highlightIntensity = blurredHighlightValue.a;\n\n    // Discard all pixels which are not affected by highlight\n    if (highlightIntensity == 0.0) {\n      discard;\n    }\n\n    vec4 origin_color = texture2D(origin, uv);\n\n    float outlineIntensity;\n    float fillIntensity;\n\n    // if occluded\n    if (blurredHighlightValue.g > blurredHighlightValue.b) {\n      outlineIntensity = color.w * opacities[1];\n      fillIntensity = color.w * opacities[3];\n    }\n    // if unoccluded\n    else {\n      outlineIntensity = color.w * opacities[0];\n      fillIntensity = color.w * opacities[2];\n    }\n\n    float inner = 1.0 - outlineSize / 9.0;\n    float outer = 1.0 - (outlineSize + blurSize) / 9.0;\n\n    float outlineFactor = smoothstep(outer, inner, highlightIntensity);\n    //float fillFactor = smoothstep(0.6, 0.72, highlightIntensity);\n    float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n    float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n    // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    // I.e., color should not be premultiplied with alpha\n    gl_FragColor = vec4(color.xyz, intensity);\n  #endif\n}\n","apply.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nvarying vec2 uv;\n\n#ifdef GRID_OPTIMIZATION\n  attribute vec2 uv0;\n  uniform sampler2D coverageTex;\n#endif\n\nvoid main() {\n  #ifdef GRID_OPTIMIZATION\n    #ifdef GRID_DEBUG\n      vec4 cov = texture2D(coverageTex, uv0);\n      // if no highlight pixel set in this block,\n      // or all pixels set, hide block\n      if (cov.r == 0.0 || cov.g == 1.0 || cov.b == 1.0) {\n        gl_Position = vec4(0.0);\n        return;\n      }\n      gl_Position = vec4(position, .0, 1.0);\n      uv = uv0;\n      return;\n    #else\n      vec4 cov = texture2D(coverageTex, uv0);\n      // if no highlight pixel set in this block, hide block\n      if (cov.r == 0.0) {\n        gl_Position = vec4(0.0);\n        return;\n      }\n    #endif\n  #endif\n\n  gl_Position = vec4(position, .0, 1.0);\n  uv = position.xy * .5 + vec2(.5);\n}\n","blur.frag":"#include <util/fsPrecision.glsl>\n\n// ===============================================================================\n// Gaussian blur with linear sampling. Supports different number of samples, but\n// only 5 samples have proper weights. Uses linear texture interpolation to reduce\n// the number of samples taken.\n\n// Defines:\n// GRID_OPTIMIZATION (set or !set)\n// GAUSSIAN_SAMPLES (3,5,7)\n\n// This technique requires linear filtering on source texture\n// http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\n// ===============================================================================\n\nuniform sampler2D tex;\n\n#ifdef GRID_OPTIMIZATION\n  uniform vec2 blurSize;\n  varying vec3 blurCoordinate;\n#else\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n#endif\n\nvoid main() {\n  #ifdef GRID_OPTIMIZATION\n    vec2 uv = blurCoordinate.xy;\n    vec4 center = texture2D(tex, uv);\n\n    // do not blur if no pixel or all pixels in neighborhood are set\n    if (blurCoordinate.z == 1.0) {\n      gl_FragColor = center;\n    }\n    else {\n      vec4 sum = vec4(0.0);\n\n      #if GAUSSIAN_SAMPLES == 3\n        // not proper gaussian weights\n        sum += center * 0.204164;\n        sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n      #elif GAUSSIAN_SAMPLES == 5\n        sum += center * 0.204164;\n        sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n        sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n      #elif GAUSSIAN_SAMPLES == 7\n        // not proper gaussian weights\n        sum += center * 0.204164;\n        sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n        sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n        sum += texture2D(tex, uv + blurSize * 5.1) * 0.03;\n        sum += texture2D(tex, uv - blurSize * 5.1) * 0.03;\n      #elif GAUSSIAN_SAMPLES == 9\n        // not proper gaussian weights\n        sum += center * 0.154164;\n        sum += texture2D(tex, uv + blurSize * 1.5) * 0.204005;\n        sum += texture2D(tex, uv - blurSize * 1.5) * 0.204005;\n        sum += texture2D(tex, uv + blurSize * 3.5) * 0.123913;\n        sum += texture2D(tex, uv - blurSize * 3.5) * 0.123913;\n        sum += texture2D(tex, uv + blurSize * 5.5) * 0.123913;\n        sum += texture2D(tex, uv - blurSize * 5.5) * 0.123913;\n        sum += texture2D(tex, uv + blurSize * 7.5) * 0.05;\n        sum += texture2D(tex, uv - blurSize * 7.5) * 0.05;\n      #endif\n\n      gl_FragColor = sum;\n    }\n  #else\n    vec4 sum = vec4(0.0);\n\n    #if GAUSSIAN_SAMPLES == 3\n      // not proper gaussian weights\n      sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n    #elif GAUSSIAN_SAMPLES == 5\n      sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n      sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n    #elif GAUSSIAN_SAMPLES == 7\n      // not proper gaussian weights\n      sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n      sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n      sum += texture2D(tex, blurCoordinates[5]) * 0.03;\n      sum += texture2D(tex, blurCoordinates[6]) * 0.03;\n    #elif GAUSSIAN_SAMPLES == 9\n      // not proper gaussian weights\n      sum += texture2D(tex, blurCoordinates[0]) * 0.154164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.204005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.204005;\n      sum += texture2D(tex, blurCoordinates[3]) * 0.123913;\n      sum += texture2D(tex, blurCoordinates[4]) * 0.123913;\n      sum += texture2D(tex, blurCoordinates[5]) * 0.09;\n      sum += texture2D(tex, blurCoordinates[6]) * 0.09;\n      sum += texture2D(tex, blurCoordinates[7]) * 0.05;\n      sum += texture2D(tex, blurCoordinates[8]) * 0.05;\n    #endif\n\n    gl_FragColor = sum;\n  #endif\n}\n","blur.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nattribute vec2 uv0;\n\n#ifdef GRID_OPTIMIZATION\n  uniform sampler2D coverageTex;\n  varying vec3 blurCoordinate;\n#else\n  uniform vec2 blurSize;\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n#endif\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n\n  #ifdef GRID_OPTIMIZATION\n    // sample the coverage texture at the block center\n    // and if no coverage detected, create degenerate triangle\n    vec4 cov = texture2D(coverageTex, uv0);\n    if (cov.r == 0.0) {\n      gl_Position = vec4(0.0);\n    }\n\n    // create texture coordinate for blur center\n    // encode information about fully inside block in z coordinate\n    blurCoordinate = vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\n  #else\n    vec2 uv = position.xy * .5 + vec2(.5);\n\n    #if GAUSSIAN_SAMPLES == 3\n      // not proper gaussian weights\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n    #elif GAUSSIAN_SAMPLES == 5\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n      blurCoordinates[3] = uv + blurSize * 3.294215;\n      blurCoordinates[4] = uv - blurSize * 3.294215;\n    #elif GAUSSIAN_SAMPLES == 7\n      // not proper gaussian weights\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n      blurCoordinates[3] = uv + blurSize * 3.294215;\n      blurCoordinates[4] = uv - blurSize * 3.294215;\n      blurCoordinates[5] = uv + blurSize * 5.1;\n      blurCoordinates[6] = uv - blurSize * 5.1;\n    #elif GAUSSIAN_SAMPLES == 9\n      // not proper gaussian weights\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n      blurCoordinates[3] = uv + blurSize * 3.294215;\n      blurCoordinates[4] = uv - blurSize * 3.294215;\n      blurCoordinates[5] = uv + blurSize * 5.1;\n      blurCoordinates[6] = uv - blurSize * 5.1;\n      blurCoordinates[7] = uv + blurSize * 7.1;\n      blurCoordinates[8] = uv - blurSize * 7.1;\n    #endif\n  #endif\n}\n","downsample.frag":"#include <util/fsPrecision.glsl>\n\n// ===============================================================================\n// Smartly downsamples a texture, halfing its resolution. This allows for a square\n// screen region to check if none, any or all pixels were set.\n\n// The red channel is always ceiled after interpolating the 4 merged pixels.\n// This allows to evaluate:\n// any(pixels.red != 0.0) as red == 1.0\n// none(pixels.red != 0.0) as red == 0.0\n\n// The green and blue channels are set to floor(max(green, blue)).\n// This allows to evaluate:\n// all(pixels.green || pixels.blue) as green == 1.0\n// ===============================================================================\n\nuniform sampler2D tex;\nuniform vec2 invFramebufferDim;\n\nvoid main() {\n  vec2 coord = gl_FragCoord.xy * invFramebufferDim;\n  vec4 value = texture2D(tex, coord);\n  float mx = floor(max(value.g, value.b));\n  gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);\n}\n","downsample.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\n\nvoid main() {\n  gl_Position = vec4(vec2(1.0) - position * 2.0, .0, 1.0);\n}\n"},laserLine:{"laserLine.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/depth.glsl>\n\n//--------------------------------------------------------------------------\n// Uniforms\n//--------------------------------------------------------------------------\n\nuniform sampler2D depthMap;\n\nuniform vec2 nearFar;\nuniform vec4 projInfo;\nuniform vec2 zScale;\nuniform float maxPixelDistance;\n\n// focus plane in camera space\nuniform vec4 focusPlane;\n\n// focus sphere in camera space\nuniform vec4 focusSphere;\n\n// segment plane in camera space\nuniform vec4 segmentPlane;\n\n// line segment\nuniform vec3 segmentStart;\nuniform vec3 segmentEnd;\n\n// styling\nuniform vec3 glowColor;\nuniform float glowWidth;\nuniform vec3 innerColor;\nuniform float innerWidth;\nuniform float globalAlpha;\n\n//--------------------------------------------------------------------------\n// Inputs\n//--------------------------------------------------------------------------\n\nvarying vec2 uv;\n\n//--------------------------------------------------------------------------\n// Defines\n//--------------------------------------------------------------------------\n\n#define INFINITY 100000.0\n\n// reconstruct position in view space\nvec3 reconstructPosition(vec2 fragCoord, float depth) {\n  return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n}\n\nfloat planeDistancePixels(vec4 plane, vec3 pos) {\n  // compute distance to plane\n  float dist = dot(plane.xyz, pos) + plane.w;\n  // compute derivative of distance function with respect to pixels\n  float width = fwidth(dist);\n  // normalize distance by the derivative to get a measurement with respect to pixels\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\n  dist /= min(width, maxPixelDistance);\n  return abs(dist);\n}\n\nfloat sphereDistancePixels(vec4 sphere, vec3 pos) {\n  // compute distance to sphere\n  float dist = distance(sphere.xyz, pos) - sphere.w;\n  // compute derivative of distance function with respect to pixels\n  float width = fwidth(dist);\n  // normalize distance by the derivative to get a measurement with respect to pixels\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\n  dist /= min(width, maxPixelDistance);\n  return abs(dist);\n}\n\nvec4 blendPremultiplied(vec4 source, vec4 dest) {\n  float oneMinusSourceAlpha = 1.0 - source.a;\n\n  return vec4(\n    source.rgb + dest.rgb * oneMinusSourceAlpha,\n    source.a + dest.a * oneMinusSourceAlpha\n  );\n}\n\nvec4 premultipliedColor(vec3 rgb, float alpha) {\n  return vec4(rgb * alpha, alpha);\n}\n\n// computes laser line color based on distance in pixels\nvec4 laserLineProfile(float dist) {\n  if (dist > glowWidth) {\n    return vec4(0.0);\n  }\n\n  float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\n  float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), 8.0);\n\n  return blendPremultiplied(\n    premultipliedColor(innerColor, innerAlpha),\n    premultipliedColor(glowColor, glowAlpha)\n  );\n}\n\nvoid main() {\n  // do not draw laserline on background\n  float depth = linearDepth(depthMap, uv, nearFar);\n  if (-depth == nearFar[0]) {\n    discard;\n  }\n\n  // reconstruct position in view space\n  vec3 pos = reconstructPosition(gl_FragCoord.xy, depth);\n\n  // empirical hack to fade out laser line in problematic areas:\n  // the derivatives to normalize the distance function are valid inside smooth surfaces,\n  // but break down at depth discontinuities (e.g. edges). We fade out the laser lines in\n  // areas where depth valus have large variations in order to avoid this problem.\n  float ddepth = fwidth(depth);\n  float depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n\n  // reconstruct normal using derivatives\n  vec3 normal = normalize(cross(dFdx(pos), dFdy(pos)));\n\n  // distance to focus plane\n  float focusPlaneDistance = planeDistancePixels(focusPlane, pos);\n\n  // distance to focus sphere\n  float focusSphereDistance = sphereDistancePixels(focusSphere, pos);\n\n  // distance to segment plane\n  float segmentDistance = INFINITY;\n  float segmentLength = length(segmentEnd - segmentStart);\n  vec3 segmentDir = (segmentEnd - segmentStart) / segmentLength;\n  float t = dot(segmentDir, pos - segmentStart);\n\n  if (segmentLength > 0.0 && t >= 0.0 && t <= segmentLength) {\n    segmentDistance = planeDistancePixels(segmentPlane, pos);\n  }\n\n  // evaluate color profile for both planes and the sphere\n  vec4 focusPlaneColor = laserLineProfile(focusPlaneDistance);\n  vec4 focusSphereColor = laserLineProfile(focusSphereDistance);\n  vec4 segmentColor = laserLineProfile(segmentDistance);\n\n  // empirical hack to fade out laser line when planes are nearly parallel\n  float focusPlaneAlpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, focusPlane.xyz)));\n  float focusSphereAlpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, normalize(pos - focusSphere.xyz))));\n  float segmentAlpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, segmentPlane.xyz)));\n\n  // combine colors\n  vec4 color = max(\n    focusPlaneColor * focusPlaneAlpha,\n    max(\n      focusSphereColor * focusSphereAlpha,\n      segmentColor * segmentAlpha\n    )\n  );\n\n  gl_FragColor = color * globalAlpha * depthDiscontinuityAlpha;\n}\n"},offscreen:{"composite.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\n\nvarying vec2 vtc;\n\nvoid main() {\n  gl_FragColor = texture2D(tex, vtc);\n}\n","compositeOccluded.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D occludedColorMap;\nuniform float opacity;\n\nvarying vec2 vtc;\n\nvoid main() {\n  vec4 occludedColor = texture2D(occludedColorMap, vtc);\n  gl_FragColor = occludedColor * opacity;\n}\n","compositeTransparentToHUDVisibility.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\n\nvarying vec2 vtc;\n\nvoid main() {\n  gl_FragColor = vec4(1.0 - texture2D(tex, vtc).a);\n}\n","offscreen.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nvarying vec2 vtc;\n\nvoid main(void) {\n  gl_Position = vec4(position.xy, 0.0, 1.0);\n  vtc = position.xy * 0.5 + 0.5;\n}\n"},ssao:{"blur.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/depth.glsl>\n\n#ifndef RADIUS\n#define RADIUS 4\n#endif\n\nuniform sampler2D normalMap;\nuniform sampler2D depthMap;\nuniform sampler2D tex;\n\nuniform vec2 blurSize;\n\nuniform float g_BlurFalloff;\nuniform float projScale;\n\nuniform vec2 nearFar;\n//set z scaling, used to prevent division in ortho mode\nuniform vec2 zScale;\n\nvarying vec2 uv;\n\nfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n  float c = texture2D(tex, uv).r;\n  float d = linearDepth(depthMap, uv, nearFar);\n\n  float ddiff = d - center_d;\n\n  float w = exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n  w_total += w;\n\n  return w*c;\n}\n\nvoid main(void) {\n  float b = 0.0;\n  float w_total = 0.0;\n\n  float center_d = linearDepth(depthMap, uv, nearFar);\n\n  float sharpness = -0.05 * projScale/(center_d*zScale.x+zScale.y);\n  for (int r = -RADIUS; r <= RADIUS; ++r) {\n    float rf = float(r);\n    vec2 uvOffset = uv + rf*blurSize;\n    b += BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\n  }\n\n  gl_FragColor = vec4(b/w_total);\n}\n","ssao.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/depth.glsl>\n\n#ifndef SAMPLES\n#define SAMPLES 4\n#endif\n\nuniform mat4 projMatrixInv;\n\nuniform sampler2D normalMap;\nuniform sampler2D depthMap;\n\nuniform float intensity;\n\nuniform float projScale;\nuniform float radius;\nuniform vec2 nearFar;\nuniform vec4 projInfo;\nuniform vec2 screenDimensions;\n\n//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\nuniform vec3 pSphere[SAMPLES]; //tap position\nuniform vec2 rnmScale;\nuniform sampler2D rnm; //noise texture\n\n//set z scaling, used to prevent division in ortho mode\nuniform vec2 zScale;\n\nvarying vec2  uv;\nvarying vec4  camPos;\n\nfloat fallOffFunction(float vv, float vn, float bias) {\n  float radius2 = radius * radius;\n\n  // A: From the HPG12 paper\n  // Note large epsilon to avoid overdarkening within cracks\n  // return float(vv < radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n  // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n  float f = max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n  // C: Medium contrast (which looks better at high radii), no division.  Note that the\n  // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n  // more computationally efficient and happens to be aesthetically pleasing.\n  // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n  // D: Low contrast, no division operation\n  // return 2.0 * float(vv < radius * radius) * max(vn - bias, 0.0);\n}\n\n\n/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\nfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n  vec3 v = Q - C;\n  float vv = dot(v, v);\n  float vn = dot(normalize(v), n_C);\n  return fallOffFunction(vv, vn, 0.1);\n}\n\n\n/**\n * Reconstruct camera-space P.xyz from screen-space S = (x, y) in\n * pixels and camera-space z < 0.  Assumes that the upper-left pixel center\n * is at (0.5, 0.5) [but that need not be the location at which the sample tap\n * was placed!]\n *\n * Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\n */\nvec3 reconstructCSPosition(vec2 S, float z) {\n  return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\n}\n\nvoid main(void) {\n  //Hash function used in the HPG12 AlchemyAO paper\n  //Not supported in WebGL -> using texture lookup as in old SSAO shader instead\n  //ivec2 ssC = ivec2(gl_FragCoord.xy);\n  //float randomPatternRotationAngle = float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n  vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n  float currentPixelDepth = linearDepth(depthMap, uv, nearFar);\n\n  if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {\n    gl_FragColor = vec4(0.0);\n    return;\n  }\n\n  vec3 currentPixelPos = reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\n\n  // get the normal of current fragment\n  vec4 norm4 = texture2D(normalMap, uv);\n  vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;\n  bool isTerrain = norm4.w<0.5;\n\n  float sum = .0;\n\n  vec4 occluderFragment;\n  vec3 ray;\n\n  vec3 tapPixelPos;\n\n  // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n  // bug or deviation from CE somewhere else?\n  float ps = projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n  for(int i = 0; i < SAMPLES; ++i) {\n    // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n    //float ssR;\n    //vec2 unitOffset = tapLocation(i, randomPatternRotationAngle, ssR);\n    // get the depth of the occluder fragment\n    //vec2 offset = vec2(-unitOffset*radius*ssR*ps);\n\n    vec2 unitOffset = reflect(pSphere[i], fres).xy;\n    vec2 offset = vec2(-unitOffset*radius*ps);\n\n    //don't use current or very nearby samples\n    if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;\n\n    vec2 tc = vec2(gl_FragCoord.xy + offset);\n    if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;\n    vec2 tcTap = tc/screenDimensions;\n    float occluderFragmentDepth = linearDepth(depthMap, tcTap, nearFar);\n\n    if (isTerrain) {\n      bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;\n      if (isTerrainTap) {\n        continue;\n      }\n    }\n\n    tapPixelPos = reconstructCSPosition(tc, occluderFragmentDepth);\n\n    sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n  }\n\n  // output the result\n\n  float A = max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n  // Anti-tone map to reduce contrast and drag dark region farther\n  // (x^0.2 + 1.2 * x^4)/2.2\n  A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n  //gl_FragColor = vec4(norm/2.0+0.5, 1.0);\n  //gl_FragColor = vec4(-currentPixelDepth/1000.0);\n  //gl_FragColor = vec4(tapPixelPos.x/100.0);\n  gl_FragColor = vec4(A);\n}\n"}},terrainRenderer:{"colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/sceneLighting.glsl>\n#include <util/screenSizePerspective.glsl>\n#include <util/shadow.glsl>\n#include <util/slice.glsl>\n#include <terrainRenderer/overlay.glsl>\n\nuniform vec3 lightDirection;\nuniform vec3 viewDirection;\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\nuniform sampler2D tex;\nuniform float opacity;\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\nstruct WireframeSettings {\n  float width;\n  float falloff;\n  float subdivision;\n  vec4 color;\n  float wireOpacity;\n  float surfaceOpacity;\n};\n\nuniform WireframeSettings wireframe;\n#endif\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvarying vec2 vtc;\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\nvarying vec2 vuv;\n#endif\n\n#ifdef ATMOSPHERE\nvarying vec3 wpos;\nvarying vec3 wview;\nvarying vec3 wnormal;\nvarying vec3 wlight;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\nuniform vec4 screenSizePerspective;\n\nvarying float screenSizeDistanceToCamera;\nvarying float screenSizeCosAngle;\n#endif\n\nconst vec3 ambient = vec3(0.2,0.2,0.2);\nconst vec3 diffuse = vec3(0.8,0.8,0.8);\nconst float diffuseHardness = 2.5;\nconst float sliceOpacity = 0.2;\n\n#ifdef OVERLAY\nuniform sampler2D overlay0Tex;\nuniform sampler2D overlay1Tex;\nuniform float overlayOpacity;\nvarying vec4 vtcOverlay;\n#endif\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n\nfloat lum(vec3 c) {\n  float max = max(max(c.r, c.g), c.b);\n  float min = min(min(c.r, c.g), c.b);\n  return (min + max) * 0.5;\n}\n\n#ifdef ATMOSPHERE\nvec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n  vec3 surfaceColor   = vec3(0.0);\n  vec3 fuzzySpecColor = vec3(1.0);\n  vec3 subColor       = vec3(0.0);\n  float rollOff       = 1.0;\n\n  vec3 Ln = normalize(lightPos);\n  vec3 Nn = normalize(normal);\n  vec3 Hn = normalize(view + Ln);\n\n  float ldn = dot(Ln, Nn);\n  float diffComp = max(0.0, ldn);\n  float vdn = 1.0 - dot(view, Nn);\n  float ndv = dot(view, Ln);\n\n  vec3 diffContrib = surfaceColor * diffComp;\n  float subLamb = max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n  vec3 subContrib = subLamb * subColor;\n  vec3 vecColor = vec3(vdn);\n\n  vec3 diffuseContrib = (subContrib + diffContrib);\n  vec3 specularContrib = (vecColor * fuzzySpecColor);\n\n  return (diffContrib + specularContrib) * rollOff;\n}\n#endif\n\nvoid main() {\n  vec3 a = ambient;\n\n  float shadow = 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow = evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#endif\n  float vndl = dot(normalize(vnormal), lightDirection);\n  float k = smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n  vec3 d = (1.0 - shadow/1.8) * diffuse * k;\n\n  float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n\n  vec4 tileColor = texture2D(tex, vtc) * opacity;\n\n#ifdef OVERLAY\n  vec4 overlayColor = getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\n\n  // tileColor and overlayTexCols have pre-multiplied alpha\n  tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;\n#endif\n\n  if (rejectBySlice(vpos)) {\n    tileColor *= sliceOpacity;\n  }\n\n  vec3 atm = vec3(0.0);\n#ifdef ATMOSPHERE\n  float ndotl = max(0.0, min(1.0, vndl));\n  atm = atmosphere(wlight, wnormal, -viewDirection);\n  atm *= max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n  atm *= max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n  atm *= tileColor.a; // premultiply with tile alpha\n#endif\n\n  vec3 albedo = atm + tileColor.rgb;\n  vec3 normal = normalize(vnormal);\n\n  // heuristic shading function used in the old terrain, now used to add ambient lighting\n  float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n  vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n  gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n  // This is only used for debug rendering the screenSize perspective\n\n  float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n\n  if (perspectiveScale <= 0.25) {\n    gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n  }\n  else if (perspectiveScale <= 0.5) {\n    gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n  }\n  else if (perspectiveScale >= 0.99) {\n    gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n  }\n  else {\n    gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n  }\n\n#endif\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\n\n  vec2 vuvScaled = vuv * wireframe.subdivision;\n  vec2 vuvMod = fract(vuvScaled);\n\n  vec2 dVuv = fwidth(vuvScaled);\n  dVuv = max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\n\n  vec2 edgeFactors = smoothstep((wireframe.width - wireframe.falloff) * dVuv,\n                                wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\n\n  float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n#ifdef WIREFRAME_TEXTURE\n  vec3 wireframeColor = mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a);\n  float wireframeAlpha = mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor);\n  gl_FragColor = vec4(wireframeColor * wireframeAlpha, wireframeAlpha * gl_FragColor.a);\n#endif\n\n\n#ifdef TILE_BORDERS\n  dVuv = fwidth(vuv);\n  edgeFactors = smoothstep((wireframe.width - wireframe.falloff) * dVuv,\n                            wireframe.width * dVuv, min(vuv, 1.0 - vuv));\n  edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n  gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\n#endif\n\n#endif // defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\n\n  gl_FragColor = highlightSlice(gl_FragColor, vpos);\n}\n","colorPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec3 origin;\nuniform vec4 texOffsetAndScale;\nuniform mat4 viewNormal;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvarying vec2 vtc;\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\nvarying vec2 vuv;\n#endif\n\n#ifdef ATMOSPHERE\nuniform vec3 lightDirection;\nvarying vec3 wpos;\nvarying vec3 wview;\nvarying vec3 wnormal;\nvarying vec3 wlight;\n#endif\n\n#ifdef OVERLAY\n// these variables combine two possible overlays into one by using a vec4:\n// components x/y are x/y of overlay 0, and components z/w are x/y of overlay 1\nuniform vec4 overlayTexOffset;\nuniform vec4 overlayTexScale;\nvarying vec4 vtcOverlay;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n\nuniform vec4 screenSizePerspective;\n\nvarying float screenSizeDistanceToCamera;\nvarying float screenSizeCosAngle;\n\n#endif\n\nvoid main(void) {\n  vpos = position;\n\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n  vnormal = normalize(vpos + origin);\n#else\n  vnormal = vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n#endif\n\nvec2 uv = uv0;\nvpos = applySkirts(uv, vpos, vnormal, skirtScale);\n\n#ifdef ATMOSPHERE\n  wpos = (view * vec4(vpos, 1.0)).xyz;\n  wnormal = (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n  wlight = (view  * vec4(lightDirection, 1.0)).xyz;\n#endif\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\n  vuv = uv;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n\n  vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;\n\n  screenSizeDistanceToCamera = length(viewPos);\n\n  vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n  screenSizeCosAngle = abs(viewSpaceNormal.z);\n\n#endif\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\n  // issues on iPad/iPhone with the 'w' component require the depth to be\n  // passed as varying to properly drive the cascading shadow map index.\n  linearDepth = gl_Position.w;\n#endif\n\n  vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n\n#ifdef OVERLAY\n  vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n#endif\n}\n","depthPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/depth.glsl>\n\nvarying float depth;\nvarying vec3 vpos;\n\nvoid main() {\n#ifndef BIAS_SHADOWMAP\n  gl_FragColor = float2rgba(depth);\n#else\n  gl_FragColor = float2rgba(calcFragDepth(depth));\n#endif\n}\n","depthPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec2 nearFar;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying float depth;\nvarying vec3 vpos;\n\nvoid main(void) {\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n  vec3 normal = normalize(position + origin);\n#else\n  vec3 normal = vec3(0.0, 0.0, 1.0);\n#endif\n\n  vec2 uv = uv0;\n  vpos = applySkirts(uv, position, normal.xyz, skirtScale);\n\n  vec4 eye = view * vec4(vpos, 1.0);\n  gl_Position = proj * eye;\n  depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n}\n","highlightPass.frag":"#include <util/fsPrecision.glsl>\n#include <util/highlight.glsl>\n#include <terrainRenderer/overlay.glsl>\n\nuniform sampler2D overlay0Tex;\nuniform sampler2D overlay1Tex;\nuniform float overlayOpacity;\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\nvarying vec4 vtcOverlay;\n\nvoid main() {\n  vec4 overlayColor = getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\n\n  if (overlayColor.a == 0.0) {\n    // Here we have to write black, instead of discarding the fragment in order to overwrite\n    // the highlights which might have been written by skirts of other tiles.\n    // As a consequence skirts are not visible, but terrain overwrites draped highlights.\n    gl_FragColor = vec4(0.0);\n    return;\n  }\n\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}\n","highlightPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec4 overlayTexScale;\nuniform vec4 overlayTexOffset;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec3 vpos;\nvarying vec4 vtcOverlay;\n\nvoid main() {\n  #if VIEWING_MODE == VIEWING_MODE_GLOBAL\n    vec3 vnormal = normalize(position + origin);\n  #else\n    vec3 vnormal = vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n  #endif\n\n  vec2 uv = uv0;\n  vpos = applySkirts(uv, position, vnormal, skirtScale);\n\n  vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n}\n","normalPass.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\nvoid main() {\n  vec3 normal = normalize(vnormal);\n  if (gl_FrontFacing == false) normal = -normal;\n\n#ifndef ALPHA_ZERO\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n}\n","normalPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 viewNormal;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\nvoid main(void) {\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n  vec4 normal = vec4(normalize(position + origin), 1.0);\n#else\n  vec4 normal = vec4(0.0, 0.0, 1.0, 1.0);\n#endif\n\n  vec2 uv = uv0;\n  vpos = applySkirts(uv, position, normal.xyz, skirtScale);\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n  vnormal = normalize((viewNormal * normal).xyz);\n}\n","overlay.glsl":"vec4 getOverlayColor(sampler2D overlay0Tex, sampler2D overlay1Tex, vec4 texCoords, float opacity) {\n  vec4 color = vec4(0.0);\n\n  // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n  // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n  // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n  vec4 colorInner = texture2D(overlay0Tex, texCoords.xy);\n  vec4 colorOuter = texture2D(overlay1Tex, texCoords.zw);\n\n  if ((texCoords.x > 0.0) && (texCoords.x < 1.0) && (texCoords.y > 0.0) && (texCoords.y < 1.0)) {\n    // inner overlay texture coordinates are within bounds -> sample from inner overlay\n    color = colorInner;\n  } else if ((texCoords.z > 0.0) && (texCoords.z < 1.0) && (texCoords.w > 0.0) && (texCoords.w < 1.0)) {\n    // sample from outer overlay\n    color = colorOuter;\n  }\n\n  return color * opacity;\n}\n","skirts.glsl":'vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n  float skirtLength = 0.0;\n\n  if (uv.x >= 2.0) {\n    skirtLength = uv.y * skirtScale;\n    // decode original uv-coordinates (see "encodeSkirtPos")\n    vec2 x = vec2(uv.x) - vec2(3.5, 4.5);\n    uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n  }\n\n  return vpos - vnormal * skirtLength;\n}\n'},util:{"alignPixel.glsl":"vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n  // From clip space to (0 : 1), bias towards right pixel edge\n  vec2 xy = vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\n\n  // Size of a pixel in range (0 : 1)\n  vec2 pixelSz = vec2(1.0) / widthHeight;\n\n  // Round to nearest pixel center\n  vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n\n  // Convert back to clip space\n  vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n  return vec4(result, clipCoord.zw);\n}\n\nvec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n  // From clip space to (0 : 1),\n  vec2 xy = vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\n\n  // Size of a pixel in range (0 : 1)\n  vec2 pixelSz = vec2(1.0) / widthHeight;\n\n  // Round to nearest pixel border, (0 : 1)\n  vec2 ij = floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\n\n  // Convert back to clip space\n  vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n  return vec4(result, clipCoord.zw);\n}\n","color.glsl":"vec4 premultiplyAlpha(vec4 v) {\n  return vec4(v.rgb * v.a, v.a);\n}\n\nvec3 rgb2hsv(vec3 c) {\n  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n  vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n  float d = q.x - min(q.w, q.y);\n  float e = 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n","depth.glsl":"#include <util/encoding.glsl>\n\n// read linear depth either from native depth texture or custom depth texture encoded in rgba\nfloat linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n  return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n}\n\nfloat calcFragDepth(const in float depth) {\n  // calc polygon offset\n  const float SLOPE_SCALE = 2.0;\n  const float BIAS = 2.0 * .000015259;    // 1 / (2^16 - 1)\n  float m = max(abs(dFdx(depth)), abs(dFdy(depth)));\n  float result = depth + SLOPE_SCALE * m + BIAS;\n  return clamp(result, .0, .999999);\n}\n","doublePrecision.glsl":"// based on https://www.thasler.com/blog/blog/glsl-part2-emu\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n  vec3 t1 = hiA + hiB;\n  vec3 e = t1 - hiA;\n  vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n  return t1 + t2;\n}\n","enableExtensions.glsl":"#define EXTENSIONS_ENABLED\n#extension GL_OES_standard_derivatives : enable\n#extension GL_EXT_shader_texture_lod : enable\n","encoding.glsl":"// This is the maximum float value representable as 32bit fixed point,\n// it is rgba2float(vec4(1)) inlined.\nconst float MAX_RGBA_FLOAT =\n  255.0 / 256.0 +\n  255.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n// Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\nconst vec4 fixedPointFactors = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\nvec4 float2rgba(const float value) {\n  // Make sure value is in the domain we can represent\n  float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n  // Decompose value in 32bit fixed point parts represented as\n  // uint8 rgba components. Decomposition uses the fractional part after multiplying\n  // by a power of 256 (this removes the bits that are represented in the previous\n  // component) and then converts the fractional part to 8bits.\n  vec4 fixedPointU8 = floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\n\n  // Convert uint8 values (from 0 to 255) to floating point representation for\n  // the shader\n  const float toU8AsFloat = 1.0 / 255.0;\n\n  return fixedPointU8 * toU8AsFloat;\n}\n\n// Factors to convert rgba back to float\nconst vec4 rgba2float_factors = vec4(\n  255.0 / (256.0),\n  255.0 / (256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\n\nfloat rgba2float(vec4 rgba) {\n  // Convert components from 0->1 back to 0->255 and then\n  // add the components together with their corresponding\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n  return dot(rgba, rgba2float_factors);\n}\n","fsPrecision.glsl":"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif\n","highlight.glsl":"vec4 highlightData(vec4 fragCoord, sampler2D depthTex, vec4 viewportPixelSize) {\n  float sceneDepth = texture2D(depthTex, (fragCoord.xy - viewportPixelSize.xy) * viewportPixelSize.zw).r;\n  if (fragCoord.z > sceneDepth + 5e-7) {\n    return vec4(1.0, 1.0, 0.0, 1.0);\n  }\n  else {\n    return vec4(1.0, 0.0, 1.0, 1.0);\n  }\n}\n","hud.glsl":"#include <util/screenSizePerspective.glsl>\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 auxpos1;\n\nuniform mat4 proj;\n\nuniform mat4 view;\nuniform mat4 viewNormal;\n\nuniform mat4 model;\nuniform mat4 modelNormal;\n\nuniform vec4 viewport;\n\nuniform vec3 camPos;\n\nuniform float polygonOffset;\nuniform float cameraGroundRelative;\nuniform float pixelRatio;\n\nuniform float perDistancePixelRatio;\n\n#ifdef VERTICAL_OFFSET\n\n// [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\nuniform vec4 verticalOffset;\n\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n// [ divisor, offset, minPixelSize, paddingPixels ]\nuniform vec4 screenSizePerspectiveAlignment;\n\n#endif\n\nuniform sampler2D hudVisibilityTexture;\n\n\n// Corresponds to cos(10 deg), used to compare against dot product of two vectors\nconst float SMALL_OFFSET_ANGLE = 0.984807753012208;\n\nstruct ProjectHUDAux {\n  vec3 posModel;\n  vec3 posView;\n  vec3 vnormal;\n\n  float distanceToCamera;\n  float absCosAngle;\n};\n\n\n/**\n  * Apply the simulated polygon offset for HUD objects that improves\n  * issues with Z-fighting.\n  *\n  * @param posView {vec3} (inout) the position in view space. Will be modified in place.\n  * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\n  * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\n  *   and the view direction.\n  *\n  * Dependencies:\n  *\n  *   Attributes:\n  *     - auxpos1: contains centerOffset and pointGroundDistance\n  *\n  *   Uniforms:\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n  *         reduced flickering.\n  *     - viewport: the viewport [x, y, width, height]\n  */\nfloat applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n  float pointGroundSign = sign(pointGroundDistance);\n\n  if (pointGroundSign == 0.0) {\n    pointGroundSign = cameraGroundRelative;\n  }\n\n  // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n  // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n  float groundRelative = cameraGroundRelative * pointGroundSign;\n\n  // view angle dependent part of polygon offset emulation\n  // we take the absolute value because the sign that is dropped is\n  // instead introduced using the ground-relative position of the symbol and the camera\n  if (polygonOffset > .0) {\n    float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n    float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n    float factor = (1.0 - tanAlpha / viewport[2]);\n\n    // same side of the terrain\n    if (groundRelative > 0.0) {\n      posView *= factor;\n    }\n    // opposite sides of the terrain\n    else {\n      posView /= factor;\n    }\n  }\n\n  return groundRelative;\n}\n\n/**\n * Apply small vertical offset along world normal to reduce flickering. The offset\n * is distance based is approximately half of a pixel in the plane parallel to the\n * view at the HUD origin.\n *\n * @param normalModel {vec3} the normal in model/world space.\n * @param posModel {vec3} (inout) the position in model/world space. This value will\n *   be updated with the additional vertical offset.\n * @param posView {vec3} (inout) the position in view space. This value is used to\n *   determine the distance to the HUD origin and will also be updated with the\n *   additional vertical offset.\n *\n * Dependencies:\n *\n *   Uniforms:\n *     - perDistancePixelRatio: world units per distance per pixel.\n *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n *     - viewNormal: the view normal transformation.\n */\nvoid applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n  float distanceToCamera = length(posView);\n\n  // Compute offset in world units for a half pixel shift\n  float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n  // Apply offset along normal in the direction away from the ground surface\n  vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n  // Apply the same offset also on the view space position\n  vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n  posModel += modelOffset;\n  posView += viewOffset;\n}\n\n/**\n  * Project the 3d position of a HUD object from world space to clip space. In addition\n  * to standard model view projection, it also emulates a polygon offset to\n  * help with points above/below ground and icon flickering. The resulting location\n  * is the anchor of the HUD object, i.e. the position that is used also for testing\n  * visibility of the HUD object. Note that the returned projected position is not\n  * aligned to a pixel center or border, it is up to the caller to align if necessary.\n  *\n  * Dependencies:\n  *\n  *   Attributes:\n  *     - position: contains the point world position\n  *     - normal: contains the world normal pointing up at the point\n  *     - auxpos1: contains centerOffset and pointGroundDistance\n  *\n  *   Uniforms:\n  *     - model: the object -> world transformation matrix\n  *     - modelNormal: the object -> world normal transformation matrix (inv transp of model)\n  *     - view: the world -> view transformation matrix\n  *     - viewNormal: the world -> view normal transformation matrix (inv transp of view)\n  *     - proj: the view -> clip projection matrix\n  *     - verticalOffset: a vec4 containing:\n  *         - the screen height of the vertical offset\n  *         - the screen height of the vertical offset as a fraction of camera distance.\n  *         - the minimum world size vertical offset.\n  *         - the maximum world size vertical offset.\n  *       This will do a screen sized offset of the point along its normal (used for line callouts)\n  *     - screenSizePerspectiveAlignment: a vec3 containing\n  *         - the view distance dependent divisor\n  *         - the view distance dependent offset\n  *         - the minimum pixel size\n  *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n  *         reduced flickering.\n  *     - camPos: the position of the camera in world space\n  *     - viewport: the viewport [x, y, width, height]\n  */\nvec4 projectPositionHUD(out ProjectHUDAux aux) {\n  // centerOffset is in view space and is used to implement world size offsetting\n  // of labels with respect to objects. It also pulls the label towards the viewer\n  // so that the label is visible in front of the object.\n  vec3 centerOffset = auxpos1.xyz;\n\n  // The pointGroundDistance is the distance of the geometry to the ground and is\n  // negative if the point is below the ground, or positive if the point is above\n  // ground.\n  float pointGroundDistance = auxpos1.w;\n\n  aux.posModel = (model * vec4(position, 1.0)).xyz;\n  aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n  aux.vnormal = (modelNormal * vec4(normal, 1.0)).xyz;\n\n  applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n  // Screen sized offset in world space, used for example for line callouts\n  // Note: keep this implementation in sync with the CPU implementation, see\n  //   - MaterialUtil.verticalOffsetAtDistance\n  //   - HUDMaterial.applyVerticalOffsetTransformation\n\n  aux.distanceToCamera = length(aux.posView);\n\n  vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n  float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n  aux.absCosAngle = abs(cosAngle);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\n  vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\n#endif\n\n#endif\n\n#ifdef VERTICAL_OFFSET\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\n#else\n  float verticalOffsetScreenHeight = verticalOffset.x;\n#endif\n\n  float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n  vec3 modelOffset = aux.vnormal * worldOffset;\n\n  aux.posModel += modelOffset;\n\n  vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n  aux.posView += viewOffset;\n\n  // Since we elevate the object, we need to take that into account\n  // in the distance to ground\n  pointGroundDistance += worldOffset;\n\n#endif\n\n  float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n#ifndef CENTER_OFFSET_UNITS_SCREEN\n  // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n  aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n  // Same material all have same z != 0.0 condition so should not lead to\n  // branch fragmentation and will save a normalization if it's not needed\n  if (centerOffset.z != 0.0) {\n    aux.posView -= normalize(aux.posView) * centerOffset.z;\n  }\n#endif\n\n  vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n#ifdef CENTER_OFFSET_UNITS_SCREEN\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\n#else\n  float centerOffsetY = centerOffset.y;\n#endif\n\n  posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;\n\n#endif\n\n  // constant part of polygon offset emulation\n  posProj.z -= groundRelative * polygonOffset * posProj.w;\n\n  return posProj;\n}\n\nuniform float uRenderTransparentlyOccludedHUD;\n\n/**\n  * Test for visibility of a HUD object.\n  *\n  * Dependencies:\n  *\n  *   Uniforms:\n  *     - hudVisibilityTexture: the texture that contains the visibility information\n  *     - markerColor: the special marker color that is used to write visibility information\n  *     - viewport: the viewport\n  */\nbool testVisibilityHUD(vec4 posProj) {\n  // For occlusion testing, use the nearest pixel center to avoid\n  // subpixel filtering messing up the color we use to test for\n  vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n  vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n  // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n  // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n  // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n  // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n  if (uRenderTransparentlyOccludedHUD > 0.5) {\n    // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n    // uRenderTransparentlyOccludedHUD = 0.75\n    return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n  }\n  // and visible pixels that are not occluded by semi-transparent geometry here\n  else {\n    return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n  }\n\n  // return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r > 0.0;\n}\n","normalEncoding.glsl":"vec3 decodeNormal(vec2 f) {\n    float z = 1.0 - abs(f.x) - abs(f.y);\n    return vec3(f + sign(f) * min(z, 0.0), z);\n}\n","quad.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(position.x, position.y, .0, 1.0);\n  uv = position * .5 + vec2(.5);\n}\n","sceneLighting.glsl":"// Scene Lighting Definitions:\n// ================================\n\n// defines:\n//   - SH_ORDER: 1|2|3\n// input:\n//   - normal: vec3\n//   - albedo: vec3\n//   - shadow: float\n//   - ssao: float\n// return:\n//   - color: vec3\n\n// main light\n/////////////////////////////////////////\nuniform vec3 lightingMainDirection;\nuniform vec3 lightingMainIntensity;\n\n// ambient lighting\n/////////////////////////////////////////\n#ifndef SH_ORDER\n  #define SH_ORDER 2\n#endif\n\n#if SH_ORDER == 0\n  uniform vec3 lightingAmbientSH0;\n#elif SH_ORDER == 1\n  uniform vec4 lightingAmbientSH_R;\n  uniform vec4 lightingAmbientSH_G;\n  uniform vec4 lightingAmbientSH_B;\n#elif SH_ORDER == 2\n  uniform vec3 lightingAmbientSH0;\n  uniform vec4 lightingAmbientSH_R1;\n  uniform vec4 lightingAmbientSH_G1;\n  uniform vec4 lightingAmbientSH_B1;\n  uniform vec4 lightingAmbientSH_R2;\n  uniform vec4 lightingAmbientSH_G2;\n  uniform vec4 lightingAmbientSH_B2;\n#endif\n\n// special tweaking\n//////////////////////////////////////////\nuniform float lightingFixedFactor;\nuniform float lightingGlobalFactor;\n\nuniform float ambientBoostFactor;\n\n// evaluation\n//////////////////////////////////////////\n\nvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n  // evaluate the main light\n  #if defined(TREE_RENDERING)\n    // Special case for tree rendering:\n    // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n    // facing away from the light. The idea is to get an effect where light is transmitted\n    // through the tree.\n    float minDot = -0.5;\n    float dotRange = 1.0 - minDot;\n    float dotNormalization = 0.66; // guessed & hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n    float dotVal = dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n  #else\n    float dotVal = clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n  #endif\n\n  // move lighting towards (1.0, 1.0, 1.0) if requested\n  dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n  vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;\n\n  // evaluate the sh ambient light\n  #if SH_ORDER == 0\n    vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n  #elif SH_ORDER == 1\n    vec4 sh0 = vec4(\n      0.282095,\n      0.488603 * normal.x,\n      0.488603 * normal.z,\n      0.488603 * normal.y\n    );\n    vec3 ambientLight = vec3(\n      dot(lightingAmbientSH_R, sh0),\n      dot(lightingAmbientSH_G, sh0),\n      dot(lightingAmbientSH_B, sh0)\n    );\n  #elif SH_ORDER == 2\n    vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n\n    vec4 sh1 = vec4(\n      0.488603 * normal.x,\n      0.488603 * normal.z,\n      0.488603 * normal.y,\n      1.092548 * normal.x * normal.y\n    );\n    vec4 sh2 = vec4(\n      1.092548 * normal.y * normal.z,\n      0.315392 * (3.0 * normal.z * normal.z - 1.0),\n      1.092548 * normal.x * normal.z,\n      0.546274 * (normal.x * normal.x - normal.y * normal.y)\n    );\n    ambientLight += vec3(\n      dot(lightingAmbientSH_R1, sh1),\n      dot(lightingAmbientSH_G1, sh1),\n      dot(lightingAmbientSH_B1, sh1)\n    );\n    ambientLight += vec3(\n      dot(lightingAmbientSH_R2, sh2),\n      dot(lightingAmbientSH_G2, sh2),\n      dot(lightingAmbientSH_B2, sh2)\n    );\n  #endif\n  ambientLight *= (1.0 - ssao);\n\n  // inverse gamma correction on the albedo color\n  float gamma = 2.1;\n  vec3 albedoGammaC = pow(albedo, vec3(gamma));\n\n  // physically correct BRDF normalizes by PI\n  const float PI = 3.14159;\n  vec3 totalLight = mainLight + ambientLight + additionalLight;\n  totalLight = min(totalLight, vec3(PI, PI, PI));\n  vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));\n\n  // apply gamma correction to the computed color\n  outColor = pow(outColor, vec3(1.0/gamma));\n\n  return outColor;\n}\n\nvec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\n  // heuristic lighting model originally used in the terrain shading\n  // now used to generated additional ambient light\n\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n    float vndl = -dot(normalize(worldPos), lightingMainDirection);\n#else\n    float vndl = -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n#endif\n\n  additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n  return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n}\n","screenSizePerspective.glsl":"// Note that the implementation here should be kept in sync with the corresponding\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\n\n/**\n * Compute the screen size perspective lower bound from pre-computed screen\n * size perspective factors (or parameters, since both store the pixel lower\n * bound information in the same place). When computing the minimum size,\n * the padding (e.g. text halo) is scaled with the same factor as the\n * original size scales to reach the minimum size.\n *\n * {\n *    x: N/A\n *    y: N/A\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\n\n  // Original calculation:\n  //   padding = 2 * factor.w\n  //   minSize = factor.z\n  //\n  //   minSize + minSize / size * padding\n  //\n  // Incorporates padding (factor.w, e.g. text halo size) into the\n  // minimum bounds calculation, taking into account that padding\n  // would scale down proportionally to the size.\n  //\n  // Calculation below is the same, but avoids division by zero when\n  // size would be zero, without branching using step.\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\n\n  // nonZeroSize is 1 if size > 0, and 0 otherwise\n  float nonZeroSize = 1.0 - step(size, 0.0);\n\n  return (\n    factor.z * (\n      1.0 +\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                   // proportionally scaled padding\n      2.0 * factor.w / (\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n      )\n    )\n  );\n}\n\n/**\n * Computes the view angle dependent screen size perspective factor. The goal\n * of this factor is that:\n *\n *   1. There is no perspective when looking top-down\n *   2. There is a smooth and quick transition to full perspective when\n *      tilting.\n */\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n  return absCosAngle * absCosAngle * absCosAngle;\n}\n\n/**\n * Precomputes a set of factors that can be used to apply screen size perspective\n * The factors are based on the viewing angle, distance to camera and the screen size\n * perspective parameters:\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n *\n * The result is a set of factors that can be used to apply the perspective:\n *\n * {\n *    x: distance based relative scale factor (0 -> 1)\n *    y: view dependent scale factor\n *    z: minPixelSize (abs)\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n}\n\n/**\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\n */\n\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}\n\n/**\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n\n/**\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\n */\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n}\n\n/**\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n","shadow.glsl":'#include <util/encoding.glsl>\n\n// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\n// once IE11 is fine with it, const should probably be re-introduced\nfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\n  //choose correct cascade\n  int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n  if (i >= num) { return .0; }\n\n  mat4 mat = i == 0 ? matrix[0] : i == 1 ? matrix[1] : i == 2 ? matrix[2] : matrix[3];\n\n  vec4 lv = mat * vec4(vpos, 1.0);\n  lv.xy /= lv.w;\n\n  //vertex completely outside? -> no shadow\n  vec3 lvpos = .5 * lv.xyz + vec3(.5);\n  if (lvpos.z >= 1.0) { return .0; }\n  if (lvpos.x < .0 || lvpos.x > 1.0 || lvpos.y < .0 || lvpos.y > 1.0) { return .0; }\n\n  //calc coord in cascade texture\n  vec2 uv = vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\n\n  float texSize = .5 / halfPxSz;\n\n  //filter, offset by half pixels\n  vec2 st = fract((vec2(halfPxSz) + uv) * texSize);\n\n  float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) < lvpos.z ? 1.0 : .0;\n  float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) < lvpos.z ? 1.0 : .0;\n  float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) < lvpos.z ? 1.0 : .0;\n  float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) < lvpos.z ? 1.0 : .0;\n\n  return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}\n',"slice.glsl":"#ifdef SLICE\nuniform vec3 slicePlaneOrigin;\nuniform vec3 slicePlaneBasis1;\nuniform vec3 slicePlaneBasis2;\n\nstruct SliceFactors {\n  float front;\n  float side0;\n  float side1;\n  float side2;\n  float side3;\n};\n\nSliceFactors calculateSliceFactors(vec3 pos) {\n  vec3 rel = pos - slicePlaneOrigin;\n\n  vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n  float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n  float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n  float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n  float basis1Dot = dot(slicePlaneBasis1, rel);\n  float basis2Dot = dot(slicePlaneBasis2, rel);\n\n  return SliceFactors(\n    dot(slicePlaneNormal, pos) + slicePlaneW,\n    -basis1Dot - basis1Len2,\n    basis1Dot - basis1Len2,\n    -basis2Dot - basis2Len2,\n    basis2Dot - basis2Len2\n  );\n}\n\nbool sliceByFactors(SliceFactors factors) {\n  return factors.front < 0.0\n    && factors.side0 < 0.0\n    && factors.side1 < 0.0\n    && factors.side2 < 0.0\n    && factors.side3 < 0.0;\n}\n\nbool sliceByPlane(vec3 pos) {\n  return sliceByFactors(calculateSliceFactors(pos));\n}\n\n#ifdef EXTENSIONS_ENABLED\n\nvec4 applySliceHighlight(vec4 color, vec3 pos) {\n  SliceFactors factors = calculateSliceFactors(pos);\n\n  if (sliceByFactors(factors)) {\n    return color;\n  }\n\n  const float HIGHLIGHT_WIDTH = 1.0;\n  const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n  factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n  factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n  factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n  factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n  factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n  float highlightFactor = (1.0 - step(0.5, factors.front))\n    * (1.0 - step(0.5, factors.side0))\n    * (1.0 - step(0.5, factors.side1))\n    * (1.0 - step(0.5, factors.side2))\n    * (1.0 - step(0.5, factors.side3));\n\n  return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n}\n\n#else // EXTENSIONS_ENABLED\n\n// GL_OES_standard_derivatives must be enabled for applySliceHighlight\n\n#endif // EXTENSIONS_ENABLED\n\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n#define highlightSlice(_color_, _pos_) applySliceHighlight(_color_, _pos_)\n\n#else // SLICE\n\n#define rejectBySlice(_pos_) false\n#define discardBySlice(_pos_) {}\n#define highlightSlice(_color_, _pos_) (_color_)\n\n#endif // SLICE\n","visualVariables.glsl":"#if defined(VV_SIZE)\n  #define VV_CUSTOM_MODEL_MATRIX\n#endif\n\n#if defined(VV_SIZE)\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  uniform vec3 vvSizeValue;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform mat3 vvSymbolRotationMatrix;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform vec3 vvSymbolAnchor;\n#endif\n\n#ifdef VV_COLOR\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n#endif\n\n// Evaluation of size\n#if defined(VV_SIZE)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n  }\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return vvSizeValue;\n  }\n#endif\n\n// Applying the model matrix\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\n    return vec4(vvSymbolRotationMatrix * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n  }\n\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\n    // Normal transform is the inverse transpose of model transform\n    return vec4(vvSymbolRotationMatrix * normal / vvGetScale(featureAttribute), 1.0);\n  }\n#endif\n\n#ifdef VV_COLOR\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n    float value = featureAttribute.y;\n    if (value <= values[0]) {\n      return colors[0];\n    }\n\n    for (int i = 1; i < VV_COLOR_N; ++i) {\n      if (values[i] >= value) {\n        float f = (value - values[i-1]) / (values[i] - values[i-1]);\n        return mix(colors[i-1], colors[i], f);\n      }\n    }\n\n    return colors[VV_COLOR_N - 1];\n  }\n#endif\n","vsPrecision.glsl":"precision highp float;\nprecision highp sampler2D;\n"}}}.apply(null,i))||(e.exports=r)},VfPl:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("xhoE"),n("pIuP"),n("fHyw"),n("zlCF"),n("bduU"),n("hQPx"),n("MI3s")],void 0===(r=function(e,t,n,i,r,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float32Array,t,n,i,r)||this;return o.elementType="f32",o}return n(t,e),t.ElementType="f32",t}(o.BufferViewScalarImpl);t.BufferViewFloat=c;var u=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float32Array,t,n,i,r)||this;return o.elementType="f32",o}return n(t,e),t.ElementType="f32",t}(a.BufferViewVec2Impl);t.BufferViewVec2f=u;var d=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float32Array,t,n,i,r)||this;return o.elementType="f32",o}return n(t,e),t.ElementType="f32",t}(s.BufferViewVec3Impl);t.BufferViewVec3f=d;var f=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float32Array,t,n,i,r)||this;return o.elementType="f32",o}return n(t,e),t.ElementType="f32",t}(l.BufferViewVec4Impl);t.BufferViewVec4f=f;var p=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float32Array,t,n,i,r)||this;return o.elementType="f32",o}return n(t,e),t.ElementType="f32",t}(i.BufferViewMat3Impl);t.BufferViewMat3f=p;var h=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float64Array,t,n,i,r)||this;return o.elementType="f64",o}return n(t,e),t.ElementType="f64",t}(i.BufferViewMat3Impl);t.BufferViewMat3f64=h;var v=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float32Array,t,n,i,r)||this;return o.elementType="f32",o}return n(t,e),t.ElementType="f32",t}(r.BufferViewMat4Impl);t.BufferViewMat4f=v;var g=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float64Array,t,n,i,r)||this;return o.elementType="f64",o}return n(t,e),t.ElementType="f64",t}(r.BufferViewMat4Impl);t.BufferViewMat4f64=g;var m=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float64Array,t,n,i,r)||this;return o.elementType="f64",o}return n(t,e),t.ElementType="f64",t}(o.BufferViewScalarImpl);t.BufferViewFloat64=m;var y=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float64Array,t,n,i,r)||this;return o.elementType="f64",o}return n(t,e),t.ElementType="f64",t}(a.BufferViewVec2Impl);t.BufferViewVec2f64=y;var b=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float64Array,t,n,i,r)||this;return o.elementType="f64",o}return n(t,e),t.ElementType="f64",t}(s.BufferViewVec3Impl);t.BufferViewVec3f64=b;var x=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Float64Array,t,n,i,r)||this;return o.elementType="f64",o}return n(t,e),t.ElementType="f64",t}(l.BufferViewVec4Impl);t.BufferViewVec4f64=x;var _=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint8Array,t,n,i,r)||this;return o.elementType="u8",o}return n(t,e),t.ElementType="u8",t}(o.BufferViewScalarImpl);t.BufferViewUint8=_;var S=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint8Array,t,n,i,r)||this;return o.elementType="u8",o}return n(t,e),t.ElementType="u8",t}(a.BufferViewVec2Impl);t.BufferViewVec2u8=S;var w=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint8Array,t,n,i,r)||this;return o.elementType="u8",o}return n(t,e),t.ElementType="u8",t}(s.BufferViewVec3Impl);t.BufferViewVec3u8=w;var T=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint8Array,t,n,i,r)||this;return o.elementType="u8",o}return n(t,e),t.ElementType="u8",t}(l.BufferViewVec4Impl);t.BufferViewVec4u8=T;var E=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint16Array,t,n,i,r)||this;return o.elementType="u16",o}return n(t,e),t.ElementType="u16",t}(o.BufferViewScalarImpl);t.BufferViewUint16=E;var P=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint16Array,t,n,i,r)||this;return o.elementType="u16",o}return n(t,e),t.ElementType="u16",t}(a.BufferViewVec2Impl);t.BufferViewVec2u16=P;var C=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint16Array,t,n,i,r)||this;return o.elementType="u16",o}return n(t,e),t.ElementType="u16",t}(s.BufferViewVec3Impl);t.BufferViewVec3u16=C;var A=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint16Array,t,n,i,r)||this;return o.elementType="u16",o}return n(t,e),t.ElementType="u16",t}(l.BufferViewVec4Impl);t.BufferViewVec4u16=A;var O=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint32Array,t,n,i,r)||this;return o.elementType="u32",o}return n(t,e),t.ElementType="u32",t}(o.BufferViewScalarImpl);t.BufferViewUint32=O;var R=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint32Array,t,n,i,r)||this;return o.elementType="u32",o}return n(t,e),t.ElementType="u32",t}(a.BufferViewVec2Impl);t.BufferViewVec2u32=R;var M=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint32Array,t,n,i,r)||this;return o.elementType="u32",o}return n(t,e),t.ElementType="u32",t}(s.BufferViewVec3Impl);t.BufferViewVec3u32=M;var D=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Uint32Array,t,n,i,r)||this;return o.elementType="u32",o}return n(t,e),t.ElementType="u32",t}(l.BufferViewVec4Impl);t.BufferViewVec4u32=D;var I=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int8Array,t,n,i,r)||this;return o.elementType="i8",o}return n(t,e),t.ElementType="i8",t}(o.BufferViewScalarImpl);t.BufferViewInt8=I;var L=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int8Array,t,n,i,r)||this;return o.elementType="i8",o}return n(t,e),t.ElementType="i8",t}(a.BufferViewVec2Impl);t.BufferViewVec2i8=L;var V=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int8Array,t,n,i,r)||this;return o.elementType="i8",o}return n(t,e),t.ElementType="i8",t}(s.BufferViewVec3Impl);t.BufferViewVec3i8=V;var F=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int8Array,t,n,i,r)||this;return o.elementType="i8",o}return n(t,e),t.ElementType="i8",t}(l.BufferViewVec4Impl);t.BufferViewVec4i8=F;var B=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int16Array,t,n,i,r)||this;return o.elementType="i16",o}return n(t,e),t.ElementType="i16",t}(o.BufferViewScalarImpl);t.BufferViewInt16=B;var N=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int16Array,t,n,i,r)||this;return o.elementType="i16",o}return n(t,e),t.ElementType="i16",t}(a.BufferViewVec2Impl);t.BufferViewVec2i16=N;var z=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int16Array,t,n,i,r)||this;return o.elementType="i16",o}return n(t,e),t.ElementType="i16",t}(s.BufferViewVec3Impl);t.BufferViewVec3i16=z;var U=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int16Array,t,n,i,r)||this;return o.elementType="i16",o}return n(t,e),t.ElementType="i16",t}(l.BufferViewVec4Impl);t.BufferViewVec4i16=U;var j=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int32Array,t,n,i,r)||this;return o.elementType="i32",o}return n(t,e),t.ElementType="i32",t}(o.BufferViewScalarImpl);t.BufferViewInt32=j;var G=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int32Array,t,n,i,r)||this;return o.elementType="i32",o}return n(t,e),t.ElementType="i32",t}(a.BufferViewVec2Impl);t.BufferViewVec2i32=G;var H=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int32Array,t,n,i,r)||this;return o.elementType="i32",o}return n(t,e),t.ElementType="i32",t}(s.BufferViewVec3Impl);t.BufferViewVec3i32=H;var k=function(e){function t(t,n,i,r){void 0===n&&(n=0);var o=e.call(this,Int32Array,t,n,i,r)||this;return o.elementType="i32",o}return n(t,e),t.ElementType="i32",t}(l.BufferViewVec4Impl);t.BufferViewVec4i32=k}.apply(null,i))||(e.exports=r)},W0kZ:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){return function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}()}.apply(null,i))||(e.exports=r)},W5Zm:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,n){for(var i=e.typedBuffer,r=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=n?n.count:t.count,l=(n&&n.dstIndex?n.dstIndex:0)*r,c=(n&&n.srcIndex?n.srcIndex:0)*a,u=0;u<s;++u)i[l]=o[c],i[l+1]=o[c+1],i[l+2]=o[c+2],l+=r,c+=a}}.apply(null,i))||(e.exports=r)},W7eI:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("MzcX"),n("2B1V")],void 0===(r=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeInputBufferLayout=i.newLayout().vec3f("position").u16("componentIndex").u16("_padding"),t.VertexLayout=i.newLayout().vec2u8("sideness"),t.glVertexLayout=n.glLayout(t.VertexLayout,{prefixA:!0}),t.CommonInstancesLayout=i.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0}),t.RegularEdgeInstancesLayout=t.CommonInstancesLayout.clone().vec3f("normal"),t.SilhouetteEdgeInstancesLayout=t.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB"),t.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}.apply(null,i))||(e.exports=r)},WsO6:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("9opi"),n("qKT0"),n("BcWh"),n("7MDj"),n("NfRO"),n("qsST"),n("SZNs"),n("qMld"),n("Vx27")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u){return function(e){function t(t){var n=e.call(this)||this;return n.layer=null,n.parent=null,n.view=null,n}return n(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var n=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";return s.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+i+"', id: '"+n+"')",t),c.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},i([u.property()],t.prototype,"layer",void 0),i([u.property()],t.prototype,"parent",void 0),i([u.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),i([u.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),i([u.property()],t.prototype,"view",void 0),i([u.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),i([u.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),i([u.subclass("esri.views.layers.LayerView")],t)}(u.declared(o,r,a.Identifiable,l))}.apply(null,i))||(e.exports=r)},XCS5:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("xoE+")],void 0===(r=function(e,t,n){return function(){function e(e){null==e?e=16:e<65536&&(e=n.nextHighestPowerOfTwo(e)),this.array=new Float32Array(e),this.size=0}return e.prototype.resize=function(e,t){var n,i;if(void 0===t&&(t=!1),this.size=e,this.size>this.array.length){for(n=this.array.length||1;n<this.size;)n*=2;return i=new Float32Array(n),t&&i.set(this.array),this.array=i,!0}if(this.size<=this.array.length/2){n=this.array.length;for(var r=2*this.size;n>=r;)n=Math.floor(n/2);return i=new Float32Array(n),t&&i.set(this.array.subarray(0,n)),this.array=i,!0}return!1},e.prototype.append=function(e){var t=this.size;this.resize(this.size+e.length,!0),this.array.set(e,t)},e.prototype.erase=function(e,t){for(var n=e;n<t;++n)this.array[n]=0},e.prototype.getArray=function(){return this.array},e.prototype.getSize=function(){return this.size},e}()}.apply(null,i))||(e.exports=r)},Xih7:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("KY0m"),n("9sIV"),n("05NA"),n("CIy2")],void 0===(r=function(e,t,n,i,r,o){return function(){function e(e){this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyMaterials=new Set,this._model=e}return Object.defineProperty(e.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"residentObjectCount",{get:function(){var e=0;return this._residentGeomRecords.forEach(function(t){e+=t.size}),e},enumerable:!0,configurable:!0}),e.prototype.getDirtyMaterials=function(){return this._dirtyMaterials.size>0?this._dirtyMaterials:null},e.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()},e.prototype.hasDirtyGeometryRecords=function(){var e=!1;return i.everyMap(this._dirtyGeomRecords,function(t){if(e)return!1;i.everyMap(t,function(t){if(!e&&t&&t.size>0)return e=!0,!1})}),e},e.prototype.handleUpdate=function(e,t,n){return o.assert(this[t],"ModelDirtySet doesn't know how to process "+t),this[t](e,n)},e.prototype.shaderTransformationChanged=function(e){var t=this,n=this._residentGeomRecords.get(e.id);n&&n.forEach(function(e,n){var i=t._model.content[r.OBJECT][n];i&&i.hasVolativeTransformation()&&e.forEach(function(e){for(var t=0,n=e[1];t<n.length;t++)n[t].shaderTransformationChanged()})})},e.prototype.commit=function(){return this.commitLayers(n.keysOfMap(this._dirtyGeomRecords))},e.prototype.commitLayers=function(e){for(var t=this,n=[],i=[],a=[],s=this,l=0;l<e.length;l++)!function(l){var c=e[l],u=s._dirtyGeomRecords.get(c);if(!u)return"continue";u.forEach(function(e,s){var l=t._ensureGeomRecord(c,s);e.forEach(function(e,c){var u,d=e[0],f=e[1],p=e[2],h=!1;if(2&f)if(u=l.get(c)){var v=u[1];if(4&p)for(var g=t._model.get(r.OBJECT,s),m=0,y=v;m<y.length;m++){var b=y[m];if(t._model.updateRenderGeometryTransformation(g,d,b)){h=!0;break}}if(!h)for(var x=0,_=v;x<_.length;x++){b=_[x];a.push({renderGeometry:b,updateType:p})}}else o.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update");(4&f||h)&&((u=l.get(c))?i.push.apply(i,u[1]):4===f&&o.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),u&&l.delete(c));if(1&f||h){var S=[d,[]];g=t._model.get(r.OBJECT,s);t._model.getGeometryRenderGeometries(g,d,S[1]),n.push.apply(n,S[1]),l.set(c,S)}}),0===l.size&&t._residentGeomRecords.get(c).delete(s)}),0===s._residentGeomRecords.get(c).size&&s._residentGeomRecords.delete(c),s._dirtyGeomRecords.delete(c)}(l);return[n,i,a]},e.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(n.keysOfMap(this._residentGeomRecords))},e.prototype.getResidentRenderGeometriesFilteredByLayers=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],r=this._residentGeomRecords.get(i);r&&r.forEach(function(e){e.forEach(function(e){t.push.apply(t,e[1])})})}return t},e.prototype.visibilityChanged=function(e,t,n){if(null!=t)this._componentPropertyChanged(e,t,n,1);else for(var i=0,r=e.getGeometryRecords();i<r.length;i++){var o=r[i];this._componentPropertyChanged(e,o,n,1)}},e.prototype.componentHighlightChanged=function(e,t,n){if(null!=t)this._componentPropertyChanged(e,t,n,16);else for(var i=0,r=e.getGeometryRecords();i<r.length;i++){var o=r[i];this._componentPropertyChanged(e,o,n,16)}},e.prototype.vertexAttrsUpdated=function(e,t,n){this._updateOrCreateDirtyRecord(e,t,n,2,0,0,2,5,2)},e.prototype.matChanged=function(e){this._dirtyMaterials.add(e.id),this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.layerAdded=function(e){for(var t=e.getObjects(),n=0;n<t.length;n++)this.layObjectAdded(e,t[n])},e.prototype.layerRemoved=function(e){for(var t=e.getObjects(),n=0;n<t.length;n++)this.layObjectRemoved(e,t[n])},e.prototype.layObjectAdded=function(e,t){for(var n=e.id,i=t.getGeometryRecords(),r=0;r<i.length;r++)this.objGeometryAdded(t,i[r],n)},e.prototype.layObjectRemoved=function(e,t){for(var n=e.id,i=t.getGeometryRecords(),r=0;r<i.length;r++)this.objGeometryRemoved(t,i[r],n)},e.prototype.layObjectReplaced=function(e,t){this.layObjectRemoved(e,t[0]),this.layObjectAdded(e,t[1])},e.prototype.objTransformation=function(e,t){var n=this;t=t||this._getParentLayerId(e);var i=e.id;this._ensureGeomRecord(t,i).forEach(function(i){n._updateOrCreateDirtyRecord(e,i[0],t,2,0,0,2,5,4)})},e.prototype.objGeometryAdded=function(e,t,n){this._updateOrCreateDirtyRecord(e,t,n,1,4,0,0,0)},e.prototype.objGeometryRemoved=function(e,t,n){this._updateOrCreateDirtyRecord(e,t,n,4,1,2,0,0)},e.prototype.objGeometryReplaced=function(e,t){this.objGeometryRemoved(e,t[0]),this.objGeometryAdded(e,t[1])},e.prototype.objGeometryTransformation=function(e,t){this.objGeometryReplaced(e,t)},e.prototype._componentPropertyChanged=function(e,t,n,i){this._updateOrCreateDirtyRecord(e,t,n,2,0,0,2,5,i)},e.prototype._updateOrCreateDirtyRecord=function(e,t,n,i,r,a,s,l,c){n=n||this._getParentLayerId(e);var u=e.id,d=t.id,f=this._ensureDirtyRecord(n,u),p=f.get(d);if(p){var h=p[1];h&r?f.delete(d):h&a?(p[1]=i,p[2]=c):h&s?p[2]|=c:h&l||o.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")}else f.set(d,[t,i,c])},e.prototype._ensureGeomRecord=function(e,t){var n=this._residentGeomRecords.get(e);n||(n=new Map,this._residentGeomRecords.set(e,n));var i=n.get(t);return i||(i=new Map,n.set(t,i)),i},e.prototype._ensureDirtyRecord=function(e,t){var n=this._dirtyGeomRecords.get(e);n||(n=new Map,this._dirtyGeomRecords.set(e,n));var i=n.get(t);return i||(i=new Map,n.set(t,i)),i},e.prototype._getParentLayerId=function(e){return e.parentLayer.id},e.prototype.formatDebugInfo=function(e){if(e)return"";var t=["ADD","UPD",void 0,"REM"],n="";return this._dirtyGeomRecords.forEach(function(e,i){e.forEach(function(e,r){n.length>0&&(n+="\n"),n+=i+"."+r;var o=[];e.forEach(function(e){var t=e[1];o[t]||(o[t]=[]),o[t].push(e[0].geometry.id)});for(var a=0;a<o.length;a++)if(o[a]){n+=" "+t[a-1]+": ";for(var s=0;s<o[a].length;s++)n+=o[a][s]+", "}})}),n},e}()}.apply(null,i))||(e.exports=r)},"Yr/n":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("ff/U"),n("zbgD"),n("U+8K")],void 0===(r=function(e,t,n,i,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return r.glslifyDefineMap({OCCL_TEST:e.occlTest,SIGNED_DISTANCE_FIELD:e.sdf,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:e.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:e.binaryHighlightOcclusion,SLICE:e.slice})},a=function(e){return r.glslifyDefineMap({VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,SLICE:e.slice})};t.colorPass={name:"hud-color",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("materials/hud/hud.vert"),fragmentShader:o(e)+i.resolveIncludes("materials/hud/colorPass.frag")}},attributes:n.Default3D},t.highlightPass={name:"hud-highlight",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("materials/hud/hud.vert"),fragmentShader:o(e)+i.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:n.Default3D},t.occlusionPass={name:"hud-occlusion",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:i.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:n.Default3D}}.apply(null,i))||(e.exports=r)},ZJC8:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("AzkI"),n("rjU6"),n("Cvn+"),n("xsp2"),n("W0kZ"),n("05NA"),n("CIy2")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f){var p=f.assert,h=i.mat4f64.create(),v=function(){function e(t){void 0===t&&(t={}),this._objectTransformation=i.mat4f64.create(),this._bvObjectSpace=new g,this._bvWorldSpace=new g,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._allComponentsHiddenDirty=!0,this._allComponentsVisibleDirty=!0,this.id=e._idGen.gen(t.idHint),this.name=t.name,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.objectTransformation=i.mat4f64.create(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations,t.origins)}return Object.defineProperty(e.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(e){n.mat4.copy(this._objectTransformation,e),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},enumerable:!0,configurable:!0}),e.prototype._initializeGeometryRecords=function(e,t,n,r){if(!Array.isArray(e))return this.geometryRecords=[],void(this.geometries=[]);p(t.length===e.length,"Object3D: materials don't match geometries"),p(n.length===e.length,"Object3D: transformations don't match geometries"),this.geometryRecords=new Array(e.length),this.geometries=e.slice();for(var o=0;o<e.length;o++){this.geometryRecords[o]=new l(e[o],t[o],i.mat4f64.clone(n[o]),{},r&&r[o])}this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){p(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!0,configurable:!0}),e.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length},e.prototype.getFirstGeometryIndex=function(e){var t=this.geometries.indexOf(e);return p(t>-1,"Object3D.getFirstGeometryIndex: geometry not found"),t},e.prototype.findGeometryRecords=function(e){for(var t=[],n=0;n<this.geometries.length;n++)this.geometries[n]===e&&t.push(this.geometryRecords[n]);return t},e.prototype.getGeometryRecord=function(e){return p(e>=0&&e<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this.geometryRecords[e]},e.prototype.getGeometryRecords=function(){return this.geometryRecords},e.prototype.addGeometry=function(e,t,n,r,o,a){void 0===n&&(n=h),this.geometries.push(e);var s=new l(e,t,i.mat4f64.clone(n),r||{},o,a);return this.geometryRecords.push(s),this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.shaderTransformation}),this._notifyDirty("objGeometryAdded",s),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,this._allComponentsVisibleDirty=!0,s},e.prototype.hasGeometry=function(e){return this.geometries.indexOf(e)>-1},e.prototype.removeGeometry=function(e){var t=this.geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.shaderTransformation}),this.geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,this._allComponentsVisibleDirty=!0,t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[e]),this._invalidateBoundingVolume()},e.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1,this._allComponentsHidden=!0;for(var e=0,t=this.geometryRecords;e<t.length;e++){var n=t[e],i=n.instanceParameters.componentVisibilities,r=n.geometry.data.componentOffsets;if(!s.isAllHidden(i,r)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden},e.prototype.areAllComponentsVisible=function(){if(this._allComponentsVisibleDirty){this._allComponentsVisibleDirty=!1,this._allComponentsVisible=!0;for(var e=0,t=this.geometryRecords;e<t.length;e++){var n=t[e],i=n.instanceParameters.componentVisibilities,r=n.geometry.data.componentOffsets;if(!s.isAllVisible(i,r)){this._allComponentsVisible=!1;break}}}return this._allComponentsVisible},e.prototype.hasComponents=function(){for(var e=!1,t=0;t<this.geometries.length;t++){var n=this.geometries[t];if(e=s.hasComponents(n.data.componentOffsets))break}return e},e.prototype.setComponentVisibility=function(e,t,n){var i=e.geometry,r=e.instanceParameters.componentVisibilities,o=i.data.componentOffsets,a=s.updateVisibility(r,o,t,n);e.instanceParameters.componentVisibilities=a,this._notifyDirty("visibilityChanged",e),this._allComponentsHiddenDirty=!0,this._allComponentsVisibleDirty=!0},e.prototype.setHidden=function(e,t){e.instanceParameters.hidden=!!t,this._notifyDirty("visibilityChanged",e)},e.prototype.isHidden=function(e){return!!e.instanceParameters.hidden},e.prototype.getComponentVisibility=function(e,t){var n=e.instanceParameters.componentVisibilities;return s.getVisibility(n,t)},e.prototype.hideAllComponents=function(){if(this._allComponentsHiddenDirty||!this._allComponentsHidden){for(var e=0,t=this.geometryRecords;e<t.length;e++){var n=t[e],i=n.instanceParameters.componentVisibilities,r=s.hideAllComponents(i);n.instanceParameters.componentVisibilities=r}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!1,this._allComponentsVisibleDirty=!1,this._allComponentsHidden=!0,this._allComponentsVisible=!1}},e.prototype.unhideAllComponents=function(){if(this._allComponentsVisibleDirty||!this._allComponentsVisible){for(var e=0,t=this.geometryRecords;e<t.length;e++){var n=t[e],i=n.instanceParameters.componentVisibilities,r=s.unhideAllComponents(i);n.instanceParameters.componentVisibilities=r}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!1,this._allComponentsVisibleDirty=!1,this._allComponentsHidden=!1,this._allComponentsVisible=!0}},e.prototype._setComponentHighlight=function(e,t,n,i){var r=e.instanceParameters.componentHighlights,o=s.addHighlight(r,t,n,i);e.instanceParameters.componentHighlights=o},e.prototype.setComponentHighlight=function(e,t,n){var i=c.generateHighlightId();return this._setComponentHighlight(e,t,n,i),this._notifyDirty("componentHighlightChanged"),i},e.prototype.highlightAllComponents=function(e){for(var t=c.generateHighlightId(),n=0,i=this.geometryRecords;n<i.length;n++){var r=i[n];this._setComponentHighlight(r,null,e,t)}return this._notifyDirty("componentHighlightChanged"),t},e.prototype.removeHighlights=function(e){for(var t=0,n=this.geometryRecords;t<n.length;t++){var i=n[t].instanceParameters,r=i.componentHighlights,o=s.removeHighlight(r,e);i.componentHighlights=o}this._notifyDirty("componentHighlightChanged")},e.prototype.getComponentFromTriangleNr=function(e,t){p(e>=0&&e<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");var n=this.geometryRecords[e].geometry.data.componentOffsets;return s.componentFind(n,3*t)},e.prototype.setGeometryTransformation=function(e,t){p(e>=0&&e<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var n=this.geometryRecords[e],r=new l(n.geometry,n.material,i.mat4f64.clone(t),n.instanceParameters);this.geometryRecords[e]=r,this._notifyDirty("objGeometryReplaced",[n,r]),this._invalidateBoundingVolume()},e.prototype.getCombinedStaticTransformation=function(e,t){return t=t||i.mat4f64.create(),n.mat4.multiply(t,this.objectTransformation,e.getStaticTransformation()),t},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||i.mat4f64.create(),n.mat4.multiply(t,this.objectTransformation,e.getShaderTransformation()),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getCastShadow=function(){return this.castShadow},e.prototype.setCastShadow=function(e){this.castShadow=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.getName=function(){return this.name},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this.geometryRecords.length;++e){var t=this.geometries[e],n=this.geometryRecords[e],i=t.boundingInfo;this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,n.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this.getCombinedShaderTransformation(n))}r.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5),r.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);var s=o.vec3f64.create(),l=o.vec3f64.create(),c=a.maxScale(this.objectTransformation);for(e=0;e<this.geometryRecords.length;++e){t=this.geometries[e];var u=this.geometryRecords[e].getShaderTransformation(),d=a.maxScale(u);i=t.boundingInfo;r.vec3.transformMat4(s,i.getCenter(),u);var f=r.vec3.distance(s,this._bvObjectSpace.center),p=i.getBSRadius()*d;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,f+p),r.vec3.transformMat4(l,s,this.objectTransformation);var h=r.vec3.distance(l,this._bvWorldSpace.center),v=p*c;this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,h+v)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,n){var i=e.getBBMin(),a=e.getBBMax(),s=o.vec3f64.clone(i),l=o.vec3f64.clone(a);r.vec3.transformMat4(s,s,n),r.vec3.transformMat4(l,l,n);for(var c=0;c<3;++c)t.bbMin[c]=Math.min(t.bbMin[c],s[c],l[c]),t.bbMax[c]=Math.max(t.bbMax[c],s[c],l[c]);for(c=0;c<3;++c){r.vec3.copy(s,i),r.vec3.copy(l,a),s[c]=a[c],l[c]=i[c],r.vec3.transformMat4(s,s,n),r.vec3.transformMat4(l,l,n);for(var u=0;u<3;++u)t.bbMin[u]=Math.min(t.bbMin[u],s[u],l[u]),t.bbMax[u]=Math.max(t.bbMax[u],s[u],l[u])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,n,i){if(this._parentLayer){n=n||d.OBJECT;var r=i||this;this._parentLayer.notifyDirty(e,t,n,r)}},e._idGen=new u,e}(),g=function(){function e(){this.bbMin=o.vec3f64.create(),this.bbMax=o.vec3f64.create(),this.center=o.vec3f64.create(),this.bsRadius=0}return e.prototype.init=function(){r.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r.vec3.set(this.center,0,0,0),this.bsRadius=0},e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e}();return v}.apply(null,i))||(e.exports=r)},ZO6V:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("KY0m"),n("0LE5"),n("Rdxj"),n("W0kZ"),n("05NA"),n("mYMs")],void 0===(r=function(e,t,n,i,r,o,a,s){return function(){function e(t,n,i){this._parentStages=[],this._children=new Set,this.id=e._idGen.gen(t),this.apiLayerUid=i,this.name=t,n=n||{},this.group=n.group||"",this.isVisible=null==n.isVisible||n.isVisible,this.isPickable=null==n.isPickable||n.isPickable,this.isSliceable=!1,this.translation=n.translation?r.vec3f64.clone(n.translation):r.vec3f64.create(),this._extent=[r.vec3f64.fromValues(0,0,0),r.vec3f64.fromValues(1e3,1e3,1e3)],this._extentDirty=!0}return e.prototype.addParentStage=function(e){-1===this._parentStages.indexOf(e)&&this._parentStages.push(e)},e.prototype.removeParentStage=function(e){var t=this._parentStages.indexOf(e);t>-1&&this._parentStages.splice(t,1),this.invalidateSpatialQueryAccelerator()},e.prototype.getName=function(){return this.name},e.prototype.getGroup=function(){return this.group},e.prototype.getTranslation=function(){return this.translation},e.prototype.getObjectIds=function(){return n.keysOfSet(this._children,function(e){return e.id})},e.prototype.getObjects=function(){return n.keysOfSet(this._children)},e.prototype.getExtent=function(){return this._updateExtent(),this._extent},e.prototype.addObject=function(e){this._children.add(e),e.parentLayer=this,this.notifyDirty("layObjectAdded",e),this._invalidateExtent(),this._octree&&this._octree.add(e)},e.prototype.hasObject=function(e){return this._children.has(e)},e.prototype.removeObject=function(e){return!!this._children.delete(e)&&(e.parentLayer=null,this.notifyDirty("layObjectRemoved",e),this._invalidateExtent(),this._octree&&this._octree.remove(e),!0)},e.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},e.prototype.getCenter=function(){this._updateExtent();var e=r.vec3f64.create();return i.vec3.lerp(e,this._extent[0],this._extent[1],.5)},e.prototype.getBSRadius=function(){return this._updateExtent(),.5*i.vec3.distance(this._extent[0],this._extent[1])},e.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._children.size>50&&this._createOctree(),this._octree},e.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},e.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)},e.prototype.notifyDirty=function(e,t,n,i){n=n||a.LAYER;for(var r=i||this,o=0;o<this._parentStages.length;o++)this._parentStages[o].notifyDirty(n,r,e,t)},e.prototype._createOctree=function(){for(var e=this.getExtent(),t=0,o=0;o<3;o++)t=Math.max(t,e[1][o]-e[0][o]);var a=r.vec3f64.create();i.vec3.lerp(a,e[0],e[1],.5),this._octree=new s(a,1.2*t,{getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(n.keysOfSet(this._children))},e.prototype._invalidateExtent=function(){this._extentDirty=!0},e.prototype._updateExtent=function(){var e=this;if(this._extentDirty){if(this._extentDirty=!1,0===this._children.size)return void(this._extent=[[0,0,0],[0,0,0]]);var t=null;this._children.forEach(function(n){var i=n.getBBMin(),o=n.getBBMax();if(t)for(var a=0;a<3;++a)e._extent[0][a]=Math.min(e._extent[0][a],i[a]),e._extent[1][a]=Math.max(e._extent[1][a],o[a]);else t=[r.vec3f64.clone(i),r.vec3f64.clone(o)]}),this._extent=t}},e._idGen=new o,e}()}.apply(null,i))||(e.exports=r)},ZeO9:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("FXVB"),n("1m5D"),n("MzcX"),n("ff/U"),n("XCS5"),n("AASg"),n("CIy2"),n("pbva"),n("PwS/"),n("QFi0"),n("Kfys"),n("z2+Q")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p){function h(e,t,n,i){for(var r=new Map,o=t.vertexBufferLayout.stride/4,a=function(n,i){var a=n.origin,s=e.get(a.id),l=r.get(a.id);null==l&&(l={optimalCount:null==s?0:s.optimalCount,sparseCount:null==s?0:s.buffer.getSize(),toAdd:[],toRemove:[],origin:a.vec3},r.set(a.id,l));var c=t.elementCount(n.data)*o;i?(l.optimalCount+=c,l.sparseCount+=c,l.toAdd.push(n)):(l.optimalCount-=c,l.toRemove.push(n))},s=0,l=n;s<l.length;s++){a(l[s],!0)}for(var c=0,u=i;c<u.length;c++){a(u[c],!1)}return r}var v=function(){function e(e,t,n){this._dataByOrigin=new Map,this._highlightCount=0,this._rctx=e,this._material=n,this._materialRep=t,this._glMaterials=u.acquireMaterials(this._material,this._materialRep),this._bufferWriter=n.createBufferWriter()}return e.prototype.dispose=function(){u.releaseMaterials(this._material,this._materialRep)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlightCount>0},enumerable:!0,configurable:!0}),e.prototype.renderPriority=function(){return this._material.renderPriority},e.prototype.modify=function(e){var t=this,n=_;n.clear(),this.updateGeometries(e.toUpdate,n),this.addAndRemoveGeometries(e.toAdd,e.toRemove,n),this.updateHighlightCount(),n.forEach(function(e){return t.updateDisplayedIndexRanges(e)})},e.prototype.addAndRemoveGeometries=function(e,t,n){var i=this,r=this._material,o=this._bufferWriter,a=o.vertexBufferLayout,s=a.stride/4,c=this._dataByOrigin,u=h(c,o,e,t);u.forEach(function(e,t){u.delete(t);var o=e.optimalCount,d=e.sparseCount,f=c.get(t);if(null==f&&(l.assert(o>0),f=i.createData(a,o,e.origin),c.set(t,f)),0===o)return f.vao.dispose(!0),f.vao=null,void c.delete(t);var p=o<e.sparseCount/2,h=p?o:d,v=g,y=f.buffer.getSize(),b=f.buffer.getArray(),x=f.buffer.resize(h);p||x?i.removeAndRebuild(f,e.toRemove,s,b,v):e.toRemove.length>0?(i.removeByErasing(f,e.toRemove,s,v),e.toAdd.length>0&&(v.end=y)):(v.begin=y,v.end=y);var _=m;l.setMatrixTranslation3(_,-e.origin[0],-e.origin[1],-e.origin[2]),i.append(f,r,e.toAdd,s,_,v);var S=f.vao.vertexBuffers.geometry;if(S.byteSize!==f.buffer.getArray().buffer.byteLength)S.setData(f.buffer.getArray());else{var w=v.begin,T=v.end;if(w<T){var E=f.buffer.getArray(),P=4*w,C=4*T;S.setSubData(E,P,P,C)}}(v.updatedDisplayedIndexRange||f.displayedIndexRanges)&&n.add(f)})},e.prototype.updateGeometries=function(e,t){for(var n=this._bufferWriter,i=n.vertexBufferLayout.stride/4,r=0,o=e;r<o.length;r++){var a=o[r],s=a.updateType,c=a.renderGeometry,d=this._dataByOrigin.get(c.origin.id),f=d&&d.instances.get(c.uniqueName);if(!f)return;if(1&s&&(f.displayedIndexRange=u.generateRenderGeometryVisibleIndexRanges(c),t.add(d)),17&s&&(f.highlightedIndexRanges=u.generateRenderGeometryHighlightRanges(c),d.highlightCount=null),6&s){var p=d.buffer.getArray(),h=d.vao;u.calculateTransformRelToOrigin(c,y,b),n.write({transformation:y,invTranspTransformation:b},c.data,c.instanceParameters,n.vertexBufferLayout.createView(p.buffer),f.from),l.assert(f.from+n.elementCount(c.data)===f.to,"material VBO layout has changed"),h.vertexBuffers.geometry.setSubData(p,f.from*i*4,f.from*i*4,f.to*i*4)}}},e.prototype.updateDisplayedIndexRanges=function(e){var t=e.instances;e.displayedIndexRanges=[];var n=!0;t.forEach(function(t){t.displayedIndexRange?(e.displayedIndexRanges.push.apply(e.displayedIndexRanges,s.offsetIntervals(t.displayedIndexRange,t.from)),n=!1):e.displayedIndexRanges.push([t.from,t.to-1])}),e.displayedIndexRanges=n?null:s.mergeIntervals(e.displayedIndexRanges)},e.prototype.updateHighlightCount=function(){var e=this;this._highlightCount=0,this._dataByOrigin.forEach(function(t){if(null==t.highlightCount){var n=0;t.instances.forEach(function(e){e.highlightedIndexRanges&&++n}),t.highlightCount=n}e._highlightCount+=t.highlightCount})},e.prototype.render=function(e,t,n,i){var r=this,o=this._rctx,a=this._glMaterials.get(t.pass),s=4===t.pass;if(!a||null!=e&&!a.beginSlot(e)||s&&0===this._highlightCount)return!1;a.bind(o,n);var l=a.getProgram();l.setUniformMatrix4fv("model",x),l.hasUniform("modelNormal")&&l.setUniformMatrix4fv("modelNormal",x);var c=!1;return this._dataByOrigin.forEach(function(e){s&&0===e.highlightCount||(n.origin=e.origin,a.bindView(o,n),c=s?r.renderHighlightPass(a,e,i)||c:r.renderDefaultPass(a,e,i)||c)}),a.release(o,n),c},e.prototype.renderDefaultPass=function(e,t,n){var i=this._rctx,r=e.getProgram(),o=e.getDrawMode(),a=t.displayedIndexRanges;return!(a&&0===a.length||(f.assertCompatibleVertexAttributeLocations(t.vao,r),i.bindVAO(t.vao),a?u.drawArraysFaceRange(i,a,0,o,n):u.drawArrays(i,o,0,f.vertexCount(t.vao,"geometry"),n),0))},e.prototype.renderHighlightPass=function(e,t,n){var i=this._rctx,r=e.getProgram(),o=e.getDrawMode(),a=t.vao;f.assertCompatibleVertexAttributeLocations(a,r),i.bindVAO(a);var s=!1;return t.instances.forEach(function(e){var t=e.highlightedIndexRanges;if(t&&0!==t.length)for(var r=0;r<t.length;r++){var a=t[r],l=a.range?a.range[0]+e.from:e.from,c=a.range?a.range[1]-a.range[0]+1:e.to-e.from;u.drawArrays(i,o,l,c,n),s=!0}}),s},e.prototype.createData=function(e,t,n){return{instances:new Map,vao:new p(this._rctx,o.Default3D,{geometry:r.glLayout(e)},{geometry:d.createVertex(this._rctx,35044)}),buffer:new a(t),optimalCount:0,origin:n,highlightCount:0}},e.prototype.removeAndRebuild=function(e,t,n,i,r){for(var o=0,a=t;o<a.length;o++){var s=a[o].uniqueName,l=e.instances.get(s);e.optimalCount-=(l.to-l.from)*n,e.instances.delete(s)}var c=0,u=e.buffer.getArray();r.begin=0,r.end=0;var d=-1,f=-1,p=0;e.instances.forEach(function(e){var t=e.from*n,r=e.to*n,o=r-t;d!==f&&f!==t?(u.set(i.subarray(d,f),p),p+=f-d,d=t):-1===d&&(d=t),f=r,e.from=c/n,c+=o,e.to=c/n}),d!==f&&u.set(i.subarray(d,f),p),r.end=c},e.prototype.removeByErasing=function(e,t,n,i){if(0!==t.length){i.begin=1/0,i.end=-1/0;for(var r=-1,o=-1,a=0,s=t;a<s.length;a++){var l=s[a].uniqueName,c=e.instances.get(l),u=c.from*n,d=c.to*n;r!==o&&o!==u?(e.buffer.erase(r,o),r=u):-1===r&&(r=u),o=d,e.instances.delete(l),e.optimalCount-=d-u,u<i.begin&&(i.begin=u),d>i.end&&(i.end=d)}r!==o&&e.buffer.erase(r,o)}},e.prototype.append=function(e,t,i,r,o,a){a.updatedDisplayedIndexRange=!1;for(var s=this._bufferWriter,d=0,f=i;d<f.length;d++){var p=f[d],h=p.data;n.mat4.multiply(y,o,p.transformation),n.mat4.invert(b,y),n.mat4.transpose(b,b);var v=a.end;s.write({transformation:y,invTranspTransformation:b},h,p.instanceParameters,s.vertexBufferLayout.createView(e.buffer.getArray().buffer),a.end/r);var g=s.elementCount(h)*r,m=v+g;l.assert(null==e.instances.get(p.uniqueName));var x=u.generateRenderGeometryVisibleIndexRanges(p),_=u.generateRenderGeometryHighlightRanges(p);_&&(e.highlightCount=null);var S=new c(p.name,v/r,m/r,x,_,void 0,void 0,p.idx);e.instances.set(p.uniqueName,S),x&&(a.updatedDisplayedIndexRange=!0),e.optimalCount+=g,a.end+=g}},e}(),g={updatedDisplayedIndexRange:!1,begin:0,end:0},m=i.mat4f64.create(),y=i.mat4f64.create(),b=i.mat4f64.create(),x=i.mat4f64.create(),_=new Set;return v}.apply(null,i))||(e.exports=r)},Zp3t:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("H1tY")],void 0===(r=function(e,t,n){function i(e){return null!=e&&"type"in e&&"compressed"===e.type}return function(){function e(t,i,r){this._context=null,this._glName=null,this._id=-1,this._desc=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._boundToUnits=new Set,this._context=t,this._desc={pixelFormat:i.pixelFormat,internalFormat:i.internalFormat,dataType:i.dataType,target:i.target?i.target:3553,samplingMode:i.samplingMode?i.samplingMode:9729,wrapMode:i.wrapMode?i.wrapMode:10497,maxAnisotropy:i.maxAnisotropy,flipped:void 0!==i.flipped&&i.flipped,hasMipmap:void 0!==i.hasMipmap&&i.hasMipmap,unpackAlignment:i.unpackAlignment?i.unpackAlignment:4,width:i.width,height:i.height,preMultiplyAlpha:void 0!==i.preMultiplyAlpha&&i.preMultiplyAlpha,textureCoordinateScaleFactor:i.textureCoordinateScaleFactor||null},this._id=++e._nextId,n("esri-webgl-debug")&&t.instanceCounter.incrementCount(0),this.setData(r)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(this._context){if(this._glName){var t=this._context.gl;this._boundToUnits.forEach(function(t){e._context.bindTexture(null,t)}),t.deleteTexture(this._glName),this._glName=null}n("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(0),this._context=null}},e.prototype.resize=function(e,t){var n=this._desc;n.width===e&&n.height===t||(n.width=e,n.height=t,this.setData(null))},e.prototype.setData=function(t){var n=this._context.gl;this._glName||(this._glName=n.createTexture()),void 0===t&&(t=null),null===t&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var r=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var o=this._desc;e._validateTexture(o),n.pixelStorei(n.UNPACK_ALIGNMENT,o.unpackAlignment),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,o.flipped?1:0),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.preMultiplyAlpha?1:0);var a=o.pixelFormat,s=o.internalFormat?o.internalFormat:a;if(t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)o.width&&o.height,n.texImage2D(n.TEXTURE_2D,0,s,a,o.dataType,t),o.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=t.width),void 0===this._desc.height&&(this._desc.height=t.height);else{null!=o.width&&o.height,n.DEPTH24_STENCIL8&&s===n.DEPTH_STENCIL&&(s=n.DEPTH24_STENCIL8);var l=o.width,c=o.height;if(i(t)){var u=Math.round(Math.log(Math.max(l,c))/Math.LN2)+1;o.hasMipmap=o.hasMipmap&&u===t.levels.length;for(var d=0;;++d){var f=t.levels[Math.min(d,t.levels.length-1)];if(n.compressedTexImage2D(n.TEXTURE_2D,d,s,l,c,0,f),1===l&&1===c||!o.hasMipmap)break;l=Math.max(1,l>>1),c=Math.max(1,c>>1)}}else if(t)n.texImage2D(n.TEXTURE_2D,0,s,l,c,0,a,o.dataType,t),o.hasMipmap&&this.generateMipmap();else for(d=0;n.texImage2D(n.TEXTURE_2D,d,s,l,c,0,a,o.dataType,null),(1!==l||1!==c)&&o.hasMipmap;++d)l=Math.max(1,l>>1),c=Math.max(1,c>>1)}e._applySamplingMode(n,this._desc),e._applyWrapMode(n,this._desc),e._applyAnisotropicFilteringParameters(this._context,this._desc),this._context.bindTexture(r,0)},e.prototype.updateData=function(e,t,n,i,r,o){this._glName;var a=this._context.gl,s=this._desc,l=this._context.getBoundTexture(0);this._context.bindTexture(this,0),t<0||n<0||i>s.width||r>s.height||t+i>s.width||s.height,o instanceof ImageData||o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement?a.texSubImage2D(a.TEXTURE_2D,e,t,n,s.pixelFormat,s.dataType,o):a.texSubImage2D(a.TEXTURE_2D,e,t,n,i,r,s.pixelFormat,s.dataType,o),this._context.bindTexture(l,0)},e.prototype.generateMipmap=function(){var t=this._desc;t.hasMipmap||(t.hasMipmap=!0,e._validateTexture(t)),9729===t.samplingMode?(this._samplingModeDirty=!0,t.samplingMode=9985):9728===t.samplingMode&&(this._samplingModeDirty=!0,t.samplingMode=9984);var n=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var i=this._context.gl;i.generateMipmap(i.TEXTURE_2D),this._context.bindTexture(n,0)},e.prototype.setSamplingMode=function(t){t!==this._desc.samplingMode&&(this._desc.samplingMode=t,e._validateTexture(this._desc),this._samplingModeDirty=!0)},e.prototype.setWrapMode=function(t){t!==this._desc.wrapMode&&(this._desc.wrapMode=t,e._validateTexture(this._desc),this._wrapModeDirty=!0)},e.prototype.applyChanges=function(){var t=this._context.gl,n=this._desc;this._samplingModeDirty&&(e._applySamplingMode(t,n),this._samplingModeDirty=!1),this._wrapModeDirty&&(e._applyWrapMode(t,n),this._wrapModeDirty=!1)},e.prototype.setBoundToUnit=function(e,t){t?this._boundToUnits.add(e):this._boundToUnits.delete(e)},e._isPowerOfTwo=function(e){return 0==(e&e-1)},e._validateTexture=function(t){t.width<0||t.height,e._isPowerOfTwo(t.width)&&e._isPowerOfTwo(t.height)||("number"==typeof t.wrapMode?t.wrapMode:33071===t.wrapMode.s&&t.wrapMode.t,t.hasMipmap)},e._applySamplingMode=function(e,t){var n=t.samplingMode,i=t.samplingMode;9985===n||9987===n?(n=9729,t.hasMipmap||(i=9729)):9984!==n&&9986!==n||(n=9728,t.hasMipmap||(i=9728)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i)},e._applyWrapMode=function(e,t){"number"==typeof t.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode.t))},e._applyAnisotropicFilteringParameters=function(e,t){if(null!=t.maxAnisotropy){var n=e.capabilities.textureFilterAnisotropic;if(n){var i=e.gl;i.texParameterf(i.TEXTURE_2D,n.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy)}}},e._nextId=0,e}()}.apply(null,i))||(e.exports=r)},bduU:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("W9tT")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n,i,r){void 0===n&&(n=0),this.TypedArrayConstructor=e,this.elementCount=2;var o=this.TypedArrayConstructor;void 0===i&&(i=2*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,a):new o(t,a,(r-n)/o.BYTES_PER_ELEMENT),this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return n.vec2.set(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1])},e.prototype.setVec=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n},e.prototype.copyFrom=function(e,t,n){var i=this.typedBuffer,r=t.typedBuffer,o=e*this.typedBufferStride,a=n*t.typedBufferStride;i[o]=r[a],i[o+1]=r[a+1]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=2,e}();t.BufferViewVec2Impl=i}.apply(null,i))||(e.exports=r)},cjy9:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("FXVB"),n("1m5D"),n("0LE5"),n("Rdxj"),n("AzkI"),n("rjU6"),n("xsp2")],void 0===(r=function(e,t,n,i,r,o,a,s,l){return function(){function e(e,t,n,i,r,a,s,l,c,u,d){this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.componentOffsets=e.componentOffsets,this.boundingInfo=t,this.material=n,this.origin=null,this.center=o.vec3f64.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=r,i&&this.updateTransformation(i,a),this.castShadow=s,this.singleUse=l,this.name=c,this.uniqueName=u,this.idx=d,this.instanceParameters={}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,n){return t=t||a.maxScale(e),r.vec3.transformMat4(n,this.boundingInfo.getCenter(),e),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentCount",{get:function(){return s.componentCount(this.componentOffsets)},enumerable:!0,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=i.mat4f64.create()),n.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(this.transformation)),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation},e.prototype.getIndices=function(e){return"indices"in this.data?this.data.indices[e]:null},e.prototype.getAttribute=function(e){return"vertexAttr"in this.data?this.data.vertexAttr[e]:null},e.prototype.addHighlight=function(e){var t=l.generateHighlightId(),n=this.instanceParameters;return n.componentHighlights=s.addHighlight(n.componentHighlights,null,e,t),t},e.prototype.removeHighlight=function(e){var t=this.instanceParameters;t.componentHighlights=s.removeHighlight(t.componentHighlights,e)},e}()}.apply(null,i))||(e.exports=r)},cza4:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,n){for(var i=e.typedBuffer,r=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=n?n.count:t.count,l=(n&&n.dstIndex?n.dstIndex:0)*r,c=(n&&n.srcIndex?n.srcIndex:0)*a,u=0;u<s;++u)i[l]=o[c],l+=r,c+=a},t.makeDense=function(e,t){var n=e.count;t||(t=new e.TypedArrayConstructor(n));for(var i=0;i<n;i++)t[i]=e.get(i);return t}}.apply(null,i))||(e.exports=r)},"dB/a":function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,n){for(var i=e.typedBuffer,r=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=n?n.count:t.count,l=(n&&n.dstIndex?n.dstIndex:0)*r,c=(n&&n.srcIndex?n.srcIndex:0)*a,u=0;u<s;++u){for(var d=0;d<16;++d)i[l+d]=o[c+d];l+=r,c+=a}}}.apply(null,i))||(e.exports=r)},deO7:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.startMeasurement=function(e){var t=e.capabilities.disjointTimerQuery;return t?new n(t):null},t.getTimestamp=function(e,t,n){void 0===n&&(n=50);var i=e.capabilities.disjointTimerQuery;if(!i)return null;if(i.timestampBits()<=0)return null;var r=i.createQuery();i.createTimestamp(r);var o=function(){var e=i.resultAvailable(r),a=i.disjoint();if(!e||a)a?t():setTimeout(o,n);else{var s=i.getResult(r);t(s/1e6)}};o()},t.supportsTimestamps=function(e){var t=e.capabilities.disjointTimerQuery;return!!t&&t.timestampBits()>0};var n=function(){function e(e){this.timer=e,this.query=e.createQuery(),this.timer.beginTimeElapsed(this.query)}return e.prototype.stop=function(e,t){void 0===t&&(t=50),this.cb=e,this.checkInterval=t,this.timer.endTimeElapsed(),this.checkQueryResult()},e.prototype.checkQueryResult=function(){var e=this.timer.resultAvailable(this.query),t=this.timer.disjoint();if(!e||t)t?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval);else{var n=this.timer.getResult(this.query);this.cb(n/1e6)}},e}()}.apply(null,i))||(e.exports=r)},doLD:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("51bw"),n("FXVB"),n("1m5D"),n("W9tT"),n("DIqE"),n("0LE5"),n("Rdxj"),n("2fXB"),n("O7NG"),n("AzkI"),n("RsYQ"),n("/Bau"),n("CIy2"),n("/f24"),n("Zp3t"),n("Kfys")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v,g,m){function y(e,t,n,i,r,a,s,l){o.vec2.set(G,0,0);for(var c=0;c<4;++c)o.vec2.add(G,G,e[c]);o.vec2.scale(G,G,.25),o.vec2.set(H,0,0);for(c=4;c<8;++c)o.vec2.add(H,H,e[c]);o.vec2.scale(H,H,.25),o.vec2.lerp(k[0],e[4],e[5],.5),o.vec2.lerp(k[1],e[5],e[6],.5),o.vec2.lerp(k[2],e[6],e[7],.5),o.vec2.lerp(k[3],e[7],e[4],.5);var u=0,d=o.vec2.squaredDistance(k[0],G);for(c=1;c<4;++c){var f=o.vec2.squaredDistance(k[c],G);f<d&&(d=f,u=c)}o.vec2.subtract(W,k[u],e[u+4]);var p,v,g=W[0];W[0]=-W[1],W[1]=g,o.vec2.subtract(X,H,G),o.vec2.lerp(W,W,X,n),o.vec2.normalize(W,W),p=v=o.vec2.dot(o.vec2.subtract(q,e[0],G),W);for(c=1;c<8;++c){var m=o.vec2.dot(o.vec2.subtract(q,e[c],G),W);m<p?p=m:m>v&&(v=m)}o.vec2.copy(i,G),o.vec2.scale(q,W,p-t),o.vec2.add(i,i,q);var y=-1,b=1,x=0,_=0;for(c=0;c<8;++c){o.vec2.subtract(Y,e[c],i),o.vec2.normalize(Y,Y);var S=W[0]*Y[1]-W[1]*Y[0];S>0?S>y&&(y=S,x=c):S<b&&(b=S,_=c)}h.verify(y>0,"leftArea"),h.verify(b<0,"rightArea"),o.vec2.scale(Z,W,p),o.vec2.add(Z,Z,G),o.vec2.scale(K,W,v),o.vec2.add(K,K,G),Q[0]=-W[1],Q[1]=W[0];var w=h.rayRay2D(i,e[_],K,o.vec2.add(q,K,Q),1,r),T=h.rayRay2D(i,e[x],K,q,1,a),E=h.rayRay2D(i,e[x],Z,o.vec2.add(q,Z,Q),1,s),P=h.rayRay2D(i,e[_],Z,q,1,l);h.verify(w,"rayRay"),h.verify(T,"rayRay"),h.verify(E,"rayRay"),h.verify(P,"rayRay")}function b(e,t){return 3*t+e}function x(e,t){return o.vec2.set(J,e[t],e[t+3]),J}function _(e,t,n,i,r){o.vec2.subtract($,n,i),o.vec2.scale($,$,.5),ee[0]=$[0],ee[1]=$[1],ee[2]=0,ee[3]=$[1],ee[4]=-$[0],ee[5]=0,ee[6]=$[0]*$[0]+$[1]*$[1],ee[7]=$[0]*$[1]-$[1]*$[0],ee[8]=1,ee[b(0,2)]=-o.vec2.dot(x(ee,0),e),ee[b(1,2)]=-o.vec2.dot(x(ee,1),e);var a=o.vec2.dot(x(ee,0),n)+ee[b(0,2)],s=o.vec2.dot(x(ee,1),n)+ee[b(1,2)],l=o.vec2.dot(x(ee,0),i)+ee[b(0,2)],c=o.vec2.dot(x(ee,1),i)+ee[b(1,2)];a=-(a+l)/(s+c),ee[b(0,0)]+=ee[b(1,0)]*a,ee[b(0,1)]+=ee[b(1,1)]*a,ee[b(0,2)]+=ee[b(1,2)]*a,a=1/(o.vec2.dot(x(ee,0),n)+ee[b(0,2)]),s=1/(o.vec2.dot(x(ee,1),n)+ee[b(1,2)]),ee[b(0,0)]*=a,ee[b(0,1)]*=a,ee[b(0,2)]*=a,ee[b(1,0)]*=s,ee[b(1,1)]*=s,ee[b(1,2)]*=s,ee[b(2,0)]=ee[b(1,0)],ee[b(2,1)]=ee[b(1,1)],ee[b(2,2)]=ee[b(1,2)],ee[b(1,2)]+=1,a=-.5*((a=o.vec2.dot(x(ee,1),t)+ee[b(1,2)])/(s=o.vec2.dot(x(ee,2),t)+ee[b(2,2)])+(l=o.vec2.dot(x(ee,1),n)+ee[b(1,2)])/(c=o.vec2.dot(x(ee,2),n)+ee[b(2,2)])),ee[b(1,0)]+=ee[b(2,0)]*a,ee[b(1,1)]+=ee[b(2,1)]*a,ee[b(1,2)]+=ee[b(2,2)]*a,a=o.vec2.dot(x(ee,1),t)+ee[b(1,2)],l=-(s=o.vec2.dot(x(ee,2),t)+ee[b(2,2)])/a,ee[b(1,0)]*=l,ee[b(1,1)]*=l,ee[b(1,2)]*=l,r[0]=ee[0],r[1]=ee[1],r[2]=0,r[3]=ee[2],r[4]=ee[3],r[5]=ee[4],r[6]=0,r[7]=ee[5],r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=ee[6],r[13]=ee[7],r[14]=0,r[15]=ee[8]}for(var S=function(){this.camera=new f,this.lightMat=r.mat4f64.create()},w=function(){function e(e){this.doShadowMapMipmapsWork=!1,this.textureRes=4096,this.numCascades=1,this.maxNumCascades=2,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.rctx=e,this.emptyTexture=p.createEmptyTexture(e);for(var t=0;t<4;++t)this.cascades.push(new S)}return e.prototype.dispose=function(){this.emptyTexture.dispose(),this.emptyTexture=null},Object.defineProperty(e.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(e){this.textureRes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(e){this.maxNumCascades=d.clamp(Math.floor(e),1,4)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.getDepthTexture=function(){return this.depthTexture},e.prototype.getCascades=function(){for(var e=0;e<this.numCascades;++e)z[e]=this.cascades[e];return z.length=this.numCascades,z},e.prototype.prepare=function(e,t,n){h.assert(this.enabled),i.mat4.multiply(E,e.projectionMatrix,e.viewMatrix);var r=n.near,o=n.far;r<2&&(r=2),o<2&&(o=2),r>=o&&(r=2,o=4),this.numCascades=Math.min(1+Math.floor(h.logWithBase(o/r,4)),this.maxNumCascades);for(var a=Math.pow(o/r,1/this.numCascades),l=0;l<this.numCascades+1;++l)this.cascadeDistances[l]=r*Math.pow(a,l);i.mat4.invert(P,E),i.mat4.lookAt(B,[0,0,0],[-t[0],-t[1],-t[2]],[0,1,0]);var u=e.viewMatrix,f=e.projectionMatrix;for(l=0;l<this.numCascades;++l){var p=this.cascades[l],v=-this.cascadeDistances[l],g=-this.cascadeDistances[l+1],m=(f[10]*v+f[14])/Math.abs(f[11]*v+f[15]),b=(f[10]*g+f[14])/Math.abs(f[11]*g+f[15]);h.assert(m<b);for(var x=0;x<8;++x){var S=x%4==0||x%4==3?-1:1,w=x%4==0||x%4==1?-1:1,O=x<4?m:b;c.vec4.set(C,S,w,O,1),c.vec4.transformMat4(A[x],C,P);for(var z=0;z<3;++z)A[x][z]/=A[x][3]}s.vec3.negate(N,A[0]),i.mat4.translate(T,B,N),p.camera.viewMatrix=T;for(x=0;x<8;++x)s.vec3.transformMat4(A[x],A[x],p.camera.viewMatrix);s.vec3.copy(R,A[0]),s.vec3.copy(M,A[0]);for(x=1;x<8;++x)for(z=0;z<3;++z)R[z]=Math.min(R[z],A[x][z]),M[z]=Math.max(M[z],A[x][z]);R[2]-=200,M[2]+=200,p.camera.near=-M[2],p.camera.far=-R[2],r=1/A[0][3],o=1/A[4][3],h.assert(r<o);var U=r+Math.sqrt(r*o),j=Math.sin(d.acos(u[2]*t[0]+u[6]*t[1]+u[10]*t[2]));y(A,U/=j,j,D,I,L,V,F),_(D,I,V,F,p.camera.projectionMatrix),p.camera.projectionMatrix[10]=2/(R[2]-M[2]),p.camera.projectionMatrix[14]=-(R[2]+M[2])/(R[2]-M[2]),i.mat4.multiply(p.lightMat,p.camera.projectionMatrix,p.camera.viewMatrix);var G=this.textureRes/2;p.camera.viewport[0]=l%2==0?0:G,p.camera.viewport[1]=0===Math.floor(l/2)?0:G,p.camera.viewport[2]=G,p.camera.viewport[3]=G}this.lastOrigin=null,this.cascadeDistances[this.numCascades]=100*o;var H=this.rctx;H.bindFramebuffer(this.fbo),H.bindTexture(null,7),H.setClearColor(1,1,1,1),H.clearSafe(16640)},e.prototype.finish=function(e){h.assert(this.enabled),this.rctx.bindFramebuffer(e),this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()},e.prototype.bind=function(e){var t=this.rctx,n=this.enabled;t.bindTexture(n?this.depthTexture:this.emptyTexture,7),t.bindProgram(e),e.setUniform1i("depthTex",7),e.setUniform1f("depthHalfPixelSz",n?.5/this.textureRes:-1),e.setUniform1i("shadowMapNum",this.numCascades),e.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("shadowMapDistance"),n=0;n<t.length;n++)this.bind(t[n])},e.prototype.bindView=function(e,t){if(this.enabled){var n=this.lastOrigin;if(!n||n[0]!==t[0]||n[1]!==t[1]||n[2]!==t[2]){this.lastOrigin=this.lastOrigin||l.vec3f64.create(),s.vec3.copy(this.lastOrigin,t);for(var r=0;r<this.numCascades;++r){i.mat4.translate(U,this.cascades[r].lightMat,t);for(var o=0;o<16;++o)j[16*r+o]=U[o]}}e.setUniformMatrix4fv("shadowMapMatrix",j)}},e.prototype.enable=function(){if(!this.enabled){var e={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureRes,height:this.textureRes};this.depthTexture=new g(this.rctx,e),this.fbo=v.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}},e.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.fbo=null,this.depthTexture=null)},e.prototype.getGpuMemoryUsage=function(){return m.getGpuMemoryUsage(this.fbo)},e}(),T=r.mat4f64.create(),E=r.mat4f64.create(),P=r.mat4f64.create(),C=u.vec4f64.create(),A=[],O=0;O<8;++O)A.push(u.vec4f64.create());var R=l.vec3f64.create(),M=l.vec3f64.create(),D=a.vec2f64.create(),I=a.vec2f64.create(),L=a.vec2f64.create(),V=a.vec2f64.create(),F=a.vec2f64.create(),B=r.mat4f64.create(),N=l.vec3f64.create(),z=[],U=r.mat4f64.create(),j=new Float32Array(64),G=a.vec2f64.create(),H=a.vec2f64.create(),k=[a.vec2f64.create(),a.vec2f64.create(),a.vec2f64.create(),a.vec2f64.create()],W=a.vec2f64.create(),X=a.vec2f64.create(),q=a.vec2f64.create(),Y=a.vec2f64.create(),Z=a.vec2f64.create(),K=a.vec2f64.create(),Q=a.vec2f64.create(),J=a.vec2f64.create(),$=a.vec2f64.create(),ee=n.mat3f64.create();return w}.apply(null,i))||(e.exports=r)},eHCP:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("Rdxj")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.fromVector=function(e,t){return{vec3:n.vec3f64.clone(e),id:t}},t.fromValues=function(e,t,i,r){return{vec3:n.vec3f64.fromValues(e,t,i),id:r}}}.apply(null,i))||(e.exports=r)},f3AO:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,n){for(var i=e.typedBuffer,r=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride,s=n?n.count:t.count,l=(n&&n.dstIndex?n.dstIndex:0)*r,c=(n&&n.srcIndex?n.srcIndex:0)*a,u=0;u<s;++u){for(var d=0;d<9;++d)i[l+d]=o[c+d];l+=r,c+=a}}}.apply(null,i))||(e.exports=r)},fHD9:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.dispose=function(){var e=this;(this.__proto__.__managedDisposables__||[]).forEach(function(t){e[t]&&(e[t].dispose(),e[t]=void 0)})},e}();t.ManagingDisposable=n,t.manageDisposal=function(){return function(e,t){e.__managedDisposables__=e.__managedDisposables__||[],e.__managedDisposables__.push(t)}}}.apply(null,i))||(e.exports=r)},fHyw:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,i,r){void 0===n&&(n=0),this.TypedArrayConstructor=e,this.elementCount=16;var o=this.TypedArrayConstructor;void 0===i&&(i=16*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,a):new o(t,a,(r-n)/o.BYTES_PER_ELEMENT),this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getMat=function(e,t){for(var n=e*this.typedBufferStride,i=0;i<16;i++)t[i]=this.typedBuffer[n+i];return t},e.prototype.setMat=function(e,t){for(var n=e*this.typedBufferStride,i=0;i<16;i++)this.typedBuffer[n+i]=t[i]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n},e.prototype.copyFrom=function(e,t,n){for(var i=this.typedBuffer,r=t.typedBuffer,o=e*this.typedBufferStride,a=n*t.typedBufferStride,s=0;s<16;++s)i[o+s]=r[a+s]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=16,e}();t.BufferViewMat4Impl=n}.apply(null,i))||(e.exports=r)},fPnv:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("1m5D"),n("VfPl"),n("MzcX"),n("ff/U"),n("D8s1"),n("PwS/"),n("QFi0"),n("Kfys"),n("z2+Q")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u){function d(e,t){var n=new Map,i=function(e,t){var i=e.origin.id,r=e.data.id,o=n.get(i);o||(o={origin:e.origin.vec3,deltaByGeometry:new Map},n.set(i,o));var a=o.deltaByGeometry.get(r);a||(a={renderData:e.data,toAdd:[],toRemove:[]},o.deltaByGeometry.set(r,a)),(t?a.toAdd:a.toRemove).push(e)};return e.forEach(function(e){i(e,!0)}),t.forEach(function(e){i(e,!1)}),n}function f(e,t,n){var i=t.elementCount(e),r=t.allocate(i);t.write({},e,null,r,0),n.setData(r.buffer)}var p=function(){function e(e,t,n,i,s){void 0===s&&(s=0),this.data=new a(n,s),this.instanceBuffer=l.createVertex(e,35044),this.vao=new u(e,o.Default3D,{geometry:r.glLayout(t),instance:r.glLayout(n,{divisor:1})},{geometry:i,instance:this.instanceBuffer})}return e.prototype.dispose=function(){this.vao.dispose(!1),this.instanceBuffer.dispose()},Object.defineProperty(e.prototype,"count",{get:function(){return this.data.getCount()},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this.data.hasSlot(e.idx)},e.prototype.prepareAdd=function(e){this.data.prepareAllocate(e)},e.prototype.add=function(e){var t=this.data.allocate(e.idx);this.writeInstance(e,t)},e.prototype.prepareRemove=function(e){this.data.prepareFree(e)},e.prototype.remove=function(e){this.data.free(e.idx)},e.prototype.updateTransform=function(e,t){void 0===t&&(t=!0);var n=this.data.getSlot(e.idx);null!=n&&(this.writeTransform(e,n),t&&this.uploadSlot(n))},e.prototype.uploadAll=function(){this.data.compact(),this.instanceBuffer.setData(this.data.getBuffer().buffer)},e.prototype.uploadSlot=function(e){var t=this.data,n=t.layout.stride,i=e*n;this.instanceBuffer.setSubData(t.getBuffer().buffer,i,i,i+n)},e.prototype.instanceBufferView=function(){var e=this.data.getBuffer();return this._buffer!==e&&(this._bufferView={transformation:e.getField("model",i.BufferViewMat4f),transformationNormal:e.getField("modelNormal",i.BufferViewMat4f),instanceColor:e.getField("instanceColor",i.BufferViewVec4f),instanceFeatureAttribute:e.getField("instanceFeatureAttribute",i.BufferViewVec4f)}),this._bufferView},e.prototype.writeTransform=function(e,t){var n=this.instanceBufferView();s.calculateTransformRelToOrigin(e,v,g),n.transformation.setMat(t,v),n.transformationNormal.setMat(t,g)},e.prototype.writeInstance=function(e,t){var n=this.instanceBufferView();s.calculateTransformRelToOrigin(e,v,g),n.transformation.setMat(t,v),n.transformationNormal.setMat(t,g),n.instanceColor&&n.instanceColor.setVec(t,e.instanceParameters.color),n.instanceFeatureAttribute&&n.instanceFeatureAttribute.setVec(t,e.instanceParameters.featureAttribute)},e}(),h=function(){function e(e,t,n){this._dataByOrigin=new Map,this._highlightCount=0,this._instanceDataToUploadCache=new Set,this._rctx=e,this._material=n,this._materialRep=t,this._glMaterials=s.acquireMaterials(this._material,this._materialRep),this._bufferWriter=n.createBufferWriter()}return e.prototype.dispose=function(){s.releaseMaterials(this._material,this._materialRep)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlightCount>0},enumerable:!0,configurable:!0}),e.prototype.renderPriority=function(){return this._material.renderPriority},e.prototype.modify=function(e){this.updateGeometries(e.toUpdate),this.addAndRemoveGeometries(e.toAdd,e.toRemove),this.updateHighlightCount()},e.prototype.addAndRemoveGeometries=function(e,t){var n=this._rctx,i=this._bufferWriter,r=this._dataByOrigin,o=d(e,t),a=i.vertexBufferLayout,c=i.instanceBufferLayout;o.forEach(function(e,t){var o=r.get(t);o||(o={origin:e.origin,highlightCount:0,dataByGeometry:new Map},r.set(t,o)),e.deltaByGeometry.forEach(function(e,t){var r=o.dataByGeometry.get(t);if(!r&&e.toAdd.length>0){var u=l.createVertex(n,35044);f(e.renderData,i,u),r={count:0,vertexBuffer:u,instanceData:new p(n,a,c,u,e.toAdd.length),highlightInstanceData:new p(n,a,c,u)},o.dataByGeometry.set(t,r)}var d=r.instanceData,h=r.highlightInstanceData;d.prepareAdd(e.toAdd.length),e.toAdd.forEach(function(e){s.isRenderGeometryHidden(e)||(d.add(e),s.doesRenderGeometryHaveHighlights(e)&&(h.add(e),o.highlightCount=null))}),d.prepareRemove(e.toRemove.length),e.toRemove.forEach(function(e){d.remove(e),h.remove(e)}),e.toAdd.length+e.toRemove.length&&(d.uploadAll(),h.uploadAll()),r.count+=e.toAdd.length,r.count-=e.toRemove.length,0===r.count&&(r.instanceData.dispose(),r.highlightInstanceData.dispose(),r.vertexBuffer.dispose(),o.dataByGeometry.delete(t))}),0===o.dataByGeometry.size&&r.delete(t)})},e.prototype.updateGeometries=function(e){var t=this._dataByOrigin,n=this._bufferWriter;this._instanceDataToUploadCache.clear();var i=this._instanceDataToUploadCache;e.forEach(function(e){var r=e.updateType,o=e.renderGeometry,a=t.get(o.origin.id),l=a&&a.dataByGeometry.get(o.data.id);if(l){var c=l.instanceData,u=l.highlightInstanceData,d=1&r;d&&(s.isRenderGeometryHidden(o)?(c.remove(o),i.add(c),u.has(o)&&(u.remove(o),i.add(u))):c.has(o)||(c.add(o),i.add(c),s.doesRenderGeometryHaveHighlights(o)&&!u.has(o)&&(u.add(o),i.add(u))));var p=16&r;p&&(s.doesRenderGeometryHaveHighlights(o)?u.has(o)||(u.add(o),i.add(u)):(u.remove(o),i.add(u)),a.highlightCount=null),2&r&&f(o.data,n,l.vertexBuffer),4&r&&(l.instanceData.updateTransform(o,!d),l.highlightInstanceData.updateTransform(o,!p))}}),i.forEach(function(e){e.uploadAll()})},e.prototype.updateHighlightCount=function(){var e=this;this._highlightCount=0,this._dataByOrigin.forEach(function(t){if(null==t.highlightCount){var n=0;t.dataByGeometry.forEach(function(e){n+=e.highlightInstanceData.count}),t.highlightCount=n}e._highlightCount+=t.highlightCount})},e.prototype.render=function(e,t,n,i){var r=this._rctx,o=r.capabilities.instancing,a=this._glMaterials.get(t.pass),s=4===t.pass;if(!a||null!=e&&!a.beginSlot(e)||s&&0===this._highlightCount)return!1;var l=a.getProgram(),u=a.getDrawMode();a.bind(r,n);var d=!1;return this._dataByOrigin.forEach(function(e){s&&0===e.highlightCount||(n.origin=e.origin,a.bindView(r,n),e.dataByGeometry.forEach(function(e){var t=s?e.highlightInstanceData:e.instanceData,n=t.count;if(!s||0!==n){var a=t.vao;c.assertCompatibleVertexAttributeLocations(a,l),r.bindVAO(a);var f=c.vertexCount(a,"geometry");o.drawArraysInstanced(u,0,f,n),i&&(i.drawCallsInstanced++,4===u&&(i.triangles+=n*(f/3))),d=!0}}))}),r.bindVAO(null),a.release(r,n),d},e}(),v=n.mat4f64.create(),g=n.mat4f64.create();return h}.apply(null,i))||(e.exports=r)},"ff/U":function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,aTangent:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}.apply(null,i))||(e.exports=r)},hQPx:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("0LE5")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n,i,r){void 0===n&&(n=0),this.TypedArrayConstructor=e,this.elementCount=3;var o=this.TypedArrayConstructor;void 0===i&&(i=3*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,a):new o(t,a,(r-n)/o.BYTES_PER_ELEMENT),this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return n.vec3.set(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1],this.typedBuffer[e*this.typedBufferStride+2])},e.prototype.setVec=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1],this.typedBuffer[e*this.typedBufferStride+2]=t[2]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n},e.prototype.copyFrom=function(e,t,n){var i=this.typedBuffer,r=t.typedBuffer,o=e*this.typedBufferStride,a=n*t.typedBufferStride;i[o]=r[a],i[o+1]=r[a+1],i[o+2]=r[a+2]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=3,e}();t.BufferViewVec3Impl=i}.apply(null,i))||(e.exports=r)},hkmr:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("LxLY"),n("1m5D"),n("0LE5"),n("Rdxj"),n("Z4y+"),n("mmEe"),n("ys4y"),n("AgDx"),n("ZO6V"),n("eHCP"),n("ZJC8"),n("CIy2"),n("RC9r"),n("I67D")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v){var g=0,m="rg_",y=function(){function e(){if(this.ROOT_ORIGIN_ID=m+"root_"+g++,this._origins=new Map,this._gridSize=42e5,n.isSome(e.testOrigin)){var t=e.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,d.fromValues(t[0],t[1],t[2],this.ROOT_ORIGIN_ID))}}return e.prototype.getOrigin=function(e){var t=this._origins.get(this.ROOT_ORIGIN_ID);if(null==t){var n=d.fromValues(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,n),n}r.vec3.subtract(x,e,t.vec3),x[0]=Math.abs(x[0]),x[1]=Math.abs(x[1]),x[2]=Math.abs(x[2]);var i=this._gridSize;if(x[0]<i&&x[1]<i&&x[2]<i)return t;var o=Math.round(e[0]/i),a=Math.round(e[1]/i),s=Math.round(e[2]/i),l=""+m+o+"/"+a+"/"+s,c=this._origins.get(l);return c||(c=d.fromValues(o*i,a*i,s*i,l),this._origins.set(l,c)),c},e.prototype._drawOriginBox=function(e){var t=window.view,n=t._stage;if(null==this._object){this._material=new h({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial"),n.add(v.ContentType.MATERIAL,this._material);var i=new u("GridLocalOrigin",{isPickable:!1});n.add(v.ContentType.LAYER,i),this._object=new f({name:"GridLocalOrigin",idHint:"GridLocalOrigin",castShadow:!1}),n.add(v.ContentType.OBJECT,this._object),i.addObject(this._object),n.addToViewContent([i.id])}for(var r=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],o=r.length,d=new Float32Array(3*o),g=new Uint32Array(2*(o-1)),m=.5*this._gridSize,y=0;y<o;y++)d[3*y+0]=e[0]+(1&r[y]?m:-m),d[3*y+1]=e[1]+(2&r[y]?m:-m),d[3*y+2]=e[2]+(4&r[y]?m:-m),y>0&&(g[2*y+0]=y-1,g[2*y+1]=y);s.bufferToBuffer(d,a.WebMercator,0,d,t.spatialReference,0,o);var x={};x[p.VertexAttrConstants.POSITION]={size:3,data:d};var _={};_[p.VertexAttrConstants.POSITION]=g;var S=new c(x,_,void 0,"line"),w=new l(S,"GridLocalOriginBox");n.add(v.ContentType.GEOMETRY,w),this._object.addGeometry(w,this._material,b)},e}(),b=i.mat4f64.create(),x=o.vec3f64.create();return(y||(y={})).testOrigin=null,y}.apply(null,i))||(e.exports=r)},hnAi:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("VfPl"),n("CIy2")],void 0===(r=function(e,t,n,i){function r(e,t,n,i,r){var o=n.typedBuffer,a=n.typedBufferStride,s=e.length;if(i*=a,null==r||1===r)for(var l=0;l<s;++l){var c=2*e[l];o[i]=t[c],o[i+1]=t[c+1],i+=a}else for(l=0;l<s;++l){c=2*e[l];for(var u=0;u<r;++u)o[i]=t[c],o[i+1]=t[c+1],i+=a}}function o(e,t,n,i,r){var o=n.typedBuffer,a=n.typedBufferStride,s=e.length;if(i*=a,null==r||1===r)for(var l=0;l<s;++l){var c=3*e[l];o[i]=t[c],o[i+1]=t[c+1],o[i+2]=t[c+2],i+=a}else for(l=0;l<s;++l){c=3*e[l];for(var u=0;u<r;++u)o[i]=t[c],o[i+1]=t[c+1],o[i+2]=t[c+2],i+=a}}function a(e,t,n,i,r){var o=n.typedBuffer,a=n.typedBufferStride,s=e.length;if(i*=a,null==r||1===r)for(var l=0;l<s;++l){var c=4*e[l];o[i]=t[c],o[i+1]=t[c+1],o[i+2]=t[c+2],o[i+3]=t[c+3],i+=a}else for(l=0;l<s;++l){c=4*e[l];for(var u=0;u<r;++u)o[i]=t[c],o[i+1]=t[c+1],o[i+2]=t[c+2],o[i+3]=t[c+3],i+=a}}function s(e,t,n,i,r,a){if(n){var s=n,l=i.typedBuffer,c=i.typedBufferStride,u=e.length;if(r*=c,null==a||1===a)for(var d=0;d<u;++d){var f=t[v=3*e[d]],p=t[v+1],h=t[v+2];l[r]=s[0]*f+s[4]*p+s[8]*h+s[12],l[r+1]=s[1]*f+s[5]*p+s[9]*h+s[13],l[r+2]=s[2]*f+s[6]*p+s[10]*h+s[14],r+=c}else for(d=0;d<u;++d){f=t[v=3*e[d]],p=t[v+1],h=t[v+2];for(var v,g=s[0]*f+s[4]*p+s[8]*h+s[12],m=s[1]*f+s[5]*p+s[9]*h+s[13],y=s[2]*f+s[6]*p+s[10]*h+s[14],b=0;b<a;++b)l[r]=g,l[r+1]=m,l[r+2]=y,r+=c}}else o(e,t,i,r,a)}function l(e,t,n,i,r,a){if(n){var s=n,l=i.typedBuffer,c=i.typedBufferStride,u=e.length;if(r*=c,null==a||1===a)for(var d=0;d<u;++d){var f=t[v=3*e[d]],p=t[v+1],h=t[v+2];l[r]=s[0]*f+s[4]*p+s[8]*h,l[r+1]=s[1]*f+s[5]*p+s[9]*h,l[r+2]=s[2]*f+s[6]*p+s[10]*h,r+=c}else for(d=0;d<u;++d){f=t[v=3*e[d]],p=t[v+1],h=t[v+2];for(var v,g=s[0]*f+s[4]*p+s[8]*h,m=s[1]*f+s[5]*p+s[9]*h,y=s[2]*f+s[6]*p+s[10]*h,b=0;b<a;++b)l[r]=g,l[r+1]=m,l[r+2]=y,r+=c}}else o(e,t,i,r,a)}function c(e,t,n,i,r,o){var a=i.typedBuffer,s=i.typedBufferStride,l=e.length;if(r*=s,null==o||1===o){if(4===n)for(var c=0;c<l;++c){var u=4*e[c];a[r]=t[u],a[r+1]=t[u+1],a[r+2]=t[u+2],a[r+3]=t[u+3],r+=s}else if(3===n)for(c=0;c<l;++c){u=3*e[c];a[r]=t[u],a[r+1]=t[u+1],a[r+2]=t[u+2],a[r+3]=255,r+=s}}else if(4===n)for(c=0;c<l;++c){u=4*e[c];for(var d=0;d<o;++d)a[r]=t[u],a[r+1]=t[u+1],a[r+2]=t[u+2],a[r+3]=t[u+3],r+=s}else if(3===n)for(c=0;c<l;++c)for(u=3*e[c],d=0;d<o;++d)a[r]=t[u],a[r+1]=t[u+1],a[r+2]=t[u+2],a[r+3]=255,r+=s}function u(e,t,n,i,r,o,a){var s=r.typedBuffer,l=r.typedBufferStride,c=e.length;if(o*=l,null==a||1===a){if(4===n)for(var u=0;u<c;++u){var d=4*e[u];s[o]=t[d]*i[0],s[o+1]=t[d+1]*i[1],s[o+2]=t[d+2]*i[2],s[o+3]=t[d+3]*i[3],o+=l}else if(3===n){var f=255*i[3];for(u=0;u<c;++u){d=3*e[u];s[o]=t[d]*i[0],s[o+1]=t[d+1]*i[1],s[o+2]=t[d+2]*i[2],s[o+3]=f,o+=l}}}else if(4===n)for(u=0;u<c;++u){d=4*e[u];for(var p=0;p<a;++p)s[o]=t[d]*i[0],s[o+1]=t[d+1]*i[1],s[o+2]=t[d+2]*i[2],s[o+3]=t[d+3]*i[3],o+=l}else if(3===n)for(f=255*i[3],u=0;u<c;++u)for(d=3*e[u],p=0;p<a;++p)s[o]=t[d]*i[0],s[o+1]=t[d+1]*i[1],s[o+2]=t[d+2]*i[2],s[o+3]=f,o+=l}Object.defineProperty(t,"__esModule",{value:!0}),t.writeBufferVec2=r,t.writeBufferVec3=o,t.writeBufferVec4=a,t.writePosition=s,t.writeNormal=l,t.writeColor=c,t.writeMultipliedColor=u,t.writeDefaultAttributes=function(e,t,o,d,f,p,h){for(var v=0,g=o.fieldNames;v<g.length;v++){var m=g[v],y=e.vertexAttr[m],b=e.indices[m];if(y&&b)switch(m){case i.VertexAttrConstants.POSITION:i.assert(3===y.size);var x=p.getField(m,n.BufferViewVec3f);x&&s(b,y.data,d,x,h);break;case i.VertexAttrConstants.NORMAL:i.assert(3===y.size);var _=p.getField(m,n.BufferViewVec3f);_&&l(b,y.data,f,_,h);break;case i.VertexAttrConstants.UV0:i.assert(2===y.size);var S=p.getField(m,n.BufferViewVec2f);S&&r(b,y.data,S,h);break;case i.VertexAttrConstants.REGION:i.assert(4===y.size);var w=p.getField(m,n.BufferViewVec4u16);w&&a(b,y.data,w,h);break;case i.VertexAttrConstants.COLOR:i.assert(3===y.size||4===y.size);var T=p.getField(m,n.BufferViewVec4u8);T&&(t&&t.color?u(b,y.data,y.size,t.color,T,h):c(b,y.data,y.size,T,h));break;case i.VertexAttrConstants.SYMBOLCOLOR:i.assert(3===y.size||4===y.size);var E=p.getField(m,n.BufferViewVec4u8);E&&c(b,y.data,y.size,E,h);break;case i.VertexAttrConstants.TANGENT:i.assert(4===y.size);var P=p.getField(m,n.BufferViewVec4f);P&&a(b,y.data,P,h)}}}}.apply(null,i))||(e.exports=r)},i9pz:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("ff/U"),n("zbgD"),n("U+8K")],void 0===(r=function(e,t,n,i,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){return r.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GAUSSIAN_SAMPLES:e.gaussianSamples})},a=function(e){return r.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GRID_DEBUG:e.gridDebug})};t.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:i.resolveIncludes("renderer/highlight/downsample.vert"),fragmentShader:i.resolveIncludes("renderer/highlight/downsample.frag")},attributes:n.Default3D},t.blurPass={name:"highlight-blur",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:o(e)+i.resolveIncludes("renderer/highlight/blur.frag")}},attributes:n.Default3D},t.applyPass={name:"highlight-apply",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:a(e)+i.resolveIncludes("renderer/highlight/apply.frag")}},attributes:n.Default3D}}.apply(null,i))||(e.exports=r)},j2SP:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("3gjc")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.vec4f32=n}.apply(null,i))||(e.exports=r)},jlKI:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("weRx"),n("QFi0"),n("/f24"),n("G0ER"),n("qbr3"),n("Zp3t"),n("z2+Q")],void 0===(r=function(e,t,i,r,o,a,s,l,c){return function(){function e(e){this._isLoadingResources=!1,this.isEnabled=!1,this.vertexAttributeLocations={vPosition:0},this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.loadResources=function(e){var t=this;return!!this.data||(this._isLoadingResources=!0,n.e(94).then(function(){var i=[n("5bH8")];(function(n){t.data=n,t._isLoadingResources=!1,e&&e()}).apply(null,i)}).catch(n.oe),!1)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var e=this.rctx;this.programEdgeDetect=new a(e,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations),this.programBlendWeights=new a(e,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations),this.programBlur=new a(e,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations),this.pipelineState=s.makePipelineState({colorWrite:s.defaultColorWriteParams});var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new c(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new r(e,34962,35044,t)}),this.tmpFramebufferEdges=o.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.tmpFramebufferBlend=o.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.textureSearch=this.loadTextureFromBase64(this.data.searchTexure,9728,6409),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var n=this.rctx,i={x:0,y:0,width:0,height:0};null!=t?(i.width=t.descriptor.width,i.height=t.descriptor.height):(i.width=n.gl.canvas.width,i.height=n.gl.canvas.height),n.bindVAO(this.vao),n.setPipelineState(this.pipelineState),n.setViewport(i.x,i.y,i.width,i.height),this.tmpFramebufferEdges.resize(i.width,i.height),n.bindFramebuffer(this.tmpFramebufferEdges),n.setClearColor(0,0,0,1),n.clear(16384),n.bindProgram(this.programEdgeDetect),n.bindTexture(e.colorTexture,0),this.programEdgeDetect.setUniform1i("tColor",0),this.programEdgeDetect.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),n.drawArrays(4,0,3),this.tmpFramebufferBlend.resize(i.width,i.height),n.bindFramebuffer(this.tmpFramebufferBlend),n.setClearColor(0,0,1,1),n.clear(16384),n.bindProgram(this.programBlendWeights),this.programBlendWeights.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),n.bindTexture(this.textureSearch,1),this.programBlendWeights.setUniform1i("tSearch",1),n.bindTexture(this.textureArea,2),this.programBlendWeights.setUniform1i("tArea",2),n.bindTexture(this.tmpFramebufferEdges.colorTexture,3),this.programBlendWeights.setUniform1i("tEdges",3),n.drawArrays(4,0,3),n.bindFramebuffer(t),n.setClearColor(0,1,0,1),n.clear(16384),n.bindProgram(this.programBlur),this.programBlur.setUniform4f("uResolution",1/i.width,1/i.height,i.width,i.height),n.bindTexture(e.colorTexture,0),this.programBlur.setUniform1i("tColor",0),n.bindTexture(this.tmpFramebufferBlend.colorTexture,1),this.programBlur.setUniform1i("tBlendWeights",1),n.drawArrays(4,0,3)},e.prototype.loadTextureFromBase64=function(e,t,n){var r=new l(this.rctx,{pixelFormat:n,dataType:5121,wrapMode:33071,samplingMode:t},null);return i.requestImage(e).then(function(e){r.resize(e.width,e.height),r.setData(e)}),r},e}()}.apply(null,i))||(e.exports=r)},jmRc:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("xoE+")],void 0===(r=function(e,t,n){function i(e,t,i,l){void 0===l&&(l=0);var c=e.byteLength/(4*t),u=new Uint32Array(e,0,c*t),d=new Uint32Array(c),f=Math.floor(1.1*c)+1;(null==s||s.length<2*f)&&(s=new Uint32Array(n.nextHighestPowerOfTwo(2*f)));for(var p=0;p<2*f;p++)s[p]=0;var h=0,v=1.96,g=0!==l?Math.ceil(4*v*v/(l*l)*l*(1-l)):c;for(p=0;p<c;p++){if(p===g){var m=1-h/p;if(m+v*Math.sqrt(m*(1-m)/p)<l)return null;g*=2}for(var y=p*t,b=a(u,y,t),x=b%f,_=h;0!==s[2*x+1];){if(s[2*x]===b){var S=s[2*x+1]-1;if(r(u,y,S*t,t)){_=d[S];break}}++x>=f&&(x-=f)}_===h&&(s[2*x]=b,s[2*x+1]=p+1,h++),d[p]=_}if(0!==l&&1-h/c<l)return null;var w=new Uint32Array(t*h);h=0;for(p=0;p<c;p++)d[p]===h&&(o(u,p*t,w,h*t,t),h++);if(i){var T=new Uint32Array(i.length);for(p=0;p<T.length;p++)T[p]=d[i[p]];d=T}return{buffer:w.buffer,indices:d,uniqueCount:h}}function r(e,t,n,i){for(var r=0;r<i;r++)if(e[t+r]!==e[n+r])return!1;return!0}function o(e,t,n,i,r){for(var o=0;o<r;o++)n[i+o]=e[t+o]}function a(e,t,n){for(var i=0,r=0;r<n;r++)i=(i=e[t+r]+i|0)+(i<<11)+(i>>>2)|0;return i>>>0}Object.defineProperty(t,"__esModule",{value:!0}),t.deduplicate=i;var s=null;t.default=i}.apply(null,i))||(e.exports=r)},kfwU:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("KY0m"),n("rusB"),n("0LE5"),n("Rdxj"),n("AzkI")],void 0===(r=function(e,t,n,i,r,o,a){function s(e,t){return e.cosAngle<t}function l(e,t){return e.cosAngle>t}function c(e,t){var n=a.acos(e.cosAngle),i=p.fwd,o=p.ortho;return a.directionFromTo(i,e.position1,e.position0),n*(r.vec3.dot(r.vec3.cross(o,e.faceNormal0,e.faceNormal1),i)>0?-1:1)>t}function u(e){for(var t=e.faces.length/3,n=e.faces,i=e.neighbors,r=0,o=0;o<t;o++){var a=i[3*o+0],s=i[3*o+1],l=i[3*o+2],c=n[3*o+0],u=n[3*o+1],d=n[3*o+2];r+=a===f||c<u?1:0,r+=s===f||u<d?1:0,r+=l===f||d<c?1:0}var p=new Int32Array(4*r),h=0;for(o=0;o<t;o++){a=i[3*o+0],s=i[3*o+1],l=i[3*o+2],c=n[3*o+0],u=n[3*o+1],d=n[3*o+2];(a===f||c<u)&&(p[h++]=c,p[h++]=u,p[h++]=o,p[h++]=a),(s===f||u<d)&&(p[h++]=u,p[h++]=d,p[h++]=o,p[h++]=s),(l===f||d<c)&&(p[h++]=d,p[h++]=c,p[h++]=o,p[h++]=l)}return p}function d(e){for(var t=e.faces.length/3,n=e.vertices.position,i=e.faces,o=h.v0,a=h.v1,s=h.v2,l=new Float32Array(3*t),c=0;c<t;c++){var u=i[3*c+0],d=i[3*c+1],f=i[3*c+2];n.getVec(u,o),n.getVec(d,a),n.getVec(f,s),r.vec3.subtract(a,a,o),r.vec3.subtract(s,s,o),r.vec3.cross(o,a,s),r.vec3.normalize(o,o),l[3*c+0]=o[0],l[3*c+1]=o[1],l[3*c+2]=o[2]}return l}Object.defineProperty(t,"__esModule",{value:!0});var f=-1;t.extractEdges=function(e,t,o,h){void 0===h&&(h=v);var g=e.vertices.position,m=e.vertices.componentIndex,y=a.deg2rad(h.anglePlanar),b=a.deg2rad(h.angleSignificantEdge),x=Math.cos(b),_=Math.cos(y),S=p.edge,w=S.position0,T=S.position1,E=S.faceNormal0,P=S.faceNormal1,C=d(e),A=u(e),O=A.length/4,R=t.allocate(O),M=0,D=O,I=o.allocate(D),L=0,V=0,F=0,B=n.range(0,O),N=new Float32Array(O);i.forEach(N,function(e,t,n){g.getVec(A[4*t+0],w),g.getVec(A[4*t+1],T),n[t]=r.vec3.distance(w,T)}),B.sort(function(e,t){return N[t]-N[e]});for(var z=new Array,U=new Array,j=0;j<O;j++){var G=B[j],H=N[G],k=A[4*G+0],W=A[4*G+1],X=A[4*G+2],q=A[4*G+3],Y=q===f;if(g.getVec(k,w),g.getVec(W,T),Y)r.vec3.set(E,C[3*X+0],C[3*X+1],C[3*X+2]),r.vec3.copy(P,E),S.componentIndex=m.get(k),S.cosAngle=r.vec3.dot(E,P);else{if(r.vec3.set(E,C[3*X+0],C[3*X+1],C[3*X+2]),r.vec3.set(P,C[3*q+0],C[3*q+1],C[3*q+2]),S.componentIndex=m.get(k),S.cosAngle=r.vec3.dot(E,P),l(S,_))continue;S.cosAngle<-.9999&&r.vec3.copy(P,E)}V+=H,F++,Y||s(S,x)?(t.write(R,M++,S),z.push(H)):c(S,y)&&(o.write(I,L++,S),U.push(H))}var Z=new Float32Array(z.reverse()),K=new Float32Array(U.reverse());return{regular:{instancesData:t.trim(R,M),lodInfo:{lengths:Z}},silhouette:{instancesData:o.trim(I,L),lodInfo:{lengths:K}},averageEdgeLength:V/F}};var p={edge:{position0:o.vec3f64.create(),position1:o.vec3f64.create(),faceNormal0:o.vec3f64.create(),faceNormal1:o.vec3f64.create(),componentIndex:0,cosAngle:0},ortho:o.vec3f64.create(),fwd:o.vec3f64.create()},h={v0:o.vec3f64.create(),v1:o.vec3f64.create(),v2:o.vec3f64.create()},v={anglePlanar:4,angleSignificantEdge:35}}.apply(null,i))||(e.exports=r)},krVM:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("Rdxj"),n("05NA"),n("qUb7"),n("I67D"),n("JUgm")],void 0===(r=function(e,t,n,i,r,o,a){function s(e){return"function"==typeof e.addParentStage&&"function"==typeof e.removeParentStage}return function(){function e(e,t,i,s){this.sceneIntersectionHelper=s,this._viewContent=[],this.container=t,this.viewingMode=e,this.model=new o,this.view=new a(t,this,this.model.getDirtySet(),i),this.view.setLighting({lights:[new r.MainLight(n.vec3f64.fromValues(.7,.7,.7)),new r.AmbientLight(n.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}return e.prototype.setNeedsRender=function(){this.view.setNeedsRender()},e.prototype.dispose=function(){this.view.dispose(),this.view=null,this.model=null},e.prototype.add=function(e,t){this.model.add(e,t),s(t)&&t.addParentStage(this)},e.prototype.remove=function(e,t){var n=this.model.remove(e,t);return s(n)&&n.removeParentStage(this),n},e.prototype.notifyDirty=function(e,t,n,i){this.model.notifyDirty(e,t,n,i)},e.prototype.processDirty=function(){var t=this.model.getDirtySet(),n=t.getDirtyMaterials();if(t.hasDirtyGeometryRecords()||n){e.DebugSettings.logDirtySet;var i=t.commitLayers(this._viewContent);(i[0].length+i[1].length+i[2].length>0||n)&&this.view.modify(i[0],i[1],i[2],n),e.DebugSettings.logDirtySet,t.commit(),t.clearDirtyMaterials(),this.view.setNeedsRender()}},e.prototype.processDirtyLayer=function(e){var t=this.model.getDirtySet(),n=t.getDirtyMaterials(),i=t.commitLayers([e]);(i[0].length+i[1].length+i[2].length>0||n)&&this.view.modify(i[0],i[1],i[2],n),t.clearDirtyMaterials(),this.view.setNeedsRender()},e.prototype.get=function(e,t){return this.model.get(e,t)},e.prototype.getAll=function(e){return this.model.getAll(e)},e.prototype.getCamera=function(){return this.view.getCamera()},e.prototype.setCamera=function(e){this.view.setCamera(e)},e.prototype.setViewParams=function(e){this.view.setViewParams(e)},e.prototype.getLayers=function(){return this.model.getAll(i.LAYER)},e.prototype.setLighting=function(e){this.view.setLighting(e)},e.prototype.getCanvas=function(){return this.view.getCanvas()},e.prototype.setRenderParams=function(e){this.view.setRenderParams(e)},e.prototype.getRenderParams=function(){return this.view.getRenderParams()},e.prototype.has=function(e){return this.view.has(e)},e.prototype.getViewContent=function(){return this._viewContent.slice(0)},e.prototype.addToViewContent=function(e){for(var t=[],n=0;n<e.length;n++)-1===this._viewContent.indexOf(e[n])&&t.push(e[n]);if(e.length>0){this.processDirty();var i=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(t);this.view.modify(i,[],[]),this._viewContent.push.apply(this._viewContent,t)}},e.prototype.removeFromViewContent=function(e){this.processDirty();for(var t=this.model.getDirtySet(),n=this._viewContent,i=[],r=0;r<e.length;r++){var o=n.indexOf(e[r]);o>-1&&(n[o]=n[n.length-1],n.pop(),i.push(e[r]))}var a=t.getResidentRenderGeometriesFilteredByLayers(i);this.view.modify([],a,[])},e.prototype.getFrameTask=function(){return this.view.getFrameTask()},e.prototype.takeScreenshot=function(e){return this.view.takeScreenshot(e)},e.prototype.addRenderPlugin=function(e,t){return"intersect"in t&&this.sceneIntersectionHelper.addIntersectionHandler(t),this.view.renderPlugins.add(e,t)},e.prototype.removeRenderPlugin=function(e){return"intersect"in e&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.view.renderPlugins.remove(e)},e.prototype.getContentDebugStrings=function(e){return this.model.formatDebugInfo(e)},e.prototype.getRenderStats=function(){return this.view.getCombinedStats()},e.prototype.getRenderStatString=function(e){var t=this.getRenderStats(),n="";if(e){for(var i in n+="<table>",t)n+="<tr><td>"+i+'</td><td style="text-align: right">'+Math.round(t[i])+"</td></tr>";n+="</table>"}else for(var i in t)n+=i+": "+t[i]+"\n";return n},e.prototype.getFramebufferTexture=function(e){return void 0===e&&(e="color"),this.view.getFramebufferTexture(e)},e.prototype.getDrapedRenderer=function(){return this.view.getDrapedRenderer()},e.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},e.ModelContentType=i,e}()}.apply(null,i))||(e.exports=r)},mYMs:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("SyoC"),n("KBgh"),n("0LE5"),n("Rdxj"),n("aWgr"),n("CIy2")],void 0===(r=function(e,t,n,i,r,o,a,s){function l(e,t,n){e[0]=Math.min(e[0],t[0]-n),e[1]=Math.min(e[1],t[1]-n),e[2]=Math.min(e[2],t[2]-n)}function c(e,t,n){e[0]=Math.max(e[0],t[0]+n),e[1]=Math.max(e[1],t[1]+n),e[2]=Math.max(e[2],t[2]+n)}function u(e,t,n){return(n=n||e)[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n}function d(e,t,n){return!a.frustum.intersectsSphere(n.planes,a.sphere.wrap(t,e))}function f(e,t,n){if(!M.length)for(var i=0;i<8;++i)M.push({index:0,distance:0});for(i=0;i<8;++i){var r=m[i];M.data[i].index=i,M.data[i].distance=h(e,t,r)}M.sort(function(e,t){return e.distance-t.distance}),n.clear();for(i=0;i<8;++i)n.push(M.data[i].index)}function p(e,t){for(var n=1/0,i=null,r=0;r<8;++r){var o=h(e,t,y[r]);o<n&&(n=o,i=y[r])}return i}function h(e,t,n){return t*(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])}var v=function(){function e(e,t,n,i){this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,this._objectToBoundingSphere=n,i&&(void 0!==i.maximumObjectsPerNode&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),void 0!==i.maximumDepth&&(this._maximumDepth=i.maximumDepth)),isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(t)?this._root=new g(null,o.vec3f64.fromValues(0,0,0),.5):this._root=new g(null,e,t/2)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._degenerateObjects.clear(),this._root=null,g.clearPool(),x=[null],E.prune(),M.prune(),D.prune()},e.prototype.add=function(e,t){var n=this._objectOrObjectsArray(e);t=null==t?n.length:t,this._objectCount+=t,this._grow(n);for(var i=g.acquire(),r=0;r<t;r++){var o=n[r];i.init(this._root),this._isDegenerate(o)?this._degenerateObjects.add(o):this._add(o,i)}g.release(i)},e.prototype.remove=function(e,t){var n=this._objectOrObjectsArray(e);this._objectCount-=n.length;for(var i=g.acquire(),r=0;r<n.length;r++){var o=n[r],a=t||this._boundingSphereFromObject(o,P);this._isValidRadius(a.radius)?(i.init(this._root),this._remove(o,a,i)):this._degenerateObjects.delete(o)}g.release(i),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,n){var i=this;this._forEachNode(this._root,function(r){if(!i._intersectsNode(e,t,r))return!1;var o=r.node;return o.terminals.forEach(function(r){i._intersectsObject(e,t,r)&&n(r)}),null!==o.residents&&o.residents.forEach(function(r){i._intersectsObject(e,t,r)&&n(r)}),!0})},e.prototype.forEach=function(e){this._forEachNode(this._root,function(t){var n=t.node;return n.terminals.forEach(e),null!==n.residents&&n.residents.forEach(e),!0}),this._degenerateObjects.forEach(e)},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,n,i,r){return this._findClosest(e,"front-to-back"===t?1:-1,n,i,r)},e.prototype.forEachInDepthRange=function(e,t,n,i,r,o,a,s){this._forEachInDepthRange(e,t,"front-to-back"===n?1:-1,i,r,o,a,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,function(t){return e(t.node,t.center,2*t.halfSize)})},e.prototype._intersectsNode=function(e,t,n){return u(n.center,2*-n.halfSize,w),u(n.center,2*n.halfSize,T),s.rayBoxTest(e,t,w,T)},e.prototype._intersectsObject=function(e,t,n){var i=this._objectToBoundingSphere.getRadius(n);return!(i>0)||a.sphere.intersectsRay(a.sphere.wrap(i,this._objectToBoundingSphere.getCenter(n)),a.ray.wrap(e,t))},e.prototype._forEachNode=function(e,t){for(var n=g.acquire().init(e),i=[n];0!==i.length;){if(t(n=i.pop())&&!n.isLeaf())for(var r=0;r<n.node.children.length;r++){n.node.children[r]&&i.push(g.acquire().init(n).advance(r))}g.release(n)}},e.prototype._forEachNodeDepthOrdered=function(e,t,n,i){void 0===i&&(i=1);var r=g.acquire().init(e),o=[r];for(f(n,i,D);0!==o.length;){if(t(r=o.pop())&&!r.isLeaf())for(var a=7;a>=0;--a){var s=D.data[a];if(!(s>=r.node.children.length))r.node.children[s]&&o.push(g.acquire().init(r).advance(s))}g.release(r)}},e.prototype._findClosest=function(e,t,n,i,o){var a=this,s=1/0,l=1/0,c=null,u=p(e,t),f=0,v=function(r){if(++f,!i||i(r)){var o=a._objectToBoundingSphere.getCenter(r),u=a._objectToBoundingSphere.getRadius(r);if(!n||!d(o,u,n)){var p=h(e,t,o),v=p-u;v<s&&(s=v,l=p+u,c=r)}}};return this._forEachNodeDepthOrdered(this._root,function(i){if(null!=o&&f>=o)return!1;if(n&&d(i.center,i.halfSize*b,n))return!1;if(r.vec3.scale(S,u,i.halfSize),r.vec3.add(S,S,i.center),h(e,t,S)>l)return!1;var a=i.node;return a.terminals.forEach(function(e){v(e)}),null!==a.residents&&a.residents.forEach(function(e){v(e)}),!0},e,t),c},e.prototype._forEachInDepthRange=function(e,t,n,i,o,a,s,l){var c=this,u=-1/0,f=1/0,v={setRange:function(e){1===n?(u=Math.max(u,e.near),f=Math.min(f,e.far)):(u=Math.max(u,-e.far),f=Math.min(f,-e.near))}};v.setRange(i);var g=h(t,n,e),m=p(t,n),y=p(t,-1*n),x=0,_=function(e){if(++x,!s||s(e)){var i=c._objectToBoundingSphere.getCenter(e),r=c._objectToBoundingSphere.getRadius(e),l=h(t,n,i)-g;l-r>f||l+r<u||a&&d(i,r,a)||o(e,v)}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=l&&x>=l)return!1;if(a&&d(e.center,e.halfSize*b,a))return!1;if(r.vec3.scale(S,m,e.halfSize),r.vec3.add(S,S,e.center),h(t,n,S)-g>f)return!1;if(r.vec3.scale(S,y,e.halfSize),r.vec3.add(S,S,e.center),h(t,n,S)-g<u)return!1;var i=e.node;return i.terminals.forEach(function(e){_(e)}),null!==i.residents&&i.residents.forEach(function(e){_(e)}),!0},t,n)},e.prototype._objectOrObjectsArray=function(e){return Array.isArray(e)?e:(x[0]=e,x)},e.prototype._remove=function(e,t,n){E.clear();var i=n.advanceTo(t,function(e,t){E.push(e.node),E.push(t)})?n.node.terminals:n.node.residents;if(i.removeUnordered(e),0===i.length)for(var r=E.length-2;r>=0;r-=2){var o=E.data[r],a=E.data[r+1];if(!this._purge(o,a))break}},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new i({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,P))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var n=0;n<t.length;n++){var i=g.acquire().init(e);this._add(t.data[n],i),g.release(i)}},e.prototype._grow=function(e){var t=this;if(0!==e.length){var n=this._boundingSphereFromObjects(e,function(e,n){return t._boundingSphereFromObject(e,n)},C);if(this._isValidRadius(n.radius)&&!this._fitsInsideTree(n))if(this._nodeIsEmpty(this._root.node))r.vec3.copy(this._root.center,n.center),this._root.halfSize=1.25*n.radius;else{var i=g.acquire();this._rootBoundsForRootAsSubNode(n,i),this._placingRootViolatesMaxDepth(i)?this._rebuildTree(n,i):this._growRootAsSubNode(i),g.release(i)}}},e.prototype._rebuildTree=function(e,t){var n=this;r.vec3.copy(A.center,t.center),A.radius=t.halfSize;var i=this._boundingSphereFromObjects([e,A],function(e){return e},O),o=g.acquire().init(this._root);this._root.initFrom(null,i.center,1.25*i.radius),this._forEachNode(o,function(e){return n.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&n.add(e.node.residents.data,e.node.residents.length),!0}),g.release(o)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,function(e){return t=Math.max(t,e.depth),!0}),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var n=e.radius,i=e.center,r=-1/0,o=this._root.center,a=this._root.halfSize,s=0;s<3;s++){var l=o[s]-a-(i[s]-n),c=i[s]+n-(o[s]+a),u=Math.max(0,Math.ceil(l/(2*a))),d=Math.max(0,Math.ceil(c/(2*a)))+1,f=Math.pow(2,Math.ceil(Math.log(u+d)*Math.LOG2E));r=Math.max(r,f),R[s].min=u,R[s].max=d}for(s=0;s<3;s++){var p=(r-((u=R[s].min)+(d=R[s].max)))/2;u+=Math.ceil(p),d+=Math.floor(p);var h=o[s]-a-u*a*2;_[s]=h+(d+u)*a}return t.initFrom(null,_,r*a,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;r.vec3.copy(C.center,this._root.center),C.radius=this._root.halfSize,this._root.init(e),e.advanceTo(C,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,n=0,i=0;i<t.length&&null==e;)e=t[n=i++];for(;i<t.length;)if(t[i++])return-1;return n},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,n=this._root.halfSize,i=e.center;return e.radius<=n&&i[0]>=t[0]-n&&i[0]<=t[0]+n&&i[1]>=t[1]-n&&i[1]<=t[1]+n&&i[2]>=t[2]-n&&i[2]<=t[2]+n},e.prototype._boundingSphereFromObject=function(e,t){return r.vec3.copy(t.center,this._objectToBoundingSphere.getCenter(e)),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,n){if(1===e.length){var i=t(e[0],C);r.vec3.copy(n.center,i.center),n.radius=i.radius}else{w[0]=1/0,w[1]=1/0,w[2]=1/0,T[0]=-1/0,T[1]=-1/0,T[2]=-1/0;for(var o=0;o<e.length;o++){i=t(e[o],C);this._isValidRadius(i.radius)&&(l(w,i.center,i.radius),c(T,i.center,i.radius))}r.vec3.lerp(n.center,w,T,.5),n.radius=Math.max(T[0]-w[0],T[1]-w[1],T[2]-w[2])/2}return n},e}(),g=function(){function e(e,t,n,i){void 0===n&&(n=0),void 0===i&&(i=0),this.center=o.vec3f64.create(),this.initFrom(e,t,n,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,n,i,o){return void 0===t&&(t=null),void 0===i&&(i=this.halfSize),void 0===o&&(o=this.depth),this.node=t||e.createEmptyNode(),n&&r.vec3.copy(this.center,n),this.halfSize=i,this.depth=o,this},e.prototype.advance=function(t){var n=this.node.children[t];n||(n=e.createEmptyNode(),this.node.children[t]=n),this.node=n,this.halfSize/=2,this.depth++;var i=m[t];return this.center[0]+=i[0]*this.halfSize,this.center[1]+=i[1]*this.halfSize,this.center[2]+=i[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,n){for(void 0===n&&(n=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!n)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var i=this._childIndex(e);t&&t(this,i),this.advance(i)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,n=this.center,i=0,r=0;r<3;r++)n[r]<t[r]&&(i|=1<<r);return i},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new i({shrink:!0}),residents:new i({shrink:!0})}},e.acquire=function(){return e._pool.acquire()},e.release=function(t){e._pool.release(t)},e.clearPool=function(){e._pool.prune()},e._pool=new n(e),e}(),m=[o.vec3f64.fromValues(-1,-1,-1),o.vec3f64.fromValues(1,-1,-1),o.vec3f64.fromValues(-1,1,-1),o.vec3f64.fromValues(1,1,-1),o.vec3f64.fromValues(-1,-1,1),o.vec3f64.fromValues(1,-1,1),o.vec3f64.fromValues(-1,1,1),o.vec3f64.fromValues(1,1,1)],y=[o.vec3f64.fromValues(-1,-1,-1),o.vec3f64.fromValues(-1,-1,1),o.vec3f64.fromValues(-1,1,-1),o.vec3f64.fromValues(-1,1,1),o.vec3f64.fromValues(1,-1,-1),o.vec3f64.fromValues(1,-1,1),o.vec3f64.fromValues(1,1,-1),o.vec3f64.fromValues(1,1,1)],b=Math.sqrt(3),x=[null],_=o.vec3f64.create(),S=o.vec3f64.create(),w=o.vec3f64.create(),T=o.vec3f64.create(),E=new i,P={center:o.vec3f64.create(),radius:0},C={center:o.vec3f64.create(),radius:0},A={center:o.vec3f64.create(),radius:0},O={center:o.vec3f64.create(),radius:0},R=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],M=new i,D=new i;return v}.apply(null,i))||(e.exports=r)},nBma:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("/Bau"),n("pBV3"),n("CIy2"),n("1CCn"),n("qbr3"),n("Kfys")],void 0===(r=function(e,t,n,i,r,o,a,s){var l=function(){function e(e,t){this.dimensions={width:4,height:4},this._enabled=!1,this._background={type:"color",color:[0,0,0,1]},this._compositePipelineState=new Map,this._rctx=t,this.renderTargetHelper=new i.RenderTargetHelper(t);var n=this.renderTargetHelper;this.mainColor=n.registerColorTarget({name:"mainColor"}),this.mainDepth=n.registerDepthTarget({name:"mainDepth"}),this.linearDepth=n.registerColorTarget({name:"linearDepth"}),this.normal=n.registerColorTarget({name:"normal"}),this.highlight=n.registerColorTarget({name:"highlight",dataType:32819}),this.hudVisibility=n.registerColorTarget({name:"hudVisibility",dataType:32819}),this.tmpColor=n.registerColorTarget({name:"tmpColor"}),this.tmpDepth=n.registerDepthTarget({name:"tmpDepth"}),this._compositeProgram=e.getProgram(o.composite),this._compositePipelineState.set("none",a.makePipelineState({colorWrite:a.defaultColorWriteParams})),this._compositePipelineState.set("alpha",a.makePipelineState({blending:a.separateBlendingParams(770,1,771,771),colorWrite:a.defaultColorWriteParams})),this._compositePipelineState.set("premultiplied-alpha",a.makePipelineState({blending:a.simpleBlendingParams(1,771),colorWrite:a.defaultColorWriteParams})),this._compositeTransparentToHUDVisibilityProgram=e.getProgram(o.compositeTransparentToHUDVisibility),this._compositeTransparentToHUDVisibilityPipelineState=a.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}}),this._compositeOccludedProgram=e.getProgram(o.compositeOccluded),this._compositeOccludedPipelineState=a.makePipelineState({blending:a.simpleBlendingParams(1,771),colorWrite:a.defaultColorWriteParams})}return Object.defineProperty(e.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(e){this._background=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTexture",{get:function(){return this.framebuffer.depthStencilTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tmpColorTexture",{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!0,configurable:!0}),e.prototype.initializeFrame=function(e,t){r.assert(this.enabled);var n=this._rctx;this.dimensions.width=e.fullWidth,this.dimensions.height=e.fullHeight,this.outputFramebuffer=t,this.bindTarget(this.mainColor,this.mainDepth),n.setClearStencil(0);var i=this._background.color;n.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),n.clearSafe(17664)},e.prototype.renderSeparateAndComposite=function(e,t,n){void 0===t&&(t=c),void 0===n&&(n=u),this.renderToTargets(e,this.tmpColor,this.mainDepth,t),this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,n)},e.prototype.renderHUDVisibility=function(e){this.renderToTargets(e,this.hudVisibility,this.mainDepth,d)},e.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var e=this,t=this._rctx;this.renderToTargets(function(){var n=e._compositeTransparentToHUDVisibilityProgram;t.bindProgram(n),t.setPipelineState(e._compositeTransparentToHUDVisibilityPipelineState),n.setUniform1i("tex",1),t.bindTexture(e.getColorTexture(e.tmpColor),1),t.bindVAO(e.quadVAO),t.drawArrays(5,0,s.vertexCount(e.quadVAO,"geometry"))},this.hudVisibility,this.mainDepth)},e.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")},e.prototype.compositeOccludedOntoMain=function(e){var t=this._rctx,n=this._compositeOccludedProgram;this.bindFramebuffer(),t.bindProgram(n),t.setPipelineState(this._compositeOccludedPipelineState),t.bindVAO(this.quadVAO),t.bindTexture(this.getColorTexture(this.tmpColor),0),n.setUniform1i("occludedColorMap",0),n.setUniform1f("opacity",e),t.drawArrays(5,0,s.vertexCount(this.quadVAO,"geometry")),t.bindVAO(null)},e.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)},e.prototype.renderDepthDetached=function(e){e(this.bindTarget(this.mainColor)),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.composite=function(e,t,n){void 0===e&&(e=this.framebuffer.colorTexture),void 0===t&&(t=this.outputFramebuffer),void 0===n&&(n=u);var i=this._rctx,r=this._compositeProgram;i.bindFramebuffer(t),i.bindProgram(r),i.setPipelineState(this._compositePipelineState.get(n)),r.setUniform1i("tex",1),i.bindTexture(e,1),i.bindVAO(this.quadVAO),i.drawArrays(5,0,s.vertexCount(this.quadVAO,"geometry"))},e.prototype.disposeTarget=function(e){this.renderTargetHelper.disposeTargetResource(e)},e.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=n.createQuadVAO(this._rctx))},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)},e.prototype.renderToTargets=function(e,t,n,i,r){var o=this._rctx,a=this.bindTarget(t,n),s=0;if(i){var l=Math.max(1e-13,i[3]);o.setClearColor(i[0],i[1],i[2],l),s|=16384}return r&&(s|=256),o.clearSafe(s),e(a),o.gl.flush(),this.bindTarget(this.mainColor,this.mainDepth),a},e.prototype.bindTarget=function(e,t){var n=this.renderTargetHelper.getFramebuffer(this.dimensions,e,t);return this._rctx.bindFramebuffer(n),n},e.prototype.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)},e.prototype.getGpuMemoryUsage=function(){var e=0;return this.renderTargetHelper&&(e+=this.renderTargetHelper.getGpuMemoryUsage()),e},e}(),c=[0,0,0,0],u="none",d=[0,1,0,1];return l}.apply(null,i))||(e.exports=r)},o5p5:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("xhoE"),n("2B1V"),n("tUyH"),n("FNtW"),n("CIy2"),n("hnAi"),n("s6rJ"),n("ZeO9"),n("FMAd"),n("qbr3")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d){var f=function(e){function t(t,n){var i=e.call(this,n)||this;return i.supportsEdges=!0,i.params=l.copyParameters(t,v),i}return n(t,e),t.prototype.setParameterValues=function(e){var t=this.params;for(var n in e)t[n]=e[n];this.notifyDirty("matChanged")},t.prototype.getParameters=function(){return this.params},t.prototype.setColor=function(e){this.params.color=e,this.notifyDirty("matChanged")},t.prototype.getColor=function(){return this.params.color},t.prototype.setTransparent=function(e){this.params.transparent=e,this.notifyDirty("matChanged")},t.prototype.getTransparent=function(){return this.params.transparent},t.prototype.intersect=function(e,t,n,i,r,o,a,s,c){l.intersectTriangleGeometry(e,t,n,i,r,o,a,c)},t.prototype.getGLMaterials=function(){return{color:p,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:h}},t.prototype.getAllTextureIds=function(){return[]},t.prototype.createBufferWriter=function(){return new m},t.prototype.createRenderer=function(e,t){return new c(e,t,this)},t}(o),p=function(e){function t(t,n,i){var r=e.call(this,t,n)||this;return r.updateParameters(),r}return n(t,e),t.prototype.updateParameters=function(){this.params=l.copyParameters(this.material.getParameters()),this.selectProgram()},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(u.colorPass,{vertexColors:e.vertexColors,slice:e.slicePlaneEnabled}),this.pipelineState=d.makePipelineState({blending:e.transparent&&d.separateBlendingParams(770,1,771,771),polygonOffset:e.polygonOffset&&y,culling:b(e.cullFace),depthTest:e.testDepth&&{func:513},depthWrite:e.writeDepth&&d.defaultDepthWriteParams,colorWrite:d.defaultColorWriteParams})},t.prototype.beginSlot=function(e){var t=4;return this.params.transparent&&(t=this.params.writeDepth?6:9),e===t},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var n=this.program,i=this.params;e.bindProgram(n),e.setPipelineState(this.pipelineState),n.setUniform4fv("eColor",i.color)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var n=this.program,i=this.params;l.bindView(t.origin,t.view,n),i.slicePlaneEnabled&&l.bindSlicePlane(t.origin,t.slicePlane,n)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 4},t}(r),h=function(e){function t(t,n,i){var r=e.call(this,t,n)||this;return r.updateParameters(),r}return n(t,e),t.prototype.updateParameters=function(){this.params=l.copyParameters(this.material.getParameters()),this.selectProgram()},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(u.colorPass,{vertexColors:e.vertexColors,slice:e.slicePlaneEnabled}),this.pipelineState=d.makePipelineState({polygonOffset:e.polygonOffset&&y,culling:b(e.cullFace),depthTest:e.testDepth&&{func:513},depthWrite:e.writeDepth&&d.defaultDepthWriteParams,colorWrite:d.defaultColorWriteParams})},t.prototype.beginSlot=function(e){return 4===e},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var n=this.program,i=this.params;e.bindProgram(n),e.setPipelineState(this.pipelineState),l.bindHighlightRendering(e,t,n),n.setUniform4fv("eColor",i.color)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var n=this.program,i=this.params;l.bindView(t.origin,t.view,n),i.slicePlaneEnabled&&l.bindSlicePlane(t.origin,t.slicePlane,n)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 4},t}(r),v={color:[1,1,1,1],transparent:!1,writeDepth:!0,testDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:"none"},g=i.newLayout().vec3f(a.VertexAttrConstants.POSITION).vec4u8(a.VertexAttrConstants.COLOR),m=function(){function e(){this.vertexBufferLayout=g}return e.prototype.allocate=function(e){return g.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices[a.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,n,i,r){s.writeDefaultAttributes(t,n,g,e.transformation,e.invTranspTransformation,i,r)},e}(),y={factor:1,units:1},b=function(e){return"none"!==e&&{face:"front"===e?1028:1029,mode:2305}};return f}.apply(null,i))||(e.exports=r)},ocJ8:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("qMld"),n("vtMp"),n("1xFi")],void 0===(r=function(e,t,n,i,r){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,o=e.layer.fullExtent,a=o&&o.spatialReference;return a?a.equals(t)?n.resolve(o.clone()):i.canProject(a,t)?n.resolve(i.project(o,t)):e.view.state.isLocal?r.projectGeometry(o,t,e.layer.portalItem).then(function(t){if(!e.destroyed&&t)return t}).catch(function(){return null}):n.resolve(null):n.resolve(null)}}.apply(null,i))||(e.exports=r)},p23x:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.applyToModelMatrix=function(e,t){var n=t,i=-e[0],r=-e[1],o=-e[2],a=n[3],s=n[7],l=n[11],c=n[15];n[0]+=a*i,n[1]+=a*r,n[2]+=a*o,n[4]+=s*i,n[5]+=s*r,n[6]+=s*o,n[8]+=l*i,n[9]+=l*r,n[10]+=l*o,n[12]+=c*i,n[13]+=c*r,n[14]+=c*o},t.applyToViewMatrix=function(e,t){var n=t,i=e[0],r=e[1],o=e[2];n[12]+=i*n[0]+r*n[4]+o*n[8],n[13]+=i*n[1]+r*n[5]+o*n[9],n[14]+=i*n[2]+r*n[6]+o*n[10],n[14]+=i*n[3]+r*n[7]+o*n[11]}}.apply(null,i))||(e.exports=r)},pBV3:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("2Atf"),n("/f24"),n("Rrc3"),n("Zp3t"),n("Kfys")],void 0===(r=function(e,t,n,i,r,o,a){Object.defineProperty(t,"__esModule",{value:!0});var s={dataType:5121},l={},c=function(){function e(e){this.rctx=e,this.activeTargets=new Set,this.depthTextures=new Map,this.depthBuffers=new Map,this.colorTextures=new Map,this.framebuffers=new Map,this.nextId=1,this.depthTextureSupported=e.capabilities.depthTexture}return e.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(e){return e.dispose()}),this.depthBuffers.clear(),this.depthTextures.forEach(function(e){return e.dispose()}),this.depthTextures.clear(),this.colorTextures.forEach(function(e){return e.dispose()}),this.colorTextures.clear()},e.prototype.disposeTargetResource=function(e){var t=e.id;this.activeTargets.has(t)&&(this.activeTargets.delete(t),this.depthTextures.has(t)&&(this.depthTextures.get(t).dispose(),this.depthTextures.delete(t)),this.depthBuffers.has(t)&&(this.depthBuffers.get(t).dispose(),this.depthBuffers.delete(t)),this.colorTextures.has(t)&&(this.colorTextures.get(t).dispose(),this.colorTextures.delete(t)))},e.prototype.getDepthTexture=function(e,t){if(this.depthTextureSupported){var n=this.depthTextures.get(e.id);return n&&(n.descriptor.width===t.width&&n.descriptor.height===t.height||(n.dispose(),n=void 0)),n||(n=new o(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height}),this.depthTextures.set(e.id,n),this.activeTargets.add(e.id)),n}},e.prototype.getDepthBuffer=function(e,t){if(!this.depthTextureSupported){var i=this.depthBuffers.get(e.id);return i?i.descriptor.width===t.width&&i.descriptor.height===t.height||i.resize(t.width,t.height):(i=new r(this.rctx,n({internalFormat:34041},t)),this.depthBuffers.set(e.id,i),this.activeTargets.add(e.id)),i}},e.prototype.getColorTexture=function(e,t){var n=this.colorTextures.get(e.id);return n&&(n.descriptor.width===t.width&&n.descriptor.height===t.height||(n.dispose(),n=void 0)),n||(n=new o(this.rctx,{target:3553,pixelFormat:6408,dataType:e.dataType,samplingMode:9729,wrapMode:33071,width:t.width,height:t.height}),this.colorTextures.set(e.id,n),this.activeTargets.add(e.id)),n},e.prototype.getAllocatedColorTexture=function(e){return this.colorTextures.get(e.id)},e.prototype.registerDepthTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return n({id:t},l,e)},e.prototype.registerColorTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return n({id:t},s,e)},e.prototype.getFramebuffer=function(e,t,n){var r=this.getKey(t,n),o=this.framebuffers.get(r),a=this.getColorTexture(t,e);if(this.depthTextureSupported){var s=n?this.getDepthTexture(n,e):void 0;return o?((o.width!==e.width||o.height!==e.height||o.colorTexture!==a||o.depthStencilTexture!==s)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e.width,e.height),o.attachColorTexture(a),o.attachDepthStencilTexture(s)),o):(o=n?i.createWithAttachments(this.rctx,a,{colorTarget:0,depthStencilTarget:4},s):i.createWithAttachments(this.rctx,a,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(r,o),o)}var l=n?this.getDepthBuffer(n,e):void 0;return o?((o.width!==e.width||o.height!==e.height||o.colorTexture!==a)&&(o.detachColorTexture(),o.detachDepthStencilBuffer(),o.resize(e.width,e.height),o.attachColorTexture(a),o.attachDepthStencilBuffer(l)),o):(o=i.createWithAttachments(this.rctx,a,{colorTarget:0,depthStencilTarget:n?3:0},l),this.framebuffers.set(r,o),o)},e.prototype.getKey=function(e,t){return e.id+"_"+(t?t.id:"X")+"_"+e.name+(t?"_"+t.name:"")},e.prototype.getGpuMemoryUsage=function(){var e=0,t=new Set,n=function(n){t.has(n)||(t.add(n),e+=a.getGpuMemoryUsage(n))};return this.depthTextures.forEach(n),this.colorTextures.forEach(n),this.depthBuffers.forEach(n),this.framebuffers.forEach(n),e},e}();t.RenderTargetHelper=c}.apply(null,i))||(e.exports=r)},pIuP:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,i,r){void 0===n&&(n=0),this.TypedArrayConstructor=e,this.elementCount=9;var o=this.TypedArrayConstructor;void 0===i&&(i=9*o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,a):new o(t,a,(r-n)/o.BYTES_PER_ELEMENT),this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getMat=function(e,t){for(var n=e*this.typedBufferStride,i=0;i<9;i++)t[i]=this.typedBuffer[n+i];return t},e.prototype.setMat=function(e,t){for(var n=e*this.typedBufferStride,i=0;i<9;i++)this.typedBuffer[n+i]=t[i]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,n){this.typedBuffer[e*this.typedBufferStride+t]=n},e.prototype.copyFrom=function(e,t,n){for(var i=this.typedBuffer,r=t.typedBuffer,o=e*this.typedBufferStride,a=n*t.typedBufferStride,s=0;s<9;++s)i[o+s]=r[a+s]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=9,e}();t.BufferViewMat3Impl=n}.apply(null,i))||(e.exports=r)},pbva:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("FXVB"),n("1m5D")],void 0===(r=function(e,t,n,i){return function(e,t,r,o,a,s,l,c,u){this.name=e,this.from=t,this.to=r,this.displayedIndexRange=o,this.highlightedIndexRanges=a,this.transformation=s,this.instanceParameters=l,this.idx=c,this.dataId=u,null!=s&&(this.transformationNormal=i.mat4f64.clone(s),n.mat4.invert(this.transformationNormal,this.transformationNormal),n.mat4.transpose(this.transformationNormal,this.transformationNormal))}}.apply(null,i))||(e.exports=r)},pgjK:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("DXwx"),n("7laH")],void 0===(r=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0});var r=null,o=[];t.enabled=!1,t.begin=function(){t.enabled&&(r=[])},t.trace=function(e){t.enabled&&null!=r&&r.push(e)},t.end=function(){if(t.enabled){var e=r;return r=null,e&&(o.forEach(function(t){return t(e)}),o.length=0),e}},t.instrumentContext=function(e){return t.enabled?i.default(e)?e:n.makeDebugContext(e,void 0,function(e,i){t.enabled&&r&&r.push("gl."+e+"("+n.glFunctionArgsToString(e,i)+")")}):e},t.request=function(e){o.push(e)}}.apply(null,i))||(e.exports=r)},"qC//":function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("2Atf"),n("AzkI"),n("CIy2"),n("Zp3t")],void 0===(r=function(e,t,n,i,r,o){function a(e,t){if(!e)return null;for(var n=e.length/2,i=s*n,r=new Array(n),o=0,a=1===t,c=0;c<e.length;c+=2){var u=(e[c]+e[c+1])/2;r[o++]=a?Math.min(i,1-(1-u)*l):Math.min(i,u*l)}return r}Object.defineProperty(t,"__esModule",{value:!0}),t.generateStrokesTexture=function(e){for(var n=t.strokesDefinition.resolution,s=n/2,l=new Uint8Array(4*n*n),c=4*n*s,u=t.strokesDefinition.amplitude,d=2*u,f=4*n,p=i.log2(n)+1,h=t.strokesDefinition.strokes.length,v=(p-1)*h*f,g=0,m=t.strokesDefinition.strokes;g<m.length;g++){for(var y=m[g],b=y.distance,x=y.pressure,_=v,S=0;S<p;S++){0!==S&&(b=a(b,0),x=a(x,1));for(var w=0;w<t.strokesDefinition.resolution;w++){var T=.5+(b?b[w%b.length]/d:0),E=x?x[w%x.length]:1;r.packFloatRGBA(T,l,_),r.packFloatRGBA(E,l,_+c),_+=4}_-=f*(h+1)}v+=f}return{resolution:n,texture:new o(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:n,height:n,wrapMode:10497},l),normalizationScale:d,amplitude:u,variants:h}};var s=.1,l=.5;t.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}}.apply(null,i))||(e.exports=r)},qUb7:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("Rdxj")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t,i){void 0===e&&(e=n.vec3f64.create()),void 0===t&&(t=n.vec3f64.fromValues(.57735,.57735,.57735)),void 0===i&&(i=!0),this.intensity=e,this.direction=t,this.castShadows=i};t.MainLight=i;var r=function(e,t){void 0===e&&(e=n.vec3f64.create()),void 0===t&&(t=n.vec3f64.fromValues(.57735,.57735,.57735)),this.intensity=n.vec3f64.create(),this.direction=n.vec3f64.create(),this.intensity=e,this.direction=t};t.FillLight=r;var o=function(e){void 0===e&&(e=n.vec3f64.create()),this.intensity=e};t.AmbientLight=o;var a=function(){this.sh={r:[0],g:[0],b:[0]}};t.SphericalHarmonicsLight=a}.apply(null,i))||(e.exports=r)},qbr3:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("2Atf")],void 0===(r=function(e,t,n){function i(e){return _.intern(e)}function r(e){return S.intern(e)}function o(e){return w.intern(e)}function a(e){return T.intern(e)}function s(e){return E.intern(e)}function l(e){return P.intern(e)}function c(e){return C.intern(e)}function u(e){return A.intern(e)}function d(e){return"["+e.join(",")+"]"}function f(e){return e?d([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}function p(e){return e?d([e.face,e.mode]):null}function h(e){return e?d([e.factor,e.units]):null}function v(e){return e?d([e.func]):null}function g(e){return e?d([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}function m(e){return e?d([e.zNear,e.zFar]):null}function y(e){return e?d([e.r,e.g,e.b,e.a]):null}function b(e){return e?d([e.mask]):null}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleBlendingParams=function(e,t,n,i){return void 0===n&&(n=32774),void 0===i&&(i=[0,0,0,0]),{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:n,opAlpha:n,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}},t.separateBlendingParams=function(e,t,n,i,r,o,a){return void 0===r&&(r=32774),void 0===o&&(o=32774),void 0===a&&(a=[0,0,0,0]),{srcRgb:e,srcAlpha:t,dstRgb:n,dstAlpha:i,opRgb:r,opAlpha:o,color:{r:a[0],g:a[1],b:a[2],a:a[3]}}},t.backFaceCullingParams={face:1029,mode:2305},t.defaultDepthWriteParams={zNear:0,zFar:1},t.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0},t.makeBlending=i,t.makeCulling=r,t.makePolygonOffset=o,t.makeDepthTest=a,t.makeStencilTest=s,t.makeDepthWrite=l,t.makeColorWrite=c,t.makeStencilWrite=u,t.makePipelineState=function(e){return O.intern(e)};var x=function(){function e(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}return e.prototype.intern=function(e){if(!e)return null;var t=this.makeKey(e),n=this.interns;return n.has(t)||n.set(t,this.makeRef(e)),n.get(t)},e}(),_=new x(f,function(e){return n({__tag:"Blending"},e)}),S=new x(p,function(e){return n({__tag:"Culling"},e)}),w=new x(h,function(e){return n({__tag:"PolygonOffset"},e)}),T=new x(v,function(e){return n({__tag:"DepthTest"},e)}),E=new x(g,function(e){return n({__tag:"StencilTest"},e)}),P=new x(m,function(e){return n({__tag:"DepthWrite"},e)}),C=new x(y,function(e){return n({__tag:"ColorWrite"},e)}),A=new x(b,function(e){return n({__tag:"StencilWrite"},e)}),O=new x(function(e){return e?d([f(e.blending),p(e.culling),h(e.polygonOffset),v(e.depthTest),g(e.stencilTest),m(e.depthWrite),y(e.colorWrite),b(e.stencilWrite)]):null},function(e){return{blending:i(e.blending),culling:r(e.culling),polygonOffset:o(e.polygonOffset),depthTest:a(e.depthTest),stencilTest:s(e.stencilTest),depthWrite:l(e.depthWrite),colorWrite:c(e.colorWrite),stencilWrite:u(e.stencilWrite)}}),R=function(){function e(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}return e.prototype.setPipeline=function(e){(this._pipelineInvalid||e!==this._pipeline)&&(this.setBlending(e.blending),this.setCulling(e.culling),this.setPolygonOffset(e.polygonOffset),this.setDepthTest(e.depthTest),this.setStencilTest(e.stencilTest),this.setDepthWrite(e.depthWrite),this.setColorWrite(e.colorWrite),this.setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1},e.prototype.invalidateBlending=function(){this._blendingInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateCulling=function(){this._cullingInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidatePolygonOffset=function(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateDepthTest=function(){this._depthTestInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateStencilTest=function(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateDepthWrite=function(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateColorWrite=function(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateStencilWrite=function(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0},e.prototype.setBlending=function(e){this._blending=this.setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1},e.prototype.setCulling=function(e){this._culling=this.setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1},e.prototype.setPolygonOffset=function(e){this._polygonOffset=this.setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1},e.prototype.setDepthTest=function(e){this._depthTest=this.setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1},e.prototype.setStencilTest=function(e){this._stencilTest=this.setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1},e.prototype.setDepthWrite=function(e){this._depthWrite=this.setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1},e.prototype.setColorWrite=function(e){this._colorWrite=this.setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1},e.prototype.setStencilWrite=function(e){this._stencilWrite=this.setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1},e.prototype.setSubState=function(e,t,n,i){return(n||e!==t)&&(i(e),this._pipelineInvalid=!0),e},e}();t.StateTracker=R}.apply(null,i))||(e.exports=r)},qvwY:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){function n(e){return e instanceof Float32Array&&e.length>=16}function i(e){return Array.isArray(e)&&e.length>=16}Object.defineProperty(t,"__esModule",{value:!0}),t.isMat4f32=n,t.isMat4f64=i,t.isMat4=function(e){return n(e)||i(e)}}.apply(null,i))||(e.exports=r)},s6rJ:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("FXVB"),n("oZZu"),n("1m5D"),n("0LE5"),n("Rdxj"),n("2fXB"),n("WRgd"),n("AzkI"),n("rjU6"),n("1f+t"),n("+wMf"),n("CIy2")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p){function h(e,t,n,i,r){var o=b(t,n,C);if(l.setMin(E,e.getBBMin()),l.setMax(E,e.getBBMax()),x(E,t,o,i)){var a=e.getPrimitiveIndices(),s=e.getIndices(),c=e.getPosition(),u=a?a.length:s.length/3;if(u>F){var d=e.getChildren();if(void 0!==d){for(var f=0;f<8;++f)void 0!==d[f]&&h(d[f],t,n,i,r);return}}g(t,n,0,u,s,c,a,r)}}function v(e,t,n,i,r,o){var a=b(n,i,C),s=e.componentCount,c=e.componentOffsets,d=e.getIndices(P.POSITION),f=e.getAttribute(P.POSITION),p=e.boundingInfo;if(!p||(l.setMin(E,p.getBBMin()),l.setMax(E,p.getBBMax()),x(E,n,a,r)))for(var h=0;h<s;h++)if(!t||u.getVisibility(t,h)){if(e.getComponentAABB)if(!x(e.getComponentAABB(h,E),n,a,r))continue;g(n,i,c[h]/3,c[h+1]/3,d,f,void 0,o)}}function g(e,t,n,i,r,o,a,s){if(a)return m(e,t,n,i,r,o,a,s);for(var l=o.data,c=o.offsetIdx,u=o.strideIdx,d=e[0],f=e[1],p=e[2],h=t[0]-d,v=t[1]-f,g=t[2]-p,b=n,x=3*n;b<i;++b){var _=c+u*r[x++],S=l[_++],w=l[_++],T=l[_];_=c+u*r[x++];var E=l[_++],P=l[_++],C=l[_];_=c+u*r[x++];var R=E-S,M=P-w,D=C-T,I=l[_++]-S,L=l[_++]-w,V=l[_]-T,F=v*V-L*g,B=g*I-V*h,N=h*L-I*v,z=R*F+M*B+D*N;if(!(Math.abs(z)<=A)){var U=d-S,j=f-w,G=p-T,H=U*F+j*B+G*N;if(z>0){if(H<0||H>z)continue}else if(H>0||H<z)continue;var k=j*D-M*G,W=G*R-D*U,X=U*M-R*j,q=h*k+v*W+g*X;if(z>0){if(q<0||H+q>z)continue}else if(q>0||H+q<z)continue;var Y=(I*k+L*W+V*X)/z;Y>=0&&s(Y,y(R,M,D,I,L,V,O),b)}}}function m(e,t,n,i,r,o,a,s){for(var l=o.data,c=o.offsetIdx,u=o.strideIdx,d=e[0],f=e[1],p=e[2],h=t[0]-d,v=t[1]-f,g=t[2]-p,m=n;m<i;++m){var b=a[m],x=3*b,_=c+u*r[x++],S=l[_++],w=l[_++],T=l[_];_=c+u*r[x++];var E=l[_++],P=l[_++],C=l[_];_=c+u*r[x];var R=E-S,M=P-w,D=C-T,I=l[_++]-S,L=l[_++]-w,V=l[_]-T,F=v*V-L*g,B=g*I-V*h,N=h*L-I*v,z=R*F+M*B+D*N;if(!(Math.abs(z)<=A)){var U=d-S,j=f-w,G=p-T,H=U*F+j*B+G*N;if(z>0){if(H<0||H>z)continue}else if(H>0||H<z)continue;var k=j*D-M*G,W=G*R-D*U,X=U*M-R*j,q=h*k+v*W+g*X;if(z>0){if(q<0||H+q>z)continue}else if(q>0||H+q<z)continue;var Y=(I*k+L*W+V*X)/z;Y>=0&&s(Y,y(R,M,D,I,L,V,O),b)}}}function y(e,t,n,i,r,a,s){return o.vec3.set(R,e,t,n),o.vec3.set(M,i,r,a),o.vec3.cross(s,R,M),o.vec3.normalize(s,s),s}function b(e,t,n){return o.vec3.set(n,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function x(e,t,n,i){var r=(e[0]-i-t[0])*n[0],o=(e[3]+i-t[0])*n[0],a=Math.min(r,o),s=Math.max(r,o),l=(e[1]-i-t[1])*n[1],c=(e[4]+i-t[1])*n[1];if((a=Math.max(a,Math.min(l,c)))>(s=Math.min(s,Math.max(l,c))))return!1;var u=(e[2]-i-t[2])*n[2],d=(e[5]+i-t[2])*n[2];return(a=Math.max(a,Math.min(u,d)))<=(s=Math.min(s,Math.max(u,d)))}function _(e,t,n,i,r){return f.scale(e,i,n,r)}function S(e,t,n,i){return void 0===i&&(i=B),i.screenLength=e.screenLength,i.perDistance=Math.tan(.5*t)/(.5*n),i.minWorldLength=e.minWorldLength,i.maxWorldLength=e.maxWorldLength,i}function w(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(t,"__esModule",{value:!0});var T=r.mat4f64.create(),E=l.create(),P=p.VertexAttrConstants;t.IDENTITY=r.mat4f64.create(),t.intersectTriangleGeometry=function(e,t,n,i,r,o,a,s){var l=t&&t.componentVisibilities,c=i.tolerance;if(e.componentCount>1)v(e,l,r,o,c,a);else if(!l||u.getVisibility(l,0))if(e.boundingInfo)p.assert("triangle"===e.data.primitiveType),h(e.boundingInfo,r,o,c,a);else{var d=e.getIndices(P.POSITION),f=e.getAttribute(P.POSITION);g(r,o,0,d.length/3,d,f,void 0,a)}};var C=a.vec3f64.create(),A=Math.pow(2,-52),O=a.vec3f64.create();t.intersectTriangles=g;var R=a.vec3f64.create(),M=a.vec3f64.create();t.computeNormal=y,t.intersectAabbInvDir=x,t.transformToWorld=function(e,t,n){return s.vec4.set(n,e[0]-t[0],e[1]-t[1],e[2]-t[2],1)},t.transformToView=function(e,t,i,r){return n.mat4.translate(T,i,t),i=T,s.vec4.transformMat4(r,e,i)},t.transformToProjection=function(e,t,n,i){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i[3]=e[3],s.vec4.transformMat4(i,i,t)},t.transformToNDC=function(e,t){return s.vec4.scale(t,e,1/Math.abs(e[3]))},t.applyScreenSizePerspectiveScale=_,t.verticalOffsetAtDistance=function(e,t,n,i,r){var o=(n.screenLength||0)*e.pixelRatio;r&&(o=_(o,0,t,i,r));var a=o*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return c.clamp(a*t,n.minWorldLength||0,null!=n.maxWorldLength?n.maxWorldLength:1/0)},t.aquireIfNotUndefined=function(e,t,n){if(void 0!==e)return t.aquire(e,n)},t.releaseIfNotUndefined=function(e,t){void 0!==e&&t.release(e)};var D=i.mat4f32.create();t.bindView=function(e,t,i){n.mat4.translate(D,t,e),i.setUniform3fv("localOrigin",e),i.setUniformMatrix4fv("view",D)},t.bindCamPos=function(e,t,n){n.setUniform3f("camPos",t[3]-e[0],t[7]-e[1],t[11]-e[2])};var I=a.vec3f64.create(),L=a.vec3f64.create();t.bindViewOriginDouble=function(e,t){d.encodeDoubleArraySplit(e,I,L,3),t.setUniform3fv("viewOriginHi",I),t.setUniform3fv("viewOriginLo",L)};var V=a.vec3f64.create();t.bindSlicePlane=function(e,t,n){o.vec3.subtract(V,t.origin,e),n.setUniform3fv("slicePlaneOrigin",V),n.setUniform3fv("slicePlaneBasis1",t.basis1),n.setUniform3fv("slicePlaneBasis2",t.basis2)},t.bindVerticalOffset=function(e,t,n){if(e){var i=S(e,t.fovY,t.viewport[3]),r=t.pixelRatio||1;n.setUniform4f("verticalOffset",i.screenLength*r,i.perDistance,i.minWorldLength,i.maxWorldLength)}},t.bindHighlightRendering=function(e,t,n){e.bindTexture(t.highlightDepthTexture,5),n.setUniform1i("depthTex",5),n.setUniform4f("highlightViewportPixelSz",0,0,1/t.viewport[2],1/t.viewport[3])},t.bindScreenSizePerspective=function(e,t,n){if(void 0===n&&(n="screenSizePerspectiveAlignment"),e){var i=e.parameters,r=e.paddingPixelsOverride;t.setUniform4f(n,i.divisor,i.offset,i.minPixelSize,r)}},t.copyParameters=function e(t,n){var i=n?e(n):{};for(var r in t){var o=t[r];o&&o.forEach&&(o=w(o)),null==o&&r in i||(i[r]=o)}return i},t.updateParameters=function(e,t){var n=!1;for(var i in t){var r=t[i];void 0!==r&&(n=!0,Array.isArray(r)?e[i]=r.slice():e[i]=r)}return n},function(e){function t(e){return(e.shadowMappingEnabled?1:0)|(e.ssaoEnabled?2:0)}e.create=function(e,n){for(var i=[],r=0;r<2;r++)for(var o=0;o<2;o++){var a=t({shadowMappingEnabled:1===r,ssaoEnabled:1===o}),s=t({shadowMappingEnabled:1===r,ssaoEnabled:1===o&&e.receiveSSAO});i[a]=i[s]||n({receiveShadows:1===r,receiveSSAO:1===o&&e.receiveSSAO})}return{programs:i.filter(function(e){return null!=e}),byParameter:i}},e.lookup=function(e,n){return e.byParameter[t(n)]},e.programs=function(e){return e.programs}}(t.BindParametersMap||(t.BindParametersMap={})),t.intersectDrapedRenderLineGeometry=function(e,t,n,i,r,o,a,s,l){if(i.enable.selectionMode){for(var u=e.getAttribute(P.POSITION).data,d=e.getAttribute(P.SIZE),f=d&&d.data[0],p=o[0],h=o[1],v=((f+a)/2+4)*e.pixelRatio,g=Number.MAX_VALUE,m=0;m<u.length-5;m+=3){var y=u[m],b=u[m+1],x=p-y,_=h-b,S=u[m+3]-y,w=u[m+4]-b,T=S*x+w*_,E=S*S+w*w,C=c.clamp(T/E,0,1),A=S*C-x,O=w*C-_,R=A*A+O*O;R<g&&(g=R)}g<v*v&&s()}},t.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var F=1e3,B={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}}.apply(null,i))||(e.exports=r)},tUyH:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("xhoE"),n("fHD9")],void 0===(r=function(e,t,n,i){return function(e){function t(t,n){var i=e.call(this)||this;return i.material=t,i.programRep=n,i}return n(t,e),t.prototype.isVisible=function(){return this.material.isVisible()},t.prototype.isVisibleInPass=function(e){return this.material.isVisibleInPass(e)},t.prototype.getPrograms=function(){return[this.getProgram()]},t.prototype.getDrawMode=function(){return 4},t.prototype.release=function(e,t){},t}(i.ManagingDisposable)}.apply(null,i))||(e.exports=r)},uNX8:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("1m5D"),n("MzcX"),n("ff/U"),n("pbva"),n("PwS/"),n("QFi0"),n("Kfys"),n("z2+Q")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c){function u(e,t){var n=new Map,i=function(e,t){var i=e.origin.id,r=e.data.id,o=n.get(i);o||(o={origin:e.origin.vec3,deltaByGeometry:new Map},n.set(i,o));var a=o.deltaByGeometry.get(r);a||(a={renderData:e.data,toAdd:[],toRemove:[]},o.deltaByGeometry.set(r,a)),(t?a.toAdd:a.toRemove).push(e)};return e.forEach(function(e){i(e,!0)}),t.forEach(function(e){i(e,!1)}),n}function d(e,t,n){var i=t.elementCount(e),r=t.allocate(i);t.write({},e,null,r,0),n.setData(r.buffer)}return function(){function e(e,t,n){this._dataByOrigin=new Map,this._highlightCount=0,this._rctx=e,this._material=n,this._materialRep=t,this._glMaterials=a.acquireMaterials(this._material,this._materialRep),this._bufferWriter=n.createBufferWriter()}return e.prototype.dispose=function(){a.releaseMaterials(this._material,this._materialRep)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlightCount>0},enumerable:!0,configurable:!0}),e.prototype.renderPriority=function(){return this._material.renderPriority},e.prototype.modify=function(e){this.updateGeometries(e.toUpdate),this.addAndRemoveGeometries(e.toAdd,e.toRemove),this.updateHighlightCount()},e.prototype.addAndRemoveGeometries=function(e,t){var f=this._rctx,p=this._bufferWriter,h=this._dataByOrigin,v=u(e,t),g=p.vertexBufferLayout;v.forEach(function(e,t){var u=h.get(t);u||(u={origin:e.origin,highlightCount:0,dataByGeometry:new Map},h.set(t,u)),e.deltaByGeometry.forEach(function(e,t){var h=u.dataByGeometry.get(t);!h&&e.toAdd.length>0&&(h={vao:new c(f,r.Default3D,{geometry:i.glLayout(g)},{geometry:s.createVertex(f,35044)}),vertexCount:0,instances:new Map,highlightCount:0},d(e.renderData,p,h.vao.vertexBuffers.geometry),h.vertexCount=l.vertexCount(h.vao,"geometry"),u.dataByGeometry.set(t,h));var v=h.instances;e.toAdd.forEach(function(e){var t=n.mat4f64.create();a.calculateTransformRelToOrigin(e,t);var i=a.generateRenderGeometryVisibleIndexRanges(e),r=a.generateRenderGeometryHighlightRanges(e),s=new o(e.name,0,h.vertexCount,i,r,t,e.instanceParameters,e.idx,e.data.id);v.set(e.uniqueName,s),u.highlightCount=null,h.highlightCount=null}),e.toRemove.forEach(function(e){v.delete(e.uniqueName)}),0===v.size&&(h.vao.dispose(),u.dataByGeometry.delete(t))}),0===u.dataByGeometry.size&&h.delete(t)})},e.prototype.updateGeometries=function(e){var t=this._dataByOrigin,n=this._bufferWriter;e.forEach(function(e){var i=e.updateType,r=e.renderGeometry,o=t.get(r.origin.id),s=o&&o.dataByGeometry.get(r.data.id),l=s&&s.instances.get(r.uniqueName);l&&(1&i&&(l.displayedIndexRange=a.generateRenderGeometryVisibleIndexRanges(r)),17&i&&(l.highlightedIndexRanges=a.generateRenderGeometryHighlightRanges(r),o.highlightCount=null,s.highlightCount=null),2&i&&d(r.data,n,s.vao.vertexBuffers.geometry),4&i&&a.calculateTransformRelToOrigin(r,l.transformation,l.transformationNormal))})},e.prototype.updateHighlightCount=function(){var e=this;this._highlightCount=0,this._dataByOrigin.forEach(function(t){if(null==t.highlightCount){var n=0;t.dataByGeometry.forEach(function(e){if(null==e.highlightCount){var t=0;e.instances.forEach(function(e){e.highlightedIndexRanges&&++t}),e.highlightCount=t}n+=e.highlightCount}),t.highlightCount=n}e._highlightCount+=t.highlightCount})},e.prototype.render=function(e,t,n,i){var r=this,o=this._rctx,a=this._glMaterials.get(t.pass),s=4===t.pass;if(!a||null!=e&&!a.beginSlot(e)||s&&0===this._highlightCount)return!1;a.bind(o,n);var l=!1;return this._dataByOrigin.forEach(function(e){s&&0===e.highlightCount||(n.origin=e.origin,a.bindView(o,n),e.dataByGeometry.forEach(function(e){l=s?r.renderHighlightPass(a,e,i)||l:r.renderDefaultPass(a,e,i)||l}))}),o.bindVAO(null),a.release(o,n),l},e.prototype.renderDefaultPass=function(e,t,n){var i=this._rctx,r=e.getProgram(),o=e.getDrawMode(),s=t.vao,c=t.vertexCount;l.assertCompatibleVertexAttributeLocations(s,r),i.bindVAO(s);var u=!1;return t.instances.forEach(function(t){var r=t.displayedIndexRange;r&&0===r.length||(e.bindInstance(i,t),r?a.drawArraysFaceRange(i,r,0,o,n):a.drawArrays(i,o,0,c,n),u=!0)}),u},e.prototype.renderHighlightPass=function(e,t,n){var i=this._rctx,r=e.getProgram(),o=e.getDrawMode(),s=t.vao,c=t.vertexCount;if(0!==t.highlightCount){l.assertCompatibleVertexAttributeLocations(s,r),i.bindVAO(s);var u=!1;return t.instances.forEach(function(t){var r=t.highlightedIndexRanges;if(r&&0!==r.length){e.bindInstance(i,t);for(var s=0;s<r.length;s++){var l=r[s],d=l.range?l.range[0]:0,f=l.range?l.range[1]-l.range[0]+1:c;a.drawArrays(i,o,d,f,n),u=!0}}}),u}},e}()}.apply(null,i))||(e.exports=r)},uwSd:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BASE_TEXTURE_UNIT=33984}.apply(null,i))||(e.exports=r)},veTl:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("7laH")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(n.default(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;var i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}}.apply(null,i))||(e.exports=r)},wKWA:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}return Object.defineProperty(e.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0}),e.prototype.aquire=function(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0},e.prototype.release=function(e){this.recycledIndices.push(e)},e}();t.SimpleIndexManager=n}.apply(null,i))||(e.exports=r)},weRx:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("zp6E")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),r=new Uint8Array(i),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return new Blob([i],{type:n})},t.requestImage=function(e){return n(e,{responseType:"image"}).then(function(e){return e.data})}}.apply(null,i))||(e.exports=r)},xFEL:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("xhoE"),n("jBNx"),n("YX1r"),n("51bw"),n("FXVB"),n("1m5D"),n("W9tT"),n("DIqE"),n("0LE5"),n("Rdxj"),n("qvwY"),n("lRq4"),n("2B1V"),n("rjU6"),n("9FJH"),n("FNtW"),n("+wMf"),n("CIy2"),n("hnAi"),n("s6rJ"),n("ZeO9"),n("Yr/n"),n("qbr3")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v,g,m,y,b,x,_,S,w,T){function E(e,t,n){var i=n.cameraAboveGround?1:-1;e.setUniform1f("cameraGroundRelative",i),e.setUniform1f("polygonOffset",t.shaderPolygonOffset),e.setUniform4fv("viewport",n.viewport),e.setUniform1f("perDistancePixelRatio",Math.tan(n.fovY/2)/(n.viewport[2]/2)),_.bindVerticalOffset(t.verticalOffset,n,e),e.setUniformMatrix4fv("viewNormal",n.viewInvTransp),t.screenSizePerspective&&(_.bindScreenSizePerspective(t.screenSizePerspective,e,"screenSizePerspective"),_.bindScreenSizePerspective(t.screenSizePerspectiveAlignment||t.screenSizePerspective,e,"screenSizePerspectiveAlignment"))}function P(e,t,n,i){n.occlusionTest&&(t.setUniform1i("hudVisibilityTexture",1),e.bindTexture(i.hudVisibilityTexture,1),e.setActiveTexture(0)),t.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===i.renderTransparentlyOccludedHUD?1:"notOccluded"===i.renderTransparentlyOccludedHUD?0:.75);var r=i.pixelRatio||1;t.setUniform4fv("overrideColor",n.color),t.setUniform1f("pixelRatio",r),n.textureIsSignedDistanceField&&(t.setUniform4fv("outlineColor",n.outlineColor),t.setUniform1f("outlineSize",n.outlineSize)),n.vvSizeEnabled&&(t.setUniform3fv("vvSizeMinSize",n.vvSizeMinSize),t.setUniform3fv("vvSizeMaxSize",n.vvSizeMaxSize),t.setUniform3fv("vvSizeOffset",n.vvSizeOffset),t.setUniform3fv("vvSizeFactor",n.vvSizeFactor)),n.vvColorEnabled&&(t.setUniform1fv("vvColorValues",n.vvColorValues),t.setUniform4fv("vvColorColors",n.vvColorColors)),t.setUniform2f("screenOffset",2*n.screenOffset[0]*r,2*n.screenOffset[1]*r),t.setUniform2fv("anchorPos",C(n))}function C(e,t){return void 0===t&&(t=V),e.textureIsSignedDistanceField?O(e.anchorPos,e.distanceFieldBoundingBox,t):l.vec2.copy(t,e.anchorPos),t}function A(e,t,n,i){return void 0===i&&(i=V),l.vec2.copy(i,e.anchorPos),i[0]*=-t[0],i[1]*=-t[1],i[0]+=e.screenOffset[0]*n,i[1]+=e.screenOffset[1]*n,i}function O(e,t,n){n[0]=e[0]*(t[2]-t[0])+t[0],n[1]=e[1]*(t[3]-t[1])+t[1]}function R(e){var t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+n*n+i*i),d=1/Math.sqrt(r*r+o*o+a*a),f=1/Math.sqrt(s*s+l*l+c*c);return e[0]=t*u,e[1]=n*u,e[2]=i*u,e[3]=r*d,e[4]=o*d,e[5]=a*d,e[6]=s*f,e[7]=l*f,e[8]=c*f,e}var M=function(e){function t(t,n){var i=e.call(this,n)||this;return i.params=_.copyParameters(t,K),i}return n(t,e),t.prototype.dispose=function(){},t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&b.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.notifyDirty("matChanged")},t.prototype.getParameters=function(){return this.params},t.prototype.intersect=function(e,t,n,i,r,o,a,s,l){l?this.intersectDrapedRenderHudGeometry(e,t,n,i,r,o,a,s):this.intersectHudGeometry(e,t,n,i,r,o,a,s)},t.prototype.intersectDrapedRenderHudGeometry=function(e,t,n,i,r,o,a,s){var l=e.getAttribute(b.VertexAttrConstants.POSITION),c=e.getAttribute(b.VertexAttrConstants.SIZE),d=this.params,f=C(d),p=1,h=1;if(s){var v=s(W);p=v[0],h=v[5]}p*=e.pixelRatio,h*=e.pixelRatio;for(var g=q*e.pixelRatio,m=0;m<l.data.length/l.size;m++){var y=m*l.size;u.vec3.set(F,l.data[y],l.data[y+1],l.data[y+2]);var x=m*c.size;Y[0]=c.data[x]*p,Y[1]=c.data[x+1]*h;var _=F[0],S=F[1],w=void 0;d.textureIsSignedDistanceField&&(w=d.outlineSize*e.pixelRatio/2),this._isInsideIconBoundaries(o,_,S,g,w,d,f)&&a()}},t.prototype.intersectHudGeometry=function(e,t,n,i,o,s,l,c){if(i.enable.selectionMode&&i.enable.hud&&!v.isAllHidden(t.componentVisibilities,e.componentOffsets)){var f=e.data,p=this.params,h=1,g=1;if(r.mat3.fromMat4(j,n),c){var m=c(W);h=m[0],g=m[5],R(j)}var x=f.getVertexAttr()[b.VertexAttrConstants.POSITION],_=f.getVertexAttr()[b.VertexAttrConstants.SIZE],S=f.getVertexAttr()[b.VertexAttrConstants.NORMAL],w=f.getVertexAttr()[b.VertexAttrConstants.AUXPOS1];b.assert(x.size>=3);var T=i.point,E=i.camera,P=C(p);h*=E.pixelRatio,g*=E.pixelRatio;for(var A="screen"===this.params.centerOffsetUnits,O=0;O<x.data.length/x.size;O++){var M=O*x.size;u.vec3.set(F,x.data[M],x.data[M+1],x.data[M+2]),u.vec3.transformMat4(F,F,n);var D=O*_.size;Y[0]=_.data[D]*h,Y[1]=_.data[D+1]*g,u.vec3.transformMat4(F,F,E.viewMatrix);var I=O*w.size;if(u.vec3.set(H,w.data[I+0],w.data[I+1],w.data[I+2]),!A&&(F[0]+=H[0],F[1]+=H[1],0!==H[2])){var V=H[2];u.vec3.normalize(H,F),u.vec3.subtract(F,F,u.vec3.scale(H,H,V))}var z=O*S.size;if(u.vec3.set(B,S.data[z],S.data[z+1],S.data[z+2]),this.applyVerticalOffsetTransformation(F,B,j,E,L),E.applyProjection(F,N),N[0]>-1){var k=Math.floor(N[0])+this.params.screenOffset[0],q=Math.floor(N[1])+this.params.screenOffset[1];A&&(k+=H[0],0!==H[1]&&(q+=y.applyScaleFactor(H[1],L.factorAlignment))),y.applyPrecomputedScaleFactorVec2(Y,L.factor,Y);var Z=X*E.pixelRatio,K=void 0;if(p.textureIsSignedDistanceField&&(K=p.outlineSize*E.pixelRatio/2),this._isInsideIconBoundaries(T,k,q,Z,K,p,P)){var Q=i.ray;u.vec3.transformMat4(U,F,a.mat4.invert(G,E.viewMatrix)),N[0]=T[0],N[1]=T[1],E.unprojectPoint(N,F);var J=d.vec3f64.create();u.vec3.copy(J,Q.direction);var $=1/u.vec3.length(J);u.vec3.scale(J,J,$),l(u.vec3.distance(Q.origin,F)*$,J,-1,1,!0,U)}}}}},t.prototype._isInsideIconBoundaries=function(e,t,n,i,r,o,a){var s=t-i-(a[0]>0?Y[0]*a[0]:0),l=s+Y[0]+2*i,c=n-i-(a[1]>0?Y[1]*a[1]:0),u=c+Y[1]+2*i;if(o.textureIsSignedDistanceField){var d=o.distanceFieldBoundingBox;s+=Y[0]*d[0],c+=Y[1]*d[1],l-=Y[0]*(1-d[2]),u-=Y[1]*(1-d[3]),s-=r,l+=r,c-=r,u+=r}return e[0]>s&&e[0]<l&&e[1]>c&&e[1]<u},t.prototype.createBufferWriter=function(){return new J(this)},t.prototype.createRenderer=function(e,t){return new S(e,t,this)},t.prototype.normalAndViewAngle=function(e,t,n,i){return void 0===i&&(i=k),u.vec3.transformMat3(i.normal,e,t),u.vec3.transformMat4(i.normal,i.normal,n.viewInverseTransposeMatrix),i.cosAngle=u.vec3.dot(z,Z),i},t.prototype.updateScaleInfo=function(e,t,n){var i=this.params;i.screenSizePerspective?e.factor=y.precomputeScaleFactor(k.cosAngle,n,i.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),i.screenSizePerspectiveAlignment?e.factorAlignment=y.precomputeScaleFactor(k.cosAngle,n,i.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)},t.prototype.applyVerticalOffsetTransformation=function(e,t,n,i,o,a){var s=this.params;if(f.isMat4(n)&&(n=r.mat3.fromMat4(j,n)),!s.verticalOffset||!s.verticalOffset.screenLength){if(o&&(s.screenSizePerspective||s.screenSizePerspectiveAlignment)){var l=this.normalAndViewAngle(t,n,i),c=u.vec3.length(e);this.updateScaleInfo(o,l.cosAngle,c)}else o&&(o.factor.scale=1,o.factorAlignment.scale=1);return a?u.vec3.copy(a,e):e}var d=this.normalAndViewAngle(t,n,i),p=u.vec3.length(e),h=s.screenSizePerspectiveAlignment||s.screenSizePerspective,v=_.verticalOffsetAtDistance(i,p,s.verticalOffset,d.cosAngle,h);return o&&this.updateScaleInfo(o,d.cosAngle,p),u.vec3.add(a||e,e,u.vec3.scale(d.normal,d.normal,v))},t.prototype.getGLMaterials=function(){return{color:D,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:I}},t.prototype.getAllTextureIds=function(){return[this.params.textureId]},t.prototype.calculateRelativeScreenBounds=function(e,t,n){return void 0===n&&(n=p.create()),A(this.params,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n},t.prototype.calculateAnchorPosForRendering=function(e){return C(this.params,e)},t.shouldRenderVisibilityDuringRenderPass=function(e){return 0===e||4},t}(m),D=function(e){function t(t,n,i){var r=e.call(this,t,n,i,t.getParameters().textureId)||this;return r.isOcclusionSlot=!1,r.updateParameters(),r}return n(t,e),t.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?16:15},t.prototype.selectProgram=function(){var e=this.params;this.occlusionProgram=this.programRep.getProgram(w.occlusionPass,{verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,slice:e.slicePlaneEnabled}),this.renderProgram=this.programRep.getProgram(w.colorPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,debugDrawBorder:!!e.debugDrawBorder,slice:e.slicePlaneEnabled}),this.renderPipelineState=T.makePipelineState({blending:T.simpleBlendingParams(1,771),polygonOffset:e.polygonOffset&&$,depthTest:{func:515},depthWrite:T.defaultDepthWriteParams,colorWrite:T.defaultColorWriteParams}),this.occlusionPipelineState=T.makePipelineState({depthTest:{func:515},depthWrite:T.defaultDepthWriteParams,colorWrite:T.defaultColorWriteParams})},t.prototype.beginSlot=function(e){return this.params.occlusionTest?(this.isOcclusionSlot=10===e,10===e||e===this.mainSlot):(this.isOcclusionSlot=!1,e===this.mainSlot)},t.prototype.getProgram=function(){return this.isOcclusionSlot?this.occlusionProgram:this.renderProgram},t.prototype.getPrograms=function(){return[this.occlusionProgram,this.renderProgram]},t.prototype.updateParameters=function(){this.params=_.copyParameters(this.material.getParameters()),this.updateTexture(this.params.textureId),this.selectProgram(),this.selectSlot()},t.prototype.bind=function(e,t){if(this.isOcclusionSlot){var n=this.occlusionProgram;e.bindProgram(n),e.setPipelineState(this.occlusionPipelineState),E(n,this.params,t),n.setUniform4f("color",1,1,1,1),n.setUniform1f("pixelRatio",t.pixelRatio||1)}else{n=this.renderProgram;e.bindProgram(n),e.setPipelineState(this.renderPipelineState),this.bindTexture(e,n),this.bindTextureScale(e,n),E(n,this.params,t),P(e,n,this.params,t)}},t.prototype.bindView=function(e,t){var n=t.origin,i=this.getProgram();_.bindView(n,t.view,i),_.bindCamPos(n,t.viewInvTransp,i),this.params.slicePlaneEnabled&&_.bindSlicePlane(t.origin,t.slicePlane,i)},t.prototype.bindInstance=function(e,t){var n=this.getProgram();n.setUniformMatrix4fv("model",t.transformation),n.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.release=function(e){},t.prototype.getDrawMode=function(){return this.isOcclusionSlot?0:4},t}(g),I=function(e){function t(t,n,i){var r=e.call(this,t,n,i,t.getParameters().textureId)||this;return r.updateParameters(),r}return n(t,e),t.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?16:15},t.prototype.beginSlot=function(e){return e===this.mainSlot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){this.params=_.copyParameters(this.material.getParameters()),this.updateTexture(this.params.textureId),this.selectProgram(),this.selectSlot()},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(w.highlightPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,binaryHighlightOcclusion:e.binaryHighlightOcclusion,slice:e.slicePlaneEnabled}),this.pipelineState=T.makePipelineState({blending:T.separateBlendingParams(1,1,771,771),polygonOffset:e.polygonOffset&&$,depthTest:{func:513},colorWrite:T.defaultColorWriteParams})},t.prototype.bind=function(e,t){var n=this.program;e.bindProgram(n),e.setPipelineState(this.pipelineState),this.bindTexture(e,n),this.bindTextureScale(e,n),E(n,this.params,t),P(e,n,this.params,t),_.bindHighlightRendering(e,t,this.program)},t.prototype.bindView=function(e,t){var n=t.origin,i=this.getProgram();_.bindView(n,t.view,i),_.bindCamPos(n,t.viewInvTransp,i),this.params.slicePlaneEnabled&&_.bindSlicePlane(t.origin,t.slicePlane,i)},t.prototype.bindInstance=function(e,t){var n=this.getProgram();n.setUniformMatrix4fv("model",t.transformation),n.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.release=function(e){},t.prototype.getDrawMode=function(){return 4},t}(g),L={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},V=c.vec2f64.create(),F=d.vec3f64.create(),B=d.vec3f64.create(),N=i.createRenderScreenPointArray3(),z=d.vec3f64.create(),U=d.vec3f64.create(),j=o.mat3f64.create(),G=s.mat4f64.create(),H=d.vec3f64.create(),k={normal:z,cosAngle:0},W=s.mat4f64.create();a.mat4.identity(W);var X=1,q=2,Y=[0,0],Z=d.vec3f64.fromValues(0,0,1),K={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:c.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},Q=h.newLayout().vec3f(b.VertexAttrConstants.POSITION).vec3f(b.VertexAttrConstants.NORMAL).vec2f(b.VertexAttrConstants.UV0).vec4u8(b.VertexAttrConstants.COLOR).vec2f(b.VertexAttrConstants.SIZE).vec4f(b.VertexAttrConstants.AUXPOS1).vec4f(b.VertexAttrConstants.AUXPOS2),J=function(){function e(e){this.material=e,this.vertexBufferLayout=Q}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[b.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,n,i,r){x.writePosition(t.indices[b.VertexAttrConstants.POSITION],t.vertexAttr[b.VertexAttrConstants.POSITION].data,e.transformation,i.position,r,6),x.writeNormal(t.indices[b.VertexAttrConstants.NORMAL],t.vertexAttr[b.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,i.normal,r,6);var o=t.vertexAttr[b.VertexAttrConstants.UV0].data,a=void 0,s=void 0,l=void 0,c=void 0;if(null==o||o.length<4){var u=this.material.getParameters();a=0,s=0,l=u.texCoordScale[0],c=u.texCoordScale[1]}else a=o[0],s=o[1],l=o[2],c=o[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);for(var d=t.indices[b.VertexAttrConstants.POSITION].length,f=i.uv0,p=r,h=0;h<d;++h)f.set(p,0,a),f.set(p,1,s),p+=1,f.set(p,0,l),f.set(p,1,s),p+=1,f.set(p,0,l),f.set(p,1,c),p+=1,f.set(p,0,l),f.set(p,1,c),p+=1,f.set(p,0,a),f.set(p,1,c),p+=1,f.set(p,0,a),f.set(p,1,s),p+=1;x.writeColor(t.indices[b.VertexAttrConstants.COLOR],t.vertexAttr[b.VertexAttrConstants.COLOR].data,4,i.color,r,6);var v=t.indices[b.VertexAttrConstants.SIZE],g=t.vertexAttr[b.VertexAttrConstants.SIZE].data,m=v.length,y=i.size;for(p=r,h=0;h<m;++h)for(var _=g[2*v[h]],S=g[2*v[h]+1],w=0;w<6;++w)y.set(p,0,_),y.set(p,1,S),p+=1;t.indices[b.VertexAttrConstants.AUXPOS1]&&t.vertexAttr[b.VertexAttrConstants.AUXPOS1]&&x.writeBufferVec4(t.indices[b.VertexAttrConstants.AUXPOS1],t.vertexAttr[b.VertexAttrConstants.AUXPOS1].data,i.auxpos1,r,6),t.indices[b.VertexAttrConstants.AUXPOS2]&&t.vertexAttr[b.VertexAttrConstants.AUXPOS2]&&x.writeBufferVec4(t.indices[b.VertexAttrConstants.AUXPOS2],t.vertexAttr[b.VertexAttrConstants.AUXPOS2].data,i.auxpos2,r,6)},e}(),$={factor:0,units:-4};return M}.apply(null,i))||(e.exports=r)},xgKb:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("QFi0"),n("G0ER"),n("qbr3"),n("z2+Q")],void 0===(r=function(e,t,n,i,r,o){var a=function(){function e(e){this.isEnabled=!1,this.vertexAttributeLocations={position:0},this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.enable=function(){if(this.isEnabled)return!0;var e=this.rctx;this.program=new i(e,s.shader.vertex,s.shader.fragment,this.vertexAttributeLocations),this.pipelineState=r.makePipelineState({colorWrite:r.defaultColorWriteParams});var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new o(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new n(e,34962,35044,t)}),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var n=this.rctx;n.bindVAO(this.vao),n.bindFramebuffer(t);var i={x:0,y:0,width:0,height:0};null!=t?(i.width=t.descriptor.width,i.height=t.descriptor.height):(i.width=n.gl.canvas.width,i.height=n.gl.canvas.height),n.bindProgram(this.program),n.setPipelineState(this.pipelineState),n.bindTexture(e.colorTexture,0),this.program.setUniform1i("uColorTexture",0),this.program.setUniform2f("uRcpFrameDimension",1/i.width,1/i.height),n.drawArrays(4,0,3)},e}(),s={shader:{vertex:"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate = (position + 1.0 ) * 0.5;\n        gl_Position = vec4(position, -1, 1);\n      }",fragment:"\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x = pos.x + float(off.x) * rcpFrame.x;\n        float y = pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -> actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN = FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW = FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM = FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE = FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS = FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN = FxaaLuma(rgbN);\n        float lumaW = FxaaLuma(rgbW);\n        float lumaM = FxaaLuma(rgbM);\n        float lumaE = FxaaLuma(rgbE);\n        float lumaS = FxaaLuma(rgbS);\n        float rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range = rangeMax - rangeMin;\n        if (range < max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL = abs(lumaL - lumaM);\n        float blendL = max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL = min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW = FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE = FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW = FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE = FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL += (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *= vec3(1.0/9.0);\n        float lumaNW = FxaaLuma(rgbNW);\n        float lumaNE = FxaaLuma(rgbNE);\n        float lumaSW = FxaaLuma(rgbSW);\n        float lumaSE = FxaaLuma(rgbSE);\n        float edgeVert =\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz =\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan = edgeHorz >= edgeVert;\n        float lengthSign = horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN = lumaW;\n          lumaS = lumaE;\n        }\n        float gradientN = abs(lumaN - lumaM);\n        float gradientS = abs(lumaS - lumaM);\n        lumaN = (lumaN + lumaM) * 0.5;\n        lumaS = (lumaS + lumaM) * 0.5;\n        if (gradientN < gradientS)\n        {\n          lumaN = lumaS;\n          lumaN = lumaS;\n          gradientN = gradientS;\n          lengthSign *= -1.0;\n        }\n        vec2 posN;\n        posN.x = pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y = pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *= FXAA_SEARCH_THRESHOLD;\n        vec2 posP = posN;\n        vec2 offNP = horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN = lumaN;\n        float lumaEndP = lumaN;\n        bool doneN = false;\n        bool doneP = false;\n        posN += offNP * vec2(-1.0, -1.0);\n        posP += offNP * vec2( 1.0,  1.0);\n        for(int i = 0; i < FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN = FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP = FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);\n          doneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);\n          if(doneN && doneP) { break; }\n          if(!doneN) {\n            posN -= offNP;\n          }\n          if(!doneP) {\n            posP += offNP;\n          }\n        }\n        float dstN = horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP = horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN = dstN < dstP;\n        lumaEndN = directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0)) {\n          lengthSign = 0.0;\n        }\n        float spanLength = (dstP + dstN);\n        dstN = directionN ? dstN : dstP;\n        float subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF = texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord = fCoordinate;\n        // if (screenCoord.x < 0.5) {\n          color.rgb = FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x < 0.501 && screenCoord.x > 0.499) {\n        //   color.rgb = vec3(1,0,0);\n        // } else {\n        //   color = texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a = 1.0;\n        gl_FragColor = color;\n      }"}};return a}.apply(null,i))||(e.exports=r)},xsp2:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("W0kZ")],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var i=new n;t.generateHighlightId=function(){return i.gen("highlight")}}.apply(null,i))||(e.exports=r)},yBJI:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("rjU6"),n("+nCE"),n("Kfys")],void 0===(r=function(e,t,n,i,r){function o(e){switch(e){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw new Error("Unhandled data type: "+e)}return function(){function e(t,a,s,l,c){void 0===s&&(s=null),void 0===l&&(l=e.DefaultOffsets),void 0===c&&(c=e.DefaultIndices),this.preinterleaved=!0,this.primitiveType="triangle",this._positionData=null;var u=r.getStride(a)/4,d=t.length/u;this._hasDefaultIndices=c===e.DefaultIndices,this._hasDefaultIndices&&(c=i.generateDefaultIndexArray(d));for(var f={},p=0,h=a;p<h.length;p++){var v=h[p],g=new(o(v.type))(t.buffer),m=r.getBytesPerElement(v.type),y=v.count,b=v.offset/m,x=v.stride/m;f[v.name]={data:g,size:y,offsetIdx:b,strideIdx:x}}s&&(this._positionData=s,f.position={data:s.data,size:3,offsetIdx:0,strideIdx:3}),this._id=i.getNewId(),this._vertexData=t,this._vertexAttributes=f,this._layout=a,this._indexData=c,this._componentOffsets=n.createOffsets(l),this._gpuMemoryUsage=t.byteLength+(this._hasDefaultIndices?0:c.byteLength),this._indexCount=c.length}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){return this._indexCount},enumerable:!0,configurable:!0}),e.prototype.toRenderData=function(){var e={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,indexCount:this._indexCount,vertexData:this._vertexData,layout:this._layout};return this._vertexData=null,this._indexData=null,this._vertexAttributes={position:this._vertexAttributes.position},e},e.prototype.getIndices=function(e){return"position"===e&&this._positionData?this._positionData.indices:this._indexData},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage},Object.defineProperty(e.prototype,"hasPositionData",{get:function(){return!!this._positionData},enumerable:!0,configurable:!0}),e.DefaultOffsets=new Uint32Array(0),e.DefaultIndices=new Uint32Array(0),e}()}.apply(null,i))||(e.exports=r)},yqrJ:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("pcDC"),n("qsST"),n("xoE+"),n("rusB"),n("weRx"),n("AzkI"),n("EyQ4"),n("zZCp"),n("/Bau"),n("W0kZ"),n("CIy2"),n("31XB"),n("/f24"),n("qbr3"),n("Zp3t"),n("Kfys"),n("7laH")],void 0===(r=function(e,t,n,i,r,o,a,s,l,c,u,d,f,p,h,v,g,m,y){var b=i.getLogger("esri.views.3d.webgl-engine.lib.Texture"),x=function(){function e(t,n,i){this.data=t,this.id=e.idGen.gen(n),this.unloadFunc=void 0,this.params=i||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=e.estimateTexMemRequired(this.data,this.params)}return e.estimateTexMemRequired=function(e,t){return null==e?0:o.isArrayBuffer(e)||o.isUint8Array(e)?e.byteLength:e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement?(t.mipmap?4/3:1)*e.width*e.height*(t.components||4):(t.mipmap?4/3:1)*t.width*t.height*(t.components||4)||0},e.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired},e.prototype.dispose=function(){this.data=void 0},e.prototype.deferredLoading=function(){return"string"==typeof this.data},e.prototype.getWidth=function(){return this.params.width},e.prototype.getHeight=function(){return this.params.height},e.prototype.initializeThroughUpload=function(t,n,i,r,a){var s=this.data;if(n.flipped=!this.params.noUnpackFlip,n.samplingMode=this.params.mipmap?9987:9729,n.hasMipmap=this.params.mipmap,n.wrapMode=this.params.wrap,n.preMultiplyAlpha=this.params.preMultiplyAlpha,"string"==typeof s)this.loadTextureFromUri(t,s,n,i,r,a);else if(s instanceof Image||s instanceof ImageData||s instanceof HTMLCanvasElement)this.loadTextureFromImageData(t,s,n,i,r,a);else if(o.isArrayBuffer(s)&&this.params.encoding===e.DDS_ENCODING){var c=l.createDDSTexture(t,n,s,this.params.mipmap);t.bindTexture(c),a(c)}else if(o.isUint8Array(s)&&this.params.encoding===e.DDS_ENCODING){c=l.createDDSTexture(t,n,s.buffer,this.params.mipmap);t.bindTexture(c),a(c)}else if(o.isUint8Array(s)){f.assert(this.params.width>0&&this.params.height>0),n.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,n.width=this.params.width,n.height=this.params.height;c=new g(t,n,s);t.bindTexture(c),a(c)}else{if(null!==s)throw new Error("Unsupported image data");c=new g(t,n,null);t.bindTexture(c),a(c)}this.data=void 0},e.prototype.loadTextureFromImageData=function(e,t,n,i,r,o){this.params.width=t.width,this.params.height=t.height,n.pixelFormat=3===this.params.components?6407:6408;var a=33071===this.params.wrap.s&&33071===this.params.wrap.t;if(y.default(e.gl)||!this.params.mipmap&&a||s.isPowerOfTwo(t.width)&&s.isPowerOfTwo(t.height)){n.width=t.width,n.height=t.height;var l=new g(e,n,t);e.bindTexture(l),o(l)}else{l=this.makePowerOfTwoTexture(e,t,n,i,r);e.bindTexture(l),o(l)}},e.prototype.loadTextureFromUri=function(e,t,n,i,r,o){var l=this,c=!1!==this.params.mipmap;a.requestImage(t).then(function(t){if(f.assert(t.width>=1&&t.height>=1),n.samplingMode=c?9987:9729,n.hasMipmap=c,!c&&33071===n.wrapMode||s.isPowerOfTwo(t.width)&&s.isPowerOfTwo(t.height)){n.width=t.width,n.height=t.height;var a=new g(e,n,t);e.bindTexture(a),o(a)}else{a=l.makePowerOfTwoTexture(e,t,n,i,r);e.bindTexture(a),o(a)}}).catch(function(e){var n=t.length>200?t.slice(0,100)+"..."+t.slice(t.length-100):t;b.error("Failed to load image from uri",n,e),o(null)})},e.prototype.makePowerOfTwoTexture=function(e,t,i,o,a){var s,l=t.width,c=t.height,u=r.nextHighestPowerOfTwo(l),d=r.nextHighestPowerOfTwo(c);switch(i.width=u,i.height=d,this.params.powerOfTwoResizeMode){case 2:i.textureCoordinateScaleFactor=[l/u,c/d],(s=new g(e,i)).updateData(0,0,0,l,c,t);break;case 1:case null:case void 0:s=this.stretchToPowerOfTwo(e,t,i,o,a);break;default:n.neverReached(this.params.powerOfTwoResizeMode)}return i.hasMipmap&&s.generateMipmap(),s},e.prototype.stretchToPowerOfTwo=function(e,t,n,i,r){var o=new g(e,n),a=h.createWithAttachments(e,o,{colorTarget:0,depthStencilTarget:0}),s=new g(e,{target:3553,pixelFormat:n.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!n.flipped,maxAnisotropy:8,preMultiplyAlpha:n.preMultiplyAlpha},t);if(e.bindFramebuffer(a),void 0===r){var l=e.getViewport();r=[l.x,l.y,l.width,l.height]}e.setViewport(0,0,n.width,n.height);var d=i.getProgram(p.texOnly);e.bindProgram(d),d.setUniform4f("color",1,1,1,1),d.setUniform1i("tex",0);var f=u.createQuadVAO(e,c.Pos3Tex);return e.bindTexture(s,0),e.bindVAO(f),e.setPipelineState(_),e.drawArrays(5,0,m.vertexCount(f,"geometry")),e.bindFramebuffer(null),e.setViewport(r[0],r[1],r[2],r[3]),f.dispose(!0),s.dispose(),e.bindFramebuffer(null),a.detachColorTexture(),a.dispose(),o},e.prototype.setUnloadFunc=function(e){this.unloadFunc=e},e.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)},e.createEmpty=function(t){return void 0===t&&(t="emptyTexture"),new e(new Uint8Array([0,0,0,0]),t,{width:1,height:1,wrap:{s:33071,t:33071}})},e.idGen=new d,e.DDS_ENCODING="image/vnd-ms.dds",e}(),_=v.makePipelineState({colorWrite:v.defaultColorWriteParams});return x}.apply(null,i))||(e.exports=r)},ys4y:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("3RHn"),n("rjU6"),n("+nCE"),n("W0kZ"),n("CIy2"),n("CIy2")],void 0===(r=function(e,t,n,i,r,o,a,s){return function(){function e(t,n,i){this.singleUse=!1,this._boundingInfo=null,this._componentAABBs=null,this._id=e.__idGen.gen(n),this._data=t,this._boundingInfo=i}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.getIndices=function(e){return this.data.getIndices(e)},Object.defineProperty(e.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),e.prototype.getAttribute=function(e){return this.data.getAttribute(e)},Object.defineProperty(e.prototype,"componentCount",{get:function(){return i.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this.data.componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo},enumerable:!0,configurable:!0}),e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null,this._componentAABBs=null},e.prototype.getComponentAABB=function(e,t){null==this._componentAABBs&&(this._componentAABBs=this._computeComponentAABBs());for(var n=0;n<6;n++)t[n]=this._componentAABBs[6*e+n];return t},e.prototype._computeComponentAABBs=function(){for(var e=this.componentCount,t=new Float32Array(6*e),n=0;n<e;n++)this._calculateAABB(n,t,6*n);return t},e.prototype._calculateAABB=function(e,t,n){void 0===n&&(n=0);for(var i=this.data.getIndices(s.VertexAttrConstants.POSITION),r=this.data.getAttribute(s.VertexAttrConstants.POSITION),o=this.data.componentOffsets,a=o.length?o[e]:0,l=o.length?o[e+1]:i.length,c=1/0,u=1/0,d=1/0,f=-1/0,p=-1/0,h=-1/0,v=r.offsetIdx,g=r.strideIdx,m=a;m<l;m++){var y=v+g*i[m],b=r.data[y],x=r.data[y+1],_=r.data[y+2];c=Math.min(c,b),u=Math.min(u,x),d=Math.min(d,_),f=Math.max(f,b),p=Math.max(p,x),h=Math.max(h,_)}t[n]=c,t[n+1]=u,t[n+2]=d,t[n+3]=f,t[n+4]=p,t[n+5]=h},e.prototype._calculateBoundingInfo=function(){var e=this.data.getIndices(s.VertexAttrConstants.POSITION),t=this.data.getAttribute(s.VertexAttrConstants.POSITION),i="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(i);for(var o=0;o<i;++o)e[o]=o}var l=e.length;a.assert(l%i==0);var c=r.generateDefaultIndexArray(l/i);return new n(c,i,e,t)},e.__idGen=new o,e}()}.apply(null,i))||(e.exports=r)},zZCp:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}.apply(null,i))||(e.exports=r)},zbgD:function(e,t,n){var i,r;i=[n.dj.c(e.i),t,n("VVgn"),n("IROT")],void 0===(r=function(e,t,n,i){Object.defineProperty(t,"__esModule",{value:!0});var r=new i(function(e){var t=n;return e.split("/").forEach(function(e){t&&(t=t[e])}),t});t.resolveIncludes=function(e){return r.resolveIncludes(e)}}.apply(null,i))||(e.exports=r)},zlCF:function(e,t,n){var i,r;i=[n.dj.c(e.i),t],void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,i,r){void 0===n&&(n=0),this.TypedArrayConstructor=e,this.elementCount=1;var o=this.TypedArrayConstructor;void 0===i&&(i=o.BYTES_PER_ELEMENT);var a=0===t.byteLength?0:n;this.typedBuffer=null==r?new o(t,a):new o(t,a,(r-n)/o.BYTES_PER_ELEMENT),this.typedBufferStride=i/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.get=function(e){return this.typedBuffer[e*this.typedBufferStride]},e.prototype.set=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=1,e}();t.BufferViewScalarImpl=n}.apply(null,i))||(e.exports=r)}}]);