(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/data/AttributesBuilder":"700l","esri/layers/graphics/data/QueryEngine":"ZooB","esri/layers/graphics/data/QueryEngineResult":"d81A","esri/layers/graphics/data/FeatureStore":"rfv1","esri/layers/support/PromiseQueue":"tZaU"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"700l":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("xdHJ"),r("Ytki")],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this._fieldDataCache=new r.default,this._returnDistinctMap=new r.default,this.returnDistinctValues=e.returnDistinctValues,this.fieldsMap=t;var n=e.outFields;if(n&&-1===n.indexOf("*")){this.outFields=n;for(var s=0,u=0,a=n;u<a.length;u++){var o=a[u],l=i.getExpressionFromFieldName(o),c=this.fieldsMap.has(l),h=c?null:i.getWhereClause(l),f=c?this.fieldsMap.get(o).name:i.getAliasFromFieldName(o)||"FIELD_EXP_"+s++;this._fieldDataCache.set(o,{alias:f,clause:h})}}}return e.prototype.getAttributes=function(e){var t=e.attributes;return t=this._processAttributesForOutFields(t),this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t){var r=e.attributes,n=this.fieldsMap.has(t),s=n?this.fieldsMap.get(t).name:t,u=null;return this._fieldDataCache.has(s)?u=this._fieldDataCache.get(s).clause:n||(u=i.getWhereClause(t),this._fieldDataCache.set(s,{alias:s,clause:u})),n?r[s]:u.calculateValue(r)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t)}),this._fieldDataCache.get(t).clause.testFeature(e.attributes)},e.prototype.validateItems=function(e,t){var r=this;this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:i.getWhereClause(t)});var n=e.map(function(e){return r.getAttributes(e)});return this._fieldDataCache.get(t).clause.testSet(n)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!e||!t||!t.length)return e;for(var r={},i=0,n=t;i<n.length;i++){var s=n[i],u=this._fieldDataCache.get(s),a=u.alias,o=u.clause;r[a]=o?o.calculateValue(e):e[a]}return r},e.prototype._processAttributesForDistinctValues=function(e){if(!e||!this.returnDistinctValues)return e;var t=this.outFields,r=[];if(t)for(var i=0,n=t;i<n.length;i++){var s=n[i],u=this._fieldDataCache.get(s).alias;r.push(e[u])}else for(var u in e)r.push(e[u]);var a=(t||["*"]).join(",")+"="+r.join(","),o=this._returnDistinctMap.get(a)||0;return this._returnDistinctMap.set(a,++o),o>1?null:e},e}();t.default=n}.apply(null,i))||(e.exports=n)},ZooB:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("2Atf"),r("ll/V"),r("xdHJ"),r("PND3"),r("WYKK"),r("ma1f"),r("rg9i"),r("qsST"),r("r7jh"),r("qMld"),r("8uEs"),r("lRq4"),r("hBh5"),r("Lzvl"),r("nrlZ"),r("Ytki"),r("Q2Em"),r("4/qq"),r("d81A"),r("V1i6"),r("/61J"),r("zDti"),r("tZaU")],void 0===(n=function(e,t,r,i,n,s,u,a,o,l,c,h,f,d,p,y,m,_,g,v,b,I,x,F,S){function E(e,t,r,i,n,s,u,a,o){o||(o=Q),u&&!s?i.forEachInBounds(n,function(i){if(!t.has(i.objectId)){var n=F.getCentroid(r,i,a),s=i.attributes;n&&(t.add(i.objectId),e.push(new R(s,null,n,o(i))))}}):s&&!u?i.forEachInBounds(n,function(i){if(!t.has(i.objectId)){var n=i.attributes,s=F.getGeometry(r,i,0,a);s&&(t.add(i.objectId),e.push(new R(n,s,null,o(i))))}}):i.forEachInBounds(n,function(i){if(!t.has(i.objectId)){var n=i.attributes,s=F.getGeometry(r,i,0,a),u=F.getCentroid(r,i,a);s&&u&&(t.add(i.objectId),e.push(new R(n,s,u,o(i))))}})}Object.defineProperty(t,"__esModule",{value:!0});var Q=function(e){return 1},T=l.getLogger("esri.layers.graphics.data.QueryEngine"),R=function(e,t,r,i){this.attributes=e,this.geometry=t,this.centroid=r,this.filterFlags=i},M=new s.default,B=new c.Storage(2e6),C=0,j=function(){function e(e){var t=this;this.capabilities={query:v.queryCapabilities},this.fieldsMap=new n.default,this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.cacheSpatialQueries=e.cacheSpatialQueries||!1,this.gdbVersion=e.gdbVersion,this.historicMoment=e.historicMoment,this.featureStore=e.featureStore,this.featureStore.setEngine(this),this.timeInfo=e.timeInfo,this.cacheSpatialQueries&&(this._geometryQueryCache=new c(C+++"$$",B)),e.fields.forEach(function(e){t.fieldsMap.set(e.name.trim(),e),t.fieldsMap.set(e.name.trim().toLowerCase(),e)}),e.scheduler&&e.priority&&(this._frameQueue=new S.PromiseQueue,this._frameTask=e.scheduler.registerTask(e.priority,function(e){return t._update(e)},function(){return t._frameQueue.length>0}))}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this.fieldsMap.clear()},Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:F.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeExtent",{get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:(this._timeExtent=x.getTimeExtent(this.timeInfo,this.featureStore),this._timeExtent):null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},e.prototype.executeQuery=function(e){var t=this;void 0===e&&(e={});var r=o.clone(e);return u.safeCast(F.normalizeQuery(r,this.definitionExpression,this.spatialReference)).then(function(e){return t._schedule(e)}).then(function(e){return t._checkQuerySupport(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeTimeQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeAttributesQuery(r)}).catch(function(e){if(e===F.QUERY_ENGINE_EMPTY_RESULT)return new b.default([],null,t);throw e}).then(function(e){return e.createQueryResponse(r)})},e.prototype.executeQueryForCount=function(e){var t=this;void 0===e&&(e={});var r=o.clone(e);return r.returnGeometry=!1,r.returnCentroid=!1,r.outSR=null,u.safeCast(F.normalizeQuery(r,this.definitionExpression,this.spatialReference)).then(function(e){return t._schedule(e)}).then(function(e){return t._checkQuerySupport(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeTimeQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeAttributesQuery(r)}).then(function(e){return e.size}).catch(function(e){if(e===F.QUERY_ENGINE_EMPTY_RESULT)return 0;throw e})},e.prototype.executeQueryForExtent=function(e){var t=this;void 0===e&&(e={});var r=o.clone(e),i=r.outSR;return u.safeCast(F.normalizeQuery(r,this.definitionExpression,this.spatialReference)).then(function(e){return t._schedule(e)}).then(function(e){return t._checkQuerySupport(e)}).then(function(){return r.returnGeometry=!0,r.returnCentroid=!1,r.outSR=null,r}).then(function(e){return t._reschedule(e)}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeTimeQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeAttributesQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){var r=e.size;if(!r)return{count:r,extent:null};var n={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:F.cleanFromGeometryEngine(t.spatialReference)};t.featureStore.forEachBounds(e.items,function(e){n.xmin=Math.min(e[0],n.xmin),n.ymin=Math.min(e[1],n.ymin),n.xmax=Math.max(e[2],n.xmax),n.ymax=Math.max(e[3],n.ymax)});var s=g.project(n,e.spatialReference,i);if(s.spatialReference=F.cleanFromGeometryEngine(i||t.spatialReference),s.xmax-s.xmin==0){var u=f.getMetersPerUnitForSR(s.spatialReference);s.xmin-=u,s.xmax+=u}if(s.ymax-s.ymin==0){u=f.getMetersPerUnitForSR(s.spatialReference);s.ymin-=u,s.ymax+=u}return{count:r,extent:s}}).catch(function(e){if(e===F.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw e})},e.prototype.executeQueryForIds=function(e){return void 0===e&&(e={}),this.executeQueryForIdSet(e).then(function(e){return i.from(e)})},e.prototype.executeQueryForIdSet=function(e){var t=this;void 0===e&&(e={});var r=o.clone(e);return r.returnGeometry=!1,r.returnCentroid=!1,r.outSR=null,u.safeCast(F.normalizeQuery(r,this.definitionExpression,this.spatialReference)).then(function(e){return t._schedule(e)}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeTimeQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeAttributesQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){for(var t=e.items,r=new s.default,i=0,n=t;i<n.length;i++){var u=n[i];r.add(u.objectId)}return r}).catch(function(e){if(e===F.QUERY_ENGINE_EMPTY_RESULT)return new s.default;throw e})},e.prototype.executeTileQuery=function(e,t,r){var i=this;void 0===r&&(r=null);var n=t.returnGeometry,u=t.returnCentroid,a=t.pixelBuffer,o=new s.default,l=[],c=a*e.resolution,h=d.pad(e.bounds,c,d.create());if(E(l,o,this,this.featureStore,h,n,u,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},r),"esriGeometryPoint"===this.geometryType||u){var f=m.getInfo(this.spatialReference);if(f){var p=f.valid,y=p[0],_=p[1];if(h[0]<y){var g=d.fromValues(_-c,h[1],_,h[3]);E(l,o,this,this.featureStore,g,n,u,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[_,e.bounds[3]]},r)}if(h[2]>_){var v=d.fromValues(y,h[1],y+c,h[3]);E(l,o,this,this.featureStore,v,n,u,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[y-_+e.bounds[0],e.bounds[3]]},r)}}}return l.sort(function(e,t){return e.attributes[i.objectIdField]-t.attributes[i.objectIdField]}),{features:l,objectIds:o}},e.prototype.executeTileQueryForIds=function(e,t){var r=t.pixelBuffer*e.resolution,i=d.pad(e.bounds,r,d.create()),n=[];return this.featureStore.forEachInBounds(i,function(e){return n.push(e.objectId)}),n},e.prototype.executeQueryForLatestObservations=function(e){var t=this;return this.timeInfo?this.executeQuery(e).then(function(e){return t._filterLatest(e,t.timeInfo)}):void T.error(new a("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))},e.prototype._schedule=function(e){return this._frameQueue?this._frameQueue.push(e).then(function(e){return e}):h.resolve(e)},e.prototype._reschedule=function(e){return this._frameQueue?this._frameQueue.push(e).then(function(e){return e}):h.resolve(e)},e.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue.process();)e.madeProgress();this._budget=null},e.prototype._filterLatest=function(e,t){for(var i=t.trackIdField,s=t.startTimeField,u=t.endTimeField||s,a=new n.default,o=[],l=0,c=e.features;l<c.length;l++){var h=c[l],f=h.attributes[i],d=h.attributes[u];(!a.has(f)||a.get(f).attributes[u]<d)&&a.set(f,h)}return a.forEach(function(e){return o.push(e)}),r({},e,{features:o})},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.featureStore.forEach(function(t){return e.push(t)}),this._allItems=new b.default(e,null,this)}return this._allItems},e.prototype._executeGeometryQuery=function(e){var t=this,r=e.geometry,i=e.outSR,n=e.spatialRel,u=m.isValid(i)&&!m.equals(this.spatialReference,i),a=this.cacheSpatialQueries?u?JSON.stringify({geometry:r,spatialRelationship:n,outSpatialReference:i}):JSON.stringify({geometry:r,spatialRelationship:n}):null;if(a){var o=this._geometryQueryCache.get(a);if(void 0!==o)return h.resolve(o)}var l=function(r){return u&&(e.returnGeometry||e.returnCentroid)?r.project(i).then(function(e){return a&&t._geometryQueryCache.put(a,e,e.size||1),e}):(a&&t._geometryQueryCache.put(a,r,r.size||1),r)};if(!r)return h.resolve(this._getAll()).then(function(e){return l(e)});if("esriSpatialRelDisjoint"===n){var c,f,d=this._searchFeatures(this._getQueryBBoxes(r));return d.length?this._reschedule(d).then(function(e){return new s.default(e)}).then(function(e){return t._reschedule(e)}).then(function(e){var r=0;c=new Array(e.size),t.featureStore.forEach(function(e){return c[r++]=e}),f=e}).then(function(){return t._reschedule()}).then(function(){return I.getSpatialQueryOperator(n,r,t)}).then(function(e){return t._runSpatialFilter(c,function(t){return!f.has(t)||e(t.geometry)}).then(function(e){return new b.default(e,r,t)}).then(function(e){return l(e)})}):h.resolve(this._getAll()).then(function(e){return l(e)})}var p=this._searchFeatures(this._getQueryBBoxes(r));if(!p.length){var y=new b.default([],r,this);return a&&this._geometryQueryCache.put(a,y,y.size||1),h.resolve(y)}return this._canExecuteSoloPass(r,e)?h.resolve(new b.default(p,r,this)).then(function(e){return l(e)}):I.getSpatialQueryOperator(n,r,this).then(function(e){return t._runSpatialFilter(p,function(t){return e(t.geometry)})}).then(function(e){return new b.default(e,r,t)}).then(function(e){return l(e)})},e.prototype._runSpatialFilter=function(e,t){var r=this;if(!t)return h.resolve(e);if(!this._budget)return h.resolve(e.filter(function(e){return t(e)}));var i=0,n=new Array,s=function(){for(;i<e.length;){var u=e[i];if(t(u)&&n.push(u),r._budget.done)return r._reschedule().then(function(){return s()});++i}return h.resolve()};return this._reschedule().then(function(){return s()}).then(function(){return n})},e.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,i=t.spatialRel;return I.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))},e.prototype._getQueryBBoxes=function(e){if(I.canQueryWithRBush(e)){if(y.isExtent(e))return[d.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(y.isPolygon(e))return e.rings.map(function(e){return d.fromValues(e[0][0],e[0][1],e[2][0],e[2][1])})}return[p.getBoundsXY(d.create(),e)]},e.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.featureStore.forEachInBounds(i,function(e){M.add(e)})}var n=new Array(M.size),s=0;return M.forEach(function(e){return n[s++]=e}),M.clear(),n},e.prototype._checkQuerySupport=function(e){return e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text?h.reject(new a("feature-store:unsupported-query","Unsupported query options",{query:e})):h.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),I.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),g.checkProjectionSupport(this.spatialReference,e.outSR)]).then(function(){return e})},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,i=e.returnDistinctValues;if(r&&r.length>0){var n=r.map(function(e){return e.indexOf(" ASC")>-1?e.split(" ASC")[0]:e.indexOf(" DESC")>-1?e.split(" DESC")[0]:e});_.validateFields(this.fieldsMap,n,"orderByFields contains missing fields")}if(t&&t.length>0)_.validateFields(this.fieldsMap,t,"outFields contains missing fields");else if(i)throw new a("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});_.validateWhere(this.fieldsMap,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){var t=e.outStatistics,r=e.groupByFieldsForStatistics,i=e.having,n=r&&r.length,s=t&&t.length;if(i){if(!n||!s)return h.reject(new a("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e}));_.validateHaving(this.fieldsMap,i,t)}if(s){if(t.some(function(e){return"exceedslimit"===e.statisticType}))return;var u=t.map(function(e){return e.onStatisticField});_.validateFields(this.fieldsMap,u,"onStatisticFields contains missing fields"),n&&_.validateFields(this.fieldsMap,r,"groupByFieldsForStatistics contains missing fields");for(var o=0,l=t;o<l.length;o++){var c=l[o],f=c.onStatisticField,d=c.statisticType;if("exceedslimit"===d)return h.reject(new a("feature-store:unsupported-query","statistic type exceedslimit is not supported",{definition:c,query:e}));if((!n||"count"!==d)&&f&&_.hasInvalidFieldType(f,this.fieldsMap))return h.reject(new a("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:c,query:e}))}}},e}();t.default=j}.apply(null,i))||(e.exports=n)},d81A:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("2Atf"),r("PND3"),r("LxLY"),r("qMld"),r("u90+"),r("nrlZ"),r("+6sX"),r("700l"),r("Ytki"),r("Q2Em"),r("/61J"),r("zDti")],void 0===(n=function(e,t,r,i,n,s,u,a,o,l,c,h,f,d){Object.defineProperty(t,"__esModule",{value:!0});var p=function(){function e(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsMap=r.fieldsMap,this.timeInfo=r.timeInfo}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some(function(e){return"exceedslimit"===e.statisticType})?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(a.isValid(e.outSR)&&!a.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=d.cleanFromGeometryEngine(r({spatialReference:e.outSR},h.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=d.cleanFromGeometryEngine(r({spatialReference:e.outSR},this.queryGeometry))),t},e.prototype.executeAttributesQuery=function(t){var r=c.getWhereClause(t.where);if(!r)return s.resolve(this);if(r.isStandardized()){for(var i=0,n=[],u=0,a=this.items;u<a.length;u++){var o=a[u];r.testFeature(o.attributes)&&(n[i++]=o)}var l=new e(n,this.queryGeometry,this);return l.definitionExpression=t.where,s.resolve(l)}return s.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(t){if(!t.objectIds||!t.objectIds.length)return s.resolve(this);var r=new i.default(t.objectIds);return s.resolve(new e(this.items.filter(function(e){return r.has(e.objectId)}),this.queryGeometry,this))},e.prototype.executeTimeQuery=function(t){var r=f.getTimeOperator(this.timeInfo,t.timeExtent);if(!n.isSome(r))return s.resolve(this);var i=this.items.filter(r);return s.resolve(new e(i,this.queryGeometry,this))},e.prototype.project=function(t){var r=this;return!t||a.equals(this.spatialReference,t)?s.resolve(this):h.projectMany(this.items.map(function(e){return d.getGeometry(r,e)}),this.spatialReference,t).then(function(i){for(var n=[],s=0;s<r.items.length;s++)n[s]={attributes:r.items[s].attributes,geometry:i[s]};var u=[];return o.convertFromFeatures(u,n,r.geometryType,r.hasZ,r.hasM,r.objectIdField),new e(u,r.queryGeometry,{definitionExpression:r.definitionExpression,geometryType:r.geometryType,hasM:r.hasM,hasZ:r.hasZ,objectIdField:r.objectIdField,spatialReference:t,fieldsMap:r.fieldsMap,timeInfo:r.timeInfo})})},e.prototype._createFeatureQueryResponse=function(e){var t=this,r=this.items,i=this,n=i.geometryType,s=i.hasM,a=i.hasZ,o=i.objectIdField,l=i.spatialReference,c=e.outFields,h=e.outSR,f=e.quantizationParameters,p=e.resultRecordCount,y=e.resultOffset,m=!1;if(null!=p&&null!=y){var _=y+p;m=r.length>_,r=r.slice(y,Math.min(r.length,_))}return{exceededTransferLimit:m,features:this._createFeatures(e,r),fields:c&&c.map(function(e){return t.fieldsMap.get(e)}),geometryType:n,hasM:s,hasZ:a,objectIdFieldName:o,spatialReference:d.cleanFromGeometryEngine(h||l),transform:f&&u.toQuantizationTransform(f)||null}},e.prototype._createFeatures=function(e,t){var r=new l.default(e,this.fieldsMap),i=e.quantizationParameters,n=e.returnGeometry,s=e.returnCentroid,a=e.maxAllowableOffset,o=e.orderByFields,c=[],h=0;if(t.length&&o&&o.length){var f=o[0].split(" "),p=f[0],y="DESC"===f[1];t.sort(function(e,t){var i=r.getFieldValue(e,p),n=r.getFieldValue(t,p);if("number"==typeof i&&"number"==typeof n)return y?n-i:i-n;if("string"==typeof i&&"string"==typeof n){var s=i.toUpperCase(),u=n.toUpperCase();return(y?s>u:s<u)?-1:(y?s<u:s>u)?1:0}})}if(n||s){var m=u.toQuantizationTransform(i);if(n&&!s)for(var _=0,g=t;_<g.length;_++){var v=g[_];c[h++]={attributes:r.getAttributes(v),geometry:d.getGeometry(this,v,a,m)}}else if(!n&&s)for(var b=0,I=t;b<I.length;b++){v=I[b];c[h++]={attributes:r.getAttributes(v),centroid:d.getCentroid(this,v,m)}}else for(var x=0,F=t;x<F.length;x++){v=F[x];c[h++]={attributes:r.getAttributes(v),centroid:d.getCentroid(this,v,m),geometry:d.getGeometry(this,v,a,m)}}}else for(var S=0,E=t;S<E.length;S++){v=E[S];var Q=r.getAttributes(v);Q&&(c[h++]={attributes:Q})}return c},e.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,s=0,u=e.outStatistics;s<u.length;s++){var a=u[s];if("exceedslimit"===a.statisticType){r=null!=a.maxPointCount?a.maxPointCount:Number.POSITIVE_INFINITY,i=null!=a.maxRecordCount?a.maxRecordCount:Number.POSITIVE_INFINITY,n=null!=a.maxVertexCount?a.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>i)t=!0;else{var o=this.hasZ?this.hasM?4:3:this.hasM?3:2;t=this.items.reduce(function(e,t){return e+(t.geometry&&t.geometry.coords.length||0)},0)/o>n}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=new l.default(e,this.fieldsMap),r=e.outStatistics,i=[],n=[],s=e.groupByFieldsForStatistics,u=e.having,a=s&&s.length,o=a&&s[0],c={},h={},f={},d={attributes:{}},p=0,y=r;p<y.length;p++){var m=y[p],_=m.outStatisticFieldName,g=m.statisticType,v="exceedslimit"!==m.statisticType?m.onStatisticField:void 0,b="1"===v;if(a&&(v===o||b)&&"count"===m.statisticType){c[v]||(c[v]=this._calculateUniqueValues(t,b?o:v));var I=c[v];for(var x in I){var F=I[x],S=F.count,E=F.data,Q=F.items,T=h[E]||{attributes:{}};u&&!t.validateItems(Q,u)||(T.attributes[_]=S,T.attributes[b?"EXPR_1":v]=E,h[E]=T)}n.push({name:_,alias:_,type:"esriFieldTypeString"})}else{if(a){var R=this._calculateUniqueValues(t,o);for(var x in R){var M=R[x];E=M.data,Q=M.items;if(!u||t.validateItems(Q,u)){T=h[E]||{attributes:{}};var B=this._calculateStatistics(Q,t,v),C="var"===g?"variance":g;T.attributes[_]=B[C],T.attributes[o]=E,h[E]=T}}}else{f[v]||(f[v]=this._calculateStatistics(this.items,t,v));B=f[v],C="var"===g?"variance":g;d.attributes[_]=B[C]}n.push({name:_,alias:_,type:"esriFieldTypeDouble"})}}if(a)for(var j in h)i.push(h[j]);else i.push(d);return{fields:n,features:i}},e.prototype._calculateStatistics=function(e,t,r){for(var i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,s=null,u=null,a=null,o=null,l=[],c=0;c<e.length;c++){var h=e[c];null==(m=t.getFieldValue(h,r))||isNaN(m)||(s+=m,i=Math.min(i,m),n=Math.max(n,m),l.push(m))}var f=l.length;if(f){u=s/f;for(var d=0,p=0,y=l;p<y.length;p++){var m=y[p];d+=Math.pow(m-u,2)}o=f>1?d/(f-1):0,a=Math.sqrt(o)}else i=null,n=null;return{avg:u,count:f,max:n,min:i,stddev:a,sum:s,variance:o}},e.prototype._calculateUniqueValues=function(e,t){for(var r={},i=0,n=this.items;i<n.length;i++){var s=n[i],u=e.getFieldValue(s,t);(null==u||"string"==typeof u&&""===u.trim())&&(u=null),null==r[u]?r[u]={count:1,data:u,items:[s]}:(r[u].count++,r[u].items.push(s))}return r},e}();t.default=p}.apply(null,i))||(e.exports=n)},rfv1:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("Q2wQ"),r("HZ3d"),r("xdHJ"),r("ma1f"),r("H1tY"),r("qsST"),r("jEml"),r("lRq4"),r("+6sX")],void 0===(n=function(e,t,r,i,n,s,u,a,o,l,c){function h(e,t){return p.minX=t[0],p.minY=t[1],p.maxX=t[2],p.maxY=t[3],e.search(p)}Object.defineProperty(t,"__esModule",{value:!0});var f=[],d=a.getLogger("esri.layers.graphics.data.FeatureStore"),p={minX:0,minY:0,maxX:0,maxY:0},y=function(){function e(e){this._featuresById=new n.default,this._boundsByFeature=new n.default,this._featuresByBounds=new n.default,this._index=o(9,u("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._geometryInfo=e}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var e=l.create(l.NEGATIVE_INFINITY);return this._boundsByFeature.forEach(function(t){t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]))}),e},enumerable:!0,configurable:!0}),e.prototype.setEngine=function(e){this._engine=e},e.prototype.add=function(e){this._add(e,f),this._index.load(f),this._clearCache(),f.length=0},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._add(i,f)}this._index.load(f),this._clearCache(),f.length=0},e.prototype.clear=function(){this._featuresById.clear(),this._boundsByFeature.clear(),this._featuresByBounds.clear(),this._index.clear(),this._clearCache()},e.prototype.removeManyById=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this._featuresById.get(i);if(n){var s=this._boundsByFeature.get(n);s&&(this._index.remove(s),this._featuresByBounds.delete(s)),this._boundsByFeature.delete(n)}this._featuresById.delete(i)}this._clearCache()},e.prototype.forEachBounds=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r],s=this._boundsByFeature.get(n);s&&t(s,n)}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach(function(t){return e(t)})},e.prototype.forEachInBounds=function(e,t){for(var r=0,i=h(this._index,e);r<i.length;r++){var n=i[r];t(this._featuresByBounds.get(n))}},e.prototype.transferIds=function(e,t){for(var r=[],i=0,n=t;i<n.length;i++){var s=n[i],u=this._featuresById.get(s);u&&(this._remove(u),r.push(u))}e.addMany(r),this._clearCache()},e.prototype.transferIdRange=function(e,t,r){for(var i=[],n=t;n<r;n++){var s=this._featuresById.get(n);s&&(this._remove(s),i.push(s))}e.addMany(i),this._clearCache()},e.prototype.transferIf=function(e,t){var r=this,i=[];this._featuresById.forEach(function(e,n){t(e)&&(r._remove(e),i.push(e))}),e.addMany(i),this._clearCache()},e.prototype.transferAll=function(e){var t=this,r=[];this._featuresById.forEach(function(e,i){t._remove(e),r.push(e)}),e.addMany(r),this._clearCache()},e.prototype._clearCache=function(){this._engine&&this._engine.clearCache()},e.prototype._add=function(e,t){if(e){var r=e.objectId;if(null==r)return void d.error(new s("featurestore:invalid-feature","feature id is missing",{feature:e}));var i,n=this._featuresById.get(r);if(n&&(i=this._boundsByFeature.get(n))&&(this._index.remove(i),this._boundsByFeature.delete(n),this._featuresByBounds.delete(i)),!e.geometry)return this._boundsByFeature.set(e,null),void this._featuresById.set(r,e);i=c.getBoundsOptimizedGeometry(i||l.create(),e.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(e,i),this._featuresByBounds.set(i,e),this._featuresById.set(r,e),t.push(i)}},e.prototype._remove=function(e){var t;e&&((t=this._boundsByFeature.get(e))&&(this._index.remove(t),this._boundsByFeature.delete(e),this._featuresByBounds.delete(t)),this._featuresById.delete(e.objectId))},e}();t.default=y}.apply(null,i))||(e.exports=n)},tZaU:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("idNY"),r("qMld")],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=this;return i.create(function(r,i){t._deferreds.push({resolve:r,reject:i}),t._values.push(e)})},e.prototype.unshift=function(e){var t=this;return i.create(function(r,i){t._deferreds.unshift({resolve:r,reject:i}),t._values.unshift(e)})},Object.defineProperty(e.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,configurable:!0}),e.prototype.process=function(){return 0!==this.length&&(this._deferreds.shift().resolve(this._values.shift()),!0)},e.prototype.cancelAll=function(){for(var e=new r,t=0,i=this._deferreds;t<i.length;t++)i[t].reject(e);this._deferreds.length=0,this._values.length=0},e}();t.PromiseQueue=n}.apply(null,i))||(e.exports=n)}}]);