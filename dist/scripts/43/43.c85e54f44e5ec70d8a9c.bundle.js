(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/webgl-engine/shaders/EdgeRendererPrograms":"+YS2","esri/views/3d/webgl-engine/lib/geometryDataUtils":"+nCE","esri/views/3d/webgl-engine/materials/NativeLineMaterial":"+v1/","esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":"+wMf","esri/layers/graphics/data/timeSupport":"/61J","esri/views/3d/webgl-engine/lib/glUtil3D":"/Bau","esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":"/F0A","esri/views/3d/support/geometryUtils/sphere":"/dtL","esri/views/webgl/FramebufferObject":"/f24","esri/views/3d/webgl-engine/lib/ModelContentType":"05NA","esri/views/layers/StreamLayerView":"0NBi","esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":"1+3M","esri/views/3d/support/geometryUtils/vector":"18xY","esri/views/3d/webgl-engine/shaders/OffscreenPrograms":"1CCn","esri/core/libs/earcut/earcut":"1E+e","esri/views/3d/webgl-engine/lib/depthRangeUtils":"1bVs","esri/core/sql/WhereClause":"1eyA","esri/views/3d/webgl-engine/lib/doublePrecisionUtils":"1f+t","esri/core/libs/gl-matrix-2/mat4f64":"1m5D","esri/core/TimeProfiler":"23eD","esri/views/3d/webgl-engine/lib/ProgramRepository":"2A3h","esri/views/3d/support/buffer/InterleavedLayout":"2B1V","esri/views/3d/webgl-engine/lib/SliceHelper":"2CPm","esri/views/3d/webgl-engine/lighting/SphericalHarmonics":"2Mej","esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":"2TjI","esri/views/3d/layers/graphics/Graphics3DSymbolFactory":"2UbT","esri/views/3d/support/geometryUtils/boundedPlane":"2eYJ","esri/views/3d/webgl-engine/lib/HighlightHelper":"2f4f","esri/core/libs/gl-matrix-2/vec4":"2fXB","esri/views/3d/layers/StreamLayerView3D":"2vyw","esri/views/3d/webgl-engine/shaders/MiscPrograms":"31XB","esri/views/webgl/capabilities/load":"37NJ","esri/views/webgl/RenderingContext":"3KT0","esri/views/3d/layers/graphics/Graphics3DHighlightSet":"3Noo","esri/views/3d/webgl-engine/lib/BoundingInfo":"3RHn","esri/geometry/support/triangulationUtils":"3Zlx","esri/core/libs/gl-matrix-2/factories/vec4f32":"3gjc","esri/views/3d/layers/support/FastSymbolUpdates":"3w6h","esri/layers/graphics/data/QueryEngineCapabilities":"4/qq","esri/views/3d/layers/FeatureLikeLayerView3D":"4PmR","esri/views/3d/support/geometryUtils/ray":"4p4v","esri/views/3d/webgl-engine/lib/GeometryUtil":"4ziW","esri/core/libs/gl-matrix-2/mat3f64":"51bw","esri/views/3d/layers/support/symbolColorUtils":"55f2","esri/views/3d/glTF/DefaultLoadingContext":"5PWn","esri/views/3d/webgl-engine/lib/HighlightSet":"5iSs","esri/views/3d/webgl-engine/lib/RenderPluginManager":"6wId","esri/layers/graphics/data/AttributesBuilder":"700l","esri/views/3d/layers/support/edgeUtils":"763n","esri/views/3d/glTF/internal/pathUtils":"7eim","esri/views/webgl/capabilities/isWebGL2Context":"7laH","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":"8fHt","esri/views/3d/webgl-engine/lib/GLTextureRep":"8nmy","esri/views/3d/webgl-engine/lib/intersectorUtils":"9DjX","esri/views/3d/webgl-engine/lib/GLMaterialTexture":"9FJH","esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":"9KSR","esri/geometry/support/ValueMeshColor":"9Ros","esri/views/3d/support/FrustumExtentIntersection":"9YDZ","esri/views/3d/support/buffer/utils/vec2":"9o4r","esri/views/3d/webgl-engine/lib/depthRange":"9pvv","esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":"9v8t","esri/views/3d/webgl-engine/lib/IntervalUtilities":"AASg","esri/views/3d/webgl-engine/lib/GeometryData":"AgDx","esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":"B294","esri/views/3d/layers/graphics/Graphics3DFilterVisibility":"B9tS","esri/views/3d/support/meshProcessing":"BIt0","esri/views/3d/webgl-engine/lib/edgeRendering/util":"BtPY","esri/views/3d/layers/graphics/graphicUtils":"BwdQ","esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":"ByvF","esri/views/3d/webgl-engine/shaders/DefaultPrograms":"C2Ab","esri/views/3d/webgl-engine/lib/Util":"CIy2","esri/core/libs/gl-matrix-2/factories/mat4f64":"CIzB","esri/views/3d/webgl-engine/lib/GeometryRecord":"Cvn+","esri/views/3d/webgl-engine/lib/InstanceBufferData":"D8s1","esri/views/3d/webgl-engine/shaders/LineCalloutPrograms":"DSFQ","esri/views/3d/webgl-engine/lib/webgl-debug":"DXwx","esri/views/3d/support/debugFlags":"Dk48","esri/views/webgl/capabilities/Instancing":"DlJW","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":"E/UE","esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":"EAl+","esri/views/3d/webgl-engine/lib/DefaultTextureUnits":"EiD/","esri/core/libs/gl-matrix-2/quat":"EuvN","esri/views/3d/webgl-engine/lib/DDSUtil":"EyQ4","esri/views/3d/layers/graphics/ElevationQuery":"F0v3","esri/views/3d/webgl-engine/lib/Renderer":"FM7k","esri/views/3d/webgl-engine/shaders/ColorPrograms":"FMAd","esri/views/3d/webgl-engine/lib/Material":"FNtW","esri/views/3d/webgl-engine/lib/GLMaterialRep":"FU3N","esri/views/3d/support/buffer/workerHelper":"Fsr7","esri/layers/graphics/centroid":"Fzzg","esri/views/3d/support/geometryUtils/plane":"GG08","esri/views/3d/layers/graphics/Graphics3DGraphic":"GNH0","esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":"Geb9","esri/views/3d/support/buffer/types":"GntT","esri/views/3d/support/geometryUtils/axisAngle":"GyfB","esri/views/3d/support/buffer/utils/vec4":"Gz8v","esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":"HSGS","esri/views/3d/layers/graphics/constants":"HbaO","esri/views/3d/webgl-engine/parts/Model":"I67D","esri/views/3d/webgl-engine/lib/lodRendering/LodResources":"IZai","esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":"IfBv","esri/views/3d/layers/graphics/sdfPrimitives":"J2BX","esri/views/3d/webgl-engine/lib/pathGeometryUtils":"J5Ri","esri/views/3d/webgl-engine/parts/View":"JUgm","esri/views/3d/support/stack":"JjCO","esri/views/3d/layers/graphics/Graphics3DSymbolLayer":"JzVu","esri/views/3d/webgl-engine/lib/TextRenderParameters":"K9FT","esri/views/3d/webgl-engine/lib/LongVectorMath":"KPBO","esri/geometry/support/ImageMeshColor":"L6ij","esri/views/3d/support/PromiseLightweight":"LFjk","esri/views/3d/webgl-engine/lib/SSAOHelper":"Lb4W","esri/views/3d/layers/graphics/symbolComplexity":"LiJt","esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":"LyIS","esri/views/3d/webgl-engine/materials/LineCalloutMaterial":"M9wp","esri/views/3d/support/buffer/internals/Vec4":"MI3s","esri/views/3d/support/intersectionUtils":"Mk25","esri/views/3d/support/buffer/glUtil":"MzcX","esri/views/3d/support/geometryUtils/lineSegment":"N5NQ","esri/core/libs/gl-matrix-2/vec4f64":"O7NG","esri/views/3d/glTF/internal/Resource":"OIWm","esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":"OUux","esri/views/3d/layers/LayerView3D":"Ondo","esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":"Ozid","esri/core/ObjectStack":"PHan","esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":"PNay","esri/views/3d/glTF/internal/fillDefaults":"PT+s","esri/views/3d/webgl-engine/materials/renderers/utils":"PwS/","esri/views/3d/support/buffer/math":"Q39H","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":"Q55v","esri/views/3d/layers/graphics/Graphics3DPointSymbol":"Q7+X","esri/views/3d/webgl-engine/lighting/SceneLighting":"QDiq","esri/views/3d/webgl-engine/parts/Viewport":"QJWI","esri/views/3d/support/buffer/math/vec4":"QTYv","esri/views/3d/webgl-engine/lib/DrapedRenderer":"QWGo","esri/views/3d/layers/graphics/Graphics3DCore":"R8fa","esri/views/3d/webgl-engine/materials/RibbonLineMaterial":"RC9r","esri/views/3d/webgl-engine/lib/RenderContext":"Raj5","esri/views/3d/layers/graphics/wosrLoader":"Rqxa","esri/views/webgl/Renderbuffer":"Rrc3","esri/views/3d/webgl-engine/lib/Camera":"RsYQ","esri/core/libs/rbush/PooledRBush":"RtHu","esri/views/3d/layers/graphics/Graphics3DScaleVisibility":"Rzdu","esri/core/libs/gl-matrix-2/factories/quatf64":"SgdR","esri/views/webgl/InstanceCounter":"TCFx","esri/views/3d/webgl-engine/materials/DefaultMaterial":"TP2F","esri/core/libs/gl-matrix-2/factories/vec4f64":"TPlk","esri/views/3d/support/buffer/math/common":"TUJR","esri/views/3d/webgl-engine/shaders/SSAOPrograms":"TZB2","esri/views/3d/webgl-engine/shaders/globalOptions":"Teen","esri/views/3d/support/buffer/utils":"TqPN","esri/views/3d/glTF/LoaderResult":"TqrP","esri/geometry/support/MeshComponent":"TsU/","esri/views/webgl/capabilities/DisjointTimerQuery":"U6iw","esri/views/3d/webgl-engine/lib/LocalOriginManager":"UD5A","esri/views/3d/webgl-engine/shaders/RibbonLinePrograms":"UtTF","esri/layers/graphics/data/spatialQuerySupport":"V1i6","esri/views/3d/layers/graphics/lodResourceUtils":"V6Fi","esri/views/3d/webgl-engine/shaders/sources/shaderRepository":"VVgn","esri/views/3d/layers/graphics/ElevationAligners":"VW5z","esri/views/3d/support/buffer/BufferView":"VfPl","esri/views/3d/webgl-engine/lib/IdGen":"W0kZ","esri/views/3d/support/buffer/utils/vec3":"W5Zm","esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":"W7eI","esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":"WRNQ","esri/views/layers/LayerView":"WsO6","esri/views/3d/webgl-engine/lib/Float32ArrayList":"XCS5","esri/views/3d/layers/graphics/Graphics3DSymbol":"XIUG","esri/layers/graphics/QueryEngine":"XJx5","esri/views/3d/webgl-engine/lib/ModelDirtySet":"Xih7","esri/views/3d/webgl-engine/shaders/HUDPrograms":"Yr/n","esri/layers/graphics/data/attributeSupport":"Ytki","esri/views/3d/webgl-engine/lib/Object3D":"ZJC8","esri/views/3d/webgl-engine/lib/Layer":"ZO6V","esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":"ZeO9","esri/views/3d/support/geometryUtils/triangle":"ZjcA","esri/layers/graphics/data/QueryEngine":"ZooB","esri/views/webgl/Texture":"Zp3t","esri/views/3d/glTF/internal/indexUtils":"ZuXA","esri/views/3d/support/geometryUtils":"aWgr","esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":"ama6","esri/core/libs/gl-matrix-2/math/vec4":"bH65","esri/views/3d/support/buffer/internals/Vec2":"bduU","esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":"c7Gp","esri/views/3d/glTF/DefaultErrorContext":"cE5x","esri/views/3d/layers/graphics/objectResourceUtils":"cMCQ","esri/views/3d/webgl-engine/lib/RenderGeometry":"cjy9","esri/views/3d/support/geometryUtils/frustum":"cpxo","esri/views/3d/support/buffer/utils/scalar":"cza4","esri/layers/graphics/data/QueryEngineResult":"d81A","esri/views/3d/support/buffer/utils/mat4":"dB/a","esri/renderers/support/rendererConversion":"dJJN","esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":"dQtU","esri/views/webgl/Profiling":"deO7","esri/views/3d/webgl-engine/lib/ShadowMap":"doLD","esri/views/3d/layers/graphics/Graphics3DElevationAlignment":"eCSb","esri/views/3d/webgl-engine/lib/localOrigin":"eHCP","esri/views/3d/support/buffer/utils/mat3":"f3AO","esri/views/3d/webgl-engine/lib/ManagingDisposable":"fHD9","esri/views/3d/support/buffer/internals/Mat4":"fHyw","esri/views/3d/layers/graphics/ElevationContext":"fOZq","esri/views/3d/webgl-engine/materials/renderers/HardwareInstancedRenderer":"fPnv","esri/views/3d/support/buffer/math/vec3":"fV0t","esri/views/3d/support/geometryUtils/clipRay":"fXZm","esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":"fXwo","esri/views/3d/webgl-engine/lib/TextTexture":"fZgo","esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":"ff/U","esri/views/3d/webgl-engine/shaders/PathPrograms":"flZ8","esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":"foHJ","esri/layers/graphics/contains":"gT/q","esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":"gldz","esri/geometry/support/MeshTexture":"h2zc","esri/views/3d/layers/graphics/lineUtils":"hADE","esri/renderers/support/renderingInfoUtils":"hCl0","esri/views/3d/support/buffer/internals/Vec3":"hQPx","esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":"hkmr","esri/views/3d/webgl-engine/materials/internal/bufferWriters":"hnAi","esri/views/3d/webgl-engine/shaders/HighlightPrograms":"i9pz","esri/geometry/support/MeshMaterial":"icpk","esri/core/libs/gl-matrix-2/vec4f32":"j2SP","esri/views/3d/glTF/loader":"jj3b","esri/views/3d/webgl-engine/lib/SmaaRenderPass":"jlKI","esri/geometry/support/meshUtils/deduplicate":"jmRc","esri/views/3d/layers/graphics/Graphics3DHighlights":"joKa","esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":"juQt","esri/views/3d/support/PropertiesPool":"kW7X","esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":"kfwU","esri/views/3d/webgl-engine/Stage":"krVM","esri/core/sql/StandardizedFunctions":"l8NS","esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":"l8Vi","esri/core/libs/gl-matrix-2/quatf64":"lLWD","esri/views/3d/webgl-engine/lib/Octree":"mYMs","esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":"meB3","esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":"nBma","esri/views/3d/webgl-engine/materials/ColorMaterial":"o5p5","esri/views/3d/layers/support/projectExtentUtils":"ocJ8","esri/views/3d/webgl-engine/lib/localOriginHelper":"p23x","esri/views/3d/webgl-engine/lib/RenderTargetHelper":"pBV3","esri/views/3d/support/buffer/internals/Mat3":"pIuP","esri/views/3d/glTF/esriProvidedModelParameters":"pN8M","esri/views/3d/webgl-engine/materials/renderers/Instance":"pbva","esri/views/3d/webgl-engine/lib/tracer":"pgjK","esri/views/3d/webgl-engine/lib/edgeRendering/strokes":"qC//","esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":"qSXe","esri/views/3d/webgl-engine/lighting/Lightsources":"qUb7","esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":"qVs7","esri/views/webgl/renderState":"qbr3","esri/core/libs/gl-matrix-2/types/mat4":"qvwY","esri/layers/graphics/data/FeatureStore":"rfv1","esri/views/3d/webgl-engine/lib/ComponentUtils":"rjU6","esri/geometry/support/meshUtils/projection":"s3uR","esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":"s4LJ","esri/views/3d/webgl-engine/materials/internal/MaterialUtil":"s6rJ","esri/geometry/support/MeshVertexAttributes":"sDf1","esri/views/3d/support/Evented":"sIhy","esri/views/3d/webgl-engine/lib/GLMaterial":"tUyH","esri/layers/support/PromiseQueue":"tZaU","esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":"txdo","esri/views/3d/webgl-engine/materials/renderers/InstancedRenderer":"uNX8","esri/views/webgl/enums":"uwSd","esri/views/3d/webgl-engine/lib/lodRendering/utils":"v+3j","esri/views/webgl/capabilities/VertexArrayObjects":"veTl","esri/core/sql/AggregateFunctions":"vjUK","esri/core/Version":"w00x","esri/views/3d/layers/support/attributeUtils":"w9Zc","esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":"wCQF","esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":"wKWA","esri/views/3d/glTF/internal/BinaryStreamReader":"wR99","esri/core/VectorStack":"wSO/","esri/views/3d/support/imageUtils":"weRx","esri/core/libs/gl-matrix-2/math/quat":"weYu","esri/geometry/support/MeshColor":"x+x8","esri/views/3d/webgl-engine/materials/HUDMaterial":"xFEL","esri/core/libs/gl-matrix-2/factories/mat3f64":"xf8T","esri/views/3d/webgl-engine/lib/FxaaRenderPass":"xgKb","esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":"xlkQ","esri/views/3d/webgl-engine/lib/HighlightUtils":"xsp2","esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":"yBJI","esri/views/3d/layers/graphics/Graphics3DSpatialIndex":"yJEJ","esri/views/3d/layers/graphics/featureExpressionInfoUtils":"yVFQ","esri/views/3d/webgl-engine/lib/TextRenderer":"ybft","esri/views/3d/webgl-engine/lib/Texture":"yqrJ","esri/views/3d/webgl-engine/lib/Geometry":"ys4y","esri/layers/graphics/data/utils":"zDti","esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":"zF3d","esri/views/3d/webgl-engine/materials/PathMaterial":"zU7+","esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":"zZCp","esri/views/3d/webgl-engine/shaders/sources/resolver":"zbgD","esri/views/3d/support/buffer/internals/Scalar":"zlCF","esri/views/3d/webgl-engine/shaders/NativeLinePrograms":"zpp+"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[43,7,11,13,75],{"+YS2":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zbgD"),r("U+8K")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return n.glslifyDefineMap({MODE:{value:e.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:e.silhouette,ANTIALIASING:e.antialiasing,SLICE:e.slice})};t.program={name:"edges",shaders:function(e){return{vertexShader:i(e)+r.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:i(e)+r.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}}.apply(null,n))||(e.exports=i)},"+nCE":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=1,n=null;t.generateDefaultIndexArray=function(e){if(e>r||null==n){for(;e>r;)r*=2;n=new Uint32Array(r);for(var t=0;t<r;t++)n[t]=t}return new Uint32Array(n.buffer,0,e)};var i=0;t.getNewId=function(){return i++}}.apply(null,n))||(e.exports=i)},"+v1/":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("qsST"),r("jBNx"),r("W9tT"),r("0LE5"),r("Rdxj"),r("aWgr"),r("2B1V"),r("rjU6"),r("tUyH"),r("FNtW"),r("CIy2"),r("hnAi"),r("s6rJ"),r("ZeO9"),r("zpp+"),r("qbr3")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y){var b=n.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial"),x=function(e){function t(t,r){var n=e.call(this,r)||this;return n.params=v.copyParameters(t,w),n}return r(t,e),t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)t[r]=e[r];this.notifyDirty("matChanged")},t.prototype.getParameters=function(){return this.params},t.prototype.getColor=function(){return this.params.color},t.prototype.intersect=function(e,t,r,n,i,a,o,s,l){l?this.intersectLineGeometry(e,t,r,n,i,a,o):v.intersectDrapedRenderLineGeometry(e,t,r,n,i,a,1,o)},t.prototype.intersectLineGeometry=function(e,t,r,n,i,s,c,d){if(n.enable.selectionMode&&!u.isAllHidden(t.componentVisibilities,e.componentOffsets)){if(!p.isTranslationMatrix(r))return void b.error("intersection assumes a translation-only matrix");var f=e.data.getVertexAttr().position.data,h=n.camera,v=F;a.vec2.copy(v,n.point),o.vec3.set(B[0],v[0]-2,v[1]+2,0),o.vec3.set(B[1],v[0]+2,v[1]+2,0),o.vec3.set(B[2],v[0]+2,v[1]-2,0),o.vec3.set(B[3],v[0]-2,v[1]-2,0);for(var m=0;m<4;m++)h.unprojectPoint(B[m],N[m]);l.plane.fromPoints(h.eye,N[0],N[1],U),l.plane.fromPoints(h.eye,N[1],N[2],z),l.plane.fromPoints(h.eye,N[2],N[3],j),l.plane.fromPoints(h.eye,N[3],N[0],G);var g=Number.MAX_VALUE;for(m=0;m<f.length-5;m+=3)if(E[0]=f[m]+r[12],E[1]=f[m+1]+r[13],E[2]=f[m+2]+r[14],T[0]=f[m+3]+r[12],T[1]=f[m+4]+r[13],T[2]=f[m+5]+r[14],!(l.plane.signedDistance(U,E)<0&&l.plane.signedDistance(U,T)<0||l.plane.signedDistance(z,E)<0&&l.plane.signedDistance(z,T)<0||l.plane.signedDistance(j,E)<0&&l.plane.signedDistance(j,T)<0||l.plane.signedDistance(G,E)<0&&l.plane.signedDistance(G,T)<0)){if(h.projectPoint(E,R),h.projectPoint(T,M),R[2]<0&&M[2]>0){o.vec3.subtract(O,E,T);var y=h.frustum,x=-l.plane.signedDistance(y.planes[4],E)/o.vec3.dot(O,y.planes[4]);o.vec3.scale(O,O,x),o.vec3.add(E,E,O),h.projectPoint(E,R)}else if(R[2]>0&&M[2]<0){o.vec3.subtract(O,T,E);y=h.frustum,x=-l.plane.signedDistance(y.planes[4],T)/o.vec3.dot(O,y.planes[4]);o.vec3.scale(O,O,x),o.vec3.add(T,T,O),h.projectPoint(T,M)}else if(R[2]<0&&M[2]<0)continue;R[2]=0,M[2]=0;var _=l.lineSegment.distance2(l.lineSegment.fromPoints(R,M,V),v);_<g&&(g=_,o.vec3.copy(I,E),o.vec3.copy(D,T))}var S=n.rayBeginPoint,w=n.rayEndPoint;if(g<4){var C=Number.MAX_VALUE;if(l.lineSegment.closestLineSegmentPoint(l.lineSegment.fromPoints(I,D,V),l.lineSegment.fromPoints(S,w,L),A)){o.vec3.subtract(A,A,S);var P=o.vec3.length(A);o.vec3.scale(A,A,1/P),C=P/o.vec3.distance(S,w)}c(C,A)}}},t.prototype.createBufferWriter=function(){return new P(this.params)},t.prototype.createRenderer=function(e,t){return new m(e,t,this)},t.prototype.getGLMaterials=function(){return{color:_,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:S}},t.prototype.getAllTextureIds=function(){return[]},t}(f),_=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=v.copyParameters(this.material.getParameters()),this.selectProgram()},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(g.colorPass,{slice:e.slicePlaneEnabled,vertexColors:this.params.vertexColors}),this.pipelineState=y.makePipelineState({blending:e.color[3]<1&&y.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.beginSlot=function(e){return 4===e},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),e.setPipelineState(this.pipelineState),r.setUniform4fv("constantColor",n.color)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params;v.bindView(t.origin,t.view,r),n.slicePlaneEnabled&&v.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 1},t}(d),S=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=v.copyParameters(this.material.getParameters()),this.selectProgram()},t.prototype.beginSlot=function(e){return 4===e},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){this.program=this.programRep.getProgram(g.highlightPass,{slice:this.params.slicePlaneEnabled,vertexColors:this.params.vertexColors}),this.pipelineState=y.makePipelineState({depthTest:{func:513},colorWrite:y.defaultColorWriteParams})},t.prototype.bind=function(e,t){e.bindProgram(this.program),e.setPipelineState(this.pipelineState),v.bindHighlightRendering(e,t,this.program)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params;v.bindView(t.origin,t.view,r),n.slicePlaneEnabled&&v.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 1},t}(d),w={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1},C=c.newLayout().vec3f(p.VertexAttrConstants.POSITION),P=function(){function e(e){this.vertexBufferLayout=c.newLayout().vec3f(p.VertexAttrConstants.POSITION),e.vertexColors&&(this.vertexBufferLayout=C.vec4u8(p.VertexAttrConstants.COLOR))}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices[p.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,n,i){h.writeDefaultAttributes(t,r,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,i)},e}(),E=s.vec3f64.create(),T=s.vec3f64.create(),O=s.vec3f64.create(),A=s.vec3f64.create(),R=i.createRenderScreenPointArray3(),M=i.createRenderScreenPointArray3(),I=s.vec3f64.create(),D=s.vec3f64.create(),V=l.lineSegment.create(),L=l.lineSegment.create(),F=s.vec3f64.create(),B=[i.createRenderScreenPointArray3(),i.createRenderScreenPointArray3(),i.createRenderScreenPointArray3(),i.createRenderScreenPointArray3()],N=[s.vec3f64.create(),s.vec3f64.create(),s.vec3f64.create(),s.vec3f64.create()],U=l.plane.create(),z=l.plane.create(),j=l.plane.create(),G=l.plane.create();return x}.apply(null,n))||(e.exports=i)},"+wMf":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("wPX3"),r("AzkI")],void 0===(i=function(e,t,r,n){function i(e){return Math.abs(e*e*e)}function a(e,t,r,n){void 0===n&&(n=d);var a=r.parameters,o=r.paddingPixelsOverride;return n.scale=Math.min(a.divisor/(t-a.offset),1),n.factor=i(e),n.minPixelSize=a.minPixelSize,n.paddingPixels=o,n}function o(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function s(e,t){return Math.max(n.lerp(e*t.scale,e,t.factor),o(e,t))}function l(e,t,r){var n=a(e,t,r);return n.minPixelSize=0,n.paddingPixels=0,s(1,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.getSettings=function(e){return new c(e,t.defaultDescription)},t.getLabelSettings=function(e){var r=t.defaultDescription.curvatureDependent,n=t.defaultDescription.scaleStart,i=t.defaultDescription.scaleFallOffRange;return new c(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:u.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:u.curvatureDependent.max.scaleFallOffFactor}},scaleStart:n,scaleFallOffRange:i,minPixelSize:u.minPixelSize})},t.perspectiveFactor=i,t.scaleFactor=a,t.applyScaleFactor=s,t.applyScaleFactorVec2=function(e,t,r){void 0===r&&(r=[0,0]);var i=Math.min(Math.max(t.scale,o(e[1],t)/e[1]),1);return r[0]=n.lerp(e[0]*i,e[0],t.factor),r[1]=n.lerp(e[1]*i,e[1],t.factor),r},t.precomputeScale=l,t.precomputeScaleFactor=function(e,t,r,n){return n.scale=l(e,t,r),n.factor=0,n.minPixelSize=r.parameters.minPixelSize,n.paddingPixels=r.paddingPixelsOverride,n},t.applyPrecomputedScaleFactorVec2=function(e,t,r){void 0===r&&(r=[0,0]);var n=Math.min(Math.max(t.scale,o(e[1],t)/e[1]),1);return r[0]=e[0]*n,r[1]=e[1]*n,r},t.scale=function(e,t,r,n){return s(e,a(t,r,n))};var c=function(){function e(e,t,r,n){void 0===r&&(r={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}),this.viewingMode=e,this.description=t,this.parameters=r,this._paddingPixelsOverride=n,"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}return Object.defineProperty(e.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0}),e.prototype.update=function(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this.calculateParameters(e,this.parameters),0))},e.prototype.overridePadding=function(t){return t!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.parameters,t):this},e.prototype.calculateParameters=function(e,t){var r=this.description,n=r.scaleStart,i=r.scaleFallOffRange,a=r.minPixelSize,o=e.fovY,s=e.distance,l=this.calculateCurvatureDependentParameters(e),c=this.coverageCompensation(e,l),u=l.tiltAngle,d=l.scaleFallOffFactor,f=Math.sin(u)*s,p=.5*Math.PI-u-o*(.5-n*c),h=f/Math.cos(p),v=p+o*i*c,m=(h-d*(f/Math.cos(v)))/(1-d);return t.camera.fovY=e.fovY,t.camera.distance=e.distance,t.offset=m,t.divisor=h-m,t.minPixelSize=a,t},e.prototype.calculateCurvatureDependentParametersLocal=function(e,t){return void 0===t&&(t=f),t.tiltAngle=this.description.curvatureDependent.min.tiltAngle,t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,t},e.prototype.calculateCurvatureDependentParametersGlobal=function(e,t){void 0===t&&(t=f);var i=this.description.curvatureDependent,a=1+e.distance/r.earthRadius,o=Math.sqrt(a*a-1),s=[i.min.curvature,i.max.curvature],l=s[0],c=s[1],u=n.clamp((o-l)/(c-l),0,1),d=[i.min,i.max],p=d[0],h=d[1];return t.tiltAngle=n.lerp(p.tiltAngle,h.tiltAngle,u),t.scaleFallOffFactor=n.lerp(p.scaleFallOffFactor,h.scaleFallOffFactor,u),t},e.prototype.surfaceCoverageCompensationLocal=function(e,t){return(e.fovY-t.tiltAngle)/e.fovY},e.prototype.surfaceCoverageCompensationGlobal=function(e,t){var n=r.earthRadius*r.earthRadius,i=t.tiltAngle+.5*Math.PI,a=e.fovY,o=e.distance,s=o*o+n-2*Math.cos(i)*o*r.earthRadius,l=Math.sqrt(s),c=Math.sqrt(s-n);return(Math.acos(c/l)-Math.asin(r.earthRadius/(l/Math.sin(i)))+.5*a)/a},e}();t.defaultDescription={curvatureDependent:{min:{curvature:n.deg2rad(10),tiltAngle:n.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:n.deg2rad(70),tiltAngle:n.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var u={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};t.copyParameters=function(e,t){return t.camera.distance=e.camera.distance,t.camera.fovY=e.camera.fovY,t.divisor=e.divisor,t.offset=e.offset,t.minPixelSize=e.minPixelSize,t};var d={scale:0,factor:0,minPixelSize:0,paddingPixels:0},f={tiltAngle:0,scaleFallOffFactor:0}}.apply(null,n))||(e.exports=i)},"/61J":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r,n){return!(r>t||n<e)}function n(e,t,n,i){if(null!=n&&null!=i&&n===i){var a=n;return function(r){return a>=r.attributes[e]&&a<=r.attributes[t]}}return null!=n&&null!=i?function(a){return r(n,i,a.attributes[e],a.attributes[t])}:null!=n?function(e){return!(e.attributes[t]<n)}:null!=i?function(t){return!(t.attributes[e]>i)}:void 0}function i(e,t,r){return null!=t&&null!=r&&t===r?function(r){return r.attributes[e]===t}:null!=t&&null!=r?function(n){return n.attributes[e]>=t&&n.attributes[e]<=r}:null!=t?function(r){return r.attributes[e]>=t}:null!=r?function(t){return t.attributes[e]<=r}:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.getTimeExtent=function(e,t){if(!e)return null;var r=e.startTimeField,n=e.endTimeField,i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(r&&n)t.forEach(function(e){var t=e.attributes,o=t[r],s=t[n];null==o||isNaN(o)||(i=Math.min(i,o)),null==s||isNaN(s)||(a=Math.max(a,s))});else{var o=r||n;t.forEach(function(e){var t=o,r=e.attributes[t];null==r||isNaN(r)||(i=Math.min(i,r),a=Math.max(a,r))})}return{start:i,end:a}},t.getTimeOperator=function(e,t){if(!t||!e)return null;var r=e.startTimeField,a=e.endTimeField;if(!r&&!a)return null;var o=t.start,s=t.end;return null==o&&null==s?null:r&&a?n(r,a,o,s):i(r||a,o,s)}}.apply(null,n))||(e.exports=i)},"/Bau":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zZCp"),r("QFi0"),r("Zp3t"),r("z2+Q")],void 0===(i=function(e,t,r,n,i,a,o){Object.defineProperty(t,"__esModule",{value:!0}),t.createQuadVAO=function(e,t){void 0===t&&(t=n.Pos2);var a=null;switch(t){case n.Pos3Tex:a=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case n.Pos3:a=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case n.Pos2Tex:a=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;case n.Pos2:default:a=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new o(e,r.Default3D,{geometry:t},{geometry:i.createVertex(e,35044,a)})};var s=4;t.createEmptyTexture=function(e,t){return void 0===t&&(t=s),new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:t,height:t})},t.createColorTexture=function(e,t,r){void 0===r&&(r=s);for(var n=new Uint8Array(r*r*4),i=0;i<n.length;i+=4)n[i+0]=255*t[0],n[i+1]=255*t[1],n[i+2]=255*t[2],n[i+3]=255*t[3];return new a(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:r,height:r},n)}}.apply(null,n))||(e.exports=i)},"/F0A":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("eIBl"),r("8MXS"),r("Vx27"),r("wPX3"),r("9YDZ")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c){var u=-.3*l.earthRadius;return function(e){function t(){var t=e.call(this)||this;return t.suspended=!0,t._frustumVisibilityDirty=!0,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new a,t.layerView=null,t}return r(t,e),Object.defineProperty(t.prototype,"frustumVisibilityDirty",{get:function(){return this._frustumVisibilityDirty},set:function(e){e!==this._frustumVisibilityDirty&&(this._frustumVisibilityDirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.frustumVisibilityDirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new c.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var r=e.view,n=r.basemapTerrain,i=r.resourceController.scheduler;this.handles.add([r.on("resize",function(){return t.viewChange()}),r.state.watch("camera",function(){return t.viewChange()},!0),i.registerTask(6,function(){return t.update()},function(){return t.needsUpdate()}),n.on("elevation-bounds-change",function(){return t.elevationBoundsChange()})]),"local"===r.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(o.init(n,["opacity","wireframe"],function(){return t.isVisibleBelowSurface=!n.isOpaque()}))},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this.frustumVisibilityDirty=!0},t.prototype.viewChange=function(){this.frustumVisibilityDirty=!0},t.prototype.elevationBoundsChange=function(){this.frustumVisibilityDirty=!0,this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this.frustumVisibilityDirty=!0,this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.needsUpdate=function(){return this.frustumVisibilityDirty},t.prototype.update=function(){this.updateSuspendFrustumVisible(),this.frustumVisibilityDirty=!1},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=u;else{var r=t.basemapTerrain.getElevationBounds(),n=r[0],i=r[1];e=n-Math.max(1,(i-n)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.updateSuspendFrustumVisible=function(){if(this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},n([s.property({readOnly:!0})],t.prototype,"suspended",void 0),n([s.property({readOnly:!0})],t.prototype,"updating",null),n([s.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(s.declared(i))}.apply(null,n))||(e.exports=i)},"/dtL":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("qsST"),r("PHan"),r("FXVB"),r("0LE5"),r("Rdxj"),r("aWgr"),r("AzkI"),r("JjCO"),r("4p4v")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d){function f(e){return e?{radius:e.radius,center:s.vec3f64.clone(e.center)}:{radius:1,center:s.vec3f64.create()}}function p(e,t){return void 0===t&&(t=f()),h(e.radius,e.center,t)}function h(e,t,r){return void 0===r&&(r=f()),o.vec3.copy(r.center,t),r.radius=e,r}function v(e,t,r){var n=o.vec3.subtract(u.sv3d.get(),t.origin,e.center),i=o.vec3.dot(t.direction,t.direction),a=2*o.vec3.dot(t.direction,n),s=a*a-4*i*(o.vec3.dot(n,n)-e.radius*e.radius);if(s<0)return!1;var l=Math.sqrt(s),c=(-a-l)/(2*i),d=(-a+l)/(2*i);return(c<0||d<c&&d>0)&&(c=d),!(c<0||(r&&o.vec3.add(r,t.origin,o.vec3.scale(u.sv3d.get(),t.direction,c)),0))}function m(e,t,r){var n=u.sv3d.get(),i=u.sm4d.get();o.vec3.cross(n,t.origin,t.direction),o.vec3.cross(r,n,t.origin),o.vec3.scale(r,r,1/o.vec3.length(r)*e.radius);var s=y(e,t.origin),c=l.vector.angle(t.origin,r);return a.mat4.identity(i),a.mat4.rotate(i,i,c+s,n),o.vec3.transformMat4(r,r,i),r}function g(e,t,r){var n=o.vec3.subtract(u.sv3d.get(),t,e.center),i=o.vec3.scale(u.sv3d.get(),n,e.radius/o.vec3.length(n));return o.vec3.add(r,i,e.center)}function y(e,t){var r=o.vec3.subtract(u.sv3d.get(),t,e.center),n=o.vec3.length(r),i=e.radius+Math.abs(e.radius-n);return c.acos(e.radius/i)}function b(e,t,n,i){var a=o.vec3.subtract(S,t,e.center);switch(n){case 0:var s=(l=c.cartesianToSpherical(a,S))[2];return o.vec3.set(i,-Math.sin(s),Math.cos(s),0);case 1:var l,u=(l=c.cartesianToSpherical(a,S))[1],d=(s=l[2],Math.sin(u));return o.vec3.set(i,-d*Math.cos(s),-d*Math.sin(s),Math.cos(u));case 2:return o.vec3.normalize(i,a);default:r.neverReached(n)}}function x(e,t){var r=o.vec3.subtract(E,t,e.center);return o.vec3.length(r)-e.radius}Object.defineProperty(t,"__esModule",{value:!0});var _=n.getLogger("esri.views.3d.support.geometryUtils.sphere");t.create=f,t.wrap=function(e,t){var r=w.get();return r.radius=e,r.center=t||P,r},t.copy=p,t.fromValues=h,t.elevate=function(e,t,r){return e!==r&&o.vec3.copy(r.center,e.center),r.radius=e.radius+t,r},t.setExtent=function(e,t,r){return _.error("sphere.setExtent is not yet supported"),e===r?r:p(e,r)},t.intersectRay=v,t.intersectScreen=function(e,t,r,n){return v(e,d.fromScreenAtEye(t,r,C),n)},t.intersectsRay=function(e,t){return v(e,t,null)},t.intersectRayClosestSilhouette=function(e,t,r){if(v(e,t,r))return r;var n=m(e,t,u.sv3d.get());return o.vec3.add(r,t.origin,o.vec3.scale(u.sv3d.get(),t.direction,o.vec3.distance(t.origin,n)/o.vec3.length(t.direction))),r},t.closestPointOnSilhouette=m,t.closestPoint=function(e,t,r){return v(e,t,r)?r:(d.closestPoint(t,e.center,r),g(e,r,r))},t.projectPoint=g,t.distanceToSilhouette=function(e,t){var r=o.vec3.subtract(u.sv3d.get(),t,e.center),n=o.vec3.squaredLength(r),i=e.radius*e.radius;return Math.sqrt(Math.abs(n-i))},t.angleToSilhouette=y;var S=s.vec3f64.create();t.axisAt=b,t.altitudeAt=x,t.setAltitudeAt=function(e,t,r,n){var i=x(e,t),a=b(e,t,2,E),s=o.vec3.scale(E,a,r-i);return o.vec3.add(n,t,s),n};var w=new i.ObjectStack(function(){return{center:null,radius:0}}),C=d.create(),P=s.vec3f64.create(),E=s.vec3f64.create();Object.freeze(P)}.apply(null,n))||(e.exports=i)},"/f24":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("H1tY"),r("Rrc3"),r("Zp3t")],void 0===(i=function(e,t,r,n,i){return function(){function e(t,a,o,s){if(this._context=null,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachment=null,this._initialized=!1,this._context=t,this._desc={colorTarget:a.colorTarget,depthStencilTarget:a.depthStencilTarget,width:a.width,height:a.height,multisampled:a.multisampled},this._id=e._nextId++,r("esri-webgl-debug")&&t.instanceCounter.incrementCount(4),o){var l=void 0;o instanceof i?(this._colorAttachment=o,l=o.descriptor):(l=o,this._colorAttachment=new i(this._context,l)),this._desc.colorTarget,e._validateTextureDimensions(l,this._desc)}if(s instanceof n)2===a.depthStencilTarget?this._stencilAttachment=s:(1===a.depthStencilTarget||3===a.depthStencilTarget)&&(this._depthAttachment=s),e._validateBufferDimensions(s.descriptor,this._desc);else if(s){this._context.capabilities.depthTexture;var c=void 0;s instanceof i?(this._depthStencilTexture=s,c=this._depthStencilTexture.descriptor):(c=s,this._depthStencilTexture=new i(this._context,c)),e._validateTextureDimensions(c,this._desc)}}return e.create=function(t,r){return new e(t,r)},e.createWithAttachments=function(t,r,n,i){return new e(t,n,r,i)},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof i?this._colorAttachment:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorAttachment",{get:function(){return this._colorAttachment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthStencilAttachment",{get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(this._context){var e=this._context,t=e.getBoundFramebufferObject();this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._glName&&(e.gl.deleteFramebuffer(this._glName),this._glName=null),r("esri-webgl-debug")&&e.instanceCounter.decrementCount(4),e.bindFramebuffer(t),this._context=null}},e.prototype.attachColorTexture=function(t){if(t){var r=t.descriptor;if(e._validateTextureDimensions(r,this._desc),this._disposeColorAttachment(),this._initialized){this._context.bindFramebuffer(this);var n=this._context.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t.glName,0)}this._colorAttachment=t}},e.prototype.detachColorTexture=function(){var e=void 0;if(this._colorAttachment instanceof i){if(e=this._colorAttachment,this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;this._context.gl.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)}this._colorAttachment=null}return e},e.prototype.attachDepthStencilTexture=function(t){if(t){var r=t.descriptor;if(r.pixelFormat,r.dataType,this._context.capabilities.depthTexture,e._validateTextureDimensions(r,this._desc),4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);var n=this._context.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,t.glName,0)}this._depthStencilTexture=t}},e.prototype.detachDepthStencilTexture=function(){var e=this._depthStencilTexture;if(e&&this._initialized){this._context.bindFramebuffer(this);var t=this._context.gl;this._context.gl.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,null,0)}return this._depthStencilTexture=null,e},e.prototype.attachDepthStencilBuffer=function(t){if(t){var r=t.descriptor;if(34041!==r.internalFormat&&r.internalFormat,e._validateBufferDimensions(r,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===r.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);var n=this._context.gl,i=1===this._desc.depthStencilTarget?n.DEPTH_ATTACHMENT:n.DEPTH_STENCIL_ATTACHMENT;n.framebufferRenderbuffer(n.FRAMEBUFFER,i,n.RENDERBUFFER,t.glName)}this._depthAttachment=t}},e.prototype.detachDepthStencilBuffer=function(){var e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);var r=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,r,e.RENDERBUFFER,null)}return this._depthAttachment=null,t},e.prototype.copyToTexture=function(e,t,r,n,i,a,o){var s=this._desc,l=o.descriptor;o.descriptor.target,e+r>s.width||t+n>s.height||i+r>l.width||l.height;var c=this._context;c.bindTexture(o),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(3553,0,i,a,e,t,r,n)},e.prototype.readPixels=function(e,t,r,n,i,a,o){this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,n,i,a,o)},e.prototype.resize=function(t,r){var n=this._desc;if(n.width!==t||n.height!==r){if(!this._initialized){if(n.width=t,n.height=r,this._colorAttachment instanceof i)(a=this._colorAttachment).resize(t,r);return void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,r))}var a,o;if(n.width=t,n.height=r,this._colorAttachment instanceof i)(o=(a=this._colorAttachment).descriptor).width=t,o.height=r,this._colorAttachment.dispose(),this._colorAttachment=new i(this._context,o),e._validateTextureDimensions(a.descriptor,this._desc);else this._colorAttachment&&this._disposeColorAttachment();if(null!=this._depthStencilTexture)(o=this._depthStencilTexture.descriptor).width=t,o.height=r,this._depthStencilTexture.dispose(),this._depthStencilTexture=new i(this._context,o);else(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments();this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}},e.prototype.initialize=function(){if(this._initialized)return!1;var e=this._context.gl;this._glName&&e.deleteFramebuffer(this._glName);var t=e.createFramebuffer(),r=this._desc;if(e.bindFramebuffer(e.FRAMEBUFFER,t),!this._colorAttachment)if(0===r.colorTarget){var a={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:r.width,height:r.height};this._colorAttachment=new i(this._context,a)}else{var o=new n(this._context,{internalFormat:32854,width:r.width,height:r.height});e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,o.glName),this._colorAttachment=o}if(this._colorAttachment instanceof i){var s=this._colorAttachment;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s.glName,0)}switch(r.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new n(this._context,{internalFormat:1===r.depthStencilTarget?33189:34041,width:r.width,height:r.height}));var l=1===r.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new n(this._context,{internalFormat:36168,width:r.width,height:r.height})),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){this._context.capabilities.depthTexture;var c={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:r.width,height:r.height};this._depthStencilTexture=new i(this._context,c)}e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,this._depthStencilTexture.glName,0)}return e.checkFramebufferStatus(e.FRAMEBUFFER),e.FRAMEBUFFER_COMPLETE,this._glName=t,this._initialized=!0,!0},e.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof i){var e=this._colorAttachment;if(this._initialized)this._context.bindFramebuffer(this),(r=this._context.gl).framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0);e.dispose()}else if(this._colorAttachment instanceof WebGLRenderbuffer){var t=this._colorAttachment,r=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(t)}this._colorAttachment=null},e.prototype._disposeDepthStencilAttachments=function(){var e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);var t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)},e._validateBufferDimensions=function(e,t){void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&(t.height,e.height):(t.width=e.width,t.height=e.height)},e._validateTextureDimensions=function(e,t){e.target,void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&(t.height,e.height):(t.width=e.width,t.height=e.height)},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},"05NA":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){}return e.LAYER="layers",e.OBJECT="objects",e.GEOMETRY="geometries",e.MATERIAL="materials",e.TEXTURE="textures",e}()}.apply(null,n))||(e.exports=i)},"0NBi":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("ma1f"),r("eIBl"),r("qMld"),r("8MXS"),r("Vx27"),r("e4th")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u){return function(e){function t(){var t=e.call(this)||this;return t._handles=new o,t.connectionError=null,t.connectionStatus="disconnected",t.filter=null,t._handles.add(l.on(t,"controller","data-received",function(e){t.emit("data-received",e)})),t}return r(t,e),t.prototype.connect=function(){return this.controller.connection.connect()},t.prototype.disconnect=function(){this.controller.connection.disconnect()},t.prototype.updateFilter=function(e){return"connected"!==this.connectionStatus?s.reject(new a("stream-layer-view: updateFilter","Cannot update filter. The connection with the stream service is closed")):this.controller.updateFilter(e)},n([c.property({aliasOf:"controller.connection.connectionError",readOnly:!0})],t.prototype,"connectionError",void 0),n([c.property({aliasOf:"controller.connection.connectionStatus",readOnly:!0})],t.prototype,"connectionStatus",void 0),n([c.property()],t.prototype,"controller",void 0),n([c.property({type:u})],t.prototype,"filter",void 0),n([c.subclass("esri.views.layers.StreamLayerView")],t)}(c.declared(i))}.apply(null,n))||(e.exports=i)},"1+3M":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("QDcU"),r("jBNx"),r("1E+e"),r("FXVB"),r("1m5D"),r("Rdxj"),r("Vt+U"),r("WRgd"),r("VW5z"),r("9v8t"),r("s4LJ"),r("zF3d"),r("JzVu"),r("BwdQ"),r("hADE"),r("krVM"),r("ys4y"),r("AgDx"),r("ZJC8"),r("cjy9"),r("CIy2"),r("o5p5")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w,C){Object.defineProperty(t,"__esModule",{value:!0});var P=function(e){function t(t,r,n,i){var a=e.call(this,t,r,n,i)||this;return a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},a._prepareFillResources(),a._prepareOutlineResources(),a.resolve(),a}return r(t,e),t.prototype._prepareFillResources=function(){var e=this._getStageIdHint(),t=this._getMaterialOpacityAndColor(),r={color:t,transparent:t[3]<1||this._isPropertyDriven("opacity"),polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new C(r,e+"_colormat"),this._context.stage.add(y.ModelContentType.MATERIAL,this._material)},t.prototype._prepareOutlineResources=function(){var e=this.symbolLayer.outline;if(this._hasOutline=!!(e&&e.size&&e.size>0&&e.color),this._hasOutline){var t={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:i.pt2px(e.size),slicePlaneEnabled:this._context.slicePlaneEnabled};this._outlineMaterial=t.width>=1.5?g.createRibbonMaterial(t):g.createNativeMaterial(t),this._context.stage.add(y.ModelContentType.MATERIAL,this._outlineMaterial)}},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(y.ModelContentType.MATERIAL,this._material.id),this._material=null),this._outlineMaterial&&(this._context.stage.remove(y.ModelContentType.MATERIAL,this._outlineMaterial.id),this._outlineMaterial=null)},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic,r=t.geometry.type;if("polyline"!==r&&"polygon"!==r&&"extent"!==r)return this._logWarning("unsupported geometry type for fill symbol: "+r),null;if(!this._validateGeometry(t.geometry))return null;var n="graphic"+t.uid,i=this._getVertexOpacityAndColor(e.renderingInfo,Uint8Array,255),a=this.getGraphicElevationContext(t);return"on-the-ground"===a.mode?this._createAsOverlay(t,i,a,n):this._createAs3DShape(t,i,a,n,t.uid)},t.prototype.layerOpacityChanged=function(){var e=this._material.getColor(),t=this._getMaterialOpacity();if(this._material.setColor([e[0],e[1],e[2],t]),this._material.setTransparent(t<1||this._isPropertyDriven("opacity")),this._outlineMaterial){var r=this._outlineMaterial.getColor(),n={color:[r[0],r[1],r[2],this._getOutlineOpacity()]};this._outlineMaterial.setParameterValues(n)}return!0},t.prototype.layerElevationInfoChanged=function(e,t,r){var n=this._elevationContext.mode;if(null==r||null==n)return!1;if("on-the-ground"===r&&"on-the-ground"===n)return!0;if(r!==n&&("on-the-ground"===r||"on-the-ground"===n))return!1;var i=h.needsElevationUpdates2D(n);return this.updateGraphics3DGraphicElevationInfo(e,t,function(){return i})},t.prototype.slicePlaneEnabledChanged=function(e,t){if(this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),this._outlineMaterial){var r={slicePlaneEnabled:this._context.slicePlaneEnabled};this._outlineMaterial.setParameterValues(r)}return!0},t.prototype.pixelRatioChanged=function(e,t){return!0},t.prototype.setDrawOrder=function(e,t,r){this.updateSymbolLayerOrder(e,t),this._material&&(this._material.renderPriority=e+t/2,r.add(this._material.id)),this._outlineMaterial&&(this._outlineMaterial.renderPriority=e,r.add(this._outlineMaterial.id))},t.prototype._createAs3DShape=function(e,t,r,n,i){var a,o=this._getPolyGeometry(e),s=o.rings,l=this._getOutlineGeometry(o,s),c=h.getGeometryVertexData3D(l,o.hasZ,o.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,r);if(A.idHint=n,A.color=t,A.data=c,this._hasOutline&&(a=new(0,c.vertexData.constructor)(c.vertexData)),A.outNum=0,A.outGeometries=[],A.outTransforms=[],A.outMaterials=[],this._createAs3DShapeFill(A),A.data.vertexData=a,this._createAs3DShapeOutline(A),this._logGeometryCreationWarnings(A.data,s,"rings","FillSymbol3DLayer"),0===A.outNum)return null;var u=new _({geometries:A.outGeometries,materials:A.outMaterials,transformations:A.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:i},idHint:n}),f=d.perVertexElevationAligner,v=new p(this,u,A.outGeometries,null,null,f,r);return v.alignedTerrainElevation=c.terrainElevation,v.needsElevationUpdates=h.needsElevationUpdates2D(r.mode),v},t.prototype._createAs3DShapeFill=function(e){for(var t=e.data.geometryData.polygons,r=e.data.eleVertexData,n=e.data.vertexData,i=this,l=0;l<t.length;++l)!function(l){var c=t[l],u=c.count,d=c.index;if(i._context.clippingExtent&&(h.computeBoundingBox(r,d,u,E),h.boundingBoxClipped(E,i._context.clippingExtent)))return"continue";var f=new Float64Array(r.buffer,3*d*r.BYTES_PER_ELEMENT,3*u),p=new Float64Array(n.buffer,3*d*n.BYTES_PER_ELEMENT,3*u),v=c.holeIndices.map(function(e){return e-d}),m=a(f,v,3);if(0===m.length)return"continue";h.chooseOrigin(n,d,u,T),h.subtractCoordinates(n,d,u,T);var g=i._createFillGeometry(m,0,p,f,e.color),y=new b(g,e.idHint);y.singleUse=!0;var x=s.mat4f64.create();o.mat4.translate(x,x,T),e.outGeometries.push(y),e.outMaterials.push(i._material),e.outTransforms.push(x),e.outNum++}(l)},t.prototype._createAs3DShapeOutline=function(e){if(this._hasOutline)for(var t=e.data.geometryData.outlines,r=e.data.eleVertexData,n=e.data.vertexData,i=0;i<t.length;++i){var a=t[i],l=a.index,c=a.count;if(!this._context.clippingExtent||(h.computeBoundingBox(r,l,c,E),!h.boundingBoxClipped(E,this._context.clippingExtent))){h.chooseOrigin(n,l,c,T),h.subtractCoordinates(n,l,c,T);var u=new Float64Array(r.buffer,3*l*r.BYTES_PER_ELEMENT,3*c),d=new Float64Array(n.buffer,3*l*n.BYTES_PER_ELEMENT,3*c),f=g.createPolylineGeometry(d,u,!1,O,0),p=new b(f,e.idHint+"outline"+i);p.singleUse=!0;var v=s.mat4f64.create();o.mat4.translate(v,v,T),e.outGeometries.push(p),e.outMaterials.push(this._outlineMaterial),e.outTransforms.push(v),e.outNum++}}},t.prototype._createAsOverlay=function(e,t,r,n){var i=this._getPolyGeometry(e),a=i.rings,o=this._getOutlineGeometry(i,a);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2,this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);var s,l=h.getGeometryVertexDataDraped(o,i.spatialReference,this._context.overlaySR);return A.idHint=n,A.color=t,A.data=l,this._hasOutline&&(s=new(0,l.vertexData.constructor)(l.vertexData)),A.outNum=0,A.outGeometries=[],A.outBoundingBox=u.empty(),A.layerUid=this._context.layer.uid,A.graphicsUid=e.uid,this._createAsOverlayFill(A),A.data.vertexData=s,this._createAsOverlayOutline(A),this._logGeometryCreationWarnings(A.data,a,"rings","FillSymbol3DLayer"),A.outNum>0?new f(this,A.outGeometries,A.outBoundingBox):null},t.prototype._createAsOverlayFill=function(e){for(var t=e.data.vertexData,r=e.data.geometryData.polygons,n=this,i=0;i<r.length;++i)!function(i){var l=r[i],c=l.count,d=l.index,f=new Float64Array(t.buffer,3*d*t.BYTES_PER_ELEMENT,3*c),p=l.holeIndices.map(function(e){return e-d}),v=a(f,p,3);if(0===v.length)return"continue";if(h.computeBoundingBox(t,d,c,E),h.boundingBoxClipped(E,n._context.clippingExtent))return"continue";u.expand(e.outBoundingBox,E),h.chooseOrigin(t,d,c,T),h.subtractCoordinates(t,d,c,T),h.setZ(t,d,c,n._getDrapedZ());var m=s.mat4f64.create();o.mat4.translate(m,m,T);var g=n._createFillGeometry(v,d,t,null,e.color),y=new S(g);y.data.layerUid=e.layerUid,y.data.graphicUid=e.graphicsUid,y.material=n._material;var b=E;y.center=[.5*(b[0]+b[3]),.5*(b[1]+b[4]),0],y.bsRadius=.5*Math.sqrt((b[3]-b[0])*(b[3]-b[0])+(b[4]-b[1])*(b[4]-b[1])),y.transformation=m,y.name=e.idHint,y.uniqueName=e.idHint+"#"+g.id,e.outGeometries.push(y),e.outNum++}(i)},t.prototype._createAsOverlayOutline=function(e){if(this._hasOutline)for(var t=e.data.vertexData,r=e.data.geometryData.outlines,n=0;n<r.length;++n){var i=r[n],a=i.index,l=i.count;if(h.computeBoundingBox(t,a,l,E),!h.boundingBoxClipped(E,this._context.clippingExtent)){u.expand(e.outBoundingBox,E),h.chooseOrigin(t,a,l,T),h.subtractCoordinates(t,a,l,T),h.setZ(t,a,l,this._getDrapedZ());var c=new Float64Array(t.buffer,3*a*t.BYTES_PER_ELEMENT,3*l),d=s.mat4f64.create();o.mat4.translate(d,d,T);var f=g.createPolylineGeometry(c,null,!0,O,0),p=new S(f);p.data.layerUid=e.layerUid,p.data.graphicUid=e.graphicsUid,p.material=this._outlineMaterial;var v=E;p.center=[.5*(v[0]+v[3]),.5*(v[1]+v[4]),0],p.bsRadius=.5*Math.sqrt((v[3]-v[0])*(v[3]-v[0])+(v[4]-v[1])*(v[4]-v[1])),p.transformation=d,p.name=e.idHint+"outline",p.uniqueName=e.idHint+"outline#"+f.id,e.outGeometries.push(p),e.outNum++}}},t.prototype._getOutlineGeometry=function(e,t){return t},t.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbolLayer.outline.color.a},t.prototype._getOutlineColor=function(){var e=this.symbolLayer.outline.color,t=this._getOutlineOpacity();return m.mixinColorAndOpacity(n.toUnitRGB(e),t)},t.prototype._getPolyGeometry=function(e){var t=e.geometry;return"extent"===t.type?c.fromExtent(t):t},t.prototype._createFillGeometry=function(e,t,r,n,i){for(var a=e.length,o=new Uint32Array(a),s=new Uint32Array(a),l=0;l<a;l++)o[l]=e[l]+t,s[l]=0;var c={},u={};return c[w.VertexAttrConstants.POSITION]=o,c[w.VertexAttrConstants.COLOR]=s,u[w.VertexAttrConstants.POSITION]={size:3,data:r},u[w.VertexAttrConstants.COLOR]={size:4,data:i},n&&(u.mapPos={size:3,data:n},c.mapPos=o),new x(u,c)},t}(v.default);t.Graphics3DPolygonFillSymbolLayer=P;var E=u.create(),T=l.vec3f64.create(),O=new Float32Array([255,255,255,255]),A={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};t.default=P}.apply(null,n))||(e.exports=i)},"18xY":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("0LE5"),r("AzkI")],void 0===(i=function(e,t,r,n){function i(e,t){return r.vec3.dot(e,t)/r.vec3.length(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.projectPoint=function(e,t,n){var a=i(e,t);return r.vec3.scale(n,e,a)},t.projectPointSignedLength=i,t.angle=function(e,t){var i=r.vec3.dot(e,t)/(r.vec3.length(e)*r.vec3.length(t));return-n.acos(i)}}.apply(null,n))||(e.exports=i)},"1CCn":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zbgD")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.composite={name:"offscreen-composite",shaders:{vertexShader:n.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:n.resolveIncludes("renderer/offscreen/composite.frag")},attributes:r.Default3D},t.compositeTransparentToHUDVisibility={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:n.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:n.resolveIncludes("renderer/offscreen/compositeTransparentToHUDVisibility.frag")},attributes:r.Default3D},t.compositeOccluded={name:"offscreen-composite-occluded",shaders:{vertexShader:n.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:n.resolveIncludes("renderer/offscreen/compositeOccluded.frag")},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},"1E+e":function(e,t,r){var n;void 0===(n=function(){"use strict";function e(e,r,i){i=i||2;var a,o,s,c,u,d,f,p=r&&r.length,h=p?r[0]*i:e.length,v=t(e,0,h,i,!0),m=[];if(!v||v.next===v.prev)return m;if(p&&(v=l(e,r,v,i)),e.length>80*i){a=s=e[0],o=c=e[1];for(var g=i;g<h;g+=i)(u=e[g])<a&&(a=u),(d=e[g+1])<o&&(o=d),u>s&&(s=u),d>c&&(c=d);f=0!==(f=Math.max(s-a,c-o))?1/f:0}return n(v,m,i,a,o,f),m}function t(e,t,r,n,i){var a,o;if(i===O(e,t,r,n)>0)for(a=t;a<r;a+=n)o=P(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=P(a,e[a],e[a+1],o);return o&&b(o,o.next)&&(E(o),o=o.next),o}function r(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!b(n,n.next)&&0!==y(n.prev,n,n.next))n=n.next;else{if(E(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function n(e,t,l,c,u,d,p){if(e){!p&&d&&f(e,c,u,d);for(var h,v,m=e;e.prev!==e.next;)if(h=e.prev,v=e.next,d?a(e,c,u,d):i(e))t.push(h.i/l),t.push(e.i/l),t.push(v.i/l),E(e),e=v.next,m=v.next;else if((e=v)===m){p?1===p?n(e=o(e,t,l),t,l,c,u,d,2):2===p&&s(e,t,l,c,u,d):n(r(e),t,l,c,u,d,1);break}}}function i(e){var t=e.prev,r=e,n=e.next;if(y(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(m(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&y(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,r,n){var i=e.prev,a=e,o=e.next;if(y(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,c=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,d=h(s,l,t,r,n),f=h(c,u,t,r,n),p=e.prevZ,v=e.nextZ;p&&p.z>=d&&v&&v.z<=f;){if(p!==e.prev&&p!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,v!==e.prev&&v!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;v&&v.z<=f;){if(v!==e.prev&&v!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function o(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!b(i,a)&&x(i,n,n.next,a)&&S(i,a)&&S(a,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(a.i/r),E(n),E(n.next),n=e=a),n=n.next}while(n!==e);return n}function s(e,t,i,a,o,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&g(l,c)){var u=C(l,c);return l=r(l,l.next),u=r(u,u.next),n(l,t,i,a,o,s),void n(u,t,i,a,o,s)}c=c.next}l=l.next}while(l!==e)}function l(e,n,i,a){var o,s,l,d=[];for(o=0,s=n.length;o<s;o++)(l=t(e,n[o]*a,o<s-1?n[o+1]*a:e.length,a,!1))===l.next&&(l.steiner=!0),d.push(v(l));for(d.sort(c),o=0;o<d.length;o++)u(d[o],i),i=r(i,i.next);return i}function c(e,t){return e.x-t.x}function u(e,t){if(t=d(e,t)){var n=C(t,e);r(n,n.next)}}function d(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r.prev;var l,c=r,u=r.x,d=r.y,f=1/0;for(n=r.next;n!==c;)i>=n.x&&n.x>=u&&i!==n.x&&m(a<d?i:o,a,u,d,a<d?o:i,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(i-n.x))<f||l===f&&n.x>r.x)&&S(n,e)&&(r=n,f=l),n=n.next;return r}function f(e,t,r,n){var i=e;do{null===i.z&&(i.z=h(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,p(i)}function p(e){var t,r,n,i,a,o,s,l,c=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<c&&(s++,n=n.nextZ);t++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,c*=2}while(o>1);return e}function h(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e){var t=e,r=e;do{t.x<r.x&&(r=t),t=t.next}while(t!==e);return r}function m(e,t,r,n,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!_(e,t)&&S(e,t)&&S(t,e)&&w(e,t)}function y(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function b(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,r,n){return!!(b(e,t)&&b(r,n)||b(e,n)&&b(r,t))||y(e,t,r)>0!=y(e,t,n)>0&&y(r,n,e)>0!=y(r,n,t)>0}function _(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&x(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function S(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function w(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}function C(e,t){var r=new T(e.i,e.x,e.y),n=new T(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function P(e,t,r,n){var i=new T(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}return e.deviation=function(e,t,r,n){var i=t&&t.length,a=i?t[0]*r:e.length,o=Math.abs(O(e,0,a,r));if(i)for(var s=0,l=t.length;s<l;s++){var c=t[s]*r,u=s<l-1?t[s+1]*r:e.length;o-=Math.abs(O(e,c,u,r))}var d=0;for(s=0;s<n.length;s+=3){var f=n[s]*r,p=n[s+1]*r,h=n[s+2]*r;d+=Math.abs((e[f]-e[h])*(e[p+1]-e[f+1])-(e[f]-e[p])*(e[h+1]-e[f+1]))}return 0===o&&0===d?0:Math.abs((d-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)r.vertices.push(e[i][a][o]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r},e}.apply(null,[]))||(e.exports=n)},"1bVs":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KBgh"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("2fXB"),r("O7NG"),r("aWgr"),r("AzkI"),r("rjU6"),r("9pvv"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p){function h(e,t){if(t.isVisible){var r=f.empty(),n=t.getObjects();return t.getSpatialQueryAccelerator()?v(r,e,t.getSpatialQueryAccelerator()):m(r,e,n),r}}function v(e,t,r){var n=t.eye,i=t.viewForward,a=t.frustum,o=function(e){return!e.areAllComponentsHidden()},s=r.objectCount;if(s<S)f.set(M,t.near,Math.min(e.near,t.far)),r.forEachInDepthRange(n,i,"front-to-back",M,function(r,n){g(e,t,r),M.far=e.near,n.setRange(M)},a,o),f.set(M,Math.max(e.far,t.near),t.far),r.forEachInDepthRange(n,i,"back-to-front",M,function(r,n){g(e,t,r),M.near=e.far,n.setRange(M)},a,o);else{var l=Math.max(Math.min(s,w),Math.ceil(s*C)),c=r.findClosest(i,"front-to-back",a,o,l),u=r.findClosest(i,"back-to-front",a,o,l);c&&u&&(b(e,t,c.getCenter(),c.getBSRadius()),b(e,t,u.getCenter(),u.getBSRadius()))}}function m(e,t,r){I.clear(),r.forEach(function(e){e.areAllComponentsHidden()||I.add(e)}),I.empty||(I.sort(t),f.set(M,t.near,Math.min(e.near,t.far)),I.forEachInDepthRange(M,"front-to-back",function(r,n,i){n<e.near&&g(e,t,r)}),f.set(M,Math.max(e.far,t.near),t.far),I.forEachInDepthRange(M,"back-to-front",function(t,r,n){e.far=Math.max(e.far,n)}))}function g(e,t,r){if(!r.areAllComponentsHidden()&&c.frustum.intersectsSphere(t.frustum.planes,c.sphere.wrap(r.getBSRadius(),r.getCenter()))){var i=r.objectTransformation,a=R;r.geometryRecords.forEach(function(r){n.mat4.multiply(a,i,r.getShaderTransformation());var o=u.maxScale(a);y(e,t,r.geometry.boundingInfo,a,o)})}}function y(e,t,r,n,i){var o=t.eye,s=t.viewForward;a.vec3.transformMat4(A,r.center,n);var l=s[0]*(A[0]-o[0])+s[1]*(A[1]-o[1])+s[2]*(A[2]-o[2]),u=r.bsRadius*i;if(!(l-u>e.near&&l+u<e.far)&&c.frustum.intersectsSphere(t.frustum.planes,c.sphere.wrap(u,A)))if(r.bsRadius>_&&r.getChildren())for(var d=r.getChildren(),f=0;f<8;++f)d[f]&&y(e,t,d[f],n,i);else V.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,n,r.bbMin,r.bbMax)}function b(e,t,r,n){var i=t.eye,a=t.viewForward,o=(r[0]-i[0])*a[0]+(r[1]-i[1])*a[1]+(r[2]-i[2])*a[2];e.near=Math.min(e.near,o-n),e.far=Math.max(e.far,o+n)}Object.defineProperty(t,"__esModule",{value:!0});var x=1e4,_=100,S=500,w=500,C=.1;t.depthRangeFromScene=function(e,t,r){if(t.size<x)return D.compute(e,t);var n=f.empty();for(var i in r){var a=r[i];a.isVisible&&f.union(n,h(e,a))}return n},t.depthRangeFromLayer=h;var P=function(){function e(){this._items=new r({allocator:function(e){return e||{obj:null,distance:0,near:0,far:0}},deallocator:function(e){return e.obj=null,e.distance=0,e.near=0,e.far=0,e}})}return Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items.clear()},e.prototype.add=function(e){this._items.pushNew().obj=e},e.prototype.sort=function(e){var t=e.eye,r=e.viewForward;this._items.forEach(function(e){var n=e.obj,i=n.getCenter(),a=n.getBSRadius(),o=(i[0]-t[0])*r[0]+(i[1]-t[1])*r[1]+(i[2]-t[2])*r[2];e.distance=o,e.near=o-a,e.far=o+a}),this._items.sort(function(e,t){return e.distance-t.distance})},e.prototype.forEachInDepthRange=function(e,t,r){if("front-to-back"===t)for(var n=0;n<this._items.length;++n){(i=this._items.data[n]).far<e.near||i.near>e.far||r(i.obj,i.near,i.far)}else for(n=this._items.length-1;n>=0;--n){var i;(i=this._items.data[n]).far<e.near||i.near>e.far||r(i.obj,i.near,i.far)}},e}(),E=function(){function e(){this.view=i.mat4f64.create(),this.viewProj=i.mat4f64.create(),this.frustum=c.frustum.create(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}return e.prototype.compute=function(e,t){var r=this;this.reset(),n.mat4.copy(this.view,e.viewMatrix),n.mat4.multiply(this.viewProj,e.projectionMatrix,this.view),c.frustum.copy(e.frustum,this.frustum);var i=this.view,a=i[2],o=i[6],s=i[10],l=i[14],u=this.range,f=0;if(t.forEach(function(e){var t=e.instanceParameters.componentVisibilities,n=e.componentOffsets;if(!d.isAllHidden(t,n)&&e.castShadow){var i,c;e.hasShaderTransformation?(i=e.getBoundingSphere(e.getShaderTransformation(),1,A),c=A):(i=e.bsRadius,c=e.center);var u=a*c[0]+o*c[1]+s*c[2]+l,p=u-i,h=u+i;r.geometries[f]=e,r.near[f]=-h,r.far[f]=-p,++f}}),0===this.geometries.length)return u;for(var p=0;p<this.geometries.length;++p)this.near[p]>u.far&&(u.far=this.near[p]),this.near[p]>2&&this.far[p]<u.near&&(u.near=this.far[p]);var h=this.looseRange;h.near=Math.max(.5*u.near,2),h.far=2*u.far;var v=0,m=0;for(p=0;p<this.geometries.length;++p)this.near[p]<u.near&&(this.near[p]>=h.near?u.near=this.near[p]:this.nearCandidates[v++]=p),this.far[p]>u.far&&(this.far[p]<=h.far?u.far=this.far[p]:this.farCandidates[m++]=p);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return u;this.nearCandidates.sort(function(e,t){return r.near[e]<r.near[t]?-1:r.near[e]>r.near[t]?1:0}),this.farCandidates.sort(function(e,t){return r.far[e]<r.far[t]?1:r.far[e]>r.far[t]?-1:0});for(p=0;p<this.nearCandidates.length;++p){var g=this.nearCandidates[p];if(this.near[g]<u.near){var y=(b=this.geometries[g]).boundingInfo;this.includeNearBoundingInfoRec(y,b.getShaderTransformation())}}for(p=0;p<this.farCandidates.length;++p){g=this.farCandidates[p];if(this.far[g]>u.far){var b;y=(b=this.geometries[g]).boundingInfo;this.includeFarBoundingInfoRec(y,b.getShaderTransformation())}}return u},e.prototype.reset=function(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE},e.prototype.includeNearBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();a.vec3.transformMat4(A,n,t);var i=u.maxScale(t),o=A[0],s=A[1],l=A[2];r*=i;var c=this.frustum.planes;if(!(c[0][0]*o+c[0][1]*s+c[0][2]*l+c[0][3]>r||c[1][0]*o+c[1][1]*s+c[1][2]*l+c[1][3]>r||c[2][0]*o+c[2][1]*s+c[2][2]*l+c[2][3]>r||c[3][0]*o+c[3][1]*s+c[3][2]*l+c[3][3]>r)){var d=this.view[2]*o+this.view[6]*s+this.view[10]*l+this.view[14],f=d+r;if(!(-(d-r)<2||-f>=this.range.near)){if(-f>this.looseRange.near)return void(this.range.near=-f);if(r>_){var p=e.getChildren();if(void 0!==p){for(var h=0;h<8;++h)void 0!==p[h]&&this.includeNearBoundingInfoRec(p[h],t);return}}V.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e.prototype.includeFarBoundingInfoRec=function(e,t){var r=e.getBSRadius(),n=e.getCenter();a.vec3.transformMat4(A,n,t);var i=u.maxScale(t),o=A[0],s=A[1],l=A[2];r*=i;var c=this.frustum.planes;if(!(c[0][0]*o+c[0][1]*s+c[0][2]*l+c[0][3]>r||c[1][0]*o+c[1][1]*s+c[1][2]*l+c[1][3]>r||c[2][0]*o+c[2][1]*s+c[2][2]*l+c[2][3]>r||c[3][0]*o+c[3][1]*s+c[3][2]*l+c[3][3]>r)){var d=this.view[2]*o+this.view[6]*s+this.view[10]*l+this.view[14]-r;if(!(-d<=this.range.far)){if(-d<this.looseRange.far)return void(this.range.far=-d);if(r>_){var f=e.getChildren();if(void 0!==f){for(var p=0;p<8;++p)void 0!==f[p]&&this.includeFarBoundingInfoRec(f[p],t);return}}V.unionDepthRangeWithAABB(this.range,this.viewProj,t,e.getBBMin(),e.getBBMax())}}},e}();t.DepthRangeFromRenderGeometries=E;var T=function(){function e(){this.modelViewProj=i.mat4f64.create(),this.clipPosition=[l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create(),l.vec4f64.create()]}return e.prototype.unionDepthRangeWithAABB=function(e,t,r,i,a){var o=this.modelViewProj;n.mat4.multiply(o,t,r);for(var s=!1,l=0;l<8;++l){var c=this.clipPosition[l],u=0===l||3===l||4===l||7===l?i[0]:a[0],d=0===l||1===l||4===l||5===l?i[1]:a[1],f=l<4?i[2]:a[2];c[0]=o[0]*u+o[4]*d+o[8]*f+o[12],c[1]=o[1]*u+o[5]*d+o[9]*f+o[13],c[2]=o[2]*u+o[6]*d+o[10]*f+o[14],c[3]=o[3]*u+o[7]*d+o[11]*f+o[15]}for(l=0;l<12;++l){for(var p=this.clipPosition[O[l][0]],h=this.clipPosition[O[l][1]],v=this.clipPosition[O[l][2]],m=this.clipTriangle(p,h,v),g=!0,y=0;y<m.length;++y){if((b=m[y][3])>=2){g=!1;break}}if(!g){s=!0;for(y=0;y<m.length;++y){var b;(b=m[y][3])<e.near&&(e.near=b),b>e.far&&(e.far=b)}}}return s},e.prototype.inside=function(e,t){return 0===t?e[0]>=-e[3]:1===t?e[1]>=-e[3]:2===t?e[0]<=e[3]:3===t?e[1]<=e[3]:void p.assert(!1)},e.prototype.intersect=function(e,t,r){var n=0;return 0===r?n=(-e[3]-e[0])/(t[0]-e[0]+t[3]-e[3]):1===r?n=(-e[3]-e[1])/(t[1]-e[1]+t[3]-e[3]):2===r?n=(e[3]-e[0])/(t[0]-e[0]-t[3]+e[3]):3===r&&(n=(e[3]-e[1])/(t[1]-e[1]-t[3]+e[3])),s.vec4.lerp(l.vec4f64.create(),e,t,n)},e.prototype.clipTriangle=function(e,t,r){for(var n=[e,t,r],i=0;i<4;++i){var a=n;n=[];for(var o=0;o<a.length;++o){var s=a[o],l=a[(o+1)%a.length];this.inside(l,i)?(this.inside(s,i)||n.push(this.intersect(s,l,i)),n.push(l)):this.inside(s,i)&&n.push(this.intersect(s,l,i))}}return n},e}(),O=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],A=o.vec3f64.create(),R=i.mat4f64.create(),M=f.empty(),I=new P,D=new E,V=new T}.apply(null,n))||(e.exports=i)},"1eyA":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ll/V"),r("xdHJ"),r("UWzz"),r("vjUK"),r("l8NS"),r("fsiH")],void 0===(i=function(e,t,r,n,i,a,o,s){function l(e){return e&&"object"==typeof e.attributes}function c(e){return i(e,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate()}function u(e){return i(e,["YYYY-M-D"]).toDate()}function d(e){return!0===e}function f(e){return Array.isArray(e)?e:[e]}function p(e){return null!==e?!0!==e:null}function h(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function v(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function m(e,t){if(null==e)return null;for(var r=!1,n=0,i=t;n<i.length;n++){var a=i[n];if(null==a)r=null;else if(e===a){r=!0;break}}return r}function g(e,t,r){if(null==e)return null;for(var n=t,i=r,a="",o="-[]/{}()*+?.\\^$|",s=0,l=0;l<n.length;l++){var c=n.charAt(l);switch(s){case 0:c===i?s=1:o.indexOf(c)>=0?a+="\\"+c:a+="%"===c?".*":"_"===c?".":c;break;case 1:o.indexOf(c)>=0?a+="\\"+c:a+=c,s=0}}return new RegExp("^"+a+"$").test(e)}function y(e){return e instanceof Date?e.valueOf():e}function b(e,t,r){if(null==t||null==r)return null;var n=y(t),i=y(r);switch(e){case"<>":return n!==i;case"=":return n===i;case">":return n>i;case"<":return n<i;case">=":return n>=i;case"<=":return n<=i}}function x(e){for(var t=[],r={},n=0,i=e;n<i.length;n++){var a=i[n],o=a.toLowerCase();void 0===r[o]&&(t.push(a),r[o]=1)}return t}return function(){function e(){this.parseTree=null,this.parameters=null,this._hasStandardizedFunctions=null,this._hasAggregateFunctions=null}return e.create=function(t){var r=new e;r.parseTree=s.WhereGrammar.parse(t);var n=!0,i=!0;return r.visitAll(r.parseTree,function(e){if("function"===e.type){var t=e.name,r=e.args.value.length;n&&(n=o.isStandardized(t,r)),i&&(i=a.isAggregate(t,r))}}),r._hasStandardizedFunctions=n,r._hasAggregateFunctions=i,r},e.prototype.isStandardized=function(){return this._hasStandardizedFunctions},e.prototype.isAggregate=function(){return this._hasAggregateFunctions},e.prototype.setVariablesDictionary=function(e){this.parameters=e},e.prototype.testFeature=function(e){return!!this.evaluateNode(this.parseTree,e)},e.prototype.testSet=function(e){var t=this,r=new n.default;this.visitAll(this.parseTree,function(e){"column_ref"!==e.type||r.has(e.column)||r.set(e.column,e)});for(var i={},a=0,o=e;a<o.length;a++){!function(e){r.forEach(function(r,n){var a=t.featureValue(e,n,r);i[n]?i[n].push(a):i[n]=[a]})}(o[a])}return!!this.evaluateNode(this.parseTree,{attributes:i})},e.prototype.calculateValue=function(e){return this.evaluateNode(this.parseTree,e)},e.prototype.getFunctions=function(){var e=[];return this.visitAll(this.parseTree,function(t){"function"===t.type&&e.push(t.name.toLowerCase())}),x(e)},e.prototype.getExpressions=function(){var e=new n.default;return this.visitAll(this.parseTree,function(t){if("function"===t.type){var r=t.name.toLowerCase(),n=t.args.value[0];if("column_ref"===n.type){var i=n.column,a=r+"-"+i;e.has(a)||e.set(a,{aggregateType:r,field:i})}}}),r.from(e.values())},e.prototype.getFields=function(){var e=[];return this.visitAll(this.parseTree,function(t){"column_ref"===t.type&&e.push(t.column)}),x(e)},e.prototype.getVariables=function(){var e=[];return this.visitAll(this.parseTree,function(t){"param"===t.type&&e.push(t.value.toLowerCase())}),x(e)},e.prototype.featureValue=function(e,t,r){var n=l(e)?e.attributes:e,i=n[t];if(void 0!==i)return i;for(var a in n)if(t.toLowerCase()===a.toLowerCase())return r.column=a,n[a];return null},e.prototype.visitAll=function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(var r=0,n=e.clauses;r<n.length;r++){var i=n[r];this.visitAll(i,t)}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(var a=0,o=e.value;a<o.length;a++){i=o[a];this.visitAll(i,t)}break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}},e.prototype.evaluateNode=function(e,t){switch(e.type){case"case_expression":if("simple"===e.format){for(var r=y(this.evaluateNode(e.operand,t)),n=0;n<e.clauses.length;n++)if(r===y(this.evaluateNode(e.clauses[n].operand,t)))return this.evaluateNode(e.clauses[n].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}else{for(n=0;n<e.clauses.length;n++)if(d(this.evaluateNode(e.clauses[n].operand,t)))return this.evaluateNode(e.clauses[n].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":for(var i=[],s=0,l=e.value;s<l.length;s++){var x=l[s];i.push(this.evaluateNode(x,t))}return i;case"unary_expr":return p(this.evaluateNode(e.expr,t));case"binary_expr":switch(e.operator){case"AND":return h(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"OR":return v(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t);case"IN":var _=f(this.evaluateNode(e.right,t));return m(this.evaluateNode(e.left,t),_);case"NOT IN":_=f(this.evaluateNode(e.right,t));return p(m(this.evaluateNode(e.left,t),_));case"BETWEEN":var S=this.evaluateNode(e.left,t),w=this.evaluateNode(e.right,t);return null==S||null==w[0]||null==w[1]?null:S>=w[0]&&S<=w[1];case"NOTBETWEEN":S=this.evaluateNode(e.left,t),w=this.evaluateNode(e.right,t);return null==S||null==w[0]||null==w[1]?null:S<w[0]||S>w[1];case"LIKE":return g(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape);case"NOT LIKE":return p(g(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return b(e.operator,this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"*":return this.evaluateNode(e.left,t)*this.evaluateNode(e.right,t);case"-":return this.evaluateNode(e.left,t)-this.evaluateNode(e.right,t);case"+":return this.evaluateNode(e.left,t)+this.evaluateNode(e.right,t);case"/":return this.evaluateNode(e.left,t)/this.evaluateNode(e.right,t)}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return e.value;case"date":return u(e.value);case"timestamp":return c(e.value);case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?((x=new Date).setHours(0,0,0,0),x):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?new Date:this.featureValue(t,e.column,e);case"function":var C=this.evaluateNode(e.args,t);return this.isAggregate()?a.aggregateFunction(e.name,C):o.evaluateFunction(e.name,C)}throw new Error("Unsupported sql syntax "+e.type)},e}()}.apply(null,n))||(e.exports=i)},"1f+t":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t,r){for(var n=0;n<r;++n)t[2*n]=e[n],t[2*n+1]=e[n]-t[2*n]}Object.defineProperty(t,"__esModule",{value:!0}),t.encodeDouble=function(e,t){i[0]=e,i[1]=e-i[0],t[0]=i[0],t[1]=i[1]},t.encodeDoubleArray=r,t.decodeDoubleArray=function(e,t,r){for(var n=0;n<r;++n)t[n]=e[2*n]+e[2*n+1]},t.encodeDoubleArraySplit=function(e,t,a,o){for(var s=0;s<o;++s)n[0]=e[s],r(n,i,1),t[s]=i[0],a[s]=i[1]};var n=new Float64Array(1),i=new Float32Array(2)}.apply(null,n))||(e.exports=i)},"1m5D":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("CIzB")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat4f64=r}.apply(null,n))||(e.exports=i)},"23eD":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r=function(){function e(e,t){void 0===t&&(t=.9),this._alpha=.9,this._name=e,this._alpha=t,this.reset()}return e.prototype.reset=function(){this._count=0,this._sum=0,this._smooth=0,this._min=1/0,this._max=0},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._count>0?this._sum/this._count:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0}),e.prototype.begin=function(){this._startTime=performance.now()},e.prototype.end=function(){var e=performance.now()-this._startTime;this._count+=1,this._sum+=e,this._smooth=this._alpha*e+(1-this._alpha)*this._smooth,this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)},e.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}},e}();return function(e){function t(t){return t in i||(i[t]=new e(t)),i[t]}function r(e){}var n=1e3,i={},a={};e.get=t,e.begin=function(e){t(e).begin()},e.end=function(e,r){void 0===r&&(r=!0),t(e).end();var i=performance.now();!r||e in a&&!(i>=a[e]+n)||(a[e]=i)},e.log=r,e.logAll=function(){for(var e in i);}}(r||(r={})),r}.apply(null,n))||(e.exports=i)},"2A3h":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("CIy2"),r("U+8K")],void 0===(i=function(e,t,r,n){return function(){function e(e,t){void 0===t&&(t=""),this._rctx=e,this._shaderPrefix=t,this._programCacheByTemplate=new Map,this._programRefCount=[],this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}return e.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(e){e.programs.forEach(function(e){e.dispose()})}),this._programCacheByTemplate=null,this._programRefCount=null,this._commonUniforms=null,this._rctx=null},e.prototype.getProgram=function(e,t){var r=this;return this._programCacheByTemplate.has(e)||this.addProgramTemplate(e,function(t){return n.createProgram(r._rctx,e,t,r._shaderPrefix)}),this.getProgramTemplateInstance(e,t)},e.prototype.addProgramTemplate=function(e,t){this._programCacheByTemplate.set(e,{constructor:t,programs:new Map})},e.prototype.getProgramTemplateInstance=function(e,t){var r=this._programCacheByTemplate.get(e);if(r){var n=t?JSON.stringify(t):"default";if(!r.programs.has(n)){var i=r.constructor(t);r.programs.set(n,i)}return r.programs.get(n)}return null},e.prototype.getProgramsUsingUniform=function(e){return this._commonUniforms[e]||[]},e.prototype.increaseRefCount=function(e){var t=e.id;this._programRefCount[t]?this._programRefCount[t]++:(this._programRefCount[t]=1,this._findCommonUniforms(e))},e.prototype.decreaseRefCount=function(e){var t=e.id;this._programRefCount[t]>1?this._programRefCount[t]--:(this._forgetCommonUniforms(e),this._programRefCount[t]=0)},e.prototype._findCommonUniforms=function(e){for(var t in this._commonUniforms)e.hasUniform(t)&&(r.assert(-1===this._commonUniforms[t].indexOf(e),"common uniforms of program have already been determined"),this._commonUniforms[t].push(e))},e.prototype._forgetCommonUniforms=function(e){for(var t in this._commonUniforms){var r=this._commonUniforms[t],n=r.indexOf(e);n>-1&&(r[n]=r[r.length-1],r.pop())}},e}()}.apply(null,n))||(e.exports=i)},"2B1V":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("VfPl"),r("GntT")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(var r=0,n=e.fieldNames;r<n.length;r++){var i=n[r],a=e.fields.get(i);this[i]=new a.constructor(this.buffer,a.offset,this.stride)}}return Object.defineProperty(e.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"byteLength",{get:function(){return this.buffer.byteLength},enumerable:!0,configurable:!0}),e.prototype.getField=function(e,t){var r=this[e];return r&&r.elementCount===t.ElementCount&&r.elementType===t.ElementType?r:null},e.prototype.slice=function(t,r){return new e(this.layout,this.buffer.slice(t*this.stride,r*this.stride))},e.prototype.copyFrom=function(e,t,r,n){var i=this.stride;if(i%4==0){var a=new Uint32Array(e.buffer,t*i,n*i/4);new Uint32Array(this.buffer,r*i,n*i/4).set(a)}else{a=new Uint8Array(e.buffer,t*i,n*i);new Uint8Array(this.buffer,r*i,n*i).set(a)}},e}();t.InterleavedBuffer=i;var a=function(){function e(){this.stride=0,this.fields=new Map,this.fieldNames=[]}return e.prototype.vec2f=function(e,t){return this.appendField(e,r.BufferViewVec2f,t),this},e.prototype.vec2f64=function(e,t){return this.appendField(e,r.BufferViewVec2f64,t),this},e.prototype.vec3f=function(e,t){return this.appendField(e,r.BufferViewVec3f,t),this},e.prototype.vec3f64=function(e,t){return this.appendField(e,r.BufferViewVec3f64,t),this},e.prototype.vec4f=function(e,t){return this.appendField(e,r.BufferViewVec4f,t),this},e.prototype.vec4f64=function(e,t){return this.appendField(e,r.BufferViewVec4f64,t),this},e.prototype.mat3f=function(e,t){return this.appendField(e,r.BufferViewMat3f,t),this},e.prototype.mat3f64=function(e,t){return this.appendField(e,r.BufferViewMat3f64,t),this},e.prototype.mat4f=function(e,t){return this.appendField(e,r.BufferViewMat4f,t),this},e.prototype.mat4f64=function(e,t){return this.appendField(e,r.BufferViewMat4f64,t),this},e.prototype.vec4u8=function(e,t){return this.appendField(e,r.BufferViewVec4u8,t),this},e.prototype.f32=function(e,t){return this.appendField(e,r.BufferViewFloat,t),this},e.prototype.f64=function(e,t){return this.appendField(e,r.BufferViewFloat64,t),this},e.prototype.u8=function(e,t){return this.appendField(e,r.BufferViewUint8,t),this},e.prototype.u16=function(e,t){return this.appendField(e,r.BufferViewUint16,t),this},e.prototype.i8=function(e,t){return this.appendField(e,r.BufferViewInt8,t),this},e.prototype.vec2i8=function(e,t){return this.appendField(e,r.BufferViewVec2i8,t),this},e.prototype.vec2i16=function(e,t){return this.appendField(e,r.BufferViewVec2i16,t),this},e.prototype.vec2u8=function(e,t){return this.appendField(e,r.BufferViewVec2u8,t),this},e.prototype.vec4u16=function(e,t){return this.appendField(e,r.BufferViewVec4u16,t),this},e.prototype.u32=function(e,t){return this.appendField(e,r.BufferViewUint32,t),this},e.prototype.appendField=function(e,t,r){var i=t.ElementCount*n.elementTypeSize(t.ElementType),a=this.stride;this.fields.set(e,{size:i,constructor:t,offset:a,optional:r}),this.stride+=i,this.fieldNames.push(e)},e.prototype.alignTo=function(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this},e.prototype.hasField=function(e){return this.fieldNames.indexOf(e)>=0},e.prototype.createBuffer=function(e){return new i(this,e)},e.prototype.createView=function(e){return new i(this,e)},e.prototype.clone=function(){var t=new e;return t.stride=this.stride,t.fields=new Map,this.fields.forEach(function(e,r){return t.fields.set(r,e)}),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t},e}();t.InterleavedLayout=a,t.newLayout=function(){return new a}}.apply(null,n))||(e.exports=i)},"2CPm":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("aWgr")],void 0===(i=function(e,t,r){var n=r.boundedPlane.create();return function(){function e(){this._worldPlane=n}return Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this.plane!==n},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"plane",{get:function(){return this._worldPlane},set:function(e){this._worldPlane=e||n},enumerable:!0,configurable:!0}),e}()}.apply(null,n))||(e.exports=i)},"2Mej":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("0LE5"),r("Rdxj"),r("AzkI"),r("KPBO"),r("qUb7")],void 0===(i=function(e,t,r,n,i,a,o){function s(e){return(e+1)*(e+1)}function l(e){return i.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function c(e,t,r){var n=e[0],i=e[1],a=e[2],o=r||[];return o.length=s(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*n,o[2]=.4886025119*a,o[3]=.4886025119*i),t>=2&&(o[4]=1.09254843059*n*i,o[5]=1.09254843059*i*a,o[6]=.31539156525*(3*a*a-1),o[7]=1.09254843059*n*a,o[8]=.54627421529*(n*n-i*i)),o}function u(e,t){var r=s(e),n=t||{r:[],g:[],b:[]};n.r.length=n.g.length=n.b.length=r;for(var i=0;i<r;i++)n.r[i]=n.g[i]=n.b[i]=0;return n}function d(e,t){for(var n=l(t.r.length),i=0,o=e;i<o.length;i++){var s=o[i];r.vec3.negate(y,s.direction),c(y,n,m),a.elementwiseProduct(m,b),a.scalarProduct(m,s.intensity[0],g),a.add(t.r,g),a.scalarProduct(m,s.intensity[1],g),a.add(t.g,g),a.scalarProduct(m,s.intensity[2],g),a.add(t.b,g)}return t}function f(e,t){c(y,0,m);for(var r=0,n=e;r<n.length;r++){var i=n[r];t.r[0]+=m[0]*b[0]*i.intensity[0]*4*Math.PI,t.g[0]+=m[0]*b[0]*i.intensity[1]*4*Math.PI,t.b[0]+=m[0]*b[0]*i.intensity[2]*4*Math.PI}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.numberOfCoefficients=s,t.numberOfCoefficientsInBand=function(e){return 2*e+1},t.orderFromNumberOfCoefficients=l,t.computeCoefficients=c,t.initSHCoefficients=u,t.projectFillLights=d,t.projectAmbientLights=f,t.combineLights=function(e,t,n,i){u(t,i.sh),r.vec3.set(n.intensity,0,0,0);var s=!1,l=p,c=h,m=v;l.length=0,c.length=0,m.length=0;for(var g=0,y=e;g<y.length;g++)(_=y[g])instanceof o.MainLight&&!s?(r.vec3.copy(n.direction,_.direction),n.intensity[0]=_.intensity[0],n.intensity[1]=_.intensity[1],n.intensity[2]=_.intensity[2],n.castShadows=_.castShadows,s=!0):_ instanceof o.MainLight||_ instanceof o.FillLight?l.push(_):_ instanceof o.AmbientLight?c.push(_):_ instanceof o.SphericalHarmonicsLight&&m.push(_);d(l,i.sh),f(c,i.sh);for(var b=0,x=m;b<x.length;b++){var _=x[b];a.add(i.sh.r,_.sh.r),a.add(i.sh.g,_.sh.g),a.add(i.sh.b,_.sh.b)}};var p=[],h=[],v=[],m=[0],g=[0],y=n.vec3f64.create(),b=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]}.apply(null,n))||(e.exports=i)},"2TjI":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("YX1r"),r("51bw"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("sIhy"),r("AzkI"),r("VfPl"),r("2B1V"),r("Kfys")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p){function h(e){var t=f.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");return e.indexOf("color")>=0&&(t=t.vec4f("color")),e.indexOf("featureAttribute")>=0&&(t=t.vec4f("featureAttribute")),t.u8("state").u8("lodLevel").alignTo(8)}Object.defineProperty(t,"__esModule",{value:!0});var v,m=p.assert;!function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.ACTIVE=2]="ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"}(v=t.StateFlags||(t.StateFlags={}));var g=function(e){this.localTransform=e.getField("localTransform",d.BufferViewMat4f64),this.globalTransform=e.getField("globalTransform",d.BufferViewMat4f64),this.modelOrigin=e.getField("modelOrigin",d.BufferViewVec3f64),this.model=e.getField("model",d.BufferViewMat3f),this.modelNormal=e.getField("modelNormal",d.BufferViewMat3f),this.modelScaleFactors=e.getField("modelScaleFactors",d.BufferViewVec2f),this.boundingSphere=e.getField("boundingSphere",d.BufferViewVec4f64),this.color=e.getField("color",d.BufferViewVec4f),this.featureAttribute=e.getField("featureAttribute",d.BufferViewVec4f),this.state=e.getField("state",d.BufferViewUint8),this.lodLevel=e.getField("lodLevel",d.BufferViewUint8)};t.View=g;var y=function(e){function t(t,r){var n=e.call(this)||this;return n._capacity=0,n._size=0,n._next=0,n._layout=h(t),n._shaderTransformation=r,n}return r(t,e),Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),t.prototype.addInstance=function(){this._size+1>this._capacity&&this.grow();var e=this.findSlot();return this._view.state.set(e,v.ALLOCATED),this._size++,this.emit("instance-added",{index:e}),e},t.prototype.removeInstance=function(e){var t=this._view.state;m(e>=0&&e<this._capacity&&t.get(e)&v.ALLOCATED,"invalid instance handle"),this.getStateFlag(e,v.ACTIVE)?this.setStateFlags(e,v.REMOVE):this.freeInstance(e),this.emit("instance-removed",{index:e})},t.prototype.freeInstance=function(e){var t=this._view.state;m(e>=0&&e<this._capacity&&t.get(e)&v.ALLOCATED,"invalid instance handle"),t.set(e,0),this._size--},t.prototype.setLocalTransform=function(e,t,r){void 0===r&&(r=!0),this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)},t.prototype.getLocalTransform=function(e,t){this._view.localTransform.getMat(e,t)},t.prototype.setGlobalTransform=function(e,t,r){void 0===r&&(r=!0),this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)},t.prototype.getGlobalTransform=function(e,t){this._view.globalTransform.getMat(e,t)},t.prototype.updateModelTransform=function(e){var t=this._view,r=_,i=S;t.localTransform.getMat(e,w),t.globalTransform.getMat(e,C);var o=a.mat4.multiply(C,C,w);s.vec3.set(r,o[12],o[13],o[14]),t.modelOrigin.setVec(e,r),n.mat3.fromMat4(i,o),t.model.setMat(e,i);var l=u.scaleFromMatrix(_,o);l.sort(),t.modelScaleFactors.set(e,0,l[1]),t.modelScaleFactors.set(e,1,l[2]),n.mat3.invert(i,i),n.mat3.transpose(i,i),t.modelNormal.setMat(e,i),this.setStateFlags(e,v.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:e})},t.prototype.getModelTransform=function(e,t){var r=this._view;r.model.getMat(e,S),r.modelOrigin.getVec(e,_),t[0]=S[0],t[1]=S[1],t[2]=S[2],t[3]=0,t[4]=S[3],t[5]=S[4],t[6]=S[5],t[7]=0,t[8]=S[6],t[9]=S[7],t[10]=S[8],t[11]=0,t[12]=_[0],t[13]=_[1],t[14]=_[2],t[15]=1},t.prototype.applyShaderTransformation=function(e,t){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t)},t.prototype.getCombinedModelTransform=function(e,t){return this.getModelTransform(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t},t.prototype.getCombinedLocalTransform=function(e,t){return this._view.localTransform.getMat(e,t),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,e,t),t},t.prototype.getCombinedMaxScaleFactor=function(e){var t=this._view.modelScaleFactors.get(e,1);if(this._shaderTransformation){var r=this._shaderTransformation.scaleFactor(_,this,e);t*=Math.max(r[0],r[1],r[2])}return t},t.prototype.getCombinedMedianScaleFactor=function(e){var t=this._view.modelScaleFactors.get(e,0);if(this._shaderTransformation){var r=this._shaderTransformation.scaleFactor(_,this,e);r.sort(),t*=r[1]}return t},t.prototype.getModel=function(e,t){this._view.model.getMat(e,t)},t.prototype.setFeatureAttribute=function(e,t){this._view.featureAttribute.setVec(e,t)},t.prototype.getFeatureAttribute=function(e,t){this._view.featureAttribute.getVec(e,t)},t.prototype.setColor=function(e,t){this._view.color.setVec(e,t)},t.prototype.getColor=function(e,t){this._view.color.getVec(e,t)},t.prototype.setVisible=function(e,t){t!==this.getVisible(e)&&(this.setStateFlag(e,v.VISIBLE,t),this.emit("instance-visibility-changed",{index:e}))},t.prototype.getVisible=function(e){return this.getStateFlag(e,v.VISIBLE)},t.prototype.setHighlight=function(e,t){t!==this.getHighlight(e)&&(this.setStateFlag(e,v.HIGHLIGHT,t),this.emit("instance-highlight-changed",{index:e}))},t.prototype.getHighlight=function(e){return this.getStateFlag(e,v.HIGHLIGHT)},t.prototype.getState=function(e){return this._view.state.get(e)},t.prototype.getLodLevel=function(e){return this._view.lodLevel.get(e)},t.prototype.countFlags=function(e){for(var t=0,r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t},t.prototype.setStateFlags=function(e,t){var r=this._view.state;t=r.get(e)|t,r.set(e,t)},t.prototype.clearStateFlags=function(e,t){var r=this._view.state;t=r.get(e)&~t,r.set(e,t)},t.prototype.setStateFlag=function(e,t,r){r?this.setStateFlags(e,t):this.clearStateFlags(e,t)},t.prototype.getStateFlag=function(e,t){return!!(this._view.state.get(e)&t)},t.prototype.grow=function(){var e=Math.max(b,Math.floor(this._capacity*x)),t=this._layout.createBuffer(e);if(this._buffer){var r=new Uint8Array(this._buffer.buffer);new Uint8Array(t.buffer).set(r)}this._capacity=e,this._buffer=t,this._view=new g(this._buffer)},t.prototype.findSlot=function(){for(var e=this._view.state,t=this._next;e.get(t)&v.ALLOCATED;)t=(t+1)%this._capacity;return this._next=(t+1)%this._capacity,t},t}(c.Evented);t.InstanceData=y;var b=1024,x=2,_=l.vec3f64.create(),S=i.mat3f64.create(),w=o.mat4f64.create(),C=o.mat4f64.create()}.apply(null,n))||(e.exports=i)},"2UbT":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q7+X"),r("XIUG")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.make=function(e,t,i){var a;switch(e.type){case"point-3d":a=r;break;default:a=n}return new a(e,t,i)}}.apply(null,n))||(e.exports=i)},"2eYJ":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("qsST"),r("PHan"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("AzkI"),r("JjCO"),r("N5NQ"),r("GG08"),r("4p4v"),r("18xY")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h){function v(e){return void 0===e&&(e=t.UP),{plane:f.create(e.plane),origin:l.vec3f64.clone(e.origin),basis1:l.vec3f64.clone(e.basis1),basis2:l.vec3f64.clone(e.basis2)}}function m(e,t){return void 0===t&&(t=v()),g(e.origin,e.basis1,e.basis2,t)}function g(e,t,r,n){return void 0===n&&(n=v()),s.vec3.copy(n.origin,e),s.vec3.copy(n.basis1,t),s.vec3.copy(n.basis2,r),f.fromVectorsAndPoint(r,t,e,n.plane),R(n,"fromValues()"),n}function y(e,t,r){e!==r&&m(e,r);var n=s.vec3.scale(u.sv3d.get(),e.plane,t);return s.vec3.add(r.origin,r.origin,n),r.plane[3]-=t,r}function b(e,t){void 0===t&&(t=v());var r=(e[2]-e[0])/2,n=(e[3]-e[1])/2;return s.vec3.set(t.origin,e[0]+r,e[1]+n,0),s.vec3.set(t.basis1,r,0,0),s.vec3.set(t.basis2,0,n,0),f.fromValues(0,0,1,0,t.plane),t}function x(e,t,r){return!!f.intersectRay(e.plane,t,r)&&T(e,r)}function _(e,t,r){var n=V.get();M(e,t,n,V.get());for(var i=Number.POSITIVE_INFINITY,a=0,o=N;a<o.length;a++){var l=A(e,o[a],L.get()),d=u.sv3d.get();if(f.intersectLineSegment(n,l,d)){var p=c.directionFromTo(u.sv3d.get(),t.origin,d),h=Math.abs(c.acos(s.vec3.dot(t.direction,p)));h<i&&(i=h,s.vec3.copy(r,d))}}return i===Number.POSITIVE_INFINITY?S(e,t,r):r}function S(e,t,r){if(x(e,t,r))return r;var n=V.get(),i=V.get();M(e,t,n,i);for(var a=Number.POSITIVE_INFINITY,o=0,l=N;o<l.length;o++){var c=A(e,l[o],L.get()),d=u.sv3d.get();if(f.intersectLineSegmentClamp(n,c,d)){var h=p.distance2(t,d);if(!f.isPointInside(i,d))continue;h<a&&(a=h,s.vec3.copy(r,d))}}return C(e,t.origin)<a&&s.vec3.copy(r,t.origin),r}function w(e,t,r){var n=e.origin,i=e.basis1,a=e.basis2,o=s.vec3.subtract(u.sv3d.get(),t,n),l=h.projectPointSignedLength(i,o)/s.vec3.length(i),c=h.projectPointSignedLength(a,o)/s.vec3.length(a),d=h.projectPointSignedLength(e.plane,o);return s.vec3.set(r,l,c,d)}function C(e,t){var r=w(e,t,u.sv3d.get()),n=e.basis1,i=e.basis2,a=s.vec3.length(n),o=s.vec3.length(i),l=Math.max(Math.abs(r[0])-a,0),c=Math.max(Math.abs(r[1])-o,0),d=r[2];return l*l+c*c+d*d}function P(e,t){var r=-e.plane[3];return h.projectPointSignedLength(e.plane,t)-r}function E(e,t,n){switch(t){case 0:s.vec3.copy(n,e.basis1),s.vec3.normalize(n,n);break;case 1:s.vec3.copy(n,e.basis2),s.vec3.normalize(n,n);break;case 2:s.vec3.copy(n,e.plane);break;default:r.neverReached(t)}return n}function T(e,t){var r=s.vec3.subtract(u.sv3d.get(),t,e.origin),n=s.vec3.squaredLength(e.basis1),i=s.vec3.squaredLength(e.basis2),a=s.vec3.dot(e.basis1,r),o=s.vec3.dot(e.basis2,r);return-a-n<0&&a-n<0&&-o-i<0&&o-i<0}function O(e,t){var r=L.get();return s.vec3.copy(r.origin,e.origin),s.vec3.copy(r.vector,t),r}function A(e,t,r){var n=e.basis1,i=e.basis2,a=e.origin,o=s.vec3.scale(u.sv3d.get(),n,t.origin[0]),l=s.vec3.scale(u.sv3d.get(),i,t.origin[1]);s.vec3.add(r.origin,o,l),s.vec3.add(r.origin,r.origin,a);var c=s.vec3.scale(u.sv3d.get(),n,t.direction[0]),d=s.vec3.scale(u.sv3d.get(),i,t.direction[1]);return s.vec3.scale(r.vector,s.vec3.add(c,c,d),2),r}function R(e,t){Math.abs(s.vec3.dot(e.basis1,e.basis2)/(s.vec3.length(e.basis1)*s.vec3.length(e.basis2)))>1e-6&&I.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(s.vec3.dot(e.basis1,e.plane))>1e-6&&I.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-s.vec3.dot(e.plane,e.origin)-e.plane[3])>1e-6&&I.warn(t,"Plane offset is not consistent with plane origin")}function M(e,t,r,n){var i=e.plane;f.fromVectorsAndPoint(i,t.direction,t.origin,r),f.fromVectorsAndPoint(r,i,t.origin,n)}Object.defineProperty(t,"__esModule",{value:!0});var I=n.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),D=function(){this.plane=f.create(),this.origin=l.vec3f64.create(),this.basis1=l.vec3f64.create(),this.basis2=l.vec3f64.create()};t.BoundedPlaneClass=D,t.create=v,t.wrap=function(e,t,r){var n=B.get();return n.origin=e,n.basis1=t,n.basis2=r,n.plane=f.fromVectorsAndPoint(r,t,e,f.wrap(0,0,0,0)),n},t.copy=m,t.fromValues=g,t.elevate=y,t.setExtent=function(e,t,r){return b(t,r),y(r,P(e,e.origin),r),r},t.fromAABoundingRect=b,t.intersectRay=x,t.intersectRayClosestSilhouette=function(e,t,r){if(x(e,t,r))return r;var n=_(e,t,u.sv3d.get());return s.vec3.add(r,t.origin,s.vec3.scale(u.sv3d.get(),t.direction,s.vec3.distance(t.origin,n)/s.vec3.length(t.direction))),r},t.closestPointOnSilhouette=_,t.closestPoint=S,t.projectPoint=function(e,t,r){var n=f.projectPoint(e.plane,t,u.sv3d.get()),i=d.projectPointClamp(O(e,e.basis1),n,-1,1,u.sv3d.get()),a=d.projectPointClamp(O(e,e.basis2),n,-1,1,u.sv3d.get());return s.vec3.subtract(r,s.vec3.add(u.sv3d.get(),i,a),e.origin),r},t.projectPointLocal=w,t.distance2=C,t.distance=function(e,t){return Math.sqrt(C(e,t))},t.distanceToSilhouette=function(e,t){for(var r=Number.NEGATIVE_INFINITY,n=0,i=N;n<i.length;n++){var a=A(e,i[n],L.get()),o=d.distance2(a,t);o>r&&(r=o)}return Math.sqrt(r)},t.extrusionContainsPoint=function(e,t){return f.isPointInside(e.plane,t)&&T(e,t)},t.axisAt=function(e,t,r,n){return E(e,r,n)},t.altitudeAt=P,t.setAltitudeAt=function(e,t,r,n){var i=P(e,t),a=s.vec3.scale(F,e.plane,r-i);return s.vec3.add(n,t,a),n},t.transform=function(e,t,r){return e!==r&&m(e,r),a.mat4.invert(U,t),a.mat4.transpose(U,U),s.vec3.transformMat4(r.basis1,e.basis1,U),s.vec3.transformMat4(r.basis2,e.basis2,U),s.vec3.transformMat4(r.plane,e.plane,U),s.vec3.transformMat4(r.origin,e.origin,t),f.setOffsetFromPoint(r.plane,r.origin,r.plane),r},t.UP={plane:f.create(),origin:l.vec3f64.fromValues(0,0,0),basis1:l.vec3f64.fromValues(1,0,0),basis2:l.vec3f64.fromValues(0,1,0)};var V=new i.ObjectStack(f.create),L=new i.ObjectStack(d.create),F=l.vec3f64.create(),B=new i.ObjectStack(function(){return{origin:null,basis1:null,basis2:null,plane:null}}),N=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],U=o.mat4f64.create()}.apply(null,n))||(e.exports=i)},"2f4f":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2fXB"),r("j2SP"),r("O7NG"),r("Dk48"),r("ff/U"),r("zZCp"),r("/Bau"),r("CIy2"),r("i9pz"),r("QFi0"),r("/f24"),r("qbr3"),r("Kfys"),r("z2+Q")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v){var m=5;return function(){function e(e,t){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0},this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null,this._rctx=t,this.viewportToRestore=i.vec4f64.create(),this.defaultOptions={color:n.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05},this.blurProgram=e.getProgram(u.blurPass,{gaussianSamples:m}),this.blurGridProgram=e.getProgram(u.blurPass,{gaussianSamples:m,gridOptimization:!0}),this.applyProgram=e.getProgram(u.applyPass),this.applyGridProgram=e.getProgram(u.applyPass,{gridOptimization:!0}),this.applyGridDebugProgram=e.getProgram(u.applyPass,{gridOptimization:!0,gridDebug:!0}),this.downsampleProgram=e.getProgram(u.downsamplePass),this.preprocessPipelineState=p.makePipelineState({colorWrite:p.defaultColorWriteParams}),this.applyPipelineState=p.makePipelineState({blending:p.separateBlendingParams(770,1,771,771),colorWrite:p.defaultColorWriteParams})}return Object.defineProperty(e.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"profilingCallback",{get:function(){return a.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(e){}:null},enumerable:!0,configurable:!0}),e.prototype.setDefaultOptions=function(e){this.defaultOptions=e},e.prototype.render=function(e,t,n){var i=e.pixelRatio,o=!a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,s=a.HIGHLIGHTS_VISUALIZE_BLOCKS,l=this._rctx;c.assert(this.enabled),r.vec4.copy(this.viewportToRestore,e.fullViewport);var u=e.fullWidth,d=e.fullHeight,f=Math.ceil(u/i),p=Math.ceil(d/i);this.blur0Fbo.resize(f,p),this.blur1Fbo.resize(f,p),l.bindVAO(this.quadVAO),l.setPipelineState(this.preprocessPipelineState);var v=null,m=null,g=null,y=null;if(o){var b=this._grid;this._gridUpdateResources(t,32),this._gridComputeMipmap(),g=b.vao,y=4,v=this.blurGridProgram,l.bindProgram(v),l.bindTexture(b.coverageMipmap[b.mipmapLevels].colorTexture,1),v.setUniform1i("coverageTex",1)}else g=this.quadVAO,y=5,v=this.blurProgram,l.bindProgram(v);if(l.bindVAO(g),l.bindFramebuffer(this.blur0Fbo),l.setViewport(0,0,f,p),l.setClearColor(0,0,0,0),l.clear(16384),v.setUniform1i("tex",0),l.bindTexture(t.colorTexture,0),v.setUniform2f("blurSize",1/f,0),l.drawArrays(y,0,h.vertexCount(g,"geometry")),l.bindFramebuffer(this.blur1Fbo),l.clear(16384),l.bindTexture(this.blur0Fbo.colorTexture,0),v.setUniform2f("blurSize",0,1/p),l.drawArrays(y,0,h.vertexCount(g,"geometry")),l.bindFramebuffer(n),l.setPipelineState(this.applyPipelineState),l.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),o){m=s?this.applyGridDebugProgram:this.applyGridProgram,l.bindProgram(m),m.setUniform1i("coverageTex",2);var x=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;l.bindTexture(x,2)}else m=this.applyProgram,l.bindProgram(m);m.setUniform1i("tex",0),l.bindTexture(this.blur1Fbo.colorTexture,0),m.setUniform1i("origin",1),l.bindTexture(t.colorTexture,1),m.setUniform4fv("color",this.defaultOptions.color),m.setUniform1f("outlineSize",8.6),m.setUniform1f("blurSize",.4),m.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded),l.drawArrays(y,0,h.vertexCount(g,"geometry")),l.bindVAO(null)},e.prototype.enable=function(){if(!this.enabled){this.quadVAO=l.createQuadVAO(this._rctx);var e={colorTarget:0,depthStencilTarget:0,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=f.createWithAttachments(this._rctx,t,e),this.blur1Fbo=f.createWithAttachments(this._rctx,t,e)}},e.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.quadVAO=null,this.blur0Fbo=null,this.blur1Fbo=null)},e.prototype._gridUpdateResources=function(e,t){var r=this._rctx,n=this._grid,i=!1;if(null===n.coverageMipmap&&(n.coverageMipmap=[e],i=!0),n.viewportWidth===e.width&&n.viewportHeight===e.height||(i=!0,n.viewportWidth=e.width,n.viewportHeight=e.height),n.coverageMipmap[0]=e,n.cellPixelSize!==t&&(n.cellPixelSize=t,i=!0),i){for(var a=1;a<n.coverageMipmap.length;a++)n.coverageMipmap[a].dispose();n.mipmapLevels=Math.ceil(Math.log(n.cellPixelSize)*Math.LOG2E),n.coverageMipmap.length=n.mipmapLevels+1;for(a=0;a<n.mipmapLevels;a++){var l=n.coverageMipmap[a],c={target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},u={colorTarget:0,depthStencilTarget:0,width:Math.ceil(l.width/2),height:Math.ceil(l.height/2)},p=f.createWithAttachments(r,c,u);n.coverageMipmap[a+1]=p}}var h=Math.ceil(e.height/n.cellPixelSize),m=Math.ceil(e.width/n.cellPixelSize);if(!n.vao||n.verticalCellCount!==h||n.horizontalCellCount!==m){n.verticalCellCount=h,n.horizontalCellCount=m;for(var g=h+1,y=m+1,b=1/h,x=1/m,_=new Float32Array(24*g*y),S=0,w=0;w<g;w++)for(var C=0;C<y;C++)_[S+0]=(C-.5)*x*2-1,_[S+1]=(w-.5)*b*2-1,_[S+2]=C*x,_[S+3]=w*b,_[S+4]=(C+.5)*x*2-1,_[S+5]=(w-.5)*b*2-1,_[S+6]=C*x,_[S+7]=w*b,_[S+8]=(C-.5)*x*2-1,_[S+9]=(w+.5)*b*2-1,_[S+10]=C*x,_[S+11]=w*b,_[S+12]=(C-.5)*x*2-1,_[S+13]=(w+.5)*b*2-1,_[S+14]=C*x,_[S+15]=w*b,_[S+16]=(C+.5)*x*2-1,_[S+17]=(w-.5)*b*2-1,_[S+18]=C*x,_[S+19]=w*b,_[S+20]=(C+.5)*x*2-1,_[S+21]=(w+.5)*b*2-1,_[S+22]=C*x,_[S+23]=w*b,S+=24;n.vao&&n.vao.dispose(!0),n.vao=new v(r,o.Default3D,{geometry:s.Pos2Tex},{geometry:d.createVertex(r,35044,_)})}},e.prototype._gridComputeMipmap=function(){var e=this._rctx,t=this._grid,r=this.downsampleProgram;e.bindVAO(this.quadVAO);for(var n=0;n<t.mipmapLevels;n++){e.bindFramebuffer(t.coverageMipmap[n+1]),e.bindTexture(t.coverageMipmap[n].colorTexture,0);var i=t.coverageMipmap[n+1].width,a=t.coverageMipmap[n+1].height;e.bindProgram(r),r.setUniform1i("tex",0),r.setUniform2f("invFramebufferDim",1/i,1/a),e.setViewport(0,0,i,a),e.drawArrays(5,0,h.vertexCount(this.quadVAO,"geometry"))}},e.prototype.getGpuMemoryUsage=function(){var e=h.getGpuMemoryUsage(this.blur0Fbo)+h.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(var t=0,r=this._grid.coverageMipmap;t<r.length;t++){var n=r[t];e+=h.getGpuMemoryUsage(n)}return e},e}()}.apply(null,n))||(e.exports=i)},"2fXB":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("bH65")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=r}.apply(null,n))||(e.exports=i)},"2vyw":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Q2wQ"),r("HZ3d"),r("jZlN"),r("y4WC"),r("qMld"),r("Vx27"),r("4PmR"),r("0NBi")],void 0===(i=function(e,t,n,i,a,o,s,l,c,u,d,f){return function(e){function t(){return e.call(this)||this}return n(t,e),t.prototype.createController=function(){return o(this,void 0,void 0,function(){var e,t,n;return a(this,function(i){switch(i.label){case 0:return e=l.ofType(s),[4,c.create(function(e){r.e(80).then(function(){var t=[r("NaiN")];e.apply(null,t)}.bind(this)).catch(r.oe)})];case 1:return t=i.sent(),[4,(n=new t({layer:this.layer,layerView:this,graphics:new e})).when()];case 2:return i.sent(),[2,n]}})})},i([u.property()],t.prototype,"controller",void 0),i([u.property({aliasOf:"controller.graphics",readOnly:!0})],t.prototype,"graphics",void 0),i([u.subclass("esri.views.3d.layers.StreamLayerView3D")],t)}(u.declared(d,f))}.apply(null,n))||(e.exports=i)},"31XB":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zbgD")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.blendLayers={name:"blend-layers",shaders:{vertexShader:n.resolveIncludes("misc/blendLayers.vert"),fragmentShader:n.resolveIncludes("misc/blendLayers.frag")},attributes:r.Default3D},t.texOnly={name:"tex-only",shaders:{vertexShader:n.resolveIncludes("misc/texOnly.vert"),fragmentShader:n.resolveIncludes("misc/texOnly.frag")},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},"37NJ":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("U6iw"),r("DlJW"),r("7laH"),r("veTl")],void 0===(i=function(e,t,r,n,i,a){function o(e,t){if(t.compressedTextureS3TC)return null;var r=e.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function s(e,t){if(i.default(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;var r=e.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}function l(e,t){if(t.textureFilterAnisotropic)return null;var r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function c(e,t){if(i.default(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT};if(e instanceof WebGLRenderingContext){var r=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}}function u(e,t){if(i.default(e)){var r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),n=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float");return r||n?{textureFloat:!!n,textureHalfFloat:!!r,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),n=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float");return r||n?{textureFloat:!!n,textureHalfFloat:!!r,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:n?n.RGBA32F_EXT:void 0}:null}}function d(e,t,r,n,a){if(n&&i.default(e))return!0;if(t[r])return!1;for(var o=0,s=a;o<s.length;o++){var l=s[o];if(e.getExtension(l))return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.loadCapabilities=function(e,t){var i=t&&t.disabledExtensions||{};return d(e,i,"standardDerivatives",!0,["OES_standard_derivatives"]),{instancing:n.load(e),vao:a.load(e,i),compressedTextureS3TC:o(e,i),textureFilterAnisotropic:l(e,i),disjointTimerQuery:r.load(e,i),textureFloat:c(e,i),colorBufferFloat:u(e,i),blendMinMax:s(e,i),depthTexture:d(e,i,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:d(e,i,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),fragDepth:d(e,i,"fragDepth",!0,["EXT_frag_depth"])}}}.apply(null,n))||(e.exports=i)},"3KT0":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("H1tY"),r("uwSd"),r("TCFx"),r("qbr3"),r("7laH"),r("37NJ")],void 0===(i=function(e,t,r,n,i,a,o,s){function l(e,t){switch(e){case 0:return 2*t;case 4:return t/3;case 5:case 6:return t-2}return 0}return function(){function e(e,t){var n=this;this.gl=null,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap={},this._numOfDrawCalls=0,this._numOfTriangles=0,this.contextVersion=o.default(e)?"webgl2":"webgl",this.gl=e,e instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=s.loadCapabilities(e,t);var l=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:l[0],y:l[1],width:l[2],height:l[3]};var c=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:c?this.gl.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)},r("esri-webgl-debug")&&(this.instanceCounter=new i),this._stateTracker=new a.StateTracker({setBlending:function(e){if(e){n.setBlendingEnabled(!0),n.setBlendEquationSeparate(e.opRgb,e.opAlpha),n.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);var t=e.color;n.setBlendColor(t.r,t.g,t.b,t.a)}else n.setBlendingEnabled(!1)},setCulling:function(e){e?(n.setFaceCullingEnabled(!0),n.setCullFace(e.face),n.setFrontFace(e.mode)):n.setFaceCullingEnabled(!1)},setPolygonOffset:function(e){e?(n.setPolygonOffsetFillEnabled(!0),n.setPolygonOffset(e.factor,e.units)):n.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(e){e?(n.setDepthTestEnabled(!0),n.setDepthFunction(e.func)):n.setDepthTestEnabled(!1)},setStencilTest:function(e){if(e){n.setStencilTestEnabled(!0);var t=e.function;n.setStencilFunction(t.func,t.ref,t.mask);var r=e.operation;n.setStencilOp(r.fail,r.zFail,r.zPass)}else n.setStencilTestEnabled(!1)},setDepthWrite:function(e){e?(n.setDepthWriteEnabled(!0),n.setDepthRange(e.zNear,e.zFar)):n.setDepthWriteEnabled(!1)},setColorWrite:function(e){e?n.setColorMask(e.r,e.g,e.b,e.a):n.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(e){e?n.setStencilWriteMask(e.mask):n.setStencilWriteMask(0)}}),this.enforceState()}return Object.defineProperty(e.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap={},r("esri-webgl-debug")&&this.instanceCounter.printResourceCount(),this.gl=null},e.prototype.setPipelineState=function(e){this._stateTracker.setPipeline(e)},e.prototype.setBlendingEnabled=function(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e,this._stateTracker.invalidateBlending())},e.prototype.setBlendColor=function(e,t,r,n){e===this._blendColorState.r&&t===this._blendColorState.g&&r===this._blendColorState.b&&n===this._blendColorState.a||(this.gl.blendColor(e,t,r,n),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=r,this._blendColorState.a=n,this._stateTracker.invalidateBlending())},e.prototype.setBlendFunction=function(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t,this._stateTracker.invalidateBlending())},e.prototype.setBlendFunctionSeparate=function(e,t,r,n){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===r&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===n||(this.gl.blendFuncSeparate(e,t,r,n),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=r,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=n,this._stateTracker.invalidateBlending())},e.prototype.setBlendEquation=function(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e,this._stateTracker.invalidateBlending())},e.prototype.setBlendEquationSeparate=function(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t,this._stateTracker.invalidateBlending())},e.prototype.setColorMask=function(e,t,r,n){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===r&&this._colorMaskState.a===n||(this.gl.colorMask(e,t,r,n),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=r,this._colorMaskState.a=n,this._stateTracker.invalidateColorWrite())},e.prototype.setClearColor=function(e,t,r,n){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===r&&this._clearColor.a===n||(this.gl.clearColor(e,t,r,n),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=r,this._clearColor.a=n)},e.prototype.setFaceCullingEnabled=function(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e,this._stateTracker.invalidateCulling())},e.prototype.setPolygonOffsetFillEnabled=function(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e,this._stateTracker.invalidatePolygonOffset())},e.prototype.setPolygonOffset=function(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())},e.prototype.setCullFace=function(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e,this._stateTracker.invalidateCulling())},e.prototype.setFrontFace=function(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e,this._stateTracker.invalidateCulling())},e.prototype.setScissorTestEnabled=function(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)},e.prototype.setScissorRect=function(e,t,r,n){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===r&&this._scissorRect.height===n||(this.gl.scissor(e,t,r,n),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=r,this._scissorRect.height=n)},e.prototype.setDepthTestEnabled=function(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e,this._stateTracker.invalidateDepthTest())},e.prototype.setClearDepth=function(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)},e.prototype.setDepthFunction=function(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e,this._stateTracker.invalidateDepthTest())},e.prototype.setDepthWriteEnabled=function(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e,this._stateTracker.invalidateDepthWrite())},e.prototype.setDepthRange=function(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())},e.prototype.setStencilTestEnabled=function(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e,this._stateTracker.invalidateStencilTest())},e.prototype.setClearStencil=function(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)},e.prototype.setStencilFunction=function(e,t,r){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===r||(this.gl.stencilFunc(e,t,r),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())},e.prototype.setStencilFunctionSeparate=function(e,t,r,n){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===r&&this._stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,t,r,n),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=r,this._stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())},e.prototype.setStencilWriteMask=function(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())},e.prototype.setStencilOp=function(e,t,r){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===r||(this.gl.stencilOp(e,t,r),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())},e.prototype.setStencilOpSeparate=function(e,t,r,n){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===r&&this._stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,t,r,n),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=r,this._stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())},e.prototype.setActiveTexture=function(e){var t=this._activeTextureUnit;return e>=0&&e!==this._activeTextureUnit&&(this.gl.activeTexture(n.BASE_TEXTURE_UNIT+e),this._activeTextureUnit=e),t},e.prototype.clear=function(e){e&&this.gl.clear(e)},e.prototype.clearSafe=function(e){e&&(16384&e&&this.setColorMask(!0,!0,!0,!0),256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(255),this.gl.clear(e))},e.prototype.drawArrays=function(e,t,n){r("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=l(e,n)),this.gl.drawArrays(e,t,n)},e.prototype.drawElements=function(e,t,n,i){r("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=l(e,t)),5123!==n?5125===n&&this.gl.drawElements(e,t,n,i):this.gl.drawElements(e,t,n,i)},e.prototype.logIno=function(){r("esri-webgl-debug")},Object.defineProperty(e.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0}),e.prototype.setViewport=function(e,t,r,n){var i=this._viewport;i.x===e&&i.y===t&&i.width===r&&i.height===n||(i.x=e,i.y=t,i.width=r,i.height=n,this.gl.viewport(e,t,r,n))},e.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}},e.prototype.bindProgram=function(e){if(!e)return this.gl.useProgram(null),void(this._activeShaderProgram=null);this._activeShaderProgram!==e&&(e.initialize(),this.gl.useProgram(e.glName),this._activeShaderProgram=e)},e.prototype.bindTexture=function(t,r){void 0===r&&(r=0),-1===e._MAX_TEXTURE_IMAGE_UNITS&&(e._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)),e._MAX_TEXTURE_IMAGE_UNITS;var n=this._textureUnitMap[r];return this.setActiveTexture(r),null==t||null==t.glName?(null!=n&&(this.gl.bindTexture(n.descriptor.target,null),n.setBoundToUnit(r,!1)),void(this._textureUnitMap[r]=null)):n&&n.id===t.id?void t.applyChanges():(this.gl.bindTexture(t.descriptor.target,t.glName),t.setBoundToUnit(r,!0),t.applyChanges(),void(this._textureUnitMap[r]=t))},e.prototype.bindFramebuffer=function(e){if(!e)return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);this._activeFramebuffer!==e&&(e.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e.glName),this._activeFramebuffer=e)},e.prototype.bindBuffer=function(t){t&&(34962===t.bufferType?this._activeVertexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,t,t.bufferType,this._activeIndexBuffer))},e.prototype.bindRenderbuffer=function(e){var t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)},e.prototype.unbindBuffer=function(t){34962===t?this._activeVertexBuffer=e._bindBuffer(this.gl,null,t,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,null,t,this._activeIndexBuffer)},e.prototype.bindVAO=function(e){e?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===e.id||(e.bind(),this._activeVertexArrayObject=e):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)},e.prototype.getBoundTexture=function(e){return this._textureUnitMap[e]},e.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer},e.prototype.getBoundVAO=function(){return this._activeVertexArrayObject},e.prototype.resetState=function(){this.bindProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(var e=0;e<this.parameters.maxTextureImageUnits;e++)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)},e.prototype.enforceState=function(){var e=this.gl,t=this._capabilities.vao;t&&t.bindVertexArray(null);for(var i=0;i<this.parameters.maxVertexAttributes;i++)e.disableVertexAttribArray(i);if(this._activeVertexBuffer?e.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):e.bindBuffer(34962,null),this._activeIndexBuffer?e.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):e.bindBuffer(34963,null),t&&this._activeVertexArrayObject){var a=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(a)}e.bindFramebuffer(e.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null),e.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null),e.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),e.bindRenderbuffer(e.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),e.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),e.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),e.clearDepth(this._clearDepth),e.clearStencil(this._clearStencil),e.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),e.cullFace(this._cullFace),e.depthFunc(this._depthFunction),e.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._depthWriteEnabled),e.frontFace(this._frontFace),e.lineWidth(1),!0===this._polygonCullingEnabled?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),e.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._stencilWriteMask);for(var o=0;o<this.parameters.maxTextureImageUnits;o++){e.activeTexture(n.BASE_TEXTURE_UNIT+o),e.bindTexture(3553,null);var s=this._textureUnitMap[o];s&&e.bindTexture(s.descriptor.target,s.glName)}e.activeTexture(n.BASE_TEXTURE_UNIT+this._activeTextureUnit),e.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height),r("esri-webgl-debug")&&(this._numOfDrawCalls=0,this._numOfTriangles=0)},e._bindBuffer=function(e,t,r,n){return t?n===t?n:(e.bindBuffer(r,t.glName),t):(e.bindBuffer(r,null),null)},e._MAX_TEXTURE_IMAGE_UNITS=-1,e}()}.apply(null,n))||(e.exports=i)},"3Noo":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("5iSs")],void 0===(i=function(e,t,r){return function(){function e(e,t){this.highlightSet=new r,this.ids=new Set,this.paused=!1,this.options=e,this.objectIdField=t}return e.prototype.hasGraphic=function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)},e}()}.apply(null,n))||(e.exports=i)},"3RHn":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KBgh"),r("0LE5"),r("Rdxj"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a){var o=function(){function e(t,r,o,s){a.assert(t.length>=1),a.assert(o.length%r==0),a.assert(o.length>=t.length*r),a.assert(3===s.size||4===s.size),this.primitiveIndices=t,this.indices=o,this._position=s,this._numIndexPerPrimitive=r;var l=s.data,c=s.offsetIdx,u=s.strideIdx,d=0,f=t.length,p=c+u*o[r*t[d]];for(e.tmpIndices.clear(),e.tmpIndices.push(p),this.bbMin=i.vec3f64.fromValues(l[p],l[p+1],l[p+2]),this.bbMax=i.vec3f64.clone(this.bbMin);d<f;++d)for(var h=r*t[d],v=0;v<r;++v){p=c+u*o[h+v],e.tmpIndices.push(p);var m=l[p];this.bbMin[0]=Math.min(m,this.bbMin[0]),this.bbMax[0]=Math.max(m,this.bbMax[0]),m=l[p+1],this.bbMin[1]=Math.min(m,this.bbMin[1]),this.bbMax[1]=Math.max(m,this.bbMax[1]),m=l[p+2],this.bbMin[2]=Math.min(m,this.bbMin[2]),this.bbMax[2]=Math.max(m,this.bbMax[2])}this.center=i.vec3f64.create(),n.vec3.lerp(this.center,this.bbMin,this.bbMax,.5),this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);var g=this.bsRadius*this.bsRadius;for(d=0;d<e.tmpIndices.length;++d){var y=l[p=e.tmpIndices.data[d]]-this.center[0],b=l[p+1]-this.center[1],x=l[p+2]-this.center[2],_=y*y+b*b+x*x;if(!(_<=g)){var S=Math.sqrt(_),w=.5*(S-this.bsRadius);this.bsRadius=this.bsRadius+w,g=this.bsRadius*this.bsRadius;var C=w/S;this.center[0]+=y*C,this.center[1]+=b*C,this.center[2]+=x*C}}e.tmpIndices.clear()}return e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e.prototype.getBBMin=function(){return this.bbMin},e.prototype.getBBMax=function(){return this.bbMax},e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices},e.prototype.getIndices=function(){return this.indices},e.prototype.getPosition=function(){return this._position},e.prototype.getChildren=function(){if(this.children)return this.children;if(n.vec3.squaredDistance(this.bbMin,this.bbMax)>1){for(var t=n.vec3.lerp(i.vec3f64.create(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,a=new Uint8Array(r),o=new Array(8),s=0;s<8;++s)o[s]=0;var l=this._position,c=l.data,u=l.offsetIdx,d=l.strideIdx;for(s=0;s<r;++s){for(var f=0,p=this._numIndexPerPrimitive*this.primitiveIndices[s],h=u+d*this.indices[p],v=c[h],m=c[h+1],g=c[h+2],y=1;y<this._numIndexPerPrimitive;++y){var b=c[h=u+d*this.indices[p+y]],x=c[h+1],_=c[h+2];b<v&&(v=b),x<m&&(m=x),_<g&&(g=_)}v<t[0]&&(f|=1),m<t[1]&&(f|=2),g<t[2]&&(f|=4),a[s]=f,++o[f]}var S=0;for(s=0;s<8;++s)o[s]>0&&++S;if(S<2)return;var w=new Array(8);for(s=0;s<8;++s)w[s]=o[s]>0?new Uint32Array(o[s]):void 0;for(s=0;s<8;++s)o[s]=0;for(s=0;s<r;++s){w[f=a[s]][o[f]++]=this.primitiveIndices[s]}this.children=new Array(8);for(s=0;s<8;++s)void 0!==w[s]&&(this.children[s]=new e(w[s],this._numIndexPerPrimitive,this.indices,this._position))}return this.children},e}();return(o||(o={})).tmpIndices=new r({deallocator:null}),o}.apply(null,n))||(e.exports=i)},"3Zlx":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("1E+e"),r("ZPQp"),r("jmRc")],void 0===(i=function(e,t,r,n,i){function a(e,t,r){if(1===e.length)return e[0];for(var n=new Float64Array(t),i=new Uint32Array(r),a=0,o=0,s=0,l=0,c=e;l<c.length;l++){for(var u=c[l],d=0;d<u.position.length;d++)n[a++]=u.position[d];for(d=0;d<u.faces.length;d++)i[o++]=u.faces[d]+s;s=a/3}return{position:n,faces:i}}function o(e,t){for(var r=e.length,n=new Array(r),i=new Array(r),a=new Array(r),o=0,c=0,u=0,d=0,f=0;f<r;++f)d+=e[f].length;for(var p=new Float64Array(3*d),h=0,v=r-1;v>=0;v--){var m=e[v],g=l(m);if(g&&1!==r)n[o++]=m;else{var y=m.length;for(f=0;f<o;++f)y+=n[f].length;var b={index:h,pathLengths:new Array(o+1),count:y,holeIndices:new Array(o)};b.pathLengths[0]=m.length,m.length>0&&(a[u++]={index:h,count:m.length}),h=g?s(m,m.length-1,-1,p,h,m.length,t):s(m,0,1,p,h,m.length,t);for(var x=0;x<o;++x){var _=n[x];b.holeIndices[x]=h,b.pathLengths[x+1]=_.length,_.length>0&&(a[u++]={index:h,count:_.length}),h=s(_,0,1,p,h,_.length,t)}o=0,b.count>0&&(i[c++]=b)}}for(x=0;x<o;++x){(_=n[x]).length>0&&(a[u++]={index:h,count:_.length}),h=s(_,0,1,p,h,_.length,t)}return c<r&&(i.length=c),u<r&&(a.length=u),{position:p,polygons:i,outlines:a}}function s(e,t,r,n,i,a,o){i*=3;for(var s=0;s<a;++s){var l=e[t];n[i++]=l[0],n[i++]=l[1],n[i++]=o?l[2]:0,t+=r}return i/3}function l(e){return!n.isClockwise(e,!1,!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.triangulate=function(e){for(var t=o(e.rings,e.hasZ),n=[],s=0,l=0,c=0,u=t.polygons;c<u.length;c++)!function(e){var i=e.count,a=e.index,o=new Float64Array(t.position.buffer,3*a*t.position.BYTES_PER_ELEMENT,3*i),c=e.holeIndices.map(function(e){return e-a}),u=new Uint32Array(r(o,c,3));n.push({position:o,faces:u}),s+=o.length,l+=u.length}(u[c]);var d=a(n,s,l),f=i.default(d.position.buffer,6,d.faces);return d.position=new Float64Array(f.buffer),d.faces=f.indices,d},t.pathsToTriangulationInfo=o}.apply(null,n))||(e.exports=i)},"3gjc":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return new Float32Array(4)},t.clone=function(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,r,n){var i=new Float32Array(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i},t.createView=function(e,t){return new Float32Array(e,t,4)}}.apply(null,n))||(e.exports=i)},"3w6h":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("YX1r"),r("51bw"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("4oaH"),r("Dk48")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u){function d(e){return null!=e}function f(e){return"number"==typeof e}function p(e){return"string"==typeof e}function h(e){return null==e||p(e)}function v(e,t){e&&e.push(t),m(t)}function m(e){}function g(e,t,r,n){void 0===n&&(n=o.mat4f64.create());var i=e||0,s=t||0,l=r||0;return 0!==i&&a.mat4.rotateZ(n,n,-i/180*Math.PI),0!==s&&a.mat4.rotateX(n,n,s/180*Math.PI),0!==l&&a.mat4.rotateY(n,n,l/180*Math.PI),n}function y(e,t,r,n,i){var a=e.minSize,o=e.maxSize;if(e.expression)return v(i,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){var s=n.symbolSize[r];return t.minSize[r]=s,t.maxSize[r]=s,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0}if(d(e.field))return d(e.stops)?2===e.stops.length&&f(e.stops[0].size)&&f(e.stops[1].size)?(b(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=1,!0):(v(i,"Could not convert size info: stops only supported with 2 elements"),!1):f(a)&&f(o)&&d(e.minDataValue)&&d(e.maxDataValue)?(b(a,o,e.minDataValue,e.maxDataValue,t,r),t.type[r]=1,!0):null!=c.meterIn[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/c.meterIn[e.valueUnit],t.type[r]=1,!0):"unknown"===e.valueUnit?(v(i,"Could not convert size info: proportional size not supported"),!1):(v(i,"Could not convert size info: scale-dependent size not supported"),!1);if(!d(e.field)){if(e.stops&&e.stops[0]&&f(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0;if(f(a))return t.minSize[r]=a,t.maxSize[r]=a,t.offset[r]=a,t.factor[r]=0,t.type[r]=1,!0}return v(i,"Could not convert size info: unsupported variant of sizeInfo"),!1}function b(e,t,r,n,i,a){var o=Math.abs(n-r)>0?(t-e)/(n-r):0;i.minSize[a]=o>0?e:t,i.maxSize[a]=o>0?t:e,i.offset[a]=e-r*o,i.factor[a]=o}function x(e,t,r,n){if(e.normalizationField||e.valueRepresentation)return v(n,"Could not convert size info: unsupported property"),null;if(!h(e.field))return v(n,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return v(n,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};var i;switch(e.axis){case"width":return(i=y(e,t.size,0,r,n))?t:null;case"height":return(i=y(e,t.size,2,r,n))?t:null;case"depth":return(i=y(e,t.size,1,r,n))?t:null;case"width-and-depth":return(i=y(e,t.size,0,r,n))&&y(e,t.size,1,r,n),i?t:null;case null:case void 0:case"all":return(i=(i=(i=y(e,t.size,0,r,n))&&y(e,t.size,1,r,n))&&y(e,t.size,2,r,n))?t:null;default:return v(n,'Could not convert size info: unknown axis "'+e.axis+'""'),null}}function _(e,t,r){for(var n=0;n<3;++n){var i=t.unitInMeters;1===e.type[n]&&(i*=t.modelSize[n],e.type[n]=2),e.minSize[n]=e.minSize[n]/i,e.maxSize[n]=e.maxSize[n]/i,e.offset[n]=e.offset[n]/i,e.factor[n]=e.factor[n]/i}var a;if(0!==e.type[0])a=0;else if(0!==e.type[1])a=1;else{if(0===e.type[2])return v(r,"No size axis contains a valid size or scale"),!1;a=2}for(n=0;n<3;++n)0===e.type[n]&&(e.minSize[n]=e.minSize[a],e.maxSize[n]=e.maxSize[a],e.offset[n]=e.offset[a],e.factor[n]=e.factor[a],e.type[n]=e.type[a]);return!0}function S(e,t,r){e[4*t+0]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function w(e,t,r){if(e.normalizationField)return v(r,"Could not convert color info: unsupported property"),null;if(p(e.field)){if(!e.stops)return v(r,"Could not convert color info: missing stops or colors"),null;if(e.stops.length>8)return v(r,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(var n=e.stops,i=0;i<8;++i){var a=n[Math.min(i,n.length-1)];t.color.values[i]=a.value,S(t.color.colors,i,a.color)}}else{if(!(e.stops&&e.stops.length>=0))return v(r,"Could not convert color info: no field and no colors/stops"),null;var o=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(i=0;i<8;i++)t.color.values[i]=1/0,S(t.color.colors,i,o)}return t}function C(e,t,r){if(e.normalizationField)return v(r,"Could not convert opacity info: unsupported property"),null;if(p(e.field)){if(!e.stops)return v(r,"Could not convert opacity info: missing stops or opacities"),null;if(e.stops.length>8)return v(r,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(var n=e.stops,i=0;i<8;++i){var a=n[Math.min(i,n.length-1)];t.opacity.values[i]=a.value,t.opacity.opacityValues[i]=a.opacity}}else{if(!(e.stops&&e.stops.length>=0))return v(r,"Could not convert opacity info: no field and no opacities/stops"),null;var o=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(i=0;i<8;i++)t.opacity.values[i]=1/0,t.opacity.opacityValues[i]=o}return t}function P(e,t,r,n){var i=2===r&&"arithmetic"===e.rotationType;t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function E(e,t,r){if(!p(e.field))return v(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return v(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return P(e,t.rotation,0),t;case"roll":return P(e,t.rotation,1),t;case null:case void 0:case"heading":return P(e,t.rotation,2),t;default:return v(r,'Could not convert rotation info: unknown axis "'+e.axis+'""'),null}}function T(e,t,n){if(!e)return null;var i=!t.supportedTypes||!!t.supportedTypes.size,a=!t.supportedTypes||!!t.supportedTypes.color,o=!t.supportedTypes||!!t.supportedTypes.rotation,s=!!t.supportedTypes&&!!t.supportedTypes.opacity;I&&(n=n||[]);var l=e.reduce(function(e,l){if(!e)return e;if(l.valueExpression)return v(n,"Could not convert visual variables: arcade expressions not supported"),null;switch(l.type){case"size":return i?x(l,e,t,n):e;case"color":return a?w(l,e,n):e;case"opacity":return s?C(l,e,n):e;case"rotation":return o?E(l,e,n):e;default:return r.neverReached(l),null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&l)||l.size||l.color||l.opacity||l.rotation?l&&l.size&&!_(l.size,t,n)?null:l:null}function O(e){return e&&null!=e.size}function A(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t.field)return!1;if(e&&"rotation"===r)for(var n=e,i=t,a=0;a<3;a++)if(n.type[a]!==i.type[a]||n.offset[a]!==i.offset[a]||n.factor[a]!==i.factor[a])return!1;return!0}function R(e,t){var r={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},o=O(e);return e&&e.size?(r.vvSizeEnabled=!0,r.vvSizeMinSize=e.size.minSize,r.vvSizeMaxSize=e.size.maxSize,r.vvSizeOffset=e.size.offset,r.vvSizeFactor=e.size.factor):e&&o&&(r.vvSizeValue=t.transformation.scale),e&&o&&(r.vvSymbolAnchor=t.transformation.anchor,r.vvSymbolRotationMatrix=i.mat3f64.create(),a.mat4.identity(V),g(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],V),n.mat3.fromMat4(r.vvSymbolRotationMatrix,V)),e&&e.color&&(r.vvColorEnabled=!0,r.vvColorValues=e.color.values,r.vvColorColors=e.color.colors),e&&e.opacity&&(r.vvOpacityEnabled=!0,r.vvOpacityValues=e.opacity.values,r.vvOpacityOpacities=e.opacity.opacityValues),r}Object.defineProperty(t,"__esModule",{value:!0});var M,I=!1,D=!1;t.convertVisualVariables=T,t.initFastSymbolUpdatesState=function(e,t){if(D)return{enabled:!1};if(!e)return{enabled:!1};if(u.DISABLE_FAST_UPDATES)return{enabled:!1};var r=T(e.visualVariables,t);return r?{enabled:!0,visualVariables:r,materialParameters:R(r,t),requiresShaderTransformation:O(r)}:{enabled:!1}},t.updateFastSymbolUpdatesState=function(e,t,r){if(!t||!e.enabled)return!1;var n=e.visualVariables,i=T(t.visualVariables,r);return!!i&&!!(A(n.size,i.size,"size")&&A(n.color,i.color,"color")&&A(n.rotation,i.rotation,"rotation"))&&(e.visualVariables=i,e.materialParameters=R(i,r),e.requiresShaderTransformation=O(i),!0)},t.getMaterialParams=R,function(e){function t(e,t,r){return e<t?t:e>r?r:e}var r=o.mat4f64.create(),n=l.vec3f64.create();e.evaluateModelTransform=function(e,i,o){if(!e.vvSizeEnabled)return o;a.mat4.copy(r,o);var s=e.vvSymbolRotationMatrix;a.mat4.set(V,s[0],s[1],s[2],0,s[3],s[4],s[5],0,s[6],s[7],s[8],0,0,0,0,1),a.mat4.multiply(r,r,V);for(var l=0;l<3;++l){var c=e.vvSizeOffset[l]+i[0]*e.vvSizeFactor[l];n[l]=t(c,e.vvSizeMinSize[l],e.vvSizeMaxSize[l])}return a.mat4.scale(r,r,n),a.mat4.translate(r,r,e.vvSymbolAnchor),r},e.evaluateModelTransformScale=function(e,r,n){if(!r.vvSizeEnabled)return s.vec3.set(e,1,1,1);for(var i=0;i<3;++i){var a=r.vvSizeOffset[i]+n[0]*r.vvSizeFactor[i];e[i]=t(a,r.vvSizeMinSize[i],r.vvSizeMaxSize[i])}return e}}(M||(M={}));var V=o.mat4f64.create();t.evaluateModelTransform=M.evaluateModelTransform,t.evaluateModelTransformScale=M.evaluateModelTransformScale}.apply(null,n))||(e.exports=i)},"4/qq":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,n))||(e.exports=i)},"4PmR":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Q2wQ"),r("HZ3d"),r("WYKK"),r("ma1f"),r("qMld"),r("8MXS"),r("Vx27"),r("ZcgO"),r("XJx5"),r("hCl0"),r("Ondo"),r("OUux"),r("ocJ8")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m){return function(e){function t(t){var r=e.call(this)||this;return r.controller=null,r.asyncGraphicsUpdates=!1,r.suspendResumeExtentMode="computed",r.slicePlaneEnabled=!1,r.supportsDraping=!0,r.overlayUpdating=!1,r.fullExtentInLocalViewSpatialReference=null,r.suspendResumeExtent=null,r._queryEngine=null,r._controllerCreated=!1,r.clippingExtent=null,r.supportsHeightUnitConversion=!0,r.pendingController=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.layer.isTable?this.addResolvingPromise(l.reject(new s("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer}))):(this._set("graphics3d",new v({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,asyncGraphicsUpdates:this.asyncGraphicsUpdates,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(t){return e.updateClippingExtent(t)}})),this.handles.add([this.watch("asyncGraphicsUpdates",function(t){e.graphics3d.graphicsCore.asyncUpdates=t}),this.watch("suspendResumeExtentMode",function(t){e.graphics3d.suspendResumeExtentMode=t})]),this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this.addResolvingPromise(this.graphics3d.setup().then(function(){return e.validateGeometryType()}).then(function(){return m.toViewIfLocal(e)}).then(function(t){return e.fullExtentInLocalViewSpatialReference=t}).then(function(){return e.initializeController()})),this.notifyChange("updating"))},t.prototype.destroy=function(){this.destroyPendingController(),this.controller&&(this.controller.destroy(),this.controller=null),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this.loadedGraphics=null,this._queryEngine&&this._queryEngine.destroy(),this._queryEngine=null},t.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)},Object.defineProperty(t.prototype,"drawingOrder",{set:function(e){this.graphics3d.graphicsCore.setDrawingOrder(e),this._set("drawingOrder",e)},enumerable:!0,configurable:!0}),t.prototype.getRenderingInfo=function(e,t){var r=p.getRenderingInfo(e,{renderer:t});if(r&&r.color){var n=r.color;n[0]=n[0]/255,n[1]=n[1]/255,n[2]=n[2]/255}return r},t.prototype.getGraphicFromGraphicUid=function(e){var t=this,r=null;return this.loadedGraphics&&this.loadedGraphics.forEach(function(n){n.uid===e&&(r=d.hydrateGraphic(n,t.layer))}),r},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0}),t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(e,t):null},t.prototype.whenSymbolLayerSize=function(e,t){return this.graphics3d?o.safeCast(this.graphics3d.graphicsCore.whenSymbolLayerSize(e,t)):null},t.prototype.queryFeatures=function(e){return this._queryEngine?this._queryEngine.queryFeatures(e):this._rejectQuery()},t.prototype.queryObjectIds=function(e){return this._queryEngine?this._queryEngine.queryObjectIds(e):this._rejectQuery()},t.prototype.queryFeatureCount=function(e){return this._queryEngine?this._queryEngine.queryFeatureCount(e):this._rejectQuery()},t.prototype.queryExtent=function(e){return this._queryEngine?this._queryEngine.queryExtent(e):this._rejectQuery()},t.prototype.highlight=function(e,t){return void 0===t&&(t={}),this.graphics3d.highlight(e,t,this.layer.objectIdField)},t.prototype.getStats=function(){var e=this.graphics3d.graphicsCore.getStats();return e.features=this.loadedGraphics.length,e.updating=this.updating,e.elevationUpdating=this.graphics3d.elevationAlignment.updating,e.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended,e.visibilityScale=!this.graphics3d.scaleVisibility.suspended,e},t.prototype.canResume=function(){return!(!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended)},t.prototype.isUpdating=function(){return!(!this.graphics3d||this.graphics3d.destroyed)&&(!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating||!this.view.basemapTerrain||!this.view.basemapTerrain.ready||this.graphics3d.updating)},t.prototype.initializeController=function(){return a(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,this.createController()];case 1:return e=t.sent(),this.pendingController=e,[4,e.when()];case 2:return t.sent(),this.setControllerWhenInitialized(e),[2]}})})},t.prototype.setControllerWhenInitialized=function(e){return a(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.when()];case 1:return t.sent(),[3,3];case 2:return t.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,c.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return t.sent(),this.pendingController=null,this.controller=e,this.loadedGraphics=e.graphics,this._queryEngine=new f({layer:this.layer,features:this.loadedGraphics,objectIdField:this.layer.objectIdField,dataSpatialReference:this.view.spatialReference}),this.notifyChange("updating"),[2]}})})},t.prototype.updateClippingExtent=function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}},t.prototype.validateGeometryType=function(){var e=this.layer;switch(e.geometryType){case"multipatch":case"multipoint":return l.reject(new s("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:e.geometryType}))}},t.prototype._rejectQuery=function(){return l.reject(new s("featurelayerview3d:query","Not ready to execute query"))},n([u.property()],t.prototype,"loadedGraphics",void 0),n([u.property({dependsOn:["graphics3d.suspended"]})],t.prototype,"suspended",void 0),n([u.property({dependsOn:["graphics3d.updating","controller.updating","overlayUpdating"]})],t.prototype,"updating",void 0),n([u.property()],t.prototype,"controller",void 0),n([u.property()],t.prototype,"graphics3d",void 0),n([u.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0),n([u.property({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),n([u.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),n([u.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),n([u.property({readOnly:!0,type:Boolean})],t.prototype,"supportsDraping",void 0),n([u.property({type:Boolean})],t.prototype,"overlayUpdating",void 0),n([u.property()],t.prototype,"drawingOrder",null),n([u.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}(u.declared(h))}.apply(null,n))||(e.exports=i)},"4p4v":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("PHan"),r("jBNx"),r("W9tT"),r("0LE5"),r("Rdxj"),r("JjCO")],void 0===(i=function(e,t,r,n,i,a,o,s){function l(e){return e?{origin:o.vec3f64.clone(e.origin),direction:o.vec3f64.clone(e.direction)}:{origin:o.vec3f64.create(),direction:o.vec3f64.create()}}function c(e,t,r){return void 0===r&&(r=l()),a.vec3.copy(r.origin,e),a.vec3.copy(r.direction,t),r}function u(e,t,r){void 0===r&&(r=l());var o=n.castRenderScreenPointArray3(i.vec2.copy(s.sv3d.get(),t));o[2]=0,e.unprojectPoint(o,r.origin);var c=n.castRenderScreenPointArray3(i.vec2.copy(s.sv3d.get(),t));c[2]=1;var u=e.unprojectPoint(c,s.sv3d.get());return a.vec3.subtract(r.direction,u,r.origin),r}function d(e,t,r){void 0===r&&(r=l()),a.vec3.copy(r.origin,e.eye);var n=a.vec3.set(s.sv3d.get(),t[0],t[1],1),i=e.unprojectPoint(n,s.sv3d.get());return a.vec3.subtract(r.direction,i,r.origin),r}function f(e,t){var r=a.vec3.cross(s.sv3d.get(),a.vec3.normalize(s.sv3d.get(),e.direction),a.vec3.subtract(s.sv3d.get(),t,e.origin));return a.vec3.dot(r,r)}function p(){return{origin:null,direction:null}}Object.defineProperty(t,"__esModule",{value:!0}),t.create=l,t.wrap=function(e,t){var r=h.get();return r.origin=e,r.direction=t,r},t.copy=function(e,t){return void 0===t&&(t=l()),c(e.origin,e.direction,t)},t.fromPoints=function(e,t,r){return void 0===r&&(r=l()),a.vec3.copy(r.origin,e),a.vec3.subtract(r.direction,t,e),r},t.fromValues=c,t.fromScreen=function(e,t,r){return void 0===r&&(r=l()),u(e,e.screenToRender(t,n.castRenderScreenPointArray3(s.sv3d.get())),r)},t.fromRender=u,t.fromScreenAtEye=function(e,t,r){return void 0===r&&(r=l()),d(e,e.screenToRender(t,n.castRenderScreenPointArray3(s.sv3d.get())),r)},t.fromRenderAtEye=d,t.distance2=f,t.distance=function(e,t){return Math.sqrt(f(e,t))},t.closestPoint=function(e,t,r){var n=a.vec3.dot(e.direction,a.vec3.subtract(r,t,e.origin));return a.vec3.add(r,e.origin,a.vec3.scale(r,e.direction,n)),r},t.createWrapper=p;var h=new r.ObjectStack(p)}.apply(null,n))||(e.exports=i)},"4ziW":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("0LE5"),r("vlC2"),r("Rdxj"),r("aWgr"),r("83/a"),r("AgDx"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a,o,s,l){var c,u,d,f,p=o.Vec3Compact;!function(e){for(var t=.5,r=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],n=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],i=[0,0,1,0,1,1,0,1],a=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],o=new Array(36),c=0;c<6;c++)for(var u=0;u<6;u++)o[6*c+u]=c;var d=new Array(36);for(c=0;c<6;c++)d[6*c+0]=0,d[6*c+1]=1,d[6*c+2]=2,d[6*c+3]=2,d[6*c+4]=3,d[6*c+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(24),c=0;c<8;c++)t[3*c]=r[c][0]*e[0],t[3*c+1]=r[c][1]*e[1],t[3*c+2]=r[c][2]*e[2];var u={};u[l.VertexAttrConstants.POSITION]=new Uint32Array(a),u[l.VertexAttrConstants.NORMAL]=new Uint32Array(o),u[l.VertexAttrConstants.UV0]=new Uint32Array(d);var f={};return f[l.VertexAttrConstants.POSITION]={size:3,data:t},f[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(n)},f[l.VertexAttrConstants.UV0]={size:2,data:new Float32Array(i)},new s(f,u)}}(c||(c={})),function(e){var t=.5,r=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],n=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],i=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],a=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(18),o=0;o<6;o++)t[3*o]=r[o][0]*e[0],t[3*o+1]=r[o][1]*e[1],t[3*o+2]=r[o][2]*e[2];var c={};c[l.VertexAttrConstants.POSITION]=new Uint32Array(i),c[l.VertexAttrConstants.NORMAL]=new Uint32Array(a);var u={};return u[l.VertexAttrConstants.POSITION]={size:3,data:t},u[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(n)},new s(u,c)}}(u||(u={})),function(e){var t=n.vec3f32.fromValues(-.5,0,-.5),i=n.vec3f32.fromValues(.5,0,-.5),a=n.vec3f32.fromValues(0,0,.5),o=n.vec3f32.fromValues(0,.5,0),c=n.vec3f32.create(),u=n.vec3f32.create(),d=n.vec3f32.create(),f=n.vec3f32.create(),p=n.vec3f32.create();r.vec3.subtract(c,t,o),r.vec3.subtract(u,t,i),r.vec3.cross(d,c,u),r.vec3.normalize(d,d),r.vec3.subtract(c,i,o),r.vec3.subtract(u,i,a),r.vec3.cross(f,c,u),r.vec3.normalize(f,f),r.vec3.subtract(c,a,o),r.vec3.subtract(u,a,t),r.vec3.cross(p,c,u),r.vec3.normalize(p,p);var h=[t,i,a,o],v=[0,-1,0,d[0],d[1],d[2],f[0],f[1],f[2],p[0],p[1],p[2]],m=[0,1,2,3,1,0,3,2,1,3,0,2],g=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Float32Array(12),r=0;r<4;r++)t[3*r]=h[r][0]*e[0],t[3*r+1]=h[r][1]*e[1],t[3*r+2]=h[r][2]*e[2];var n={};n[l.VertexAttrConstants.POSITION]=new Uint32Array(m),n[l.VertexAttrConstants.NORMAL]=new Uint32Array(g);var i={};return i[l.VertexAttrConstants.POSITION]={size:3,data:t},i[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(v)},new s(i,n)}}(d||(d={})),function(e){function t(e,t,n,i,a){return!(Math.abs(r.vec3.dot(t,e))>a||(r.vec3.cross(n,e,t),r.vec3.normalize(n,n),r.vec3.cross(i,n,e),r.vec3.normalize(i,i),0))}function f(e,r,n,i,a,o,s){return t(e,r,a,o,s)||t(e,n,a,o,s)||t(e,i,a,o,s)}e.createBoxGeometry=c.createGeometry,e.createDiamondGeometry=u.createGeometry,e.createTetrahedronGeometry=d.createGeometry,e.createSphereGeometry=function(e,t,r,n,i,a,o){e=e||50,n=void 0!==n?n:-Math.PI,i=void 0!==i?i:2*Math.PI,a=void 0!==a?a:.5*-Math.PI,o=void 0!==o?o:Math.PI;for(var c=Math.max(3,Math.floor(t)||8),u=Math.max(2,Math.floor(r)||6),d=(c+1)*(u+1),f=new Float32Array(3*d),p=new Float32Array(3*d),h=new Float32Array(2*d),v=[],m=0,g=0;g<=u;g++){for(var y=[],b=g/u,x=a+b*o,_=Math.cos(x),S=0;S<=c;S++){var w=S/c,C=n+w*i,P=Math.cos(C)*_,E=Math.sin(x),T=-Math.sin(C)*_;f[3*m]=P*e,f[3*m+1]=E*e,f[3*m+2]=T*e,p[3*m]=P,p[3*m+1]=E,p[3*m+2]=T,h[2*m]=w,h[2*m+1]=b,y.push(m),++m}v.push(y)}var O=new Uint32Array(2*c*(u-1)*3);for(m=0,g=0;g<u;g++)for(S=0;S<c;S++){var A=v[g][S],R=v[g][S+1],M=v[g+1][S+1],I=v[g+1][S];0===g?(O[m++]=A,O[m++]=M,O[m++]=I):g===u-1?(O[m++]=A,O[m++]=R,O[m++]=M):(O[m++]=A,O[m++]=R,O[m++]=M,O[m++]=M,O[m++]=I,O[m++]=A)}l.assert(m===O.length);var D={};D[l.VertexAttrConstants.POSITION]=O,D[l.VertexAttrConstants.NORMAL]=O,D[l.VertexAttrConstants.UV0]=O;var V={};return V[l.VertexAttrConstants.POSITION]={size:3,data:f},V[l.VertexAttrConstants.NORMAL]={size:3,data:p},V[l.VertexAttrConstants.UV0]={size:2,data:h},new s(V,D)},e.createPolySphereGeometry=function(e,t,r){function n(t,r){var n;t>r&&(t=(n=[r,t])[0],r=n[1]);var a=t.toString()+"."+r.toString();if(d[a])return d[a];var o=i.length;return i.length+=3,p.add(i,3*t,i,3*r,i,o),p.scale(i,o,e/p.length(i,o)),o/=3,d[a]=o,o}var i,a,o=e;if(r)i=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],a=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var c=o*(1+Math.sqrt(5))/2;i=[-o,c,0,o,c,0,-o,-c,0,o,-c,0,0,-o,c,0,o,c,0,-o,-c,0,o,-c,c,0,-o,c,0,o,-c,0,-o,-c,0,o],a=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var u=0;u<i.length;u+=3)p.scale(i,u,e/p.length(i,u));var d={};for(u=0;u<t;u++){for(var f=a.length,h=new Uint32Array(4*f),v=0;v<f;v+=3){var m=a[v],g=a[v+1],y=a[v+2],b=n(m,g),x=n(g,y),_=n(y,m),S=4*v;h[S]=m,h[S+1]=b,h[S+2]=_,h[S+3]=g,h[S+4]=x,h[S+5]=b,h[S+6]=y,h[S+7]=_,h[S+8]=x,h[S+9]=b,h[S+10]=x,h[S+11]=_}a=h,d={}}var w=new Float32Array(i);for(u=0;u<w.length;u+=3)p.normalize(w,u);var C={};C[l.VertexAttrConstants.POSITION]=a,C[l.VertexAttrConstants.NORMAL]=a;var P={};return P[l.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(i)},P[l.VertexAttrConstants.NORMAL]={size:3,data:w},new s(P,C)},e.createPointGeometry=function(e,t,r,n,i,a,o){var c=t?new Float64Array([t[0],t[1],t[2]]):new Float32Array([0,0,0]),u=e?new Float32Array([e[0],e[1],e[2]]):new Float32Array([0,0,1]),d=a?new Float32Array(a):new Float32Array([0,0]),f=r?new Uint8Array([255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]):new Uint8Array([255,255,255,255]),p=null!=n&&2===n.length?new Float32Array(n):new Float32Array([1,1]),h=new Uint32Array([0]),v={};v[l.VertexAttrConstants.POSITION]=h,v[l.VertexAttrConstants.NORMAL]=h,v[l.VertexAttrConstants.UV0]=h,v[l.VertexAttrConstants.COLOR]=h,v[l.VertexAttrConstants.SIZE]=h;var m={};if(m[l.VertexAttrConstants.POSITION]={size:3,data:c},m[l.VertexAttrConstants.NORMAL]={size:3,data:u},m[l.VertexAttrConstants.UV0]={size:d.length,data:d},m[l.VertexAttrConstants.COLOR]={size:4,data:f},m[l.VertexAttrConstants.SIZE]={size:2,data:p},null!=i){var g=new Float32Array([i[0],i[1],i[2],i[3]]);v[l.VertexAttrConstants.AUXPOS1]=h,m[l.VertexAttrConstants.AUXPOS1]={size:4,data:g}}if(null!=o){var y=new Float32Array([o[0],o[1],o[2],o[3]]);v[l.VertexAttrConstants.AUXPOS2]=h,m[l.VertexAttrConstants.AUXPOS2]={size:4,data:y}}return new s(m,v,s.DefaultOffsets,"point")},e.createPointArrayGeometry=function(e,t){for(var r=new Float32Array(3*e.length),n=new Float32Array(t?3*e.length:3),i=new Uint32Array(e.length),a=new Uint32Array(e.length),o=0;o<e.length;o++)r[3*o]=e[o][0],r[3*o+1]=e[o][1],r[3*o+2]=e[o][2],t&&(n[3*o]=t[o][0],n[3*o+1]=t[o][1],n[3*o+2]=t[o][2]),i[o]=o,a[o]=0;t||(n[0]=0,n[1]=1,n[2]=0);var c=new Float32Array(2);c[0]=0,c[1]=0;var u={};u[l.VertexAttrConstants.POSITION]=i,u[l.VertexAttrConstants.NORMAL]=t?i:a,u[l.VertexAttrConstants.UV0]=a;var d={};return d[l.VertexAttrConstants.POSITION]={size:3,data:r},d[l.VertexAttrConstants.NORMAL]={size:3,data:n},d[l.VertexAttrConstants.UV0]={size:2,data:c},new s(d,u,s.DefaultOffsets,"point")},e.createTriangleGeometry=function(){var e=new Float32Array([0,0,0,0,0,100,100,0,0]),t=new Uint32Array([0,1,2]),r=new Float32Array([0,1,0]),n=new Uint32Array([0,0,0]),i=new Float32Array([0,0]),a=new Uint32Array([0,0,0]),o={};o[l.VertexAttrConstants.POSITION]=t,o[l.VertexAttrConstants.NORMAL]=n,o[l.VertexAttrConstants.UV0]=a;var c={};return c[l.VertexAttrConstants.POSITION]={size:3,data:e},c[l.VertexAttrConstants.NORMAL]={size:3,data:r},c[l.VertexAttrConstants.UV0]={size:2,data:i},new s(c,o)},e.createSquareGeometry=function(e){var t=new Float32Array(12);if(e)for(var r=0;r<4;r++)for(var n=0;n<3;n++)t[3*r+n]=e[r][n];else t[0]=-1,t[1]=-1,t[2]=0,t[3]=1,t[4]=-1,t[5]=0,t[6]=1,t[7]=1,t[8]=0,t[9]=-1,t[10]=1,t[11]=0;var i=new Uint32Array([0,1,2,2,3,0]),a=new Float32Array([0,0,1]),o=new Uint32Array([0,0,0,0,0,0]),c=new Float32Array([0,0,1,0,1,1,0,1]),u=new Uint8Array([255,255,255,255]),d={};d[l.VertexAttrConstants.POSITION]=i,d[l.VertexAttrConstants.NORMAL]=o,d[l.VertexAttrConstants.UV0]=i,d[l.VertexAttrConstants.COLOR]=o;var f={};return f[l.VertexAttrConstants.POSITION]={size:3,data:t},f[l.VertexAttrConstants.NORMAL]={size:3,data:a},f[l.VertexAttrConstants.UV0]={size:2,data:c},f[l.VertexAttrConstants.COLOR]={size:4,data:u},new s(f,d)},e.createConeGeometry=function(e,t,r,i,a,o){void 0===a&&(a=!0),void 0===o&&(o=!0);var c=0,u=t,d=e,f=n.vec3f32.fromValues(0,c,0),p=n.vec3f32.fromValues(0,c+d,0),h=n.vec3f32.fromValues(0,-1,0),v=n.vec3f32.fromValues(0,1,0);i&&(c=d,p=n.vec3f32.fromValues(0,0,0),f=n.vec3f32.fromValues(0,c,0),h=n.vec3f32.fromValues(0,1,0),v=n.vec3f32.fromValues(0,-1,0));var m=[p,f],g=[h,v],y=r+2,b=Math.sqrt(d*d+u*u);if(i)for(var x=r-1;x>=0;x--){var _=x*(2*Math.PI/r),S=n.vec3f32.fromValues(Math.cos(_)*u,c,Math.sin(_)*u);m.push(S);var w=n.vec3f32.fromValues(d*Math.cos(_)/b,-u/b,d*Math.sin(_)/b);g.push(w)}else for(x=0;x<r;x++)_=x*(2*Math.PI/r),S=n.vec3f32.fromValues(Math.cos(_)*u,c,Math.sin(_)*u),m.push(S),w=n.vec3f32.fromValues(d*Math.cos(_)/b,u/b,d*Math.sin(_)/b),g.push(w);var C=new Uint32Array(2*(r+2)*3),P=new Uint32Array(2*(r+2)*3),E=0,T=0;if(a){for(x=3;x<m.length;x++)C[E++]=1,C[E++]=x-1,C[E++]=x,P[T++]=0,P[T++]=0,P[T++]=0;C[E++]=m.length-1,C[E++]=2,C[E++]=1,P[T++]=0,P[T++]=0,P[T++]=0}if(o){for(x=3;x<m.length;x++)C[E++]=x,C[E++]=x-1,C[E++]=0,P[T++]=x,P[T++]=x-1,P[T++]=1;C[E++]=0,C[E++]=2,C[E++]=m.length-1,P[T++]=1,P[T++]=2,P[T++]=g.length-1}var O=new Float32Array(3*y);for(x=0;x<y;x++)O[3*x]=m[x][0],O[3*x+1]=m[x][1],O[3*x+2]=m[x][2];var A=new Float32Array(3*y);for(x=0;x<y;x++)A[3*x]=g[x][0],A[3*x+1]=g[x][1],A[3*x+2]=g[x][2];var R={};R[l.VertexAttrConstants.POSITION]=C,R[l.VertexAttrConstants.NORMAL]=P;var M={};return M[l.VertexAttrConstants.POSITION]={size:3,data:O},M[l.VertexAttrConstants.NORMAL]={size:3,data:A},new s(M,R)},e.createCylinderGeometry=function(e,t,i,a,o,c){var u=a?n.vec3f32.clone(a):n.vec3f32.fromValues(1,0,0),d=o?n.vec3f32.clone(o):n.vec3f32.fromValues(0,0,0),f=void 0===c||c,p=n.vec3f32.create();r.vec3.normalize(p,u);var h=n.vec3f32.create();r.vec3.scale(h,p,Math.abs(e));var v=n.vec3f32.create();r.vec3.scale(v,h,-.5),r.vec3.add(v,v,d);var m=n.vec3f32.fromValues(0,1,0);Math.abs(1-r.vec3.dot(p,m))<.2&&r.vec3.set(m,0,0,1);var g=n.vec3f32.create();r.vec3.cross(g,p,m),r.vec3.normalize(g,g),r.vec3.cross(m,g,p);var y=2*i+(f?2:0),b=i+(f?2:0),x=new Float32Array(3*y),_=new Float32Array(3*b),S=new Float32Array(2*y),w=new Uint32Array(3*i*(f?4:2)),C=new Uint32Array(3*i*(f?4:2));f&&(x[3*(y-2)+0]=v[0],x[3*(y-2)+1]=v[1],x[3*(y-2)+2]=v[2],S[2*(y-2)]=0,S[2*(y-2)+1]=0,x[3*(y-1)+0]=x[3*(y-2)+0]+h[0],x[3*(y-1)+1]=x[3*(y-2)+1]+h[1],x[3*(y-1)+2]=x[3*(y-2)+2]+h[2],S[2*(y-1)]=1,S[2*(y-1)+1]=1,_[3*(b-2)+0]=-p[0],_[3*(b-2)+1]=-p[1],_[3*(b-2)+2]=-p[2],_[3*(b-1)+0]=p[0],_[3*(b-1)+1]=p[1],_[3*(b-1)+2]=p[2]);for(var P=function(e,t,r){w[e]=t,C[e]=r},E=0,T=n.vec3f32.create(),O=n.vec3f32.create(),A=0;A<i;A++){var R=A*(2*Math.PI/i);r.vec3.scale(T,m,Math.sin(R)),r.vec3.scale(O,g,Math.cos(R)),r.vec3.add(T,T,O),_[3*A+0]=T[0],_[3*A+1]=T[1],_[3*A+2]=T[2],r.vec3.scale(T,T,t),r.vec3.add(T,T,v),x[3*A+0]=T[0],x[3*A+1]=T[1],x[3*A+2]=T[2],S[2*A+0]=A/i,S[2*A+1]=0,x[3*(A+i)+0]=x[3*A+0]+h[0],x[3*(A+i)+1]=x[3*A+1]+h[1],x[3*(A+i)+2]=x[3*A+2]+h[2],S[2*(A+i)+0]=A/i,S[2*A+1]=1;var M=(A+1)%i;P(E++,A,A),P(E++,A+i,A),P(E++,M,M),P(E++,M,M),P(E++,A+i,A),P(E++,M+i,M)}if(f){for(A=0;A<i;A++)M=(A+1)%i,P(E++,y-2,b-2),P(E++,A,b-2),P(E++,M,b-2);for(A=0;A<i;A++)M=(A+1)%i,P(E++,A+i,b-1),P(E++,y-1,b-1),P(E++,M+i,b-1)}var I={};I[l.VertexAttrConstants.POSITION]=w,I[l.VertexAttrConstants.NORMAL]=C,I[l.VertexAttrConstants.UV0]=w;var D={};return D[l.VertexAttrConstants.POSITION]={size:3,data:x},D[l.VertexAttrConstants.NORMAL]={size:3,data:_},D[l.VertexAttrConstants.UV0]={size:2,data:S},new s(D,I)},e.createTubeGeometry=function(t,r,n,i,a){n=n||10,i=null==i||i,l.assert(t.length>1);for(var o=[],s=[],c=0;c<n;c++){o.push([0,-c-1,-(c+1)%n-1]);var u=c/n*2*Math.PI;s.push([Math.cos(u)*r,Math.sin(u)*r])}return e.createPathExtrusionGeometry(s,t,[[0,0,0]],o,i,a)},e.createPathExtrusionGeometry=function(e,t,o,c,u,d){void 0===d&&(d=n.vec3f32.fromValues(0,0,0));var p=e.length,v=new Float32Array(t.length*p*3+(6*o.length||0)),m=new Float32Array(t.length*p+(2*o.length||0)),g=new Float32Array(t.length*p*3+(o?6:0)),y=(t.length-1)*p*6+3*c.length*2,b=new Uint32Array(y),x=new Uint32Array(y),_=0,S=0,w=0,C=0,P=0,E=n.vec3f32.create(),T=n.vec3f32.create(),O=n.vec3f32.create(),A=n.vec3f32.create(),R=n.vec3f32.create(),M=n.vec3f32.create(),I=n.vec3f32.create(),D=i.vec3f64.create(),V=n.vec3f32.create(),L=n.vec3f32.create(),F=n.vec3f32.create(),B=n.vec3f32.create(),N=n.vec3f32.create(),U=a.plane.create();r.vec3.set(V,0,1,0),r.vec3.subtract(T,t[1],t[0]),r.vec3.normalize(T,T),u?(r.vec3.add(D,t[0],d),r.vec3.normalize(O,D)):r.vec3.set(O,0,0,1),f(T,O,V,V,R,O,h),r.vec3.copy(A,O),r.vec3.copy(B,R);for(var z=0;z<o.length;z++)r.vec3.scale(M,R,o[z][0]),r.vec3.scale(D,O,o[z][2]),r.vec3.add(M,M,D),r.vec3.add(M,M,t[0]),v[_++]=M[0],v[_++]=M[1],v[_++]=M[2],m[w++]=0;for(g[S++]=-T[0],g[S++]=-T[1],g[S++]=-T[2],z=0;z<c.length;z++)b[C++]=c[z][0]>0?c[z][0]:-c[z][0]-1+o.length,b[C++]=c[z][1]>0?c[z][1]:-c[z][1]-1+o.length,b[C++]=c[z][2]>0?c[z][2]:-c[z][2]-1+o.length,x[P++]=0,x[P++]=0,x[P++]=0;for(var j=o.length,G=o.length-1,H=0;H<t.length;H++){var k=!1;H>0&&(r.vec3.copy(E,T),H<t.length-1?(r.vec3.subtract(T,t[H+1],t[H]),r.vec3.normalize(T,T)):k=!0,r.vec3.add(L,E,T),r.vec3.normalize(L,L),r.vec3.add(F,t[H-1],A),a.plane.fromPositionAndNormal(t[H],L,U),a.plane.intersectRay(U,a.ray.wrap(F,E),D)?(r.vec3.subtract(D,D,t[H]),r.vec3.normalize(O,D),r.vec3.cross(R,L,O),r.vec3.normalize(R,R)):f(L,A,B,V,R,O,h),r.vec3.copy(A,O),r.vec3.copy(B,R)),u&&(r.vec3.add(D,t[H],d),r.vec3.normalize(N,D));for(var W=0;W<p;W++)if(r.vec3.scale(M,R,e[W][0]),r.vec3.scale(D,O,e[W][1]),r.vec3.add(M,M,D),r.vec3.normalize(I,M),g[S++]=I[0],g[S++]=I[1],g[S++]=I[2],m[w++]=u?r.vec3.dot(M,N):M[2],r.vec3.add(M,M,t[H]),v[_++]=M[0],v[_++]=M[1],v[_++]=M[2],!k){var q=(W+1)%p;b[C++]=j+W,b[C++]=j+p+W,b[C++]=j+q,b[C++]=j+q,b[C++]=j+p+W,b[C++]=j+p+q;for(var X=0;X<6;X++)x[P++]=b[C-6+X]-G}j+=p}var Y=t[t.length-1];for(z=0;z<o.length;z++)r.vec3.scale(M,R,o[z][0]),r.vec3.scale(D,O,o[z][1]),r.vec3.add(M,M,D),r.vec3.add(M,M,Y),v[_++]=M[0],v[_++]=M[1],v[_++]=M[2],m[w++]=0;var Q=S/3;g[S++]=T[0],g[S++]=T[1],g[S++]=T[2];var Z=j-p;for(z=0;z<c.length;z++)b[C++]=c[z][0]>=0?j+c[z][0]:-c[z][0]-1+Z,b[C++]=c[z][2]>=0?j+c[z][2]:-c[z][2]-1+Z,b[C++]=c[z][1]>=0?j+c[z][1]:-c[z][1]-1+Z,x[P++]=Q,x[P++]=Q,x[P++]=Q;var J={};J[l.VertexAttrConstants.POSITION]=b,J[l.VertexAttrConstants.NORMAL]=x;var K={};return K[l.VertexAttrConstants.POSITION]={size:3,data:v},K.zOffset={size:1,data:m},K[l.VertexAttrConstants.NORMAL]={size:3,data:g},new s(K,J)},e.createPolylineGeometry=function(e,t){l.assert(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),l.assert(3===e[0].length,"createPolylineGeometry(): malformed vertex"),l.assert(void 0===t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),l.assert(void 0===t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var r=new Float32Array(3*e.length),n=new Uint32Array(2*(e.length-1)),i=0,a=0,o=0;o<e.length;o++){for(var c=0;c<3;c++)r[i++]=e[o][c];o>0&&(n[a++]=o-1,n[a++]=o)}var u={},d={};if(u[l.VertexAttrConstants.POSITION]=n,d[l.VertexAttrConstants.POSITION]={size:3,data:r},t){var f=new Float32Array(3*t.length),p=0;for(o=0;o<e.length;o++)for(c=0;c<3;c++)f[p++]=t[o][c];u[l.VertexAttrConstants.NORMAL]=n,d[l.VertexAttrConstants.NORMAL]={size:3,data:f}}return new s(d,u,s.DefaultOffsets,"line")},e.createExtrudedTriangle=function(e,t,r,n){for(var i,a,o=new Float32Array(18),c=[[-t,0,n/2],[r,0,n/2],[0,e,n/2],[-t,0,-n/2],[r,0,-n/2],[0,e,-n/2]],u=0;u<6;u++)o[3*u]=c[u][0],o[3*u+1]=c[u][1],o[3*u+2]=c[u][2];var d=((i={})[l.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),i),f=((a={})[l.VertexAttrConstants.POSITION]={size:3,data:o},a);return new s(f,d)},e.transformInPlace=function(e,t){for(var n=e.vertexAttributes[l.VertexAttrConstants.POSITION].data,i=0;i<n.length;i+=3){var a=n[i],o=n[i+1],s=n[i+2];r.vec3.set(v,a,o,s),r.vec3.transformMat4(v,v,t),n[i]=v[0],n[i+1]=v[1],n[i+2]=v[2]}},e.addVertexColors=function(e,t){var r=t||[1,1,1,1],n=new Uint8Array(4);n[0]=255*r[0],n[1]=255*r[1],n[2]=255*r[2],n[3]=255*(r.length>3?r[3]:1);var i={},a=e.getVertexAttr();for(var o in a)i[o]=a[o];i[l.VertexAttrConstants.COLOR]={size:4,data:n};var c={};for(var o in e.indices)c[o]=e.indices[o];var u=c[l.VertexAttrConstants.POSITION].length;return c[l.VertexAttrConstants.COLOR]=new Uint32Array(u),new s(i,c,e.componentOffsets,e.primitiveType)},e.addNormals=function(e){for(var t=e.getVertexAttr(),n=e.indices,i=o.Vec3Compact.subtract,a=n.position.length/3,s=new Float32Array(3*a),c=t.position.data,u=0,d=n.position,f=new Uint32Array(d.length),p=0;p<d.length;p+=3){i(c,3*d[p],c,3*d[p+2],m,0),i(c,3*d[p],c,3*d[p+1],v,0),r.vec3.cross(v,v,m),r.vec3.normalize(v,v);var h=u/3;s[u++]=v[0],s[u++]=v[1],s[u++]=v[2],f[p]=h,f[p+1]=h,f[p+2]=h}t[l.VertexAttrConstants.NORMAL]={size:3,data:s,offsetIdx:0,strideIdx:3},n[l.VertexAttrConstants.NORMAL]=f},e.cgToGIS=function(e,t){void 0===t&&(t=e);var r=e.getVertexAttr(),n=r.position.data,i=r.normal.data,a=t.getVertexAttr(),o=a.position.data,s=a.normal.data;if(i)for(var l=0;l<i.length;l+=3){var c=i[l+1];s[l+1]=-i[l+2],s[l+2]=c}if(n)for(l=0;l<n.length;l+=3)c=n[l+1],o[l+1]=-n[l+2],o[l+2]=c;return t},e.makeOrthoBasisDirUp=t,e.makeOrthoBasisDirUpFallback=f}(f||(f={}));var h=.99619469809,v=n.vec3f32.create(),m=n.vec3f32.create();return f}.apply(null,n))||(e.exports=i)},"51bw":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xf8T")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.mat3f64=r}.apply(null,n))||(e.exports=i)},"55f2":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.encodeSymbolColor=function(e,t,a,o){if(void 0===o&&(o=0),null==e||"ignore"===t)return a[o+0]=255,a[o+1]=255,a[o+2]=255,void(a[o+3]=255);a[o+0]=Math.floor(255*e[0]),a[o+1]=Math.floor(255*e[1]),a[o+2]=Math.floor(255*e[2]);var s=Math.floor(e[3]*r);a[o+3]=0===s?0:"tint"===t?s:"replace"===t?s+n:s+i},t.decodeSymbolColor=function(e,t){void 0===t&&(t=0);var a=0,o="multiply",s=e[t+3];return s>i?a=(s-i)/r:s>n?(a=(s-n)/r,o="replace"):s>0&&(a=s/r,o="tint"),{color:[e[t+0]/255,e[t+1]/255,e[t+2]/255,a],colorMixMode:o}},t.isOpaqueSymbolColor=function(e,t){void 0===t&&(t=0);var r=e[t+3];return r===n||r===i||r===a};var r=85,n=r,i=2*r,a=3*r}.apply(null,n))||(e.exports=i)},"5PWn":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("HZ3d"),r("Q2wQ"),r("2Atf"),r("idNY"),r("zp6E"),r("ma1f"),r("qMld"),r("jfWY")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e){this.streamDataSupplier=e}return e.prototype.loadJson=function(e){return r(this,void 0,void 0,function(){return n(this,function(t){return[2,this.load("json",e)]})})},e.prototype.loadBinary=function(e){return r(this,void 0,void 0,function(){return n(this,function(t){return c.isDataProtocol(e)?[2,c.dataToArrayBuffer(e)]:[2,this.load("binary",e)]})})},e.prototype.loadImage=function(e){return r(this,void 0,void 0,function(){return n(this,function(t){return[2,this.load("image",e)]})})},e.prototype.load=function(e,t){return r(this,void 0,void 0,function(){var r,i=this;return n(this,function(n){switch(n.label){case 0:return this.streamDataSupplier?(r=this.streamDataSupplier.request(t,e),[2,l.create(function(e,t){r.then(function(t){e(t.data)},function(e){t(e instanceof a?e:new s("","Request for resource failed: "+e))})},function(){i.streamDataSupplier.cancelRequest(r)})]):[4,o(t,d[e])];case 1:return[2,n.sent().data]}})})},e}();t.DefaultLoadingContext=u;var d={image:{responseType:"image"},binary:{responseType:"array-buffer"},json:void 0}}.apply(null,n))||(e.exports=i)},"5iSs":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,r){this.items.push({type:"renderGeometry",highlightId:t,renderGeometry:e,owner:r})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.highlightId===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"object"===r.type&&r.object===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"renderGeometry"===r.type&&r.renderGeometry===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.owner.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,n))||(e.exports=i)},"6wId":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9pvv")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.pluginContext=e,this.pluginsChanged=!1,this.renderPlugins=new Array,this.slots=[];for(var t=0;t<19;++t)this.slots[t]=[]}return e.prototype.add=function(e,t){this.renderPlugins.push(t);for(var r=0;r<e.length;++r){var n=e[r];this.slots[n].push(t)}t.initializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.remove=function(e){this.renderPlugins=this.renderPlugins.filter(function(t){return t!==e});for(var t=0;t<this.slots.length;++t)this.slots[t]=this.slots[t].filter(function(t){return t!==e});e.uninitializeRenderContext(this.pluginContext),this.pluginsChanged=!0},e.prototype.prepareRender=function(e){for(var t=0,r=this.renderPlugins;t<r.length;t++){var n=r[t];n.prepareRender&&n.prepareRender(e)}},e.prototype.render=function(e,t){t.slot=e;for(var r=!1,n=0,i=this.slots[e];n<i.length;n++){var a=i[n];a.render(t)&&(a.didRender=!0,r=!0)}return r},e.prototype.queryDepthRange=function(e){var t=i;t.near=1/0,t.far=-1/0;for(var n=0,a=this.renderPlugins;n<a.length;n++){var o=a[n];if(o.queryDepthRange){var s=o.queryDepthRange(e);s&&r.union(t,s,t)}}return t},e.prototype.needsRender=function(){if(this.pluginsChanged)return!0;for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsRender)return!0;return!1},e.prototype.needsHighlight=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsHighlight)return!0;return!1},e.prototype.needsLinearDepth=function(){for(var e=0,t=this.renderPlugins;e<t.length;e++)if(t[e].needsLinearDepth)return!0;return!1},e.prototype.resetNeedsRender=function(){this.pluginsChanged=!1;for(var e=0,t=this.renderPlugins;e<t.length;e++){var r=t[e];r.resetNeedsRender?r.resetNeedsRender():r.didRender&&(r.needsRender=!1,r.didRender=!1)}},e}();t.RenderPluginManager=n;var i={near:0,far:0}}.apply(null,n))||(e.exports=i)},"700l":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xdHJ"),r("Ytki")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this._fieldDataCache=new r.default,this._returnDistinctMap=new r.default,this.returnDistinctValues=e.returnDistinctValues,this.fieldsMap=t;var i=e.outFields;if(i&&-1===i.indexOf("*")){this.outFields=i;for(var a=0,o=0,s=i;o<s.length;o++){var l=s[o],c=n.getExpressionFromFieldName(l),u=this.fieldsMap.has(c),d=u?null:n.getWhereClause(c),f=u?this.fieldsMap.get(l).name:n.getAliasFromFieldName(l)||"FIELD_EXP_"+a++;this._fieldDataCache.set(l,{alias:f,clause:d})}}}return e.prototype.getAttributes=function(e){var t=e.attributes;return t=this._processAttributesForOutFields(t),this._processAttributesForDistinctValues(t)},e.prototype.getFieldValue=function(e,t){var r=e.attributes,i=this.fieldsMap.has(t),a=i?this.fieldsMap.get(t).name:t,o=null;return this._fieldDataCache.has(a)?o=this._fieldDataCache.get(a).clause:i||(o=n.getWhereClause(t),this._fieldDataCache.set(a,{alias:a,clause:o})),i?r[a]:o.calculateValue(r)},e.prototype.validateItem=function(e,t){return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:n.getWhereClause(t)}),this._fieldDataCache.get(t).clause.testFeature(e.attributes)},e.prototype.validateItems=function(e,t){var r=this;this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:n.getWhereClause(t)});var i=e.map(function(e){return r.getAttributes(e)});return this._fieldDataCache.get(t).clause.testSet(i)},e.prototype._processAttributesForOutFields=function(e){var t=this.outFields;if(!e||!t||!t.length)return e;for(var r={},n=0,i=t;n<i.length;n++){var a=i[n],o=this._fieldDataCache.get(a),s=o.alias,l=o.clause;r[s]=l?l.calculateValue(e):e[s]}return r},e.prototype._processAttributesForDistinctValues=function(e){if(!e||!this.returnDistinctValues)return e;var t=this.outFields,r=[];if(t)for(var n=0,i=t;n<i.length;n++){var a=i[n],o=this._fieldDataCache.get(a).alias;r.push(e[o])}else for(var o in e)r.push(e[o]);var s=(t||["*"]).join(",")+"="+r.join(","),l=this._returnDistinctMap.get(s)||0;return this._returnDistinctMap.set(s,++l),l>1?null:e},e}();t.default=i}.apply(null,n))||(e.exports=i)},"763n":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("QDcU"),r("pcDC"),r("LxLY"),r("jBNx"),r("O7NG")],void 0===(i=function(e,t,r,n,i,a,o){function s(e){return e&&e.enabled&&e.edges||null}function l(e,t,s){if(i.isNone(t))return null;var l=o.vec4f64.fromArray(r.toUnitRGBA(t.color)),c=s.opacity;switch(t.type){case"solid":return e.createSolidEdgeMaterial({color:l,size:a.pt2px(t.size),extensionLength:a.pt2px(t.extensionLength),opacity:c});case"sketch":return e.createSketchEdgeMaterial({color:l,size:a.pt2px(t.size),extensionLength:a.pt2px(t.extensionLength),opacity:c});default:n.neverReached(t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.createMaterial=function(e,t,r){return l(e,s(t),r)},t.createMaterialFromEdges=l}.apply(null,n))||(e.exports=i)},"7eim":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.splitURI=function(e){var t,r;return e.replace(/^(.*\/)?([^\/]*)$/,function(e,n,i){return t=n||"",r=i||"",""}),{dirPart:t,filePart:r}}}.apply(null,n))||(e.exports=i)},"7laH":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}}.apply(null,n))||(e.exports=i)},"8fHt":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("HZ3d"),r("Q2wQ"),r("rusB"),r("jmRc"),r("BIt0"),r("Fsr7"),r("W7eI"),r("HSGS"),r("kfwU")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u){return function(){function e(){this.regularWriter=new c.RegularEdgeBufferWriter,this.silhouetteWriter=new c.SilhouetteEdgeBufferWriter}return e.prototype.process=function(e,t){return r(this,void 0,void 0,function(){var r,i,a;return n(this,function(n){switch(n.label){case 0:return t?(r=new Array,i=this.packInput(e,r),this.wrappedWork,[4,t.invoke("wrappedWork",i,{transferList:r})]):[3,2];case 1:return a=n.sent(),[2,this.unpackOutput(a)];case 2:return[2,this.work(e)]}})})},e.prototype.wrappedWork=function(e){return r(this,void 0,void 0,function(){var t,r,i;return n(this,function(n){return t=this.unpackInput(e),r=this.work(t),i=new Array,this.packInputTransferables(t,i),[2,{result:this.packOutput(r,i),transferList:i}]})})},e.prototype.work=function(e){var t=this.extractEdgeInformation(e.data,e.skipDeduplicate,e.originalIndices);return this.regularWriter.updateSettings(e.writerSettings),this.silhouetteWriter.updateSettings(e.writerSettings),u.extractEdges(t,this.regularWriter,this.silhouetteWriter)},e.prototype.packInputTransferables=function(e,t){t.push(e.data.buffer)},e.prototype.packInput=function(e,t){this.packInputTransferables(e,t);var r={dataBuffer:e.data.buffer,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate};return e.originalIndices&&(r.originalIndicesBuffer=e.originalIndices.buffer,r.originalIndicesType=i.isUint32Array(e.originalIndices)?"Uint32Array":"Uint16Array"),r},e.prototype.unpackInput=function(e){return{data:l.EdgeInputBufferLayout.createView(e.dataBuffer),originalIndices:"Uint32Array"===e.originalIndicesType?new Uint32Array(e.originalIndicesBuffer):"Uint16Array"===e.originalIndicesType?new Uint16Array(e.originalIndicesBuffer):void 0,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}},e.prototype.packOutput=function(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:s.packInterleavedBuffer(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:s.packInterleavedBuffer(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}},e.prototype.unpackOutput=function(e){return{regular:{instancesData:s.unpackInterleavedBuffer(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:s.unpackInterleavedBuffer(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}},e.prototype.extractEdgeInformation=function(e,t,r){if(t&&r)return{faces:r,neighbors:i=o.computeNeighbors(r,e.count),vertices:e};var n=a.default(e.buffer,e.stride/4,r),i=o.computeNeighbors(n.indices,n.uniqueCount);return{faces:n.indices,neighbors:i,vertices:l.EdgeInputBufferLayout.createView(n.buffer)}},e}()}.apply(null,n))||(e.exports=i)},"8nmy":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qsST"),r("CIy2"),r("Zp3t")],void 0===(i=function(e,t,r,n,i){var a=r.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),o=function(){function e(e,t,r,n){this.NUM_PARALLEL=8,this._fallbackTexture=null,this._fallbackTextureTransparent=null,this.textures=e,this._programRepository=t,this.getViewportToRestore=r,this._rctx=n,this.NUM_PARALLEL=8,this.id2textureRef={},this.loading={},this._queue=[],this.listeners=[],this.afExt=n.capabilities.textureFilterAnisotropic,this.maxMaxAnisotropy=this.afExt?n.parameters.maxMaxAnisotropy:1,this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy),this._needsRender=!0,this._fallbackTextureData=new Uint8Array(256),this._fallbackTextureTransparentData=new Uint8Array(256);for(var i=0;i<this._fallbackTextureData.length;++i)this._fallbackTextureData[i]=255,this._fallbackTextureTransparentData[i]=(i+1)%4!=0?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}return e.prototype.resetNeedsRender=function(){this._needsRender=!1},e.prototype.needsRender=function(){return this._needsRender},e.prototype.aquire=function(t,r,i){var o=this,s=this.id2textureRef[t];if(null==s){var l=this.textures[t];n.assert(void 0!==l),l.setUnloadFunc(this._unload.bind(this));var c=!0===r,u=this._createGLTextureDescription(l);if(s=new e.TextureRef(null),n.assert(null==this.id2textureRef[t]),this.id2textureRef[t]=s,l.initializeThroughRender){var d=l.initializeThroughRender(this._rctx,u);s.setGLTexture(d),i&&i(s)}else if(l.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(t,u,i):this._queue.push([t,u,i]);else try{l.initializeThroughUpload(this._rctx,u,this._programRepository,this.getViewportToRestore(),function(e){s.setGLTexture(e),o._needsRender=!0,i&&i(s)})}catch(e){a.error("#aquire","Error loading texture: "+e.toString())}null==s.getGLTexture()&&s.setGLTexture(c?this.fallbackTextureTransparent:this.fallbackTexture),this._needsRender=!0}return s.incRefCnt(),s},e.prototype.release=function(e){var t=this.id2textureRef[e];void 0!==t&&(t.decRefCnt(),n.assert(t.getRefCnt()>=0))},e.prototype.getLoadingCount=function(){return Object.keys(this.loading).length},e.prototype.getTexture=function(e){return this.textures[e]},e.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy},e.prototype._unload=function(e){var t=this.id2textureRef[e];if(void 0!==t){var r=t.getGLTexture();r&&r.dispose(),delete this.id2textureRef[e]}this.next(e)},e.prototype._createGLTextureDescription=function(e){var t=e.params&&e.params.wrap;return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&e.params&&e.params.mipmap&&!e.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:t}},e.prototype.next=function(e){if(e in this.loading){delete this.loading[e];var t=Object.keys(this.id2textureRef),r=Object.keys(this.loading);this.listeners.forEach(function(n){n(e,t,r)}),this.processQueue()}},e.prototype._loadImage=function(e,t,r){var i=this;n.assert(null==this.loading[e]),this.loading[e]=!0;var a=this.textures[e];n.assert(void 0!==a),setTimeout(function(){var n=i.id2textureRef[e];n&&n.getRefCnt()&&a.initializeThroughUpload(i._rctx,t,i._programRepository,i.getViewportToRestore(),function(t){i.next(e),i._needsRender=!0,n&&n.getRefCnt()&&(n.setGLTexture(t),r&&r(n))})},0)},e.prototype.processQueue=function(){for(var e=[],t=0;t<this._queue.length;++t){var r=this._queue[t][0],n=this.id2textureRef[r];void 0!==n&&(0===n.getRefCnt()?(n.getGLTexture().dispose(),delete this.id2textureRef[r]):e.push(this._queue[t]))}this._queue=e;var i=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(t=0;t<i;++t)this._loadImage(this._queue[t][0],this._queue[t][1],this._queue[t][2]);this._queue.splice(0,i)},Object.defineProperty(e.prototype,"fallbackTexture",{get:function(){return this._fallbackTexture||(this._fallbackTexture=new i(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData)),this._fallbackTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fallbackTextureTransparent",{get:function(){return this._fallbackTextureTransparent||(this._fallbackTextureTransparent=new i(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData)),this._fallbackTextureTransparent},enumerable:!0,configurable:!0}),e}();return function(e){var t=function(){function e(e){this._glTexture=null,this._refCount=0,this._glTexture=e}return e.prototype.incRefCnt=function(){++this._refCount},e.prototype.decRefCnt=function(){--this._refCount,n.assert(this._refCount>=0)},e.prototype.getRefCnt=function(){return this._refCount},e.prototype.setGLTexture=function(e){this._glTexture=e},e.prototype.getGLTexture=function(){return this._glTexture},e}();e.TextureRef=t}(o||(o={})),o}.apply(null,n))||(e.exports=i)},"9DjX":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("jZlN"),r("LxLY"),r("YX1r"),r("51bw"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("2fXB"),r("O7NG"),r("aWgr"),r("2eYJ"),r("ZJC8")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h){function v(e,t){return n.isNone(e)||null==e.layerUid?null:n.isSome(t.graphicsView)&&e.layerUid===t.graphicsView.mockLayerId?t.graphics:t.map.findLayerByUid(e.layerUid)}function m(e,t,r){if(n.isNone(e))return null;var i=v(e,t);if(n.isNone(i))return null;if(i===t.graphics)return n.isSome(t.graphicsView)?n.expect(t.graphicsView.getGraphicFromGraphicUid(e.graphicUid)):null;var a=t.allLayerViews.find(function(e){return e.layer===i});return a?g(a,e,r):null}function g(e,t,r){return!e||e.suspended?null:n.isSome(r)&&"getGraphicFromStageObject"in e?e.getGraphicFromStageObject(r.obj,r.triangleNr):"getGraphicFromGraphicUid"in e&&null!=t.graphicUid?e.getGraphicFromGraphicUid(t.graphicUid):null}function y(e,t){var r=e.metadata.layerUid;return null!=r?t.map.findLayerByUid(r):null}function b(e,t){var n=t.computeMapPointFromVec3d(e.point),i=new r(n),a=e.metadata.layerUid;if(null!=a){var o=t.map.findLayerByUid(a);i.layer=o,i.sourceLayer=o}return i}Object.defineProperty(t,"__esModule",{value:!0}),t.sliceFilterPredicate=function(e){return function(t,r,n){return l.vec3.lerp(P,t,r,n),!p.extrusionContainsPoint(e,P)}};var x=function(){this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.storeTerrainResults=!0,this.storeAll=!0};t.EnableIntersectorOptions=x;var _=function(){function e(){this._transform=s.mat4f64.create(),this._transformInverse=new S({value:this._transform},o.mat4.invert,s.mat4f64.create),this._transformInverseTranspose=new S(this._transformInverse,o.mat4.transpose,s.mat4f64.create),this._transformTranspose=new S({value:this._transform},o.mat4.transpose,s.mat4f64.create),this._transformInverseRotation=new S({value:this._transform},i.mat3.normalFromMat4Legacy,a.mat3f64.create)}return e.prototype.invalidateLazyTransforms=function(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()},Object.defineProperty(e.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0}),e.prototype.setTransformMatrix=function(e){o.mat4.copy(this._transform,e)},e.prototype.multiplyTransform=function(e){o.mat4.multiply(this._transform,this._transform,e)},e.prototype.set=function(e){o.mat4.copy(this._transform,e),this.invalidateLazyTransforms()},e.prototype.setAndInvalidateLazyTransforms=function(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this.invalidateLazyTransforms()},e}();t.IntersectorTransform=_;var S=function(){function e(e,t,r){this.original=e,this.update=t,this.dirty=!0,this.transform=r()}return e.prototype.invalidate=function(){this.dirty=!0},Object.defineProperty(e.prototype,"value",{get:function(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform},enumerable:!0,configurable:!0}),e}(),w=function(){function e(){this.min=new C,this.max=new C,this.hud=new C,this.terrain=new C}return e.prototype.init=function(e){this.min.init(e),this.max.init(e),this.hud.init(e),this.terrain.init(e),this.all=[]},e}();t.IntersectorResults=w;var C=function(){function e(e){this.normal=c.vec3f64.create(),this.transformation=s.mat4f64.create(),this._ray=f.ray.create(),this.init(e)}return Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return l.vec3.scale(E,this.ray.direction,this.dist),l.vec3.length(E)},enumerable:!0,configurable:!0}),e.prototype.getIntersectionPoint=function(e){return!!this.hasIntersectionPoint&&(l.vec3.scale(E,this.ray.direction,this.dist),l.vec3.add(e,this.ray.origin,E),!0)},e.prototype.getTransformedNormal=function(e){return l.vec3.copy(T,this.normal),T[3]=0,u.vec4.transformMat4(T,T,this.transformation),l.vec3.copy(e,T),l.vec3.normalize(e,e),e},e.prototype.set=function(e,t,r,n,i,a,s,u,d,f){e instanceof h&&(e={type:"stage",obj:e}),this.dist=r,l.vec3.copy(this.normal,n),o.mat4.copy(this.transformation,i),this.target=e,this.name=t,this.drapedLayerOrder=a,this.center=s?c.vec3f64.clone(s):null,this.geometryId=u,this.triangleNr=d,this.drapedLayerGraphicOrder=f},e.prototype.copyFrom=function(e){f.ray.copy(e._ray,this._ray),this.dist=e.dist,this.target=e.target,this.name=e.name,this.drapedLayerOrder=e.drapedLayerOrder,this.center=e.center?c.vec3f64.clone(e.center):null,this.geometryId=e.geometryId,this.triangleNr=e.triangleNr,this.intersector=e.intersector,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,l.vec3.copy(this.normal,e.normal),o.mat4.copy(this.transformation,e.transformation)},e.prototype.init=function(e){this.dist=void 0,this.target=void 0,this.name=void 0,this.drapedLayerOrder=void 0,this.drapedLayerGraphicOrder=void 0,this.center=null,this.geometryId=null,this.triangleNr=null,this.intersector="Stage",e?f.ray.copy(e,this._ray):this._ray=f.ray.create()},e.prototype.toOwner=function(e){if(!this.target)return null;switch(this.target.type){case"stage":return v(this.target.obj.getMetadata(),e);case"external":switch(this.intersector){case"PointRenderer":return y(this.target,e);case"LodRenderer":case"DrapedRenderer":return v(this.target.metadata,e);case"TerrainRenderer":return e.map&&e.map.ground}}return null},e.prototype.toGraphic=function(e){if(!this.target)return null;switch(this.target.type){case"stage":var t=this.target.obj,r=this.triangleNr;return m(t.getMetadata(),e,{obj:t,triangleNr:r});case"external":switch(this.intersector){case"PointRenderer":return b(this.target,e);case"LodRenderer":case"DrapedRenderer":return m(this.target.metadata,e,null)}}return null},e}();t.IntersectorResult=C,t.TERRAIN_ID="terrain";var P=c.vec3f64.create(),E=c.vec3f64.create(),T=d.vec4f64.create()}.apply(null,n))||(e.exports=i)},"9FJH":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("EiD/"),r("tUyH"),r("s6rJ")],void 0===(i=function(e,t,r,n,i,a){return function(e){function t(t,r,n,i,o,s){void 0===s&&(s=!1);var l=e.call(this,t,r)||this;return l.textureRep=n,l.textureId=i,l.initTransparent=s,l.glTextureRef=a.aquireIfNotUndefined(l.textureId,n,l.initTransparent),o&&(l.glTextureRefNormal=a.aquireIfNotUndefined(o,n,l.initTransparent)),l}return r(t,e),t.prototype.dispose=function(){a.releaseIfNotUndefined(this.textureId,this.textureRep)},t.prototype.updateTexture=function(e){e!==this.textureId&&(a.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=e,this.glTextureRef=a.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))},t.prototype.bindTexture=function(e,t){null!=this.glTextureRef&&(t.setUniform1i("tex",n.DefaultTextureUnits.DIFFUSE),e.bindTexture(this.glTextureRef.getGLTexture(),n.DefaultTextureUnits.DIFFUSE),this.glTextureRefNormal&&(t.setUniform1i("texNormal",n.DefaultTextureUnits.NORMAL),e.bindTexture(this.glTextureRefNormal.getGLTexture(),n.DefaultTextureUnits.NORMAL)))},t.prototype.bindTextureSize=function(e,t){if(null!=this.glTextureRef){var r=this.glTextureRef.getGLTexture();t.setUniform2f("texSize",r.descriptor.width,r.descriptor.height)}},t.prototype.bindTextureScale=function(e,t){var r=this.glTextureRef&&this.glTextureRef.getGLTexture();r&&r.descriptor.textureCoordinateScaleFactor?t.setUniform2fv("textureCoordinateScaleFactor",r.descriptor.textureCoordinateScaleFactor):t.setUniform2f("textureCoordinateScaleFactor",1,1)},t}(i)}.apply(null,n))||(e.exports=i)},"9KSR":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("1m5D"),r("0LE5"),r("Rdxj"),r("AzkI"),r("mYMs")],void 0===(i=function(e,t,r,n,i,a,o,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t,r){var i=e.call(this,[0,0,0],1,{getCenter:function(e){var t=i._instanceData.view.boundingSphere,r=i._tmpCenter;return r[0]=t.get(e,0),r[1]=t.get(e,1),r[2]=t.get(e,2),r},getRadius:function(e){return i._instanceData.view.boundingSphere.get(e,3)}},{maximumDepth:25})||this;return i._tmpCenter=a.vec3f64.create(),i._tmpMat4=n.mat4f64.create(),i._instanceData=t,i._boundingSphere=r,i}return r(t,e),t.prototype.addInstance=function(e){var t=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4),n=i.vec3.transformMat4(this._tmpCenter,this._boundingSphere.center,r),a=this._boundingSphere.radius*o.maxScale(r);t.set(e,0,n[0]),t.set(e,1,n[1]),t.set(e,2,n[2]),t.set(e,3,a),this.add(e)},t.prototype.removeInstance=function(e){this.remove(e)},t}(s);t.InstanceOctree=l}.apply(null,n))||(e.exports=i)},"9Ros":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("QDcU"),r("rg9i"),r("qsST"),r("Vx27"),r("x+x8")],void 0===(i=function(e,t,r,n,i,a,o,s,l){var c=o.getLogger("esri.geometry.support.ValueMeshColor");return function(e){function t(t){var r=e.call(this)||this;return r.type="value",r.value=null,c.warn("esri/geometry/support/ValueMeshColor is deprecated since version 4.11. Use esri/Color instead."),r}var o;return r(t,e),o=t,t.prototype.clone=function(){return new o({value:a.clone(this.value)})},n([s.property()],t.prototype,"type",void 0),n([s.property({type:i})],t.prototype,"value",void 0),o=n([s.subclass("esri.geometry.support.ValueMeshColor")],t)}(s.declared(l.default))}.apply(null,n))||(e.exports=i)},"9YDZ":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("WRgd"),r("lRq4"),r("wPX3"),r("aWgr"),r("Mk25"),r("AzkI"),r("mmEe")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p){Object.defineProperty(t,"__esModule",{value:!0});var h=.5*Math.PI,v=h/Math.PI*180,m=h*c.earthRadius,g=.9*c.earthRadius,y=function(){function e(e){this.renderCoordsHelper=e.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:o.vec3f64.create(),direction:o.vec3f64.create()};for(var t=0;t<4;t++)this.extent[t]={origin:o.vec3f64.create(),direction:o.vec3f64.create(),cap:{next:null,direction:o.vec3f64.create()}},this.planes[t]=u.plane.create();this.planes[4]=u.plane.create(),this.planes[5]=u.plane.create(),this.planesWithoutFar=this.planes.slice(0,5)}return e.prototype.update=function(e,t,r,n){void 0===n&&(n=!0);var i=this.extent;this.toRenderBoundingExtent(e,t,r),a.vec3.add(this.center.origin,i[0].origin,i[2].origin),a.vec3.scale(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),n||a.vec3.scale(this.center.direction,this.center.direction,-1);for(var o=0;o<4;o++){var s=i[o];this.renderCoordsHelper.worldUpAtPosition(s.origin,s.direction);var l=i[3===o?0:o+1];s.cap.next=l.origin,f.directionFromTo(s.cap.direction,s.origin,l.origin),u.plane.fromVectorsAndPoint(s.direction,s.cap.direction,s.origin,this.planes[o]),n||a.vec3.scale(s.direction,s.direction,-1)}u.plane.fromVectorsAndPoint(i[0].cap.direction,i[1].cap.direction,i[0].origin,this.planes[4]),n?u.plane.negate(this.planes[4],this.planes[5]):(u.plane.copy(this.planes[4],this.planes[5]),u.plane.negate(this.planes[4],this.planes[4])),this.maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this.maxSpanSpatialReference=t},e.prototype.isVisibleInFrustum=function(e,t){if(void 0===t&&(t=!1),null==e)return!1;if("global"===this.renderCoordsHelper.type){var r=this.maxSpanSpatialReference.isWGS84?v:m;if(this.maxSpan>r)return!0;if(e.altitude>=g)return this.isVisibleInFrustumGlobal(e)}if(0===this.maxSpan){var n=this.extent[0];return!(t||!e.intersectsRay(u.ray.wrap(n.origin,n.direction)))}for(var i=0;i<this.extent.length;i++){n=this.extent[i];if(!t&&e.intersectsRay(u.ray.wrap(n.origin,n.direction)))return!0;if(e.intersectsLineSegment(u.lineSegment.fromPoints(n.origin,n.cap.next,C),n.cap.direction))return!0}var a=t?this.planes:this.planesWithoutFar;for(i=0;i<e.lines.length;i++){var o=e.lines[i];if(d.frustumLineSegment(a,o.origin,o.endpoint,o.direction))return!0}return!1},e.prototype.toRenderBoundingExtentGlobal=function(e,t,r){l.center(e,x),x[2]=r,p.computeLinearTransformation(t,x,_,this.renderCoordsHelper.spatialReference),n.mat4.invert(S,_),s.empty(w);for(var i=0,o=b;i<o.length;i++)for(var c=o[i],u=c.x0,d=c.x1,h=c.y0,v=c.y1,m=0;m<5;m++){var g=m/4;x[0]=f.lerp(e[u],e[d],g),x[1]=f.lerp(e[h],e[v],g),x[2]=r,p.vectorToVector(x,t,x,this.renderCoordsHelper.spatialReference),a.vec3.transformMat4(x,x,S),s.expandPointInPlace(w,x)}a.vec3.set(this.extent[0].origin,w[0],w[1],w[2]),a.vec3.set(this.extent[1].origin,w[3],w[1],w[2]),a.vec3.set(this.extent[2].origin,w[3],w[4],w[2]),a.vec3.set(this.extent[3].origin,w[0],w[4],w[2]);for(m=0;m<4;++m)a.vec3.transformMat4(this.extent[m].origin,this.extent[m].origin,_)},e.prototype.toRenderBoundingExtentLocal=function(e,t,r){a.vec3.set(this.extent[0].origin,e[0],e[1],r),a.vec3.set(this.extent[1].origin,e[2],e[1],r),a.vec3.set(this.extent[2].origin,e[2],e[3],r),a.vec3.set(this.extent[3].origin,e[0],e[3],r)},e.prototype.toRenderBoundingExtent=function(e,t,n){switch(this.renderCoordsHelper.type){case"global":this.toRenderBoundingExtentGlobal(e,t,n);break;case"local":this.toRenderBoundingExtentLocal(e,t,n);break;default:r.neverReached(this.renderCoordsHelper.type)}},e.prototype.isVisibleInFrustumGlobal=function(e){if(a.vec3.dot(this.center.direction,e.direction)<0)return!0;for(var t=0;t<4;t++){var r=this.extent[t];if(a.vec3.dot(r.direction,e.direction)<0)return!0}return!1},e}();t.FrustumExtentIntersection=y;var b=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],x=o.vec3f64.create(),_=i.mat4f64.create(),S=i.mat4f64.create(),w=s.create(),C=u.lineSegment.create();t.default=y}.apply(null,n))||(e.exports=i)},"9o4r":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("GntT")],void 0===(i=function(e,t,r){function n(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*o,u=0;u<s;++u)n[l]=a[c],n[l+1]=a[c+1],l+=i,c+=o}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=n,t.normalizeIntegerBuffer=function(e,t,i){var a=e.typedBuffer,o=e.typedBufferStride,s=t.typedBuffer,l=t.typedBufferStride,c=i?i.count:t.count,u=(i&&i.dstIndex?i.dstIndex:0)*o,d=(i&&i.srcIndex?i.srcIndex:0)*l;if(r.isInteger(t.elementType)){var f=r.maximumValue(t.elementType);if(r.isSigned(t.elementType))for(var p=0;p<c;++p)a[u]=Math.max(s[d]/f,-1),a[u+1]=Math.max(s[d+1]/f,-1),u+=o,d+=l;else for(p=0;p<c;++p)a[u]=s[d]/f,a[u+1]=s[d+1]/f,u+=o,d+=l}else n(e,t,i);return e}}.apply(null,n))||(e.exports=i)},"9pvv":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){return{near:e,far:t}}function n(e,t,r){return e.near=t,e.far=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.empty=function(e){return e?n(e,1/0,-1/0):r(1/0,-1/0)},t.set=n,t.union=function(e,t,r){return void 0===r&&(r=e),r.near=Math.min(e.near,t.near),r.far=Math.max(e.far,t.far),r}}.apply(null,n))||(e.exports=i)},"9v8t":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("Q2wQ"),r("HZ3d"),r("0LE5"),r("Rdxj"),r("WRgd"),r("lRq4"),r("BwdQ")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c){var u=function(){function e(e,t,r){this.type="draped",this.graphics3DSymbolLayer=e,this.renderGeometries=t,this.boundingBox=r,this.stage=null,this._visible=!1}return e.prototype.cachedSymbolSize=function(){return this.graphics3DSymbolLayer.getCachedSize()},e.prototype.initialize=function(e,t){this.stage=t},e.prototype.setVisibility=function(e){if(null!=this.stage)return this._visible!==e&&(this._visible=e,this._visible?this.stage.getDrapedRenderer().addRenderGeometries(this.renderGeometries):this.stage.getDrapedRenderer().removeRenderGeometries(this.renderGeometries),!0)},e.prototype.destroy=function(){this.stage&&this._visible&&this.stage.getDrapedRenderer().removeRenderGeometries(this.renderGeometries),this._visible=!1,this.stage=null},e.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(e,t){return Math.max(e,t.bsRadius)},0)},e.prototype.getCenterObjectSpace=function(e){return void 0===e&&(e=o.vec3f64.create()),a.vec3.set(e,0,0,0)},e.prototype.getBoundingBoxObjectSpace=function(e){return void 0===e&&(e=s.create()),s.empty(e)},e.prototype.addHighlight=function(e,t){var r=this;this.renderGeometries.forEach(function(n){var i=n.addHighlight(t);e.addRenderGeometry(n,i,r)}),this._visible&&this.stage.getDrapedRenderer().updateHighlights(this.renderGeometries)},e.prototype.removeHighlight=function(e){this.renderGeometries.forEach(function(t){e.removeRenderGeometry(t)})},e.prototype.removeRenderGeometryHighlight=function(e,t){e.removeHighlight(t),this._visible&&this.stage.getDrapedRenderer().updateHighlights(this.renderGeometries)},e.prototype.getProjectedBoundingBox=function(e,t,r,a){return i(this,void 0,void 0,function(){var i,o,l,u;return n(this,function(n){switch(n.label){case 0:for(s.empty(a),i=0;i<this.renderGeometries.length;i++)o=this.renderGeometries[i],this._getRenderGeometryProjectedBoundingRect(o,e,d,r),s.expand(a,d);if(!t)return[3,5];s.center(a,p),l=void 0,u=c.demResolutionForBoundingBox(a,t),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t.service.queryElevation(p[0],p[1],u)];case 2:return l=n.sent(),[3,4];case 3:return n.sent(),l=null,[3,4];case 4:null!=l&&(a[2]=Math.min(a[2],l),a[5]=Math.max(a[5],l)),n.label=5;case 5:return[2,a]}})})},e.prototype._getRenderGeometryProjectedBoundingRect=function(e,t,r,n){if(this.boundingBox)s.set(f,this.boundingBox);else{var i=e.center,a=e.bsRadius;f[0]=i[0]-a,f[1]=i[1]-a,f[2]=i[2]-a,f[3]=i[0]+a,f[4]=i[1]+a,f[5]=i[2]+a}return t(f,0,2),this.calculateRelativeScreenBounds&&n.push({location:s.center(f),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),s.toRect(f,r)},e}(),d=l.create(),f=s.create(),p=[0,0,0];return u}.apply(null,n))||(e.exports=i)},AASg:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){}return e.copyIntervals=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push([n[0],n[1]])}return t},e.convertFaceToIndexRange=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];n[0]=n[0]*t,n[1]=n[1]*t+(t-1)}},e.sortIntervals=function(e){return e.sort(function(e,t){return e[0]===t[0]?e[1]>t[1]?1:e[1]<t[1]?-1:0:e[0]>t[0]?1:e[0]<t[0]?-1:0})},e.intersectIntervals=function(e,t){if(e.length<=0)return[];for(var r=[],n=0;n<e.length;n++){var i=e[n];if(!(i[1]<t[0]||i[0]>t[1])){var a=[i[0],i[1]];a[0]<t[0]&&(a[0]=t[0]),a[1]>t[1]&&(a[1]=t[1]),r.push(a)}}return r},e.mergeIntervals=function(e){if(e.length<=0)return[];var t=[];e=this.sortIntervals(e),t.push(e[0]);for(var r=1;r<e.length;r++){var n=t[t.length-1];n[1]+1<e[r][0]?t.push(e[r]):n[1]<e[r][1]&&(n[1]=e[r][1],t.pop(),t.push(n))}return t},e.invertIntervals=function(e,t){for(var r=[],n=0,i=0;i<e.length;i++){var a=e[i];a[0]>n&&r.push([n,a[0]-1]),n=a[1]+1}return n<=t&&r.push([n,t]),r},e.offsetIntervals=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];r.push([i[0]+t,i[1]+t])}return r},e}()}.apply(null,n))||(e.exports=i)},AgDx:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("rjU6"),r("+nCE"),r("CIy2")],void 0===(i=function(e,t,r,n,i){function a(e){var t=i.getFirstObjectValue(e);return t.data.length/t.size}return function(){function e(t,i,o,s){void 0===i&&(i=e.DefaultIndices),void 0===o&&(o=e.DefaultOffsets),void 0===s&&(s="triangle"),this.preinterleaved=!1;var l={};for(var c in t){var u=t[c],d=u.data,f=u.size;l[c]={data:d,size:f,offsetIdx:0,strideIdx:f}}if(i===e.DefaultIndices){var p=a(l),h=n.generateDefaultIndexArray(p);for(var v in i={},l)i[v]=h}this._id=n.getNewId(),this._vertexAttributes=l,this._indices=i,this._componentOffsets=r.createOffsets(o),this._primitiveType=s}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){return i.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0}),e.prototype.getVertexAttr=function(){return this.vertexAttributes},e.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}},e.prototype.getIndices=function(e){return this._indices[e]},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){var e=0;if(this._indices.position){var t=3;e+=this._indices.position.length*t*4}if(this._indices.normal){t=3;e+=this._indices.normal.length*t*4}if(this._indices.uv0){t=2;e+=this._indices.uv0.length*t*4}if(this._indices.color){t=1;e+=this._indices.color.length*t*4}return e},e.DefaultIndices={},e.DefaultOffsets=new Uint32Array(0),e}()}.apply(null,n))||(e.exports=i)},B294:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("VfPl"),r("Zp3t")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.textureWidth=4096,this.dirty=!0,this.texture=new n(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1}),this.data=new r.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}return e.prototype.dispose=function(){this.texture.dispose(),this.texture=void 0,this.data=void 0},e.prototype.setData=function(e,t,r,n,i,a){var o=e*this.fieldCount+t;this.dirty=!0,this.data.set(o,0,r),this.data.set(o,1,n),this.data.set(o,2,i),this.data.set(o,3,a)},e.prototype.setDataElement=function(e,t,r,n){var i=e*this.fieldCount+t;this.dirty=!0,this.data.set(i,r,n)},e.prototype.resizeToFit=function(e){var t=e*this.fieldCount;if(t>=this.data.count){var n=Math.ceil((t+1)/this.textureWidth)*this.textureWidth,i=new r.BufferViewVec4u8(new ArrayBuffer(4*n));i.typedBuffer.set(this.data.typedBuffer),this.data=i}},e.prototype.updateTexture=function(){if(this.dirty){var e=this.texture.descriptor.width,t=this.texture.descriptor.height;this.data.count>e*t&&this.texture.resize(e,this.data.count/e),this.texture.setData(this.data.typedBuffer),this.dirty=!1}},e.prototype.bind=function(e,t){this.rctx.bindTexture(this.texture,t.unit),e.setUniform1i(t.texName,t.unit),e.setUniform2f(t.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)},e}();t.TextureBackedBuffer=i}.apply(null,n))||(e.exports=i)},B9tS:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("TMur"),r("Gtr7"),r("eIBl"),r("qsST"),r("8MXS"),r("Vx27"),r("Vt+U"),r("Lzvl"),r("+6sX"),r("/COu"),r("rfv1"),r("ZooB")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v){Object.defineProperty(t,"__esModule",{value:!0});var m=s.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),g=function(e){function t(t){var r=e.call(this)||this;return r._dirty=!1,r._querying=!1,r._handles=new o,r}return r(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"featureGeometryType",{get:function(){switch(this.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.geometryType;case"mesh":case"extent":return"polygon"}},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t){var r=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,e.layer.timeInfo&&(this._timeInfo=e.layer.timeInfo.toJSON()),this._scheduler=this._layerView.view.resourceController.scheduler,this._handles.add(this._scheduler.registerTask(4,function(e){return r._update(e)},function(){return r._needsUpdate()})),this._handles.add(l.on(t.owner,"loadedGraphics","change",function(e){return r._graphicsChanged(e)},function(){return r.dirty=!0}))},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null},t.prototype.clear=function(){this._queryEngine&&(this._queryEngine.destroy(),this._queryEngine=null,this._queryResult=null,this._store=null,this._querying=!1,this._core.forEachGraphics3DGraphic(function(e){return e.clearVisibilityFlag(2)})),this.dirty=!1,this.notifyChange("updating")},t.prototype._graphicsChanged=function(e){if(this._queryEngine){if(e.removed&&e.removed.length>0){for(var t=new Array(e.removed.length),r=0;r<e.removed.length;++r)t[r]=e.removed[r].uid;this._store.removeManyById(t)}if(e.added&&e.added.length>0){var n=new Array(e.added.length);for(r=0;r<e.added.length;++r)n[r]=this._convertToOptimizedFeature(e.added[r]);this._store.addMany(n),this.dirty=!0}}else this.dirty=!0},t.prototype.updateVisibility=function(e){this._queryEngine&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)},t.prototype.filterChanged=function(){this.dirty=!0},Object.defineProperty(t.prototype,"active",{get:function(){return this._layerView.filter&&this._core.owner.loadedGraphics.length>0},enumerable:!0,configurable:!0}),t.prototype._ensureQueryEngine=function(e){var t=this;if(!this.active)return this.clear(),!1;if(this._queryEngine)return!0;var r,n=this._core.owner.loadedGraphics,a=i.featureGeometryTypeKebabDictionary.toJSON(this.featureGeometryType),o=new Array(n.length),s=0;return n.forEach(function(e){o[++s]=t._convertToOptimizedFeature(e),r=r||e.geometry.spatialReference}),this._store=new h.default({geometryType:a,hasM:!1,hasZ:!1}),this._store.addMany(o),this._queryEngine=new v.default({hasZ:!1,hasM:!1,geometryType:a,fields:[],timeInfo:this._timeInfo,spatialReference:r,objectIdField:this._objectIdField,featureStore:this._store,scheduler:this._scheduler,priority:4}),e.madeProgress(),!0},t.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult},t.prototype._update=function(e){var t=this;if(this._ensureQueryEngine(e)){if(this._dirty&&!this._querying&&!e.done){this._querying=!0,this.dirty=!1;var r=this._layerView.filter?this._layerView.filter.toJSON():{};this._queryEngine.executeQueryForIdSet(r).then(function(e){t._queryResult=e,t._querying=!1}).catch(function(e){m.warn("FeatureFilter query failed: "+e),t._queryResult=new Set,t._core.forEachGraphics3DGraphic(function(e){return t._queryResult.add(t._getFeatureId(e.graphic)),!1}),t._querying=!1}),e.madeProgress()}this._queryResult&&!e.done&&(this._core.forEachGraphics3DGraphic(function(r){if(e.done)return!1;var n=t._queryResult.has(t._getFeatureId(r.graphic));return!!r.setVisibilityFlag(2,n,0)&&(e.madeProgress(),!0)}),e.done||(this._queryResult=null)),this.notifyChange("updating")}else this.dirty=!1},t.prototype._convertToOptimizedFeature=function(e){var t=e.geometry;if("mesh"===t.type||"extent"===t.type){var r=u.fromExtent("mesh"===t.type?t.extent:t);return r.hasZ=!1,r.hasM=!1,new p.default(f.convertFromGeometry(r),e.attributes,null,this._getFeatureId(e))}return f.convertFromFeature(e,d.getJsonType(e.geometry),!1,!1,this._objectIdField)},t.prototype._getFeatureId=function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId},Object.defineProperty(t.prototype,"dirty",{set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),n([c.property({readOnly:!0})],t.prototype,"updating",null),n([c.property({constructOnly:!0})],t.prototype,"geometryType",void 0),n([c.property({readOnly:!0,dependsOn:["geometryType"]})],t.prototype,"featureGeometryType",null),n([c.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],t)}(c.declared(a));t.Graphics3DFilterVisibility=g}.apply(null,n))||(e.exports=i)},BIt0:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.computeNeighbors=function(e,t){for(var r=e.length/3,n=new Uint32Array(t+1),i=new Uint32Array(t+1),a=function(e,t){e<t?n[e+1]++:i[t+1]++},o=0;o<r;o++){var s=e[3*o],l=e[3*o+1],c=e[3*o+2];a(s,l),a(l,c),a(c,s)}var u=0,d=0;for(o=0;o<t;o++){var f=n[o+1],p=i[o+1];n[o+1]=u,i[o+1]=d,u+=f,d+=p}var h=new Uint32Array(6*r),v=n[t],m=function(e,t,r){if(e<t){var a=n[e+1]++;h[2*a]=t,h[2*a+1]=r}else a=i[t+1]++,h[2*v+2*a]=e,h[2*v+2*a+1]=r};for(o=0;o<r;o++)s=e[3*o],l=e[3*o+1],c=e[3*o+2],m(s,l,o),m(l,c,o),m(c,s,o);var g=function(e,t){for(var r=2*e,n=t-e,i=1;i<n;i++){for(var a=h[r+2*i],o=h[r+2*i+1],s=i-1;s>=0&&h[r+2*s]>a;s--)h[r+2*s+2]=h[r+2*s],h[r+2*s+3]=h[r+2*s+1];h[r+2*s+2]=a,h[r+2*s+3]=o}};for(o=0;o<t;o++)g(n[o],n[o+1]),g(v+i[o],v+i[o+1]);var y=new Int32Array(3*r),b=function(t,r){return t===e[3*r]?0:t===e[3*r+1]?1:t===e[3*r+2]?2:-1},x=function(e,t){var r=b(e,t);y[3*t+r]=-1};for(o=0;o<t;o++){for(var _=n[o],S=n[o+1],w=i[o],C=i[o+1];_<S&&w<C;){var P=h[2*_];P===(E=h[2*v+2*w])?(function(e,t,r,n){var i=b(e,t);y[3*t+i]=n;var a=b(r,n);y[3*n+a]=t}(o,h[2*_+1],E,h[2*v+2*w+1]),_++,w++):P<E?(x(o,h[2*_+1]),_++):(x(E,h[2*v+2*w+1]),w++)}for(;_<S;)x(o,h[2*_+1]),_++;for(;w<C;){var E;x(E=h[2*v+2*w],h[2*v+2*w+1]),w++}}return y}}.apply(null,n))||(e.exports=i)},BtPY:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KY0m"),r("LxLY"),r("rusB")],void 0===(i=function(e,t,r,n,i){function a(e){return e.size*e.color[3]*e.opacity>0}function o(e,t){var n=r.binaryIndexOf(e,t,!0);return-1===n?t<e[0]?0:e.length:n}Object.defineProperty(t,"__esModule",{value:!0}),t.determineRendererType=function(e){for(var t=null,r=0,i=e;r<i.length;r++){var o=i[r],s=o.type;if(a(o))if(n.isNone(t))t=s;else if(t!==s)return"uber"}return n.isSome(t)?t:"solid"},t.determineAllTransparent=function(e){if(0===e.length)return!0;for(var t=0;t<e.length;t++)if(a(e[t].material))return!1;return!0},t.cloneIndices=function(e){if(Uint16Array.from)return i.isUint16Array(e)?Uint16Array.from(e):Uint32Array.from(e);for(var t=i.isUint16Array(e)?new Uint16Array(e.length):new Uint32Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t},t.estimateLengthAtDistance=function(e,t,r,n){return r*(n/e)*2*Math.tan(.5*t)},t.findLowerBoundIndex=o,t.computeEdgeCount=function(e,t,r){return e.length-o(e,t*r.minimumEdgeLength)},t.fillComponenBufferIndices=function(e,t,r,n){for(var i=0;i<e.length;i++){var a=e[i].index,o=t[i],s=t[i+1];if(n)for(var l=o;l<s;l++){var c=n[l];r.set(c,a)}else for(l=o;l<s;l++)r.set(l,a)}}}.apply(null,n))||(e.exports=i)},BwdQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("TMur"),r("xoE+"),r("FXVB"),r("1m5D"),r("DIqE"),r("Rdxj"),r("2fXB"),r("WRgd"),r("lRq4"),r("0FS0"),r("ZPQp"),r("vtMp"),r("ZcgO")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h){function v(e){var t=e.paths[0];if(!t||0===t.length)return null;var r=f.getPointOnPath(t,f.getPathLength(t)/2);return h.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}function m(e){var t=n.isFinite(e.zmin);return h.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function g(e){var t=e.rings[0];if(!t||0===t.length)return null;var r=d.ringsCentroid(e.rings,e.hasZ);return h.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}function y(e,t,n){if(!t||!e)return e;var i=e.spatialReference;return i.isWebMercator&&t.isWGS84?(p.xyToLngLat(e.x,e.y,S),n||(e=h.clonePoint(e)),e.x=S[0],e.y=S[1],e.spatialReference=r.SpatialReference.WGS84):t.isWebMercator&&i.isWGS84&&(p.lngLatToXY(e.x,e.y,S),n||(e=h.clonePoint(e)),e.x=S[0],e.y=S[1],e.spatialReference=r.SpatialReference.WebMercator),e}function b(e){return null!=e.isPrimitive}function x(e){if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t++)if(!x(r[t]))return!1;return!0}return null==e||e>=0}Object.defineProperty(t,"__esModule",{value:!0});var _=s.vec3f64.fromValues(1,1,1);t.computeCentroid=function(e,t){if("point"===e.type)return y(e,t,!1);if(h.isHydratedGeometry(e))switch(e.type){case"extent":return y(e.center,t,!1);case"polygon":return y(e.centroid,t,!1);case"polyline":return y(v(e),t,!0);case"mesh":return y(e.extent.center,t,!1)}else switch(e.type){case"extent":return y(m(e),t,!0);case"polygon":return y(g(e),t,!0);case"polyline":return y(v(e),t,!0)}},t.convertPointSR=y,t.enlargeExtent=function(e,t,r){if(e){t||(t=u.create());var n=e,i=.5*n.width*(r-1),a=.5*n.height*(r-1);return n.width<1e-7*n.height?i+=a/20:n.height<1e-7*n.width&&(a+=i/20),l.vec4.set(t,n.xmin-i,n.ymin-a,n.xmax+i,n.ymax+a),t}return null},t.updateVertexAttributeAuxpos1w=function(e,t){for(var r=0;r<e.geometries.length;++r){var n=e.geometries[r].data.vertexAttributes.auxpos1;n&&n.data[3]!==t&&(n.data[3]=t,e.geometryVertexAttrsUpdated(r))}},t.mixinColorAndOpacity=function(e,t){var r=[1,1,1,1];return null!=e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),null!=t?r[3]=t:null!=e&&e.length>3&&(r[3]=e[3]),r},t.overrideColor=function(e,t,r,n,i,a){void 0===a&&(a=[0,0,0,0]);for(var o=0;o<3;++o)e&&null!=e[o]?a[o]=e[o]:r&&null!=r[o]?a[o]=r[o]:a[o]=i[o];return a[3]=null!=t?t:null!=n?n:i[3],a},t.computeObjectScale=function(e,t,r,n){void 0===e&&(e=_),void 0===n&&(n=1);var i=new Array(3);if(null==t||null==r)i[0]=1,i[1]=1,i[2]=1;else{for(var a=void 0,o=0,l=2;l>=0;l--){var c=e[l],u=void 0,d=null!=c,f=0===l&&!a&&!d,p=r[l];"symbolValue"===c||f?u=0!==p?t[l]/p:1:d&&"proportional"!==c&&isFinite(c)&&(u=0!==p?c/p:1),null!=u&&(i[l]=u,a=u,o=Math.max(o,Math.abs(u)))}for(l=2;l>=0;l--)null==i[l]?i[l]=a:0===i[l]&&(i[l]=.001*o)}for(l=2;l>=0;l--)i[l]/=n;return s.vec3f64.fromArray(i)},t.computeSizeWithResourceSize=function(e,t){var r=t.isPrimitive,n=t.width,i=t.depth,a=t.height,o=r?10:1;if(null==n&&null==a&&null==i)return[o*e[0],o*e[1],o*e[2]];for(var l,c=s.vec3f64.fromValues(n,i,a),u=0;u<3;u++){var d=c[u];if(null!=d){l=d/e[u];break}}for(u=0;u<3;u++)null==c[u]&&(c[u]=e[u]*l);return c},t.validateSymbolLayerSize=function(e){return b(e)&&(e=[e.width,e.depth,e.height]),x(e)?null:"Symbol sizes may not be negative values"},t.computeObjectRotation=function(e,t,r,n){void 0===n&&(n=a.mat4f64.create());var o=e||0,s=t||0,l=r||0;return 0!==o&&i.mat4.rotateZ(n,n,-o/180*Math.PI),0!==s&&i.mat4.rotateX(n,n,s/180*Math.PI),0!==l&&i.mat4.rotateY(n,n,l/180*Math.PI),n},t.demResolutionForBoundingBox=function(e,t){return null!=t.minDemResolution?t.minDemResolution:c.isPoint(e)?t.minDemResolutionForPoints:.01*c.maximumDimension(e)},t.namedAnchorToHUDMaterialAnchorPos={"bottom-left":o.vec2f64.fromValues(0,0),bottom:o.vec2f64.fromValues(.5,0),"bottom-right":o.vec2f64.fromValues(1,0),left:o.vec2f64.fromValues(0,.5),center:o.vec2f64.fromValues(.5,.5),right:o.vec2f64.fromValues(1,.5),"top-left":o.vec2f64.fromValues(0,1),top:o.vec2f64.fromValues(.5,1),"top-right":o.vec2f64.fromValues(1,1)};var S=[0,0]}.apply(null,n))||(e.exports=i)},ByvF:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("xhoE"),r("Q2wQ"),r("HZ3d"),r("idNY"),r("QDcU"),r("WYKK"),r("pcDC"),r("ma1f"),r("H1tY"),r("rg9i"),r("LxLY"),r("qMld"),r("jBNx"),r("jfWY"),r("1m5D"),r("DIqE"),r("Rdxj"),r("O7NG"),r("Lrw1"),r("VR4s"),r("VW5z"),r("9v8t"),r("s4LJ"),r("zF3d"),r("JzVu"),r("BwdQ"),r("J2BX"),r("3w6h"),r("mmEe"),r("krVM"),r("ys4y"),r("4ziW"),r("cjy9"),r("yqrJ"),r("xFEL")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w,C,P,E,T,O,A,R,M,I,D,V,L,F,B){function N(e){return!!p.isSome(e)&&("cross"===e||"x"===e)}function U(e){var t,r=W,n=r*q;switch(e){case"circle":t=A.createCircle(r,n);break;case"square":t=A.createSquare(r,n);break;case"kite":t=A.createKite(r,n);break;case"cross":t=A.createCross(r,n);break;case"x":t=A.createX(r,n);break;case"triangle":t=A.createTriangle(r,n);break;default:c.neverReached(e)}return new F(t,"sdf_"+e,{mipmap:!1,wrap:{s:33071,t:33071},width:W,height:W,components:4,noUnpackFlip:!0})}Object.defineProperty(t,"__esModule",{value:!0});var z=g.mat4f64.create(),j=b.vec3f64.fromValues(0,0,1),G=[0,0,0,0],H=b.vec3f64.fromValues(0,0,0),k=b.vec3f64.fromValues(1,1,1),W=128,q=.5,X=[q/2,q/2,1-q/2,1-q/2],Y=[W*q,W*q],Q=function(e){function t(t,r,n,i){var a=e.call(this,t,r,n,i)||this;if(a._size=null,a._symbolTextureRatio=1,a._outlineSize=0,a._texture=null,a._drapedMaterial=null,a._releaseTexture=null,a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0},!a._validate())return a;var o=a._prepareMaterialParameters(),s=a._getPrimitive();return p.isSome(s)?a._prepareResourcesPrimitive(o,s):a._prepareResourcesHref(o),a}return n(t,e),t.prototype.getCachedSize=function(){return{size:this._getIconSize()}},t.prototype._validate=function(){if(this._isPropertyDriven("size"))return!0;var e=O.validateSymbolLayerSize(this._getIconSize());return!e||(this._logWarning(e),this.reject(),!1)},t.prototype._getIconSize=function(){var e=this.symbolLayer,t=Math.round(null!=e.size?v.pt2px(e.size):16);return this._isPropertyDriven("size")?Math.max(t,64):t},t.prototype._prepareMaterialParameters=function(){var e={anchorPos:this._getAnchorPos()},t=this.symbol;if(this._hasVisibleVerticalOffset(t)){var r=t.verticalOffset,n=r.screenLength,i=r.minWorldLength,a=r.maxWorldLength;e.verticalOffset={screenLength:v.pt2px(n),minWorldLength:i||0,maxWorldLength:null!=a?a:1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e},t.prototype._prepareResourcesPrimitive=function(e,t){var r=this,n=this._getOutlineSize();if(N(t)&&0===n)this.reject();else{this._outlineSize=n,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize;var i=this._context.sharedResources.textures.fromData(t,function(){return U(t)});this._texture=i.texture,this._releaseTexture=function(){return r._context.sharedResources.textures.release(i.uid)},e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=X,e.textureId=this._texture.id;var a=this._getIconSize();this._size=[a,a],this._symbolTextureRatio=1/q,this._createMaterialsAndAddToStage(e,this._context.stage),this.resolve()}},t.prototype._prepareResourcesHref=function(e){return a(this,void 0,void 0,function(){var t,r,n,a,s,c,f,p,v,g,y=this;return i(this,function(i){switch(i.label){case 0:return t=S.getIconHref(this.symbol,this.symbolLayer),!d("esri-canvas-svg-support")&&m.isSVG(t)?(s="IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)",this._logWarning(s),this.reject(new u("SVG Not Supported",s)),[2]):(this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1,r=this._getIconSize(),n=r*this._context.layerView.view.pixelRatio,[4,l.result(h.when(this._context.sharedResources.textures.fromUrl(t,n)))]);case 1:return!1===(a=i.sent()).ok?(a.error instanceof o?this.reject():(s="IconSymbol3DLayer failed to load (Request for icon resource failed: "+t+")",this._logWarning(s),this.reject(new u("Request Failed",s))),[2]):(c=a.value,f=c.uid,p=c.texture,this.isRejected()?(this._context.sharedResources.textures.release(f),[2]):(this._releaseTexture=function(){return y._context.sharedResources.textures.release(f)},v=p.params,g=v.width/v.height,this._size=g>1?[r,Math.round(r/g)]:[Math.round(r*g),r],e.textureId=p.id,this._createMaterialsAndAddToStage(e,this._context.stage),this.resolve(),[2]))}})})},t.prototype._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||_.defaultPrimitive},t.prototype._getOutlineSize=function(){var e=0,t=this.symbolLayer;return t.outline&&null!=t.outline.size?Math.max(v.pt2px(t.outline.size),0):(e=N(this._getPrimitive())?1.5:0,Math.max(e,0))},t.prototype._getOutlineColor=function(){var e=this._getLayerOpacity(),t=this.symbolLayer;if(t.outline){if(null!=t.outline.color){var r=s.toUnitRGB(t.outline.color),n=t.outline.color.a*e;return[r[0],r[1],r[2],n]}return[0,0,0,e]}return[0,0,0,e]},t.prototype._getFillColor=function(){return N(this._getPrimitive())?G:this._getMaterialOpacityAndColor()},t.prototype._getAnchorPos=function(){var e=this.symbolLayer.anchor,t=this.symbolLayer.anchorPosition;return"relative"===e?y.vec2f64.fromValues((t.x||0)+.5,.5-(t.y||0)):e in O.namedAnchorToHUDMaterialAnchorPos?O.namedAnchorToHUDMaterialAnchorPos[e]:O.namedAnchorToHUDMaterialAnchorPos.center},t.prototype._createMaterialsAndAddToStage=function(e,t){this._fastUpdates=R.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&f.mixin(e,this._fastUpdates.materialParameters);var n=r({},e);n.verticalOffset=null,n.screenSizePerspective=null,n.occlusionTest=!1,n.slicePlaneEnabled=!1,n.shaderPolygonOffset=0;var i=this._getStageIdHint();this._drapedMaterial=new B(n,i+"_iconDraped"),t.add(I.ModelContentType.MATERIAL,this._drapedMaterial),e.occlusionTest=!0,e.slicePlaneEnabled=this._context.slicePlaneEnabled,this._material=new B(e,i+"_icon"),t.add(I.ModelContentType.MATERIAL,this._material)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(I.ModelContentType.MATERIAL,this._material.id),this._material=null),this._drapedMaterial&&(this._context.stage.remove(I.ModelContentType.MATERIAL,this._drapedMaterial.id),this._drapedMaterial=null),this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)},t.prototype._getScaleFactor=function(e){if(this._isPropertyDriven("size")&&e.size){for(var t=0;t<3;t++){var r=e.size[t];r&&"symbolValue"!==r&&"proportional"!==r&&(e.size[t]=v.pt2px(r))}var n=this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"===e.size[0])return 1;if(isFinite(+e.size[0]))return+e.size[0]/n;if(isFinite(+e.size[2]))return+e.size[2]/n}return 1},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,r=e.graphic;if(!this._validateGeometry(r.geometry))return null;var n=E.placePointOnGeometry(r.geometry);if(!n)return this._logWarning("unsupported geometry type for icon symbol: "+r.geometry.type),null;var i="graphic"+r.uid,a=this._getVertexOpacityAndColor(t),o=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(o=this._getScaleFactor(t)),o*=this._symbolTextureRatio;var s=[this._size[0]*o,this._size[1]*o],l=this.getGraphicElevationContext(r);return"on-the-ground"===l.mode?this._createAsOverlay(r,n,a,s,l,i,r.uid,e.layer.uid):this._createAs3DShape(r,n,a,s,l,i,r.uid)},t.prototype.layerOpacityChanged=function(){var e=this._getFillColor();this._drapedMaterial.setParameterValues({color:e}),this._material.setParameterValues({color:e});var t=this._getOutlineColor();return this._drapedMaterial.setParameterValues({outlineColor:t}),this._material.setParameterValues({outlineColor:t}),!0},t.prototype.layerElevationInfoChanged=function(e,t,r){var n=this._elevationContext.mode;if("on-the-ground"===r&&"on-the-ground"===n)return!0;if(r!==n&&("on-the-ground"===r||"on-the-ground"===n))return!1;var i=E.needsElevationUpdates2D(n)||"absolute-height"===n;return this.updateGraphics3DGraphicElevationInfo(e,t,function(){return i})},t.prototype.slicePlaneEnabledChanged=function(e,t){return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0},t.prototype.pixelRatioChanged=function(e,t){return!!this._getPrimitive()},t.prototype.applyRendererDiff=function(e,t){for(var r in e.diff)switch(r){case"visualVariables":if(!R.updateFastSymbolUpdatesState(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);break;default:return!1}return!0},t.prototype.setDrawOrder=function(e,t,r){this.updateSymbolLayerOrder(e,t),this._drapedMaterial&&(this._drapedMaterial.renderPriority=e,r.add(this._drapedMaterial.id))},t.prototype._defaultElevationInfoNoZ=function(){return Z},t.prototype._createAs3DShape=function(e,t,r,n,i,a,o){var s=this,l=this.getFastUpdateAttrValues(e),c=l?function(e){return R.evaluateModelTransform(s._fastUpdates.materialParameters,l,e)}:null,u=V.createPointGeometry(j,null,r,n,J,null,l),d=[new D(u,a)],f=E.createStageObjectForPoint(this._context,t,d,[this._material],null,null,i,a,this._context.layer.uid,o,!0,c);if(null===f)return null;var p=w.perObjectElevationAligner,h=new P(this,f.object,d,null,null,p,i);return h.alignedTerrainElevation=f.terrainElevation,h.needsElevationUpdates=E.needsElevationUpdates2D(i.mode)||"absolute-height"===i.mode,h.getScreenSize=this._createScreenSizeGetter(n,c),h.calculateRelativeScreenBounds=function(e){return s._material.calculateRelativeScreenBounds(h.getScreenSize(),1,e)},E.extendPointGraphicElevationContext(h,t,this._context.elevationProvider),h},t.prototype._createAsOverlay=function(e,t,r,n,i,a,o,s){var l=this;this._drapedMaterial.renderPriority=this._symbolLayerOrder;var c=b.vec3f64.create();M.pointToVector(t,c,this._context.overlaySR),c[2]=this._getDrapedZ();var u=this._context.clippingExtent;if(u&&!E.pointInBox2D(c,u))return null;var d=this.getFastUpdateAttrValues(e),f=d?function(e){return R.evaluateModelTransform(l._fastUpdates.materialParameters,d,e)}:null,p=V.createPointGeometry(j,c,r,n,null,null,d),h=new L(p);h.material=this._drapedMaterial,h.center=c,h.bsRadius=0,h.transformation=z,h.name=a,h.uniqueName=a+"#"+p.id,h.data.layerUid=s,h.data.graphicUid=e.uid,h.calculateShaderTransformation=f;var v=new C(this,[h],null);return v.getScreenSize=this._createScreenSizeGetter(n,f),v.calculateRelativeScreenBounds=function(e){return l._drapedMaterial.calculateRelativeScreenBounds(v.getScreenSize(),1,e)},v},t.prototype._createScreenSizeGetter=function(e,t){var r=this._outlineSize+2;if(this._fastUpdates.enabled){var n=e[0]/this._symbolTextureRatio,i=e[1]/this._symbolTextureRatio;return function(e){void 0===e&&(e=y.vec2f64.create());var a=t(z);return e[0]=a[0]*n+r,e[1]=a[5]*i+r,e}}var a=e[0]/this._symbolTextureRatio+r,o=e[1]/this._symbolTextureRatio+r;return function(e){return void 0===e&&(e=y.vec2f64.create()),e[0]=a,e[1]=o,e}},t.prototype._fastVisualVariableConvertOptions=function(){var e=this._size[0]>this._size[1]?this._size[0]:this._size[1],t=b.vec3f64.fromValues(e,e,e),r=v.px2pt(1),n=e*r;return{modelSize:t,symbolSize:b.vec3f64.fromValues(n,n,n),unitInMeters:r,transformation:{anchor:H,scale:k,rotation:H}}},t.prototype._hasVisibleVerticalOffset=function(e){return this.symbol&&"point-3d"===this.symbol.type&&this.symbol.hasVisibleVerticalOffset()},t.PRIMITIVE_SIZE=Y,t}(T.default);t.Graphics3DIconSymbolLayer=Q;var Z={mode:"relative-to-ground",offset:0},J=x.vec4f64.fromValues(0,0,0,1);t.default=Q}.apply(null,n))||(e.exports=i)},C2Ab:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zbgD"),r("U+8K")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return i.glslifyDefineMap({TEXTURING:"none"!==e.textureMode,TEXTURE_ATLAS:"AtlasTextured"===e.textureMode,VERTEXCOLORS:e.vertexColors,SYMBOLVERTEXCOLORS:e.symbolColors,FLIPV:e.flipV,DOUBLESIDED:e.doubleSided,WINDINGORDERDOUBLESIDED:e.windowOrderDoubleSided,INSTANCED:e.instanced,INSTANCED_DOUBLE_PRECISION:e.instancedDoublePrecision,INSTANCEDCOLOR:e.instancedColor,RECEIVE_SHADOWS:e.receiveShadows,RECEIVE_SSAO:e.receiveSSAO,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,SLICE:e.slice,GROUND_NORMAL_SHADING:e.groundNormalShading,NORMALS:{value:e.normals,options:{default:"NORMALS_DEFAULT",compressed:"NORMALS_COMPRESSED",screenDerivative:"NORMALS_SCREEN_DERIVATIVE"}},COMPONENTCOLORS:e.componentColor,TEXTURE_ALPHA_MODE_MASK:"mask"===e.textureAlphaMode,TEXTURE_ALPHA_MODE_MASK_BLEND:"maskBlend"===e.textureAlphaMode,TEXTURE_ALPHA_MODE_OPAQUE:"opaque"===e.textureAlphaMode,BIAS_SHADOWMAP:e.shadowMap,VERTEX_TANGENTS:"vertex"===e.tangents,TEXTURE_NORMALS:!!e.normalTexture,TEXTURE_COORDINATES:!!e.normalTexture||"none"!==e.textureMode,TREE_RENDERING:e.treeRendering,IOS_SAFARI_FIX:e.iosSafariFix,TEXTURE_ALPHA_PREMULTIPLIED:!!e.textureAlphaPremultiplied})};t.colorPass={name:"default-color",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/defaultMaterial/colorPass.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:r.Default3D},t.depthPass={name:"default-depth",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/defaultMaterial/depthPass.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},attributes:r.Default3D},t.normalPass={name:"default-normal",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/defaultMaterial/normalPass.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"default-highlight",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},CIy2:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("W9tT"),r("DIqE"),r("Rdxj"),r("2fXB"),r("O7NG"),r("AzkI")],void 0===(i=function(e,t,r,n,i,a,o,s,l){function c(e,t){if(!e)throw new Error(t||"assert").stack,new v(t)}function u(e){for(var t in e)return t}function d(e,t){e[12]=t[0],e[13]=t[1],e[14]=t[2]}function f(e,t){void 0===t&&(t=0);for(var r=0,n=0;n<4;n++)r+=e[t+n]*g[n];return r}function p(e){return e-Math.floor(e)}Object.defineProperty(t,"__esModule",{value:!0});var h=s.vec4f64.create(),v=function(){function e(e){this.message=e}return e.prototype.toString=function(){return"AssertException: "+this.message},e}();t.AssertException=v,t.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex",TANGENT:"aTangent"},t.assert=c,t.verify=function(e,t){e||(t=t||"")},t.encodeInt16=function(e){return l.clamp(Math.round(32767*e),-32767,32767)},t.encodeNormal=function(e,t){var r=Math.abs(e[0]),n=Math.abs(e[1]),i=1/(r+n+Math.abs(e[2])),a=r*i,o=n*i,s=Math.min(e[2]*i,0);t[0]=(e[0]<0?-1:1)*(a-s),t[1]=(e[1]<0?-1:1)*(o-s)},t.fallbackIfUndefined=function(e,t){return void 0===e?t:e},t.hex2rgb=function(e){return[((e=Math.floor(e))>>16&255)/255,(e>>8&255)/255,(255&e)/255]},t.rgb2hex=function(e){return"0x"+((l.clamp(Math.round(255*e[0]),0,255)<<16)+(l.clamp(Math.round(255*e[1]),0,255)<<8)+l.clamp(Math.round(255*e[2]),0,255)).toString(16)},t.dec2hex=function(e){var t=e.toString(16);return"00000000".substr(0,8-t.length)+t},t.rayTriangle3D=function(e,t,r,n,i,o,s,l,c){void 0===c&&(c=a.vec3f64.create());var u=n[s]-r[o],d=n[s+1]-r[o+1],f=n[s+2]-r[o+2],p=i[l]-r[o],h=i[l+1]-r[o+1],v=i[l+2]-r[o+2],m=t[1]*v-h*t[2],g=t[2]*p-v*t[0],y=t[0]*h-p*t[1],b=u*m+d*g+f*y;if(b>-1e-5&&b<1e-5)return!1;var x=1/b,_=e[0]-r[o],S=e[1]-r[o+1],w=e[2]-r[o+2];if(c[1]=x*(_*m+S*g+w*y),c[1]<0||c[1]>1)return!1;var C=S*f-d*w,P=w*u-f*_,E=_*d-u*S;return c[2]=x*(t[0]*C+t[1]*P+t[2]*E),!(c[2]<0||c[1]+c[2]>1||(c[0]=x*(p*C+h*P+v*E),0))},t.rayBoxTest=function(e,t,r,n){var i,a=(r[0]-e[0])/t[0],o=(n[0]-e[0])/t[0];a>o&&(i=a,a=o,o=i);var s=(r[1]-e[1])/t[1],l=(n[1]-e[1])/t[1];if(s>l&&(i=s,s=l,l=i),a>l||s>o)return!1;s>a&&(a=s),l<o&&(o=l);var c=(r[2]-e[2])/t[2],u=(n[2]-e[2])/t[2];return c>u&&(i=c,c=u,u=i),!(a>u||c>o||(u<o&&(o=u),o<0))},t.rayRay2D=function(e,t,r,n,a,o){void 0===o&&(o=i.vec2f64.create());var s=(n[a]-r[a])*(t[0]-e[0])-(n[0]-r[0])*(t[a]-e[a]),l=(n[0]-r[0])*(e[a]-r[a])-(n[a]-r[a])*(e[0]-r[0]);if(0===s)return!1;var c=l/s;return o[0]=e[0]+c*(t[0]-e[0]),o[1]=e[a]+c*(t[a]-e[a]),!0},t.project=function(e,t,r,n,i){i||(i=e),h[0]=e[0],h[1]=e[1],h[2]=e[2],h[3]=1,o.vec4.transformMat4(h,h,t),i.length>2&&(i[2]=-h[2]),o.vec4.transformMat4(h,h,r),c(0!==h[3]),i[0]=h[0]/h[3],i[1]=h[1]/h[3],i[2]=h[2]/h[3],i[0]=(.5*i[0]+.5)*n[2]+n[0],i[1]=(.5*i[1]+.5)*n[3]+n[1]},t.getFirstObjectKey=u,t.getFirstObjectValue=function(e){return e[u(e)]},t.objectEmpty=function(e){for(var t in e)return!1;return!0},t.logWithBase=function(e,t){return Math.log(e)/Math.log(t)},t.setMatrixTranslation=d,t.setMatrixTranslation3=function(e,t,r,n){e[12]=t,e[13]=r,e[14]=n},t.getMatrixTranslation=function(e,t){return void 0===t&&(t=a.vec3f64.create()),t[0]=e[12],t[1]=e[13],t[2]=e[14],t},t.createTranslationMatrix=function(e,t){return d(e=r.mat4.identity(e),t),e},t.isTranslationMatrix=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]},t.fovx2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/t)},t.fovy2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/r)},t.fovx2fovd=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)},t.fovy2fovd=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)},t.fovd2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))},t.fovd2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))},t.packFloatRGBA=function(e,t,r){void 0===r&&(r=0);for(var n=l.clamp(e,0,y),i=0;i<4;i++)t[r+i]=Math.floor(256*p(n*m[i]))},t.unpackFloatRGBA=f;var m=[1,256,65536,16777216],g=[1/256,1/65536,1/16777216,1/4294967296],y=f(new Uint8ClampedArray([255,255,255,255]));t.inverseProjectionInfo=function(e,t,r,i,a){var o=e;0===e[11]?(i[0]=2/(t*o[0]),i[1]=2/(r*o[5]),i[2]=(1+o[12])/o[0],i[3]=(1+o[13])/o[5],n.vec2.set(a,0,1)):(i[0]=-2/(t*o[0]),i[1]=-2/(r*o[5]),i[2]=(1-o[8])/o[0],i[3]=(1-o[9])/o[5],n.vec2.set(a,1,0))}}.apply(null,n))||(e.exports=i)},CIzB:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},t.fromValues=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v){return[e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v]},t.createView=function(e,t){return new Float64Array(e,t,16)}}.apply(null,n))||(e.exports=i)},"Cvn+":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("W0kZ")],void 0===(i=function(e,t,r){return function(){function e(t,r,n,i,a,o){this.id=e._idGen.gen(t.id),this.geometry=t,this.material=r,this.transformation=n,this.instanceParameters=i,this.origin=a,this.shaderTransformation=o}return e.prototype.getStaticTransformation=function(){return this.transformation},e.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation},e._idGen=new r,e}()}.apply(null,n))||(e.exports=i)},D8s1:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+")],void 0===(i=function(e,t,r){return function(){function e(e,t){void 0===t&&(t=0),this.capacity=0,this.count=0,this.emptySlots=[],this.emptySlotCount=0,this.id2slot=new Map,this.slot2id=[],this.layout=e,this.resize(t)}return e.prototype.prepareAllocate=function(e){var t=this.count+e;t>this.capacity&&this.resize(t)},e.prototype.allocate=function(e){this.count>=this.capacity&&this.resize(this.count+1);var t=this.emptySlotCount>0?this.emptySlots[--this.emptySlotCount]:this.count;return this.id2slot.set(e,t),this.slot2id[t]=e,this.count++,t},e.prototype.prepareFree=function(e){this.emptySlots.length+=e},e.prototype.free=function(e){var t=this.id2slot.get(e);null!=t&&(this.emptySlots.length<=this.emptySlotCount&&(this.emptySlots.length=this.emptySlotCount+1),this.emptySlots[this.emptySlotCount++]=t,this.id2slot.delete(e),this.slot2id[t]=null,this.count--)},e.prototype.getCount=function(){return this.count},e.prototype.getSlot=function(e){return this.id2slot.get(e)},e.prototype.hasSlot=function(e){return this.id2slot.has(e)},e.prototype.getBuffer=function(){return this.buffer},e.prototype.compact=function(){if(this.emptySlotCount>0){var e=this.emptySlots,t=this.emptySlotCount,r=this.count+t;for(e.length=t,e.sort(function(e,t){return e-t});t>0;){if(e[t-1]!==r-1){var n=r-1,i=e[t-1];this.buffer.copyFrom(this.buffer,n,i,1);var a=this.slot2id[n];this.slot2id[n]=null,this.slot2id[i]=a,this.id2slot.set(a,i)}t--,r--}}this.emptySlotCount=0,this.emptySlots.length=0,this.resize(this.count)},e.prototype.resize=function(e){var t=this.capacity;if((e=Math.max(0,e))>0&&(e=r.nextHighestPowerOfTwo(e)),e>t){var n=this.layout.createBuffer(e);this.buffer&&n.copyFrom(this.buffer,0,0,t),this.buffer=n}else if(e<t){(n=this.layout.createBuffer(e)).copyFrom(this.buffer,0,0,e),this.buffer=n}this.buffer||(this.buffer=this.layout.createBuffer(0)),this.capacity=e,this.slot2id.length=e},e}()}.apply(null,n))||(e.exports=i)},DSFQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zbgD"),r("U+8K")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return i.glslifyDefineMap({OCCL_TEST:e.occlTest,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,DEPTH_HUD:e.depthHud,DEPTH_HUD_ALIGN_START:e.depthHudAlignStart,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,SLICE:e.slice})};t.program={name:"line-callout",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/lineCallout/lineCallout.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/lineCallout/lineCallout.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},DXwx:function(e,t,r){var n;void 0===(n=function(){function e(e){if(null==c)for(var t in c={},u={},e)"number"==typeof e[t]&&(c[e[t]]=t,u[t]=e[t])}function t(){if(null==c)throw"WebGLDebugUtils.init(ctx) not called"}function r(e){t();var r=c[e];return void 0!==r?"gl."+r:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function n(e,t,n,i){var a;if(void 0!==(a=l[e])&&(void 0!==(a=a[t])&&a[n])){if("object"==typeof a[n]&&void 0!==a[n].enumBitwiseOr){for(var o=a[n].enumBitwiseOr,s=0,c=[],d=0;d<o.length;++d){var f=u[o[d]];0!=(i&f)&&(s|=f,c.push(r(f)))}return s===i?c.join(" | "):r(i)}return r(i)}return null===i?"null":void 0===i?"undefined":i.toString()}function i(e,t,r){e.__defineGetter__(r,function(){return t[r]}),e.__defineSetter__(r,function(e){t[r]=e})}function a(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var n=0;n<t;++n)e.disableVertexAttribArray(n),e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(n,0);e.deleteBuffer(r);var i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(n=0;n<i;++n)e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}var o=function(e){window.console&&window.console.log&&window.console.log(e)},s=function(e){window.console&&window.console.error?window.console.error(e):o(e)},l={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},c=null,u=null;return{init:e,mightBeEnum:function(e){return t(),void 0!==c[e]},glEnumToString:r,glFunctionArgToString:n,glFunctionArgsToString:function(e,t){for(var r="",i=t.length,a=0;a<i;++a)r+=(0==a?"":", ")+n(e,i,a,t[a]);return r},makeDebugContext:function t(a,o,l,c){function u(e,t){return function(){l&&l(t,arguments);var r=e[t].apply(e,arguments),n=c.getError();return 0!=n&&(d[n]=!0,o(n,t,arguments)),r}}c=c||a,e(a),o=o||function(e,t,i){for(var a="",o=i.length,l=0;l<o;++l)a+=(0==l?"":", ")+n(t,o,l,i[l]);s("WebGL error "+r(e)+" in "+t+"("+a+")")};var d={},f={};for(var p in a)if("function"==typeof a[p])if("getExtension"!=p)f[p]=u(a,p);else{var h=u(a,p);f[p]=function(){return t(h.apply(a,arguments),o,l,c)}}else i(f,a,p);return f.getError=function(){for(var e in d)if(d.hasOwnProperty(e)&&d[e])return d[e]=!1,e;return a.NO_ERROR},f},makeLostContextSimulatingCanvas:function(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function r(){for(var e=Object.keys(_),t=0;t<e.length;++t)delete _[e]}function n(){++y,v||g==y&&e.loseContext()}function o(e,t){var r=e[t];return function(){if(n(),!v)return r.apply(e,arguments)}}function s(){for(var e=0;e<m.length;++e){var t=m[e];t instanceof WebGLBuffer?u.deleteBuffer(t):t instanceof WebGLFramebuffer?u.deleteFramebuffer(t):t instanceof WebGLProgram?u.deleteProgram(t):t instanceof WebGLRenderbuffer?u.deleteRenderbuffer(t):t instanceof WebGLShader?u.deleteShader(t):t instanceof WebGLTexture&&u.deleteTexture(t)}}function l(e){return{statusMessage:e,preventDefault:function(){b=!0}}}function c(e){for(var t in e)"function"==typeof e[t]?p[t]=o(e,t):i(p,e,t);p.getError=function(){if(n(),!v)for(;e=u.getError();)_[e]=!0;for(var e in _)if(_[e])return delete _[e],e;return p.NO_ERROR};for(var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],a=0;a<r.length;++a)p[c=r[a]]=function(t){return function(){if(n(),v)return null;var r=t.apply(e,arguments);return r.__webglDebugContextLostId__=h,m.push(r),r}}(e[c]);var s=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(a=0;a<s.length;++a)p[c=s[a]]=function(t){return function(){return n(),v?null:t.apply(e,arguments)}}(p[c]);var l=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(a=0;a<l.length;++a){var c;p[c=l[a]]=function(t){return function(){return n(),!v&&t.apply(e,arguments)}}(p[c])}return p.checkFramebufferStatus=function(t){return function(){return n(),v?p.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(p.checkFramebufferStatus),p.getAttribLocation=function(t){return function(){return n(),v?-1:t.apply(e,arguments)}}(p.getAttribLocation),p.getVertexAttribOffset=function(t){return function(){return n(),v?0:t.apply(e,arguments)}}(p.getVertexAttribOffset),p.isContextLost=function(){return v},p}var u,d=[],f=[],p={},h=1,v=!1,m=[],g=0,y=0,b=!1,x=0,_={};e.getContext=function(t){return function(){var r=t.apply(e,arguments);if(r instanceof WebGLRenderingContext){if(r!=u){if(u)throw"got different context";p=c(u=r)}return p}return r}}(e.getContext);var S=function(e){d.push(t(e))},w=function(e){f.push(t(e))};return function(e){var t=e.addEventListener;e.addEventListener=function(r,n,i){switch(r){case"webglcontextlost":S(n);break;case"webglcontextrestored":w(n);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!v){for(v=!0,g=0,++h;u.getError(););r(),_[u.CONTEXT_LOST_WEBGL]=!0;var t=l("context lost"),n=d.slice();setTimeout(function(){for(var r=0;r<n.length;++r)n[r](t);x>=0&&setTimeout(function(){e.restoreContext()},x)},0)}},e.restoreContext=function(){v&&f.length&&setTimeout(function(){if(!b)throw"can not restore. webglcontestlost listener did not call event.preventDefault";s(),a(u),v=!1,y=0,b=!1;for(var e=f.slice(),t=l("context restored"),r=0;r<e.length;++r)e[r](t)},0)},e.loseContextInNCalls=function(e){if(v)throw"You can not ask a lost contet to be lost";g=y+e},e.getNumCalls=function(){return y},e.setRestoreTimeout=function(e){x=e},e},resetToInitialState:a}}.apply(null,[]))||(e.exports=n)},Dk48:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("Vx27")],void 0===(i=function(e,t,r,n,i,a){return new(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,t.SCENEVIEW_LOCKING_LOG=!1,t.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1,t.HIGHLIGHTS_VISUALIZE_BLOCKS=!1,t.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,t.DECONFLICTOR_SHOW_OUTLINES=!1,t.DECONFLICTOR_SHOW_GRID=!1,t.LABELS_SHOW_BORDER=!1,t.OVERLAY_DRAW_TEST_TEXTURE=!1,t.OVERLAY_SHOW_CENTER=!1,t.TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING=!1,t.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1,t.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1,t.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1,t.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1,t.DRAW_MESH_GEOMETRY_NORMALS=!1,t.FEATURE_TILE_FETCH_SHOW_TILES=!1,t.FEATURE_TILE_TREE_SHOW_TILES=!1,t.ENABLE_PROFILE_DEPTH_RANGE=!1,t.DISABLE_FAST_UPDATES=!1,t.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,t.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,t}return r(t,e),n([a.property()],t.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),n([a.property()],t.prototype,"SCENEVIEW_LOCKING_LOG",void 0),n([a.property()],t.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0),n([a.property()],t.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0),n([a.property()],t.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),n([a.property()],t.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0),n([a.property()],t.prototype,"DECONFLICTOR_SHOW_GRID",void 0),n([a.property()],t.prototype,"LABELS_SHOW_BORDER",void 0),n([a.property()],t.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0),n([a.property()],t.prototype,"OVERLAY_SHOW_CENTER",void 0),n([a.property()],t.prototype,"TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING",void 0),n([a.property()],t.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0),n([a.property()],t.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0),n([a.property()],t.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0),n([a.property()],t.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0),n([a.property()],t.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),n([a.property()],t.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),n([a.property()],t.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),n([a.property()],t.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0),n([a.property()],t.prototype,"DISABLE_FAST_UPDATES",void 0),n([a.property()],t.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),n([a.property()],t.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),n([a.subclass()],t)}(a.declared(i)))}.apply(null,n))||(e.exports=i)},DlJW:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("7laH")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e){if(r.default(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};var t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}}.apply(null,n))||(e.exports=i)},"E/UE":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("xhoE"),r("YX1r"),r("51bw"),r("AzkI"),r("s6rJ"),r("+YS2")],void 0===(i=function(e,t,r,n,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.LINE_WIDTH_FRACTION_FACTOR=8,t.EXTENSION_LENGTH_OFFSET=128;var c={type:"uber",slicePlaneEnabled:!1,strokesTexture:null},u=function(){function e(){this._value=0}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.increment=function(){this._value++},e.prototype.decrement=function(){this._value--},e}(),d=function(){function e(t,n,i){this.rctx=t,this.programRepository=n,this.refCount=new u,this.renderables=new Set,this.depthBiasZ=-4e-4,this.depthBiasXY=.5,this.tmpViewToWorldNormalMatrix=a.mat3f64.create(),this.settings=r({},c,i),this.key=e.getKey(this.settings.type,this.settings.slicePlaneEnabled);var o=this.settings.strokesTexture.variants;this.writerSettings={variants:o},this.createPrograms()}return e.prototype.dispose=function(){for(var e in this.programs){var t=this.programs[e];t&&(this.programRepository.decreaseRefCount(t),this.programs[e]=null)}},e.prototype.addRenderable=function(e){this.renderables.add(e)},e.prototype.removeRenderable=function(e){this.renderables.delete(e)},e.prototype.forEachRenderable=function(e){this.renderables.forEach(e)},e.prototype.bindRegularEdges=function(e,t){this.bind(this.programs.regular,e,t)},e.prototype.bindSilhouetteEdges=function(e,t){this.bind(this.programs.silhouette,e,t)},e.prototype.bind=function(e,t,r){this.rctx.bindProgram(e),e.setUniformMatrix4fv("uProj",t.proj),e.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ),e.setUniform2f("uPixelToNDC",2/t.viewport[2],2/t.viewport[3]),e.setUniform2f("uNDCToPixel",t.viewport[2]/2,t.viewport[3]/2),e.setUniform1f("uDistanceFalloffFactor",r.distanceFalloffFactor),e.setUniform2f("uViewportDimInv",1/t.viewport[2],1/t.viewport[3]),e.setUniform1f("uPixelRatio",t.pixelRatio||1)},e.prototype.renderRegularEdges=function(e,t,r){this.render(this.programs.regular,e,e.regular.vao,t,r)},e.prototype.renderSilhouetteEdges=function(e,t,r){this.render(this.programs.silhouette,e,e.silhouette.vao,t,r)},e.prototype.render=function(e,t,r,n,i){this.setUniforms(e,t,n);var a=this.rctx;a.bindVAO(r),a.capabilities.instancing.drawArraysInstanced(6,0,4,i)},e.prototype.setUniforms=function(e,r,n){r.components.buffer.textureBuffer.bind(e,t.componentDataBindParameters),e.setUniformMatrix4fv("uView",n.view),e.setUniformMatrix4fv("uModel",r.transform.modelMatrix);var a=n.viewInvTransp,o=i.mat3.fromMat4(this.tmpViewToWorldNormalMatrix,a);e.setUniform3f("uCameraPosition",a[3],a[7],a[11]),e.setUniformMatrix3fv("uViewToWorldNormalMatrix",o),"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(e),e.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(n.fovY/2)/(n.viewport[3]/2)),e.setUniform3fv("uLocalOrigin",r.transform.origin.vec3),this.settings.slicePlaneEnabled&&s.bindSlicePlane(r.transform.origin.vec3,n.slicePlane,e)},e.prototype.setSketchUniforms=function(e){var t=this.settings.strokesTexture,r=t.texture;this.rctx.bindTexture(r,0),e.setUniform1i("uStrokesTexture",0),e.setUniform2f("uStrokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),e.setUniform1f("uStrokesLog2Resolution",o.log2(t.resolution)),e.setUniform1f("uStrokesNormalizationScale",t.normalizationScale),e.setUniform1f("uStrokesAmplitude",t.amplitude),e.setUniform1f("uStrokeVariants",t.variants)},e.prototype.getOptions=function(e){return r({},e,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.type,slice:this.settings.slicePlaneEnabled})},e.prototype.createPrograms=function(){var e=this.programRepository.getProgram(l.program,this.getOptions({silhouette:!1})),t=this.programRepository.getProgram(l.program,this.getOptions({silhouette:!0}));this.programRepository.increaseRefCount(e),this.programRepository.increaseRefCount(t),this.programs={regular:e,silhouette:t}},e.getKey=function(e,t){return"edges-t:"+e+":"+t},e}();t.EdgeRenderer=d,t.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}}.apply(null,n))||(e.exports=i)},"EAl+":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("1m5D"),r("0LE5"),r("Rdxj"),r("O7NG"),r("WRgd"),r("Dk48"),r("MzcX"),r("RsYQ"),r("ff/U"),r("9DjX"),r("2TjI"),r("9KSR"),r("LyIS"),r("gldz"),r("v+3j"),r("TP2F"),r("s6rJ"),r("QFi0"),r("Kfys"),r("z2+Q")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S){function w(e,t,r,n){g.encodeDoubleVec3(e.modelOrigin,t,r.modelOriginHi,r.modelOriginLo,n),r.model.copyFrom(n,e.model,t),r.modelNormal.copyFrom(n,e.modelNormal,t),e.color&&r.color&&r.color.copyFrom(n,e.color,t),e.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(n,e.featureAttribute,t)}Object.defineProperty(t,"__esModule",{value:!0});var C=_.assert,P=function(e){var t=e.baseBoundingSphere.radius,r=e.levels.map(function(e){return e.minScreenSpaceRadius});return new v.LevelSelector(t,r)};t.setLevelSelectorFactory=function(e){P=e};var E=function(){function e(e,t){this.glMaterials={};var r=e.rctx,n=t.geometry,i=t.material,a=n.data.toRenderData();this.materialRep=e.materialRep,i.setParameterValues({instancedDoublePrecision:!0});var o=i.createBufferWriter(),s=o.vertexBufferLayout,l=o.elementCount(a),u=o.allocate(l);o.write({},a,void 0,u,0),this.geometry=n,this.material=i,this.glMaterials=g.acquireGLMaterials(i,this.materialRep),this.vertexBufferLayout=s,this.vbo=x.createVertex(r,35044,u.buffer),this.vao=new S(r,d.Default3D,{geometry:c.glLayout(s)},{geometry:this.vbo}),this.vertexCount=l}return e.prototype.destroy=function(){g.releaseGLMaterials(this.material,this.materialRep),this.vbo.dispose(),this.vao.dispose()},Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0}),e.prototype.intersect=function(e,t,r,n,i,a){var o=this.geometry.id,s=i.toString();this.material.intersect(this.geometry,null,e.transform.transform,e,r,n,function(r,n,l,c,u,d){if(r>=0){if(null!=t&&!t(e.rayBeginPoint,e.rayEndPoint,r))return;var p={type:"external",metadata:{layerUid:a.layerUid,graphicUid:a.graphicUid(i)}};if((null==e.results.min.drapedLayerOrder||c>=e.results.min.drapedLayerOrder)&&(null==e.results.min.dist||r<e.results.min.dist)&&(e.results.min.set(p,s,r,n,e.transform.transform,c,null,o,l),e.results.min.intersector="LodRenderer"),(null==e.results.max.drapedLayerOrder||c>=e.results.max.drapedLayerOrder)&&(null==e.results.max.dist||r>e.results.max.dist)&&(e.results.max.set(p,s,r,n,e.transform.transform,c,null,o,l),e.results.min.intersector="LodRenderer"),e.enable.storeAll){var h=new f.IntersectorResult(e.results.min.ray);h.set(p,s,r,n,e.transform.transform,c,null,o,l),h.intersector="LodRenderer",e.results.all.push(h)}}},null)},e}();t.LodComponentData=E;var T=function(){function e(e,t){var r=this;this.components=[],this.minScreenSpaceRadius=t.minScreenSpaceRadius,t.components.forEach(function(t){r.components.push(new E(e,t))})}return e.prototype.destroy=function(){this.components.forEach(function(e){e.destroy()})},e.prototype.intersect=function(e,t,r,n,i,a){this.components.forEach(function(o){o.intersect(e,t,r,n,i,a)})},Object.defineProperty(e.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var e=s.empty();this.components.forEach(function(t){s.expand(e,t.boundingInfo.bbMin),s.expand(e,t.boundingInfo.bbMax)}),this._boundingBox=e}return this._boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var e=this.boundingBox,t=a.vec3f64.create();s.center(e,t),this._boundingSphere={center:t,radius:.5*s.diameter(e)}}return this._boundingSphere},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"triangleCount",{get:function(){return this.components.reduce(function(e,t){return e+t.triangleCount},0)},enumerable:!0,configurable:!0}),e}();t.LodLevelData=T;var O=function(){function e(e,r,n,i){var a=this;this._levels=[],this._renderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlaneEnabled=!1,this._enableLevelSelection=!0,this._lastCamera=new u,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.didRender=!1,this._symbol=e,this._optionalFields=r,this._metadata=n,this._instanceBufferLayout=y.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:r}),this._glInstanceBufferLayout=c.glLayout(this._instanceBufferLayout,{divisor:1}),this._instanceData=new p.InstanceData(this._optionalFields,i),this._instanceData.on("instance-added",function(e){a.requestUpdateCycle()}),this._instanceData.on("instance-removed",function(e){a.requestUpdateCycle()}),this._instanceData.on("instance-transform-changed",function(e){a.requestUpdateCycle()}),this._instanceData.on("instance-visibility-changed",function(e){a.requestUpdateCycle(!0)}),this._instanceData.on("instance-highlight-changed",function(e){a.requestUpdateCycle(!0)}),this._enableLevelSelection=this._symbol.levels.length>1,t.lodRenderers.push(this)}return e.prototype.destroy=function(){t.lodRenderers.splice(t.lodRenderers.indexOf(this),1)},Object.defineProperty(e.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseBoundingBox",{get:function(){return this._levels[this._levels.length-1].boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-1].boundingSphere},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-1].components[0].material},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(e){this._slicePlaneEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intersectionHandlerId",{get:function(){return this._metadata.layerUid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){var e={cpu:0,gpu:0};return this._renderInstanceData.forEach(function(t){var r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(function(t){var r=t.memoryUsage;e.cpu+=r.cpu,e.gpu+=r.gpu}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderStats",{get:function(){var e=this,t=this._instanceData.size,r=[];return this._levels.forEach(function(t,n){var i=e._renderInstanceData[n],a=e._highlightRenderInstanceData[n],o=i.size+a.size,s=t.triangleCount;r.push({renderedInstances:o,renderedTriangles:o*s,trianglesPerInstance:s})}),{totalInstances:t,renderedInstances:r.reduce(function(e,t){return e+t.renderedInstances},0),renderedTriangles:r.reduce(function(e,t){return e+t.renderedTriangles},0),levels:r}},enumerable:!0,configurable:!0}),e.prototype.initializeRenderContext=function(e){var t=this,r=e.rctx;this._symbol.levels.forEach(function(n){t._levels.push(new T(e,n)),t._renderInstanceData.push(new m.RenderInstanceData(r,t._instanceBufferLayout)),t._highlightRenderInstanceData.push(new m.RenderInstanceData(r,t._instanceBufferLayout))}),this._levelSelector=P(this)},e.prototype.uninitializeRenderContext=function(e){this.invalidateOctree(),this._levels.forEach(function(e){e.destroy()}),this._renderInstanceData.forEach(function(e){e.destroy()}),this._highlightRenderInstanceData.forEach(function(e){e.destroy()})},Object.defineProperty(e.prototype,"slots",{get:function(){return[5,7]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsHighlight",{get:function(){return this._highlightRenderInstanceData.reduce(function(e,t){return e+t.size},0)>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsRender",{get:function(){return this.needsUpdates()},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this.didRender&&(this.didRender=!1)},e.prototype.prepareRender=function(e){this.runUpdates(e)},e.prototype.render=function(e){var t=e.rctx,r=5===e.slot?4:7===e.slot?6:null;if(r){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(e.pass))return!1;var n=e.camera,i={view:n.viewMatrix,proj:n.projectionMatrix,origin:[0,0,0],viewInvTransp:n.viewInverseTransposeMatrix,lightingData:e.lightingData,viewport:n.viewport,fovY:n.fovY,nearFar:[n.near,n.far],shadowMap:e.shadowMap,shadowMappingEnabled:!!e.shadowMap&&e.shadowMap.enabled,ssaoEnabled:!!e.ssaoHelper&&e.ssaoHelper.enabled,pixelRatio:n.pixelRatio,slicePlane:e.sliceHelper&&e.sliceHelper.plane,cameraAboveGround:n.aboveGround,hudVisibilityTexture:e.offscreenRenderingHelper?e.offscreenRenderingHelper.hudVisibilityTexture:null};t.bindVAO();for(var a=0;a<this._levels.length;++a){var o=e.isHighlightPass?this._highlightRenderInstanceData[a]:this._renderInstanceData[a];this.renderLevel(e,r,i,o,a)}return!0}},e.prototype.intersect=function(e,t,r,n,o){var s=this;if(this.baseMaterial.isVisible()){var l=a.vec3f64.create();i.vec3.subtract(l,n,r);var c=function(a){s._instanceData.getCombinedModelTransform(a,M),e.transform.set(M),i.vec3.transformMat4(I,r,e.transform.inverse),i.vec3.transformMat4(D,n,e.transform.inverse);var o=s._instanceData.getState(a),l=s._instanceData.getLodLevel(a);C(o&p.StateFlags.ACTIVE,"invalid instance state"),C(l>=0&&l<s._levels.length,"invaid lod level"),s._levels[l].intersect(e,t,I,D,a,s._metadata)};this.baseMaterial.getParameters().verticalOffset?this.octree.forEach(c):this.octree.forEachAlongRay(r,l,c)}},e.prototype.queryDepthRange=function(e){return this.queryDepthRangeOctree(e)},e.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()},e.prototype.requestUpdateCycle=function(e){void 0===e&&(e=!1),this._updateCyclesWithStaticCamera=-1,e&&(this._needFullCycle=!0)},e.prototype.needsUpdates=function(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1},e.prototype.runUpdates=function(e){if(!l.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var t=e.equals(this._lastCamera);this._lastCamera.copyFrom(e),t||this.requestUpdateCycle()}var r=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this.updateInstances(e,r)}},Object.defineProperty(e.prototype,"octree",{get:function(){return this._octree||(this._octree=this.buildOctree()),this._octree},enumerable:!0,configurable:!0}),e.prototype.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)},e.prototype.buildOctree=function(){for(var e=new h.InstanceOctree(this._instanceData,this.baseBoundingSphere),t=this._instanceData,r=t.view?t.view.state:null,n=0;n<this._instanceData.capacity;++n)r.get(n)&p.StateFlags.ACTIVE&&e.addInstance(n);return e},e.prototype.queryDepthRangeOctree=function(e){var t=e.eye,r=e.viewForward,n=this.octree.findClosest(r,"front-to-back",e.frustum),a=this.octree.findClosest(r,"back-to-front",e.frustum);if(null!=n&&null!=a){this._instanceData.view.boundingSphere.getVec(n,R),i.vec3.subtract(R,R,t);var o=i.vec3.dot(R,r)-R[3];this._instanceData.view.boundingSphere.getVec(a,R),i.vec3.subtract(R,R,t);var s=i.vec3.dot(R,r)+R[3];return{near:Math.max(e.near,o),far:Math.min(e.far,s)}}return{near:1/0,far:-1/0}},e.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++,this._renderInstanceData.forEach(function(e){e.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(function(e){e.startUpdateCylce()})},e.prototype.updateInstances=function(e,t){var r=this._enableLevelSelection,n=this._levelSelector;n.updateCamera(e),this._renderInstanceData.forEach(function(e){e.beginUpdate()}),this._highlightRenderInstanceData.forEach(function(e){e.beginUpdate()});var i=this._instanceData,a=this._instanceData.view,o=i.size,s=i.capacity,l=this._instanceIndex;t=Math.min(o,t);for(var c=0;c<t;++c){0===l&&this.startUpdateCycle();var u=a.state.get(l),d=0;if(u&p.StateFlags.ALLOCATED){var f=a.lodLevel.get(l);if(u&p.StateFlags.ACTIVE&&this._renderInstanceData[f].freeTail(),u&p.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[f].freeTail(),u&p.StateFlags.REMOVE)i.freeInstance(l);else if(u&p.StateFlags.VISIBLE){var h=0;if(r&&(a.modelOrigin.getVec(l,A),h=n.selectLevel(A,i.getCombinedMedianScaleFactor(l))),d=u&~(p.StateFlags.ACTIVE|p.StateFlags.HIGHLIGHT_ACTIVE|p.StateFlags.TRANSFORM_CHANGED),h>=0){var v=this._renderInstanceData[h],m=v.allocateHead();if(w(a,l,v.view,m),d|=p.StateFlags.ACTIVE,u&p.StateFlags.HIGHLIGHT){var g=this._highlightRenderInstanceData[h],y=g.allocateHead();w(a,l,g.view,y),d|=p.StateFlags.HIGHLIGHT_ACTIVE}}a.state.set(l,d),a.lodLevel.set(l,h)}else d=u&~(p.StateFlags.ACTIVE|p.StateFlags.HIGHLIGHT_ACTIVE|p.StateFlags.TRANSFORM_CHANGED),a.state.set(l,d);if(this._octree){var b=!!(u&p.StateFlags.ACTIVE),x=!!(d&p.StateFlags.ACTIVE);!b&&x?this._octree.addInstance(l):b&&!x?this._octree.removeInstance(l):b&&x&&u&p.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(l),this._octree.addInstance(l))}l=(l+1)%s}else l=(l+1)%s,t++}this._instanceIndex=l,this._renderInstanceData.forEach(function(e){e.endUpdate()}),this._highlightRenderInstanceData.forEach(function(e){e.endUpdate()})},e.prototype.renderLevel=function(e,t,r,n,i){var a=this;this._levels[i].components.forEach(function(o){a.renderComponent(e,t,r,n,o,i)})},e.prototype.renderComponent=function(e,t,r,n,i,a){var o=i.glMaterials[e.pass];if(o&&o.beginSlot(t)&&o.isVisible()&&o.isVisibleInPass(e.pass)&&0!==n.size){var s=e.rctx,c=s.capabilities.instancing,u=o.getDrawMode();r.origin=[0,0,0],o.bind(s,r),s.bindVAO(i.vao);var f=o.getProgram();if(_.assertCompatibleVertexAttributeLocations(i.vao,f),e.isHighlightPass){var p=e.offscreenRenderingHelper?e.offscreenRenderingHelper.depthTexture:null;s.bindTexture(p,5),f.setUniform1i("depthTex",5),f.setUniform4f("highlightViewportPixelSz",0,0,1/r.viewport[2],1/r.viewport[3])}o.bindView(s,r),l.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===e.pass&&(f.setUniform4fv("externalColor",V[Math.min(a,V.length-1)]),f.setUniform1i("colorMixMode",b.colorMixModes.replace));var h=n.capacity,v=n.headIndex,m=n.tailIndex,g=n.firstIndex,y=this._glInstanceBufferLayout,x=function(e,t){_.bindVertexBufferLayout(s,d.Default3D,n.buffer,y,e),c.drawArraysInstanced(u,0,i.vertexCount,t-e),_.unbindVertexBufferLayout(s,d.Default3D,n.buffer,y)};i.material.getParameters().transparent&&null!=g?v>m?(C(g>=m&&g<=v,"invalid firstIndex"),x(g,v),x(m,g)):v<m&&(g<=v?(C(g>=0&&g<=v,"invalid firstIndex"),x(g,v),x(m,h),x(0,g)):(C(g>=m&&g<=h,"invalid firstIndex"),x(g,h),x(0,v),x(m,g))):v>m?x(m,v):v<m&&(x(0,v),x(m,h)),s.bindVAO(null),o.release(s,r)}},e}();t.LodRenderer=O,t.lodRenderers=[];var A=a.vec3f64.create(),R=o.vec4f64.create(),M=n.mat4f64.create(),I=a.vec3f64.create(),D=a.vec3f64.create(),V=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]}.apply(null,n))||(e.exports=i)},"EiD/":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultTextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2}}.apply(null,n))||(e.exports=i)},EuvN:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("weYu")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.quat=r}.apply(null,n))||(e.exports=i)},EyQ4:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Zp3t")],void 0===(i=function(e,t,r){function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}Object.defineProperty(t,"__esModule",{value:!0});var i=542327876,a=131072,o=4,s=33776,l=33778,c=33779,u=n("DXT1"),d=n("DXT3"),f=n("DXT5"),p=31,h=0,v=1,m=2,g=3,y=4,b=7,x=20,_=21;t.createDDSTexture=function(e,t,n,S){var w,C,P=new Int32Array(n,0,p);if(P[h]!==i)return null;if(!(P[x]&o))return null;switch(P[_]){case u:w=8,C=s;break;case d:w=16,C=l;break;case f:w=16,C=c;break;default:return null}var E=1;P[m]&a&&!1!==S&&(E=Math.max(1,P[b]));for(var T,O,A=P[y],R=P[g],M=P[v]+4,I=[],D=0;D<E;++D)O=Math.floor((A+3)/4)*Math.floor((R+3)/4)*w,T=new Uint8Array(n,M,O),I.push(T),M+=O,A=Math.max(1,A>>1),R=Math.max(1,R>>1);t.samplingMode=E>1?9987:9729,t.hasMipmap=E>1,t.width=P[y],t.height=P[g],t.internalFormat=C;var V=new r(e,t,{type:"compressed",levels:I});return e.bindTexture(V),V}}.apply(null,n))||(e.exports=i)},F0v3:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q2wQ"),r("HZ3d"),r("2Atf"),r("TMur"),r("qMld"),r("afW+")],void 0===(i=function(e,t,r,n,i,a,o,s){Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){this.spatialReference=e,this.view=t,this.point=new a.Point,this.point.spatialReference=e}return e.prototype.getElevation=function(e,t,r){return this.point.x=e,this.point.y=t,this.view.elevationProvider.getElevation(this.point,r)},e.prototype.queryElevation=function(e,t,i,a){return n(this,void 0,void 0,function(){return r(this,function(r){return this.point.x=e,this.point.y=t,[2,this.view.elevationProvider.queryElevation(this.point,i,a)]})})},e}();t.ViewElevationProvider=l;var c=function(){function e(e,t,r){this.spatialReference=e,this._getElevationQueryProvider=t,this._queries=[],this._isScheduled=!1,this._queryOptions=i({},r,{ignoreInvisibleLayers:!0})}return e.prototype.queryElevation=function(e,t,i){return void 0===i&&(i=0),n(this,void 0,void 0,function(){var n=this;return r(this,function(r){return[2,o.create(function(r,a){n._queries.push({x:e,y:t,minDemResolution:i,result:{resolve:r,reject:a}}),n._scheduleDoQuery()})]})})},e.prototype._scheduleDoQuery=function(){var e=this;this._isScheduled||(s.schedule(function(){return e._doQuery()}),this._isScheduled=!0)},e.prototype._doQuery=function(){return n(this,void 0,void 0,function(){var e,t,n,o,s,l,c,u,d;return r(this,function(r){switch(r.label){case 0:if(this._isScheduled=!1,e=this._queries,this._queries=[],t=e.map(function(e){return[e.x,e.y]}),n=e.reduce(function(e,t){return Math.min(e,t.minDemResolution)},1/0),o=new a.Multipoint({points:t,spatialReference:this.spatialReference}),!(s=this._getElevationQueryProvider()))return e.forEach(function(e,t){return e.result.reject()}),[2];c=i({},this._queryOptions,{minDemResolution:n}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s.queryElevation(o,c)];case 2:return l=r.sent(),[3,4];case 3:return u=r.sent(),e.forEach(function(e){return e.result.reject(u)}),[2];case 4:return d=l.geometry.points,e.forEach(function(e,t){return e.result.resolve(d[t][2])}),[2]}})})},e}();t.ElevationQuery=c}.apply(null,n))||(e.exports=i)},FM7k:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("23eD"),r("DIqE"),r("Dk48"),r("CIy2"),r("3RHn"),r("9pvv"),r("1bVs"),r("xgKb"),r("2f4f"),r("nBma"),r("Raj5"),r("6wId"),r("doLD"),r("2CPm"),r("jlKI"),r("Lb4W"),r("CIy2"),r("Q55v"),r("QDiq"),r("xFEL"),r("deO7"),r("Zp3t")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w,C){function P(e,t){var r=new Map,n=null,i=null,a=function(e){if(e===n)return i;var t=r.get(e);return t||(t={toAdd:[],toRemove:[],toUpdate:[]},r.set(e,t)),n=e,i=t,t};e.toAdd.forEach(function(e){E(e)&&a(e.material).toAdd.push(e)}),e.toRemove.forEach(function(e){E(e)&&a(e.material).toRemove.push(e)});var o=0;return e.toUpdate.forEach(function(e){E(e.renderGeometry)&&(a(e.renderGeometry.material).toUpdate.push(e),o|=e.updateType)}),t&&(t.updateTypes=o),r}function E(e){return T(e.data)>=1}function T(e){return!1===e.preinterleaved?b.getFirstObjectValue(e.indices).length:e.indexCount}function O(e,t){return e.isVisible()&&e.isVisibleInPass(t.pass)&&0!=(e.renderOccluded&t.renderOccludedMask)}var A=function(){function e(t,r,n,i,a,o){var s=this;this._materialRenderers=new Map,this._orderedMaterialRenderers=[],this._hasHighlights=!1,this._lighting=new _.SceneLighting,this._content=new Map,this._isRendering=!1,this._needsRender=!0,this._fallbackDepthStencilTexture=null,this._stats=new e.RenderStats,this._edgeView=null,this.renderOptions={antialiasing:"smaa"},this._programRep=t,this._materialRep=r,this._rctx=i,this._mode=a,this._stage=o,this._fxaaPass=new u(i),this._smaaPass=new g(i),this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null},this._offscreenRendering=new f(t,this._rctx),this._sliceHelper=new m,"scene"===this._mode&&(this._shadowMap=new v(this._rctx),this._ssaoHelper=new y(t,this._rctx,function(){s._needsRender=!0}),this._highlightHelper=new d(t,this._rctx)),this._renderPlugins=new h.RenderPluginManager({rctx:i,programRep:t,textureRep:n,materialRep:r}),this._renderContext=new p(i,this._offscreenRendering,this._lighting.getOld(),this._shadowMap,this._ssaoHelper,this._sliceHelper)}return e.prototype.dispose=function(){this._materialRenderers.forEach(function(e){e.dispose()}),this._materialRenderers=null,this._orderedMaterialRenderers=null,this._edgeView&&(this._edgeView.destroy(),this._edgeView=null),this._offscreenRendering.enabled=!1,this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null),this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose()),this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose()),this._highlightHelper&&(this._highlightHelper.enabled=!1),s.tmpIndices.prune(),this._content.clear(),this._content=null},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.ensureEdgeView=function(){var e=this;return null==this._edgeView&&(this._edgeView=new x.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){return e._needsRender=!0}}),this._edgeView.initialize()),this._edgeView},Object.defineProperty(e.prototype,"edgeView",{get:function(){return this._edgeView},enumerable:!0,configurable:!0}),e.prototype.setLighting=function(e){this._lighting.set(e)},e.prototype.setRenderParams=function(e){void 0!==e.shadowMapResolution&&!1===this._shadowMap.enabled&&(this._shadowMap.textureResolution=e.shadowMapResolution),void 0!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap),void 0!==e.shadowMapMaxCascades&&(this._shadowMap.maxCascades=e.shadowMapMaxCascades),this._highlightHelper.enabled=!0,void 0!==e.ssao&&(this._ssaoHelper.enabled=e.ssao),void 0!==e.ssaoAttenuation&&(this._ssaoHelper.attenuation=e.ssaoAttenuation),void 0!==e.ssaoRadius&&(this._ssaoHelper.radius=e.ssaoRadius),e.ssaoFilterRadius,void 0!==e.ssaoSamples&&(this._ssaoHelper.samples=e.ssaoSamples),e.background&&(this._offscreenRendering.background=e.background),void 0!==e.antialiasingEnabled&&(this.renderOptions.antialiasing=e.antialiasingEnabled?"smaa":"none"),void 0!==e.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(e.defaultHighlightOptions),void 0!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane),this._needsRender=!0},Object.defineProperty(e.prototype,"hasSlicePlane",{get:function(){return!!this._sliceHelper.plane},enumerable:!0,configurable:!0}),e.prototype.getRenderParams=function(){var e={};return this._shadowMap&&(e.shadowMap=this._shadowMap.enabled,e.shadowMapResolution=this._shadowMap.textureResolution,e.shadowMapMaxCascades=this._shadowMap.maxCascades),this._ssaoHelper&&this._ssaoHelper.isSupported&&(e.ssao=this._ssaoHelper.enabled,e.ssaoAttenuation=this._ssaoHelper.attenuation,e.ssaoRadius=this._ssaoHelper.radius,e.ssaoFilterRadius=this._ssaoHelper.filterRadius,e.ssaoSamples=this._ssaoHelper.samples),e},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0}),e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderPlugins.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderPlugins.needsRender()},e.prototype.getCombinedStats=function(){return this._stats.VBOallocatedSize=0,this._stats.VBOoptimalSize=0,this._stats.VBOusedSize=0,this._stats.VBOallocatedSize*=4/1024,this._stats.VBOusedSize*=4/1024,this._stats.VBOoptimalSize*=4/1024,this._stats},e.prototype.getFramebufferTexture=function(e){switch(e){case"color":return this._offscreenRendering.colorTexture;case"hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case"shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();case"linearDepth":return this._offscreenRendering.linearDepthTexture;case"normals":return this._offscreenRendering.normalTexture;case"highlight":return this._offscreenRendering.highlightTexture}return null},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._materialRenderers.size},e.prototype.modify=function(e,t,r,n){var i=this;void 0===r&&(r=[]),this._isRendering;for(var a=0;a<t.length;++a)this._content.delete(t[a].uniqueName);for(a=0;a<e.length;++a)this._content.set(e[a].uniqueName,e[a]);if(r)for(a=0;a<r.length;++a)o.assert(this._content.get(r[a].renderGeometry.uniqueName)===r[a].renderGeometry);if(e.length||t.length||r.length){var s=P({toAdd:e,toRemove:t,toUpdate:r}),l=!1;s.forEach(function(e,t){var r=i._materialRenderers.get(t);!r&&e.toAdd.length>0&&(r=t.createRenderer(i._rctx,i._materialRep),i._materialRenderers.set(t,r),i._orderedMaterialRenderers.push(r),i.sortOrderedMaterialRenderers()),r&&(r.modify(e),r.isEmpty&&(l=!0))}),l&&this._materialRenderers.forEach(function(e,t){e.isEmpty&&(i._materialRenderers.delete(t),i._orderedMaterialRenderers.splice(i._orderedMaterialRenderers.indexOf(e),1),e.dispose())});var c=!1;this._materialRenderers.forEach(function(e){c=c||e.hasHighlights}),c!==this._hasHighlights&&(this.onHasHighlightsChanged&&this.onHasHighlightsChanged(c),this._hasHighlights=c),this._needsRender=!0}n&&(n.forEach(function(e){i._materialRep.updateMaterialParameters(e)}),this._needsRender=!0)},e.prototype.modifyRenderOrder=function(e){"draped"===this._mode&&(this.sortOrderedMaterialRenderers(),this._needsRender=!0)},e.prototype.render=function(e){switch(this._mode){case"scene":this.renderScene(e);break;case"draped":this.renderDraped(e)}this.onPostRender&&this.onPostRender()},e.prototype.renderPass=function(e,t){this.renderGeometryPass(e,t)},e.prototype.renderScene=function(e){var t=this;this._isRendering=!0;var r=this._rctx,n=this._offscreenRendering,i=this._ssaoHelper,a=e.camera,o=e.fbo,s=this._sliceHelper.plane;e.disableSlice&&(this._sliceHelper.plane=null),this.prepareRender(a),this.renderShadowMap(e),n.enabled=!0,n.initializeFrame(a,o),this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth()?n.renderToTargets(function(){t.renderGeometryPass(1,e)},n.linearDepth,n.tmpDepth,[0,0,0,0],!0):n.disposeTarget(n.linearDepth),this._ssaoHelper.enabled?n.renderToTargets(function(){t.renderGeometryPass(2,e)},n.normal,n.tmpDepth,[0,0,0,0],!0):n.disposeTarget(n.normal),this._ssaoHelper.enabled&&i.computeSSAO(a,n.linearDepthTexture,n.normalTexture),i.bindAll(this._programRep),this._stats.reset(),this.updateGlobalUniforms(a.projectionMatrix),this._renderContext.pass=0,this._renderContext.camera=a,this._renderContext.options=this.renderOptions,n.bindTarget(n.mainColor,n.mainDepth),this._renderPlugins.render(0,this._renderContext),this.renderGeometrySlotsPt1(this._renderContext),this._edgeView&&this._edgeView.shouldRender()&&n.renderSeparateAndComposite(function(){return t._edgeView.render(t._bindParameters)},void 0,"alpha");var l={hudVisibility:!1,transparentTerrain:!1};l.hudVisibility=this.renderHUDVisibility(this._renderContext),this.renderInternalSlot(17,this._renderContext),l.transparentTerrain=this.renderTransparentTerrain(this._renderContext),l.transparentTerrain&&l.hudVisibility&&(n.compositeTransparentTerrainOntoHUDVisibility(),n.renderToTargets(function(){return t.renderHUD("occluded")},n.mainColor,n.tmpDepth,void 0,!0)),l.transparentTerrain&&n.compositeTransparentTerrainOntoMain(),n.renderToTargets(function(){t.renderInternalSlot(9,t._renderContext),t._renderPlugins.render(13,t._renderContext),t._renderPlugins.render(14,t._renderContext)},n.mainColor,n.mainDepth),this.renderOccluded();var c=this.renderOptions.antialiasing;"smaa"===c&&this._smaaPass.loadResources(function(){t._needsRender=!0}),"smaa"===c&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:n.colorTexture},o)):"fxaa"===c&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:n.colorTexture},o)):(n.composite(),this._fxaaPass.disable(),this._smaaPass.disable()),r.bindFramebuffer(o),this.renderHUD("notOccluded"),this.renderHighlights(e,o),this._sliceHelper.plane=s,this._isRendering=!1},e.prototype.renderDraped=function(e){this._stats.reset(),this.renderGeometryPass(0,e)},e.prototype.prepareRender=function(e){this._renderPlugins.prepareRender(e)},e.prototype.renderShadowMap=function(e){var t=this._shadowMap,r=e.camera,i=e.fbo,o=e.lightDirection;if(t.enabled){a.ENABLE_PROFILE_DEPTH_RANGE&&n.begin("depthRange");var s=this.computeDepthRange(r);a.ENABLE_PROFILE_DEPTH_RANGE&&n.end("depthRange"),t.prepare(r,o,s);for(var l=t.getCascades(),c=0;c<l.length;++c){var u=l[c];u.camera.setGLViewport(this._rctx),e.camera=u.camera,this.renderGeometryPass(3,e)}e.camera=r,t.finish(i),r.setGLViewport(this._rctx)}t.bindAll(this._programRep)},e.prototype.computeDepthRange=function(e){var t=c.depthRangeFromScene(e,this._content,this._stage.getLayers());return l.union(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t},e.prototype.renderGeometryPass=function(e,t){this._isRendering=!0;var r=t.camera;this.updateGlobalUniforms(r.projectionMatrix),this._renderContext.pass=e,this._renderContext.camera=r,"draped"===this._mode?this.renderGeometryPassDraped(this._renderContext):this.renderGeometryPassScene(this._renderContext),this._isRendering=!1},e.prototype.renderGeometryPassDraped=function(e){var t=this,r=e.camera;this._bindParameters.view=r.viewMatrix,this._bindParameters.proj=r.projectionMatrix,this._bindParameters.viewInvTransp=r.viewInverseTransposeMatrix,R[0]=r.near,R[1]=r.far,this._bindParameters.nearFar=R,this._bindParameters.lightingData=e.lightingData,this._bindParameters.viewport=r.fullViewport,this._bindParameters.pixelRatio=r.pixelRatio,this._bindParameters.slicePlane=e.sliceHelper&&e.sliceHelper.plane,this._bindParameters.highlightDepthTexture=this.getFallbackDepthTexture(),this._orderedMaterialRenderers.forEach(function(r){r.render(null,e,t._bindParameters)})},e.prototype.renderGeometryPassScene=function(e){this.renderGeometrySlotsPt1(e),this.renderTransparentTerrain(e)},e.prototype.renderGeometrySlotsPt1=function(e){this._renderPlugins.render(1,e),this.renderInternalSlot(2,e),this._renderPlugins.render(3,e),this.renderInternalSlot(4,e),this._renderPlugins.render(5,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep),this._renderPlugins.render(12,this._renderContext),this.renderInternalSlot(6,e),this._renderPlugins.render(7,e),e.ssaoHelper&&e.ssaoHelper.bindAll(this._programRep)},e.prototype.renderTransparentTerrain=function(e){return this._renderPlugins.render(8,e)},e.prototype.renderHUDVisibility=function(e){var t=this,r=S.shouldRenderVisibilityDuringRenderPass(e.pass),n=e.offscreenRenderingHelper&&e.offscreenRenderingHelper.enabled,i=!1;return r&&n&&e.offscreenRenderingHelper.renderHUDVisibility(function(){i=t.renderInternalSlot(10,e)}),i},e.prototype.renderHUD=function(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this.renderInternalSlot(18,this._renderContext),this.renderInternalSlot(15,this._renderContext),this.renderInternalSlot(16,this._renderContext)},e.prototype.renderHighlights=function(e,t){var r=this,n=this._highlightHelper;if(n&&n.enabled&&(this.hasHighlights||this._renderPlugins.needsHighlight())){var i=null;n.profilingCallback&&(i=w.startMeasurement(this._renderContext.rctx));var a=this._offscreenRendering,o=a.renderToTargets(function(){r.renderGeometryPass(4,e),r._rctx.clearSafe(256),r.renderHUD("both")},a.highlight,a.tmpDepth,[0,0,0,0],!0);n.render(e.camera,o,t),null!==i&&n.profilingCallback&&i.stop(function(e){n.profilingCallback&&n.profilingCallback(e)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)},e.prototype.renderOccluded=function(){var e=this;if(this._materialRenderers.forEach(function(e,t){t&&t.isVisible()&&1!==t.renderOccluded&&M.push(t)}),0!==M.length){var t=this._offscreenRendering,r=this._renderContext,n=function(n,i){r.renderOccludedMask=i,t.renderToTargets(function(){e.renderInternalSlot(4,r,M),e.renderInternalSlot(6,r,M),e.renderInternalSlot(9,r,M)},t.tmpColor,t.tmpDepth,[0,0,0,0],!0),r.resetRenderOccludedMask(),t.compositeOccludedOntoMain(n)};r.pass=0,n(.4,4),n(.5,2),n(1,8),M.length=0}},e.prototype.renderInternalSlot=function(e,t,r){this._bindParameters.view=t.camera.viewMatrix,this._bindParameters.proj=t.camera.projectionMatrix,this._bindParameters.viewInvTransp=t.camera.viewInverseTransposeMatrix,this._bindParameters.cameraAboveGround=t.camera.aboveGround,this._bindParameters.fovY=t.camera.fovY,R[0]=t.camera.near,R[1]=t.camera.far;var n=this._renderContext.offscreenRenderingHelper;return this._bindParameters.nearFar=R,this._bindParameters.lightingData=t.lightingData,this._bindParameters.viewport=t.camera.fullViewport,this._bindParameters.shadowMap=t.shadowMap,this._bindParameters.shadowMappingEnabled=!!t.shadowMap&&t.shadowMap.enabled,this._bindParameters.ssaoEnabled=!!t.ssaoHelper&&t.ssaoHelper.enabled,this._bindParameters.pixelRatio=t.camera.pixelRatio,this._bindParameters.slicePlane=t.sliceHelper&&t.sliceHelper.plane,this._bindParameters.hudVisibilityTexture=n?n.hudVisibilityTexture:null,this._bindParameters.highlightDepthTexture=n&&n.depthTexture||this.getFallbackDepthTexture(),this.renderInternalSlotMaterials(e,t,r)},e.prototype.renderInternalSlotMaterials=function(e,t,n){var i=this,a=!1;return r.isSome(n)?n.forEach(function(r){if(O(r,t)){var n=i._materialRenderers.get(r);a=n.render(e,t,i._bindParameters)||a}}):this._materialRenderers.forEach(function(r,n){O(n,t)&&(a=r.render(e,t,i._bindParameters)||a)}),a},e.prototype.updateGlobalUniforms=function(e){for(var t=this._programRep.getProgramsUsingUniform("proj"),r=0;r<t.length;r++)t[r].setUniformMatrix4fv("proj",e);if(this._lighting){t=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r]);t=this._programRep.getProgramsUsingUniform("lightDirection");for(r=0;r<t.length;r++)this._lighting.setUniforms(t[r])}},e.prototype.sortOrderedMaterialRenderers=function(){"draped"===this._mode&&this._orderedMaterialRenderers.sort(function(e,t){return t.renderPriority()-e.renderPriority()})},e.prototype.getFallbackDepthTexture=function(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new C(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))),this._fallbackDepthStencilTexture},e.prototype.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}},e.prototype.forEachRenderGeometry=function(e){this._content.forEach(function(t,r){e(t)})},e}();!function(e){var t=function(){function e(){this.reset()}return e.prototype.reset=function(){this.trianglesRendered=0,this.drawCallsInstanced=0,this.drawCallsAngleInstanced=0,this.drawCallsMerged=0,this.drawCallsPreinterleaved=0,this.drawCallsFragmented=0,this.drawCallsHighlight=0,this.instancesDrawnAngle=0,this.VBOallocatedSize=0,this.VBOoptimalSize=0,this.VBOusedSize=0},e}();e.RenderStats=t}(A||(A={}));var R=i.vec2f64.create(),M=[];return A}.apply(null,n))||(e.exports=i)},FMAd:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zbgD"),r("U+8K")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return i.glslifyDefineMap({VERTEX_COLORS:e.vertexColors,SLICE:e.slice})};t.colorPass={name:"color-color",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/color/color.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/color/color.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},FNtW:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("W0kZ"),r("05NA")],void 0===(i=function(e,t,r,n){return function(){function e(t){this.supportsEdges=!1,this._parentStage=null,this._visible=!0,this._renderOccluded=1,this._renderPriority=0,this.id=e._idGen.gen(t)}return Object.defineProperty(e.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0}),e.prototype.addParentStage=function(e){this._parentStage=e},e.prototype.removeParentStage=function(e){this._parentStage=null},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0}),e.prototype.isVisibleInPass=function(e){return!0},e.prototype.isVisible=function(){return this._visible},e.prototype.notifyDirty=function(e){this.parentStage&&this.parentStage.notifyDirty(n.MATERIAL,this,e)},e._idGen=new r,e}()}.apply(null,n))||(e.exports=i)},FU3N:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("CIy2")],void 0===(i=function(e,t,r,n){function i(e,t){return e+"_"+t}var a=function(){function e(e){this.refCnt=0,this.glMaterial=e}return e.prototype.incRefCnt=function(){++this.refCnt},e.prototype.decRefCnt=function(){--this.refCnt,n.assert(this.refCnt>=0)},e.prototype.getRefCnt=function(){return this.refCnt},e.prototype.getGLMaterial=function(){return this.glMaterial},e}(),o=function(){function e(e,t){this._textureRep=e,this._programRep=t,this._id2glMaterialRef=new Map}return e.prototype.aquire=function(e,t){var r,n=i(e.id,t),o=this._id2glMaterialRef.get(n);if(null==o){var s=e.getGLMaterials()[t];r=s?new s(e,this._programRep,this._textureRep):void 0,o=new a(r),this._id2glMaterialRef.set(n,o)}else r=o.getGLMaterial();return o.incRefCnt(),r&&this.increaseProgramReferences(r),r},e.prototype.release=function(e,t){var r=i(e,t),n=this._id2glMaterialRef.get(r);if(n.decRefCnt(),0===n.getRefCnt()){var a=n.getGLMaterial();a&&(this.decreaseProgramReferences(a),a.dispose()),this._id2glMaterialRef.delete(r)}},e.prototype.updateMaterialParameters=function(e){for(var t=0,r=s;t<r.length;t++){var n=r[t],a=this._id2glMaterialRef.get(i(e,n));a&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())}},e.prototype.updateParamsForMat=function(e){e.updateParameters&&(this.decreaseProgramReferences(e),e.updateParameters(),this.increaseProgramReferences(e))},e.prototype.increaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this._programRep,n=0;n<t.length;n++)r.increaseRefCount(t[n])},e.prototype.decreaseProgramReferences=function(e){for(var t=e.getPrograms(),r=this._programRep,n=0;n<t.length;n++)r.decreaseRefCount(t[n])},e}(),s=r.tuple("color","depth","depthShadowMap","normal","highlight");return o}.apply(null,n))||(e.exports=i)},Fsr7:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("VfPl"),r("2B1V")],void 0===(i=function(e,t,r,n,i){function a(e){var t=new Array;return e.fields.forEach(function(e,n){var i=r({},e,{constructor:s(e.constructor)});t.push([n,i])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function o(e){var t=i.newLayout();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(function(e){return t.fields.set(e[0],r({},e[1],{constructor:l(e[1].constructor)}))}),t}function s(e){return e.ElementType+"_"+e.ElementCount}function l(e){return u.get(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.packInterleavedBuffer=function(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:a(e.layout)}},t.unpackInterleavedBuffer=function(e){return o(e.layout).createView(e.buffer)},t.packLayout=a,t.unpackLayout=o;var c=[n.BufferViewFloat,n.BufferViewVec2f,n.BufferViewVec3f,n.BufferViewVec4f,n.BufferViewMat3f,n.BufferViewMat4f,n.BufferViewFloat64,n.BufferViewVec2f64,n.BufferViewVec3f64,n.BufferViewVec4f64,n.BufferViewMat3f64,n.BufferViewMat4f64,n.BufferViewUint8,n.BufferViewVec2u8,n.BufferViewVec3u8,n.BufferViewVec4u8,n.BufferViewUint16,n.BufferViewVec2u16,n.BufferViewVec3u16,n.BufferViewVec4u16,n.BufferViewUint32,n.BufferViewVec2u32,n.BufferViewVec3u32,n.BufferViewVec4u32,n.BufferViewInt8,n.BufferViewVec2i8,n.BufferViewVec3i8,n.BufferViewVec4i8,n.BufferViewInt16,n.BufferViewVec2i16,n.BufferViewVec3i16,n.BufferViewVec4i16,n.BufferViewInt32,n.BufferViewVec2i32,n.BufferViewVec3i32,n.BufferViewVec4i32],u=new Map;c.forEach(function(e){return u.set(s(e),e)})}.apply(null,n))||(e.exports=i)},Fzzg:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("MYn5")],void 0===(i=function(e,t,r){function n(e,t,n,i,a,o){for(var s=r.getStride(a,o),l=n,c=n+s,u=0,d=0,f=0,p=0,h=0,v=0,m=i-1;v<m;v++,l+=s,c+=s){var g=t[l],y=t[l+1],b=t[l+2],x=t[c],_=t[c+1],S=t[c+2],w=g*_-x*y;p+=w,u+=(g+x)*w,d+=(y+_)*w,a&&(f+=(b+S)*(w=g*S-x*b),h+=w),g<e[0]&&(e[0]=g),g>e[1]&&(e[1]=g),y<e[2]&&(e[2]=y),y>e[3]&&(e[3]=y),a&&(b<e[4]&&(e[4]=b),b>e[5]&&(e[5]=b))}if(p>0&&(p*=-1),h>0&&(h*=-1),!p)return null;var C=[u,d,.5*p];return a&&(C[3]=f,C[4]=.5*h),C}function i(e,t,n,i,c){for(var u=r.getStride(i,c),d=t,f=t+u,p=0,h=0,v=0,m=0,g=0,y=n-1;g<y;g++,d+=u,f+=u){var b=e[d],x=e[d+1],_=e[d+2],S=e[f],w=e[f+1],C=e[f+2],P=i?o(b,x,_,S,w,C):a(b,x,S,w);if(P)if(p+=P,i){h+=P*(E=l(b,x,_,S,w,C))[0],v+=P*E[1],m+=P*E[2]}else{var E;h+=P*(E=s(b,x,S,w))[0],v+=P*E[1]}}return p>0?i?[h/p,v/p,m/p]:[h/p,v/p]:n>0?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function a(e,t,r,n){var i=r-e,a=n-t;return Math.sqrt(i*i+a*a)}function o(e,t,r,n,i,a){var o=n-e,s=i-t,l=a-r;return Math.sqrt(o*o+s*s+l*l)}function s(e,t,r,n){return[e+.5*(r-e),t+.5*(n-t)]}function l(e,t,r,n,i,a){return[e+.5*(n-e),t+.5*(i-t),r+.5*(a-r)]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCentroidOptimizedGeometry=function(e,t,a,o){if(!t||!t.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);for(var s=e.coords,l=[],c=a?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],u=t.lengths,d=t.coords,f=r.getStride(a,o),p=0,h=0,v=u;h<v.length;h++){var m=v[h],g=n(c,d,p,m,a,o);g&&l.push(g),p+=m*f}if(l.sort(function(e,t){var r=e[2]-t[2];return 0===r&&a&&(r=e[4]-t[4]),r}),l.length){var y=6*l[0][2];s[0]=l[0][0]/y,s[1]=l[0][1]/y,a&&(y=6*l[0][4],s[2]=0!==y?l[0][3]/y:0),(s[0]<c[0]||s[0]>c[1]||s[1]<c[2]||s[1]>c[3]||a&&(s[2]<c[4]||s[2]>c[5]))&&(s.length=0)}if(!s.length){var b=t.lengths[0]?i(d,0,u[0],a,o):null;if(!b)return null;s[0]=b[0],s[1]=b[1],a&&b.length>2&&(s[2]=b[2])}return e},t.lineCentroid=i}.apply(null,n))||(e.exports=i)},GG08:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("0LE5"),r("AzkI"),r("JjCO")],void 0===(i=function(e,t,r,n,i){function a(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function o(e,t){return void 0===t&&(t=a()),s(e[0],e[1],e[2],e[3],t)}function s(e,t,r,n,i){return void 0===i&&(i=a()),i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function l(e,t,n){void 0===n&&(n=a()),r.vec3.copy(n,t);var i=r.vec3.dot(t,t);return Math.abs(i-1)>1e-5&&i>1e-12&&r.vec3.scale(n,n,1/Math.sqrt(i)),c(n,e,n),n}function c(e,t,n){return e!==n&&o(e,n),n[3]=-r.vec3.dot(n,t),n}function u(e,t,n,o){return void 0===o&&(o=a()),l(n,r.vec3.cross(i.sv3d.get(),t,e),o)}function d(e,t,n){var a=r.vec3.scale(i.sv3d.get(),e,r.vec3.dot(e,t));return r.vec3.subtract(n,t,a),n}function f(e,t){return r.vec3.dot(e,t)+e[3]}function p(e,t,i,a,o,s){var l=r.vec3.dot(e,i);if(0===l)return!1;var c=-(r.vec3.dot(e,t)+e[3])/l;return o&&(c=a?Math.max(0,c):n.clamp(c,0,1)),!(c<0||!a&&c>1||(r.vec3.add(s,t,r.vec3.scale(s,i,c)),0))}Object.defineProperty(t,"__esModule",{value:!0}),t.create=a,t.wrap=function(e,t,r,n){return s(e,t,r,n,i.sv4d.get())},t.copy=o,t.fromValues=s,t.fromNormalAndOffset=function(e,t,n){return void 0===n&&(n=a()),r.vec3.copy(n,e),n[3]=t,n},t.fromPositionAndNormal=l,t.fromPoints=function(e,t,n,o){return void 0===o&&(o=a()),u(r.vec3.subtract(i.sv3d.get(),e,t),r.vec3.subtract(i.sv3d.get(),n,t),e,o)},t.setOffsetFromPoint=c,t.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},t.fromVectorsAndPoint=u,t.intersectRay=function(e,t,r){return p(e,t.origin,t.direction,!0,!1,r)},t.intersectLineSegment=function(e,t,r){return p(e,t.origin,t.vector,!1,!1,r)},t.intersectLineSegmentClamp=function(e,t,r){return p(e,t.origin,t.vector,!1,!0,r)},t.isSphereFullyInside=function(e,t){var r=t.center,n=t.radius;return f(e,r)-n>=0},t.isSphereFullyOutside=function(e,t){var r=t.center,n=t.radius;return f(e,r)+n<0},t.isPointInside=function(e,t){return f(e,t)>=0},t.isPointOutside=function(e,t){return f(e,t)<0},t.isAABBFullyInside=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5];return e[0]*(e[0]>0?r:a)+e[1]*(e[1]>0?n:o)+e[2]*(e[2]>0?i:s)+e[3]>=0},t.clip=function(e,t){var n=r.vec3.dot(e,t.ray.direction),i=-f(e,t.ray.origin);if(i<0&&n>=0)return!1;if(n>-1e-6&&n<1e-6)return i>0;if((i<0||n<0)&&!(i<0&&n<0))return!0;var a=i/n;return n>0?a<t.c1&&(t.c1=a):a>t.c0&&(t.c0=a),t.c0<=t.c1},t.projectPoint=function(e,t,n){var a=r.vec3.scale(i.sv3d.get(),e,-e[3]),o=d(e,r.vec3.subtract(i.sv3d.get(),t,a),i.sv3d.get());return r.vec3.add(n,o,a),n},t.projectVector=d,t.distance=function(e,t){return Math.abs(f(e,t))},t.signedDistance=f,t.UP=[0,0,1,0]}.apply(null,n))||(e.exports=i)},GNH0:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q2wQ"),r("HZ3d"),r("WYKK"),r("SyoC"),r("Rdxj"),r("WRgd"),r("lRq4"),r("ZcgO"),r("yVFQ"),r("mmEe")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d){function f(e,t){for(var r=new Array(e),n=0;n<r.length;n++)r[n]=new Array(t);return r}var p=new a(Array,function(e){return s.set(e,s.ZERO)},null,10,5),h=l.create();return function(){function e(e,t,r,n){this.addedToSpatialIndex=!1,this._labelGraphics=[],this._auxiliaryGraphics=[],this._visibilityFlags=f(2,4),this._featureExpressionFeature=null,this.extent=null,++t.referenced,this.graphics3DSymbol=t,this.graphic=e,this._graphics=r,this._featureExpressionFeature=u.createFeature(e,n)}return e.prototype.initialize=function(e,t){var r=this;this._layer=e,this._stage=t,this.forEachSymbolLayerGraphic(function(n){n.initialize(e,t),n.setVisibility(r.isVisible())})},e.prototype.destroy=function(){this.forEachSymbolLayerGraphic(function(e){return e.destroy()}),this._graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null},Object.defineProperty(e.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!0,configurable:!0}),e.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(e){return e.destroy()}),this._labelGraphics.length=0},e.prototype.addLabelGraphic=function(e,t,r){this._labelGraphics.push(e),e.initialize(t,r),e.setVisibility(this.isVisible(1))},e.prototype.addAuxiliaryGraphic=function(e){this._auxiliaryGraphics.push(e),this._layer&&(e.initialize(this._layer,this._stage),e.setVisibility(this.isVisible()))},e.prototype.isDraped=function(){var e=!1;return this.forEachSymbolLayerGraphic(function(t){"draped"===t.type&&(e=!0)}),e},e.prototype.isVisible=function(e,t){void 0===e&&(e=0);for(var r=0;r<=e;r++)for(var n=this._visibilityFlags[r],i=0;i<n.length;++i)if(!1===n[i]&&i!==t)return!1;return!0},e.prototype.hasVisibilityFlag=function(e,t){return null!=this._visibilityFlags[t][e]},e.prototype.setVisibilityFlag=function(e,t,r){var n=this.isVisible(r);this._visibilityFlags[r][e]=t;var i=this.isVisible(r);if(n===i)return!1;if(1===r)this.forEachLabelGraphic(function(e){return e.setVisibility(i)});else{this.forEachSymbolLayerGraphic(function(e){return e.setVisibility(i)});var a=this.isVisible(1);this.forEachLabelGraphic(function(e){return e.setVisibility(a)})}return!0},e.prototype.clearVisibilityFlag=function(e,t){return void 0===t&&(t=0),this.setVisibilityFlag(e,void 0,t)},e.prototype.getBSRadius=function(){var e=0;return this.forEachSymbolLayerGraphic(function(t){e=Math.max(e,t.getBSRadius())}),e},e.prototype.getCenterObjectSpace=function(e){return void 0===e&&(e=o.vec3f64.create()),this._graphics[0].getCenterObjectSpace(e)},e.prototype.computeExtent=function(e){if(!this.extent){this.extent=l.create();var t=this.graphic.geometry,r=t.spatialReference;if(c.computeAABR(t,this.extent),!r.equals(e)&&!d.boundingRectToBoundingRect(this.extent,r,this.extent,e))return this.extent=null,!1}return!0},Object.defineProperty(e.prototype,"usedMemory",{get:function(){var e=this,t=0;return this.forEachSymbolLayerGraphic(function(r){var n=r.graphics3DSymbolLayer.complexity,i="draped"===r.type?n.memory.draped:n.memory;t+=i.bytesPerFeature,i.bytesPerCoordinate&&(t+=c.numVertices(e.graphic.geometry)*i.bytesPerCoordinate)}),t},enumerable:!0,configurable:!0}),e.prototype.getProjectedBoundingBox=function(e,t,a,o){return n(this,void 0,void 0,function(){var c=this;return r(this,function(u){switch(u.label){case 0:return o||(o={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),o.boundingBox?s.empty(o.boundingBox):o.boundingBox=s.empty(),o.requiresDrapedElevation=!1,[4,i.forEach(this._graphics,function(i){return n(c,void 0,void 0,function(){var n,l,c;return r(this,function(r){switch(r.label){case 0:return i?(n="draped"===i.type?t:e,l=p.acquire(),[4,i.getProjectedBoundingBox(n,a,o.screenSpaceObjects,l)]):[2];case 1:return c=r.sent(),isFinite(c[2])&&isFinite(c[5])||(o.requiresDrapedElevation=!0),c&&s.expand(o.boundingBox,l),p.release(l),[2]}})})})];case 1:return u.sent(),s.allFinite(o.boundingBox)||l.allFinite(s.toRect(o.boundingBox,h))?[2,o]:[2,null]}})})},e.prototype.needsElevationUpdates=function(){for(var e=0,t=this._graphics;e<t.length;e++){if((i=t[e])&&("object3d"===i.type||"lod-instance"===i.type)&&i.needsElevationUpdates)return!0}for(var r=0,n=this._labelGraphics;r<n.length;r++){var i;if((i=n[r])&&i.needsElevationUpdates)return!0}return!1},e.prototype.alignWithElevation=function(e,t){var r=this;this.forEachRenderedGraphic(function(n){"object3d"!==n.type&&"lod-instance"!==n.type||n.alignWithElevation(e,t,r._featureExpressionFeature)})},e.prototype.addHighlight=function(e,t){this.forEachSymbolLayerGraphic(function(r){return r.addHighlight(e,t)})},e.prototype.removeHighlight=function(e){this.forEachSymbolLayerGraphic(function(t){return t.removeHighlight(e)})},e.prototype.forEachGraphicList=function(e,t){e.forEach(function(e,r){return e&&t(e,r)})},e.prototype.forEachSymbolLayerGraphic=function(e){this.forEachGraphicList(this._graphics,e),this.forEachGraphicList(this._auxiliaryGraphics,e)},e.prototype.forEachLabelGraphic=function(e){this.forEachGraphicList(this._labelGraphics,e)},e.prototype.forEachRenderedGraphic=function(e){this.forEachSymbolLayerGraphic(e),this.forEachLabelGraphic(e)},e}()}.apply(null,n))||(e.exports=i)},Geb9:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("wKWA"),r("B294")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.MAX_INDEX_COUNT=65536;var i=function(){function e(e,i){void 0===i&&(i=1),this.textureBuffer=new n.TextureBackedBuffer(e,i),this.indexManager=new r.SimpleIndexManager(t.MAX_INDEX_COUNT)}return e.prototype.dispose=function(){this.textureBuffer.dispose(),this.textureBuffer=void 0},Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0}),e.prototype.aquireIndex=function(){var e=this.indexManager.aquire();return this.textureBuffer.resizeToFit(e),e},e.prototype.releaseIndex=function(e){this.indexManager.release(e)},e}();t.ManagedTextureBackedBuffer=i}.apply(null,n))||(e.exports=i)},GntT:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.elementTypeSize=function(e){switch(e){case"u8":return 1;case"u16":return 2;case"u32":return 4;case"i8":return 1;case"i16":return 2;case"i32":case"f32":return 4;case"f64":return 8;default:r.neverReached(e)}},t.isSigned=function(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:r.neverReached(e)}},t.isInteger=function(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:r.neverReached(e)}},t.maximumValue=function(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:r.neverReached(e)}}}.apply(null,n))||(e.exports=i)},GyfB:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("0LE5"),r("JjCO"),r("18xY")],void 0===(i=function(e,t,r,n,i){function a(e){return void 0===e&&(e=t.UP),[e[0],e[1],e[2],e[3]]}function o(e,t,r,n,i){return void 0===i&&(i=a()),i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}Object.defineProperty(t,"__esModule",{value:!0}),t.create=a,t.wrap=function(e,t,r,i){return o(e,t,r,i,n.sv4d.get())},t.wrapAxisAngle=function(e,t){return o(e[0],e[1],e[2],t,n.sv4d.get())},t.copy=function(e,t){return void 0===t&&(t=a()),o(e[0],e[1],e[2],e[3],t)},t.fromValues=o,t.fromAxisAndAngle=function(e,t,n){return void 0===n&&(n=a()),r.vec3.copy(n,e),n[3]=t,n},t.fromPoints=function(e,t,n){return void 0===n&&(n=a()),r.vec3.cross(n,e,t),r.vec3.normalize(n,n),n[3]=i.angle(e,t),n},t.UP=[0,0,1,0]}.apply(null,n))||(e.exports=i)},Gz8v:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*o,u=0;u<s;++u)n[l]=a[c],n[l+1]=a[c+1],n[l+2]=a[c+2],n[l+3]=a[c+3],l+=i,c+=o},t.fill=function(e,t,r,n,i,a){for(var o=e.typedBuffer,s=e.typedBufferStride,l=a?a.count:e.count,c=(a&&a.dstIndex?a.dstIndex:0)*s,u=0;u<l;++u)o[c]=t,o[c+1]=r,o[c+2]=n,o[c+3]=i,c+=s}}.apply(null,n))||(e.exports=i)},HSGS:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("xhoE"),r("4w2c"),r("0LE5"),r("Rdxj"),r("MzcX"),r("W7eI")],void 0===(i=function(e,t,r,n,i,a,o,s,l){function c(e){var t=f;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],h[0]=5381;for(var r=0;r<p.length;r++)h[0]=31*h[0]+p[r];return h[0]}function u(e,t){var r=e<0?-1:1;return Math.pow(Math.abs(e),t)*r}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(){}return e.prototype.updateSettings=function(e){this.settings=e},e.prototype.write=function(e,t,r){var n=c(r);v.seed=n;var i=v.getIntRange(0,255),a=v.getIntRange(0,this.settings.variants-1),o=v.getFloat(),s=255*(.5*u(-(1-Math.min(o/.7,1))+Math.max(0,o-.7)/(1-.7),1.2)+.5);e.position0.setVec(t,r.position0),e.position1.setVec(t,r.position1),e.componentIndex.set(t,r.componentIndex),e.variantOffset.set(t,i),e.variantStroke.set(t,a),e.variantExtension.set(t,s)},e.prototype.trim=function(e,t){return e.slice(0,t)},e}();t.CommonBufferWriter=d;var f=new Float32Array(6),p=new Uint32Array(f.buffer),h=new Uint32Array(1),v=new i,m=function(){function e(){this.commonWriter=new d}return e.prototype.updateSettings=function(e){this.commonWriter.updateSettings(e)},e.prototype.allocate=function(e){return l.RegularEdgeInstancesLayout.createBuffer(e)},e.prototype.write=function(e,t,r){this.commonWriter.write(e,t,r),a.vec3.add(y,r.faceNormal0,r.faceNormal1),a.vec3.normalize(y,y),e.normal.setVec(t,y)},e.prototype.trim=function(e,t){return this.commonWriter.trim(e,t)},e.Layout=l.RegularEdgeInstancesLayout,e.glLayout=s.glLayout(l.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1}),e}();t.RegularEdgeBufferWriter=m;var g=function(){function e(){this.commonWriter=new d}return e.prototype.updateSettings=function(e){this.commonWriter.updateSettings(e)},e.prototype.allocate=function(e){return l.SilhouetteEdgeInstancesLayout.createBuffer(e)},e.prototype.write=function(e,t,r){this.commonWriter.write(e,t,r),e.normalA.setVec(t,r.faceNormal0),e.normalB.setVec(t,r.faceNormal1)},e.prototype.trim=function(e,t){return this.commonWriter.trim(e,t)},e.Layout=l.SilhouetteEdgeInstancesLayout,e.glLayout=s.glLayout(l.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1}),e}();t.SilhouetteEdgeBufferWriter=g;var y=o.vec3f64.create()}.apply(null,n))||(e.exports=i)},HbaO:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultIconElevationOffset=1,t.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2}.apply(null,n))||(e.exports=i)},I67D:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xTBS"),r("AzkI"),r("eHCP"),r("05NA"),r("Xih7"),r("cjy9"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a,o,s,l){var c=l.assert,u=l.logWithBase;return function(){function e(){for(var e in this.dirtySet=new o(this),this._uniqueIdx=0,this._id2origin={},this.content={},a)this.content[a[e]]={}}return e.prototype.getAll=function(e){var t=this.content[e];return c(void 0!==t),t},e.prototype.get=function(e,t){return this.getAll(e)[t]},e.prototype.add=function(e,t){var r=this.content[e];c(void 0!==r);var n=t.id;c(null==r[n],"Model/Stage already contains object to be added"),r[n]=t,e===a.LAYER&&this.notifyDirty(e,t,"layerAdded")},e.prototype.remove=function(e,t){var r=this.content[e];c(void 0!==r);var n=r[t];return c(void 0!==n,"Model/Stage doesn't contain object to be removed"),delete r[t],e===a.TEXTURE&&n.unload(),e===a.LAYER&&this.notifyDirty(e,n,"layerRemoved"),n},e.prototype.getDirtySet=function(){return this.dirtySet},e.prototype.notifyDirty=function(e,t,r,n){this.dirtySet.handleUpdate(t,r,n)},e.prototype.getOrigin=function(e,t,r){void 0===r&&(r=10);var n=0,a=t*r/1e4;a>1&&(n=Math.ceil(u(a,2)));var o=1e4*Math.pow(2,n),s=Math.round(e[0]/o),l=Math.round(e[1]/o),c=Math.round(e[2]/o),d=n+"_"+s+"_"+l+"_"+c,f=this._id2origin[d];return null==f&&(f=i.fromValues(s*o,l*o,c*o,d),this._id2origin[d]=f),f},e.prototype.getGeometryRenderGeometries=function(e,t,r){var i=e.id,a=t.geometry,o=e.getCombinedStaticTransformation(t),l=n.maxScale(o),c=t.origin,u=t.id,d=this._uniqueIdx++,f=new s(a.data,a.boundingInfo,t.material,o,t.shaderTransformation,l,e.getCastShadow(),!!a.singleUse,i,u,d);f.origin=c||this.getOrigin(f.center,f.bsRadius),f.instanceParameters=t.instanceParameters,r.push(f)},e.prototype.updateRenderGeometryTransformation=function(e,t,r){e.getCombinedStaticTransformation(t,r.transformation),r.updateTransformation(r.transformation);var n=this.getOrigin(r.center,r.bsRadius);return r.origin!==n},e.prototype.formatDebugInfo=function(e){var t=[];if(e){for(var n in t[0]="<table>",a){var i=a[n];t[0]+="<tr><td>"+i+'</td><td style="text-align: right">'+Object.keys(this.getAll(i)).length+"</td></tr>"}t[0]+="</table>",t[1]=this.dirtySet.formatDebugInfo(!0)}else{for(var n in t[0]="",a){i=a[n];t[0]+=r.pad(String(Object.keys(this.getAll(i)).length),6," ")+" "+i+", "}t[1]=this.dirtySet.formatDebugInfo(!1)}return t},e.prototype.validateObject=function(e){for(var t=e.geometryRecords,r=0;r<t.length;++r){var n=t[r];c(null!=this.get(a.GEOMETRY,n.geometry.id)),c(null!=this.get(a.MATERIAL,n.material.id))}},e.prototype.validateLayer=function(e){for(var t=e.getObjects(),r=0;r<t.length;++r){var n=this.get(a.OBJECT,t[r].id);c(null!=n)}},e.ContentType=a,e}()}.apply(null,n))||(e.exports=i)},IZai:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KY0m")],void 0===(i=function(e,t,r){function n(e){var t=[];return e.components.forEach(function(e){t.push(e.geometry)}),r.unique(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.materialsFromLodResources=function(e){var t=[];return e.levels.forEach(function(e){e.components.forEach(function(e){t.push(e.material)})}),r.unique(t)},t.texturesFromLodResources=function(e){var t=[];return e.levels.forEach(function(e){e.components.forEach(function(e){e.textures&&t.push.apply(t,e.textures)})}),r.unique(t)},t.geometriesFromLodLevelResources=n,t.geometriesFromLodResources=function(e){var t=[];return e.levels.forEach(function(e){e.components.forEach(function(e){t.push(e.geometry)})}),r.unique(t)},t.computeFaceCount=function(e){var t=0;return n(e).forEach(function(e){t+=e.data.indexCount/3}),t}}.apply(null,n))||(e.exports=i)},IfBv:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Geb9")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){void 0===t&&(t=1),this.rctx=e,this.fieldCount=t,this.buffers=[]}return e.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(e){return 0!==e.activeCount||(e.dispose(),!1)})},e.prototype.getBuffer=function(e){for(var t=0,n=this.buffers;t<n.length;t++){var i=n[t];if(i.availableCount>=e)return i}if(e>r.MAX_INDEX_COUNT)return null;var a=new r.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);return this.buffers.push(a),a},e.prototype.updateTextures=function(){for(var e=0,t=this.buffers;e<t.length;e++)t[e].textureBuffer.updateTexture()},e}();t.BufferManager=n}.apply(null,n))||(e.exports=i)},J2BX:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("CIy2")],void 0===(i=function(e,t,r){function n(e,t,n){n&&(t/=Math.SQRT2);for(var i=new Uint8Array(4*e*e),a=0;a<e;a++)for(var o=0;o<e;o++){var s=o-.5*e+.25,l=.5*e-a-.75,c=a*e+o;if(n){var u=(s+l)/Math.SQRT2;l=(l-s)/Math.SQRT2,s=u}var d=Math.max(Math.abs(s),Math.abs(l))-.5*t;d=d/e+.5,r.packFloatRGBA(d,i,4*c)}return i}function i(e,t,n){n&&(t*=Math.SQRT2);for(var i=.5*t,a=new Uint8Array(4*e*e),o=0;o<e;o++)for(var s=0;s<e;s++){var l=s-.5*e,c=.5*e-o-1,u=o*e+s;if(n){var d=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=d}var f=void 0;f=(f=(l=Math.abs(l))>(c=Math.abs(c))?l>i?Math.sqrt((l-i)*(l-i)+c*c):c:c>i?Math.sqrt(l*l+(c-i)*(c-i)):l)/e+.5,r.packFloatRGBA(f,a,4*u)}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.createCircle=function(e,t){for(var n=e,i=new Uint8Array(4*n*n),a=n/2-.5,o=t/2,s=0;s<n;s++)for(var l=0;l<n;l++){var c=l+n*s,u=l-a,d=s-a,f=Math.sqrt(u*u+d*d)-o;f=f/e+.5,r.packFloatRGBA(f,i,4*c)}return i},t.createSquare=function(e,t){return n(e,t,!1)},t.createKite=function(e,t){return n(e,t,!0)},t.createCross=function(e,t){return i(e,t,!1)},t.createX=function(e,t){return i(e,t,!0)},t.createTriangle=function(e,t){for(var n=new Uint8Array(4*e*e),i=Math.sqrt(1.25),a=(e-t)/2,o=0;o<e;o++)for(var s=0;s<e;s++){var l=o*e+s,c=(s-a)/t,u=(o-a+.75)/t,d=-(1*c+-.5*u)/i,f=(1*(c-1)+-.5*-u)/i,p=-u,h=Math.max(d,f,p)*t/e+.5;r.packFloatRGBA(h,n,4*l)}return n}}.apply(null,n))||(e.exports=i)},J5Ri:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("xhoE"),r("FXVB"),r("oZZu"),r("W9tT"),r("ab6c"),r("0LE5"),r("vlC2"),r("Rdxj"),r("aWgr"),r("AzkI"),r("AgDx"),r("4ziW"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v){var m;!function(e){var t=function(){function e(e){this.pos=e,this.mapPos=c.vec3f32.create(),this.vRight=c.vec3f32.create(),this.vLeft=c.vec3f32.create(),this.frame={forward:c.vec3f32.create(),up:c.vec3f32.create(),right:c.vec3f32.create()},this.rotationAxis=c.vec3f32.create(),this.angle=0}return e.prototype.profileSpaceToVertexSpace=function(e,t){e[0]=t[0]*this.frame.right[0]+t[1]*this.frame.up[0],e[1]=t[0]*this.frame.right[1]+t[1]*this.frame.up[1],e[2]=t[0]*this.frame.right[2]+t[1]*this.frame.up[2]},e}();e.PathVertex=t;var r=function(){function e(){this.vertices=[],this.vertexIndices=[],this.normals=null,this.normalIndices=null,this.uvs=null,this.uvIndices=null}return e.prototype.addVertex=function(e){return this.vertices.push(s.vec2f32.clone(e)),this.vertices.length-1},e.prototype.addNormal=function(e){return this.normals||(this.normals=[],this.normalIndices=[]),this.normals.push(s.vec2f32.clone(e)),this.normals.length-1},e.prototype.addUV=function(e){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(e),this.uvs.length-1},e.prototype.addSegment=function(e,t,r,n,i,a){void 0===r&&(r=null),void 0===n&&(n=null),void 0===i&&(i=null),void 0===a&&(a=null),this.vertexIndices.push(e),this.vertexIndices.push(t),null!==r&&null!==n&&(this.normalIndices.push(r),this.normalIndices.push(n)),null!==i&&null!==a&&(this.uvIndices.push(i),this.uvIndices.push(a))},Object.defineProperty(e.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0}),e.prototype.hasNormals=function(){return null!=this.normals},e.prototype.hasUV=function(){return null!=this.uvs},e.prototype.normalize=function(){for(var e=0,t=0,r=this.vertices;t<r.length;t++){var n=r[t];e=Math.max(e,o.vec2.length(n))}for(var i=1/e,a=0,s=this.vertices;a<s.length;a++){n=s[a];o.vec2.scale(n,n,i)}},e.tube=function(t){void 0===t&&(t=20);for(var r=new e,n=0;n<t;++n){var i=2*n*Math.PI/t;r.addVertex(s.vec2f32.fromValues(1*Math.cos(i),1*Math.sin(i))),r.addUV(n/t)}r.addUV(1);for(n=0;n<t-1;++n)r.addSegment(n,n+1,null,null,n,n+1);return r.addSegment(t-1,0,null,null,t-1,t),r},e.line=function(t,r){var n=new e,i=r[0]-t[0],a=r[1]-t[1];return n.addVertex(t),n.addVertex(r),n.addNormal(s.vec2f32.fromValues(-a,i)),n.addUV(0),n.addUV(1),n.addSegment(0,1,0,0,0,1),n},e.point=function(t){var r=new e;return r.addVertex(t),r},e.wall=function(t,r){void 0===t&&(t=.2),void 0===r&&(r=1);var n=new e;return n.addVertex(s.vec2f32.fromValues(.5*-t,0)),n.addVertex(s.vec2f32.fromValues(.5*t,0)),n.addVertex(s.vec2f32.fromValues(.5*t,r)),n.addVertex(s.vec2f32.fromValues(.5*-t,r)),n.addNormal(s.vec2f32.fromValues(0,-1)),n.addNormal(s.vec2f32.fromValues(1,0)),n.addNormal(s.vec2f32.fromValues(0,1)),n.addNormal(s.vec2f32.fromValues(-1,0)),n.addUV(0),n.addUV(1),n.addSegment(0,1,0,0,0,1),n.addSegment(1,2,1,1,0,1),n.addSegment(2,3,2,2,0,1),n.addSegment(3,0,3,3,0,1),n},e.strip=function(){return this.line(s.vec2f32.fromValues(-1,0),s.vec2f32.fromValues(1,0))},e.fence=function(){return this.line(s.vec2f32.fromValues(0,0),s.vec2f32.fromValues(0,1))},e}();e.Profile=r;var a=function(e,r,n,i,a,o){this.vertices=[],this.offset=c.vec3f32.create(),l.vec3.copy(this.offset,o);for(var s=n;s<n+i;++s){var p=new t(c.vec3f32.fromValues(e[3*s+0],e[3*s+1],e[3*s+2]));l.vec3.set(p.mapPos,r[3*s+0],r[3*s+1],r[3*s+2]),this.vertices.push(p)}var v,m,g=c.vec3f32.create(),y=c.vec3f32.create(),b=c.vec3f32.create(),_=c.vec3f32.create(),S=c.vec3f32.create(),w=u.vec3f64.create(),C=c.vec3f32.create(),P=c.vec3f32.create(),E=c.vec3f32.create(),T=c.vec3f32.create(),O=d.plane.create(),A=this.vertices[0];l.vec3.set(C,0,1,0),l.vec3.subtract(y,this.vertices[1].pos,A.pos),v=0,m=l.vec3.length(y),l.vec3.normalize(y,y),a?(l.vec3.add(w,A.pos,this.offset),l.vec3.normalize(b,w)):l.vec3.set(b,0,0,1),h.makeOrthoBasisDirUpFallback(y,b,C,C,S,b,.99619469809),l.vec3.copy(_,b),l.vec3.copy(T,S),l.vec3.copy(A.vRight,y),l.vec3.copy(A.vLeft,g),l.vec3.copy(A.frame.forward,y),l.vec3.copy(A.frame.up,b),l.vec3.copy(A.frame.right,S),A.vLeftLength=v,A.vRightLength=m,A.index=0,l.vec3.cross(A.rotationAxis,A.vLeft,A.vRight),l.vec3.normalize(A.rotationAxis,A.rotationAxis),A.angle=0;for(var R=1;R<i;++R)A=this.vertices[R],l.vec3.copy(g,y),v=m,R<i-1&&(l.vec3.subtract(y,this.vertices[R+1].pos,A.pos),m=l.vec3.length(y),l.vec3.normalize(y,y)),l.vec3.add(P,g,y),l.vec3.normalize(P,P),l.vec3.add(E,this.vertices[R-1].pos,_),d.plane.fromPositionAndNormal(this.vertices[R].pos,P,O),d.plane.intersectRay(O,d.ray.wrap(E,g),w)?(l.vec3.subtract(w,w,this.vertices[R].pos),l.vec3.normalize(b,w),l.vec3.cross(S,P,b),l.vec3.normalize(S,S)):h.makeOrthoBasisDirUpFallback(P,_,T,C,S,b,.99619469809),l.vec3.copy(_,b),l.vec3.copy(T,S),l.vec3.copy(A.vRight,y),l.vec3.copy(A.vLeft,g),l.vec3.copy(A.frame.forward,P),l.vec3.copy(A.frame.up,b),l.vec3.copy(A.frame.right,S),A.vLeftLength=v,A.vRightLength=m,A.index=R,l.vec3.cross(A.rotationAxis,A.vLeft,A.vRight),l.vec3.normalize(A.rotationAxis,A.rotationAxis),l.vec3.negate(x,A.vLeft),A.angle=Math.PI-f.acos(l.vec3.dot(x,A.vRight))};e.Path=a;var m=function(){};e.Extruder=m;var P=function(){function e(){}return e.prototype.numVertices=function(e){return e.vertices.length},e.prototype.extrude=function(e,t,r){for(var n=0;n<t.vertices.length;++n){var i=t.vertices[n];i.profileSpaceToVertexSpace(g,e),r(i.pos,g,n)}},e}();e.SimpleExtruder=P;var E=function(){function e(e){void 0===e&&(e=1),this._segmentsPerRadian=e/Math.PI}return e.prototype.getNumSegments=function(e){return Math.ceil(e*this._segmentsPerRadian)},e.prototype.numVertices=function(e){for(var t=2,r=1;r<e.vertices.length-1;++r)t+=this.getNumSegments(e.vertices[r].angle)+1;return t},e.prototype.extrude=function(e,t,r){t.vertices[0].profileSpaceToVertexSpace(g,e),r(t.vertices[0].pos,g,0),l.vec3.copy(_,g);for(var n=1;n<t.vertices.length-1;++n){var a=t.vertices[n];a.profileSpaceToVertexSpace(g,e);var o=this.getNumSegments(a.angle);if(i.mat4.identity(C),i.mat4.rotate(C,C,.5*-a.angle,a.rotationAxis),l.vec3.transformMat4(S,g,C),l.vec3.dot(S,a.vRight)>=0){for(var s=0;s<o+1;++s)r(a.pos,g,n);l.vec3.copy(_,g)}else{i.mat4.identity(C),i.mat4.rotate(C,C,a.angle/o,a.rotationAxis),r(a.pos,S,n),l.vec3.copy(w,S);for(s=0;s<o;++s)l.vec3.transformMat4(w,w,C),r(a.pos,w,n);l.vec3.copy(_,w)}}var c=t.vertices.length-1;t.vertices[c].profileSpaceToVertexSpace(g,e),r(t.vertices[c].pos,g,c)},e}();e.RoundExtruder=E;var T=function(e){function t(){return e.call(this,1)||this}return n(t,e),t}(E);e.BevelExtruder=T;var O={generateUV:!1},A=function(){function e(e,t,r,n){void 0===n&&(n=O),this.options=n,this._extrusionVertexCount=0,this._extrusionNormalCount=0,this._numExtrusionVertices=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this._capNormalsOffset=0,this.profile=t,this.profile.normalize(),this.path=e,this.extruder=r,this._numExtrusionVertices=r.numVertices(e),this.numVerticesTotal=t.vertices.length*this._numExtrusionVertices,this.profile.hasNormals()?this.numNormalsTotal=this.profile.normals.length*this._numExtrusionVertices:this.numNormalsTotal=this.numVerticesTotal,this.numNormalsTotal+=2,this.originData=new Float32Array(3*this.numVerticesTotal),this.directionData=new Float32Array(4*this.numVerticesTotal),this.normalData=new Float32Array(3*this.numNormalsTotal),this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.buildGeometry(),this.buildTopology()}return e.prototype.emitVertex=function(e,t,r){this.originData[3*this._extrusionVertexCount+0]=e[0],this.originData[3*this._extrusionVertexCount+1]=e[1],this.originData[3*this._extrusionVertexCount+2]=e[2],this.directionData[4*this._extrusionVertexCount+0]=t[0],this.directionData[4*this._extrusionVertexCount+1]=t[1],this.directionData[4*this._extrusionVertexCount+2]=t[2],this.directionData[4*this._extrusionVertexCount+3]=r/(this.path.vertices.length-1),this.pathVertexData[this._extrusionVertexCount]=r,++this._extrusionVertexCount},e.prototype.emitNormal=function(e,t,r){l.vec3.normalize(y,t),this.normalData[3*this._extrusionNormalCount+0]=y[0],this.normalData[3*this._extrusionNormalCount+1]=y[1],this.normalData[3*this._extrusionNormalCount+2]=y[2],++this._extrusionNormalCount},e.prototype.buildGeometry=function(){var e=this.emitVertex.bind(this),t=this.emitNormal.bind(this);this._extrusionVertexCount=0,this._extrusionNormalCount=0;for(var r=0;r<this.profile.vertices.length;++r)this.extruder.extrude(this.profile.vertices[r],this.path,e);if(this.profile.hasNormals())for(var n=0;n<this.profile.normals.length;++n)this.extruder.extrude(this.profile.normals[n],this.path,t);else for(n=0;n<this._extrusionVertexCount;++n)l.vec3.set(y,this.directionData[4*n+0],this.directionData[4*n+1],this.directionData[4*n+2]),l.vec3.normalize(y,y),this.normalData[3*this._extrusionNormalCount+0]=y[0],this.normalData[3*this._extrusionNormalCount+1]=y[1],this.normalData[3*this._extrusionNormalCount+2]=y[2],++this._extrusionNormalCount;this._capNormalsOffset=this._extrusionNormalCount;var i=this.path.vertices[0],a=this.path.vertices[this.path.vertices.length-1];if(this.normalData[3*this._extrusionNormalCount+0]=-i.vRight[0],this.normalData[3*this._extrusionNormalCount+1]=-i.vRight[1],this.normalData[3*this._extrusionNormalCount+2]=-i.vRight[2],++this._extrusionNormalCount,this.normalData[3*this._extrusionNormalCount+0]=a.vRight[0],this.normalData[3*this._extrusionNormalCount+1]=a.vRight[1],this.normalData[3*this._extrusionNormalCount+2]=a.vRight[2],++this._extrusionNormalCount,this.profile.hasUV()&&this.options.generateUV)for(n=0;n<this.profile.uvs.length;++n)this.uvData[2*n+0]=this.profile.uvs[n],this.uvData[2*n+1]=0},e.prototype.buildTopology=function(){var e=this.profile.numSegments,t=this._numExtrusionVertices-1,r=3*(2*(e*t));this.profile.vertices.length>2&&(r+=2*(this.profile.vertices.length-2)*3),this.vertexIndices=new Uint32Array(r),this.normalIndices=new Uint32Array(r),this.pathVertexIndices=new Uint32Array(r),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(r));for(var n=0,i=0;i<e;++i){var a=S=this.profile.vertexIndices[2*i],o=E=this.profile.vertexIndices[2*i+1],s=0,l=0;this.profile.hasNormals()&&(a=this.profile.normalIndices[2*i],o=this.profile.normalIndices[2*i+1]),this.profile.hasUV()&&this.options.generateUV&&(s=this.profile.uvIndices[2*i],l=this.profile.uvIndices[2*i+1]);for(var c=0;c<t;++c){var u=S*this._numExtrusionVertices+c,d=S*this._numExtrusionVertices+c+1,f=E*this._numExtrusionVertices+c+1,p=E*this._numExtrusionVertices+c,h=a*this._numExtrusionVertices+c,v=a*this._numExtrusionVertices+c+1,m=o*this._numExtrusionVertices+c+1,g=o*this._numExtrusionVertices+c,y=s,b=s,x=l,_=l;this.vertexIndices[3*n+0]=u,this.vertexIndices[3*n+1]=d,this.vertexIndices[3*n+2]=f,this.pathVertexIndices[3*n+0]=this.pathVertexData[u],this.pathVertexIndices[3*n+1]=this.pathVertexData[d],this.pathVertexIndices[3*n+2]=this.pathVertexData[f],this.normalIndices[3*n+0]=h,this.normalIndices[3*n+1]=v,this.normalIndices[3*n+2]=m,this.vertexIndices[3*n+3]=u,this.vertexIndices[3*n+4]=f,this.vertexIndices[3*n+5]=p,this.pathVertexIndices[3*n+3]=this.pathVertexData[u],this.pathVertexIndices[3*n+4]=this.pathVertexData[f],this.pathVertexIndices[3*n+5]=this.pathVertexData[p],this.normalIndices[3*n+3]=h,this.normalIndices[3*n+4]=m,this.normalIndices[3*n+5]=g,this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices[3*n+0]=y,this.uvIndices[3*n+1]=b,this.uvIndices[3*n+2]=x,this.uvIndices[3*n+3]=y,this.uvIndices[3*n+4]=x,this.uvIndices[3*n+5]=_),n+=2}}if(this.profile.vertices.length>2){var S,w=this.profile.vertices.length-2,C=(S=0)*this._numExtrusionVertices+0,P=(S+1)*this._numExtrusionVertices-1;for(c=0;c<w;++c){var E,T=(E=c+1)*this._numExtrusionVertices+0,O=(E+1)*this._numExtrusionVertices-1,A=c+2,R=A*this._numExtrusionVertices+0,M=(A+1)*this._numExtrusionVertices-1;this.vertexIndices[3*n+0]=C,this.vertexIndices[3*n+1]=T,this.vertexIndices[3*n+2]=R,this.normalIndices[3*n+0]=this._capNormalsOffset+0,this.normalIndices[3*n+1]=this._capNormalsOffset+0,this.normalIndices[3*n+2]=this._capNormalsOffset+0,this.pathVertexIndices[3*n+0]=this.pathVertexData[C],this.pathVertexIndices[3*n+1]=this.pathVertexData[T],this.pathVertexIndices[3*n+2]=this.pathVertexData[R],++n,this.vertexIndices[3*n+0]=M,this.vertexIndices[3*n+1]=O,this.vertexIndices[3*n+2]=P,this.normalIndices[3*n+0]=this._capNormalsOffset+1,this.normalIndices[3*n+1]=this._capNormalsOffset+1,this.normalIndices[3*n+2]=this._capNormalsOffset+1,this.pathVertexIndices[3*n+0]=this.pathVertexData[M],this.pathVertexIndices[3*n+1]=this.pathVertexData[O],this.pathVertexIndices[3*n+2]=this.pathVertexData[P],++n}}},e}();e.Builder=A;var R=function(){function e(e){this.builder=e}return e.prototype.updateElevation=function(e){for(var t=this.builder.path.offset,r=this.builder.originData,n=0;n<this.builder.numVerticesTotal;++n){var i=this.builder.path.vertices[this.builder.pathVertexData[n]];b[0]=r[3*n+0]+t[0],b[1]=r[3*n+1]+t[1],b[2]=r[3*n+2]+t[2],e.setAltitude(i.elevation,b),r[3*n+0]=b[0]-t[0],r[3*n+1]=b[1]-t[1],r[3*n+2]=b[2]-t[2]}},e}();e.PathGeometry=R;var M=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.size=r,i.vertexAttributePosition=null,i.vertexAttributeNormal=null,i.vertexAttributeColor=null,i.vertexAttributePosition=new Float32Array(3*i.builder.numVerticesTotal),i.vertexAttributeNormal=i.builder.normalData,i._bakeVertexPositions(),n&&(i.vertexAttributeColor=new Uint8Array(4),i.vertexAttributeColor[0]=255*n[0],i.vertexAttributeColor[1]=255*n[1],i.vertexAttributeColor[2]=255*n[2],i.vertexAttributeColor[3]=255*(n.length>3?n[3]:1)),i}return n(t,e),t.prototype._bakeVertexPositions=function(){for(var e=0;e<this.builder.numVerticesTotal;++e)this.vertexAttributePosition[3*e+0]=this.builder.originData[3*e+0]+this.builder.directionData[4*e+0]*this.size,this.vertexAttributePosition[3*e+1]=this.builder.originData[3*e+1]+this.builder.directionData[4*e+1]*this.size,this.vertexAttributePosition[3*e+2]=this.builder.originData[3*e+2]+this.builder.directionData[4*e+2]*this.size},t.prototype.createGeometryData=function(){var e={};if(e[v.VertexAttrConstants.POSITION]=this.builder.vertexIndices,e[v.VertexAttrConstants.NORMAL]=this.builder.normalIndices,this.vertexAttributeColor){var t=e[v.VertexAttrConstants.POSITION].length;e[v.VertexAttrConstants.COLOR]=new Uint32Array(t)}var r={};return r[v.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition},r[v.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal},this.vertexAttributeColor&&(r[v.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor}),new p(r,e,p.DefaultOffsets,"triangle")},t.prototype.updateElevation=function(t){e.prototype.updateElevation.call(this,t),this._bakeVertexPositions()},t}(R);e.StaticPathGeometry=M;var I=function(e){function t(t,r,n,i){var a=e.call(this,t)||this;a.vvData=null,a.vvData=new Float32Array(4*a.builder.path.vertices.length);for(var o=0;o<a.builder.path.vertices.length;++o)a.vvData[4*o+0]=r,a.vvData[4*o+1]=n,a.vvData[4*o+2]=i,a.vvData[4*o+3]=0;return a}return n(t,e),t.prototype.createGeometryData=function(){var e={};e[v.VertexAttrConstants.POSITION]=this.builder.vertexIndices,e[v.VertexAttrConstants.AUXPOS1]=this.builder.vertexIndices,e[v.VertexAttrConstants.NORMAL]=this.builder.normalIndices,e[v.VertexAttrConstants.AUXPOS2]=this.builder.pathVertexIndices;var t={};return t[v.VertexAttrConstants.POSITION]={size:3,data:this.builder.originData},t[v.VertexAttrConstants.AUXPOS1]={size:4,data:this.builder.directionData},t[v.VertexAttrConstants.NORMAL]={size:3,data:this.builder.normalData},t[v.VertexAttrConstants.AUXPOS2]={size:4,data:this.vvData},this.builder.profile.hasUV()&&this.builder.options.generateUV&&(e[v.VertexAttrConstants.UV0]=this.builder.uvIndices,t[v.VertexAttrConstants.UV0]={size:2,data:this.builder.uvData}),new p(t,e,p.DefaultOffsets,"triangle")},t}(R);e.FastUpdatePathGeometry=I}(m||(m={}));var g=c.vec3f32.create(),y=c.vec3f32.create(),b=u.vec3f64.create(),x=c.vec3f32.create(),_=c.vec3f32.create(),S=c.vec3f32.create(),w=c.vec3f32.create(),C=a.mat4f32.create();return m}.apply(null,n))||(e.exports=i)},JUgm:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("H1tY"),r("qsST"),r("qMld"),r("0LE5"),r("Rdxj"),r("O7NG"),r("QWGo"),r("FU3N"),r("8nmy"),r("2A3h"),r("pgjK"),r("qUb7"),r("I67D"),r("QJWI"),r("Teen"),r("dlMz"),r("qLgY"),r("/f24"),r("3KT0")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_){var S=i.getLogger("esri.views.3d.webgl-engine.parts.View"),w=function(){function e(e,t,r,n){var i=this;this.options=n,this._backgroundColor=l.vec4f64.fromValues(1,1,1,1),this._lightDirection=s.vec3f64.fromValues(0,1,0),this._didRender=!1,this._needsRender=!0,this._idleSuspend=!0,this._shouldRender=!1,this._supersampleScreenshots=!0,this._screenshotQueue=[],this._container=e,this._stage=t,this._initializeContext(n);var a=g.glslifyGlobalOptions({viewingMode:n.viewingMode});this._programRepository=new f(this._rctx,a);this._textureRep=new d(t.getAll(v.ContentType.TEXTURE),this._programRepository,function(){return i._viewport.getCamera().viewport},this._rctx),this._materialRep=new u(this._textureRep,this._programRepository),this._viewport=new m(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx),this._initializeViewportCamera(),this._drapedRenderer=new c(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,r),this._initializeFrameTask()}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype._initializeFrameTask=function(){var e=this;this._frameTask={preRender:function(){p.begin(),e._stage.processDirty(),e.needsRender()?(e._shouldRender=!0,e._viewport.getCamera().setGLViewport(e._rctx),e._rctx.setClearColor.apply(e._rctx,e._backgroundColor),e._rctx.clearSafe(16640)):e._shouldRender=!1},render:function(){e._shouldRender&&(e._didRender=!0,C.lightDirection=e._lightDirection,C.disableSlice=!1,e._viewport.render(C))},postRender:function(){p.end()},update:function(){e.resetNeedsRender(),e._performScreenshots()}}},e.prototype._initializeViewportCamera=function(){var e=this._container.getBoundingClientRect(),t=this._viewport.getCamera();t.viewport[2]=e.width,t.viewport[3]=e.height,this._viewport.setCamera(t)},e.prototype._initializeContext=function(e){this._canvas=e.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var t={alpha:e.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==e.stencil||e.stencil},r=b.createContextOrErrorHTML(this._canvas,t,e.renderContext);this._gl=p.instrumentContext(r);var i={disabledExtensions:e.deactivatedWebGLExtensions||{}};this._rctx=new _(this._gl,i),!e.alpha&&this._rctx.contextAttributes.alpha&&S.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&n("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas),null!=e.supersampleScreenshots&&(this._supersampleScreenshots=e.supersampleScreenshots)},e.prototype.dispose=function(){this._viewport.dispose(),this._viewport=null,this._drapedRenderer.dispose(),this._drapedRenderer=null,this._programRepository.dispose(),this._programRepository=null,this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._container=null,this._canvas=null,this._gl=null,this._frameTask=null},e.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()},e.prototype.setNeedsRender=function(){this._didRender=!1,this._needsRender=!0},e.prototype.resetNeedsRender=function(){this._didRender&&(this._needsRender=!1,this._didRender=!1),this._viewport.resetNeedsRender(),this._textureRep.resetNeedsRender()},e.prototype.needsRender=function(){var e=this._viewport.getCamera();return 0!==e.fullWidth&&0!==e.fullHeight&&(this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender())},e.prototype.getFrameTask=function(){return this._frameTask},e.prototype.setLighting=function(e){o.vec3.set(this._lightDirection,0,0,0);for(var t=0,r=e.lights;t<r.length;t++){var n=r[t];if(n instanceof h.MainLight){o.vec3.negate(this._lightDirection,n.direction);break}}this._viewport.setLighting(e),this._needsRender=!0},e.prototype.ensureEdgeView=function(){return this._viewport.ensureEdgeView()},Object.defineProperty(e.prototype,"edgeView",{get:function(){return this._viewport.edgeView},enumerable:!0,configurable:!0}),e.prototype.getMainLightDirection=function(){return this._lightDirection},e.prototype.setViewParams=function(e){"backgroundColor"in e&&(this._needsRender=!0,this._backgroundColor=e.backgroundColor),"supersampleScreenshots"in e&&(this._supersampleScreenshots=e.supersampleScreenshots)},e.prototype.setRenderParams=function(e){this._needsRender=!0,void 0!==e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend),this._viewport.setRenderParams(e)},e.prototype.getRenderParams=function(){var e=this._viewport.getRenderParams();return e.anisotropicFiltering=this._textureRep.getMaxAnisotropy(),e.idleSuspend=this._idleSuspend,e},Object.defineProperty(e.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return"s3tc"===e?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===e&&!!this._rctx.capabilities.shaderTextureLOD},e.prototype.modify=function(e,t,r,n){this._viewport.modify(e,t,r,n)},e.prototype.setCamera=function(e){this._viewport.setCamera(e)},e.prototype.getCamera=function(){return this._viewport.getCamera()},e.prototype.getCanvas=function(){return this._canvas},e.prototype.getDrapedRenderer=function(){return this._drapedRenderer},e.prototype.takeScreenshot=function(e){var t=this,r=a.createResolver(function(){t._screenshotQueue=t._screenshotQueue.filter(function(e){return e.resolver!==r})});return this._screenshotQueue.push({settings:e,resolver:r}),this._needsRender=!0,r.promise},e.prototype.getFramebufferTexture=function(e){return this._viewport.getFramebufferTexture(e)},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._viewport.renderPlugins},enumerable:!0,configurable:!0}),e.prototype._renderScreenshotOverlay=function(e,t,r){if(this.options.renderScreenshotOverlay){e.width=t.width,e.height=t.height;var n=e.getContext("2d"),i=this._viewport.getCamera().pixelRatio*r.pixelRatio;n.save(),n.translate(0,t.height),n.scale(1,-1),r.region&&n.translate(-r.region.x,-r.region.y),n.scale(i,i),this.options.renderScreenshotOverlay(e,t),n.restore()}},e.prototype._readbackScreenshot=function(e){return e.resample?this._readbackScreenshotResampled(e):this._readbackScreenshotImmediate(e)},e.prototype._readbackScreenshotResampled=function(e){var t=e.framebufferWidth,n=e.framebufferHeight,i=e.region,a=e.resample,o=this._ensureScreenshotEncodeCanvas(),s=y.createEmptyImageData(t,n,o);this._gl.readPixels(0,0,t,n,6408,5121,new Uint8Array(s.data.buffer)),this._renderScreenshotOverlay(o,s,r({},e,{region:null}));var l=y.createEmptyImageData(i.width,i.height,o);return y.resampleHermite(s,l,!0,a.region.x,n-(a.region.y+a.region.height),a.region.width,a.region.height)},e.prototype._readbackScreenshotImmediate=function(e){var t=e.framebufferHeight,r=e.region,n=this._ensureScreenshotEncodeCanvas(),i=y.createEmptyImageData(r.width,r.height,n);return this._gl.readPixels(r.x,t-(r.y+r.height),r.width,r.height,6408,5121,new Uint8Array(i.data.buffer)),this._renderScreenshotOverlay(n,i,e),i},e.prototype._renderScreenshot=function(e){var t=null,r=this._viewport.getCamera(),n=y.screenshotSuperSampleSettings(e,this._supersampleScreenshots),i=n.framebufferWidth,a=n.framebufferHeight,o=!1,s=this._viewport.hasSlicePlane&&e.disableSlice,l=i!==r.fullWidth||a!==r.fullHeight||s;if(l){var c=r.copy();c.fullWidth=i,c.fullHeight=a,c.pixelRatio*=n.pixelRatio;var u=r.fovX-c.fovX,d=r.fovY-c.fovY;u<0&&u<d?c.fovX=r.fovX:d<0&&d<u&&(c.fovY=r.fovY),this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(c),o=!0,t=new x(this._rctx,{width:c.fullWidth,height:c.fullHeight,colorTarget:0,depthStencilTarget:3}),this._rctx.bindFramebuffer(t),c.setGLViewport(this._rctx),this._rctx.setClearColor.apply(this._rctx,this._backgroundColor),this._rctx.clearSafe(16640),this._viewport.render({lightDirection:this._lightDirection,fbo:t,camera:c,disableSlice:e.disableSlice})}var f=this._readbackScreenshot(n);if(l&&!this._rctx.contextAttributes.alpha)for(var p=3;p<f.data.length;p+=4)f.data[p]=255;return t&&t.dispose(),this._rctx.bindFramebuffer(null),o&&this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(r),f},e.prototype._performScreenshots=function(){if(0!==this._screenshotQueue.length){for(var e=0,t=this._screenshotQueue;e<t.length;e++){var r=t[e],n=r.settings;if(this._gl){var i=this._ensureScreenshotEncodeCanvas(),a=this._renderScreenshot(n),o=y.encodeResult(a,n,i,{flipY:!0,premultipliedAlpha:!0});r.resolver(o)}else r.resolver.reject()}this._screenshotQueue=[]}},e.prototype._ensureScreenshotEncodeCanvas=function(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas},Object.defineProperty(e.prototype,"test",{get:function(){return{viewport:this._viewport}},enumerable:!0,configurable:!0}),e.prototype.getGpuMemoryUsage=function(){return r({},this._viewport.getGpuMemoryUsage(),{draped:this._drapedRenderer?this._drapedRenderer.getGpuMemoryUsage():0})},e}(),C={fbo:null,camera:null,lightDirection:s.vec3f64.create(),disableSlice:!1};return w}.apply(null,n))||(e.exports=i)},JjCO:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("wSO/")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.sv2d=r.VectorStack.createVec2f64(),t.sv3d=r.VectorStack.createVec3f64(),t.sv4d=r.VectorStack.createVec4f64(),t.sm3d=r.VectorStack.createMat3f64(),t.sm4d=r.VectorStack.createMat4f64(),t.sq4d=r.VectorStack.createQuatf64()}.apply(null,n))||(e.exports=i)},JzVu:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("QDcU"),r("pcDC"),r("qsST"),r("xoE+"),r("afW+"),r("O7NG"),r("fOZq"),r("yVFQ"),r("BwdQ"),r("LiJt"),r("LFjk")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p){function h(e,t){var r=null!=e?t.attributes[e]:0;return null!=r&&isFinite(r)?r:0}Object.defineProperty(t,"__esModule",{value:!0});var v=new c,m=a.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),g=function(e){function t(t,r,n,i){var a=e.call(this)||this;return a.complexity=null,a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},a.symbol=t,a.symbolLayer=r,a._context=n,a._symbolLayerOrder=n.layerOrder,a._symbolLayerOrderDelta=n.layerOrderDelta,a._elevationContext=new c,a._material=null,a.complexity=a.computeComplexity(),a._geometryCreationWarningHandle=null,a._updateDrivenProperties(i),a._updateElevationContext(),a}return r(t,e),t.prototype.getCachedSize=function(){return null},t.prototype._logWarning=function(e){m.warn(e)},t.prototype._logGeometryCreationWarnings=function(e,t,r,n){var i=this;if(null==this._geometryCreationWarningHandle){var a=e.projectionSuccess,o=e.geometryData&&e.geometryData.polygons,l=n+" geometry failed to be created",c=null;a?!t.length||1===t.length&&!t[0].length?c=l+" (no "+r+" were defined)":Array.isArray(t)&&Array.isArray(t[0])?t.some(function(e){return 1===e.length})?c=l+" ("+r+" should contain at least 2 vertices)":o&&0===o.length&&"rings"===r&&(c=l+" (filled "+r+" should use clockwise winding - try reversing the order of vertices)"):c=l+" ("+r+" should be defined as a 2D array)":c=l+" (failed to project geometry to view spatial reference)",c&&(this._geometryCreationWarningHandle=s.schedule(function(){return i._onNextTick()}),this._logWarning(c))}},t.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null},t.prototype._validateGeometry=function(e){if("point"===e.type){var t=e;if(!o.isFinite(t.x)||!o.isFinite(t.y))return this._logWarning("point coordinate is not a valid number, graphic skipped"),!1}return!0},t.prototype._defaultElevationInfoNoZ=function(){return y},t.prototype._defaultElevationInfoZ=function(){return b},t.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();var e=this._context.layer.elevationInfo;e&&this._elevationContext.mixinApi(e);var t=this.symbolLayer&&this.symbolLayer.elevationInfo;t&&this._elevationContext.mixinApi(t),this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext},t.prototype.getDefaultElevationInfo=function(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()},t.prototype.getGeometryElevationMode=function(e,t){return void 0===t&&(t=this.getDefaultElevationInfo(e)),this._elevationContext.mode||t.mode},t.prototype.getGraphicElevationContext=function(e){var t=e.geometry,r=this.getDefaultElevationInfo(t);v.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:r.unit),v.mode=this.getGeometryElevationMode(t,r),v.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:r.offset),v.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext,this._elevationOptions.supportsOnTheGround||"on-the-ground"!==v.mode||(v.mode="relative-to-ground",v.setOffsetMeters(0),v.featureExpressionInfoContext=u.zeroContext);var n=u.createFeature(e,this._context.layer);return u.setContextFeature(v.featureExpressionInfoContext,n),v},t.prototype.prepareSymbolLayerPatch=function(e){},t.prototype.updateGeometry=function(e,t){return!1},t.prototype._getDrapedZ=function(){return-2},t.prototype._updateDrivenProperties=function(e){var t={color:!1,opacity:!1,size:!1};if(!e){var r=this._context.renderer;r&&"visualVariables"in r&&r.visualVariables&&r.visualVariables.forEach(function(e){switch(e.type){case"color":if(t.color=!0,e.stops)for(var r=0;r<e.stops.length;r++){var n=e.stops[r].color;n&&(Array.isArray(n)&&n.length>3&&255!==n[3]||void 0!==n.a&&255!==n.a)&&(t.opacity=!0)}break;case"opacity":t.opacity=!0;break;case"size":t.size=!0}})}this._drivenProperties=t},t.prototype._isPropertyDriven=function(e){return this._drivenProperties[e]},t.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var e=this._context.layer.opacity;return null==e?1:e},t.prototype._getMaterialOpacity=function(){var e=1;e*=this._getLayerOpacity();var t=this.symbolLayer&&this.symbolLayer.material;return t&&!this._isPropertyDriven("opacity")&&t.color&&(e*=t.color.a),e},t.prototype._getMaterialOpacityAndColor=function(){var e=this.symbolLayer&&this.symbolLayer.material,t=this._getMaterialOpacity(),r=!this._isPropertyDriven("color")&&e&&e.color?n.toUnitRGB(e.color):null;return d.mixinColorAndOpacity(r,t)},t.prototype._getVertexOpacityAndColor=function(e,t,r){var n=this._isPropertyDriven("color")?e.color:null,i=this._isPropertyDriven("opacity")?e.opacity:null,a=d.mixinColorAndOpacity(n,i);return r&&(a[0]*=r,a[1]*=r,a[2]*=r,a[3]*=r),t?new t(a):a},t.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"},t.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled},t.prototype.updateSymbolLayerOrder=function(e,t){this._symbolLayerOrder=e,this._symbolLayerOrderDelta=t},t.prototype.computeComplexity=function(){return f.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)},t.prototype.setDrawOrder=function(e,t,r){this.updateSymbolLayerOrder(e,t),this._material&&(this._material.renderPriority=e,r.add(this._material.id))},t.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)},t.prototype.globalPropertyChanged=function(e,t,r){switch(e){case"opacity":return this.layerOpacityChanged();case"elevationInfo":var n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,r,n);case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,r);case"pixelRatio":return this.pixelRatioChanged(t,r);default:return i.neverReachedSilent(e),!1}},t.prototype.updateGraphics3DGraphicElevationInfo=function(e,t,r){var n=this,i=!0;return e.forEach(function(e){var a=t(e);if(a){var o=e.graphic,s=n.getGraphicElevationContext(o);a.needsElevationUpdates=r(s.mode),a.elevationContext.set(s)}else i=!1}),i},t.prototype.applyRendererDiff=function(e,t){return!1},t.prototype.getFastUpdateAttrValues=function(e){if(!this._fastUpdates.enabled)return null;var t=this._fastUpdates.visualVariables,r=t.size?h(t.size.field,e):0,n=t.color?h(t.color.field,e):0,i=t.opacity?h(t.opacity.field,e):0;return l.vec4f64.fromValues(r,n,i,0)},t}(p.default);t.Graphics3DSymbolLayer=g,t.getAttributeValue=h;var y={mode:"on-the-ground",offset:0,unit:"meters"},b={mode:"absolute-height",offset:0,unit:"meters"};t.default=g}.apply(null,n))||(e.exports=i)},K9FT:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("QDcU"),r("jBNx")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.fillStyle=this.colorToRGBA(e.color),this.haloStyle=this.colorToRGB(e.halo.color)}return e.prototype.colorToRGB=function(e){return"rgb("+e.slice(0,3).map(function(e){return Math.floor(255*e)}).toString()+")"},e.prototype.colorToRGBA=function(e){return"rgba("+e.slice(0,3).map(function(e){return Math.floor(255*e)}).toString()+","+e[3]+")"},e.fromSymbol=function(t,i){void 0===i&&(i=1);var o=t.material?r.toUnitRGBA(t.material.color):a,s=t.halo&&t.halo.color&&t.halo.size>0;return new e({size:null!=t.size?n.pt2px(t.size):12,color:o,font:{family:t.font&&t.font.family?t.font.family:"sans-serif",weight:t.font&&t.font.weight?t.font.weight:"normal",style:t.font&&t.font.style?t.font.style:"normal"},halo:{size:s?n.pt2px(t.halo.size):0,color:s?r.toUnitRGBA(t.halo.color):a},pixelRatio:i})},e}();t.TextRenderParameters=i;var a=[1,1,1,1];t.default=i}.apply(null,n))||(e.exports=i)},KPBO:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dotProduct=function(e,t){for(var r=0,n=0;n<e.length;n++)r+=e[n]*t[n];return r},t.elementwiseProduct=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t[n];return r},t.scalarProduct=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t;return r},t.add=function(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]+t[n];return r}}.apply(null,n))||(e.exports=i)},L6ij:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("pcDC"),r("NfRO"),r("qsST"),r("jfWY"),r("Vx27"),r("x+x8"),r("dlMz")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u){var d=o.getLogger("esri.geometry.support.ImageMeshColor");return function(e){function t(t){var r=e.call(this)||this;return r.type="image",d.warn("esri/geometry/support/ImageMeshColor is deprecated since version 4.11. Use esri/geometry/support/MeshTexture instead."),r}var a;return r(t,e),a=t,Object.defineProperty(t.prototype,"url",{get:function(){return this._get("url")||null},set:function(e){this._set("url",e),e&&this._set("data",null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._get("data")||null},set:function(e){this._set("data",e),e&&this._set("url",null)},enumerable:!0,configurable:!0}),t.prototype.writeData=function(e,t,r,n){if(e instanceof HTMLImageElement){var i={type:"image-element",src:s.toJSON(e.src,n)};t[r]=i}else if(e instanceof HTMLCanvasElement){var a=e.getContext("2d").getImageData(0,0,e.width,e.height);i={type:"canvas-element",imageData:this.encodeImageData(a)};t[r]=i}else{i={type:"image-data",imageData:this.encodeImageData(e)};t[r]=i}},t.prototype.readData=function(e,t){switch(e.type){case"image-element":var r=new Image;return r.src=e.src,r;case"canvas-element":var n=this.decodeImageData(e.imageData),a=document.createElement("canvas");return a.width=n.width,a.height=n.height,a.getContext("2d").putImageData(n,0,0),a;case"image-data":return this.decodeImageData(e.imageData);default:i.neverReached(e)}},Object.defineProperty(t.prototype,"transparent",{get:function(){var e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this.imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this.imageDataContainsTransparent(e);if(t){var r=t.substr(t.length-4,4).toLowerCase(),n=t.substr(0,15).toLocaleLowerCase();if(".png"===r||"data:image/png;"===n)return!0}return!1},set:function(e){null!=e?this._override("transparent",e):this._clearOverride("transparent")},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new a({url:this.url,data:this.data})},t.prototype.encodeImageData=function(e){for(var t="",r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}},t.prototype.decodeImageData=function(e){for(var t=atob(e.data),r=new Uint8ClampedArray(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return u.wrapImageData(r,e.width,e.height)},t.prototype.imageDataContainsTransparent=function(e){for(var t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1},n([l.property()],t.prototype,"type",void 0),n([l.property({type:String,json:{write:s.write}})],t.prototype,"url",null),n([l.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),l.property()],t.prototype,"data",null),n([l.writer("data")],t.prototype,"writeData",null),n([l.reader("data")],t.prototype,"readData",null),n([l.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],t.prototype,"transparent",null),a=n([l.subclass("esri.geometry.support.ImageMeshColor")],t)}(l.declared(c.default,a.Identifiable))}.apply(null,n))||(e.exports=i)},LFjk:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){void 0===e&&(e=null),this._cancelCallback=e,this._callbacks=[],this._errbacks=[],this._iscancelled=!1,this._isdone=!1,this._iserr=!1,this.result=null,this.error=null}return e.prototype.cancel=function(e){this._iscancelled||this._iserr||this._isdone||(this._callbacks=[],this._errbacks=[],this._iscancelled=!0,this._cancelCallback&&this._cancelCallback(e))},e.prototype.then=function(e,t,r){if(void 0===r&&(r=null),!this._iscancelled){if(this._isdone)return void e.call(r,this.result);if(this._iserr&&t)return void t.call(r,this.result);this._callbacks.push(r?e.bind(r):e),t&&this._errbacks.push(r?t.bind(r):t)}},e.prototype.resolve=function(e){if(void 0===e&&(e=null),!(this._iscancelled||this._iserr||this._isdone)){this.result=e,this._isdone=!0;for(var t=0,r=this._callbacks;t<r.length;t++)(0,r[t])(e);this._callbacks=[],this._errbacks=[]}},e.prototype.reject=function(e){if(void 0===e&&(e=null),!(this._iscancelled||this._iserr||this._isdone)){this.error=e,this._iserr=!0;for(var t=0,r=this._errbacks;t<r.length;t++)(0,r[t])(e);this._callbacks=[],this._errbacks=[]}},e.prototype.isRejected=function(){return this._iserr},e.prototype.isFulfilled=function(){return this._isdone||this._iserr},e.prototype.isResolved=function(){return this._isdone},e.prototype.isCancelled=function(){return this._iscancelled},e}();t.PromiseLightweight=r,t.default=r}.apply(null,n))||(e.exports=i)},Lb4W:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qsST"),r("DIqE"),r("0LE5"),r("2fXB"),r("O7NG"),r("weRx"),r("/Bau"),r("CIy2"),r("TZB2"),r("/f24"),r("qbr3"),r("Zp3t"),r("Kfys")],void 0===(i=function(e,t,n,i,a,o,s,l,c,u,d,f,p,h,v){var m=n.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper"),g=function(){function e(e,t,r){this._enabled=!1,this._BLUR_F=2,this._attenuation=.5,this._radius=3,this._samples=16,this._viewportToRestore=s.vec4f64.create(),this._rctx=t,this._programRep=e,this._requestRender=r,this._emptyTexture=c.createEmptyTexture(t)}return e.prototype.dispose=function(){this._emptyTexture.dispose(),this._emptyTexture=null},Object.defineProperty(e.prototype,"isSupported",{get:function(){var e=this._rctx,t=-1!==e.parameters.versionString.indexOf("WebGL 0.93"),r=-1!==e.parameters.versionString.indexOf("WebGL 0.94");return!(t||r)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attenuation",{get:function(){return this._attenuation},set:function(e){this._attenuation=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){this._samples=e,this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0}),e.prototype.computeSSAO=function(e,t,r){if(this._noiseTexture){u.assert(this.enabled);var n=this._rctx,i=e.fullViewport,s=i[2],l=i[3],d=s/this._BLUR_F,f=l/this._BLUR_F;this._ssaoFBO.resize(s,l),this._blur0FBO.resize(d,f),this._blur1FBO.resize(d,f);var p=1*s,h=1*l;n.bindFramebuffer(this._ssaoFBO),o.vec4.copy(this._viewportToRestore,e.fullViewport),n.setViewport(0,0,s,l);var m=this._ssaoProgram,g=this._blurProgram;m.setUniform2f("rnmScale",s/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height),m.setUniform3fv("pSphere",this._samples<=8?this._data.random8:this._samples<=16?this._data.random16:this._samples<=32?this._data.random32:this._data.random64),n.bindProgram(m),n.setPipelineState(this._pipelineState);var x=this._data.minDiscrepancy,_=this._samples<x.length?x[this._samples]:5779;m.setUniform1f("numSpiralTurns",_);var S=b,w=y;u.inverseProjectionInfo(e.projectionMatrix,e.fullWidth,e.fullHeight,S,w),m.setUniform4fv("projInfo",S),m.setUniform2fv("zScale",w),m.setUniform2f("nearFar",e.near,e.far);var C=1/e.computeRenderPixelSizeAtDist(1);m.setUniform1f("projScale",1*C),m.setUniform2f("screenDimensions",p,h);var P=2*this._radius,E=a.vec3.distance(e.eye,e.center);P=20*e.computeRenderPixelSizeAtDist(E),P=Math.max(.1,P),m.setUniform1f("radius",P),m.setUniform1f("intensity",4*this._attenuation/Math.pow(P,6)),m.setUniform1i("rnm",0),m.setUniform1i("normalMap",1),m.setUniform1i("depthMap",2),n.bindTexture(this._noiseTexture,0),n.bindTexture(r,1),n.bindTexture(t,2);var T=c.createQuadVAO(this._rctx);n.bindVAO(T),n.drawArrays(5,0,v.vertexCount(T,"geometry")),n.bindTexture(this._ssaoFBO.colorTexture,0),n.setViewport(0,0,p/this._BLUR_F,h/this._BLUR_F),n.bindFramebuffer(this._blur0FBO),g.setUniform2f("screenDimensions",p,h),g.setUniform1i("tex",0),g.setUniform1i("normalMap",1),g.setUniform1i("depthMap",2),g.setUniform2f("blurSize",0,1*this._BLUR_F/h),g.setUniform1i("radius",4),g.setUniform1f("g_BlurFalloff",.08),g.setUniform2f("nearFar",e.near,e.far),E>5e4&&(C=Math.max(0,C-(E-5e4))),g.setUniform1f("projScale",C),g.setUniform2f("zScale",1,0),n.drawArrays(5,0,v.vertexCount(T,"geometry")),g.setUniform2f("blurSize",1*this._BLUR_F/p,0),n.bindFramebuffer(this._blur1FBO),n.bindTexture(this._blur0FBO.colorTexture,0),n.drawArrays(5,0,v.vertexCount(T,"geometry")),n.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}},e.prototype.setUniforms=function(e){var t=this.enabled&&this._noiseTexture,r=this._rctx;r.bindTexture(t?this._blur1FBO.colorTexture:this._emptyTexture,6),r.setActiveTexture(0),e.setUniform1i("ssaoTex",6),t?e.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):e.setUniform4f("viewportPixelSz",-1,-1,-1,-1)},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("viewportPixelSz"),r=0;r<t.length;r++)this.setUniforms(t[r])},e.prototype.selectPrograms=function(){var e=this._samples<=8?8:this._samples<=16?16:this._samples<=32?32:64;this._ssaoProgram=this._programRep.getProgram(d.ssaoPass,{samples:e}),this._blurProgram=this._programRep.getProgram(d.blurPass,{radius:4}),this._pipelineState=p.makePipelineState({colorWrite:p.defaultColorWriteParams})},e.prototype.enable=function(){var e=this;if(!this.enabled){if(!this.isSupported)return void m.warn("SSAO is not supported for this browser or hardware");this._enabled=!0,this.loadResources(function(){e._enabled&&e.initialize()})}},e.prototype.loadResources=function(e){var t=this;this._data?e():r.e(93).then(function(){var n=[r("vPu4")];(function(r){t._data=r,e()}).apply(null,n)}).catch(r.oe)},e.prototype.initialize=function(){var e=this,t={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},r={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=f.createWithAttachments(this._rctx,t,r),this._blur0FBO=f.createWithAttachments(this._rctx,t,r),this._blur1FBO=f.createWithAttachments(this._rctx,t,r),l.requestImage(this._data.noiseTexture).then(function(t){e._enabled&&(e._noiseTexture=new h(e._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:t.width,height:t.height},t),e._requestRender())}),this.selectPrograms()},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))},e.prototype.getGpuMemoryUsage=function(){return v.getGpuMemoryUsage(this._blur0FBO)+v.getGpuMemoryUsage(this._blur1FBO)+v.getGpuMemoryUsage(this._ssaoFBO)},e}(),y=i.vec2f64.create(),b=s.vec4f64.create();return g}.apply(null,n))||(e.exports=i)},LiJt:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("pcDC"),r("H1tY"),r("Os6f"),r("dQtU"),r("CIy2"),r("IZai")],void 0===(i=function(e,t,r,n,i,a,o,s,l){function c(e){for(var t=0,r=0,n={bytesPerFeature:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerCoordinate:0}},i=0,a=e;i<a.length;i++){var o=a[i];o&&(t+=o.primitivesPerFeature,r+=o.primitivesPerCoordinate,n.bytesPerFeature+=o.memory.bytesPerFeature,n.bytesPerCoordinate+=o.memory.bytesPerCoordinate,n.draped.bytesPerFeature+=o.memory.bytesPerFeature,n.draped.bytesPerCoordinate+=o.memory.bytesPerCoordinate)}return{primitivesPerFeature:t,primitivesPerCoordinate:r,memory:n}}function u(e,t){var i=d(e,t);switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,memory:i};case"fill":return"mesh-3d"===e.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,memory:i}:t.outline&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,memory:i};case"object":if(t.resource&&t.resource.href)return{primitivesPerFeature:16,primitivesPerCoordinate:0,memory:i};var o=t.resource&&t.resource.primitive||a.defaultPrimitive;return r({},f(o),{memory:i});case"path":return{primitivesPerFeature:-4,primitivesPerCoordinate:20,memory:i};case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,memory:i};default:n.neverReached(t)}}function d(e,r){var a="point-3d"===e.type;switch(r.type){case"extrude":return r.edges&&r.edges.size>0?t.memoryEstimators.EXTRUDE_EDGES:t.memoryEstimators.EXTRUDE;case"fill":return r.outline&&r.outline.size>0?t.memoryEstimators.FILL_OUTLINE:t.memoryEstimators.FILL;case"line":return t.memoryEstimators.LINE;case"path":return t.memoryEstimators.PATH;case"object":return i("enable-feature:skallweit/lod-rendering")?a?t.memoryEstimators.OBJECT_POINT_LOD:t.memoryEstimators.OBJECT_POLYGON_LOD:a?t.memoryEstimators.OBJECT_POINT:t.memoryEstimators.OBJECT_POLYGON;case"icon":case"text":return a?t.memoryEstimators.ICON_POINT:t.memoryEstimators.ICON_POLYGON;default:n.neverReached(r)}}function f(e){var t=p[e];if(t)return t;if(i("enable-feature:skallweit/lod-rendering")){var r=o.primitiveLodResources(e,null,null),n=l.geometriesFromLodLevelResources(r.levels[0]).reduce(function(e,t){return e+t.data.getIndices(s.VertexAttrConstants.POSITION).length/3},0);t={primitivesPerFeature:n,primitivesPerCoordinate:0}}else{t={primitivesPerFeature:n=o.primitiveGeometryData(e).getIndices(s.VertexAttrConstants.POSITION).length/3,primitivesPerCoordinate:0}}return p[e]=t,t}Object.defineProperty(t,"__esModule",{value:!0}),t.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerCoordinate:0}}},t.defaultSymbolComplexity=function(e){return"web-style"===e.type?t.emptySymbolComplexity:c(e.symbolLayers.toArray().map(function(t){return u(e,t)}))},t.totalSymbolComplexities=c;var p={};t.defaultSymbolLayerComplexity=u,t.defaultSymbolLayerMemoryComplexity=d,t.memoryEstimators={ICON_POINT:{bytesPerFeature:7478.781325779039,bytesPerCoordinate:0,draped:{bytesPerFeature:5712.082651558076,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9679.372971750396,bytesPerCoordinate:56.86422538239579,draped:{bytesPerFeature:7883.966873022898,bytesPerCoordinate:56.89697037586389}},OBJECT_POINT:{bytesPerFeature:5177.80657223796,bytesPerCoordinate:0,draped:{bytesPerFeature:5177.80657223796,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:7372.024890546556,bytesPerCoordinate:56.80425878144206,draped:{bytesPerFeature:7372.024890546556,bytesPerCoordinate:56.80425878144206}},OBJECT_POINT_LOD:{bytesPerFeature:1770.211558073654,bytesPerCoordinate:0,draped:{bytesPerFeature:1770.211558073654,bytesPerCoordinate:0}},OBJECT_POLYGON_LOD:{bytesPerFeature:3958.8422890890743,bytesPerCoordinate:56.88697205558441,draped:{bytesPerFeature:3958.8422890890743,bytesPerCoordinate:56.88697205558441}},LINE:{bytesPerFeature:7586.045782417972,bytesPerCoordinate:112.02132538683836,draped:{bytesPerFeature:4775.97368572266,bytesPerCoordinate:111.85995483757563}},PATH:{bytesPerFeature:7563.020535856769,bytesPerCoordinate:119.1242257528872,draped:{bytesPerFeature:7563.020535856769,bytesPerCoordinate:119.1242257528872}},FILL:{bytesPerFeature:8702.040510627665,bytesPerCoordinate:56.610361738134486,draped:{bytesPerFeature:5921.70744530372,bytesPerCoordinate:56.58839624148057}},FILL_OUTLINE:{bytesPerFeature:12168.362923563885,bytesPerCoordinate:56.265773613009564,draped:{bytesPerFeature:7929.090679733446,bytesPerCoordinate:56.17528027868163}},EXTRUDE:{bytesPerFeature:11409.738625531325,bytesPerCoordinate:56.99136098105536,draped:{bytesPerFeature:11409.738625531325,bytesPerCoordinate:56.99136098105536}},EXTRUDE_EDGES:{bytesPerFeature:19399.52461450617,bytesPerCoordinate:52.052414603432105,draped:{bytesPerFeature:19399.52461450617,bytesPerCoordinate:52.052414603432105}}}}.apply(null,n))||(e.exports=i)},LyIS:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("RsYQ")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.thresholdScale=1,this._camera=new r,this._worldSpaceRadius=e,this._thresholds=t.map(function(e){return e})}return e.prototype.updateCamera=function(e){this._camera.copyFrom(e)},e.prototype.selectLevel=function(e,t){for(var r=this._camera.computeScreenPixelSizeAt(e),n=this._worldSpaceRadius*t/r,i=this._thresholds,a=-1,o=0;o<i.length;++o)n>=i[o]*this.thresholdScale&&(a=o);return a},e}();t.LevelSelector=n}.apply(null,n))||(e.exports=i)},M9wp:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("ab6c"),r("2B1V"),r("tUyH"),r("FNtW"),r("CIy2"),r("hnAi"),r("s6rJ"),r("ZeO9"),r("DSFQ"),r("qbr3")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f){function p(e,t,r){3===r.length?e.setUniform4f(t,r[0],r[1],r[2],1):e.setUniform4fv(t,r)}var h=function(e){function t(r,n){var i=e.call(this,n)||this;return i.params=c.copyParameters(r,m),i._uniqueMaterialIdentifier=t.uniqueMaterialIdentifier(i.params),i}return r(t,e),Object.defineProperty(t.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){},t.prototype.getGLMaterials=function(){return{color:v,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}},t.prototype.getAllTextureIds=function(){return[]},t.prototype.intersect=function(e,t,r,n,i,a,o,s){},t.prototype.createBufferWriter=function(){return new b},t.prototype.createRenderer=function(e,t){return new u(e,t,this)},t.prototype.setParameterValues=function(e){c.updateParameters(this.params,e)&&(this._uniqueMaterialIdentifier=t.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))},t.prototype.getParameters=function(){return this.params},t.uniqueMaterialIdentifier=function(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})},t}(o),v=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.isRenderSlot=!0,i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=c.copyParameters(this.material.getParameters()),this.selectProgram()},t.prototype.selectProgram=function(){var e=this.params;this.renderProgram=this.programRep.getProgram(d.program,{occlTest:!!e.occlusionTest,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,depthHud:!1,depthHudAlignStart:!!e.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,slice:e.slicePlaneEnabled}),this.depthProgram=this.programRep.getProgram(d.program,{occlTest:!!e.occlusionTest,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!e.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,slice:e.slicePlaneEnabled}),this.renderPipelineState=f.makePipelineState({blending:f.separateBlendingParams(1,770,771,771),depthTest:{func:513},colorWrite:f.defaultColorWriteParams}),this.depthPipelineState=f.makePipelineState({depthTest:{func:513},depthWrite:f.defaultDepthWriteParams})},t.prototype.beginSlot=function(e){switch(e){case 17:return this.isRenderSlot=!0,!0;case 18:return this.isRenderSlot=!1,!0}return!1},Object.defineProperty(t.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0}),t.prototype.getProgram=function(){return this.program},t.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]},t.prototype.getDrawMode=function(){return 4},t.prototype.bind=function(e,t){var r=t.cameraAboveGround?1:-1,n=this.program,i=this.params;e.bindProgram(n),n.setUniform1f("cameraGroundRelative",r),n.setUniform1f("polygonOffset",i.shaderPolygonOffset),n.setUniform4fv("viewport",t.viewport),n.setUniform1f("perDistancePixelRatio",Math.tan(t.fovY/2)/(t.viewport[2]/2)),n.setUniformMatrix4fv("viewNormal",t.viewInvTransp),n.setUniform1i("hudVisibilityTexture",0),e.bindTexture(t.hudVisibilityTexture,0),p(n,"color",i.color);var a=t.pixelRatio||1;n.setUniform1f("pixelRatio",a),n.setUniform2f("screenOffset",i.screenOffset[0]*a,i.screenOffset[1]*a),this.bindBorder(e,t),c.bindVerticalOffset(i.verticalOffset,t,n),this.bindSizing(e,t),c.bindScreenSizePerspective(i.screenSizePerspective,n),this.isRenderSlot?e.setPipelineState(this.renderPipelineState):e.setPipelineState(this.depthPipelineState)},t.prototype.bindView=function(e,t){var r=this.program,n=this.params;c.bindView(t.origin,t.view,r),c.bindCamPos(t.origin,t.viewInvTransp,r),n.slicePlaneEnabled&&c.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.release=function(e,t){},t.prototype.bindSizing=function(e,t){var r=this.program,n=this.params;r.setUniform2f("pixelToNDC",2/t.viewport[2],2/t.viewport[3]);var i=t.pixelRatio||1;r.setUniform1f("lineSize",Math.ceil(n.size)*i)},t.prototype.bindBorder=function(e,t){var r=this.program,n=this.params,i=t.pixelRatio||1;null!==n.borderColor?(p(r,"borderColor",n.borderColor),r.setUniform1f("borderSize",i)):(r.setUniform4f("borderColor",0,0,0,0),r.setUniform1f("borderSize",0))},t}(a),m={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1e-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},g=i.newLayout().vec3f(s.VertexAttrConstants.POSITION).vec3f(s.VertexAttrConstants.NORMAL).vec2f(s.VertexAttrConstants.UV0).vec4f(s.VertexAttrConstants.AUXPOS1),y=[n.vec2f32.fromValues(0,0),n.vec2f32.fromValues(1,0),n.vec2f32.fromValues(0,1),n.vec2f32.fromValues(1,0),n.vec2f32.fromValues(1,1),n.vec2f32.fromValues(0,1)],b=function(){function e(){this.vertexBufferLayout=g}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[s.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,n,i){l.writePosition(t.indices[s.VertexAttrConstants.POSITION],t.vertexAttr[s.VertexAttrConstants.POSITION].data,e.transformation,n.position,i,6),l.writeNormal(t.indices[s.VertexAttrConstants.NORMAL],t.vertexAttr[s.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,n.normal,i,6),l.writeBufferVec4(t.indices[s.VertexAttrConstants.AUXPOS1],t.vertexAttr[s.VertexAttrConstants.AUXPOS1].data,n.auxpos1,i,6);for(var a=0;a<y.length;++a)n.uv0.setVec(i+a,y[a])},e}();return h}.apply(null,n))||(e.exports=i)},MI3s:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2fXB")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=4;var a=this.TypedArrayConstructor;void 0===n&&(n=4*a.BYTES_PER_ELEMENT);var o=0===t.byteLength?0:r;this.typedBuffer=null==i?new a(t,o):new a(t,o,(i-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return r.vec4.set(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1],this.typedBuffer[e*this.typedBufferStride+2],this.typedBuffer[e*this.typedBufferStride+3])},e.prototype.setVec=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1],this.typedBuffer[e*this.typedBufferStride+2]=t[2],this.typedBuffer[e*this.typedBufferStride+3]=t[3]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r},e.prototype.copyFrom=function(e,t,r){var n=this.typedBuffer,i=t.typedBuffer,a=e*this.typedBufferStride,o=r*t.typedBufferStride;n[a]=i[o],n[a+1]=i[o+1],n[a+2]=i[o+2],n[a+3]=i[o+3]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=4,e}();t.BufferViewVec4Impl=n}.apply(null,n))||(e.exports=i)},Mk25:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("DIqE"),r("0LE5"),r("Rdxj")],void 0===(i=function(e,t,r,n,i){function a(e,t,r,i){var a=c;return e?(r&&i&&(a.len=n.vec3.distance(t,r)),n.vec3.copy(a.dir,e)):i?(a.len=n.vec3.distance(t,r),n.vec3.subtract(a.dir,r,t),n.vec3.scale(a.dir,a.dir,1/a.len)):(n.vec3.subtract(a.dir,r,t),n.vec3.normalize(a.dir,a.dir)),a}function o(e,t){return-n.vec3.dot(t,e)-e[3]}function s(e,t,r){var i=n.vec3.dot(e,r.dir),a=o(e,t);if(a<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return a>0;if((a<0||i<0)&&!(a<0&&i<0))return!0;var s=a/i;return i>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}function l(e,t,r,n){n.clip[0]=0,n.clip[1]=r?n.len:Number.MAX_VALUE;for(var i=0;i<e.length;i++)if(!s(e[i],t,n))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.planeSphere=function(e,t,r){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]<r},t.frustumSphere=function(e,t,r){var n=t[0],i=t[1],a=t[2];return!(e[0][0]*n+e[0][1]*i+e[0][2]*a+e[0][3]>r||e[1][0]*n+e[1][1]*i+e[1][2]*a+e[1][3]>r||e[2][0]*n+e[2][1]*i+e[2][2]*a+e[2][3]>r||e[3][0]*n+e[3][1]*i+e[3][2]*a+e[3][3]>r||e[4][0]*n+e[4][1]*i+e[4][2]*a+e[4][3]>r||e[5][0]*n+e[5][1]*i+e[5][2]*a+e[5][3]>r)},t.frustumRay=function(e,t,r,n){return l(e,t,null,a(n,t,r,!1))},t.frustumPoint=function(e,t){for(var r=0;r<6;r++)if(o(e[r],t)<0)return!1;return!0},t.frustumLineSegment=function(e,t,r,n){return l(e,t,r,a(n,t,r,!0))},t.closestPointOnRay=function(e,t,r,i){var a=n.vec3.dot(t,n.vec3.subtract(i,r,e));return n.vec3.add(i,e,n.vec3.scale(i,t,a)),i};var c={dir:i.vec3f64.create(),len:0,clip:r.vec2f64.create()}}.apply(null,n))||(e.exports=i)},MzcX:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf")],void 0===(i=function(e,t,r){function n(e){return"a"+e[0].toUpperCase()+e.substr(1)}function i(e){var t=o[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}Object.defineProperty(t,"__esModule",{value:!0});var a={divisor:0,prefixA:!1};t.glLayout=function(e,t){void 0===t&&(t={}),t=r({},a,t);var o=e.stride;return e.fieldNames.filter(function(t){var r=e.fields.get(t).optional;return!(r&&r.glPadding)}).map(function(r){var a=e.fields.get(r),s=a.constructor.ElementCount,l=i(a.constructor.ElementType),c=a.offset,u=!(!a.optional||!a.optional.glNormalized);return{name:t.prefixA?n(r):r,stride:o,count:s,type:l,offset:c,normalized:u,divisor:t.divisor}})};var o={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}}.apply(null,n))||(e.exports=i)},N5NQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("PHan"),r("0LE5"),r("Rdxj"),r("AzkI"),r("JjCO")],void 0===(i=function(e,t,r,n,i,a,o){function s(e){return e?{origin:i.vec3f64.clone(e.origin),vector:i.vec3f64.clone(e.vector)}:{origin:i.vec3f64.create(),vector:i.vec3f64.create()}}function l(e,t){var r=h.get();return r.origin=e,r.vector=t,r}function c(e,t,r){return void 0===r&&(r=s()),n.vec3.copy(r.origin,e),n.vec3.copy(r.vector,t),r}function u(e,t){var r=n.vec3.subtract(o.sv3d.get(),t,e.origin),i=n.vec3.dot(e.vector,r),s=n.vec3.dot(e.vector,e.vector),l=a.clamp(i/s,0,1),c=n.vec3.subtract(o.sv3d.get(),n.vec3.scale(o.sv3d.get(),e.vector,l),r);return n.vec3.dot(c,c)}function d(e,t,r,i,s){var l=e.vector,c=e.origin,u=n.vec3.subtract(o.sv3d.get(),t,c),d=n.vec3.length(l),f=n.vec3.dot(l,u)/d;return n.vec3.scale(s,l,a.clamp(f,r,i)),n.vec3.add(s,s,e.origin)}function f(e,t,r,i){var s=e.origin,l=n.vec3.add(o.sv3d.get(),s,e.vector),c=t.origin,u=n.vec3.add(o.sv3d.get(),c,t.vector),d=o.sv3d.get(),f=o.sv3d.get();if(d[0]=s[0]-c[0],d[1]=s[1]-c[1],d[2]=s[2]-c[2],f[0]=u[0]-c[0],f[1]=u[1]-c[1],f[2]=u[2]-c[2],Math.abs(f[0])<1e-6&&Math.abs(f[1])<1e-6&&Math.abs(f[2])<1e-6)return!1;var p=o.sv3d.get();if(p[0]=l[0]-s[0],p[1]=l[1]-s[1],p[2]=l[2]-s[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;var h=d[0]*f[0]+d[1]*f[1]+d[2]*f[2],v=f[0]*p[0]+f[1]*p[1]+f[2]*p[2],m=d[0]*p[0]+d[1]*p[1]+d[2]*p[2],g=f[0]*f[0]+f[1]*f[1]+f[2]*f[2],y=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*g-v*v;if(Math.abs(y)<1e-6)return!1;var b=(h*v-m*g)/y,x=(h+v*b)/g;r&&(b=a.clamp(b,0,1),x=a.clamp(x,0,1));var _=o.sv3d.get(),S=o.sv3d.get();return _[0]=s[0]+b*p[0],_[1]=s[1]+b*p[1],_[2]=s[2]+b*p[2],S[0]=c[0]+x*f[0],S[1]=c[1]+x*f[1],S[2]=c[2]+x*f[2],i.tA=b,i.tB=x,i.pA=_,i.pB=S,i.distance2=n.vec3.squaredDistance(_,S),!0}Object.defineProperty(t,"__esModule",{value:!0}),t.create=s,t.wrap=l,t.copy=function(e,t){return void 0===t&&(t=s()),c(e.origin,e.vector,t)},t.fromValues=c,t.fromPoints=function(e,t,r){return void 0===r&&(r=s()),n.vec3.copy(r.origin,e),n.vec3.subtract(r.vector,t,e),r},t.distance2=u,t.distance=function(e,t){return Math.sqrt(u(e,t))},t.projectPoint=function(e,t,r){return d(e,t,0,1,r)},t.projectPointClamp=d,t.closestRayDistance2=function(e,t){if(f(e,l(t.origin,t.direction),!1,p)){var r=p.tA,i=p.pB,a=p.distance2;if(r>=0&&r<=1)return a;if(r<0)return n.vec3.squaredDistance(e.origin,i);if(r>1)return n.vec3.squaredDistance(n.vec3.add(o.sv3d.get(),e.origin,e.vector),i)}return null},t.closestLineSegmentPoint=function(e,t,r){return!!f(e,t,!0,p)&&(n.vec3.copy(r,p.pA),!0)},t.closestLineSegmentDistance2=function(e,t){return f(e,t,!0,p)?p.distance2:null};var p={tA:0,tB:0,pA:i.vec3f64.create(),pB:i.vec3f64.create(),distance2:0},h=new r.ObjectStack(function(){return{origin:null,vector:null}})}.apply(null,n))||(e.exports=i)},O7NG:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("TPlk")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec4f64=r}.apply(null,n))||(e.exports=i)},OIWm:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("HZ3d"),r("Q2wQ"),r("2Atf"),r("pcDC"),r("rg9i"),r("qMld"),r("jfWY"),r("w00x"),r("FXVB"),r("1m5D"),r("EuvN"),r("lLWD"),r("wR99"),r("PT+s"),r("7eim"),r("VfPl"),r("TqPN")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y){function b(e){switch(e.componentType){case 5120:return new g.BufferViewVec2i8(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5121:return new g.BufferViewVec2u8(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5122:return new g.BufferViewVec2i16(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5123:return new g.BufferViewVec2u16(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5125:return new g.BufferViewVec2u32(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case 5126:return new g.BufferViewVec2f(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:a.neverReached(e.componentType)}}function x(e){return r(this,void 0,void 0,function(){return n(this,function(t){return[2,s.create(function(t,r){var n=new Blob([e]),i=new FileReader;i.onload=function(){var e=i.result;t(JSON.parse(e))},i.onerror=function(e){r(e)},i.readAsText(n)})]})})}function _(e,t){return r(this,void 0,void 0,function(){return n(this,function(r){return[2,s.create(function(r,n){var i=new Blob([e],{type:t}),a=URL.createObjectURL(i),o=new Image;o.addEventListener("load",function(){URL.revokeObjectURL(a),r(o)}),o.addEventListener("error",function(e){URL.revokeObjectURL(a),n(e)}),o.src=a})]})})}Object.defineProperty(t,"__esModule",{value:!0});var S,w=1179937895,C=1313821514,P=5130562,E=function(){function e(e,t,r,n,i){this.context=e,this.errorContext=t,this.uri=r,this.json=n,this.glbBuffer=i,this.bufferCache=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=m.splitURI(this.uri).dirPart,this.checkVersionSupported(),this.checkRequiredExtensionsSupported(),t.errorUnsupportedIf(null==n.scenes,"Scenes must be defined."),t.errorUnsupportedIf(null==n.meshes,"Meshes must be defined"),t.errorUnsupportedIf(null==n.nodes,"Nodes must be defined."),this.computeNodeParents()}return e.load=function(t,i,a){return r(this,void 0,void 0,function(){var r,s,l,c,u,d;return n(this,function(n){switch(n.label){case 0:return o.endsWith(a,".gltf")?[4,t.loadJson(a)]:[3,2];case 1:return r=n.sent(),[2,new e(t,i,a,r)];case 2:return o.endsWith(a,".glb")?[4,t.loadBinary(a)]:[3,5];case 3:return s=n.sent(),[4,e.parseGLB(i,s)];case 4:return u=n.sent(),[2,new e(t,i,a,u.json,u.binaryData)];case 5:return[4,t.loadBinary(a)];case 6:return l=n.sent(),(c=new h.BinaryStreamReader(l)).remainingBytes()>=4&&c.readUint32()===w?[4,e.parseGLB(i,l)]:[3,8];case 7:return u=n.sent(),[2,new e(t,i,a,u.json,u.binaryData)];case 8:return[4,t.loadJson(a)];case 9:return d=n.sent(),[2,new e(t,i,a,d)]}})})},e.parseGLB=function(e,t){return r(this,void 0,void 0,function(){var r,i,a,o,s,l,c,u,d;return n(this,function(n){switch(n.label){case 0:r=new h.BinaryStreamReader(t),e.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large."),i=r.readUint32(),a=r.readUint32(),o=r.readUint32(),e.assert(i===w,"Magic first 4 bytes do not fit to expected GLB value."),e.assert(t.byteLength>=o,"GLB binary data is smalller than header specifies."),e.errorUnsupportedIf(2!==a,"Only GLB container version 2 is supported."),s=0,n.label=1;case 1:return r.remainingBytes()>=8?(u=r.readUint32(),d=r.readUint32(),0!==s?[3,3]:(e.assert(d===C,"First GLB chunck must be JSON."),e.assert(u>=0,"No JSON data found."),[4,x(r.readUint8Array(u))])):[3,5];case 2:return l=n.sent(),[3,4];case 3:1===s?(e.errorUnsupportedIf(d!==P,"Second GLB chunck expected to be BIN."),c=r.readUint8Array(u)):e.warnUnsupported("More than 2 GLB chunks detected. Skipping."),n.label=4;case 4:return s+=1,[3,1];case 5:return l||e.error("No GLB JSON chunk detected."),[2,{json:l,binaryData:c}]}})})},e.prototype.getBuffer=function(e){return r(this,void 0,void 0,function(){var t,r,i,a;return n(this,function(n){switch(n.label){case 0:return t=this.json.buffers[e],r=this.errorContext,null==t.uri?(r.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):(i=this.bufferCache.get(e))?[3,2]:[4,this.context.loadBinary(this.resolveUri(t.uri))];case 1:a=n.sent(),i=new Uint8Array(a),this.bufferCache.set(e,i),r.assert(i.byteLength===t.byteLength,"Buffer byte lengths should match."),n.label=2;case 2:return[2,i]}})})},e.prototype.getAccessor=function(e){return r(this,void 0,void 0,function(){var t,r,i,a,o,s,l,c;return n(this,function(n){switch(n.label){case 0:return t=this.json.accessors[e],(r=this.errorContext).errorUnsupportedIf(null==t.bufferView,"An accessor bufferView is required."),r.errorUnsupportedIf(t.type in["MAT2","MAT3","MAT4"],"AttributeType "+t.type+" is not supported"),i=this.json.bufferViews[t.bufferView],[4,this.getBuffer(i.buffer)];case 1:return a=n.sent(),o=R[t.type],s=M[t.componentType],l=o*s,c=i.byteStride||l,[2,{raw:a.buffer,byteStride:c,byteOffset:a.byteOffset+(i.byteOffset||0)+(t.byteOffset||0),entryCount:t.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:s,componentType:t.componentType,min:t.min,max:t.max,normalized:!!t.normalized}]}})})},e.prototype.getIndexData=function(e){return r(this,void 0,void 0,function(){var t;return n(this,function(r){switch(r.label){case 0:return null==e.indices?[2,null]:[4,this.getAccessor(e.indices)];case 1:if((t=r.sent()).isDenselyPacked)switch(t.componentType){case 5121:return[2,new Uint8Array(t.raw,t.byteOffset,t.entryCount)];case 5123:return[2,new Uint16Array(t.raw,t.byteOffset,t.entryCount)];case 5125:return[2,new Uint32Array(t.raw,t.byteOffset,t.entryCount)]}else switch(t.componentType){case 5121:return[2,y.scalar.makeDense(this.wrapAccessor(g.BufferViewUint8,t))];case 5123:return[2,y.scalar.makeDense(this.wrapAccessor(g.BufferViewUint16,t))];case 5125:return[2,y.scalar.makeDense(this.wrapAccessor(g.BufferViewUint32,t))]}return[2]}})})},e.prototype.getPositionData=function(e){return r(this,void 0,void 0,function(){var t,r;return n(this,function(n){switch(n.label){case 0:return(t=this.errorContext).errorUnsupportedIf(null==e.attributes.POSITION,"POSITION vertex data is required."),[4,this.getAccessor(e.attributes.POSITION)];case 1:return r=n.sent(),t.errorUnsupportedIf(5126!==r.componentType,"[POSITION attribute] Expected type FLOAT, found "+I[r.componentType]),t.errorUnsupportedIf(3!==r.componentCount,"POSITION attribute must have 3 components."),[2,this.wrapAccessor(g.BufferViewVec3f,r)]}})})},e.prototype.getNormalData=function(e){return r(this,void 0,void 0,function(){var t,r;return n(this,function(n){switch(n.label){case 0:return(t=this.errorContext).errorUnsupportedIf(null==e.attributes.NORMAL,"NORMAL vertex data is required."),[4,this.getAccessor(e.attributes.NORMAL)];case 1:return r=n.sent(),t.errorUnsupportedIf(5126!==r.componentType,"[NORMAL attribute] Expected type FLOAT, found "+I[r.componentType]),t.errorUnsupportedIf(3!==r.componentCount,"NORMAL attribute must have 3 components."),[2,this.wrapAccessor(g.BufferViewVec3f,r)]}})})},e.prototype.getTangentData=function(e){return r(this,void 0,void 0,function(){var t,r;return n(this,function(n){switch(n.label){case 0:return(t=this.errorContext).errorUnsupportedIf(null==e.attributes.TANGENT,"TANGENT vertex data is required."),[4,this.getAccessor(e.attributes.TANGENT)];case 1:return r=n.sent(),t.errorUnsupportedIf(5126!==r.componentType,"[TANGENT attribute] Expected type FLOAT, found "+I[r.componentType]),t.errorUnsupportedIf(4!==r.componentCount,"NORMAL attribute must have 4 components."),[2,new g.BufferViewVec4f(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)]}})})},e.prototype.getTextureCoordinates=function(e){return r(this,void 0,void 0,function(){var t,r;return n(this,function(n){switch(n.label){case 0:return(t=this.errorContext).errorUnsupportedIf(null==e.attributes.TEXCOORD_0,"TEXCOORD_0 vertex data is required."),[4,this.getAccessor(e.attributes.TEXCOORD_0)];case 1:return r=n.sent(),t.errorUnsupportedIf(2!==r.componentCount,"TEXCOORD_0 attribute must have 2 components."),5126===r.componentType?[2,this.wrapAccessor(g.BufferViewVec2f,r)]:(t.errorUnsupportedIf(!r.normalized,"[TEXCOORD_0 attribute] Integer ComponentTypes are only supported for a normalized accessor."),[2,b(r)])}})})},e.prototype.hasNormals=function(e){return!!e.attributes.NORMAL},e.prototype.hasVertexColors=function(e){return!!e.attributes.COLOR_0},e.prototype.hasTextureCoordinates=function(e){return!!e.attributes.TEXCOORD_0},e.prototype.hasTangents=function(e){return!!e.attributes.TANGENT},e.prototype.getVertexColors=function(e){return r(this,void 0,void 0,function(){var t,r;return n(this,function(n){switch(n.label){case 0:return(t=this.errorContext).errorUnsupportedIf(null==e.attributes.COLOR_0,"COLOR_0 vertex data is required."),[4,this.getAccessor(e.attributes.COLOR_0)];case 1:if(r=n.sent(),t.errorUnsupportedIf(4!==r.componentCount&&3!==r.componentCount,"COLOR_0 attribute must have 3 or 4 components."),4===r.componentCount){if(5126===r.componentType)return[2,this.wrapAccessor(g.BufferViewVec4f,r)];if(5121===r.componentType)return[2,this.wrapAccessor(g.BufferViewVec4u8,r)];if(5123===r.componentType)return[2,this.wrapAccessor(g.BufferViewVec4u16,r)]}else if(3===r.componentCount){if(5126===r.componentType)return[2,this.wrapAccessor(g.BufferViewVec3f,r)];if(5121===r.componentType)return[2,this.wrapAccessor(g.BufferViewVec3u8,r)];if(5123===r.componentType)return[2,this.wrapAccessor(g.BufferViewVec3u16,r)]}return t.errorUnsupported("[COLOR_0 attribute] Unsupported component type: "+I[r.componentType]),[2]}})})},e.prototype.getMaterial=function(e){return r(this,void 0,void 0,function(){var t,r,i,a,o,s,l,c;return n(this,function(n){switch(n.label){case 0:return t=this.errorContext,(r=this.materialCache.get(e.material))?[3,6]:(i=null!=e.material?v.material(this.json.materials[e.material]):v.material(),a=i.pbrMetallicRoughness,o=this.hasVertexColors(e),s=void 0,a.baseColorTexture?(t.errorUnsupportedIf(0!==(a.baseColorTexture.texCoord||0),"Only TEXCOORD_0 is supported"),[4,this.getTexture(a.baseColorTexture.index)]):[3,2]);case 1:s=n.sent(),n.label=2;case 2:return l=void 0,i.normalTexture?0===(a.baseColorTexture.texCoord||0)?[3,3]:(t.warnUnsupported("Only TEXCOORD_0 is supported for normal map"),[3,5]):[3,5];case 3:return[4,this.getTexture(i.normalTexture.index)];case 4:l=n.sent(),n.label=5;case 5:c=null!=e.material?e.material:-1,r={alphaMode:i.alphaMode,alphaCutoff:i.alphaCutoff,color:a.baseColorFactor,doubleSided:!!i.doubleSided,colorTexture:s,normalTexture:l,name:i.name,id:c,vertexColors:o,ESRI_externalColorMixMode:i.extras.ESRI_externalColorMixMode},n.label=6;case 6:return[2,r]}})})},e.prototype.getTexture=function(e){return r(this,void 0,void 0,function(){var t,r,i,a,o,s,l,c;return n(this,function(n){switch(n.label){case 0:return t=this.errorContext,r=this.json.textures[e],i=v.textureSampler(null!=r.sampler?this.json.samplers[r.sampler]:{}),t.errorUnsupportedIf(null==r.source,"source must be defined for a texture"),a=this.json.images[r.source],(o=this.textureCache.get(e))?[3,6]:(s=void 0,a.uri?[4,this.context.loadImage(this.resolveUri(a.uri))]:[3,2]);case 1:return s=n.sent(),[3,5];case 2:return t.errorUnsupportedIf(null==a.bufferView,"Image bufferView must be defined."),t.errorUnsupportedIf(null==a.mimeType,"Image mimeType must be defined."),l=this.json.bufferViews[a.bufferView],[4,this.getBuffer(l.buffer)];case 3:return c=n.sent(),t.errorUnsupportedIf(null!=l.byteStride,"byteStride not supported for image buffer"),[4,_(new Uint8Array(c.buffer,c.byteOffset+(l.byteOffset||0),l.byteLength),a.mimeType)];case 4:s=n.sent(),n.label=5;case 5:o={data:s,wrapS:i.wrapS,wrapT:i.wrapT,minFilter:i.minFilter,name:a.name,id:e},this.textureCache.set(e,o),n.label=6;case 6:return[2,o]}})})},e.prototype.getNodeTransform=function(e){if(void 0===e)return O;var t=this.nodeTransformCache.get(e);if(!t){var r=this.getNodeTransform(this.getNodeParent(e)),n=this.json.nodes[e];n.matrix?t=u.mat4.multiply(d.mat4f64.create(),r,n.matrix):n.translation||n.rotation||n.scale?(t=d.mat4f64.clone(r),n.translation&&u.mat4.translate(t,t,n.translation),n.rotation&&(A[3]=f.quat.getAxisAngle(A,n.rotation),u.mat4.rotate(t,t,A[3],A)),n.scale&&u.mat4.scale(t,t,n.scale)):t=r,this.nodeTransformCache.set(e,t)}return t},e.prototype.wrapAccessor=function(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)},e.prototype.resolveUri=function(e){return l.makeAbsolute(e,this.baseUri)},e.prototype.getNodeParent=function(e){return this.nodeParentMap.get(e)},e.prototype.checkVersionSupported=function(){c.Version.parse(this.json.asset.version,"glTF").validate(T)},e.prototype.checkRequiredExtensionsSupported=function(){var e=this.json,t=this.errorContext;e.extensionsRequired&&0!==e.extensionsRequired.length&&t.errorUnsupportedIf(!0,"Extensions: "+e.extensionsRequired.join(", "))},e.prototype.computeNodeParents=function(){var e=this;this.json.nodes.forEach(function(t,r){t.children&&t.children.forEach(function(t){e.nodeParentMap.set(t,r)})})},e}();t.Resource=E;var T=new c.Version(2,0,"glTF"),O=u.mat4.fromXRotation(d.mat4f64.create(),Math.PI/2),A=p.quatf64.create(),R={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},M=((S={})[5120]=1,S[5121]=1,S[5122]=2,S[5123]=2,S[5126]=4,S[5125]=4,S),I={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}}.apply(null,n))||(e.exports=i)},OUux:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("jZlN"),r("Gtr7"),r("pcDC"),r("eIBl"),r("qMld"),r("8MXS"),r("Vx27"),r("vtMp"),r("7Kvv"),r("IpeC"),r("HbaO"),r("R8fa"),r("eCSb"),r("B9tS"),r("/F0A"),r("joKa"),r("Rzdu"),r("yJEJ"),r("BwdQ"),r("w9Zc")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w){var C=function(e){function t(t){var r=e.call(this)||this;return r._handles=new s,r.highlights=new b,r.suspendResumeExtentMode="computed",r.dataExtent=null,r.suspendResumeExtent=null,r}return r(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=!e.queryGraphicUIDsInExtent&&(e.scaleVisibilityEnabled||e.elevationAlignmentEnabled)?new _({spatialReference:e.owner.view.spatialReference}):null,r=e.frustumVisibilityEnabled?new y:null,n=e.scaleVisibilityEnabled?new x:null,i=e.filterVisibilityEnabled&&"multipatch"!==e.layer.geometryType?new g.Graphics3DFilterVisibility({geometryType:e.layer.geometryType}):null,a=e.elevationAlignmentEnabled?new m:null,o=new v({owner:e.owner,layer:e.layer,asyncUpdates:e.asyncGraphicsUpdates,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1}),s=e.updateClippingExtent,l=e.queryGraphicUIDsInExtent,c=e.suspendResumeExtentMode,u=e.dataExtent;return{graphicsCore:o,frustumVisibility:r,scaleVisibility:n,filterVisibility:i,elevationAlignment:a,spatialIndex:t,updateClippingExtent:s,suspendResumeExtentMode:c,dataExtent:u,queryGraphicUIDsInExtent:l||function(e,r,n){return t.queryGraphicUIDsInExtent(e,r,n)}}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.filterVisibility&&this._handles.add(this.owner.watch("filter",function(){return e.filterVisibility.filterChanged()})),this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(t,r){f.diff(t,r)&&e.graphicsCore.elevationInfoChange()})),this._handles.add(this.layer.watch("labelsVisible",function(){return e.graphicsCore.updateVisibilityInfo()})),this._handles.add(this.layer.watch("labelingInfo",function(t,r){f.diff(t,r)&&e.graphicsCore.updateLabelingInfo()}))},t.prototype.setup=function(){var e=this;this.frustumVisibility&&this.frustumVisibility.setup(this.owner);var t=this.owner,r=this.owner.view.basemapTerrain;if(this.scaleVisibility&&this.scaleVisibility.setup(t,this.layer,this.queryGraphicUIDsInExtent,this.graphicsCore,r),this.filterVisibility&&this.filterVisibility.setup(t,this.graphicsCore),this.elevationAlignment){var n=t.view.elevationProvider;this.elevationAlignment.setup(t,this.queryGraphicUIDsInExtent,this.graphicsCore,n)}return this.highlights&&this.highlights.setup(this.graphicsCore),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility,this.spatialIndex)),this._set("deconfliction",t.view.deconflictor.addGraphicsOwner(this.graphicsCore)),this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,spatialIndex:this.spatialIndex,deconfliction:this.deconfliction,labeling:this.labeling,highlights:this.highlights}),this._handles.add([this.layer.watch("renderer",function(t){return e.graphicsCore.rendererChange(t)}),t.watch("fullOpacity",function(){return e.graphicsCore.opacityChange()})]),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this._handles.add(t.view.watch("clippingArea",function(){return e._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?this.graphicsCore.updateLabelingInfo():l.resolve()},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","highlights","graphicsCore","spatialIndex"];e<t.length;e++){var r=t[e],n=this[r];n&&(n.destroy(),this._set(r,null))}this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t,r){var n=this;if(e instanceof p){var a=this.highlights.acquireSet(t,r),o=a.set,s=a.handle;return this.owner.queryObjectIds(e).then(function(e){return n.highlights.setObjectIds(o,e)}),s}if("number"==typeof e)return this.highlight([e],t,r);if(e instanceof i)return this.highlight([e],t,r);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof i){var l=e;if(!r||!l[0].attributes||null===w.attributeLookup(l[0].attributes,r)){var c=l.map(function(e){return e.uid}),u=this.highlights.acquireSet(t,null),d=u.set;s=u.handle;return this.highlights.setUids(d,c),s}e=l.map(function(e){return w.attributeLookup(e.attributes,r)})}if("number"==typeof e[0]){var f=e,h=this.highlights.acquireSet(t,r);d=h.set,s=h.handle;return this.highlights.setObjectIds(d,f),s}}return E},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(c.init(this,"suspendResumeExtentMode",function(){switch(e._handles.remove(P),e.suspendResumeExtentMode){case"computed":e._handles.add(c.init(e.graphicsCore,"computedExtent",function(t){return e.updateSuspendResumeExtent(t)}),P);break;case"data":e._handles.add(c.init(e,"dataExtent",function(t){return e.updateSuspendResumeExtent(t)}),P);break;default:o.neverReached(e.suspendResumeExtentMode)}}))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var r=this.owner.view.spatialReference;if(!e.spatialReference.equals(r)){if(!d.canProject(e,r))return;e=d.project(e,r)}return S.enlargeExtent(e,t,h.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},n([u.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),n([u.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),n([u.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),n([u.property({constructOnly:!0})],t.prototype,"queryGraphicUIDsInExtent",void 0),n([u.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),n([u.property({constructOnly:!0})],t.prototype,"spatialIndex",void 0),n([u.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),n([u.property({constructOnly:!0})],t.prototype,"filterVisibility",void 0),n([u.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),n([u.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),n([u.property({readOnly:!0})],t.prototype,"deconfliction",void 0),n([u.property({readOnly:!0})],t.prototype,"labeling",void 0),n([u.property({readOnly:!0})],t.prototype,"highlights",void 0),n([u.property()],t.prototype,"suspendResumeExtentMode",void 0),n([u.property()],t.prototype,"dataExtent",void 0),n([u.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),n([u.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating"]})],t.prototype,"updating",null),n([u.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(u.declared(a)),P="suspendResumeExtentMode",E={remove:function(){},pause:function(){},resume:function(){}};return C}.apply(null,n))||(e.exports=i)},Ondo:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("qMld"),r("8MXS"),r("Vx27"),r("niw0"),r("WsO6")],void 0===(i=function(e,t,r,n,i,a,o,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return i.create(function(t,r){a.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var n=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);n?r(n):t()})})},n([o.property()],t.prototype,"view",void 0),n([o.property()],t.prototype,"slicePlaneEnabled",void 0),n([o.subclass("esri.views.3d.layers.LayerView3D")],t)}(o.declared(l))}.apply(null,n))||(e.exports=i)},Ozid:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("idNY"),r("QDcU"),r("WYKK"),r("rg9i"),r("jBNx"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("O7NG"),r("WRgd"),r("Os6f"),r("VW5z"),r("qSXe"),r("zF3d"),r("JzVu"),r("BwdQ"),r("V6Fi"),r("cMCQ"),r("dQtU"),r("LiJt"),r("3w6h"),r("mmEe"),r("krVM"),r("CIy2"),r("EAl+"),r("IZai"),r("TP2F")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w,C,P,E,T,O,A,R){Object.defineProperty(t,"__esModule",{value:!0});var M=function(e){function t(t,r,n,i){var a=e.call(this,t,r,n,i)||this;a._optionalFields=[],a._instanceIndexToGraphicUid=new Map;var o=a._getStageIdHint();if(!a._isPropertyDriven("size")){var s=b.validateSymbolLayerSize(a.symbolLayer);if(s)return a._logWarning(s),a.reject(),a}if(r.resource&&r.resource.href)a._prepareModelResources(r.resource.href,o);else{var l=r.resource?r.resource.primitive:h.defaultPrimitive;a._preparePrimitiveResources(l,o)}return a}return r(t,e),t.prototype.getCachedSize=function(){var e=this._symbolSize;return{width:e[0],depth:e[1],height:e[2]}},Object.defineProperty(t.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0}),t.prototype._preparePrimitiveResources=function(e,t){if(!S.isValidPrimitive(e))return this._logWarning("Unknown object symbol primitive: "+e),void this.reject();var r=this.symbolLayer;this._resourceBoundingBox=p.create(S.primitiveBoundingBox(e)),this._resourceSize=d.vec3f64.fromArray(p.size(this._resourceBoundingBox)),this._symbolSize=d.vec3f64.fromArray(b.computeSizeWithResourceSize(this._resourceSize,r));var n=this._getMaterialOpacity(),a={specular:[0,0,0],opacity:n,transparent:n<1||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:I,diffuse:I,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},l=this.symbol;if("point-3d"===l.type&&l.verticalOffset){var c=l.verticalOffset,u=c.screenLength,f=c.minWorldLength,h=c.maxWorldLength;a.verticalOffset={screenLength:s.pt2px(u),minWorldLength:f||0,maxWorldLength:null!=h?h:1/0},a.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._isPropertyDriven("color"))a.externalColor=D;else{var v=r.material?i.toUnitRGBA(r.material.color):D;a.externalColor=v}this._fastUpdates=C.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(o.mixin(a,this._fastUpdates.materialParameters),a.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(a.instanced.push("color"),this._optionalFields.push("color"));var m=new R(a,t+"_objectmat");if(this._lodResources=S.primitiveLodResources(e,m,t),this._originalOpacities=A.materialsFromLodResources(this._lodResources).map(function(){return 1}),!this._lodResources)return this._logWarning("Unknown object symbol primitive: "+e),void this.reject();this.finalizeSymbolResources(),this.initializeLodRenderer(),this.complexity=this.computeComplexity(),this.resolve()},t.prototype._prepareModelResources=function(e,t){var r=this,i=["transformation"],l={materialParamsMixin:{instanced:i,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},idHint:t,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=C.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(o.mixin(l.materialParamsMixin,this._fastUpdates.materialParameters),i.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(i.push("color"),this._optionalFields.push("color"));var c=this.symbol;if("point-3d"===c.type&&c.verticalOffset){var u=c.verticalOffset,f=u.screenLength,h=u.minWorldLength,v=u.maxWorldLength;l.materialParamsMixin.verticalOffset={screenLength:s.pt2px(f),minWorldLength:h||0,maxWorldLength:null!=v?v:1/0},l.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=a.safeCast(_.fetch(e,l)),this._symbolLoaderPromise.then(function(e){if(r._symbolLoaderPromise=null,!r.isRejected()){var t=x.makeLodResources(e.lods);x.fillEstimatedMinScreenSpaceRadius(t),t.levels.sort(function(e,t){return e.minScreenSpaceRadius-t.minScreenSpaceRadius}),t.levels[0].minScreenSpaceRadius=Math.min(2,t.levels[0].minScreenSpaceRadius),r._lodResources=t;var n=r._context,i=r.symbolLayer.material,a=r._getExternalColorParameters(i),o=r._getMaterialOpacity(),s=r._isPropertyDriven("opacity"),l=A.materialsFromLodResources(r._lodResources);r._originalOpacities=l.map(function(e){return e.getParameters().opacity||1}),l.forEach(function(e){var t=e.getParameters();e.setParameterValues(a);var r=t.opacity*o,i=r<1||s||t.transparent;e.setParameterValues({opacity:r,transparent:i}),n.screenSizePerspectiveEnabled&&e.setParameterValues({screenSizePerspective:n.sharedResources.screenSizePerspectiveSettings})}),r._resourceBoundingBox=e.referenceBoundingBox,r._resourceSize=d.vec3f64.fromArray(p.size(r._resourceBoundingBox)),r._pivotOffset=d.vec3f64.fromArray(r._lodResources.levels[0].pivotOffset),r._symbolSize=d.vec3f64.fromArray(b.computeSizeWithResourceSize(r._resourceSize,r.symbolLayer)),C.updateFastSymbolUpdatesState(r._fastUpdates,r._context.renderer,r._fastVisualVariableConvertOptions())&&l.forEach(function(e){return e.setParameterValues(r._fastUpdates.materialParameters)}),r.finalizeSymbolResources(),r.initializeLodRenderer(),r.complexity=r.computeComplexity(),r.resolve()}},function(e){if(r._symbolLoaderPromise=null,!r.isFulfilled()){if(!(e instanceof n)){var t="ObjectSymbol3DLayer failed to load";e&&e.message&&(t+=" ("+e.message+")"),r._logWarning(t)}r.reject()}})},t.prototype.finalizeSymbolResources=function(){var e=this._context.stage;this._materials=A.materialsFromLodResources(this._lodResources),this._materials.forEach(function(t){e.add(E.ModelContentType.MATERIAL,t)}),this._textures=A.texturesFromLodResources(this._lodResources),this._textures.forEach(function(t){e.add(E.ModelContentType.TEXTURE,t)}),this._geometries=A.geometriesFromLodResources(this._lodResources),this._geometries.forEach(function(t){e.add(E.ModelContentType.GEOMETRY,t)})},t.prototype.initializeLodRenderer=function(){var e=this,t=this._context.stage,r={layerUid:this._context.layer.uid,graphicUid:function(t){return e._instanceIndexToGraphicUid.get(t)}},n=this._fastUpdates.enabled?{applyTransform:function(t,r,n){t.getFeatureAttribute(r,N),l.mat4.copy(n,C.evaluateModelTransform(e._fastUpdates.materialParameters,N,n))},scaleFactor:function(t,r,n){return r.getFeatureAttribute(n,N),C.evaluateModelTransformScale(t,e._fastUpdates.materialParameters,N)}}:null;this._lodRenderer=new O.LodRenderer(this._lodResources,this._optionalFields,r,n),this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled,t.addRenderPlugin(this._lodRenderer.slots,this._lodRenderer)},t.prototype._getExternalColorParameters=function(e){var t={};return this._isPropertyDriven("color")?t.externalColor=D:e&&e.color?t.externalColor=i.toUnitRGBA(e.color):(t.externalColor=D,t.colorMixMode="ignore"),t},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var t=this._context.stage;this._lodRenderer&&(t.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy()),this._materials&&this._materials.forEach(function(e){return t.remove(E.ModelContentType.MATERIAL,e.id)}),this._textures&&this._textures.forEach(function(e){return t.remove(E.ModelContentType.TEXTURE,e.id)}),this._geometries&&this._geometries.forEach(function(e){return t.remove(E.ModelContentType.GEOMETRY,e.id)})},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if(!this._validateGeometry(t.geometry))return null;var r=g.placePointOnGeometry(t.geometry);if(!r)return this._logWarning("unsupported geometry type for icon symbol: "+t.geometry.type),null;var n=this.getGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,r,i,n,t.uid)},t.prototype.notifyDestroyGraphicLayer=function(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)},t.prototype.graphicLayerToGraphicId=function(e){return 0},t.prototype.layerOpacityChanged=function(){var e=this,t=this._isPropertyDriven("opacity");return this._materials.forEach(function(r,n){var i=e._getMaterialOpacity()*e._originalOpacities[n];r.setParameterValues({opacity:i,transparent:i<1||t})}),!0},t.prototype.layerElevationInfoChanged=function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,g.needsElevationUpdates3D)},t.prototype.slicePlaneEnabledChanged=function(e,t){var r=this;return this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled,this._materials.forEach(function(e){e.setParameterValues({slicePlaneEnabled:r._context.slicePlaneEnabled})}),!0},t.prototype.pixelRatioChanged=function(e,t){return!0},t.prototype.applyRendererDiff=function(e,t){var r=this;for(var n in e.diff)switch(n){case"visualVariables":if(!C.updateFastSymbolUpdatesState(this._fastUpdates,t,this._fastVisualVariableConvertOptions()))return!1;this._materials.forEach(function(e){return e.setParameterValues(r._fastUpdates.materialParameters)}),this._lodRenderer.notifyShaderTransformationChanged();break;default:return!1}return!0},t.prototype.computeComplexity=function(){return this._lodResources?{primitivesPerFeature:A.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(e,t){return e+t.data.getIndices(T.VertexAttrConstants.POSITION).length},0)/3,primitivesPerCoordinate:0,memory:w.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer)}:e.prototype.computeComplexity.call(this)},t.prototype._createAs3DShape=function(e,t,r,n,i){var a=this.getFastUpdateAttrValues(e),o=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?b.mixinColorAndOpacity(r.color,r.opacity):null,s=this._context.clippingExtent;if(P.pointToVector(t,L,this._context.elevationProvider.spatialReference),s&&!g.pointInBox2D(L,s))return null;var l=this._requiresTerrainElevation(n),c=this._computeGlobalTransform(t,n,B,l?U:null),u=this._computeLocalTransform(this.symbolLayer,r,F),d=this._lodRenderer.instanceData,f=d.addInstance();this._instanceIndexToGraphicUid.set(f,i),d.setLocalTransform(f,u,!1),d.setGlobalTransform(f,c),a&&d.setFeatureAttribute(f,a),o&&d.setColor(f,o);var p=v.perLodInstanceElevationAligner,h=new m(this,f,p,n);return l&&(h.alignedTerrainElevation=U.terrainElevation),h.needsElevationUpdates=g.needsElevationUpdates3D(n.mode),g.extendPointGraphicElevationContext(h,t,this._context.elevationProvider),h},t.prototype._computeGlobalTransform=function(e,t,r,n){var i=g.computeElevation(this._context.elevationProvider,e,t,this._context.renderCoordsHelper,n);return L[0]=e.x,L[1]=e.y,L[2]=i,P.computeLinearTransformation(e.spatialReference,L,r,this._context.renderSpatialReference),r},t.prototype._computeLocalTransform=function(e,t,r){return l.mat4.identity(r),this._applyObjectRotation(t,!1,r),this._applyObjectRotation(e,!0,r),this._applyObjectScale(t,r),this._applyAnchor(e,r),r},t.prototype._applyObjectScale=function(e,t){if(!this._fastUpdates.enabled||!this._fastUpdates.requiresShaderTransformation){var r=this._isPropertyDriven("size")&&e.size?e.size:this._symbolSize,n=b.computeObjectScale(r,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters);1===n[0]&&1===n[1]&&1===n[2]||l.mat4.scale(t,t,n)}},t.prototype.prepareSymbolLayerPatch=function(e){if("partial"===e.diff.type){var t=e.diff.diff;this._preparePatchTransform(e,t),this._preparePatchColor(e,t)}},t.prototype.updateGeometry=function(e,t){var r=t&&g.placePointOnGeometry(t);if(!r)return!1;var n=this.getGeometryElevationMode(t);if(e.elevationContext.mode!==n)return!1;var i=this._requiresTerrainElevation(e.elevationContext);return this._computeGlobalTransform(r,e.elevationContext,B,i?U:null),i&&(e.alignedTerrainElevation=U.terrainElevation),this._lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,B,!0),g.extendPointGraphicElevationContext(e,r,this._context.elevationProvider),!0},t.prototype._preparePatchTransform=function(e,t){var r=this;if(t.heading||t.tilt||t.roll||t.width||t.height||t.depth||t.anchor||t.anchorPosition){var n=function(e,t,r){return(null!=e&&"complete"===e.type?e.newValue:t)||r},i=n(t.heading,this.symbolLayer.heading,0),a=n(t.tilt,this.symbolLayer.tilt,0),o=n(t.roll,this.symbolLayer.roll,0),s=n(t.width,this.symbolLayer.width,void 0),l=n(t.height,this.symbolLayer.height,void 0),c=n(t.depth,this.symbolLayer.depth,void 0),u=n(t.anchor,this.symbolLayer.anchor,void 0),f=n(t.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete t.heading,delete t.tilt,delete t.roll,delete t.width,delete t.height,delete t.depth,delete t.anchor,delete t.anchorPosition;var p={heading:i,tilt:a,roll:o,anchor:u,anchorPosition:f};this.isResolved()&&e.symbolLayerStatePatches.push(function(){r._symbolSize=d.vec3f64.fromArray(b.computeSizeWithResourceSize(r._resourceSize,{width:s,height:l,depth:c,isPrimitive:r.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push(function(e,t){var n=r._computeLocalTransform(p,t,F),i=e.instanceIndex;r._lodRenderer.instanceData.setLocalTransform(i,n,!0)})}},t.prototype._preparePatchColor=function(e,t){var r=this;if(t.material&&"partial"===t.material.type){var n=t.material.diff;if(n.color&&"complete"===n.color.type){var a=n.color.newValue,o=a?i.toUnitRGBA(a):D;delete n.color,e.graphics3DGraphicPatches.push(function(e,t){if(r._hasPerInstanceColor())r._lodRenderer.instanceData.setColor(e.instanceIndex,o);else for(var n=0,i=r._materials;n<i.length;n++){i[n].setParameterValues({externalColor:o})}})}}},t.prototype._requiresTerrainElevation=function(e){return"absolute-height"!==e.mode},t.prototype._applyObjectRotation=function(e,t,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&t))return b.computeObjectRotation(e.heading,e.tilt,e.roll,r)},t.prototype._computeAnchor=function(e){var t=d.vec3f64.create();switch(e.anchor){case"center":u.vec3.copy(t,p.center(this._resourceBoundingBox)),u.vec3.negate(t,t);break;case"top":var r=p.center(this._resourceBoundingBox);u.vec3.set(t,-r[0],-r[1],-this._resourceBoundingBox[5]);break;case"bottom":r=p.center(this._resourceBoundingBox);u.vec3.set(t,-r[0],-r[1],-this._resourceBoundingBox[2]);break;case"relative":r=p.center(this._resourceBoundingBox);var n=p.size(this._resourceBoundingBox),i=e.anchorPosition,a=i?d.vec3f64.fromValues(i.x,i.y,i.z):V;u.vec3.multiply(t,n,a),u.vec3.add(t,t,r),u.vec3.negate(t,t);break;case"origin":default:this._pivotOffset?u.vec3.negate(t,this._pivotOffset):u.vec3.copy(t,V)}return t},t.prototype._applyAnchor=function(e,t){if(!this._fastUpdates.enabled||!this._fastUpdates.requiresShaderTransformation){var r=this._computeAnchor(e);r&&l.mat4.translate(t,t,r)}},t.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")},t.prototype._fastVisualVariableConvertOptions=function(){var e=this._resourceBoundingBox?d.vec3f64.fromArray(p.size(this._resourceBoundingBox)):I,t=this._resourceBoundingBox?this._computeAnchor(this.symbolLayer):V,r=this._context.renderCoordsHelper.unitInMeters,n=b.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,r),i=d.vec3f64.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:e,symbolSize:this._symbolSize||I,unitInMeters:r,transformation:{anchor:t,scale:n,rotation:i}}},t}(y.default);t.Graphics3DObjectSymbolLayer=M;var I=d.vec3f64.fromValues(1,1,1),D=f.vec4f64.fromValues(1,1,1,1),V=d.vec3f64.fromValues(0,0,0),L=d.vec3f64.create(),F=c.mat4f64.create(),B=c.mat4f64.create(),N=f.vec4f64.create(),U={verticalDistanceToGround:0,terrainElevation:0};t.default=M}.apply(null,n))||(e.exports=i)},PHan:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("6DRN")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){var t=this;this.allocator=e,this.items=[],this.itemsPtr=0,this.tickHandle=r.before(function(){return t.reset()}),this.grow()}return e.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null),this.items=null},e.prototype.get=function(){return 0===this.itemsPtr&&r(function(){}),this.itemsPtr===this.items.length&&this.grow(),this.items[this.itemsPtr++]},e.prototype.reset=function(){var e=Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*i);this.items.length=Math.min(e,this.items.length),this.itemsPtr=0},e.prototype.grow=function(){for(var e=0;e<Math.max(8,Math.min(this.items.length,i));e++)this.items.push(this.allocator())},e}();t.ObjectStack=n;var i=1024;t.default=n}.apply(null,n))||(e.exports=i)},PNay:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("2Atf"),r("rg9i"),r("FXVB"),r("1m5D"),r("Rdxj"),r("oxlp"),r("s4LJ"),r("zF3d"),r("JzVu"),r("BwdQ"),r("3w6h"),r("mmEe"),r("krVM"),r("ys4y"),r("ZJC8"),r("J5Ri"),r("TP2F"),r("zU7+")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x){function _(e,t,r,n){var i=e.stageObject,a=i.getMetadata().pathGeometries,o=i.getGeometryRecords(),s=o.length;w.spatialReference=r.spatialReference;for(var l="absolute-height"!==t.mode,c=0,d=0;d<s;d++){for(var f=o[d].geometry,p=a[f.id],h=0,v=0,m=p.builder.path.vertices;v<m.length;v++){var g=m[v];w.x=g.mapPos[0],w.y=g.mapPos[1],w.z=g.mapPos[2],g.elevation=u.computeElevation(r,w,t,n,l?C:null),l&&(h+=C.terrainElevation)}p.updateElevation(n),f.invalidateBoundingInfo(),i.geometryVertexAttrsUpdated(d),c+=h/p.builder.path.vertices.length}return c/s}Object.defineProperty(t,"__esModule",{value:!0});var S=function(e){function t(t,r,n,a){var o=e.call(this,t,r,n,a)||this;if(!o._isPropertyDriven("size")){var l=f.validateSymbolLayerSize(o._getSymbolSize());if(l)return o._logWarning(l),o.reject(),o}o._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:o._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},o._context.renderer&&o._context.renderer.visualVariables&&o._context.renderer.visualVariables.length>0?o._fastUpdates=p.initFastSymbolUpdatesState(o._context.renderer,o._vvConvertOptions):o._fastUpdates={enabled:!1};var c=o._getStageIdHint(),u=o._getMaterialOpacityAndColor(),d=s.vec3f64.fromArray(u),h=u[3],m={diffuse:d,ambient:d,opacity:h,transparent:h<1||o._isPropertyDriven("opacity"),vertexColors:!1,slicePlaneEnabled:o._context.slicePlaneEnabled,castShadows:o.symbolLayer.castShadows};o._fastUpdates.enabled?(i.mixin(m,o._fastUpdates.materialParameters,{size:o._getSize()}),o._material=new x(m,c+"_pathmat")):(m.vertexColors=o._isPropertyDriven("color")||o._isPropertyDriven("opacity"),o._material=new b(m,c+"_pathmat")),o._context.stage.add(v.ModelContentType.MATERIAL,o._material),o._profile=y.Profile.tube(P);var g="tube";switch("profile"in o.symbolLayer&&(g=o.symbolLayer.profile),g){case"tube":default:o._profile=y.Profile.tube(P);break;case"strip":o._profile=y.Profile.strip(),o._material.setParameterValues({cullFace:"none"});break;case"fence":o._profile=y.Profile.fence(),o._material.setParameterValues({cullFace:"none"});break;case"wall":o._profile=y.Profile.wall()}o._extruder=new y.SimpleExtruder;var _="simple";switch("joint"in o.symbolLayer&&(_=o.symbolLayer.joint),_){case"round":o._extruder=new y.RoundExtruder(4);break;case"bevel":o._extruder=new y.BevelExtruder;break;case"simple":default:o._extruder=new y.SimpleExtruder}return o.resolve(),o}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(v.ModelContentType.MATERIAL,this._material.id),this._material=null)},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if("polyline"!==t.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+t.geometry.type),null;if(!this._validateGeometry(t.geometry))return null;var r="graphic"+t.uid,n=this.getGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,i,n,r,t.uid)},t.prototype.layerOpacityChanged=function(){var e=this._getMaterialOpacity(),t=e<1||this._isPropertyDriven("opacity");return this._material.setParameterValues({opacity:e,transparent:t}),!0},t.prototype.layerElevationInfoChanged=function(e,t,r){var n=this;return e.forEach(function(e){var r=t(e);if(r){var i=e.graphic,a=n.getGraphicElevationContext(i);r.needsElevationUpdates=u.needsElevationUpdates3D(a.mode),r.elevationContext.set(a)}}),!0},t.prototype.slicePlaneEnabledChanged=function(e,t){return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0},t.prototype.pixelRatioChanged=function(e,t){return!0},t.prototype.applyRendererDiff=function(e,t){for(var r in e.diff)switch(r){case"visualVariables":if(!p.updateFastSymbolUpdatesState(this._fastUpdates,t,this._vvConvertOptions))return!1;var n={};i.mixin(n,this._fastUpdates.materialParameters),this._material.setParameterValues(n);break;default:return!1}return!0},t.prototype._getSymbolSize=function(){return this.symbolLayer.size||1},t.prototype._getSize=function(){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?1:.5*this._getSymbolSize()/this._context.renderCoordsHelper.unitInMeters},t.prototype._createAs3DShape=function(e,t,r,n,i){var l={},f=e.geometry,p=f.paths,v=[],b=[],x=[],S=s.vec3f64.create(),w=this._context.renderSpatialReference===h.SphericalECEFSpatialReference,C=new Array(6),P=u.getGeometryVertexData3D(p,f.hasZ,f.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,r);if(this._logGeometryCreationWarnings(P,p,"paths","PathSymbol3DLayer"),p.length>0){for(var E=P.geometryData.outlines,T=P.eleVertexData,O=P.vertexData,A=0;A<E.length;++A){var R=E[A],M=R.index,I=R.count;if(!(I<2||this._context.clippingExtent&&(u.computeBoundingBox(T,M,I,C),u.boundingBoxClipped(C,this._context.clippingExtent)))){u.chooseOrigin(O,M,I,S),u.subtractCoordinates(O,M,I,S);var D=o.mat4f64.create();a.mat4.translate(D,D,S);var V=new y.Path(O,T,M,I,w,S),L=new y.Builder(V,this._profile,this._extruder),F=null;if(this._fastUpdates.enabled){var B=this._fastUpdates.visualVariables,N=B.size?d.getAttributeValue(B.size.field,e):0,U=B.color?d.getAttributeValue(B.color.field,e):0,z=B.opacity?d.getAttributeValue(B.opacity.field,e):0;F=new y.FastUpdatePathGeometry(L,N,U,z)}else{var j=1;this._isPropertyDriven("size")?j=t.size[0]:this.symbolLayer.size&&(j=this.symbolLayer.size),j*=.5/this._context.renderCoordsHelper.unitInMeters;var G=null;this._isPropertyDriven("color")&&(G=t.color),this._isPropertyDriven("opacity")&&null!=t.opacity&&(G=G?[G[0],G[1],G[2],t.opacity]:[1,1,1,t.opacity]),F=new y.StaticPathGeometry(L,j,G)}var H=F.createGeometryData(),k=new m(H,n+"path"+A);l[k.id]=F,k.singleUse=!0,v.push(k),b.push(this._material),x.push(D)}}var W={layerUid:this._context.layer.uid,graphicUid:i,pathGeometries:l};if(v.length>0){var q=new g({geometries:v,materials:b,transformations:x,castShadow:!0,metadata:W,idHint:n}),X=new c(this,q,v,null,null,_,r);return X.alignedTerrainElevation=P.terrainElevation,X.needsElevationUpdates=u.needsElevationUpdates3D(r.mode),X}}return null},t}(d.Graphics3DSymbolLayer);t.Graphics3DPathSymbolLayer=S;var w=new l,C={verticalDistanceToGround:0,terrainElevation:0},P=10;t.default=S}.apply(null,n))||(e.exports=i)},"PT+s":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf")],void 0===(i=function(e,t,r){function n(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":break;default:e.ESRI_externalColorMixMode="tint"}return e}Object.defineProperty(t,"__esModule",{value:!0});var i={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},a={pbrMetallicRoughness:i,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},o={ESRI_externalColorMixMode:"tint"};t.material=function(e){void 0===e&&(e={});var t=r({},i,e.pbrMetallicRoughness),s=n(r({},o,e.extras));return r({},a,e,{pbrMetallicRoughness:t,extras:s})};var s={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};t.textureSampler=function(e){return r({},s,e)}}.apply(null,n))||(e.exports=i)},"PwS/":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("1m5D"),r("rjU6"),r("CIy2"),r("Kfys")],void 0===(i=function(e,t,r,n,i,a,o){Object.defineProperty(t,"__esModule",{value:!0}),t.generateRenderGeometryVisibleIndexRanges=function(e){if(e.instanceParameters.hidden)return[];var t=e.instanceParameters.componentVisibilities,r=e.componentOffsets;return i.generateVisibleIndexRanges(t,r)},t.generateRenderGeometryHighlightRanges=function(e){if(e.instanceParameters.hidden)return null;var t=e.instanceParameters.componentVisibilities,r=e.instanceParameters.componentHighlights,n=e.componentOffsets;return i.generateHighlightedIndexRanges(t,r,n)},t.doesRenderGeometryHaveHighlights=function(e){if(e.instanceParameters.hidden)return!1;var t=e.instanceParameters.componentVisibilities,r=e.instanceParameters.componentHighlights,n=e.componentOffsets;return i.hasHighlights(t,r,n)},t.isRenderGeometryHidden=function(e){if(e.instanceParameters.hidden)return!0;var t=e.instanceParameters.componentVisibilities,r=e.componentOffsets;return i.isAllHidden(t,r)},t.drawArrays=function(e,t,r,n,i){e.drawArrays(t,r,n),i&&(i.drawCalls++,4===t&&(i.triangles+=n))},t.drawElements=function(e,t,r,n,i,a){var s=o.getBytesPerElement(r);e.drawElements(t,i,r,n*s),a&&(a.drawCalls++,4===t&&(a.triangles+=i))},t.drawArraysFaceRange=function(e,t,r,n,i){for(var a=0,o=0,s=t;o<s.length;o++){var l=s[o],c=l[0]+r,u=l[1]-l[0]+1;a+=u,e.drawArrays(n,c,u)}i&&(i.drawCalls+=t.length,4===n&&(i.triangles=a/3))},t.drawElementsFaceRange=function(e,t,r,n,i,a){for(var s=o.getBytesPerElement(i),l=0,c=0,u=t;c<u.length;c++){var d=u[c],f=d[0]+r,p=d[1]-d[0]+1;l+=p,e.drawElements(n,p,i,f*s)}a&&(a.drawCalls+=t.length,4===n&&(a.triangles+=l/3))},t.acquireMaterials=function(e,t){var r=new Map;return r.set(0,t.aquire(e,"color")),r.set(3,t.aquire(e,"depthShadowMap")),r.set(2,t.aquire(e,"normal")),r.set(1,t.aquire(e,"depth")),r.set(4,t.aquire(e,"highlight")),r},t.releaseMaterials=function(e,t){t.release(e.id,"color"),t.release(e.id,"depthShadowMap"),t.release(e.id,"normal"),t.release(e.id,"depth"),t.release(e.id,"highlight")},t.calculateTransformRelToOrigin=function(e,t,n){var i=e.origin.vec3;a.setMatrixTranslation3(s,-i[0],-i[1],-i[2]),r.mat4.multiply(t,s,e.transformation),n&&(r.mat4.invert(n,t),r.mat4.transpose(n,n))};var s=n.mat4f64.create()}.apply(null,n))||(e.exports=i)},Q39H:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("fV0t"),r("QTYv")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.vec3=r,t.vec4=n}.apply(null,n))||(e.exports=i)},Q55v:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("HZ3d"),r("Q2wQ"),r("KY0m"),r("qMld"),r("ADZV"),r("rusB"),r("8V7H"),r("1m5D"),r("0LE5"),r("Rdxj"),r("O7NG"),r("AzkI"),r("VfPl"),r("TqPN"),r("hkmr"),r("p23x"),r("UD5A"),r("yBJI"),r("IfBv"),r("W7eI"),r("HSGS"),r("8fHt"),r("E/UE"),r("qC//"),r("BtPY"),r("QFi0"),r("qbr3"),r("z2+Q"),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w,C,P,E,T,O,A,R,M){Object.defineProperty(t,"__esModule",{value:!0});var I=function(){function t(e,t,r){this.rctx=e,this.programRepository=t,this.callbacks=r,this.profilingCallback=null,this.perObjectData=new Map,this.renderers=new Map,this.localOrigins=new b.LocalOriginManager(new g),this.numberOfRenderedEdges=0,this.gpuMemoryUsage=0,this.worker=new C,this.workerThread=null,this.destroyed=!1,this.tmpModelPosition=f.vec3f64.create(),this.tmpCameraPosition=f.vec3f64.create(),this.componentColorManager=new _.BufferManager(this.rctx,2)}return t.prototype.initialize=function(){var t=this;c.open(s.getAbsMid("./EdgeProcessingWorker",e,M)).then(function(e){t.destroyed?e.close():t.workerThread=e});for(var r=S.VertexLayout.createBuffer(4),n=0;n<4;n++)r.sideness.set(n,0,0===n||3===n?0:1),r.sideness.set(n,1,0===n||1===n?0:1);this.verticesBufferObject=O.createVertex(this.rctx,35044,r.buffer);var i=this.rctx.capabilities.blendMinMax;this.pipelineState=i?A.makePipelineState({blending:A.separateBlendingParams(1,1,0,1,32774,i.MAX),depthTest:{func:515},colorWrite:A.defaultColorWriteParams}):A.makePipelineState({depthTest:{func:515},depthWrite:A.defaultDepthWriteParams,colorWrite:A.defaultColorWriteParams})},t.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)},t.prototype.getUsedMemory=function(){return this.gpuMemoryUsage},Object.defineProperty(t.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0}),t.prototype.shouldRender=function(){return this.renderers.size>0},t.prototype.addObject=function(e,t,r,a,s){return n(this,void 0,void 0,function(){var n,l,c,u,d,f;return i(this,function(i){switch(i.label){case 0:if(this.hasObject(e))return[2];if(n=new Array,c={loaded:o.create(function(e){return l=e}),renderables:[]},this.perObjectData.set(e,c),s&&s.mergeGeometries&&e.geometries.length>1&&this.canMergeGeometries(e))n.push(this.addObjectMergedGeometries(e,c,t,r));else for(u=0;u<e.geometries.length;u++)d=e.geometries[u],f=e.geometryRecords[u],f.material.supportsEdges&&(d.data instanceof x?n.push(this.addGeometryPreinterleaved(e,c,d,d.data,f,t,r,a)):n.push(this.addGeometryNonPreinterleaved(e,c,d,d.data,f,t[0],r,a)));return[4,o.all(n)];case 1:return i.sent(),this.callbacks.setNeedsRender(),l(),[2]}})})},t.prototype.hasObject=function(e){return this.perObjectData.has(e)},t.prototype.updateAllComponentOpacities=function(e,t){return n(this,void 0,void 0,function(){var r,n;return i(this,function(i){switch(i.label){case 0:return[4,this.getObjectEntry(e)];case 1:return r=i.sent(),n=t instanceof Array?function(e){return t[e]}:function(e){return t},r.renderables.forEach(function(e){for(var t=e.components.meta.length,r=0;r<t;r++){var i=n(r),a=e.components.meta[r],o=a.index;a.material.opacity=i,e.components.buffer.textureBuffer.setDataElement(o,1,3,255*i)}e.allTransparent=T.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateAllComponentMaterials=function(e,t,r,a){return void 0===a&&(a=!0),n(this,void 0,void 0,function(){var n,o,s,l,c=this;return i(this,function(i){switch(i.label){case 0:return[4,this.getObjectEntry(e)];case 1:return n=i.sent(),o=r.slicePlaneEnabled||!1,s=T.determineRendererType(t),l=P.EdgeRenderer.getKey(s,o),n.renderables.forEach(function(e){if(l!==e.rendererKey){var r=c.renderers.get(e.rendererKey),n=c.acquireRenderer(s,o);r.removeRenderable(e),r.refCount.decrement(),e.rendererKey=l,n.addRenderable(e)}for(var i=0;i<t.length;i++)e.components.meta[i].material=t[i];a&&c.updateComponentBuffer(e.components),e.allTransparent=T.determineAllTransparent(e.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.updateObjectVisibility=function(e,t){return n(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return[4,this.getObjectEntry(e)];case 1:return r.sent().renderables.forEach(function(e){e.visible=t}),this.callbacks.setNeedsRender(),[2]}})})},t.prototype.removeObject=function(e){var t=this,r=this.perObjectData.get(e);r&&(this.perObjectData.delete(e),r.loaded.then(function(){r.renderables.forEach(function(e){t.removeRenderable(e)}),t.callbacks.setNeedsRender()}))},t.prototype.getObjectEntry=function(e){return n(this,void 0,void 0,function(){var t;return i(this,function(r){switch(r.label){case 0:if(!(t=this.perObjectData.get(e)))throw"no object";return[4,t.loaded];case 1:return r.sent(),[2,t]}})})},t.prototype.removeAll=function(){var e=this;this.perObjectData.forEach(function(t,r){e.removeObject(r)})},t.prototype.createSolidEdgeMaterial=function(e){return r({},D,e,{type:"solid"})},t.prototype.createSketchEdgeMaterial=function(e){return r({},V,e,{type:"sketch"})},t.prototype.render=function(e){var t=this;this.localOrigins.updateViewMatrices(e.view),this.renderers.forEach(function(e){0===e.refCount.value&&(t.renderers.delete(e.key),e.dispose())}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures();var r=e.view,n=0,i=0;this.renderers.forEach(function(e){e.forEachRenderable(function(e){n+=e.statistics.averageEdgeLength,i++})});var a={distanceFalloffFactor:40*(n/i),minimumEdgeLength:T.estimateLengthAtDistance(e.viewport[3],e.fovY,1,3.5*e.pixelRatio)};this.rctx.setPipelineState(this.pipelineState),this.updateObjectCameraDistances(e),this.numberOfRenderedEdges=0,this.renderers.forEach(function(r){t.renderRegularEdges(r,e,a),t.renderSilhouetteEdges(r,e,a)}),e.view=r},t.prototype.computeModelTransformWithLocalOrigin=function(e,t,r){if(e.getCombinedStaticTransformation(t,r),t.origin)this.localOrigins.register(t.origin);else{var n=d.vec3.set(this.tmpModelPosition,r[12],r[13],r[14]);t.origin=this.localOrigins.aquire(n)}return y.applyToModelMatrix(t.origin.vec3,r),r},t.prototype.updateComponentBuffer=function(e){for(var t=e.meta,r=e.buffer,n=0;n<t.length;n++){var i=t[n].material,a=t[n].index,o=h.clamp(Math.round(i.size*P.LINE_WIDTH_FRACTION_FACTOR),0,255),s=h.clamp(i.extensionLength,-P.EXTENSION_LENGTH_OFFSET,255-P.EXTENSION_LENGTH_OFFSET)+P.EXTENSION_LENGTH_OFFSET,l="solid"===i.type?0:1,c=255*i.opacity,u=i.color,d=255*u[0],f=255*u[1],p=255*u[2],v=255*u[3];r.textureBuffer.setData(a,0,d,f,p,v),r.textureBuffer.setData(a,1,o,s,l,c)}},t.prototype.createComponentBuffers=function(e){for(var t=[],r=this.componentColorManager.getBuffer(e.length),n=0;n<e.length;n++){var i=e[n],a=r.aquireIndex();t.push({index:a,material:i})}var o={meta:t,buffer:r};return this.updateComponentBuffer(o),o},t.prototype.extractEdges=function(e,t,r,n,i){return this.worker.process({data:t,originalIndices:i,writerSettings:e,skipDeduplicate:r},n?null:this.workerThread)},t.prototype.createEdgeResources=function(e){var t={};if(e.regular.lodInfo.lengths.length>0){var r=new R(this.rctx,S.EdgeShaderAttributeLocations,{vertices:S.glVertexLayout,instances:w.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:O.createVertex(this.rctx,35044,e.regular.instancesData.buffer)});t.regular={vao:r,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){r=new R(this.rctx,S.EdgeShaderAttributeLocations,{vertices:S.glVertexLayout,instances:w.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:O.createVertex(this.rctx,35044,e.silhouette.instancesData.buffer)});t.silhouette={vao:r,lod:e.silhouette.lodInfo}}return t},t.prototype.disposeEdgeResources=function(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)},t.prototype.addGeometryNonPreinterleaved=function(e,t,r,a,o,s,l,c){return n(this,void 0,void 0,function(){var r,n,d,f;return i(this,function(i){return r=a.getAttribute("position"),n=this.computeModelTransformWithLocalOrigin(e,o,u.mat4f64.create()),d=o.origin,f={position:r,indices:a.getIndices("position"),modelTransform:n,origin:d},[2,this.addNonPreinterleaved(e,t,f,s,l,c)]})})},t.prototype.addNonPreinterleaved=function(e,t,r,a,o,s){return void 0===s&&(s=!1),n(this,void 0,void 0,function(){var e,n,l,c,u,d,f,p,h,v,m,g,y,b,x;return i(this,function(i){switch(i.label){case 0:for(e=this.acquireRenderer(a.type,o.slicePlaneEnabled||!1),n=r.modelTransform,l=r.origin,c=r.indices,u=r.position,d=u.data.length/u.strideIdx,f=S.EdgeInputBufferLayout.createBuffer(d),p=0;p<d;p++)f.position.set(p,0,u.data[u.offsetIdx+p*u.strideIdx+0]),f.position.set(p,1,u.data[u.offsetIdx+p*u.strideIdx+1]),f.position.set(p,2,u.data[u.offsetIdx+p*u.strideIdx+2]);return h=this.createComponentBuffers([a]),T.fillComponenBufferIndices(h.meta,[0,f.componentIndex.count],f.componentIndex),[4,this.extractEdges(e.writerSettings,f,!1,s,c)];case 1:return v=i.sent(),m=this.createEdgeResources(v),g=m.regular,y=m.silhouette,b=(g?g.vao.size:0)+(y?y.vao.size:0),x={regular:g,silhouette:y,transform:{modelMatrix:n,origin:l},statistics:{gpuMemoryUsage:b,averageEdgeLength:v.averageEdgeLength},components:h,visible:!0,allTransparent:T.determineAllTransparent(h.meta),distanceToCamera:0,rendererKey:e.key},t.renderables.push(x),e.addRenderable(x),this.gpuMemoryUsage+=b,[2]}})})},t.prototype.addGeometryPreinterleaved=function(e,t,r,a,o,s,c,d){return n(this,void 0,void 0,function(){var r,n,f,p,h,g,y,b,x,_,w,C,P,E,O,A;return i(this,function(i){switch(i.label){case 0:return(r=a.getAttribute("position"))&&l.isFloat32Array(r.data)?(n=T.determineRendererType(s),f=this.acquireRenderer(n,c.slicePlaneEnabled||!1),p=this.computeModelTransformWithLocalOrigin(e,o,u.mat4f64.create()),h=o.origin,g=a.getIndices("position"),y=new v.BufferViewVec3f(r.data.buffer,4*r.offsetIdx,4*r.strideIdx),b=S.EdgeInputBufferLayout.createBuffer(y.count),m.vec3.copy(b.position,y),x=this.createComponentBuffers(s),T.fillComponenBufferIndices(x.meta,a.componentOffsets,b.componentIndex,g),_=a.hasPositionData,[4,this.extractEdges(f.writerSettings,b,_,d,g)]):[2];case 1:return w=i.sent(),C=this.createEdgeResources(w),P=C.regular,E=C.silhouette,O=(P?P.vao.size:0)+(E?E.vao.size:0),A={regular:P,silhouette:E,transform:{modelMatrix:p,origin:h},statistics:{gpuMemoryUsage:O,averageEdgeLength:w.averageEdgeLength},components:x,visible:!e.isHidden(o),allTransparent:T.determineAllTransparent(x.meta),distanceToCamera:0,rendererKey:f.key},t.renderables.push(A),f.addRenderable(A),this.gpuMemoryUsage+=O,[2]}})})},t.prototype.canMergeGeometries=function(e){for(var t=null,r=null,n=0;n<e.geometries.length;n++){var i=e.geometries[n],o=e.geometryRecords[n];if(o.material.supportsEdges){if(i.data instanceof x)return!1;if(t){if(!a.equals(t,o.transformation))return!1}else t=o.transformation;if(!r&&o.origin)r=o;else if(r&&o.origin&&r.origin.id!==o.origin.id)return!1}}return!0},t.prototype.addObjectMergedGeometries=function(e,t,r,a){return n(this,void 0,void 0,function(){var n,o,s,c,d,f,p,h,v,m,g,y,b,x,_,S,w,C,P,E;return i(this,function(i){switch(i.label){case 0:for(n=new Map,o=0,s=null,c=null,P=0;P<e.geometries.length;P++)v=e.geometries[P],d=e.geometryRecords[P],d.material.supportsEdges&&(!c&&d.origin&&(c=d),y=v.data.getIndices("position"),o+=y?y.length:0,(y&&null==s||s===Uint16Array)&&(s=l.isUint16Array(y)?Uint16Array:Uint32Array));for(f=o?new s(o):null,p=[],h=0,P=0;P<e.geometries.length;P++)if(v=e.geometries[P],m=e.geometryRecords[P],m.material.supportsEdges){if(g=v.data.getAttribute("position"),y=v.data.getIndices("position"),null==(b=n.get(g.data))){for(b=p.length/3,x=g.offsetIdx;x<g.data.length;x+=g.strideIdx)p.push(g.data[x+0]),p.push(g.data[x+1]),p.push(g.data[x+2]);n.set(g.data,b)}if(y)for(_=0;_<y.length;_++)f[h++]=b+y[_]}for(S=c||e.geometryRecords[0],w=this.computeModelTransformWithLocalOrigin(e,S,u.mat4f64.create()),C=S.origin,P=0;P<e.geometryRecords.length;P++)e.geometryRecords[P].origin=C;return E={position:{data:p,offsetIdx:0,strideIdx:3},indices:f,modelTransform:w,origin:C},[4,this.addNonPreinterleaved(e,t,E,r[0],a)];case 1:return i.sent(),[2]}})})},t.prototype.acquireRenderer=function(e,t){var r=P.EdgeRenderer.getKey(e,t),n=this.renderers.get(r);return this.strokesTexture||(this.strokesTexture=E.generateStrokesTexture(this.rctx)),n||(n=new P.EdgeRenderer(this.rctx,this.programRepository,{type:e,slicePlaneEnabled:t,strokesTexture:this.strokesTexture}),this.renderers.set(r,n)),n.refCount.increment(),n},t.prototype.removeRenderable=function(e){var t=this.renderers.get(e.rendererKey);t.removeRenderable(e),t.refCount.decrement(),this.disposeEdgeResources(e),this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.gpuMemoryUsage;for(var r=0,n=e.components.meta;r<n.length;r++){var i=n[r];e.components.buffer.releaseIndex(i.index)}},t.prototype.updateObjectCameraDistances=function(e){var t=this,r=e.viewInvTransp;d.vec3.set(this.tmpCameraPosition,r[3],r[7],r[11]),this.perObjectData.forEach(function(e,r){var n=d.vec3.distance(r.getCenter(),t.tmpCameraPosition);e.renderables.forEach(function(e){return e.distanceToCamera=n})})},t.prototype.renderRegularEdges=function(e,t,r){var n=this;e.bindRegularEdges(t,r),e.forEachRenderable(function(i){if(i.visible&&i.regular&&!i.allTransparent){var a=T.computeEdgeCount(i.regular.lod.lengths,i.distanceToCamera,r);t.view=n.localOrigins.getViewMatrix(i.transform.origin),e.renderRegularEdges(i,t,a),n.numberOfRenderedEdges+=a}})},t.prototype.renderSilhouetteEdges=function(e,t,r){var n=this;e.bindSilhouetteEdges(t,r),e.forEachRenderable(function(i){if(i.visible&&i.silhouette&&!i.allTransparent){var a=T.computeEdgeCount(i.silhouette.lod.lengths,i.distanceToCamera,r);t.view=n.localOrigins.getViewMatrix(i.transform.origin),e.renderSilhouetteEdges(i,t,a),n.numberOfRenderedEdges+=a}})},t}();t.EdgeView=I;var D={color:p.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1},V={color:p.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1}}.apply(null,n))||(e.exports=i)},"Q7+X":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("wCQF"),r("XIUG")],void 0===(i=function(e,t,r,n,i){return function(e){function t(t,r,i){var a=e.call(this,t,r,i)||this;return a.calloutSymbolLayer=null,a.symbol.hasVisibleCallout()&&(a.calloutSymbolLayer=n.make(a.symbol,r)),a}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.createGraphics3DGraphic=function(t,r,n){var i=e.prototype.createGraphics3DGraphic.call(this,t,n);if(this.calloutSymbolLayer){var a=this.createCalloutGraphic(t);a&&i.addAuxiliaryGraphic(a)}return i},t.prototype.globalPropertyChanged=function(t,r){var n=this;if(!e.prototype.globalPropertyChanged.call(this,t,r))return!1;if(this.calloutSymbolLayer){return this.calloutSymbolLayer.globalPropertyChanged(t,r,function(e){for(var t=0,r=e._auxiliaryGraphics;t<r.length;t++){var i=r[t];if(i.graphics3DSymbolLayer===n.calloutSymbolLayer)return i}})}return!0},t.prototype.createCalloutGraphic=function(e){var t=e.renderingInfo,r={renderer:t.renderer,symbol:t.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return e.renderingInfo=r,this.calloutSymbolLayer.createGraphics3DGraphic(e)},t}(i)}.apply(null,n))||(e.exports=i)},QDiq:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("0LE5"),r("Rdxj"),r("O7NG"),r("2Mej")],void 0===(i=function(e,t,r,n,i,a){Object.defineProperty(t,"__esModule",{value:!0});var o=n.vec3f64.create(),s=function(){function e(){this._renderLighting={main:{intensity:n.vec3f64.create(),direction:n.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}},this._shOrder=2,this._oldDirection=n.vec3f64.create(),this._oldSpecular=i.vec4f64.create(),this._oldDiffuse=i.vec4f64.create(),this._oldAmbient=i.vec4f64.create()}return e.prototype.setUniforms=function(e,t){if(void 0===t&&(t=!1),t||e.getDefine("GROUND_NORMAL_SHADING")){var r=(1-this._info.groundLightingFactor)*(1-this._info.globalFactor);e.setUniform1f("lightingFixedFactor",r)}else e.setUniform1f("lightingFixedFactor",0);e.setUniform1f("lightingGlobalFactor",this._info.globalFactor),e.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction),e.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity),e.setUniform1f("ambientBoostFactor",.4);var n=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",n.r[0],n.r[1],n.r[2],n.r[3]),e.setUniform4f("lightingAmbientSH_G",n.g[0],n.g[1],n.g[2],n.g[3]),e.setUniform4f("lightingAmbientSH_B",n.b[0],n.b[1],n.b[2],n.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",n.r[0],n.g[0],n.b[0]),e.setUniform4f("lightingAmbientSH_R1",n.r[1],n.r[2],n.r[3],n.r[4]),e.setUniform4f("lightingAmbientSH_G1",n.g[1],n.g[2],n.g[3],n.g[4]),e.setUniform4f("lightingAmbientSH_B1",n.b[1],n.b[2],n.b[3],n.b[4]),e.setUniform4f("lightingAmbientSH_R2",n.r[5],n.r[6],n.r[7],n.r[8]),e.setUniform4f("lightingAmbientSH_G2",n.g[5],n.g[6],n.g[7],n.g[8]),e.setUniform4f("lightingAmbientSH_B2",n.b[5],n.b[6],n.b[7],n.b[8])),e.setUniform3fv("lightDirection",this._oldDirection)},e.prototype.set=function(e){this._info=e,a.combineLights(e.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics),r.vec3.negate(this._oldDirection,this._renderLighting.main.direction);var t=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*t,this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*t,this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*t,this._oldAmbient[3]=1,this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*t,this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*t,this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*t,this._oldDiffuse[3]=1;var n=r.vec3.copy(o,this._oldDiffuse);r.vec3.scale(n,n,.4*this._info.globalFactor),r.vec3.add(this._oldAmbient,this._oldAmbient,n)},Object.defineProperty(e.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0}),e.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}},e}();t.SceneLighting=s}.apply(null,n))||(e.exports=i)},QJWI:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("H1tY"),r("VCyw"),r("Rdxj"),r("RsYQ"),r("FM7k")],void 0===(i=function(e,t,r,n,i,a,o){var s=r("dojo-debug-messages"),l=function(){function e(e,t,r,n,s){this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,renderTimeTotal:0,renderTimeLast:0,frameCount:0},this._needsRender=!0,this._rctx=s,this._renderer=new o(t,r,n,s,"scene",e),this._camera=new a(i.vec3f64.fromValues(0,100,-100))}return Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.getCombinedStats=function(){var e=this._rctx.gl,t={},r=this._renderer.getCombinedStats();for(var n in r)t[n]=r[n];if(t.renderGeometriesTotal=this._stats.renderGeometriesTotal,t.renderGeometriesVisible=this._stats.renderGeometriesVisible,s&&(t.totalRenderTime=this._stats.renderTimeTotal,t.currentRenderTime=this._stats.renderTimeLast,t.totalNumFramesRendered=this._stats.frameCount),void 0!==e.getUsedTextureMemory&&(t.textureMemory=e.getUsedTextureMemory()),void 0!==e.getUsedRenderbufferMemory&&(t.renderbufferMemory=e.getUsedRenderbufferMemory()),void 0!==e.getUsedVBOMemory&&(t.VBOMemory=e.getUsedVBOMemory()),void 0!==e.getUsedTextureMemoryStats){var i=e.getUsedTextureMemoryStats();for(var a in i)t["texMem type: "+a]=i[a]}return t},e.prototype.dispose=function(){this._renderer.dispose(),this._renderer=null},e.prototype.setLighting=function(e){this._renderer.setLighting(e)},e.prototype.setRenderParams=function(e){this._renderer.setRenderParams(e)},e.prototype.getRenderParams=function(){return this._renderer.getRenderParams()},e.prototype.ensureEdgeView=function(){return this._renderer.ensureEdgeView()},Object.defineProperty(e.prototype,"hasSlicePlane",{get:function(){return this._renderer.hasSlicePlane},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeView",{get:function(){return this._renderer.edgeView},enumerable:!0,configurable:!0}),e.prototype.modify=function(e,t,r,n){this._renderer.modify(e,t,r,n)},e.prototype.setCamera=function(e){this._camera.copyFrom(e),this._needsRender=!0},e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0}),e.prototype.getFramebufferTexture=function(e){return this._renderer.getFramebufferTexture(e)},e.prototype.render=function(e){var t;s&&(t=n()),c.camera=e.camera||this._camera,c.fbo=e.fbo,c.lightDirection=e.lightDirection,c.disableSlice=e.disableSlice||!1,this._renderer.render(c),s&&(this._stats.renderTimeLast=n()-t,this._stats.renderTimeTotal+=this._stats.renderTimeLast,this._stats.frameCount++)},e.prototype.resetNeedsRender=function(){this._needsRender=!1,this._renderer.resetNeedsRender()},e.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()},Object.defineProperty(e.prototype,"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0}),e.prototype.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()},e}(),c={fbo:null,lightDirection:null,camera:null,disableSlice:!1};return l}.apply(null,n))||(e.exports=i)},QTYv:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("TUJR")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.transformMat4=function(e,t,n){if(e.count===t.count)for(var i=e.count,a=n[0],o=n[1],s=n[2],l=n[3],c=n[4],u=n[5],d=n[6],f=n[7],p=n[8],h=n[9],v=n[10],m=n[11],g=n[12],y=n[13],b=n[14],x=n[15],_=e.typedBuffer,S=e.typedBufferStride,w=t.typedBuffer,C=t.typedBufferStride,P=0;P<i;P++){var E=P*S,T=P*C,O=w[T],A=w[T+1],R=w[T+2],M=w[T+3];_[E]=a*O+c*A+p*R+g*M,_[E+1]=o*O+u*A+h*R+y*M,_[E+2]=s*O+d*A+v*R+b*M,_[E+3]=l*O+f*A+m*R+x*M}else r.logger.error("source and destination buffers need to have the same number of elements")},t.transformMat3=function(e,t,n){if(e.count===t.count)for(var i=e.count,a=n[0],o=n[1],s=n[2],l=n[3],c=n[4],u=n[5],d=n[6],f=n[7],p=n[8],h=e.typedBuffer,v=e.typedBufferStride,m=t.typedBuffer,g=t.typedBufferStride,y=0;y<i;y++){var b=y*v,x=y*g,_=m[x],S=m[x+1],w=m[x+2],C=m[x+3];h[b]=a*_+l*S+d*w,h[b+1]=o*_+c*S+f*w,h[b+2]=s*_+u*S+p*w,h[b+3]=C}else r.logger.error("source and destination buffers need to have the same number of elements")},t.scale=function(e,t,r){for(var n=Math.min(e.count,t.count),i=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,s=t.typedBufferStride,l=0;l<n;l++){var c=l*a,u=l*s;i[c]=r*o[u],i[c+1]=r*o[u+1],i[c+2]=r*o[u+2],i[c+3]=r*o[u+3]}}}.apply(null,n))||(e.exports=i)},QWGo:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("Rdxj"),r("O7NG"),r("Dk48"),r("9DjX"),r("RsYQ"),r("zZCp"),r("/Bau"),r("hkmr"),r("FM7k"),r("qUb7"),r("o5p5"),r("xFEL"),r("RC9r"),r("31XB"),r("/f24"),r("qbr3"),r("Zp3t"),r("Kfys")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x){var _,S=function(){function e(e,t,r,a,o,s){var l=this;this._renderTargets={},this._clearColor=i.vec4f64.fromValues(0,0,0,0),this._uniqueIdx=0,this._localOrigins=new u,this._rctx=e,this._canvas=t,this._programRep=r,this._modelDirtySet=s,this._modelDirtySet.onMaterialChanged=function(e){return l.materialChanged(e)},this._renderer=new d(r,a,o,this._rctx,"draped"),this._renderer.onHasHighlightsChanged=function(e){l.onHasHighlightsChanged&&l.onHasHighlightsChanged(e)},this._renderer.setLighting({lights:[new f.AmbientLight(n.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})}return e.prototype.dispose=function(){for(var e in this._renderTargets)this._renderTargets[e].dispose();this._renderTargets=null,this._renderer.dispose(),this._renderer=null},e.prototype.createRenderTarget=function(e){return this.createRenderTargetInternal(e,!0)},e.prototype.createHighlightRenderTarget=function(e){return this.createRenderTargetInternal(e,!1)},e.prototype.disposeRenderTarget=function(e){var t=this._renderTargets[e];t&&t.dispose(),delete this._renderTargets[e]},e.prototype.getRenderTargetTexture=function(e){var t=this._renderTargets[e];return t?t.colorTexture:null},e.prototype.addRenderGeometries=function(e){var t=this;e.forEach(function(e){null==e.origin&&(e.origin=t._localOrigins.getOrigin(e.center)),e.idx=t._uniqueIdx++}),this._renderer.modify(e,[]),this.onContentChanged&&this.onContentChanged()},e.prototype.removeRenderGeometries=function(e){this._renderer.modify([],e),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderGeometries=function(e,t){var r=e.map(function(e){return{renderGeometry:e,updateType:t}});this._renderer.modify([],[],r),this.onContentChanged&&this.onContentChanged()},e.prototype.updateRenderOrder=function(e){e.size>0&&(this._renderer.modifyRenderOrder(e),this.onContentChanged&&this.onContentChanged())},e.prototype.setBackgroundColor=function(e){this._clearColor=e,this.onContentChanged&&this.onContentChanged()},e.prototype.updateHighlights=function(e){this.updateRenderGeometries(e,16)},e.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!a.OVERLAY_DRAW_TEST_TEXTURE},e.prototype.processDirtyMaterials=function(){var e=this._modelDirtySet.getDirtyMaterials();e&&this._renderer.modify([],[],[],e),this._modelDirtySet.clearDirtyMaterials()},Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0}),e.prototype.draw=function(e,t){return this.drawPass(0,e,t)},e.prototype.drawHighlights=function(e,t){return this.drawPass(4,e,t)},e.prototype.drawPass=function(e,t,n){if(_=n.pixelRatio*Math.abs(n.views[0].extent[2]-n.views[0].extent[0])/Math.abs(n.views[0].viewport[2]-n.views[0].viewport[0]),this.isEmpty()||4===e&&!this.hasHighlights)return!1;if(this.processDirtyMaterials(),!n.views.some(function(e){return e.extent[0]!==e.extent[2]&&e.extent[1]!==e.extent[3]}))return!1;var i=this._renderTargets[t];if(!i)return!1;var o=this._rctx,s=n.width,l=n.height;i.width===s&&i.height===l||(i.resize(s,l),i.colorTexture.setSamplingMode(9729));var c=C.camera;C.fbo=i,c.near=1,c.far=1e4,c.pixelRatio=n.pixelRatio||1,o.bindFramebuffer(i),o.setClearColor.apply(o,this._clearColor),o.clearSafe(16384);for(var u=0;u<n.views.length;u++){var d=n.views[u];c.viewport=d.viewport,r.mat4.ortho(c.projectionMatrix,0,d.extent[2]-d.extent[0],0,d.extent[3]-d.extent[1],c.near,c.far),r.mat4.identity(c.viewMatrix),r.mat4.translate(c.viewMatrix,c.viewMatrix,[-d.extent[0],-d.extent[1],0]),c.setGLViewport(this._rctx),a.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(s,l,w[n.index%w.length]),this._renderer.renderPass(e,C)}return o.bindFramebuffer(null),o.setViewport(0,0,this._canvas.width,this._canvas.height),i.colorTexture.descriptor.hasMipmap&&i.colorTexture.generateMipmap(),!0},e.prototype._drawTestTexture=function(e,t,r){var n=this._rctx;if(!this._testPatternTexture){for(var i=new Uint8Array(e*t*4),a=0,o=0;o<t;o++)for(var s=0;s<e;s++){var u=Math.floor(s/10),d=Math.floor(o/10);u<2||d<2||10*u>e-20||10*d>t-20?(i[a++]=255,i[a++]=255,i[a++]=255,i[a++]=255):(i[a++]=255,i[a++]=255,i[a++]=255,i[a++]=1&u&&1&d?1&s^1&o?0:255:1&u^1&d?0:128)}this._testPatternTexture=new b(n,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},i),this._testPatternProgram=this._programRep.getProgram(m.texOnly),this._testPatternPipelineState=y.makePipelineState({blending:y.separateBlendingParams(770,1,771,771),colorWrite:y.defaultColorWriteParams}),this._quadVAO=c.createQuadVAO(n,l.Pos3Tex)}var f=this._testPatternProgram;n.bindProgram(f),n.setPipelineState(this._testPatternPipelineState),f.setUniform4f("color",r[0],r[1],r[2],1),f.setUniform1i("tex",0),n.bindTexture(this._testPatternTexture,0),n.bindVAO(this._quadVAO),n.drawArrays(5,0,x.vertexCount(this._quadVAO,"geometry"))},e.prototype.materialChanged=function(e){this.onContentChanged&&this.onContentChanged()},e.prototype.createRenderTargetInternal=function(e,t){for(var r=e,n=0;this._renderTargets[r];)r=e+"_"+ ++n;return this._renderTargets[r]=g.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0}),r},e.prototype.getGpuMemoryUsage=function(){var e=0;for(var t in this._renderTargets){var r=this._renderTargets[t];e+=x.getGpuMemoryUsage(r)}return e},e.prototype.intersect=function(e,t,r){var n=this,i=0;this._renderer.forEachRenderGeometry(function(a){if(!r||r(a)){if(a.material instanceof p||a.material instanceof v||a.material instanceof h){var o=a.transformation[12],s=a.transformation[13];P[0]=t[0]-o,P[1]=t[1]-s,P[2]=1,E[0]=t[0]-o,E[1]=t[1]-s,E[2]=0,a.pixelRatio=_,a.material.intersect(a,null,a.getShaderTransformation(),e,P,E,function(t,r,o,s,l,c){n.addIntersectionResult(t,r,o,a.material.renderPriority,i,l,c,e,a.data.layerUid,a.data.graphicUid)},a.calculateShaderTransformation,!0)}i++}})},e.prototype.addIntersectionResult=function(e,t,r,n,i,a,s,l,c,u){var d={type:"external",metadata:{layerUid:c,graphicUid:u}},f=function(e){e.set(d,null,l.results.terrain.dist,l.results.terrain.normal,l.results.terrain.transformation,n,null,null,r,i),e.intersector="DrapedRenderer"};if((null==l.results.min.drapedLayerOrder||n>=l.results.min.drapedLayerOrder)&&(null==l.results.min.dist||l.results.terrain.dist<=l.results.min.dist)&&f(l.results.min),(null==l.results.max.drapedLayerOrder||n<l.results.max.drapedLayerOrder)&&(null==l.results.max.dist||l.results.terrain.dist>l.results.max.dist)&&f(l.results.max),l.enable.storeAll){var p=new o.IntersectorResult(l.ray);f(p),l.results.all.push(p)}},e}(),w=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],C={fbo:null,camera:new s,lightDirection:n.vec3f64.fromValues(0,0,1)},P=n.vec3f64.create(),E=n.vec3f64.create();return S}.apply(null,n))||(e.exports=i)},R8fa:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Q2wQ"),r("HZ3d"),r("TMur"),r("OXG3"),r("+AWJ"),r("Gtr7"),r("KY0m"),r("pcDC"),r("ma1f"),r("eIBl"),r("9sIV"),r("qsST"),r("xoE+"),r("LxLY"),r("VCyw"),r("SyoC"),r("KBgh"),r("qMld"),r("8MXS"),r("Vx27"),r("Rdxj"),r("WRgd"),r("lRq4"),r("0RER"),r("ZcgO"),r("7Kvv"),r("dJJN"),r("3568"),r("6zaU"),r("F0v3"),r("yVFQ"),r("GNH0"),r("meB3"),r("2UbT"),r("juQt"),r("BwdQ"),r("LiJt"),r("mmEe"),r("kW7X"),r("krVM"),r("hkmr"),r("ZO6V")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w,C,P,E,T,O,A,R,M,I,D,V,L,F,B,N,U,z,j,G,H,k,W){var q=new o.Point,X=C.vec3f64.create(),Y=P.create(),Q=v.getLogger("esri.views.3d.layers.graphics.Graphics3DCore"),Z=function(e){function t(t){var r=e.call(this)||this;return r.propertiesPool=new G.PropertiesPool({computedExtent:o.Extent},r),r.computedExtent=null,r.currentRenderer=null,r.rendererHasGeometryOperations=!1,r.symbolCreationContext=new F.Graphics3DSymbolCreationContext,r.graphics=new Map,r.stageLayer=null,r.stage=null,r.graphicsDrapedUids=new Set,r.graphicsBySymbol=new Map,r.symbolConversionCache=new Map,r.symbols=new Map,r.graphicsWithoutSymbol={},r.graphicsWaitingForSymbol=new Set,r.lastFastUpdate=null,r.handles=new p,r.viewSR=null,r.elevationAlignment=null,r.scaleVisibility=null,r.filterVisibility=null,r.spatialIndex=null,r.deconfliction=null,r.labeling=null,r.highlights=null,r.viewElevationProvider=null,r.sharedSymbolResourcesOwnerHandle=null,r.whenGraphics3DGraphicRequests={},r.pendingUpdates=new Map,r.pendingAdds=0,r.pendingRemoves=0,r.pendingUpdatesPool=new x({allocator:function(e){return e||{add:null,remove:null}},deallocator:function(e){return e.add=null,e.remove=null,e}}),r.symbolWarningLogged=!1,r.geometryWarningLogged=!1,r.objectIdInvisibleSet=new Set,r._whenSymbolRemoved=new x,r.asyncUpdates=!1,r.elevationFeatureExpressionEnabled=!0,r.owner=null,r.layer=null,r.hasDraped=!1,r.graphicSymbolSupported=!0,r._usedMemory=0,r.numberOfGraphics=0,r._visible=void 0,r._startCreateGraphics=!1,r.maxPendingUpdates=0,r}var c;return r(t,e),c=t,Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsWaitingForSymbol.size>0||this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayFeatureLimit",{get:function(){var e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?e.graphics3D.minTotalNumberOfFeatures:0,r=e?e.graphics3D.maxTotalNumberOfFeatures:0,n=e?e.graphics3D.maxTotalNumberOfPrimitives:0,i=this.maxSymbolComplexity,a=Math.max(t,Math.min(r,Math.ceil(n/Math.max(1,i?i.primitivesPerFeature:1)))),o=this._get("displayFeatureLimit");return o&&o.minimumTotalNumberOfFeatures===t&&o.maximumTotalNumberOfFeatures===r&&o.maximumTotalNumberOfPrimitives===n&&o.maximumSymbolComplexity===i&&o.maximumNumberOfFeatures===a?o:{minimumTotalNumberOfFeatures:t,maximumTotalNumberOfFeatures:r,maximumTotalNumberOfPrimitives:n,maximumSymbolComplexity:i,maximumNumberOfFeatures:a}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSymbolComplexity",{get:function(){for(var e=null,t=0,r=this.getSymbolComplexities();t<r.length;t++){var n=r[t];e?0===e.primitivesPerCoordinate&&n.primitivesPerFeature>e.primitivesPerFeature?e=n:0!==e.primitivesPerCoordinate&&n.primitivesPerCoordinate>e.primitivesPerCoordinate&&(e=n):e=n}var i=this._get("maxSymbolComplexity");return!e||i&&i.primitivesPerFeature===e.primitivesPerFeature&&i.primitivesPerCoordinate===e.primitivesPerCoordinate?i:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemory",{get:function(){return this._usedMemory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0}),t.prototype.getSymbolComplexities=function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()},t.prototype.getConvertedSymbol=function(e){if("web-style"===e.type)return e.clone();var t=this.symbolConversionCache.get(e.id);if(void 0!==t)return t;var r=I.to3D(e,!0,!1,this.hasLabelingContext(e)),n=r.symbol||null;return n||r.error&&Q.error(r.error.message),this.symbolConversionCache.set(e.id,n),n},t.prototype.getSymbolComplexitiesUsedOrRenderer=function(e){var t=e.getSymbols();if(!t||!t.length)return[];for(var r=[],n=0,i=t;n<i.length;n++){var a=i[n],o=this.symbols.get(a.id);if(o)r.push(o.complexity);else{var s=this.getConvertedSymbol(a);s&&r.push(z.defaultSymbolComplexity(s))}}return r},t.prototype.getSymbolComplexitiesUsed=function(){var e=[];return this.symbols.forEach(function(t){t&&e.push(t.complexity)}),e},t.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference},t.prototype.setup=function(e){var t=this;this._set("elevationAlignment",e.elevationAlignment),this._set("scaleVisibility",e.scaleVisibility),this._set("filterVisibility",e.filterVisibility),this._set("spatialIndex",e.spatialIndex),this._set("deconfliction",e.deconfliction),this._set("labeling",e.labeling),this._set("highlights",e.highlights);var r=this.owner.view;this.viewElevationProvider=new D.ViewElevationProvider(this.viewSR,r),this.initializeStage(r,this.layer.uid),this.symbolCreationContext.sharedResources=r.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=r.sharedSymbolResources.addGraphicsOwner(this.owner),this.symbolCreationContext.renderer=this.currentRenderer,this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataSupplier=r.sharedSymbolResources.streamDataSupplier,this.symbolCreationContext.renderSpatialReference=r.renderSpatialReference,this.symbolCreationContext.renderCoordsHelper=r.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.layerOrder=0,this.symbolCreationContext.localOriginFactory=new k,this.symbolCreationContext.elevationProvider=r.elevationProvider,this.symbolCreationContext.isAsync=this.asyncUpdates;var n=V.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=V.createContext(n,this.viewSR,Q),this.symbolCreationContext.screenSizePerspectiveEnabled=r.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.handles.add(this.owner.watch("suspended",function(){return t.updateLayerVisibility()}));var i="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled";this.handles.add([this.owner.watch(i,function(){var e=r.screenSizePerspectiveEnabled&&t.layer.screenSizePerspectiveEnabled;e!==t.symbolCreationContext.screenSizePerspectiveEnabled&&(t.symbolCreationContext.screenSizePerspectiveEnabled=e,t.recreateAllGraphics())}),this.owner.watch("slicePlaneEnabled",function(e){return t.slicePlaneEnabledChange(!!e)}),this.owner.view.watch("pixelRatio",function(e){return t.pixelRatioChange(e)}),S.when(r.basemapTerrain,"tilingScheme",function(e){e.spatialReference.equals(t.symbolCreationContext.overlaySR)||(t.symbolCreationContext.overlaySR=r.basemapTerrain.spatialReference),t.handles.has("loaded-graphics")?t.recreateAllGraphics():t.handles.add(S.on(t.owner,"loadedGraphics","change",function(e){return t.graphicsCollectionChanged(e)},function(){return t.recreateAllGraphics()}),"loaded-graphics")}),r.resourceController.scheduler.registerTask(3,function(e){return t.update(e)},function(){return t.needsUpdate()})]),this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",function(){return t.deconfliction.featureReductionChange()})),this.rendererChange(this.layer.renderer),this.notifyChange("maxSymbolComplexity")},t.prototype.destroy=function(){for(var e in this.owner.view.deconflictor.removeGraphicsOwner(this),this.owner.view.labeler.removeGraphicsOwner(this),this.clear(),this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(H.ModelContentType.LAYER,this.stageLayer.id),this.stageLayer=null,this.stage=null),this.handles.destroy(),this.handles=null,this.viewSR=null,this._set("owner",null),this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[e].reject(new f("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null,this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null),this.pendingUpdatesPool=null,this.symbolConversionCache.clear(),this.objectIdInvisibleSet.clear()},t.prototype.clear=function(){this.graphics.forEach(function(e){return e.destroy()}),this.spatialIndex&&this.spatialIndex.clear(),this.graphics.clear(),this.numberOfGraphics=0,this._usedMemory=0,this.updateLayerVisibility(),this.symbols.forEach(function(e){e&&e.destroy()}),this.symbols.clear(),this.graphicsBySymbol.clear(),this.graphicsWithoutSymbol={},this.graphicsWaitingForSymbol.clear(),this.pendingUpdates.clear(),this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this.pendingAdds=0,this.pendingRemoves=0,this._set("hasDraped",!1),this.notifyChange("updating"),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.initializeStage=function(e,t){this.stage=e._stage,this.stageLayer=new W(t,{isPickable:!this.owner.suspended},t),this.stage.add(H.ModelContentType.LAYER,this.stageLayer),this.stage.addToViewContent([this.stageLayer.id])},t.prototype.setDrawingOrder=function(e){this.symbolCreationContext.layerOrder=e;var t=new Set;this.symbols.forEach(function(r){r&&r.setDrawOrder(e,t)}),t.size>0&&this.stage.getDrapedRenderer().updateRenderOrder(t)},t.prototype.updateLayerVisibility=function(){var e=!!this.owner.suspended,t=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*ee,r=!e&&!t;r!==this._visible&&(this._visible=r,r?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())},t.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,configurable:!0}),t.prototype.getGraphics3DGraphicById=function(e){return this.graphics.get(e)},t.prototype._getGraphicObjectID=function(e,t){return void 0===t&&(t=this.owner.layer&&this.owner.layer.objectIdField),null!=e.objectId?e.objectId:t&&e.attributes[t]},Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){var e=this,t=this.owner.layer&&this.owner.layer.objectIdField;if(!t)return null;var r=new Map;return this.graphics.forEach(function(n){if(n){var i=n.graphic,a=e._getGraphicObjectID(i,t);g.isSome(a)&&r.set(a,n)}}),r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelsEnabled",{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0}),t.prototype.updateLabelingInfo=function(e){var t=this.deconfliction&&this.deconfliction.labelingInfoChange(e),r=this.labeling&&this.labeling.labelingInfoChange(e);return _.all([t,r]).then()},t.prototype.updateVisibilityInfo=function(){this.deconfliction&&this.deconfliction.labelingInfoChange(),this.labeling&&this.labeling.visibilityInfoChange()},Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){var e=this;if(this.pendingUpdates.size>0)return"unknown";var t=0,r=0;return h.everyMap(this.symbols,function(n,i){if(n){var a=n.getFastUpdateStatus();if(a.loading>0)return!1;e.graphicsBySymbol.has(i)&&(r+=a.fast,t+=a.slow)}})?r>=0&&0===t?"fast":t>=0&&0===r?"slow":"mixed":"unknown"},enumerable:!0,configurable:!0}),t.prototype.needsUpdate=function(){return this.pendingUpdates.size>0||!!this.lastFastUpdate&&y()-this.lastFastUpdate>500},t.prototype.update=function(e){var t=this.needsUpdate();this._applyPendingUpdates(e),!e.done&&this.lastFastUpdate&&(this.lastFastUpdate=null),t!==this.needsUpdate()&&this.notifyChange("updating")},t.prototype.setObjectIdVisibility=function(e,t){t?this.objectIdInvisibleSet.delete(e):this.objectIdInvisibleSet.add(e);var r=this._findGraphics3DGraphicByObjectId(e);g.isSome(r)&&this._updateUserVisibility(r)},t.prototype._findGraphics3DGraphicByObjectId=function(e){var t,r=this;return h.everyMap(this.graphics,function(n){return r._getGraphicObjectID(n.graphic)!==e||(t=n,!1)}),t},t.prototype._updateUserVisibility=function(e){if(g.isNone(e))return!1;var t=e.graphic,r=this._getGraphicObjectID(t),n=t.visible&&!this.owner.suspended&&(g.isNone(r)||!this.objectIdInvisibleSet.has(r));return e.setVisibilityFlag(0,n,0)},t.prototype.whenGraphics3DGraphic=function(e){var t=this.graphics.get(e.uid);if(t)return _.resolve(t);var r=this.whenGraphics3DGraphicRequests[e.uid];if(r)return r.promise;var n=_.createDeferred();return this.whenGraphics3DGraphicRequests[e.uid]=n,n.promise},t.prototype.boundsForGraphics3DGraphic=function(e,t){return a(this,void 0,void 0,function(){var r,n,a,o,s,l,c,u,d,f;return i(this,function(i){switch(i.label){case 0:return r=this.owner.view.spatialReference,n=this.owner.view.renderSpatialReference,a=this.owner.view.basemapTerrain.spatialReference,o=function(e,t,i){return j.bufferToBuffer(e,n,t,e,r,t,i)},s=function(e,t,n){return j.bufferToBuffer(e,a,t,e,r,t,n)},l=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:t&&t.useViewElevation,minDemResolution:t&&t.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,e.getProjectedBoundingBox(o,s,l)];case 1:return(c=i.sent())?(u=c.boundingBox,c.requiresDrapedElevation&&(d=this.symbolCreationContext.elevationProvider)&&(P.center(u,X),q.x=X[0],q.y=X[1],q.z=void 0,q.spatialReference=r,f=d.getElevation(q)||0,u[2]=Math.min(u[2],f),u[5]=Math.max(u[5],f)),[2,{boundingBox:u,screenSpaceObjects:c.screenSpaceObjects}]):[2,null]}})})},t.prototype.whenGraphicBounds=function(e,t){var r=this;return S.whenOnce(this.owner,"loadedGraphics").then(function(){var t=r.owner.layer&&r.owner.layer.objectIdField,n=r.owner.loadedGraphics.find(function(r){return r===e||t&&r.attributes&&e.attributes&&r.attributes[t]===e.attributes[t]});if(n)return r.whenGraphics3DGraphic(n);throw new f("internal:graphic-not-part-of-view","Graphic is not part of this view")}).then(function(e){return r.boundsForGraphics3DGraphic(e,t)})},t.prototype.whenSymbolLayerSize=function(e,t){return a(this,void 0,void 0,function(){var r,n,a;return i(this,function(i){if(null==(r=this.symbols.get(e.id)))throw new f("internal:symbol-not-part-of-view","Symbol is not part of this view");if(-1===(n=e.symbolLayers.indexOf(t)))throw new f("internal:missing-symbol-layer","Symbol layer is not in symbol");return a=_.createResolver(),r.getSymbolLayerSize(n,function(e){null==e?a.reject(new f("internal:missing-size","Symbol layer has no valid size")):a(e)}),[2,a.promise]})})},t.prototype.graphicsCollectionChanged=function(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))},t.prototype.graphicUpdateHandler=function(e){var t=e.graphic.uid,r=this.graphics.get(t),n=this.graphicsWithoutSymbol[t];if(r||n)switch(e.property){case"visible":this.graphicUpdateVisibleHandler(r,e);break;case"geometry":this.graphicUpdateGeometryHandler(r,e);break;case"symbol":this.graphicUpdateSymbolHandler(r,e);break;case"attributes":break;default:d.neverReached(e)}},t.prototype.graphicUpdateGeometryHandler=function(e,t){var r=t.graphic.geometry;if(r)if(g.isNone(e)){var n=t.graphic.symbol&&t.graphic.symbol.id;if(n){var i=this.symbols.get(n);if(i&&!i.isFulfilled())return}this.recreateGraphic(t.graphic)}else e.graphics3DSymbol.updateGeometry(e,t.newValue)||this.recreateGraphic(e.graphic),this.expandComputedExtent(r);else this.recreateGraphic(t.graphic)},t.prototype.graphicUpdateSymbolHandler=function(e,t){var r=t.graphic,n=g.isSome(e)?e.graphics3DSymbol:t.oldValue&&this.symbols.get(t.oldValue.id);if(n){var i=n.symbol,a=this.getConvertedSymbol(t.newValue);if(a.type===i.type&&"web-style"!==a.type&&"web-style"!==i.type){var o=this.graphicsBySymbol.get(i.id);if(o&&1!==o.size)this.recreateGraphic(r);else{var s=A.diff(i,a);if(g.isNone(s))this.updateSymbolMapping(i.id,a);else{var l={diff:s,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(n.prepareSymbolPatch(l),A.isEmpty(l.diff)){for(var c=0,u=l.symbolStatePatches;c<u.length;c++){(0,u[c])()}var d=this._getRenderingInfo(r);if(g.isSome(e))for(var f=0,p=l.graphics3DGraphicPatches;f<p.length;f++){(0,p[f])(e,d)}this.updateSymbolMapping(i.id,a)}else this.recreateGraphic(r)}}}else this.recreateGraphic(r)}else this.recreateGraphic(r)},t.prototype.graphicUpdateVisibleHandler=function(e,t){var r=this._updateUserVisibility(e);r&&this.labeling&&(this.lastFastUpdate=y(),this.owner.view.labeler.setDirty()),r&&this.owner.view.deconflictor.setDirty()},t.prototype.recreateGraphic=function(e){var t=[e];this.remove(t),this.add(t)},t.prototype._beginGraphicUpdate=function(e){this.graphicsWaitingForSymbol.add(e.uid),1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"),this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)},t.prototype._endGraphicUpdate=function(e){e&&(this.graphicsWaitingForSymbol.delete(e.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))},t.prototype.expandComputedExtent=function(e){var t=Y,r=e.spatialReference;O.computeAABB(e,t);var n=this.viewSR,i=c.tmpVec;if(r.equals(n)||j.xyzToVector(t[0],t[1],0,r,i,n)&&(t[0]=i[0],t[1]=i[1],j.xyzToVector(t[3],t[4],0,r,i,n),t[3]=i[0],t[4]=i[1]),m.isFinite(t[0])&&m.isFinite(t[3])&&m.isFinite(t[1])&&m.isFinite(t[4])){var a=this.computedExtent,o=null,s=m.isFinite(t[2])&&m.isFinite(t[5]),l=s&&(!a||null==a.zmin||t[2]<a.zmin),u=s&&(!a||null==a.zmax||t[5]>a.zmax);a?(t[0]<a.xmin||t[1]<a.ymin||t[3]>a.xmax||t[4]>a.ymax||l||u)&&((o=this.propertiesPool.get("computedExtent")).xmin=Math.min(t[0],a.xmin),o.ymin=Math.min(t[1],a.ymin),o.xmax=Math.max(t[3],a.xmax),o.ymax=Math.max(t[4],a.ymax),o.spatialReference=n):((o=this.propertiesPool.get("computedExtent")).xmin=t[0],o.ymin=t[1],o.xmax=t[3],o.ymax=t[4],o.spatialReference=n),o&&(l&&(o.zmin=t[2]),u&&(o.zmax=t[5]),this._set("computedExtent",o))}},t.prototype.updateHasDraped=function(){var e=this.graphicsDrapedUids.size>0;this._set("hasDraped",e)},t.prototype.elevationInfoChange=function(){var e=this,t=V.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=V.createContext(t,this.viewSR,Q),this.labeling&&this.labeling.elevationInfoChange(),this.forEachGraphics3DSymbol(function(t,r,n){t.globalPropertyChanged("elevationInfo",r)?r.forEach(function(e){for(var t=e.graphic,r=e._labelGraphics,n=0;n<r.length;n++){var i=r[n];i.graphics3DSymbolLayer.updateGraphicElevationContext(t,i)}}):e._recreateSymbol(n)}),this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()},t.prototype.clearSymbolsAndGraphics=function(){this.clear(),this.filterVisibility&&this.filterVisibility.clear(),this.labeling&&this.labeling.reset(),this.deconfliction&&this.deconfliction.clear(),this.elevationAlignment&&this.elevationAlignment.clear(),this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()},t.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0,this.recreateAllGraphics()},t.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))},t.prototype._recreateSymbol=function(e){var t=this,r=this.graphicsBySymbol.get(e),n=[];r.forEach(function(e,r){var i=e.usedMemory;t._conditionalRemove(e,r),t.spatialIndex&&t.spatialIndex.remove(e),n.push(e.graphic),e.destroy(),t.removeGraphics3DGraphic(r,i),t.updateLayerVisibility()}),this.graphicsBySymbol.set(e,new Map);var i=this.symbols.get(e);i&&i.destroy(),this.symbols.delete(e),this.updateHasDraped(),this.add(n)},t.prototype._conditionalRemove=function(e,t){e.isDraped()&&this.graphicsDrapedUids.delete(t),this.highlights&&this.highlights.removeGraphic(e),this.labeling&&this.labeling.removeGraphic(e),this.deconfliction&&this.deconfliction.removeGraphic(e)},t.prototype.add=function(e){if(e&&0!==e.length){if(!this.owner.view.basemapTerrain||!this.owner.view.basemapTerrain.tilingScheme)return void Q.error("#add()","Cannot add graphics before terrain surface has been initialized");this.asyncUpdates?this._addDelayed(e):this._addImmediate(e),this.notifyChange("updating")}},t.prototype._addImmediate=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1,J.clear();for(var r=0,n=e;r<n.length;r++){var i=n[r];this._startAddGraphic(i,J)}J.forEach(function(e){return t._finishAddGraphics(e)}),J.clear(),this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty(),this._cleanupSymbols()},t.prototype._addDelayed=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t],i=n.uid,a=this.pendingUpdates.get(i);if(a)a.add||this.pendingAdds++,a.add=n;else{var o=this.pendingUpdatesPool.pushNew();o.add=n,this.pendingAdds++,this.pendingUpdates.set(i,o)}}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.remove=function(e){this.asyncUpdates?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("updating")},t.prototype._removeImmediate=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this._removeGraphic(n)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype._removeDelayed=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t],i=n.uid,a=this.pendingUpdates.get(i);if(a)a.add&&(a.remove?a.add=null:this.pendingUpdates.delete(i),this.pendingAdds--);else{var o=this.pendingUpdatesPool.pushNew();o.remove=n,this.pendingUpdates.set(i,o),this.pendingRemoves++}}0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this._cleanupSymbols(),(this.pendingAdds||this.pendingRemoves)&&Q.warn("pendingAdds/Removes in inconsistent state!"),this.pendingAdds=0,this.pendingRemoves=0},t.prototype._applyPendingUpdates=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1;var r=e.idleFrame?1e3:100,n=0;J.clear(),h.everyMap(this.pendingUpdates,function(i,a){if(i.remove&&(t.pendingRemoves--,t._removeGraphic(i.remove)),i.add&&(t.pendingAdds--,t._startAddGraphic(i.add,J)&&n++),t.pendingUpdates.delete(a),n>r&&(J.forEach(function(e){return t._finishAddGraphics(e)}),J.clear(),n=0),e.madeProgress(),e.done)return!1}),J.forEach(function(e){return t._finishAddGraphics(e)}),J.clear(),0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining"),this.updateHasDraped()},t.prototype._startAddGraphic=function(e,t){this.graphicsWithoutSymbol[e.uid]=e;var r=this._getRenderingInfo(e,Q);if(!r)return!1;var n=r.symbol,i=this.getOrCreateGraphics3DSymbol(n,r.renderer);if(!i)return!1;this.expandComputedExtent(e.geometry),this._beginGraphicUpdate(e);var a={graphic:e,renderingInfo:r,layer:this.layer},o=i.symbol.id,s=t.get(o);if(s)s.graphics.push(a);else{var l=$.acquire();l.clear(),l.push(a),t.set(o,{asyncSymbol:i,graphics:l})}return!0},t.prototype._finishAddGraphics=function(e){var t=this,r=!1,n=function(t){t===e.asyncSymbol.symbol.id&&(r=!0)};this._whenSymbolRemoved.push(n),e.asyncSymbol.then(function(){t._whenSymbolRemoved.removeUnordered(n),K.clear();for(var i=0;i<e.graphics.length;i++){var a=e.graphics.data[i],o=a.graphic;if(!(r||e.asyncSymbol.destroyed||t.graphicSymbolSupported&&o.symbol&&o.symbol.id!==e.asyncSymbol.symbol.id)){if(t.graphicsWaitingForSymbol.has(o.uid)){var s=t.createGraphics3DGraphic(e.asyncSymbol,a);t.spatialIndex&&s&&K.push(s)}t._endGraphicUpdate(o)}--e.asyncSymbol.referenced}K.length>0&&(t.spatialIndex.addMany(K.data,K.length),K.clear()),e.graphics.clear(),$.release(e.graphics),t.labeling&&(t.lastFastUpdate=y(),t.owner.view.labeler.setDirty())},function(){if(t._whenSymbolRemoved.removeUnordered(n),!r&&!e.asyncSymbol.destroyed)for(var i=0;i<e.graphics.length;i++)t._endGraphicUpdate(e.graphics.data[i].graphic);e.graphics.clear(),$.release(e.graphics)})},t.prototype._removeGraphic=function(e){var t=e.uid,r=this.graphics.get(t);if(r){var n=r.usedMemory;this._conditionalRemove(r,t),this.spatialIndex&&this.spatialIndex.remove(r);var i=r.graphics3DSymbol.symbol.id;this.graphicsBySymbol.get(i).delete(t),delete this.graphicsWithoutSymbol[t],this.removeGraphics3DGraphic(t,n),r.destroy()}else delete this.graphicsWithoutSymbol[t],this.graphicsWaitingForSymbol.delete(t)},t.prototype.hasLabelingContext=function(e){if(e instanceof l.LabelSymbol3D||e instanceof l.TextSymbol){var t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some(function(t){return t.symbol===e})}return!1},t.prototype.hasValidSymbolCreationContext=function(e){return!(e instanceof l.LabelSymbol3D&&!this.hasLabelingContext(e)&&(Q.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),1))},t.prototype._getRenderingInfo=function(e,t){if(!e.geometry)return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&e.symbol)return t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;var r=this.rendererHasGeometryOperations?O.hydrateGraphic(e,this.layer):e,n=this.owner.getRenderingInfo(r,this.currentRenderer);return n&&n.symbol?n:(t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null)},t.prototype.createGraphics3DSymbol=function(e,t){var r=this;if(!this.hasValidSymbolCreationContext(e))return null;var n,i=this.getConvertedSymbol(e);if(!i)return null;if(t&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){var a=I.to3D(t.backgroundFillSymbol,!1,!0);a.symbol&&"web-style"!==a.symbol.type&&(n=a.symbol.symbolLayers)}var o=B.make(i,this.symbolCreationContext,n);return o.then(function(){return r.notifyChange("maxSymbolComplexity")}),o},t.prototype.getOrCreateGraphics3DSymbol=function(e,t){var r=this,n=this.symbols.get(e.id);return void 0===n&&(n=e instanceof l.WebStyleSymbol?new N(e,function(e){return r.createGraphics3DSymbol(e,t)}):this.createGraphics3DSymbol(e,t),this.symbols.set(e.id,n)),n&&++n.referenced,n},t.prototype.addGraphics3DGraphic=function(e){this._usedMemory+=e.usedMemory,this.graphics.set(e.graphic.uid,e),this.numberOfGraphics++,this.updateLayerVisibility()},t.prototype.removeGraphics3DGraphic=function(e,t){this._usedMemory-=t,this.graphics.delete(e),this.numberOfGraphics--,this.updateLayerVisibility()},t.prototype.createGraphics3DGraphic=function(e,t){var r=t.graphic;if(delete this.graphicsWithoutSymbol[r.uid],this.symbols.has(e.symbol.id)){if(!this.graphics.has(r.uid)){var n=e.createGraphics3DGraphic(t),i=e.symbol.id;this.addGraphics3DGraphic(n),this.graphicsBySymbol.has(i)||this.graphicsBySymbol.set(i,new Map),this.graphicsBySymbol.get(i).set(r.uid,n),n.initialize(this.stageLayer,this.stage),n.isDraped()&&(this.graphicsDrapedUids.add(r.uid),this._set("hasDraped",!0)),n.centroid=null,"point"!==r.geometry.type&&n instanceof L&&(n.centroid=U.computeCentroid(r.geometry,this.viewSR)),this._updateUserVisibility(n),this.deconfliction&&this.deconfliction.addGraphic(n),this.labeling&&this.labeling.addGraphic(n),this.scaleVisibility&&this.scaleVisibility.updateVisibility(n),this.filterVisibility&&this.filterVisibility.updateVisibility(n),this.highlights&&this.highlights.addGraphic(n),this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,n);var a=this.whenGraphics3DGraphicRequests[r.uid];return a&&(delete this.whenGraphics3DGraphicRequests[r.uid],a.resolve(n)),n}}else this.add([r])},t.prototype.rendererChange=function(e){var t=this;e!==this.currentRenderer&&(this.validateRenderer(e),M.hasGeometryOperations(e)?M.enableGeometryOperations().then(function(){t.layer.renderer===e&&t.currentRendererChange(e,!0)}):this.currentRendererChange(e,!1))},t.prototype.currentRendererChange=function(e,t){this.currentRenderer=e,this.rendererHasGeometryOperations=t;var r=this.symbolCreationContext.renderer;if(e!==r){this.symbolConversionCache.clear();var n=A.diff(r,e);this.updateUnchangedSymbolMappings(n,e,r),this.symbolCreationContext.renderer=e,g.isNone(n)||("complete"===n.type?this.recreateAllGraphics():"partial"===n.type&&(this.applyRendererDiff(n,e,r)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}},t.prototype.diffHasSymbolChange=function(e){for(var t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1},t.prototype.applySymbolSetDiff=function(e,t,r,n){var i=this;e=e||[];for(var a=[],o=this,s=0,l=t=t||[];s<l.length;s++){!function(t){var n=o.graphicsBySymbol.get(t.id);n&&n.forEach(function(o,s){var l=o.graphic,c=i.layer instanceof T?i.layer:null;if(t!==r.defaultSymbol||r.getSymbol(O.hydrateGraphic(l,c))!==r.defaultSymbol){var u=o.usedMemory;e.length||r.defaultSymbol?a.push(l):i.graphicsWithoutSymbol[s]=l;var d=i.graphics.get(s);i._conditionalRemove(d,s),o.destroy(),n.delete(s),i.removeGraphics3DGraphic(s,u),i.updateLayerVisibility()}}),o._whenSymbolRemoved.forEach(function(e){return e(t.id)})}(l[s])}if(e.length||a.length){for(var c in this.graphicsWithoutSymbol)a.push(this.graphicsWithoutSymbol[c]);this.graphicsWithoutSymbol={},this.add(a)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype.applyUniqueValueRendererDiff=function(e,t,r){var n=e.diff.defaultSymbol,i=e.diff.uniqueValueInfos;if(n||i){var a=i?i.added.map(function(e){return e.symbol}):[],o=i?i.removed.map(function(e){return e.symbol}):[];if(i)for(var s=0;s<i.changed.length;s++)a.push(i.changed[s].newValue.symbol),o.push(i.changed[s].oldValue.symbol);return n?(r.defaultSymbol&&o.push(r.defaultSymbol),t.defaultSymbol&&a.push(t.defaultSymbol)):r.defaultSymbol&&a.length&&o.push(t.defaultSymbol),this.applySymbolSetDiff(a,o,t,r),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1},t.prototype.calculateUnchangedSymbolMapping=function(e,t,r){if(t instanceof s.UniqueValueRenderer&&r instanceof s.UniqueValueRenderer&&(g.isNone(e)||"partial"===e.type)){var n=e&&e.diff,i=n&&n.defaultSymbol,a=n&&n.uniqueValueInfos,o=void 0;return o=a?a.unchanged.map(function(e){return{oldId:e.oldValue.symbol.id,newId:e.newValue.symbol.id}}):r.uniqueValueInfos.map(function(e,r){return{oldId:e.symbol.id,newId:t.uniqueValueInfos[r].symbol.id}}),!i&&r.defaultSymbol&&o.push({oldId:r.defaultSymbol.id,newId:t.defaultSymbol.id}),o}return[]},t.prototype.updateSymbolMapping=function(e,t){var r="string"==typeof t?t:t.id,n="string"==typeof t?null:t;if(e&&e!==r){var i=this.graphicsBySymbol.get(e);this.graphicsBySymbol.delete(e),void 0!==i&&this.graphicsBySymbol.set(r,i);var a=this.symbols.get(e);this.symbols.delete(e),void 0!==a&&(this.symbols.set(r,a),n?a.symbol=n:a.symbol.id=r)}},t.prototype.updateUnchangedSymbolMappings=function(e,t,r){for(var n=0,i=this.calculateUnchangedSymbolMapping(e,t,r);n<i.length;n++){var a=i[n],o=a.oldId,s=a.newId;this.updateSymbolMapping(o,s)}},t.prototype.applyRendererDiff=function(e,t,r){var n=this;return!this.diffHasSymbolChange(e)&&(!!(t instanceof s.UniqueValueRenderer&&r instanceof s.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(e,t,r)&&0===Object.keys(e.diff).length)||h.everyMap(this.graphicsBySymbol,function(r,i){var a=n.symbols.get(i);if(a&&!a.applyRendererDiff(e,t))return!1}))},t.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(e){return e.globalPropertyChanged("opacity")}),this.updateStageLayerVisibility()},t.prototype.slicePlaneEnabledChange=function(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.isSliceable=e,this.forEachGraphics3DSymbol(function(e,t){return e.globalPropertyChanged("slicePlaneEnabled",t)}),this.deconfliction&&this.deconfliction.slicePlaneEnabledChange(),this.labeling&&this.labeling.slicePlaneEnabledChange())},t.prototype.pixelRatioChange=function(e){var t=this;this.forEachGraphics3DSymbol(function(e,r,n){e.globalPropertyChanged("pixelRatio",r)||t._recreateSymbol(n)})},t.prototype.setClippingExtent=function(e,t){var r=this.symbolCreationContext.clippingExtent,n=E.create();return j.extentToBoundingRect(e,n,t)?this.symbolCreationContext.clippingExtent=[n[0],n[1],-1/0,n[2],n[3],1/0]:this.symbolCreationContext.clippingExtent=null,!u.equals(this.symbolCreationContext.clippingExtent,r)},t.prototype.notifyVisibilityChanged=function(){this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty()},t.prototype.forEachGraphics3DGraphic=function(e){var t=this;if(this.owner.loadedGraphics){var r=!1;this.owner.loadedGraphics.forEach(function(n){var i=t.getGraphics3DGraphicById(n.uid);i&&e(i,n)&&(r=!0)}),r&&this.notifyVisibilityChanged()}},t.prototype.forEachGraphics3DSymbol=function(e){var t=this;this.graphicsBySymbol.forEach(function(r,n){var i=t.symbols.get(n);i&&e(i,r,n)})},t.prototype.updateAllGraphicsVisibility=function(){var e=this;this.filterVisibility&&(this.filterVisibility.dirty=!0),this.forEachGraphics3DGraphic(function(t){var r=e._updateUserVisibility(t),n=e.scaleVisibility&&e.scaleVisibility.updateVisibility(t);return r||n})},t.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(e){return e.setVisibilityFlag(0,!1,0)})},t.prototype.validateRenderer=function(e){var t=R.validateTo3D(e);if(t){var r="Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView";Q.warn(r,t.message)}},t.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=y(),this.labeling.reset()),this.stageLayer.invalidateSpatialQueryAccelerator(),this.stageLayer.shaderTransformationChanged(),this.notifyChange("updating")},t.prototype._cleanupSymbols=function(){var e=this;if(!(this.graphicsWaitingForSymbol.size>0)){var t=!1;this.symbols.forEach(function(r,n){if(r&&!(r.referenced>0)){var i=e.graphicsBySymbol.get(n);i&&0!==i.size||(e.graphicsBySymbol.delete(n),e.symbols.delete(n),r&&r.destroy(),t=!0)}}),t&&this.notifyChange("maxSymbolComplexity")}},t.prototype.snapshotInternals=function(){var e=this;return{graphics:u.keysOfMap(this.graphics).sort(),symbols:u.keysOfMap(this.symbols).sort(),graphicsBySymbol:u.keysOfMap(this.graphicsBySymbol).sort().map(function(t){return{symbolId:t,graphics:u.keysOfMap(e.graphicsBySymbol.get(t)).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:u.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}},Object.defineProperty(t.prototype,"test",{get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility}},enumerable:!0,configurable:!0}),t.prototype.getStats=function(){return{coreVisible:this.graphics.size,coreMissing:Object.keys(this.graphicsWithoutSymbol).length,corePending:this.pendingUpdates.size}},t.tmpVec=C.vec3f64.create(),n([w.property({readOnly:!0})],t.prototype,"computedExtent",void 0),n([w.property()],t.prototype,"currentRenderer",void 0),n([w.property()],t.prototype,"rendererHasGeometryOperations",void 0),n([w.property({readOnly:!0})],t.prototype,"elevationAlignment",void 0),n([w.property({readOnly:!0})],t.prototype,"scaleVisibility",void 0),n([w.property({readOnly:!0})],t.prototype,"filterVisibility",void 0),n([w.property({readOnly:!0})],t.prototype,"spatialIndex",void 0),n([w.property({readOnly:!0})],t.prototype,"deconfliction",void 0),n([w.property({readOnly:!0})],t.prototype,"labeling",void 0),n([w.property({readOnly:!0})],t.prototype,"highlights",void 0),n([w.property()],t.prototype,"asyncUpdates",void 0),n([w.property({constructOnly:!0})],t.prototype,"elevationFeatureExpressionEnabled",void 0),n([w.property({constructOnly:!0})],t.prototype,"owner",void 0),n([w.property({constructOnly:!0})],t.prototype,"layer",void 0),n([w.property({readOnly:!0})],t.prototype,"hasDraped",void 0),n([w.property({readOnly:!0})],t.prototype,"symbolsUpdating",void 0),n([w.property({constructOnly:!0})],t.prototype,"graphicSymbolSupported",void 0),n([w.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating","filterVisibility.updating"]})],t.prototype,"updating",null),n([w.property({readOnly:!0})],t.prototype,"updatingRemaining",null),n([w.property({readOnly:!0})],t.prototype,"updatingTotal",null),n([w.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],t.prototype,"displayFeatureLimit",null),n([w.property({readOnly:!0})],t.prototype,"maxSymbolComplexity",null),c=n([w.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],t)}(w.declared(c)),J=new Map,K=new x,$=new b(x),ee=10;return Z}.apply(null,n))||(e.exports=i)},RC9r:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("qsST"),r("jBNx"),r("W9tT"),r("0LE5"),r("Rdxj"),r("aWgr"),r("2B1V"),r("rjU6"),r("tUyH"),r("FNtW"),r("CIy2"),r("s6rJ"),r("uNX8"),r("ZeO9"),r("UtTF"),r("qbr3")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y){var b=n.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),x=function(e){function t(t,r){var n=e.call(this,r)||this;return n.params=h.copyParameters(t,w),"miter"!==n.params.join&&(n.params.miterLimit=0),n.numVertsAtJoin="wall"===n.params.type?2:4,n.numVertsAtCap=2,n.canBeMerged="screen"===n.params.type&&null==n.params.stippleLength,n}return r(t,e),t.prototype.getColor=function(){return this.params.color},t.prototype.dispose=function(){},t.prototype.setParameterValues=function(e){for(var t in e)p.assert("type"!==t,"RibbonLineMaterial: type cannot be changed after creation"),p.assert("stippleLength"!==t||null!=e[t]==(null!=this.params[t]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[t]=e[t];"miter"!==this.params.join&&(this.params.miterLimit=0),this.notifyDirty("matChanged")},t.prototype.getParameters=function(){return this.params},t.prototype.intersect=function(e,t,r,n,i,a,o,s,l){l?h.intersectDrapedRenderLineGeometry(e,t,r,n,i,a,this.params.width,o):this.intersectLineGeometry(e,t,r,n,i,a,o)},t.prototype.intersectLineGeometry=function(e,t,r,n,i,s,c,d){if(n.enable.selectionMode&&!u.isAllHidden(t.componentVisibilities,e.componentOffsets)){if(!p.isTranslationMatrix(r))return void b.error("intersection assumes a translation-only matrix");var f=e.data,h=f.getVertexAttr()[p.VertexAttrConstants.POSITION].data,v=f.getVertexAttr()[p.VertexAttrConstants.SIZE],m=v&&v.data[0],g=n.camera,y=L;a.vec2.copy(y,n.point);var x=(m+this.params.width*g.pixelRatio)/2+4*g.pixelRatio;o.vec3.set(G[0],y[0]-x,y[1]+x,0),o.vec3.set(G[1],y[0]+x,y[1]+x,0),o.vec3.set(G[2],y[0]+x,y[1]-x,0),o.vec3.set(G[3],y[0]-x,y[1]-x,0);for(var _=0;_<4;_++)g.unprojectPoint(G[_],H[_]);l.plane.fromPoints(g.eye,H[0],H[1],k),l.plane.fromPoints(g.eye,H[1],H[2],W),l.plane.fromPoints(g.eye,H[2],H[3],q),l.plane.fromPoints(g.eye,H[3],H[0],X);var S=Number.MAX_VALUE;for(_=0;_<h.length-5;_+=3)if(M[0]=h[_]+r[12],M[1]=h[_+1]+r[13],M[2]=h[_+2]+r[14],I[0]=h[_+3]+r[12],I[1]=h[_+4]+r[13],I[2]=h[_+5]+r[14],!(l.plane.signedDistance(k,M)<0&&l.plane.signedDistance(k,I)<0||l.plane.signedDistance(W,M)<0&&l.plane.signedDistance(W,I)<0||l.plane.signedDistance(q,M)<0&&l.plane.signedDistance(q,I)<0||l.plane.signedDistance(X,M)<0&&l.plane.signedDistance(X,I)<0)){if(g.projectPoint(M,F),g.projectPoint(I,B),F[2]<0&&B[2]>0){o.vec3.subtract(D,M,I);var w=g.frustum,C=-l.plane.signedDistance(w.planes[4],M)/o.vec3.dot(D,w.planes[4]);o.vec3.scale(D,D,C),o.vec3.add(M,M,D),g.projectPoint(M,F)}else if(F[2]>0&&B[2]<0){o.vec3.subtract(D,I,M);w=g.frustum,C=-l.plane.signedDistance(w.planes[4],I)/o.vec3.dot(D,w.planes[4]);o.vec3.scale(D,D,C),o.vec3.add(I,I,D),g.projectPoint(I,B)}else if(F[2]<0&&B[2]<0)continue;F[2]=0,B[2]=0;var P=l.lineSegment.distance2(l.lineSegment.fromPoints(F,B,z),y);P<S&&(S=P,o.vec3.copy(N,M),o.vec3.copy(U,I))}var E=n.rayBeginPoint,T=n.rayEndPoint;if(S<x*x){var O=Number.MAX_VALUE;if(l.lineSegment.closestLineSegmentPoint(l.lineSegment.fromPoints(N,U,z),l.lineSegment.fromPoints(E,T,j),V)){o.vec3.subtract(V,V,E);var A=o.vec3.length(V);o.vec3.scale(V,V,1/A),O=A/o.vec3.distance(E,T)}c(O,V)}}},t.prototype.createBufferWriter=function(){return"wall"===this.params.type?new T:new P(this.canBeMerged)},t.prototype.createRenderer=function(e,t){return this.canBeMerged?new m(e,t,this):new v(e,t,this)},t.prototype.getGLMaterials=function(){return{color:_,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:S}},t.prototype.getAllTextureIds=function(){return[]},t}(f),_=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.updateParameters(),n}return r(t,e),t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.selectProgram()},t.prototype.beginSlot=function(e){return e===(this.params.writeDepth?6:9)},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(g.colorPass,{screenScale:"screen"===e.type,wall:"wall"===e.type,stipple:null!=e.stippleLength,slice:e.slicePlaneEnabled}),this.pipelineState=y.makePipelineState({blending:y.separateBlendingParams(770,1,771,771),polygonOffset:e.polygonOffset&&O,depthTest:{func:513},depthWrite:e.color[3]>=1&&e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.bind=function(e,t){var r=this.program,n=this.params;if(e.bindProgram(r),e.setPipelineState(this.pipelineState),r.setUniform4fv("eColor",n.color),r.setUniform1f("miterLimit",n.miterLimit),r.setUniform1f("nearPlane",t.nearFar[0]),r.setUniform1f("pixelRatio",t.pixelRatio),r.setUniform1f("extLineWidth",n.width),"screen"===n.type&&r.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),null!=n.stippleLength){var i=n.stippleLength?1/(2*n.stippleLength):0;r.setUniform1f("stippleLengthDoubleInv",i)}},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params;h.bindView(t.origin,t.view,r),n.slicePlaneEnabled&&h.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 5},t}(d),S=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.updateParameters(),n}return r(t,e),t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.selectProgram()},t.prototype.beginSlot=function(e){return 4===e},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(g.highlightPass,{screenScale:"screen"===e.type,wall:"wall"===e.type,stipple:null!=e.stippleLength,slice:e.slicePlaneEnabled}),this.pipelineState=y.makePipelineState({polygonOffset:e.polygonOffset&&O,depthTest:{func:513},depthWrite:e.color[3]>=1&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.bind=function(e,t){var r=this.program,n=this.params;if(e.bindProgram(r),e.setPipelineState(this.pipelineState),h.bindHighlightRendering(e,t,r),r.setUniform4fv("eColor",n.color),r.setUniform1f("miterLimit",n.miterLimit),r.setUniform1f("nearPlane",t.nearFar[0]),r.setUniform1f("pixelRatio",t.pixelRatio),r.setUniform1f("extLineWidth",n.width),"screen"===n.type&&r.setUniform2fv("screenSize",[t.viewport[2],t.viewport[3]]),null!=n.stippleLength){var i=n.stippleLength?1/(2*n.stippleLength):0;r.setUniform1f("stippleLengthDoubleInv",i)}},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params;h.bindView(t.origin,t.view,r),n.slicePlaneEnabled&&h.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 5},t}(d),w={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,writeDepth:!0,polygonOffset:!1,stippleLength:null,slicePlaneEnabled:!1},C=c.newLayout().vec3f(p.VertexAttrConstants.POSITION).vec2f(p.VertexAttrConstants.UV0).vec3f(p.VertexAttrConstants.AUXPOS1).vec3f(p.VertexAttrConstants.AUXPOS2).vec4f(p.VertexAttrConstants.COLOR).f32(p.VertexAttrConstants.SIZE),P=function(){function e(e){this.canBeMerged=e,this.vertexBufferLayout=C,this.numVertsAtJoin=4,this.numVertsAtCap=2}return e.prototype.allocate=function(e){return C.createBuffer(e)},e.prototype.elementCount=function(e){var t=(e.indices[p.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;return this.canBeMerged&&(t+=2),t},e.prototype.write=function(e,t,r,n,i){var a=t.vertexAttr[p.VertexAttrConstants.POSITION].data,o=t.indices&&t.indices[p.VertexAttrConstants.POSITION];o&&(o.length,a.length);var s=t.vertexAttr[p.VertexAttrConstants.COLOR]?t.vertexAttr[p.VertexAttrConstants.COLOR].data:A,l=t.vertexAttr[p.VertexAttrConstants.SIZE]?t.vertexAttr[p.VertexAttrConstants.SIZE].data:R,c=a.length/3,u=e.transformation,d=n.position.typedBuffer,f=0,h=this.vertexBufferLayout.stride/4,v=i*h,m=v;this.canBeMerged&&(v+=h);var g=a[0],y=a[1],b=a[2];if(u){var x=g,_=y,S=b;g=u[0]*x+u[4]*_+u[8]*S+u[12],y=u[1]*x+u[5]*_+u[9]*S+u[13],b=u[2]*x+u[6]*_+u[10]*S+u[14]}var w=a[3],C=a[4],P=a[5];if(u){x=w,_=C,S=P;w=u[0]*x+u[4]*_+u[8]*S+u[12],C=u[1]*x+u[5]*_+u[9]*S+u[13],P=u[2]*x+u[6]*_+u[10]*S+u[14]}for(var E=g,T=y,O=b,M=0;M<c;M++){var I=3*M;if(M<c-1&&(w=a[I+3],C=a[I+4],P=a[I+5],u)){x=w,_=C,S=P;w=u[0]*x+u[4]*_+u[8]*S+u[12],C=u[1]*x+u[5]*_+u[9]*S+u[13],P=u[2]*x+u[6]*_+u[10]*S+u[14]}f+=Math.sqrt((E-g)*(E-g)+(T-y)*(T-y)+(O-b)*(O-b)),d[v++]=E,d[v++]=T,d[v++]=O,d[v++]=f,d[v++]=0===M?-1.2:-1,d[v++]=g,d[v++]=y,d[v++]=b,d[v++]=w,d[v++]=C,d[v++]=P,d[v++]=s[0],d[v++]=s[1],d[v++]=s[2],d[v++]=s[3],d[v++]=l[0],d[v++]=E,d[v++]=T,d[v++]=O,d[v++]=f,d[v++]=0===M?1.2:1,d[v++]=g,d[v++]=y,d[v++]=b,d[v++]=w,d[v++]=C,d[v++]=P,d[v++]=s[0],d[v++]=s[1],d[v++]=s[2],d[v++]=s[3],d[v++]=l[0],M>0&&M<c-1&&(d[v++]=E,d[v++]=T,d[v++]=O,d[v++]=f,d[v++]=-1.2,d[v++]=g,d[v++]=y,d[v++]=b,d[v++]=w,d[v++]=C,d[v++]=P,d[v++]=s[0],d[v++]=s[1],d[v++]=s[2],d[v++]=s[3],d[v++]=l[0],d[v++]=E,d[v++]=T,d[v++]=O,d[v++]=f,d[v++]=1.2,d[v++]=g,d[v++]=y,d[v++]=b,d[v++]=w,d[v++]=C,d[v++]=P,d[v++]=s[0],d[v++]=s[1],d[v++]=s[2],d[v++]=s[3],d[v++]=l[0]),g=E,y=T,b=O,E=w,T=C,O=P}if(this.canBeMerged){for(M=m;M<m+h;M++)d[M]=d[M+h];var D=v-h;for(M=0;M<h;M++)d[v++]=d[D++]}},e}(),E=c.newLayout().vec3f(p.VertexAttrConstants.POSITION).vec2f(p.VertexAttrConstants.UV0),T=function(){function e(){this.vertexBufferLayout=E,this.numVertsAtJoin=2,this.numVertsAtCap=2,this.tmpCurrent=s.vec3f64.create(),this.tmpLast=s.vec3f64.create()}return e.prototype.allocate=function(e){return C.createBuffer(e)},e.prototype.elementCount=function(e){return(e.indices[p.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap},e.prototype.write=function(e,t,r,n,i){var a=t.vertexAttr[p.VertexAttrConstants.POSITION].data,s=t.indices&&t.indices[p.VertexAttrConstants.POSITION];s&&(s.length,a.length);var l=a.length/3,c=e.transformation,u=0,d=this.tmpCurrent,f=this.tmpLast;o.vec3.set(d,a[0],a[1],a[2]);for(var h=i,v=0;v<l;v++){var m=3*v;o.vec3.copy(f,d),o.vec3.set(d,a[m],a[m+1],a[m+2]),c&&o.vec3.transformMat4(d,d,c),u+=o.vec3.squaredDistance(f,d),n.position.setVec(h,d),n.uv0.set(h,0,u),n.uv0.set(h,1,-1),++h,n.position.setVec(h,d),n.uv0.set(h,0,u),n.uv0.set(h,1,1),++h}},e}(),O={factor:0,units:-4},A=[255,255,255,255],R=[0,0,0,0],M=s.vec3f64.create(),I=s.vec3f64.create(),D=s.vec3f64.create(),V=s.vec3f64.create(),L=s.vec3f64.create(),F=i.createRenderScreenPointArray3(),B=i.createRenderScreenPointArray3(),N=s.vec3f64.create(),U=s.vec3f64.create(),z=l.lineSegment.create(),j=l.lineSegment.create(),G=[i.createRenderScreenPointArray3(),i.createRenderScreenPointArray3(),i.createRenderScreenPointArray3(),i.createRenderScreenPointArray3()],H=[s.vec3f64.create(),s.vec3f64.create(),s.vec3f64.create(),s.vec3f64.create()],k=l.plane.create(),W=l.plane.create(),q=l.plane.create(),X=l.plane.create();return x}.apply(null,n))||(e.exports=i)},Raj5:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){var r=function(){function e(e,t,r,i,a,o){this.camera=null,this.pass=0,this.slot=0,this.options=null,this.renderOccludedMask=n,this.rctx=e,this.offscreenRenderingHelper=t,this.lightingData=r,this.shadowMap=i,this.ssaoHelper=a,this.sliceHelper=o}return e.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=n},Object.defineProperty(e.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0}),e}(),n=5;return r}.apply(null,n))||(e.exports=i)},Rqxa:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("Q2wQ"),r("HZ3d"),r("idNY"),r("zp6E"),r("ma1f"),r("rg9i"),r("qsST"),r("qMld"),r("w00x"),r("WRgd"),r("weRx"),r("ys4y"),r("AgDx"),r("yqrJ"),r("TP2F")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g){function y(e,t){if(t){var r=t.request(e,"json");return u.create(function(e,t){r.then(function(t){e(t.data)},function(e){t(e instanceof a?e:b(e.url))})},function(){t.cancelRequest(r)})}var n=o(e);return u.create(function(e,t){n.then(function(t){e(t.data)},function(e){t(e instanceof a?e:b(e))})},function(){n.cancel()})}function b(e){return new s("","Request for object resource failed: "+e)}function x(e){var t=e.params,r=t.topology,n=!0;switch(t.vertexAttributes||(T.warn("Geometry must specify vertex attributes"),n=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var i=t.faces;if(i){if(t.vertexAttributes)for(var a in t.vertexAttributes){var o=i[a];o&&o.values?(null!=o.valueType&&"UInt32"!==o.valueType&&(T.warn("Unsupported indexed geometry indices type '"+o.valueType+"', only UInt32 is currently supported"),n=!1),null!=o.valuesPerElement&&1!==o.valuesPerElement&&(T.warn("Unsupported indexed geometry values per element '"+o.valuesPerElement+"', only 1 is currently supported"),n=!1)):(T.warn("Indexed geometry does not specify face indices for '"+a+"' attribute"),n=!1)}}else T.warn("Indexed geometries must specify faces"),n=!1;break;default:T.warn("Unsupported topology '"+r+"'"),n=!1}e.params.material||(T.warn("Geometry requires material"),n=!1);var s=e.params.vertexAttributes;for(var l in s)s[l].values||(T.warn("Geometries with externally defined attributes are not yet supported"),n=!1);return n}function _(e,t){return i(this,void 0,void 0,function(){var r,i,a,o,s,c,u,f,p,m,y,b,_,T,A,R,M,I,D,V,L,F,B,N,U,z,j,G,H,k,W,q,X,Y;return n(this,function(n){switch(n.label){case 0:return r=[],i=[],a=[],o=[],s=d.Version.parse(e.version||"1.0","wosr"),O.validate(s),c="meshsymbol_"+e.model.name,u=e.textureDefinitions,[4,w(c,u,t)];case 1:for(p in f=n.sent())o.push(f[p].engineTexObj);for(m=e.model.geometries,y=e.materialDefinitions,b=0,_=0;_<m.length;_++)if(x(T=m[_])){for(I in A=P(T),R=T.params.vertexAttributes,M={},R)D=R[I],V=D.values,M[I]={data:V,size:D.valuesPerElement};if(L={},"PerAttributeArray"===T.params.topology)for(N in F=M.position.data.length/M.position.size,B=E(F),M)L[N]=B;else for(z in U=T.params.faces)L[z]=new Uint32Array(U[z].values);j=A.texture?f[A.texture]:null,(G=a[A.material]?a[A.material][A.texture]:null)||(H=A.material.substring(A.material.lastIndexOf("/")+1),1===(k=y[H].params).transparency&&(k.transparency=0),W=j&&j.alphaChannelUsage,q=k.transparency>0||"transparency"===W||"maskAndTransparency"===W,X={ambient:k.diffuse,diffuse:k.diffuse,specular:[0,0,0],opacity:1-(k.transparency||0),transparent:q,textureAlphaMode:j?C(j.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:j?j.engineTexObj.id:void 0,textureInitTransparent:!0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:k.externalColorMixMode||"tint",textureAlphaPremultiplied:!0},t&&t.materialParamsMixin&&l.mixin(X,t.materialParamsMixin),G=new g(X,c),a[A.material]||(a[A.material]={}),a[A.material][A.texture]=G),i.push(G),Y=new h(new v(M,L),c),b+=L.position?L.position.length:0,r.push(Y)}return[2,{stageResources:{textures:o,materials:i,geometries:r},pivotOffset:e.model.pivotOffset,boundingBox:S(r),numberOfVertices:b,lodThreshold:null}]}})})}function S(e){var t=f.empty();return e.forEach(function(e){var r=e.boundingInfo;f.expand(t,r.getBBMin()),f.expand(t,r.getBBMax())}),t}function w(e,t,r){return i(this,void 0,void 0,function(){var i,a,o,s,l,c,d,f;return n(this,function(n){switch(n.label){case 0:for(o in i=[],a=function(n){var a=t[n],o=a.images[0].data;if(!o)return T.warn("Externally referenced texture data is not yet supported"),"continue";var s=a.encoding+";base64,"+o,l="/textureDefinitions/"+n,c={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0},d=r&&r.disableTextures?u.resolve(null):p.requestImage(s);i.push(d.then(function(t){return{refId:l,engineTexObj:new m(t,e,c),alphaChannelUsage:"rgba"===a.channels?a.alphaChannelUsage||"transparency":"none"}}))},t)a(o);return[4,u.all(i)];case 1:for(s=n.sent(),l={},c=0,d=s;c<d.length;c++)f=d[c],l[f.refId]=f;return[2,l]}})})}function C(e){switch(e){case"mask":return"mask";case"maskAndTransparency":return"maskBlend";case"none":return"opaque";case"transparency":default:return"blend"}}function P(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}function E(e){for(var t=new Uint32Array(e),r=0;r<e;r++)t[r]=r;return t}Object.defineProperty(t,"__esModule",{value:!0});var T=c.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");t.load=function(e,t){return i(this,void 0,void 0,function(){return n(this,function(r){switch(r.label){case 0:return[4,y(e,t.streamDataSupplier)];case 1:return[2,_(r.sent(),t)]}})})},t.createStageResources=_;var O=new d.Version(1,2,"wosr")}.apply(null,n))||(e.exports=i)},Rrc3:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("H1tY")],void 0===(i=function(e,t,r){return function(){function e(t,n){this._context=t,this._desc=n,this._glName=null,this._id=-1;var i=this._context.gl;r("esri-webgl-debug")&&this._context.instanceCounter.incrementCount(5),this._id=++e._nextId,this._glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this),i.renderbufferStorage(i.RENDERBUFFER,n.internalFormat,n.width,n.height)}return Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),e.prototype.resize=function(e,t){var r=this._context.gl,n=this._desc;n.width===e&&n.height===t||(n.width=e,n.height=t,this._context.bindRenderbuffer(this),r.renderbufferStorage(r.RENDERBUFFER,n.internalFormat,n.width,n.height))},e.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null),r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(5),this._context=null},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},RsYQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("jBNx"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("2fXB"),r("O7NG"),r("aWgr"),r("AzkI"),r("18xY"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f){function p(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function h(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function v(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}var m=function(){function e(e,t,r){void 0===e&&(e=o.vec3f64.create()),void 0===t&&(t=o.vec3f64.create()),void 0===r&&(r=o.vec3f64.fromValues(0,0,1)),this._viewUp=o.vec3f64.create(),this._viewForward=o.vec3f64.create(),this._viewRight=o.vec3f64.create(),this._ray=c.ray.createWrapper(),this._viewport=l.vec4f64.fromValues(0,0,1,1),this._padding=l.vec4f64.fromValues(0,0,0,0),this._fov=55/180*Math.PI,this._near=1,this._far=1e3,this._viewDirty=!0,this._viewMatrix=i.mat4f64.create(),this._projectionDirty=!0,this._projectionMatrix=i.mat4f64.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=i.mat4f64.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=i.mat4f64.create(),this._frustumDirty=!0,this._frustum=c.frustum.create(),this._fullViewport=null,this.pixelRatio=1,this.relativeElevation=0,this._eye=o.vec3f64.clone(e),this._center=o.vec3f64.clone(t),this._up=o.vec3f64.clone(r),this._padding=l.vec4f64.create()}return Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){this._compareAndSetView(e,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ray",{get:function(){return this._ray.origin=this.eye,this._ray.direction||(this._ray.direction=o.vec3f64.create()),a.vec3.subtract(this._ray.direction,this.center,this.eye),this._ray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){n.mat4.copy(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewForward",{get:function(){return this._ensureViewClean(),this._viewForward},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewUp",{get:function(){return this._ensureViewClean(),this._viewUp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRight",{get:function(){return this._ensureViewClean(),this._viewRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(this._near=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._far=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullViewport",{get:function(){return this._fullViewport||(this._fullViewport=l.vec4f64.create()),this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),s.vec4.copy(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionMatrix",{get:function(){return this._viewProjectionDirty&&(n.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this.aspect;n.mat4.frustum(this._projectionMatrix,-i*(1+2*this._padding[3]/e),i*(1+2*this._padding[1]/e),-r*(1+2*this._padding[2]/t),r*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){n.mat4.copy(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovX",{get:function(){return f.fovd2fovx(this._fov,this.width,this.height)},set:function(e){this._fov=f.fovx2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovY",{get:function(){return f.fovd2fovy(this._fov,this.width,this.height)},set:function(e){this._fov=f.fovy2fovd(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return a.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frustum",{get:function(){return this._recomputeFrustum(),this._frustum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverseTransposeMatrix",{get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=i.mat4f64.create()),n.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),n.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aboveGround",{get:function(){return this.relativeElevation>=0},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){return a.vec3.copy(this._eye,e._eye),a.vec3.copy(this._center,e._center),a.vec3.copy(this._up,e._up),s.vec4.copy(this._viewport,e._viewport),s.vec4.copy(this._padding,e._padding),this._near=e._near,this._far=e._far,this._fov=e._fov,this.relativeElevation=e.relativeElevation,this._viewDirty=e._viewDirty,this._viewDirty||(n.mat4.copy(this._viewMatrix,e._viewMatrix),a.vec3.copy(this._viewRight,e._viewRight),a.vec3.copy(this._viewUp,e._viewUp),a.vec3.copy(this._viewForward,e._viewForward)),e._projectionDirty?this._projectionDirty=!0:(n.mat4.copy(this._projectionMatrix,e._projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(c.frustum.copy(e._frustum,this._frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?n.mat4.copy(this._viewInverseTransposeMatrix,e._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=i.mat4f64.clone(e._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),e._fullViewport?this._fullViewport?s.vec4.copy(this._fullViewport,e._fullViewport):this._fullViewport=l.vec4f64.clone(e._fullViewport):this._fullViewport=null,this.pixelRatio=e.pixelRatio,this},e.prototype.copyViewFrom=function(e){this.eye=e.eye,this.center=e.center,this.up=e.up},e.prototype.copy=function(){var t=new e;return t.copyFrom(this),t},e.prototype.equals=function(e){return h(this._eye,e._eye)&&h(this._center,e._center)&&h(this._up,e._up)&&v(this._viewport,e._viewport)&&v(this._padding,e._padding)&&this._near===e._near&&this._far===e._far&&this._fov===e._fov&&this.pixelRatio===e.pixelRatio},e.prototype.almostEquals=function(e,t,r){void 0===r&&(r=!1);var n,i=a.vec3.distance(this._eye,this._center)*(t||5e-4),o=i*i;return r?(u.directionFromTo(b,e._eye,e._center),u.directionFromTo(x,this._eye,this._center),n=1e-10):(a.vec3.copy(b,e._center),a.vec3.copy(x,this._center),n=o),a.vec3.squaredDistance(e._eye,this._eye)<o&&a.vec3.squaredDistance(b,x)<n&&Math.abs(e._fov-this._fov)<.001&&p(e._padding,this._padding)<.5&&p(e._viewport,this._viewport)<.5&&this.pixelRatio===e.pixelRatio},e.prototype.markViewDirty=function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0},e.prototype.computeRenderPixelSizeAt=function(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.computeRenderPixelSizeAtDist=function(e){return e*this.perRenderPixelRatio},e.prototype.computeScreenPixelSizeAt=function(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))},e.prototype.viewDirectionDistance=function(e){return Math.abs(d.projectPointSignedLength(this.viewForward,a.vec3.subtract(b,e,this._eye)))},e.prototype.computeScreenPixelSizeAtDist=function(e){return e*this.perScreenPixelRatio},e.prototype.computeDistanceFromRadius=function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))},e.prototype.getScreenCenter=function(e){return void 0===e&&(e=r.createScreenPointArray()),e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[2]+this.height/2)/this.pixelRatio,e},e.prototype.getRenderCenter=function(e){return e||(e=r.createRenderScreenPointArray3()),e[0]=this.padding[3]+this.width/2,e[1]=this.padding[2]+this.height/2,e.length>2&&(e[2]=.5),e},e.prototype.setGLViewport=function(e){var t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])},e.prototype.applyProjection=function(e,t,r){void 0===r&&(r=!1),e!==g&&a.vec3.copy(g,e),g[3]=1,r&&(t[2]=-g[2]),s.vec4.transformMat4(g,g,this.projectionMatrix),a.vec3.scale(g,g,1/Math.abs(g[3]));var n=this.fullViewport;return t[0]=u.lerp(0,n[0]+n[2],.5+.5*g[0]),t[1]=u.lerp(0,n[1]+n[3],.5+.5*g[1]),r||(t[2]=.5*(g[2]+1)),t},e.prototype.projectPoint=function(e,t){if(g[0]=e[0],g[1]=e[1],g[2]=e[2],g[3]=1,s.vec4.transformMat4(g,g,this.viewProjectionMatrix),0===g[3])return null;a.vec3.scale(g,g,1/Math.abs(g[3]));var r=this.fullViewport;return"x"in t?(t.x=u.lerp(0,r[0]+r[2],.5+.5*g[0]),t.y=u.lerp(0,r[1]+r[3],.5+.5*g[1])):(t[0]=u.lerp(0,r[0]+r[2],.5+.5*g[0]),t[1]=u.lerp(0,r[1]+r[3],.5+.5*g[1]),t.length>2&&(t[2]=.5*(g[2]+1))),t},e.prototype.unprojectPoint=function(e,t){if(n.mat4.multiply(y,this.projectionMatrix,this.viewMatrix),!n.mat4.invert(y,y))return null;var r=this.fullViewport;return g[0]=2*(e[0]-r[0])/r[2]-1,g[1]=2*(e[1]-r[1])/r[3]-1,g[2]=2*e[2]-1,g[3]=1,s.vec4.transformMat4(g,g,y),0===g[3]?null:(t[0]=g[0]/g[3],t[1]=g[1]/g[3],t[2]=g[2]/g[3],t)},e.prototype.computeUp=function(e){"global"===e?this.computeUpGlobal():this.computeUpLocal()},e.prototype.screenToRender=function(e,t){var r=e[0]*this.pixelRatio,n=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=n,t},e.prototype.renderToScreen=function(e,t){var r=e[0]/this.pixelRatio,n=(this.fullHeight-e[1])/this.pixelRatio;return t[0]=r,t[1]=n,t},e.prototype.computeUpGlobal=function(){a.vec3.subtract(b,this.center,this.eye);var e=a.vec3.length(this.center);e<1?(a.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(a.vec3.dot(b,this.center))>.9999*a.vec3.length(b)*e||(a.vec3.cross(this.up,b,this.center),a.vec3.cross(this.up,this.up,b),a.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype.computeUpLocal=function(){u.directionFromTo(b,this.eye,this.center),Math.abs(b[2])<=.9999&&(a.vec3.scale(b,b,b[2]),a.vec3.set(this.up,-b[0],-b[1],1-b[2]),a.vec3.normalize(this.up,this.up),this.markViewDirty())},e.prototype._compareAndSetView=function(e,t){h(e,t)||(a.vec3.copy(t,e),this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0)},e.prototype._recomputeFrustum=function(){this._frustumDirty&&(c.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)},e.prototype._ensureViewClean=function(){this._viewDirty&&(n.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),a.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),a.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),a.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)},e}(),g=l.vec4f64.create(),y=i.mat4f64.create(),b=o.vec3f64.create(),x=o.vec3f64.create();return m}.apply(null,n))||(e.exports=i)},RtHu:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KBgh"),r("FT4I")],void 0===(i=function(e,t,r,n){function i(e,t,r){if(!r)return t.indexOf(e);for(var n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function a(e,t){o(e,0,e.children.length,t,e)}function o(e,t,r,n,i){i||(i=m(null,!0)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var a=t,o=void 0;a<r;a++)o=e.children[a],s(i,e.leaf?n(o):o);return i}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function p(e,t){var r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,a-n)}function h(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function v(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e,t){return{children:e,height:1,leaf:t,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(e,t,r,i,a){for(var o=[t,r];o.length;)if(!((r=o.pop())-(t=o.pop())<=i)){var s=t+Math.ceil((r-t)/i/2)*i;n(e,s,t,r,a),o.push(t,s,s,r)}}Object.defineProperty(t,"__esModule",{value:!0});var y=function(){function e(e,t){void 0===e&&(e=9),this.compareMinX=l,this.compareMinY=c,this.toBBox=function(e){return e},this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}return e.prototype.destroy=function(){this.clear(),b.prune(),x.prune(),_.prune(),S.prune()},e.prototype.all=function(e){this._all(this.data,e)},e.prototype.search=function(e,t){var r=this.data,n=this.toBBox;if(v(e,r))for(b.clear();r;){for(var i=0,a=r.children.length;i<a;i++){var o=r.children[i],s=r.leaf?n(o):o;v(e,s)&&(r.leaf?t(o):h(e,s)?this._all(o,t):b.push(o))}r=b.pop()}},e.prototype.collides=function(e){var t=this.data,r=this.toBBox;if(!v(e,t))return!1;for(b.clear();t;){for(var n=0,i=t.children.length;n<i;n++){var a=t.children[n],o=t.leaf?r(a):a;if(v(e,o)){if(t.leaf||h(e,o))return!0;b.push(a)}}t=b.pop()}return!1},e.prototype.load=function(e,t){if(void 0===t&&(t=e.length),!t)return this;if(t<this._minEntries){for(var r=0,n=t;r<n;r++)this.insert(e[r]);return this}var i=this._build(e.slice(0,t),0,t-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var a=this.data;this.data=i,i=a}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},e.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},e.prototype.clear=function(){return this.data=m([],!0),this},e.prototype.remove=function(e,t){if(!e)return this;var r,n,a,o,s=this.data,l=this.toBBox(e);for(_.clear(),S.clear();s||_.length;){if(s||(s=_.pop(),r=_.data[_.length-1],n=S.pop(),a=!0),s.leaf&&-1!==(o=i(e,s.children,t)))return s.children.splice(o,1),_.push(s),this._condense(_),this;a||s.leaf||!h(s,l)?r?(n++,s=r.children[n],a=!1):s=null:(_.push(s),S.push(n),n=0,r=s,s=s.children[0])}return this},e.prototype.toJSON=function(){return this.data},e.prototype.fromJSON=function(e){return this.data=e,this},e.prototype._all=function(e,t){for(x.clear();e;){if(!0===e.leaf)for(var r=0,n=e.children;r<n.length;r++){t(n[r])}else x.pushArray(e.children);e=x.pop()}},e.prototype._build=function(e,t,r,n){var i,o=r-t+1,s=this._maxEntries;if(o<=s)return a(i=m(e.slice(t,r+1),!0),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),(i=m([],!1)).height=n;var l=Math.ceil(o/s),c=l*Math.ceil(Math.sqrt(s));g(e,t,r,c,this.compareMinX);for(var u=t;u<=r;u+=c){var d=Math.min(u+c-1,r);g(e,u,d,l,this.compareMinY);for(var f=u;f<=d;f+=l){var p=Math.min(f+l-1,d);i.children.push(this._build(e,f,p,n-1))}}return a(i,this.toBBox),i},e.prototype._chooseSubtree=function(e,t,r,n){for(;n.push(t),!0!==t.leaf&&n.length-1!==r;){for(var i=1/0,a=1/0,o=void 0,s=0,l=t.children.length;s<l;s++){var c=t.children[s],d=u(c),p=f(e,c)-d;p<a?(a=p,i=d<i?d:i,o=c):p===a&&d<i&&(i=d,o=c)}t=o||t.children[0]}return t},e.prototype._insert=function(e,t,r){var n=this.toBBox,i=r?e:n(e);_.clear();var a=this._chooseSubtree(i,this.data,t,_);for(a.children.push(e),s(a,i);t>=0&&_.data[t].children.length>this._maxEntries;)this._split(_,t),t--;this._adjustParentBBoxes(i,_,t)},e.prototype._split=function(e,t){var r=e.data[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),s=m(r.children.splice(o,r.children.length-o),r.leaf);s.height=r.height,a(r,this.toBBox),a(s,this.toBBox),t?e.data[t-1].children.push(s):this._splitRoot(r,s)},e.prototype._splitRoot=function(e,t){this.data=m([e,t],!1),this.data.height=e.height+1,a(this.data,this.toBBox)},e.prototype._chooseSplitIndex=function(e,t,r){var n,i,a;n=i=1/0;for(var s=t;s<=r-t;s++){var l=o(e,0,s,this.toBBox),c=o(e,s,r,this.toBBox),d=p(l,c),f=u(l)+u(c);d<n?(n=d,a=s,i=f<i?f:i):d===n&&f<i&&(i=f,a=s)}return a},e.prototype._chooseSplitAxis=function(e,t,r){var n=e.leaf?this.compareMinX:l,i=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)},e.prototype._allDistMargin=function(e,t,r,n){e.children.sort(n);for(var i=this.toBBox,a=o(e,0,t,i),l=o(e,r-t,r,i),c=d(a)+d(l),u=t;u<r-t;u++){var f=e.children[u];s(a,e.leaf?i(f):f),c+=d(a)}for(u=r-t-1;u>=t;u--){f=e.children[u];s(l,e.leaf?i(f):f),c+=d(l)}return c},e.prototype._adjustParentBBoxes=function(e,t,r){for(var n=r;n>=0;n--)s(t.data[n],e)},e.prototype._condense=function(e){for(var t=e.length-1,r=void 0;t>=0;t--)0===e.data[t].children.length?t>0?(r=e.data[t-1].children).splice(r.indexOf(e.data[t]),1):this.clear():a(e.data[t],this.toBBox)},e.prototype._initFormat=function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")},e}();t.PooledRBush=y;var b=new r,x=new r,_=new r,S=new r({deallocator:null});t.default=y}.apply(null,n))||(e.exports=i)},Rzdu:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("eIBl"),r("Vx27")],void 0===(i=function(e,t,r,n,i,a,o){function s(e,t){return null!==e&&e>0&&e<8e7||t>50}return function(e){function t(){var t=e.call(this)||this;return t._scaleRangeActive=!1,t._layerScaleRangeVisibilityDirty=!0,t.layerScaleRangeVisibilityQuery=!1,t.scaleChangeEventHandle=null,t.handles=new a,t.layerView=null,t.layer=null,t.queryGraphicUIDsInExtent=null,t.extent=null,t.graphicsCore=null,t.basemapTerrain=null,t.suspended=!1,t}return r(t,e),Object.defineProperty(t.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},set:function(e){this._layerScaleRangeVisibilityDirty!==e&&(this._layerScaleRangeVisibilityDirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,r,n,i){var a=this;this.layerView=e,this.layer=t,this.queryGraphicUIDsInExtent=r,this.graphicsCore=n,this.basemapTerrain=i,this.updateScaleRangeActive();var o=this.layerView.view.resourceController.scheduler;this.handles.add(o.registerTask(6,function(){return a.update()},function(){return a.needsUpdate()}))},t.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),this.handles.destroy(),this.handles=null,this.layerView=null,this.extent=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null},t.prototype.needsUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},t.prototype.setExtent=function(e){this.extent=e,this.layerScaleRangeVisibilityDirty=!0},t.prototype.update=function(){this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1},t.prototype.scaleRangeActive=function(){return this._scaleRangeActive},t.prototype.updateScaleRangeActive=function(){var e=this,t=this.layer,r=s(t.minScale,t.maxScale);t.labelingInfo&&!r&&(r=t.labelingInfo.some(function(e){return e&&s(e.minScale,e.maxScale)}));var n=this._scaleRangeActive!==r;return this._scaleRangeActive=r,r&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",function(t){return e.scaleUpdateHandler(t)}):!r&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),n},t.prototype.updateSuspendScaleVisibleFinish=function(e){this.layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e)},t.prototype.updateSuspendScaleVisible=function(){var e=this,t=this.layerView.view.basemapTerrain;this.extent&&t&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,t.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(t){return e.updateSuspendScaleVisibleFinish(t)})):this.updateSuspendScaleVisibleFinish(!0)},t.prototype.visibleAtScale=function(e,t,r){return null==e||e>r&&(!t||e<t)},t.prototype.visibleAtLayerScale=function(e){return this.visibleAtScale(e,this.layer.minScale,this.layer.maxScale)},t.prototype.visibleAtLabelScale=function(e,t){return this.visibleAtScale(e,t.minScale,t.maxScale)},t.prototype.graphicScale=function(e){var t;return e.centroid?t=e.centroid:"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(t):1:null},t.prototype.graphicVisible=function(e){var t=this.graphicScale(e);return this.visibleAtLayerScale(t)},t.prototype.updateVisibility=function(e){if(this._scaleRangeActive){var t=this.graphicVisible(e);return e.setVisibilityFlag(1,t,0)}return!1},t.prototype.updateGraphicLabelScaleVisibility=function(e){if(!this._scaleRangeActive)return!1;if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var t=this.graphicScale(e),r=this.updateLabelScaleVisibility(e,t);return r&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty()),r},t.prototype.updateLabelScaleVisibility=function(e,t){if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var r=e._labelGraphics[0]._labelClass;if(r&&null!=r.minScale&&null!=r.maxScale){var n=this.visibleAtLabelScale(t,r);if(e.setVisibilityFlag(1,n,1))return!0}return!1},t.prototype.scaleUpdateHandler=function(e){var t=this;if(!this.layerView.suspended){var r=e.extent,n=e.scale,i=this.visibleAtLayerScale(n),a=!1;this.queryGraphicUIDsInExtent(r,e.spatialReference,function(e){var o=t.graphicsCore.getGraphics3DGraphicById(e);if(o){var s=o.centroid;if(s&&(r[0]>s.x||r[1]>s.y||r[2]<s.x||r[3]<s.y))return;var l=!1;o.setVisibilityFlag(1,i,0)&&(l=!0),t.updateLabelScaleVisibility(o,n)&&(l=!0),l&&(a=!0)}}),a&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=!0},t.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(e){return e.clearVisibilityFlag(1)})),this.layerScaleRangeVisibilityDirty=!0},n([o.property({readOnly:!0})],t.prototype,"suspended",void 0),n([o.property({readOnly:!0})],t.prototype,"updating",null),n([o.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],t)}(o.declared(i))}.apply(null,n))||(e.exports=i)},SgdR:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3]]},t.fromValues=function(e,t,r,n){return[e,t,r,n]},t.createView=function(e,t){return new Float64Array(e,t,4)}}.apply(null,n))||(e.exports=i)},TCFx:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}return e.prototype.incrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}},e.prototype.decrementCount=function(e){switch(e){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}},e.prototype.printResourceCount=function(){},e}()}.apply(null,n))||(e.exports=i)},TP2F:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("2Atf"),r("H1tY"),r("51bw"),r("0LE5"),r("Rdxj"),r("2B1V"),r("9FJH"),r("FNtW"),r("CIy2"),r("hnAi"),r("s6rJ"),r("s6rJ"),r("fPnv"),r("ZeO9"),r("C2Ab"),r("qbr3")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y){function b(e,t){return e?t?6:9:4}function x(e,t){var r=t.vvSizeEnabled;t.vvSizeEnabled?(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)):r&&e.setUniform3fv("vvSizeValue",t.vvSizeValue),r&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",t.vvSymbolRotationMatrix)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}function _(e){return!e.slicePlaneEnabled&&(e.cullFace?"none"!==e.cullFace:!e.transparent&&!e.doubleSided)}var S=d.assert,w=function(e){function t(r,n){var i=e.call(this,n)||this;return i.supportsEdges=!0,i.params=h.copyParameters(r,A),i.vertexBufferLayout=t.getVertexBufferLayout(i.params),i.instanceBufferLayout=r.instanced?t.getInstanceBufferLayout(i.params):null,i.textureMode=i.vertexBufferLayout.hasField("uv0")?"Textured":"none",i}return r(t,e),t.prototype.isVisibleInPass=function(e){return 3!==e||this.params.castShadows},t.prototype.isVisible=function(){var t=this.params;if(!e.prototype.isVisible.call(this)||0===t.layerOpacity)return!1;var r=t.instanced,n=t.vertexColors,i=t.symbolColors,a=!!r&&r.indexOf("color")>-1,o=t.vvColorEnabled,s="replace"===t.colorMixMode,l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return n&&(a||o||i)?!!s||l:n?s?c:l:a||o||i?!!s||l:s?c:l},t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)"instanced"===r&&S(e.instanced===t.instanced,"Can not change instanced attributes"),"textureId"===r&&S(t.textureId,"Can only change texture of material that already has a texture"),"vertexColors"===r&&!0===e[r]&&e[r]!==t[r]&&S(t.vertexColors,"Can not enable vertex colors after DefaultMaterial creation"),t[r]=e[r];this.notifyDirty("matChanged")},t.prototype.getParameters=function(){return this.params},t.prototype.intersect=function(e,t,r,n,i,a,s,l){if(null!==this.params.verticalOffset){var c=n.camera;o.vec3.set(U,r[12],r[13],r[14]);var u=o.vec3.subtract(z,U,c.eye),d=o.vec3.length(u),f=o.vec3.scale(u,u,1/d),p=null,v=null;switch(n.viewingMode){case"global":v=o.vec3.normalize(B,U);break;case"local":v=o.vec3.copy(B,F)}this.params.screenSizePerspective&&(p=o.vec3.dot(v,f));var m=h.verticalOffsetAtDistance(c,d,this.params.verticalOffset,p,this.params.screenSizePerspective);o.vec3.scale(v,v,m),o.vec3.transformMat3(N,v,n.transform.inverseRotation),i=o.vec3.subtract(V,i,N),a=o.vec3.subtract(L,a,N)}h.intersectTriangleGeometry(e,t,r,n,i,a,s)},t.prototype.getGLMaterials=function(){return{color:C,depthShadowMap:E,normal:T,depth:P,highlight:O}},t.prototype.getAllTextureIds=function(){var e=new Array;return this.params.textureId&&e.push(this.params.textureId),this.params.normalTextureId&&e.push(this.params.normalTextureId),[]},t.prototype.createRenderer=function(e,t){return this.params.instanced&&this.params.instanced.length>0?new v(e,t,this):new m(e,t,this)},t.prototype.createBufferWriter=function(){return new R(this.vertexBufferLayout,this.instanceBufferLayout)},t.getVertexBufferLayout=function(e){var t=l.newLayout().vec3f("position").vec3f("normal");return e.vertexTangents&&t.vec4f("aTangent"),e.textureId&&t.vec2f("uv0"),e.vertexColors&&t.vec4u8("color"),e.symbolColors&&t.vec4u8("symbolColor"),t},t.getInstanceBufferLayout=function(e){var t=l.newLayout();return t=e.instancedDoublePrecision?t.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):t.mat4f("model").mat4f("modelNormal"),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f("instanceColor")),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f("instanceFeatureAttribute")),t},t}(u),C=function(e){function t(t,r,n){var i=this,a=t.getParameters();(i=e.call(this,t,r,n,a.textureId,a.normalTextureId,a.textureInitTransparent)||this).params=h.copyParameters(a);var o=i.params;i.slot=b(o.transparent,o.writeDepth),i.textureMode=t.textureMode;var s=o.instanced;return i.instanced=!!s,i.instancedColor=!!s&&s.indexOf("color")>-1,i._createPrograms(),i.selectPipeline(),i}return r(t,e),t.prototype._createPrograms=function(){var e=this;this.programs=p.BindParametersMap.create(this.params,function(t){return e._createProgram(t)})},t.prototype._createProgram=function(e){var t=this.params;return this.programRep.getProgram(g.colorPass,{treeRendering:!!t.treeRendering,textureMode:this.textureMode,normalTexture:!!t.normalTextureId,tangents:t.vertexTangents?"vertex":"none",vertexColors:t.vertexColors,symbolColors:t.symbolColors,flipV:t.flipV,doubleSided:t.doubleSided&&"normal"===t.doubleSidedType,windowOrderDoubleSided:t.doubleSided&&"winding-order"===t.doubleSidedType,instanced:!!this.instanced,instancedDoublePrecision:t.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:e.receiveShadows,receiveSSAO:e.receiveSSAO,vvSize:t.vvSizeEnabled,vvColor:t.vvColorEnabled,verticalOffset:null!==t.verticalOffset,screenSizePerspective:null!==t.screenSizePerspective,slice:t.slicePlaneEnabled,normals:t.normals,textureAlphaMode:t.textureAlphaMode,textureAlphaPremultiplied:!!t.textureAlphaPremultiplied,iosSafariFix:D})},t.prototype.selectPipeline=function(){var e=this.params;this.pipelineState=y.makePipelineState({blending:M(e),culling:I(e),depthTest:{func:513},depthWrite:e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program||this.getPrograms()[0]},t.prototype.getPrograms=function(){return p.BindParametersMap.programs(this.programs)},t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.slot=b(this.params.transparent,this.params.writeDepth),this.updateTexture(this.params.textureId),this._createPrograms(),this.selectPipeline()},t.prototype.bind=function(e,t){var r=this.params,n=this.program=p.BindParametersMap.lookup(this.programs,t);e.bindProgram(n),e.setPipelineState(this.pipelineState),n.setUniform3fv("ambient",r.ambient),n.setUniform3fv("diffuse",r.diffuse),n.setUniform3fv("specular",r.specular),n.setUniform4fv("externalColor",r.externalColor),n.setUniform1i("colorMixMode",h.colorMixModes[r.colorMixMode]),n.setUniform1f("opacity",r.opacity),n.setUniform1f("layerOpacity",r.layerOpacity),h.bindVerticalOffset(r.verticalOffset,t,n),h.bindScreenSizePerspective(r.screenSizePerspective,n),x(n,r),this.bindTexture(e,n),"none"!==this.textureMode&&this.bindTextureSize(e,n),"mask"!==r.textureAlphaMode&&"maskBlend"!==r.textureAlphaMode||n.setUniform1f("textureAlphaCutoff",r.textureAlphaCutoff)},t.prototype.release=function(e,t){},t.prototype.bindView=function(e,t){var r=this.program=p.BindParametersMap.lookup(this.programs,t),n=this.params,i=n.instancedDoublePrecision?s.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(i,t.view,r),h.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&h.bindViewOriginDouble(i,r),n.slicePlaneEnabled&&h.bindSlicePlane(i,t.slicePlane,r),t.shadowMappingEnabled&&t.shadowMap.bindView(r,i)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(c),P=function(e){function t(t,r,n,i){void 0===i&&(i=!1);var a=e.call(this,t,r,n,t.getParameters().textureId)||this;return a.textureMode=t.textureMode,a.biased=i,a.updateParameters(),a}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(g.depthPass,{textureMode:this.textureMode,normalTexture:!!e.normalTextureId,tangents:e.vertexTangents?"vertex":"none",flipV:e.flipV,instanced:!!e.instanced,instancedDoublePrecision:e.instancedDoublePrecision,shadowMap:this.biased,vvSize:e.vvSizeEnabled,verticalOffset:null!==e.verticalOffset,screenSizePerspective:null!==e.screenSizePerspective,slice:e.slicePlaneEnabled,textureAlphaMode:e.textureAlphaMode,normals:e.normals,iosSafariFix:D}),this.pipelineState=y.makePipelineState({culling:I(e),depthTest:{func:513},depthWrite:e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.selectSlot=function(){this.slot=b(this.params.transparent,this.params.writeDepth)},t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),e.setPipelineState(this.pipelineState),r.setUniform2fv("nearFar",t.nearFar),h.bindVerticalOffset(n.verticalOffset,t,r),h.bindScreenSizePerspective(n.screenSizePerspective,r),x(r,n),"mask"!==n.textureAlphaMode&&"maskBlend"!==n.textureAlphaMode||r.setUniform1f("textureAlphaCutoff",n.textureAlphaCutoff),this.bindTexture(e,r)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=n.instancedDoublePrecision?s.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(i,t.view,r),n.slicePlaneEnabled&&h.bindSlicePlane(i,t.slicePlane,r),n.screenSizePerspective&&h.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&h.bindViewOriginDouble(i,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 4},t}(c),E=function(e){function t(t,r,n){return e.call(this,t,r,n,!0)||this}return r(t,e),t}(P),T=function(e){function t(t,r,n){var i=e.call(this,t,r,n,t.getParameters().textureId)||this;return i.params=h.copyParameters(t.getParameters()),i.textureMode=t.textureMode,i.selectProgram(),i.selectSlot(),i}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(g.normalPass,{textureMode:this.textureMode,normalTexture:!!e.normalTextureId,tangents:e.vertexTangents?"vertex":"none",flipV:e.flipV,instanced:!!e.instanced,instancedDoublePrecision:e.instancedDoublePrecision,vvSize:e.vvSizeEnabled,verticalOffset:null!==e.verticalOffset,screenSizePerspective:null!==e.screenSizePerspective,slice:e.slicePlaneEnabled,textureAlphaMode:e.textureAlphaMode,normals:e.normals,iosSafariFix:D}),this.pipelineState=y.makePipelineState({culling:I(e),depthTest:{func:513},depthWrite:e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.selectSlot=function(){this.slot=b(this.params.transparent,this.params.writeDepth)},t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),e.setPipelineState(this.pipelineState),this.bindTexture(e,r),h.bindVerticalOffset(n.verticalOffset,t,r),h.bindScreenSizePerspective(n.screenSizePerspective,r),x(r,n),"mask"!==n.textureAlphaMode&&"maskBlend"!==n.textureAlphaMode||r.setUniform1f("textureAlphaCutoff",n.textureAlphaCutoff)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=n.instancedDoublePrecision?s.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(i,t.view,r),r.setUniformMatrix4fv("viewNormal",t.viewInvTransp),n.slicePlaneEnabled&&h.bindSlicePlane(i,t.slicePlane,r),n.screenSizePerspective&&h.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&h.bindViewOriginDouble(i,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(c),O=function(e){function t(t,r,n){var i=e.call(this,t,r,n,t.getParameters().textureId)||this;return i.textureMode=t.textureMode,i.updateParameters(),i}return r(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(g.highlightPass,{textureMode:this.textureMode,normalTexture:!!e.normalTextureId,tangents:e.vertexTangents?"vertex":"none",flipV:e.flipV,instanced:!!e.instanced,instancedDoublePrecision:e.instancedDoublePrecision,vvSize:e.vvSizeEnabled,verticalOffset:null!==e.verticalOffset,screenSizePerspective:null!==e.screenSizePerspective,slice:e.slicePlaneEnabled,textureAlphaMode:e.textureAlphaMode,normals:e.normals,iosSafariFix:D}),this.pipelineState=y.makePipelineState({culling:I(e),depthTest:{func:513},depthWrite:e.writeDepth&&y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams})},t.prototype.selectSlot=function(){this.slot=b(this.params.transparent,this.params.writeDepth)},t.prototype.updateParameters=function(){this.params=h.copyParameters(this.material.getParameters()),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),e.setPipelineState(this.pipelineState),h.bindHighlightRendering(e,t,r),this.bindTexture(e,r),h.bindVerticalOffset(n.verticalOffset,t,r),h.bindScreenSizePerspective(n.screenSizePerspective,r),x(r,n),"mask"!==n.textureAlphaMode&&"maskBlend"!==n.textureAlphaMode||r.setUniform1f("textureAlphaCutoff",n.textureAlphaCutoff)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=n.instancedDoublePrecision?s.vec3f64.fromValues(t.viewInvTransp[3],t.viewInvTransp[7],t.viewInvTransp[11]):t.origin;h.bindView(i,t.view,r),n.slicePlaneEnabled&&h.bindSlicePlane(i,t.slicePlane,r),n.screenSizePerspective&&h.bindCamPos(i,t.viewInvTransp,r),n.instancedDoublePrecision&&h.bindViewOriginDouble(i,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return 4},t}(c);(w||(w={})).COLOR_GAMMA=2.1;var A={textureId:void 0,textureInitTransparent:!1,normalTextureId:void 0,vertexTangents:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:a.mat3f64.create(),transparent:!1,writeDepth:!0,textureAlphaMode:"blend",textureAlphaCutoff:.1,textureAlphaPremultiplied:!1},R=function(){function e(e,t){this.vertexBufferLayout=e,this.instanceBufferLayout=t}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices.position.length},e.prototype.write=function(e,t,r,n,i){f.writeDefaultAttributes(t,r,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,i)},e}(),M=function(e){return e.transparent&&y.separateBlendingParams(770,1,771,771)},I=function(e){return _(e)&&{face:"front"===e.cullFace?1028:1029,mode:2305}},D=!!i("ios")&&!!i("safari"),V=s.vec3f64.create(),L=s.vec3f64.create(),F=s.vec3f64.fromValues(0,0,1),B=s.vec3f64.create(),N=s.vec3f64.create(),U=s.vec3f64.create(),z=s.vec3f64.create();return w}.apply(null,n))||(e.exports=i)},TPlk:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(){return[0,0,0,0]}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r,t.clone=function(e){return[e[0],e[1],e[2],e[3]]},t.fromValues=function(e,t,r,n){return[e,t,r,n]},t.fromArray=function(e){for(var t=[0,0,0,0],r=Math.min(4,e.length),n=0;n<r;++n)t[n]=e[n];return t},t.createView=function(e,t){return new Float64Array(e,t,4)}}.apply(null,n))||(e.exports=i)},TUJR:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qsST")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.logger=r.getLogger("esri.views.3d.support.buffer.math")}.apply(null,n))||(e.exports=i)},TZB2:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zbgD")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return"#define SAMPLES "+e.samples+"\n"},a=function(e){return"#define RADIUS "+e.radius+"\n"};t.ssaoPass={name:"ssao",shaders:function(e){return{vertexShader:n.resolveIncludes("util/quad.vert"),fragmentShader:i(e)+n.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:r.Default3D},t.blurPass={name:"ssao-blur",shaders:function(e){return{vertexShader:n.resolveIncludes("util/quad.vert"),fragmentShader:a(e)+n.resolveIncludes("renderer/ssao/blur.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},Teen:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("U+8K")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.glslifyGlobalOptions=function(e){return r.glslifyDefineMap({VIEWING_MODE:{value:e.viewingMode,options:{global:"VIEWING_MODE_GLOBAL",local:"VIEWING_MODE_LOCAL"}}})}}.apply(null,n))||(e.exports=i)},TqPN:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("GntT"),r("f3AO"),r("dB/a"),r("cza4"),r("9o4r"),r("W5Zm"),r("Gz8v")],void 0===(i=function(e,t,r,n,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=n,t.mat4=i,t.scalar=a,t.vec2=o,t.vec3=s,t.vec4=l,t.createBuffer=function(e,t){return new e(new ArrayBuffer(t*e.ElementCount*r.elementTypeSize(e.ElementType)))}}.apply(null,n))||(e.exports=i)},TqrP:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.makeMaterialParameters=function(e){return void 0===e&&(e={}),r({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,colorMixMode:"multiply"},e)},t.makeTextureSource=function(e,t){return void 0===t&&(t={}),{data:e,parameters:r({wrap:r({s:10497,t:10497},t.wrap),noUnpackFlip:!0,mipmap:!1},t)}}}.apply(null,n))||(e.exports=i)},"TsU/":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("rg9i"),r("qsST"),r("Vx27"),r("icpk"),r("sDf1")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c){var u=o.getLogger("esri.geometry.support.MeshComponent");return function(e){function t(t){var r=e.call(this)||this;return r.faces=null,r.material=null,r.shading="source",r.trustSourceNormals=!1,r}var i;return r(t,e),i=t,t.prototype.castFaces=function(e){return c.castArray(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},u)},t.prototype.clone=function(){return new i({faces:a.clone(this.faces),shading:this.shading,material:a.clone(this.material),trustSourceNormals:this.trustSourceNormals})},t.prototype.cloneWithSharedTextures=function(){return new i({faces:a.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithSharedTextures():null,trustSourceNormals:this.trustSourceNormals})},n([s.property({json:{write:!0}})],t.prototype,"faces",void 0),n([s.cast("faces")],t.prototype,"castFaces",null),n([s.property({type:l.MeshMaterial,json:{write:!0}})],t.prototype,"material",void 0),n([s.property({type:String,json:{write:!0}})],t.prototype,"shading",void 0),n([s.property({type:Boolean})],t.prototype,"trustSourceNormals",void 0),i=n([s.subclass("esri.geometry.support.MeshComponent")],t)}(s.declared(i))}.apply(null,n))||(e.exports=i)},U6iw:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("7laH")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(t.disjointTimerQuery)return null;var n=e.getExtension("EXT_disjoint_timer_query")||e.getExtension("EXT_disjoint_timer_query_webgl2");return n?r.default(e)?{createQuery:function(){return e.createQuery()},resultAvailable:function(t){return e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)},getResult:function(t){return e.getQueryParameter(t,e.QUERY_RESULT)},disjoint:function(){return e.getParameter(n.GPU_DISJOINT_EXT)},beginTimeElapsed:function(t){return e.beginQuery(n.TIME_ELAPSED_EXT,t)},endTimeElapsed:function(){return e.endQuery(n.TIME_ELAPSED_EXT)},createTimestamp:function(e){return n.queryCounterEXT(e,n.TIMESTAMP_EXT)},timestampBits:function(){return e.getQuery(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return n.createQueryEXT()},resultAvailable:function(e){return n.getQueryObjectEXT(e,n.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(e){return n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT)},disjoint:function(){return e.getParameter(n.GPU_DISJOINT_EXT)},beginTimeElapsed:function(e){return n.beginQueryEXT(n.TIME_ELAPSED_EXT,e)},endTimeElapsed:function(){return n.endQueryEXT(n.TIME_ELAPSED_EXT)},createTimestamp:function(e){return n.queryCounterEXT(e,n.TIMESTAMP_EXT)},timestampBits:function(){return n.getQueryEXT(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)}}:null}}.apply(null,n))||(e.exports=i)},UD5A:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("1m5D"),r("p23x")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.factory=e,this.originData=new Map}return e.prototype.aquire=function(e){return this.register(this.factory.getOrigin(e))},e.prototype.register=function(e){var t=this.originData.get(e.id);return t?(t.refCount++,t.origin):(this.originData.set(e.id,{refCount:1,viewMatrix:n.mat4f64.create(),origin:e}),e)},e.prototype.release=function(e){var t=this.originData.get(e.id);t&&0==--t.refCount&&this.originData.delete(e.id)},e.prototype.updateViewMatrices=function(e){this.originData.forEach(function(t){r.mat4.copy(t.viewMatrix,e),i.applyToViewMatrix(t.origin.vec3,t.viewMatrix)})},e.prototype.getViewMatrix=function(e){return this.originData.get(e.id).viewMatrix},e}();t.LocalOriginManager=a}.apply(null,n))||(e.exports=i)},UtTF:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zbgD"),r("U+8K")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return i.glslifyDefineMap({WALL:e.wall,SCREENSCALE:e.screenScale,STIPPLE:e.stipple,SLICE:e.slice})};t.colorPass={name:"ribbon-line-color",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/ribbonLine/colorPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"ribbon-line-highlight",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/ribbonLine/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},V1i6:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ma1f"),r("qMld"),r("k1EI"),r("Thzy"),r("Lzvl"),r("nrlZ"),r("gT/q"),r("+6sX"),r("Jvs9"),r("Q2Em"),r("zDti")],void 0===(i=function(e,t,n,i,a,o,s,l,c,u,d,f,p){function h(e){return!0===x.spatialRelationship[e]}function v(e){return!0===x.queryGeometry[s.getJsonType(e)]}function m(e){return!0===x.layerGeometry[e]}function g(){return i.create(function(e){return r.e(15).then(function(){var t=[r("21p4")];e.apply(null,t)}.bind(this)).catch(r.oe)})}Object.defineProperty(t,"__esModule",{value:!0});var y="feature-store:unsupported-query",b={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},x={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};t.importGeometryEngine=g,t.getGeodesicBufferOperator=function(){return g().then(function(e){return e.geodesicBuffer})},t.getSpatialQueryOperator=function(e,t,r){if(s.isPolygon(t)&&"esriGeometryPoint"===r.geometryType&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var n=u.convertFromPolygon(new d.default,t,!1,!1);return i.resolve(function(e){return c.polygonContainsPoint(n,!1,!1,e)})}if(s.isPolygon(t)&&"esriGeometryMultipoint"===r.geometryType){var l=u.convertFromPolygon(new d.default,t,!1,!1);if("esriSpatialRelContains"===e)return i.resolve(function(e){return c.polygonContainsMultipoint(l,!1,!1,e,r.hasZ,r.hasM)})}if(s.isExtent(t)&&"esriGeometryPoint"===r.geometryType&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return i.resolve(function(e){return a.extentContainsPoint(t,p.getGeometry(r,e))});if(s.isExtent(t)&&"esriGeometryMultipoint"===r.geometryType&&"esriSpatialRelContains"===e)return i.resolve(function(e){return a.extentContainsMultipoint(t,p.getGeometry(r,e))});if(s.isExtent(t)&&"esriSpatialRelIntersects"===e){var f=o.getExtentIntersector(r.geometryType);return i.resolve(function(e){return f(t,p.getGeometry(r,e))})}return g().then(function(n){var i=n[b[e]].bind(null,t);return function(e){return i(p.getGeometry(r,e))}})},t.checkSpatialQuerySupport=function(e,t,r){var a=e.spatialRel,o=e.geometry;return o?h(a)?l.isValid(o.spatialReference)&&l.isValid(r)?v(o)?m(t)?e.outSR?f.checkProjectionSupport(e.geometry&&e.geometry.spatialReference,e.outSR):i.resolve():i.reject(new n(y,"Unsupported layer geometry type",{query:e})):i.reject(new n(y,"Unsupported query geometry type",{query:e})):i.resolve():i.reject(new n(y,"Unsupported query spatial relationship",{query:e})):i.resolve()},t.canQueryWithRBush=function(e){if(s.isExtent(e))return!0;if(s.isPolygon(e)){for(var t=0,r=e.rings;t<r.length;t++){var n=r[t];if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}return!0}return!1}}.apply(null,n))||(e.exports=i)},V6Fi:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q2wQ"),r("HZ3d"),r("IZai")],void 0===(i=function(e,t,r,n,i){function a(e){var t=[];return e.stageResources.geometries.forEach(function(r,n){var i=e.stageResources.materials[n],a=e.stageResources.textures;t.push({material:i,geometry:r,textures:a})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function o(e,t){void 0===t&&(t=s);var r=i.computeFaceCount(e);return Math.sqrt(r/(t*Math.PI))}Object.defineProperty(t,"__esModule",{value:!0}),t.makeLodLevelResources=a,t.makeLodResources=function(e){return{levels:e.map(function(e){return a(e)})}},t.estimateMinScreenSpaceRadius=o,t.fillEstimatedMinScreenSpaceRadius=function(e){e.levels.forEach(function(e){e.minScreenSpaceRadius||(e.minScreenSpaceRadius=o(e))})};var s=.05}.apply(null,n))||(e.exports=i)},VVgn:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return{edgeRenderer:{"adjustProjectedPosition.glsl":"uniform vec2 uDepthBias;\nuniform vec2 uViewportDimInv;\n\n// Utility function to check for NaN values\nbool isNaN(float val) {\n  return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;\n  // important: some nVidias failed to cope with version below.\n  // Probably wrong optimization.\n  /*return ( val <= 0.0 || 0.0 <= val ) ? false : true;*/\n}\n\n// An offset in xy screen space, along the projected normal of the edge\n// This reduces depth fighting when looking at a face from a flat angle\nvec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\n  float offsetXY = uDepthBias.x;\n  float offsetZ  = uDepthBias.y;\n\n  // screen space pixel offset\n  // we multiply by two to account for the fact that NDC go from -1 to 1\n  // we multiply by projPos.w to compensate for the perspective divison that happens later\n  // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n  // towards the camera\n  vec4 projNormal = uProj * uView * vec4(worldNormal, 0.0);\n\n  return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n}\n\n// A z-offset, using a depth based heuristic.\nfloat calculateProjectedBiasZ(vec4 projPos) {\n  float offsetZ = uDepthBias.y;\n  return sqrt(projPos.z) * offsetZ;\n}\n\nvec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n  vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);\n\n  // we currently have to do this check because some geometries come with 0 length edge normals.\n  // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n  if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {\n    projPos.xy += offsetXY;\n  }\n\n  projPos.z += calculateProjectedBiasZ(projPos);\n\n  return projPos;\n}\n","edgeRenderer.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nvarying vec4 vColor;\nvarying float vRadius;\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vLineLengthPixels;\nvarying float vSizeFalloffFactor;\nvarying float vLineIndex;\n\n// At which coverage threshold we discard a fragment completely\n#define COVERAGE_TEST_THRESHOLD 0.01\n\n#include <edgeRenderer/lineOffset.glsl>\n\nvec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n  float lineOffset = calculateLineOffset();\n  float positionX = position.x - lineOffset;\n\n  if (radius < 1.0) {\n    // Handle this specifically for subpixel sizes:\n    // 1. Compute correct coverage (note coverage is computed by\n    //    0.5 - dist, so we make sure that that will lead to correct\n    //    subpixel coverage\n    // 2. Ignore rounded caps\n    float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n    float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n    float coverage = min(coverageX, coverageY);\n\n    return vec2(0.5 - coverage, 0.0);\n  }\n  else {\n    // Between -radius -> 0 for start cap, 0 for line, 0 -> radius\n    float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);\n\n    vec2 lineToPosition = vec2(positionX, positionOnCap);\n    return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n  }\n}\n\nvoid main() {\n\n  float radius = vRadius * calculateLinePressure();\n\n  vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n  float coverage = clamp(0.5 - distance.x, 0.0, 1.0);\n\n#ifdef ANTIALIASING\n\n  const float coverageLimit = COVERAGE_TEST_THRESHOLD;\n\n#else /* ANTIALIASING */\n\n  // Use subpixel coverage computation when lines get subpixel widths\n  // so we still render them appropriately. Otherwise discard anything\n  // that is not fully within the line\n  float coverageLimit = radius <= 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\n\n#endif /* ANTIALIASING */\n\n  if (coverage < coverageLimit) {\n    discard;\n  }\n\n  discardBySlice(vWorldPosition);\n\n  float alpha = vColor.a * coverage;\n\n  gl_FragColor = vec4(vColor.rgb, alpha);\n}\n","edgeRenderer.vert":"#include <util/vsPrecision.glsl>\n\n// Transformations\nuniform mat4 uProj;\nuniform mat4 uView;\nuniform mat4 uModel;\nuniform vec3 uCameraPosition;\n\n// Line configuration\n\n// Conversion constants\nuniform vec2 uPixelToNDC;\nuniform vec2 uNDCToPixel;\nuniform float uPixelRatio;\n\n// Inputs\nattribute vec3 aPosition0;\nattribute vec3 aPosition1;\nattribute float aVariantOffset;\nattribute float aVariantStroke;\nattribute float aVariantExtension;\n\n#ifdef SILHOUETTE\n\nattribute vec3 aNormalA;\nattribute vec3 aNormalB;\n\n#else /* SILHOUETTE */\n\nattribute vec3 aNormal;\n\n#endif /* SILHOUETTE */\n\nattribute vec2 aSideness;\nattribute vec2 aPackedAttributes;\n\nstruct UnpackedAttributes {\nvec2 sideness;\nvec2 sidenessNorm;\nfloat lineWidthPixels;\nfloat extensionLengthPixels;\n\n#if (MODE == MODE_UBER)\n\nfloat type;\n\n#endif\n};\n\n// Output required to compute color\nvarying vec4 vColor;\n\n// Output required to compute distance to line/caps\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying float vRadius;\nvarying float vLineLengthPixels;\nvarying float vSizeFalloffFactor;\n\n#include <edgeRenderer/adjustProjectedPosition.glsl>\n#include <edgeRenderer/styleOutputs.glsl>\n#include <edgeRenderer/lineAmplitude.glsl>\n#include <edgeRenderer/util.glsl>\n\nvec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  vec2 sideness = unpackedAttributes.sideness;\n  vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n  vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n  vec4 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);\n  vec4 projPosV0 = uProj * viewPosV0;\n  vec4 projPosV1 = uProj * viewPosV1;\n  vec4 projPos = uProj * viewPos;\n\n  vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n  vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;\n  float lineLengthPixels = length(screenSpaceLinePixels);\n\n  float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;\n  vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;\n  vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n  float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n  float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;\n\n  float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n  float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n  vSizeFalloffFactor = falloffFactor;\n\n  float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n  float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n#ifdef ANTIALIASING\n\n  const float aaPaddingPixels = 1.0;\n\n  // Line size with padding\n  float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n  float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;\n\n  // Line length with padding\n  float aaPaddedLineLengthPixels = extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\n  float halfAAPaddedLineLengthPixels = aaPaddedLineLengthPixels * 0.5;\n\n#else /* ANTIALIASING */\n\n  // Even if there is no AA, we still want to do proper <1px rendering,\n  // so we effectively clamp the pixel sizes to minimum of 1px and compute\n  // coverage in the fragment shader\n  float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n  float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;\n\n  float halfAAPaddedLineLengthPixels = max(extendedLineLengthPixels, 1.0) * 0.5;\n\n#endif /* ANTIALIASING */\n\n  // Half line width in NDC including padding for anti aliasing\n  vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n  vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;\n  vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;\n\n  // Compute screen space position of vertex, offsetting for line size and end caps\n  vec2 ndcOffset = (\n      screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n    + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n  );\n\n  projPos.xy += ndcOffset * projPos.w;\n  projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n  projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n  // Line length with end caps\n  float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n  float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n  // Position in pixels with origin at first vertex of line segment\n  vPosition = vec3(\n    halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n    pixelPositionAlongLine,\n    pixelPositionAlongLine / extendedLineLengthPixels\n  );\n\n  // The line width radius in pixels\n  vRadius = lineWidthPixels * 0.5;\n  vLineLengthPixels = extendedLineLengthPixels;\n\n#ifdef SILHOUETTE\n\n  gl_Position = isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10.0, 10.0, 10.0, 1.0);\n\n#else /* SILHOUETTE */\n\n  gl_Position = projPos;\n\n#endif /* SILHOUETTE */\n\n#if (MODE == MODE_UBER)\n\n  if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) {\n    gl_Position = vec4(10.0, 10.0, 10.0, 1.0);\n  }\n\n#elif (MODE == MODE_SKETCH)\n\n  if (lineLengthPixels <= 3.0) {\n    gl_Position = vec4(10.0, 10.0, 10.0, 1.0);\n  }\n\n#endif\n\n  return projPos;\n}\n\n#if (MODE == MODE_UBER)\n\nUnpackedAttributes unpackAttributes(ComponentData component) {\n\n  vec2 sidenessNorm = aSideness;\n  vec2 sideness = sidenessNorm * 2.0 - 1.0;\n\n  float fType = component.type;\n  float extensionLengthPixels = component.extensionLength;\n  float lineWidth = component.lineWidth;\n\n  if (fType <= 0.0) {\n    extensionLengthPixels *= aVariantExtension * 2.0 - 1.0;\n  }\n\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n}\n\n#else /* (MODE == MODE_UBER) */\n\nUnpackedAttributes unpackAttributes(ComponentData component) {\n  vec2 sidenessNorm = aSideness;\n  vec2 sideness = sidenessNorm * 2.0 - 1.0;\n  float extensionLengthPixels = component.extensionLength;\n\n#if (MODE == MODE_SKETCH)\n\n  extensionLengthPixels *= aVariantExtension * 2.0 - 1.0;\n\n#endif\n\n  float lineWidth = component.lineWidth;\n\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n}\n\n#endif /* (MODE == MODE_UBER) */\n\nvoid main() {\n  ComponentData component = readComponentData();\n  UnpackedAttributes unpackedAttributes = unpackAttributes(component);\n\n  vec4 worldPosV0 = uModel * vec4(aPosition0, 1.0);\n  vec4 worldPosV1 = uModel * vec4(aPosition1, 1.0);\n\n  vec4 viewPosV0 = uView * worldPosV0;\n  vec4 viewPosV1 = uView * worldPosV1;\n\n#ifdef SILHOUETTE\n\n  vec3 worldNormal = silhouetteWorldNormal(aNormalA, aNormalB);\n\n#else /* SILHOUETTE */\n\n  vec3 worldNormal = modelToWorldNormal(aNormal);\n\n#endif /* SILHOUETTE */\n\n  // General geometric computation for all types of edges\n  vec4 projPos = calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\n\n  // Component color\n  vColor = component.color;\n\n  // Specific computation for different edge styles\n  calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\n}\n","lineAmplitude.glsl":"// Solid\n\n#if (MODE == MODE_UBER || MODE == MODE_SOLID)\n\n  float calculateLineAmplitudeSolid() {\n    return 0.0;\n  }\n\n#endif\n\n#if (MODE == MODE_SOLID)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSolid();\n  }\n\n#endif\n\n// Sketch\n\n#if (MODE == MODE_UBER || MODE == MODE_SKETCH)\n\n  uniform float uStrokesAmplitude;\n\n  float calculateLineAmplitudeSketch() {\n    return uStrokesAmplitude;\n  }\n\n#endif\n\n#if (MODE == MODE_SKETCH)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    return calculateLineAmplitudeSketch();\n  }\n\n#endif\n\n// Uber\n\n#if (MODE == MODE_UBER)\n\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n    float type = unpackedAttributes.type;\n\n    if (type <= 0.0) {\n      return calculateLineAmplitudeSketch();\n    }\n    else {\n      return calculateLineAmplitudeSolid();\n    }\n  }\n\n#endif\n","lineOffset.glsl":"#include <util/encoding.glsl>\n\n// Sketch\n\n#if (MODE == MODE_UBER || MODE == MODE_SKETCH)\n\n  uniform sampler2D uStrokesTexture;\n  uniform float uStrokesNormalizationScale;\n\n  varying vec2 vStrokeUV;\n\n  float calculateLineOffsetSketch() {\n    float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n  }\n\n  float calculateLinePressureSketch() {\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n  }\n\n#endif\n\n#if (MODE == MODE_SKETCH)\n\n  float calculateLineOffset() {\n    return calculateLineOffsetSketch();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureSketch();\n  }\n\n#endif\n\n// Solid\n\n#if (MODE == MODE_UBER || MODE == MODE_SOLID)\n\n  float calculateLineOffsetSolid() {\n    return 0.0;\n  }\n\n  float calculateLinePressureSolid() {\n    return 1.0;\n  }\n\n#endif\n\n#if (MODE == MODE_SOLID)\n\n  float calculateLineOffset() {\n    return calculateLineOffsetSolid();\n  }\n\n  float calculateLinePressure() {\n    return calculateLinePressureSolid();\n  }\n\n#endif\n\n// Uber\n\n#if (MODE == MODE_UBER)\n  varying float vType;\n\n  float calculateLineOffset() {\n    if (vType <= 0.0) {\n      return calculateLineOffsetSketch();\n    }\n    else {\n      return calculateLineOffsetSolid();\n    }\n  }\n\n  float calculateLinePressure() {\n    if (vType <= 0.0) {\n      return calculateLinePressureSketch();\n    }\n    else {\n      return calculateLinePressureSolid();\n    }\n  }\n#endif\n","styleOutputs.glsl":"#if (MODE == MODE_UBER || MODE == MODE_SKETCH)\n\n  uniform vec2 uStrokesTextureScale;\n  uniform float uStrokesLog2Resolution;\n  uniform float uStrokeVariants;\n\n  varying vec2 vStrokeUV;\n  varying float vLineIndex;\n\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n    vec2 sidenessNorm = unpackedAttributes.sidenessNorm;\n\n    float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n    vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\n    vStrokeUV.x += aVariantOffset;\n\n    vLineIndex = lineIndex;\n  }\n#endif\n\n#if (MODE == MODE_SOLID)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n  }\n#elif (MODE == MODE_SKETCH)\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n  }\n#elif (MODE == MODE_UBER)\n  varying float vType;\n\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n    vType = unpackedAttributes.type;\n\n    if (unpackedAttributes.type <= 0.0) {\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n    }\n  }\n#endif\n","util.glsl":"uniform float uDistanceFalloffFactor;\n\nfloat distanceBasedPerspectiveFactor(float distance) {\n  return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n}\n\nuniform sampler2D uComponentDataTex;\nuniform vec2 uComponentDataTexInvDim;\n\nattribute float aComponentIndex;\n\n#define COMPONENT_COLOR_FIELD_OFFSET 0.0\n#define COMPONENT_OTHER_FIELDS_OFFSET 1.0\n#define COMPONENT_FIELD_COUNT 2.0\n\n#define LINE_WIDTH_FRACTION_FACTOR 8.0\n#define EXTENSION_LENGTH_OFFSET 128.0\n\n#define COMPONENT_TEX_WIDTH 4096.0\n\nvec2 componentTextureCoords(float componentIndex, float fieldOffset) {\n  float fieldIndex = COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n  float rowIndex = floor(fieldIndex / COMPONENT_TEX_WIDTH);\n  float colIndex = mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n  vec2 linearIndex = vec2(\n    (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n    (rowIndex + 0.5) * uComponentDataTexInvDim.y\n  );\n\n  return linearIndex;\n}\n\nstruct ComponentData {\n  vec4 color;\n  float lineWidth;\n  float extensionLength;\n  float type;\n};\n\nComponentData readComponentData() {\n  vec2 colorIndex = componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n  vec2 otherIndex = componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n  vec4 colorValue = texture2D(uComponentDataTex, colorIndex);\n  vec4 otherValue = texture2D(uComponentDataTex, otherIndex);\n\n  return ComponentData(\n    vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n    otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n    otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n    -(otherValue.z * 255.0) + 0.5 // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;\n  );\n}\n\nvec3 modelToWorldNormal(vec3 normal) {\n  return (uModel * vec4(normal, 0.0)).xyz;\n}\n\nvec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\n  return modelToWorldNormal(normalize(normalA + normalB));\n}\n\n// Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\n// fall-off exponentially\nfloat calculateExtensionLength(float extensionLength, float lineLength) {\n  return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n}\n\n#ifdef SILHOUETTE\n\n// #uniforms: uView, uModel\nbool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\n  // transform the two face normals\n  vec3 viewNormalA = (uView * uModel * vec4(normalA, 0.0)).xyz;\n  vec3 viewNormalB = (uView * uModel * vec4(normalB, 0.0)).xyz;\n\n  // compute the direction from the edge to the camera\n  vec3 viewDir = -viewPos.xyz;\n\n  // check which of the two faces are visible\n  // display the edge if exactly one of the two is visible\n  float faceAVisible = dot(viewDir, viewNormalA); // positive if visible\n  float faceBVisible = dot(viewDir, viewNormalB); // positive if visible\n\n  // 1 if exactly one face visible, 0 otherwise\n  return faceAVisible * faceBVisible < 0.0;\n}\n\n#endif /* SILHOUETTE */\n"},environment:{"realisticAtmosphere.frag":"#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/color.glsl>\n\n// Light\nuniform vec3 v3LightDir;      // The direction vector to the light source\nuniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\n\n// Atmosphere\nconst float fKrESun = 0.075;        // Kr * ESun = 0.005 * 15.0\nconst float fKmESun = 0.015;        // Km * ESun = 0.005 * 15\n\n// Radii\nuniform vec4 v4Radii; // (fInnerRadius, fInnerRadius^2, fOuterRadius, fOuterRadius^2)\n\n// The inner (planetary) radius\n#define fInnerRadius v4Radii[0]\n// fInnerRadius^2\n#define fInnerRadius2 v4Radii[1]\n// The outer (atmosphere) radius\n#define fOuterRadius v4Radii[2]\n// fOuterRadius^2\n#define fOuterRadius2 v4Radii[3]\n\n// Atmosphere parameters:\n// fScale:                    1.0 / (fOuterRadius - fInnerRadius)\n// fScaleDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n// fScaleOverScaleDepth:      fScale / fScaleDepth\n// fOneOverScaleDepth:        1.0 / fScaleDepth\n\n// fScaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n// fScaleOverScaleDepthBlue:  fScale / fScaleDepthBlue\n// fOneOverScaleDepthBlue;    1.0 / fScaleDepthBlue\n\nuniform vec4 v4AtmosParams1; // (fScale, fScaleDepth, fScaleOverScaleDepth, fOneOverScaleDepth)\nuniform vec4 v4AtmosParams2; // (g, fScaleDepthBlue, fScaleOverScaleDepthBlue, fOneOverScaleDepthBlue)\n\n#define fScale v4AtmosParams1.x\n// fScaleDepth, fScaleDepthBlue\n#define v2ScaleDepth vec2(v4AtmosParams1.y,v4AtmosParams2.y)\n// fScaleOverScaleDepth, fScaleOverScaleDepthBlue\n#define v2ScaleOverScaleDepth vec2(v4AtmosParams1.z,v4AtmosParams2.z)\n// fOneOverScaleDepth, fOneOverScaleDepthBlue\n#define v2OneOverScaleDepth vec2(v4AtmosParams1.w,v4AtmosParams2.w)\n\n#ifndef HAZE\nuniform vec4 v4AtmosParams3; // (g2, fMiePhaseCoefficients, fLowerAlphaBlendBound, fOneOverOuterRadiusMinusAlphaBlendBound)\nuniform float fInnerFadeDistance;\nuniform float fAltitudeFade;\n\n#define fg v4AtmosParams2.x\n#define fg2 v4AtmosParams3.x\n#define fMiePhaseCoefficients v4AtmosParams3.y\n#define fLowerAlphaBlendBound v4AtmosParams3.z\n#define fOneOverOuterRadiusMinusAlphaBlendBound v4AtmosParams3.w\n#endif\n\n// Camera\nuniform vec3 v3CameraPos;     // The camera's current position\nuniform vec2 nearFar;\n\nuniform vec4 v4SphereComp;              // (fCameraHeight, fCameraHeight2, fC, fCSur)\n// The camera's current height\n#define fCameraHeight v4SphereComp[0]\n// fCameraHeight^2\n#define fCameraHeight2 v4SphereComp[1]\n// fCameraHeight2 - fOuterRadius2; // C = ||o-c||^2 - r^2\n#define fC v4SphereComp[2]\n// fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C = ||o-c||^2 - r^2\n#define fCSur v4SphereComp[3]\n\n// Camera HDR\n#ifdef HAZE\nconst float fExposure = 1.5;\n#else\nconst float fExposure = 2.0;\n#endif\n\n#ifdef HAZE\n// Depth texture\nuniform sampler2D tDepth;\n#endif\n\n// Testing variables\nuniform float showTest;\n\n// Varyings\nvarying vec3 v3EyeDir;\nvarying vec3 v3WorldRay;\nvarying vec2 vtc;\n\n// Loop constants for integral approximation\nconst float fSamples = 5.0;\nconst int maxSamples = 5;\n\n#ifdef HAZE\n  const float fOneOverGamma = 1.0;//Gamma = 1.0\n#else\n  const float fOneOverGamma = 0.454545; // Gamma = 2.2\n#endif\n\nconst vec3 v3OneOverGamma = vec3(fOneOverGamma);\n\n// ToneMapping operators\nvec3 expTM(vec3 inputColor,float exposure){\n    return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\n}\n\n#ifndef HAZE\nvec3 reinhardTM(vec3 inputColor, float exposure){\n  vec3 intermediate = inputColor *exposure;\n  intermediate /= (1.0+intermediate);\n  return pow(intermediate, v3OneOverGamma);\n}\n#endif\n\n// Approximation for inner integral based on a radii ratio of 10.25:10\nfloat scale(float fCos){\n  float x = 1.0 - fCos;\n  return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main() {\n  vec3 cameraPosition = v3CameraPos;\n\n  // Debug variables\n  vec3 test = vec3(0.0,0.0,0.0);\n\n  // Obtain ray from Camera\n  vec3 worldSpaceRay = normalize(v3WorldRay);\n\n  // Compute Atmosphere intersection; i.e. ray/sphere intersection\n  float B = 2.0 * dot(cameraPosition, worldSpaceRay); // B = 2(l * (o-c))\n  float det = B*B - 4.0 * fC; // det = B^2 - 4.0* C\n\n  // idealized sphere intersection to discard early some pixels\n  float detSur = B*B - 4.0 * fCSur; // det = B^2 - 4.0* C\n\n  // the minimal sample start position:\n  // at the camera by default, on the earth radius surface if the camera is underground.\n  float fMinRayStart = 0.0;\n#ifndef HAZE\n  // When the ray intersects the earth surface, fade the sky to a simple light direction\n  // based color. This is used to make sure we have a white background in underground\n  // mode (at noon).\n  float fSurfaceBlend = 0.0;\n  vec4 surfaceColor = vec4(0.0);\n  if (detSur >= 0.0) {\n    float nearSurfaceT = max(0.0, 0.5 *(-B - sqrt(detSur)));\n    float farSurfaceT = max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n    if (nearSurfaceT == 0.0) {\n      fMinRayStart = farSurfaceT;\n    }\n\n    // Compute lighting at the point where the ray enters the earth surface\n    // Lighting computation is copied from the terrain shader.\n    vec3 vPos = cameraPosition + worldSpaceRay * nearSurfaceT;\n    float fLightAngle = dot(v3LightDir, normalize(vPos));\n    float fBrightness = max(0.0, (smoothstep(-1.0, 0.8, 2.0 * fLightAngle)));\n\n    // Make the surface transparent based on altitude\n    surfaceColor = vec4(fBrightness, fBrightness, fBrightness, 1.0 - fAltitudeFade);\n\n    // Fade based on the distance the ray travels below the earth surface\n    float fRelDist = (farSurfaceT - nearSurfaceT) / fInnerFadeDistance;\n\n    // early exit\n    if (fRelDist > 1.0) {\n      gl_FragColor = surfaceColor;\n      return;\n    }\n\n    fSurfaceBlend = smoothstep(0.0, 1.0, fRelDist * fRelDist);\n  }\n#endif\n\n  // Inside Atmosphere\n  if (det >= 0.0) {\n#ifdef HAZE\n    // only use red channel from depth texture.\n    // see 'Issues' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\n    float depthSample = texture2D(tDepth, vtc).r;\n\n    float zNear = nearFar[0];\n    float zFar = nearFar[1];\n\n    // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n    float zNorm = 2.0 * depthSample - 1.0;\n    float linDepth = 2.0 * zNear * zFar /\n      (zFar + zNear - zNorm * (zFar - zNear));\n\n    float rayEndT;\n    float altitudeAlpha = 1.0;\n\n    // find intersections with ground, but only between the near and far\n    // clipping planes.\n    if (depthSample < 1.0 && depthSample > 0.0) {\n      vec3 cameraSpaceRay = normalize(v3EyeDir);\n      cameraSpaceRay /= cameraSpaceRay.z;\n      cameraSpaceRay *= linDepth;\n\n      float cameraSpaceRayLength = length(cameraSpaceRay);\n\n      vec3 v3World = cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n      float v3WorldRadius2 = dot(v3World, v3World);\n\n      // Handle tall structures:\n      // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n      float transitionStart = fInnerRadius + 20000.0;\n      float transitionHeight = 25000.0;\n      float transitionEnd = transitionStart + transitionHeight;\n\n      float edge0 = transitionStart * transitionStart;\n      float edge1 = transitionEnd * transitionEnd;\n\n      altitudeAlpha = 1.0 - clamp((v3WorldRadius2 - edge0) / (edge1 - edge0), 0.0, 1.0);\n      rayEndT = cameraSpaceRayLength;\n\n      if (altitudeAlpha > 0.0 && detSur > 0.0) {\n        float nearSurfaceT = 0.5 *(-B - sqrt(detSur));\n        float interp = clamp(((fCameraHeight - fInnerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n        rayEndT = mix(cameraSpaceRayLength, nearSurfaceT, interp);\n      }\n    }\n#endif\n\n    float rayStartT = 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n#ifdef HAZE\n    float nearT = abs(rayStartT);\n    float farT = abs(rayEndT);\n#else\n    float rayEndT = 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\n\n#endif\n\n    float fDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStartT < fMinRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStartT = fMinRayStart;\n#ifndef HAZE\n      // clamp to value at inner radius altitude\n      fDistance = fScale * min(0.0, fInnerRadius - fCameraHeight);\n#endif\n    }\n#ifndef HAZE\n    else\n    { // outside atmosphere\n      fDistance = -1.0;\n    }\n#endif\n\n    // Initialize the scattering loop variables\n    vec3 v3Start = cameraPosition + worldSpaceRay * rayStartT;\n\n#ifdef HAZE\n    vec3 v3End = cameraPosition + worldSpaceRay * rayEndT;\n\n    float fEndLength = length(v3End);\n    float fAltitudeEnd = fEndLength - fInnerRadius;\n    float fAltitudeStart = length(v3Start) - fInnerRadius;\n\n    // for camera positions below altitude 0, invert the altitudes, to achieve\n    // a similar haze as above ground. Note that there is a small but visible change\n    // when the camera passes altitude 0.\n    if (fAltitudeStart < 0.0) {\n      fAltitudeStart = -fAltitudeStart;\n      fAltitudeEnd = -fAltitudeEnd;\n    }\n\n    // computed for the original end point to get consistent light angles after possible inversions\n    float fLightAngle = dot(v3LightDir, v3End) / fEndLength;\n\n    if (nearT > farT)\n    {\n      if (fAltitudeStart < fAltitudeEnd)\n      {\n        // Switch positive slopes for flipped rays\n        v3End = cameraPosition + worldSpaceRay * rayStartT;\n        v3Start = cameraPosition + worldSpaceRay * rayEndT;\n        worldSpaceRay *= -1.0;\n        float fTmp = fAltitudeStart;\n        fAltitudeStart = fAltitudeEnd;\n        fAltitudeEnd = fTmp;\n      }\n      else if (fAltitudeStart == fAltitudeEnd)\n      { // create minuscule fake slope for integration if the slope is zero\n        fAltitudeStart += 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n        // slope for the camera function\n      }\n    }\n\n    // Calculate its scattering offset\n    // Assumes camera constrains of WSV 3.8\n    float fCameraDepth;\n    float fCameraDepthBlue;\n    if (fAltitudeStart > fOuterRadius - fInnerRadius)\n    { // outside atmosphere\n      fDistance = fInnerRadius - fOuterRadius;\n    } else\n    {\n      fDistance = fAltitudeEnd - fAltitudeStart;\n    }\n\n#endif\n    vec2 v2OpticalStartDepth = exp(fDistance * v2OneOverScaleDepth);\n\n    float fRayLength = rayEndT - rayStartT;\n    float fSampleLength = fRayLength / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = worldSpaceRay * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n#ifdef HAZE\n    float fCameraAngle = dot(-worldSpaceRay, v3End) / length(v3End);\n    float fScaleCameraAngle = scale(fCameraAngle);\n    vec2 v2CameraOffset = fScaleCameraAngle*v2OpticalStartDepth;\n\n    float scaledValues = scale(fLightAngle) + fScaleCameraAngle;\n    vec2 v2ScaledValuesDepth = scaledValues * v2ScaleDepth;\n#else\n    float fCameraAngle = dot(worldSpaceRay, v3Start / length(v3Start));\n    float angleMultiplier = fCameraAngle>0.0?fCameraAngle:0.0;\n\n    float fScaleCameraAngle = scale(fCameraAngle);\n    vec2 v2CameraOffset = fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\n#endif\n\n    // Loop variables\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    vec3 v3FrontColorBlue = vec3(0.0, 0.0, 0.0);\n    vec3 v3Attenuate= vec3(0.0, 0.0, 0.0);\n    vec3 v3AttenuateBlue = vec3(0.0, 0.0, 0.0);\n\n    // Now loop through the sample rays\n    for(int i=0; i<maxSamples; i++) {\n      float fHeight = length(v3SamplePoint);\n      float fAltitude = abs(fHeight - fInnerRadius);\n\n      vec2 v2Depth = exp(-fAltitude * v2ScaleOverScaleDepth);\n#ifdef HAZE\n      vec2 v2Scatter = v2Depth*v2ScaledValuesDepth-v2CameraOffset;\n#else\n      float fLightAngle = dot(v3LightDir, v3SamplePoint) / fHeight;\n      float fCameraAngle = dot(worldSpaceRay, v3SamplePoint) / fHeight;\n      float fTempScaledValues = scale(fLightAngle) - scale(fCameraAngle);\n      vec2 v2Scatter = v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\n#endif\n      v3Attenuate = exp(-v2Scatter.x * v3InvWavelengthScaled);\n      v3AttenuateBlue = exp(-v2Scatter.y * v3InvWavelengthScaled);\n\n      v3FrontColor += v3Attenuate * v2Depth.x;\n      v3FrontColorBlue += v3AttenuateBlue * v2Depth.y;\n\n      v3SamplePoint += v3SampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos == -1.0 (and close values) to display fake sun\n    float fCos = clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\n    float fOnePlusCos2 = fCos*fCos + 1.0;\n#ifdef HAZE\n    // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n    vec3 colorCoefficients = (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\n\n    // Scaled Length is only applied afterwards to save multiplications\n    vec3 v3Color = colorCoefficients *v3FrontColor;\n    vec3 v3ColorBlue = colorCoefficients *v3FrontColorBlue;\n#else\n    vec3 v3RayleighCoefficients = (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\n    float fMieCoefficients = fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + fg2 - 2.0*fg*fCos, 1.5);\n\n    // Calculate the attenuation factor for the ground\n    vec3 v3Color = v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\n    vec3 v3ColorBlue = v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\n#endif\n\n    // HDR to LDR conversion\n    vec3 ldrBlue = expTM(v3ColorBlue,2.0*fExposure);\n    vec3 ldrRed = expTM(v3Color,fExposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR = mix(ldrBlue,ldrRed,0.2);\n#ifdef HAZE\n    LDR *= (1.0-fCameraAngle);\n    vec3 hsv = rgb2hsv(LDR);\n    hsv.y = clamp(hsv.y*1.5,0.0,1.0); // boost haze saturation by 50%\n    LDR = hsv2rgb(hsv);\n    vec3 finalColor = LDR;\n    // when rendering we specify the blend functions such that\n    // newDestColor = oldDestColor*(1.0-finalColor) + finalColor\n#else\n    // reinhard tonemapper for looking upwards\n    vec3 ldrReinhard = reinhardTM(v3Color,fExposure);\n    LDR += angleMultiplier*ldrReinhard;\n\n    // height dependent parameter to smooth out reddish atmosphere\n    float side = (rayEndT+rayStartT)*0.5;\n    float atmoHeight = sqrt(fCameraHeight2 - side*side);\n    float h2 = clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\n\n    vec3 finalColor = LDR*h2;\n    vec3 hsv = rgb2hsv(finalColor);\n    hsv.y = clamp(hsv.y*1.5,0.0,1.0); // boost sky saturation by 50%\n    finalColor = hsv2rgb(hsv);\n#endif\n\n#ifndef HAZE\n    float atmosStrength = clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\n    gl_FragColor = vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\n    if (fSurfaceBlend > 0.0) {\n      gl_FragColor = mix(gl_FragColor, surfaceColor, fSurfaceBlend);\n    }\n#else\n    gl_FragColor = vec4(finalColor, 1.0) * altitudeAlpha;\n#endif\n\n    // Debug variable overlay\n    if(showTest>0.0){\n      gl_FragColor = vec4(test,1.0);\n    }\n  } else { // Outside Atmosphere\n    gl_FragColor = vec4(0.0);\n  }\n}\n","realisticAtmosphere.vert":"#include <util/vsPrecision.glsl>\n\n// Camera\nuniform vec2 halfSizeNearPlane;\nuniform vec3 v3CameraUp;\nuniform vec3 v3CameraRight;\nuniform vec3 v3CameraDir;\nuniform vec2 v2CameraCenterOffset;\n\n// Attributes\nattribute vec3 position;\nattribute vec2 uv0;\n\n// Varyings\nvarying vec3 v3WorldRay;\nvarying vec2 vtc;\n\n#ifdef HAZE\nvarying vec3 v3EyeDir;\n#endif\n\nvoid main(void) {\n  vec3 v3Pos = position;\n  vtc = uv0;\n  vec2 rayvtc = uv0 - v2CameraCenterOffset;\n\n#ifdef HAZE\n  v3EyeDir = vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\n#else\n  vec3 v3EyeDir = vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\n#endif\n  v3WorldRay = v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\n  gl_Position = vec4(v3Pos, 1.0);\n}\n","simpleAtmosphere.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\n\nvarying vec2 vtc;\nvarying float falloff;\n\n#ifndef PANORAMIC\nuniform float altitudeFade;\nvarying float innerFactor;\n#endif\n\nvoid main() {\n  vec4 texColor = texture2D(tex, vtc);\n\n#ifdef PANORAMIC\n  gl_FragColor = texColor * falloff;\n#else\n  vec4 atmosphereColor = texColor * falloff;\n  vec4 innerColor = vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n  gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n#endif\n}\n","simpleAtmosphere.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\n\n#ifndef PANORAMIC\nconst float TWICEPI = 2.0*3.14159265;\nconst float ATMOSPHERE_RIM_SEGMENTS = 128.0;\n\nuniform vec3 silCircleCenter;\nuniform vec3 silCircleV1;\nuniform vec3 silCircleV2;\nuniform vec2 texV;\n\nuniform float innerScale;  // scale for inner rim\nvarying float innerFactor; // 0: outer atmosphere, 1: inner atmosphere\n#endif\n\nuniform vec3 lightDirection;\n\nattribute vec3 position;\nvarying vec2 vtc;\nvarying float falloff;\n\nvoid main(void) {\n\n#ifdef PANORAMIC\n\n  vec3 pos = position;\n  float ndotl = lightDirection.z;\n  vtc = vec2(0.0, position.z+0.05);\n\n#else\n\n  innerFactor = clamp(-position.z, 0.0, 1.0);\n  float scale = position.y * (1.0 + innerFactor * innerScale);\n  float phi = position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n  vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n  float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightDirection);\n\n  vtc.x = position.x / ATMOSPHERE_RIM_SEGMENTS;\n  vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;\n\n#endif\n\n  falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n  gl_Position = proj * view * vec4(pos, 1.0);\n  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane\n}\n","simpleAtmosphereFade.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n","simpleAtmosphereFade.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\n\nuniform vec3 lightDirection;\nuniform vec3 cameraPosition;\n\nuniform float undergroundFadeAlpha;\n\nvarying vec4 color;\n\nvoid main(void) {\n  float ndotl = dot(normalize(cameraPosition), lightDirection);\n  float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n  color = vec4(vec3(lighting), undergroundFadeAlpha);\n\n  gl_Position = vec4(position.xy, 1.0, 1.0); // on the far plane\n}\n","stars.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec4 vcolor;\nvarying float vsize;\n\nvoid main() {\n  float cap = 0.7;\n  float scale = 1.0/cap;\n  float helper = clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\n  float alpha = clamp((cap-helper)*scale,0.0,1.0);\n  float intensity = alpha*alpha*alpha;\n  if (vsize < 3.0)\n    intensity *= 0.5;\n  gl_FragColor = vec4(1.0,1.0,1.0,intensity);\n  gl_FragColor.xyz *= vcolor.xyz;\n}\n","stars.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\nuniform vec4 viewport;\nuniform float pixelRatio;\n\nattribute vec3 position;\nattribute vec4 color;\nattribute float size;\n\nvarying vec4 vcolor;\nvarying float vsize;\n\nvoid main(void) {\n  vec4 posProj = proj * view * model*vec4(position*1.0e25,1.0);//move infinitely far away\n  gl_Position = alignToPixelCenter(posProj, viewport.zw); //pixel align position\n  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane\n  vcolor = color / 1.2;\n  vsize = size * 5.0 * pixelRatio;\n  gl_PointSize = vsize;\n}\n"},materials:{checkerBoard:{"checkerBoard.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n\nuniform vec2 size;\nuniform vec4 color1;\nuniform vec4 color2;\n\nvarying vec2 vUV;\n\nvoid main() {\n  vec2 uvScaled = vUV / (2.0 * size);\n\n  vec2 uv = fract(uvScaled - 0.25);\n  vec2 ab = clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\n  float fade = smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\n  float t = mix(abs(ab.x + ab.y), 0.5, fade);\n\n  gl_FragColor = mix(color2, color1, t);\n}\n","checkerBoard.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec2 vUV;\n\nvoid main(void) {\n  vUV = uv0;\n  gl_Position = proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n}\n"},color:{"color.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nuniform vec4 eColor;\n#ifdef VERTEX_COLORS\nvarying vec4 vColor;\n#endif\n\nvarying vec3 vpos;\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef VERTEX_COLORS\n  gl_FragColor = vColor * eColor;\n#else\n  gl_FragColor = eColor;\n#endif\n\n  gl_FragColor = highlightSlice(gl_FragColor, vpos);\n}\n","color.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\n#ifdef VERTEX_COLORS\nattribute vec4 color;\n\nvarying vec4 vColor;\n#endif\n\nvarying vec3 vpos;\n\nvoid main(void) {\n#ifdef VERTEX_COLORS\n  vColor = color * 0.003921568627451; // = 1/255;\n#endif\n  vpos = (model * vec4(position, 1.0)).xyz;\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n}\n"},defaultMaterial:{"colorMixMode.glsl":"#include <util/color.glsl>\n\n/*\n * The color mix modes are encoded in the symbol color as follows:\n *  - Fully transparent symbols are represented with alpha 0 for\n *    all color mix modes (except ignore).\n *  - color mix mode ignore is encoded as multiply with white\n *  - the other 3 color mix modes (tint, replace, multiply) are\n *    equally distributed on the remaining 255 alpha values, which\n *    gives us 85 possible alpha values\n *\n * alpha             0 : fully transparent\n * alpha in [  1 -  85]: tint\n * alpha in [ 86 - 170]: replace\n * alpha in [171 - 255]: multiply\n * \n */\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha = 0.0;\n\n  const float maxTint = 85.0;\n  const float maxReplace = 170.0;\n  const float scaleAlpha = 3.0;\n\n  if (symbolColor.a > maxReplace) {\n    colorMixMode = 1;  // multiply\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n  } else if (symbolColor.a > maxTint) {\n    colorMixMode = 3; // replace\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n  } else if (symbolColor.a > 0.0) {\n    colorMixMode = 0; // tint\n    symbolAlpha = scaleAlpha * symbolColor.a;\n  } else {\n    colorMixMode = 1; // fully transparent -> multiply\n    symbolAlpha = 0.0;\n  }\n\n  return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n}\n\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  vec3 internalMixed = internalColor * textureColor;\n  vec3 allMixed = internalMixed * externalColor;\n\n  if (mode == 1 /* multiply */) {\n    return allMixed;\n  }\n  else if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalColor;\n  }\n  else {\n    // tint (or something invalid)\n    vec3 hsvIn = rgb2hsv(internalMixed);\n    vec3 hsvTint = rgb2hsv(externalColor);\n    vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\n\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  float internalMixed = internalOpacity * textureOpacity;\n  float allMixed = internalMixed * externalOpacity;\n\n  if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalOpacity;\n  }\n  else {\n    // multiply or tint (or something invalid)\n    return allMixed;\n  }\n}\n","colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/sceneLighting.glsl>\n\n#ifdef TEXTURING\n#include <materials/defaultMaterial/texturingInputs.glsl>\n#endif\n\n#define FRAGMENT_SHADER\n#include <materials/defaultMaterial/vertexTangents.glsl>\n#include <materials/defaultMaterial/textureNormals.glsl>\n\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n\n// material parameters\n//////////////////////////////////////////\nuniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float opacity;\nuniform float layerOpacity;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#else\nuniform int colorMixMode;\n#endif\n\n#ifdef RECEIVE_SHADOWS\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\n#endif\n\n#ifdef RECEIVE_SSAO\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\n#endif\n\nvarying vec3 vpos;\n\n#if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n  varying vec3 vnormal;\n#endif\n\n#if defined(VERTEXCOLORS)\nvarying vec4 vcolor;\n#endif\nvarying vec4 vcolorExt;\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#include <util/shadow.glsl>\n#endif\n\n#ifdef TREE_RENDERING\n  uniform mat4 view;\n#endif\n\n#ifdef TEXTURING\n#include <materials/defaultMaterial/texturing.glsl>\n#endif\n\n#include <materials/defaultMaterial/colorMixMode.glsl>\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  vec4 texColor = textureLookup(tex, vtc);\n\n  #if defined(TEXTURE_ALPHA_PREMULTIPLIED)\n    texColor.rgb /= texColor.a;\n  #endif\n\n  discardOrAdjustTextureAlpha(texColor);\n#else /* TEXTURING */\n  vec4 texColor = vec4(1.0);\n#endif /* TEXTURING */\n\n  vec3 viewDir = vpos - camPos;\n\n  // compute normal\n  // TODO: this is not in sync with the normal pass\n#ifdef GROUND_NORMAL_SHADING\n  #if VIEWING_MODE == VIEWING_MODE_GLOBAL\n    vec3 normal = normalize(vpos + localOrigin);\n  #else\n    vec3 normal = vec3(0.0, 0.0, 1.0);\n  #endif\n#else\n  #if (NORMALS == NORMALS_SCREEN_DERIVATIVE)\n    vec3 normal = normalize(cross(dFdx(vpos),dFdy(vpos)));\n  #else\n    #ifdef DOUBLESIDED\n      vec3 normal = dot(vnormal, viewDir)>0.0 ? -vnormal : vnormal;\n    #elif defined(WINDINGORDERDOUBLESIDED)\n      vec3 normal = gl_FrontFacing ? vnormal : -vnormal;\n    #else\n      vec3 normal = vnormal;\n    #endif\n    normal = normalize(normal);\n  #endif\n#endif\n\n  // compute ssao\n#ifdef RECEIVE_SSAO\n  float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  ssao = viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n#else\n  float ssao = 1.0;\n#endif\n\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\n  float additionalAmbientScale;\n  vec3 additionalLight = sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n\n  // compute shadowing\n  float shadow = 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow = evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#elif VIEWING_MODE == VIEWING_MODE_GLOBAL\n  // at global scale (and in global scenes) we fall back to this approximation\n  // to shadow objects on the dark side of the earth\n  shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);\n#endif\n\n  vec3 matColor = max(ambient, diffuse); // combine the old material parameters into a single one\n#if defined(VERTEXCOLORS)\n  // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\n  vec3 albedo_ = mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ = layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n#else\n  // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\n  vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n#endif\n  albedo_+= 0.25 * specular; // don't completely ignore specular for now\n\n\n  #if defined(TEXTURE_NORMALS)\n    mat3 tangentSpace = computeTangentSpace(normal);\n    vec3 shadingNormal = computeTextureNormal(tangentSpace);\n  #else\n    vec3 shadingNormal = normal;\n  #endif\n\n  #ifdef TREE_RENDERING\n    // make sure we use unflipped normal\n    shadingNormal = normalize(vnormal);\n\n    // make tree 20% brighter\n    albedo_ *= 1.2;\n\n    // view forward vector in global coordinates\n    vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\n\n    // factor indicating how aligned the lighting direction and view axis are\n    float alignmentLightView = clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n\n    // we approximate the tree crown transmittance based on view direction and tree crown normal\n    float transmittance = 1.0 - clamp(dot(-viewForward, shadingNormal), 0.0, 1.0);\n\n    float treeRadialFalloff = vcolor.r;\n    float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n    additionalLight += backLightFactor * lightingMainIntensity;\n  #endif\n\n  vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo_, shadow, 1.0 - ssao, additionalLight);\n  gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n}\n","colorPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\n#define VERTEX_SHADER\n#include <materials/defaultMaterial/vertexTangents.glsl>\n\n#ifdef INSTANCEDCOLOR\nattribute vec4 instanceColor;\n#endif\nattribute vec3 position;\n\n#if (NORMALS == NORMALS_COMPRESSED)\n  attribute vec2 normalCompressed;\n  varying vec3 vnormal;\n#elif (NORMALS == NORMALS_DEFAULT)\n  attribute vec3 normal;\n  varying vec3 vnormal;\n#endif\n\nvarying vec3 vpos;\n\n#ifdef TEXTURING\n    attribute vec2 uv0;\n    varying vec2 vtc;\n  #ifdef TEXTURE_ATLAS\n    attribute vec4 region;\n    varying vec4 regionV;\n  #endif\n#endif\n\n#ifdef COMPONENTCOLORS\n#include <materials/defaultMaterial/componentColors.glsl>\n#endif\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n\n#ifdef VERTEXCOLORS\nattribute vec4 color;\n#endif\n\n#ifdef SYMBOLVERTEXCOLORS\nattribute vec4 symbolColor;\n#endif\n\n#if defined(VERTEXCOLORS)\nvarying vec4 vcolor;\n#endif\n\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\n// This should be further cleaned up later with through the following issue:\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\nuniform vec4 externalColor;\nvarying vec4 vcolorExt;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#endif\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_SIZE) || defined(VV_COLOR)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/colorMixMode.glsl>\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/constants.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n#include <materials/defaultMaterial/localNormal.glsl>\n\nvoid main() {\n\n#ifdef VERTEXCOLORS\n  vcolor = color * 0.003921568627451; // = 1/255\n#endif\n\n  vcolorExt = externalColor;\n\n#ifdef INSTANCEDCOLOR\n  vcolorExt *= instanceColor;\n#endif\n\n#ifdef VV_COLOR\n  vcolorExt *= vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n#endif\n\n#ifdef SYMBOLVERTEXCOLORS\n  int symbolColorMixMode;\n  vcolorExt *= decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n  colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n\n#ifdef COMPONENTCOLORS\n  int symbolColorMixMode;\n  vcolorExt *= decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n  colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n\n  if (vcolorExt.a < SYMBOL_ALPHA_CUTOFF) {\n    // Discard this vertex\n    gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n  }\n  else {\n    vpos = calculateVPos();\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  #if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n    vnormal = normalize(modelNormal * localNormal().xyz);\n  #endif\n\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n  #ifdef IOS_SAFARI_FIX\n    originDelta = originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\n  #endif\n  vpos -= originDelta;\n\n  #ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz + originDelta;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n  #endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n  #if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n    vnormal = normalize((modelNormal * localNormal()).xyz);\n  #endif\n\n  #ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n  #endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n    #if defined(VERTEX_TANGENTS)\n      transformVertexTangent(mat3(modelNormal));\n    #endif\n\n    gl_Position = proj * view * vec4(vpos, 1.0);\n  }\n\n#ifdef RECEIVE_SHADOWS\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\n  // issues on iPad/iPhone with the 'w' component require the depth to be\n  // passed as varying to properly drive the cascading shadow map index.\n  linearDepth = gl_Position.w;\n#endif\n\n\n#ifdef TEXTURING\n  #ifndef FLIPV\n    vtc = uv0;\n  #else\n    vtc = vec2(uv0.x, 1.0-uv0.y);\n  #endif\n  #ifdef TEXTURE_ATLAS\n    regionV = region;\n  #endif\n#endif /* TEXTURING */\n\n}\n","commonFunctions.glsl":"#include <materials/defaultMaterial/localPosition.glsl>\n#include <util/doublePrecision.glsl>\n\nvec3 calculateVPos() {\n#ifdef INSTANCED_DOUBLE_PRECISION\n  return model * localPosition().xyz;\n#else\n  return (model * localPosition()).xyz;\n#endif\n}\n\n#ifdef VERTICAL_OFFSET\n#ifdef SCREEN_SIZE_PERSPECTIVE\n#include <util/screenSizePerspective.glsl>\n#endif\n\nvec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n  float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n  float verticalOffsetOffsetDistance = verticalOffset.x * viewDistance;\n\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n  vec3 worldNormal = normalize(worldPos + localOrigin);\n#else\n  vec3 worldNormal = vec3(0.0, 0.0, 1.0);\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float cosAngle = dot(worldNormal, normalize(worldPos - camPos));\n\n  float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\n#else\n  float verticalOffsetScreenHeight = verticalOffset.x;\n#endif\n\n  // Screen sized offset in world space, used for example for line callouts\n  float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n\n  return worldNormal * worldOffset;\n}\n#endif\n","commonInputs.glsl":"uniform mat4 proj;\nuniform mat4 view;\n#ifdef INSTANCED_DOUBLE_PRECISION\nuniform vec3 viewOriginHi;\nuniform vec3 viewOriginLo;\n#endif\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n\n#ifdef INSTANCED\n#ifdef INSTANCED_DOUBLE_PRECISION\nattribute vec3 modelOriginHi;\nattribute vec3 modelOriginLo;\nattribute mat3 model;\nattribute mat3 modelNormal;\n#else /* INSTANCED_DOUBLE_PRECISION */\nattribute mat4 model;\nattribute mat4 modelNormal;\n#endif /* INSTANCED_DOUBLE_PRECISION */\n#else /* INSTANCED */\nuniform mat4 model;\nuniform mat4 modelNormal;\n#endif /* INSTANCED */\n\n#ifdef VERTICAL_OFFSET\n// [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\nuniform vec4 verticalOffset;\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspectiveAlignment;\n#endif\n#endif\n","componentColors.glsl":"\nuniform sampler2D uComponentColorTex;\nuniform vec2 uComponentColorTexInvDim;\n\nattribute float componentIndex;\n\nvec4 readComponentColor() {\n  float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n  vec2 indexCoord = vec2(\n    mod(normalizedIndex, 1.0),\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n  );\n  vec4 componentColor = texture2D(uComponentColorTex, indexCoord);\n  // NB: we clear the least significant bit of the blue channel as this contains\n  // the castShadows flag\n  return vec4( componentColor.r, componentColor.g, componentColor.b - mod(componentColor.b*255.0, 2.0)/255.0, componentColor.a);\n}\n\n// returns 1.0 if shadowCasting is enabled and 0.0 otherwise\n// this is found by reading the least significant bit of the\n// componentColors blue color channel which contains the castShadows flag\nbool readComponentCastShadowsFlag(){\n  float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n  vec2 indexCoord = vec2(\n    mod(normalizedIndex, 1.0),\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n  );\n  if( mod(texture2D(uComponentColorTex, indexCoord).b*255.0, 2.0) < 1.0 )\n      return false;\n  return true;\n}\n","constants.glsl":"#define SYMBOL_ALPHA_CUTOFF 0.001\n","depthPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/depth.glsl>\n#include <util/slice.glsl>\n\nvarying float depth;\nvarying vec3 vpos;\n\n#if defined(TEXTURING)\n  #include <materials/defaultMaterial/texturingInputs.glsl>\n  #include <materials/defaultMaterial/texturing.glsl>\n#endif\n\n\nvoid main() {\n  discardBySlice(vpos);\n\n  #if defined(TEXTURING)\n    vec4 texColor = textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n\n  #ifndef BIAS_SHADOWMAP\n    gl_FragColor = float2rgba(depth);\n  #else\n    gl_FragColor = float2rgba(calcFragDepth(depth));\n  #endif\n}\n","depthPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\nuniform vec2 nearFar;\nattribute vec3 position;\n\nvarying float depth;\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n\n#if defined(COMPONENTCOLORS)\n#include <materials/defaultMaterial/componentColors.glsl>\n#endif\n\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n\n\n#if defined(COMPONENTCOLORS)\n  if( !readComponentCastShadowsFlag() ){\n    // discard vertex so that it doesnt show up in depth buffer\n    gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n  }else\n  {\n#endif\n\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n#ifdef IOS_SAFARI_FIX\n  originDelta = originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\n#endif\n  vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = model * localCenter().xyz + originDelta;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = (model * localCenter()).xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n  vec4 eye = view * vec4(vpos, 1.0);\n\n  gl_Position = proj * eye;\n  depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n\n#if defined(COMPONENTCOLORS)\n  } // if readComponentCastShadowsFlag==true\n#endif\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","highlightPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/highlight.glsl>\n\nvarying vec3 vpos;\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\n#if defined(TEXTURING)\n  #include <materials/defaultMaterial/texturingInputs.glsl>\n  #include <materials/defaultMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n  #if defined(TEXTURING)\n    vec4 texColor = textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}\n","highlightPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\nattribute vec3 position;\n\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n#ifdef IOS_SAFARI_FIX\n  originDelta = originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\n#endif\n  vpos -= originDelta;\n\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = model * localCenter().xyz + originDelta;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n#ifdef VERTICAL_OFFSET\n  vec3 centerPos = (model * localCenter()).xyz;\n  vpos += calculateVerticalOffset(centerPos, localOrigin);\n#endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","localCenter.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vvTransformPosition(vec3(0.0), instanceFeatureAttribute); }\n# endif\n#else\n# ifdef VERTICAL_OFFSET\nvec4 localCenter() { return vec4(vec3(0.0), 1.0); }\n# endif\n#endif\n","localNormal.glsl":"#include <util/normalEncoding.glsl>\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  # if (NORMALS == NORMALS_COMPRESSED)\n    vec4 localNormal() { return vvTransformNormal(decodeNormal(normalCompressed), instanceFeatureAttribute); }\n  # elif (NORMALS == NORMALS_DEFAULT)\n    vec4 localNormal() { return vvTransformNormal(normal, instanceFeatureAttribute); }\n  # endif\n#else\n  # if (NORMALS == NORMALS_COMPRESSED)\n    vec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\n  # elif (NORMALS == NORMALS_DEFAULT)\n    vec4 localNormal() { return vec4(normal, 1.0); }\n  # endif\n#endif\n","localPosition.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\nvec4 localPosition() { return vvTransformPosition(position, instanceFeatureAttribute); }\n#else\nvec4 localPosition() { return vec4(position, 1.0); }\n#endif\n","normalPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\n#if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n  varying vec3 vnormal;\n#endif\n\nvarying vec3 vpos;\n\n#if defined(TEXTURING)\n  #include <materials/defaultMaterial/texturingInputs.glsl>\n  #include <materials/defaultMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n  #if defined(TEXTURING)\n    vec4 texColor = textureLookup(tex, vtc);\n    discardOrAdjustTextureAlpha(texColor);\n  #endif\n\n#if (NORMALS == NORMALS_SCREEN_DERIVATIVE)\n  vec3 normal = normalize(cross(dFdx(vpos),dFdy(vpos)));\n#else\n  vec3 normal = normalize(vnormal);\n  if (gl_FrontFacing == false) normal = -normal;\n#endif\n\n  #ifndef ALPHA_ZERO\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n  #else\n    gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n  #endif\n}\n","normalPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/defaultMaterial/commonInputs.glsl>\n\nuniform mat4 viewNormal;\nattribute vec3 position;\n\n#if (NORMALS == NORMALS_COMPRESSED)\n  attribute vec2 normalCompressed;\n  varying vec3 vnormal;\n#elif (NORMALS == NORMALS_DEFAULT)\n  attribute vec3 normal;\n  varying vec3 vnormal;\n#endif\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n\nvarying vec3 vpos;\n\n#include <util/visualVariables.glsl>\n\n#if defined(VV_CUSTOM_MODEL_MATRIX)\nattribute vec4 instanceFeatureAttribute;\n#endif\n\n#include <materials/defaultMaterial/commonFunctions.glsl>\n#include <materials/defaultMaterial/localCenter.glsl>\n#include <materials/defaultMaterial/localNormal.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n#ifdef INSTANCED_DOUBLE_PRECISION\n  #if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n    vnormal = normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\n  #endif\n\n  vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n\n  #ifdef IOS_SAFARI_FIX\n    originDelta = originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\n  #endif\n  vpos -= originDelta;\n\n  #ifdef VERTICAL_OFFSET\n    vec3 centerPos = model * localCenter().xyz + originDelta;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n  #endif\n#else /* INSTANCED_DOUBLE_PRECISION */\n  #if (NORMALS == NORMALS_COMPRESSED) || (NORMALS == NORMALS_DEFAULT)\n    vnormal = normalize((viewNormal * modelNormal * localNormal()).xyz);\n  #endif\n\n  #ifdef VERTICAL_OFFSET\n    vec3 centerPos = (model * localCenter()).xyz;\n    vpos += calculateVerticalOffset(centerPos, localOrigin);\n  #endif\n#endif /* INSTANCED_DOUBLE_PRECISION */\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","textureNormals.glsl":"#if defined(TEXTURE_NORMALS)\n  uniform sampler2D texNormal;\n\n  vec3 computeTextureNormal(mat3 tangentSpace) {\n    vec3 rawNormal = texture2D(texNormal, vtc).rgb * 2.0 - 1.0;\n    return tangentSpace * rawNormal;\n  }\n#endif","texturing.glsl":'float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n  // from:\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\n  //   - http://www.linedef.com/virtual-texture-demo.html\n  float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\n}\n\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\n  //[umin, vmin, umax, vmax]\n  vec2 atlasScale = region.zw - region.xy;\n  vec2 uvAtlas = fract(uv) * atlasScale + region.xy;\n\n  vec4 texColor;\n\n  // calculate derivative of continuous texture coordinate\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\n  vec2 dUVdx = dFdx(uv) * atlasScale;\n  vec2 dUVdy = dFdy(uv) * atlasScale;\n\n#ifdef GL_EXT_shader_texture_lod\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\n#else\n  // use bias to compensate for difference in automatic vs desired mipmap level\n  vec2 dUVdxAuto = dFdx(uvAtlas);\n  vec2 dUVdyAuto = dFdy(uvAtlas);\n  float mipMapLevel = calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\n  float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\n\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}\n\nvec4 textureLookup(sampler2D tex, vec2 uv) {\n#ifdef TEXTURE_ATLAS\n  return textureAtlasLookup(tex, uv, regionV, texSize);\n#else\n  return texture2D(tex, uv);\n#endif\n}\n\n/**\n * Based on the texture alpha mode:\n * - discards fragments if necessary\n * - adjusts read texture alpha if necessary\n */\nvoid discardOrAdjustTextureAlpha(inout vec4 texColor) {\n  // if the texture alpha mode is set to "mask"\n  // the resulting alpha is either 0.0 (discard) or 1.0\n  #if defined(TEXTURE_ALPHA_MODE_MASK)\n    if (texColor.a < textureAlphaCutoff) {\n      discard;\n    } else {\n      texColor.a = 1.0;\n    }\n  // if the texture alpha mode is set to "maskBlend"\n  // the resulting alpha is either 0.0 (discard) or untouched for further use in blending\n  #elif defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\n    if (texColor.a < textureAlphaCutoff) {\n      discard;\n    }\n  // if the texture alpha mode is set to "opaque"\n  // the resulting alpha is always 1.0\n  #elif defined(TEXTURE_ALPHA_MODE_OPAQUE)\n    texColor.a = 1.0;\n  // for "blend" we don\'t need to do anyting\n  #else // defined(TEXTURE_ALPHA_MODE_BLEND)\n\n  #endif\n}\n\n\n\n',"texturingInputs.glsl":"#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\n\n#if defined(TEXTURE_ALPHA_MODE_MASK) || defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\nuniform float textureAlphaCutoff;\n#endif\n\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n\n#endif\n\n#if defined(TEXTURING) || defined(TEXTURE_COORDINATES)\nvarying vec2 vtc;\n#endif\n","vertexTangents.glsl":"#if defined(VERTEX_SHADER)\n\n  #if defined(VERTEX_TANGENTS)\n    attribute vec4 aTangent;\n    varying vec4 vTangent;\n\n    void transformVertexTangent(mat3 modelTransformForNormals) {\n      vTangent.xyz = modelTransformForNormals * aTangent.xyz;\n      vTangent.w = aTangent.w;\n    }\n  #endif // VERTEX_TANGENTS\n\n#elif defined(FRAGMENT_SHADER)\n\n  #if defined(VERTEX_TANGENTS)\n    varying vec4 vTangent;\n\n    #if defined(WINDINGORDERDOUBLESIDED)\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    #else // WINDINGORDERDOUBLESIDED\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness = vTangent.w;\n        vec3 tangent = normalize(vTangent.xyz);\n        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    #endif // WINDINGORDERDOUBLESIDED\n  #endif // VERTEX_TANGENTS\n\n#endif // VERTEX_SHADER\n"},hud:{"colorPass.frag":"#include <materials/hud/hudHeader.glsl>\n\nvoid main() {\n#include <materials/hud/hudMain.glsl>\n}\n","highlightPass.frag":"#include <materials/hud/hudHeader.glsl>\n#include <util/highlight.glsl>\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\nvoid main() {\n#include <materials/hud/hudMain.glsl>\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\n  // Instead of deciding on a per-pixel basis if the highlight is occluded,\n  // do it for all highlight pixel based on the centroid occlusion. This\n  // is a temporary solution for:\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\n  if (voccluded == 1.0) {\n    gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n  } else {\n    gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n  }\n#else\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n#endif\n}\n","hud.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n#include <util/hud.glsl>\n#include <util/visualVariables.glsl>\n#include <util/slice.glsl>\n\nuniform vec2 screenOffset;\nuniform vec2 anchorPos;\n\n// textureCoordinateScaleFactor can be used when there is a uniform texture scaling per material.\n// This is used in the case where we enforce a POT texture (for mipmaps) and the effective\n// texture is only in a subregion of the full POT texture.\nuniform vec2 textureCoordinateScaleFactor;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\nuniform vec4 screenSizePerspective;\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\nvarying vec3 debugBorderCoords;\n#endif\n\nattribute vec2 uv0;\nattribute vec4 color;\nattribute vec2 size;\nattribute vec4 auxpos2;\n\nvarying vec4 vcolor;\n\nvarying vec2 vtc;\nvarying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvarying float voccluded;\n#endif\n\nvoid main(void) {\n  ProjectHUDAux projectAux;\n  vec4 posProj = projectPositionHUD(projectAux);\n\n  if (rejectBySlice(projectAux.posModel)) {\n    // Project outside of clip plane\n    gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    return;\n  }\n\n  vec2 inputSize;\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n\n  vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n\n#else\n\n  inputSize = size;\n\n  vec2 screenOffsetScaled = screenOffset;\n#endif\n\n#ifdef VV_SIZE\n  // only use width (.xx) for proportional scaling\n  // (if no width was defined in vv, width\n  //  will be a copy of height vv)\n  inputSize *= vvGetScale(auxpos2).xx;\n#endif\n\n  vec2 combinedSize = inputSize * pixelRatio;\n  vec4 quadOffset = vec4(0.0);\n\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\n  bool visible = testVisibilityHUD(posProj);\n#endif\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvoccluded = visible ? 0.0 : 1.0;\n#endif\n\n#ifdef OCCL_TEST\n  if (visible) {\n#endif\n    // UV goes from 0 to 1.99999, where the integer part is used\n    // for the normalized vertex coordinates, and the fractional\n    // part is used for texture sampling\n    vec2 uv01 = floor(uv0);\n    vec2 uv = uv0 - uv01;\n\n    // Displace icon based on anchor position (normalized for size) and\n    // absolute screen offset. anchorPos is [-0.5, 0.5]\n    quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n\n#ifdef SIGNED_DISTANCE_FIELD\n\n    // SDF primitives might be scaled so that the SDF texture resolution does\n    // not match the resolution of the canvas, but we still want to render\n    // outline-only ('cross' and 'x') primitives cleanly. Aligning to a screen\n    // pixel border at the geometry center achieves this, since SDF textures\n    // always have power of 2 dimensions.\n    posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\n#else\n    posProj += quadOffset;\n\n    // Aligning vertex positions to the nearest (using 'floor') screen pixel\n    // border renders textures with pixel-perfect results. If the texture\n    // resolution does not match the canvas resolution then aligning is\n    // redundant.\n    if (inputSize.x == size.x) {\n      posProj = alignToPixelOrigin(posProj, viewport.zw);\n    }\n#endif\n\n    gl_Position = posProj;\n\n    vtc = uv * textureCoordinateScaleFactor;\n\n#ifdef DEBUG_DRAW_BORDER\n    debugBorderCoords = vec3(uv01, 1.0 / combinedSize);\n#endif\n\n    vsize = inputSize;\n#ifdef OCCL_TEST\n  } else {\n    vtc = vec2(.0);\n\n#ifdef DEBUG_DRAW_BORDER\n    debugBorderCoords = vec3(0.0);\n#endif\n\n  }\n#endif\n\n  gl_Position = posProj;\n\n#ifdef VV_COLOR\n  vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors);\n#else\n  vcolor = color / 255.0;\n#endif\n}\n","hudHeader.glsl":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/color.glsl>\n\nuniform sampler2D tex;\nuniform vec4 overrideColor;\nuniform vec4 outlineColor;\nuniform float outlineSize;\n\nvarying vec4 vcolor;\n\nvarying vec2 vtc;\nvarying vec2 vsize;\n\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\nvarying float voccluded;\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\nvarying vec3 debugBorderCoords;\n#endif\n","hudMain.glsl":"#ifdef SIGNED_DISTANCE_FIELD\n  vec4 color = vec4(0.0, 0.0, 0.0, 0.0);\n  vec4 fillPixelColor = overrideColor * vcolor;\n\n  // Attempt to sample texel centers to avoid that thin cross outlines\n  // disappear with large symbol sizes.\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n  const float txSize = 128.0;\n  const float texelSize = 1.0 / txSize;\n  // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n  vec2 scaleFactor = (vsize - txSize) * texelSize;\n  vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n  // Get distance and map it into [-0.5, 0.5]\n  float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n  // Distance in output units (i.e. pixels)\n  float dist = d * vsize.x;\n\n  // Create smooth transition from the icon into its outline\n  fillPixelColor.a *= clamp(0.5 - dist, 0.0, 1.0);\n\n  if (outlineSize > 0.25) {\n    vec4 outlinePixelColor = outlineColor;\n    float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n    // Create smooth transition around outline\n    outlinePixelColor.a *= clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n\n    // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n    float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n    vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n      vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n    gl_FragColor = vec4(compositeColor, compositeAlpha);\n  }\n  else {\n    gl_FragColor = premultiplyAlpha(fillPixelColor);\n  }\n\n  // visualize SDF:\n  // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n#else\n\n  // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\n  // fragment color. Input textures should already be pre-multiplied and so\n  // don't require adjustment, but the override and vertex colors must be\n  // modulated by their alpha values.\n\n  gl_FragColor = texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);\n\n#endif\n\n#ifdef DEBUG_DRAW_BORDER\n   float isBorder = float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\n   gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);\n#endif\n\n  if (gl_FragColor.a < 0.1) {\n    discard;\n  }\n","occlusionTest.frag":"#include <util/fsPrecision.glsl>\n\nuniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n","occlusionTest.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n#include <util/hud.glsl>\n#include <util/slice.glsl>\n\nvoid main(void) {\n  vec4 posProjCenter;\n\n  // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\n  // are removed before the VBO is recompacted. If this is the case, then we just project outside\n  // of clip space.\n  if (dot(position, position) > 0.0) {\n    // Render single point to center of the pixel to avoid subpixel filtering to affect\n    // the marker color\n    ProjectHUDAux projectAux;\n    vec4 posProj = projectPositionHUD(projectAux);\n    posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n    vec3 vpos = projectAux.posModel;\n    if (rejectBySlice(vpos)) {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n  }\n  else {\n    // Project out of clip space\n    posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n  }\n\n  gl_Position = posProjCenter;\n  gl_PointSize = 1.0;\n}\n"},lineCallout:{"lineCallout.frag":"#include <util/fsPrecision.glsl>\n\nuniform vec4 color;\nuniform vec4 borderColor;\n\nvarying vec4 coverageSampling;\nvarying vec2 lineSizes;\n\nvoid main() {\n  // Mix between line and border coverage offsets depending on whether we need\n  // a border (based on the sidedness).\n  vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n  // Mix between border and line color based on the line coverage (conceptually the line\n  // blends on top of the border background).\n  //\n  // Anti-alias by blending final result using the full (including optional border) coverage\n  // and the color alpha\n  float borderAlpha = color.a * borderColor.a * coverage.y;\n  float colorAlpha = color.a * coverage.x;\n\n  float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);\n\n#ifdef DEPTH_HUD\n\n  if (finalAlpha < 0.01) {\n    discard;\n  }\n\n#else\n\n  // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n  // need to divide by finalAlpha). We avoid the division here by setting the\n  // appropriate blending function in the material.\n  vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n\n  gl_FragColor = vec4(finalRgb, finalAlpha);\n\n#endif\n\n}\n","lineCallout.vert":"#include <util/vsPrecision.glsl>\n#include <util/alignPixel.glsl>\n#include <util/hud.glsl>\n#include <util/slice.glsl>\n\nattribute vec2 uv0;\n\nuniform float lineSize;\nuniform vec2 pixelToNDC;\nuniform float borderSize;\nuniform vec2 screenOffset;\n\nvarying vec4 coverageSampling;\nvarying vec2 lineSizes;\n\nvoid main(void) {\n\n  ProjectHUDAux projectAux;\n  vec4 endPoint = projectPositionHUD(projectAux);\n\n  vec3 vpos = projectAux.posModel;\n  if (rejectBySlice(vpos)) {\n    gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n    return;\n  }\n\n#ifdef OCCL_TEST\n  if (!testVisibilityHUD(endPoint)) {\n    gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n    return;\n  }\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n  vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n#else\n  vec2 screenOffsetScaled = screenOffset;\n#endif\n\n  // Add view dependent polygon offset to get exact same original starting point. This is mostly\n  // used to get the correct depth value\n  vec3 posView = (view * (model * vec4(position, 1.0))).xyz;\n  applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n\n  vec4 startPoint = proj * vec4(posView, 1.0);\n\n  // Apply screen offset to both start and end point\n  vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;\n\n  startPoint.xy += screenOffsetNorm * startPoint.w;\n  endPoint.xy += screenOffsetNorm * endPoint.w;\n\n  // Align start and end to pixel origin\n  vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);\n  vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);\n\n#ifdef DEPTH_HUD\n\n#ifdef DEPTH_HUD_ALIGN_START\n  endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\n#else\n  startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\n#endif\n\n#endif\n\n  vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);\n\n  // The direction of the line in screen space\n  vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n  vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n  float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n  float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n\n#else\n\n  float lineSizeScaled = lineSize;\n  float borderSizeScaled = borderSize;\n\n#endif\n\n  float halfPixelSize = lineSizeScaled * 0.5;\n  // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n  // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n  // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n  // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n  float halfWholePixelSize = floor(lineSizeScaled) * 0.5;\n  float halfPixelSizeInt = floor(halfWholePixelSize);\n\n  // Sub-pixel offset if we need to grow sub-pixels to the left\n  float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);\n\n  // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n  float pixelOffset = -halfPixelSizeInt + subpixelOffset;\n\n  // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n  float padding = 1.0 + borderSizeScaled;\n  vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n  // Offset x/y from the center of the line in screen space\n  projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n  // Compute a coverage varying which we can use in the fragment shader to determine\n  // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n  // This works by computing two coordinates that can be linearly interpolated and then\n  // subtracted to find out how far away from the line edge we are.\n  float edgeDirection = (uv0.x * 2.0 - 1.0);\n\n  float halfBorderSize = 0.5 * borderSizeScaled;\n  float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;\n  float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n  float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);\n\n  coverageSampling = vec4(\n    // Edge coordinate\n    outerEdgeCoverageSampler,\n\n    // Border edge coordinate\n    outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n    // Line offset\n    halfPixelSize - 0.5,\n\n    // Border offset\n    halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n  );\n\n  lineSizes = vec2(lineSizeScaled, borderSizeScaled);\n\n  gl_Position = projectedPosition;\n}\n"},measurementArrow:{"measurementArrow.frag":"#include <util/fsPrecision.glsl>\n\nuniform float outlineSize;\nuniform vec4 outlineColor;\nuniform float stripeLength;\nuniform vec4 stripeEvenColor;\nuniform vec4 stripeOddColor;\n\nvarying vec2 vtc;\nvarying float vlength;\nvarying float vradius;\n\n#define INV_SQRT2 (1.0 / sqrt(2.0))\n\nvec4 arrowColor(vec2 tc, float len) {\n  float d = INV_SQRT2 * (tc.x - abs(tc.y));\n  d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n  d = min(d, 1.0 - abs(tc.y));\n\n  if (d < 0.0) {\n    return vec4(0.0);\n  } else if (d < outlineSize) {\n    return outlineColor;\n  } else {\n    return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n  }\n}\n\nvoid main(void) {\n  vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n  vec4 color = arrowColor(ntc, vlength / vradius);\n  if (color.a == 0.0) {\n    discard;\n  }\n  gl_FragColor = color;\n}\n","measurementArrow.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nuniform float width;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv0;\nattribute float auxpos1;\n\nvarying vec2 vtc;\nvarying float vlength;\nvarying float vradius;\n\nvoid main(void) {\n  vec3 bitangent = normal;\n\n  vtc = uv0;\n  vlength = auxpos1;\n  vradius = 0.5 * width;\n\n  vec4 pos = view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\n  gl_Position = proj * pos;\n}\n"},nativeLine:{"colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nuniform vec4 constantColor;\n\nvarying vec3 vpos;\n\n#ifdef VERTEXCOLORS\nvarying vec4 vcolor;\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n#ifdef VERTEXCOLORS\n  gl_FragColor = highlightSlice(vcolor, vpos);\n#else\n  gl_FragColor = highlightSlice(constantColor, vpos);\n#endif\n}\n","highlightPass.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/highlight.glsl>\n\nvarying vec3 vpos;\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\nvoid main() {\n  discardBySlice(vpos);\n\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}\n","nativeLine.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\n\n#ifdef VERTEXCOLORS\nattribute vec4 color;\n#endif\n\n\nvarying vec3 vpos;\n\n#ifdef VERTEXCOLORS\nvarying vec4 vcolor;\n#endif\n\n\nvoid main(void) {\n  vpos = (model * vec4(position, 1.0)).xyz;\n  #ifdef VERTEXCOLORS\n    vcolor = color * 0.003921568627451; // = 1/255\n  #endif\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n}\n"},pathMaterial:{"colorMixMode.glsl":"#include <util/color.glsl>\n\n/*\n * The color mix modes are encoded in the symbol color as follows:\n *  - Fully transparent symbols are represented with alpha 0 for\n *    all color mix modes (except ignore).\n *  - color mix mode ignore is encoded as multiply with white\n *  - the other 3 color mix modes (tint, replace, multiply) are\n *    equally distributed on the remaining 255 alpha values, which\n *    gives us 85 possible alpha values\n *\n * alpha             0 : fully transparent\n * alpha in [  1 -  85]: tint\n * alpha in [ 86 - 170]: replace\n * alpha in [171 - 255]: multiply\n */\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n  float symbolAlpha = 0.0;\n\n  const float maxTint = 85.0;\n  const float maxReplace = 170.0;\n  const float scaleAlpha = 3.0;\n\n  if (symbolColor.a == 0.0) {\n    colorMixMode = 1; // fully transparent -> multiply\n    symbolAlpha = 0.0;\n  }\n  else if (symbolColor.a <= maxTint) {\n    colorMixMode = 0; // tint\n    symbolAlpha = scaleAlpha * symbolColor.a;\n  }\n  else if (symbolColor.a <= maxReplace) {\n    colorMixMode = 3; // replace\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n  }\n  else {\n    colorMixMode = 1;  // multiply\n    symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n  }\n\n  return vec4(symbolColor.rgb, symbolAlpha);\n}\n\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  vec3 internalMixed = internalColor * textureColor;\n  vec3 allMixed = internalMixed * externalColor;\n\n  if (mode == 1 /* multiply */) {\n    return allMixed;\n  }\n  else if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalColor;\n  }\n  else {\n    // tint (or something invalid)\n    vec3 hsvIn = rgb2hsv(internalMixed);\n    vec3 hsvTint = rgb2hsv(externalColor);\n    vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\n    return hsv2rgb(hsvOut);\n  }\n}\n\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n\n  // workaround for artifacts in OSX using Intel Iris Pro\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n  float internalMixed = internalOpacity * textureOpacity;\n  float allMixed = internalMixed * externalOpacity;\n\n  if (mode == 2 /* ignore */ ) {\n    return internalMixed;\n  }\n  else if (mode == 3 /* replace */ ) {\n    return externalOpacity;\n  }\n  else {\n    // multiply or tint (or something invalid)\n    return allMixed;\n  }\n}\n","colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/sceneLighting.glsl>\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n\n// material parameters\n//////////////////////////////////////////\nuniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float opacity;\nuniform float layerOpacity;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#else\nuniform int colorMixMode;\n#endif\n\n#ifdef RECEIVE_SHADOWS\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\n#endif\n\n#ifdef RECEIVE_SSAO\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\n#endif\n\nvarying vec3 vpos;\nvarying vec3 vnormal;\n// the vertex color variable will contain vvColor and/or vvOpacity or 1,1,1,1\nvarying vec4 vcolor; \nvarying vec4 vcolorExt;\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#include <util/shadow.glsl>\n#endif\n\n#ifdef TEXTURING\n#include <materials/pathMaterial/texturing.glsl>\n#endif\n\n#include <materials/pathMaterial/colorMixMode.glsl>\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  vec4 texColor = textureLookup(tex, vtc);\n  if (texColor.a < ALPHA_THRESHOLD) {\n    discard;\n  }\n#else /* TEXTURING */\n  vec4 texColor = vec4(1.0);\n#endif /* TEXTURING */\n\n  vec3 viewDir = vpos - camPos;\n\n  // compute normal\n  // TODO: this is not in sync with the normal pass\n#ifdef GROUND_NORMAL_SHADING\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n  vec3 normal = normalize(vpos + localOrigin);\n#else\n  vec3 normal = vec3(0.0, 0.0, 1.0);\n#endif\n#else\n#ifdef DOUBLESIDED\n  vec3 normal = dot(vnormal, viewDir)>0.0 ? -vnormal : vnormal;\n#elif defined(WINDINGORDERDOUBLESIDED)\n  vec3 normal = gl_FrontFacing ? vnormal : -vnormal;\n#else\n  vec3 normal = vnormal;\n#endif\n  normal = normalize(normal);\n#endif\n\n  // compute ssao\n#ifdef RECEIVE_SSAO\n  float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n  ssao = viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n#else\n  float ssao = 1.0;\n#endif\n\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\n  float additionalAmbientScale;\n  vec3 additionalLight = sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\n\n  // compute shadowing\n  float shadow = 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow = evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#elif VIEWING_MODE == VIEWING_MODE_GLOBAL\n  // at global scale (and in global scenes) we fall back to this approximation\n  // to shadow objects on the dark side of the earth\n  shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);\n#endif\n\n  vec3 matColor = max(ambient, diffuse); // combine the old material parameters into a single one\n\n  vec3 albedo_ = mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n  float opacity_ = layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n  albedo_+= 0.25 * specular; // don't completely ignore specular for now\n\n#ifdef TRANSPARENCY_DISCARD\n  if (opacity_ < 0.001) {\n    discard;\n  }\n#endif\n\n  vec3 shadedColor = evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\n  gl_FragColor = vec4(shadedColor, opacity_);\n  gl_FragColor = highlightSlice(gl_FragColor, vpos);\n}\n","colorPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/pathMaterial/commonInputs.glsl>\n\nattribute vec3 position;\nattribute vec4 auxpos1; // direction offset\n#ifdef COMPRESSED_NORMALS\nattribute vec2 normalCompressed;\n#else\nattribute vec3 normal;\n#endif\nvarying vec3 vpos;\nvarying vec3 vnormal;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#ifdef COMPONENTCOLORS\nuniform sampler2D uComponentColorTex;\nuniform vec2 uComponentColorTexInvDim;\n\nattribute float componentIndex;\n\nvec4 readComponentColor() {\n  float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n  vec2 indexCoord = vec2(\n    mod(normalizedIndex, 1.0),\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n  );\n  return texture2D(uComponentColorTex, indexCoord);\n}\n#endif\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n\n#ifdef SYMBOLVERTEXCOLORS\nattribute vec4 symbolColor;\n#endif\n\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\n// This should be further cleaned up later with through the following issue:\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\nuniform vec4 externalColor;\n// the vertex color variable will contain vvColor and/or vvOpacity or 1,1,1,1\nvarying vec4 vcolor;\nvarying vec4 vcolorExt;\n\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\n#endif\n\n#include <materials/pathMaterial/visualVariables.glsl>\n\n#if defined(VV_SIZE) || defined(VV_COLOR) || defined(VV_OPACITY)\nattribute vec4 auxpos2;\n#endif\n\n#include <materials/pathMaterial/commonFunctions.glsl>\n#include <materials/pathMaterial/localNormal.glsl>\n#include <materials/pathMaterial/colorMixMode.glsl>\n\nvoid main() {\n  vpos = calculateVPos();\n\n  vnormal = normalize((modelNormal * localNormal()).xyz);\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\n  // issues on iPad/iPhone with the 'w' component require the depth to be\n  // passed as varying to properly drive the cascading shadow map index.\n  linearDepth = gl_Position.w;\n#endif\n\n  vcolorExt = externalColor;\n\n  vcolor = vec4(1.0, 1.0, 1.0, 1.0);\n#ifdef VV_COLOR\n  vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors);\n#endif\n#ifdef VV_OPACITY\n  // there might be opacity values in vvColor but according to the logic in graphicUtils.mixinColorAndOpacity,\n  // this value will be overridden by vvOpacity so we do the same here\n  vcolor.a = vvGetOpacity(auxpos2, vvOpacityValues, vvOpacityOpacities);\n#endif\n\n\n#ifdef SYMBOLVERTEXCOLORS\n  int symbolColorMixMode;\n  vcolorExt *= decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n  colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n\n#ifdef COMPONENTCOLORS\n  int symbolColorMixMode;\n  vcolorExt *= decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // = 1/255;\n  colorMixMode = float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n#endif\n\n#ifdef TEXTURING\n  // the v coordinate is stored in auxpos1.w\n#ifndef FLIPV\n  vtc = vec2(uv0.x, auxpos1.w);\n#else\n  vtc = vec2(uv0.x, 1.0-auxpos1.w);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","commonFunctions.glsl":"#include <materials/pathMaterial/localPosition.glsl>\n#include <util/doublePrecision.glsl>\n\nvec3 calculateVPos() {\n  return (model * localPosition()).xyz;\n}","commonInputs.glsl":"uniform mat4 proj;\nuniform mat4 view;\n\nuniform vec3 camPos;\nuniform vec3 localOrigin;\n\nuniform mat4 model;\nuniform mat4 modelNormal;\n\nuniform float size;\n\n// ---------------------------------------------- ++","depthPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/depth.glsl>\n#include <util/slice.glsl>\n\nvarying float depth;\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\n#ifdef TEXTURING\n#include <materials/pathMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  if (textureLookup(tex, vtc).a < ALPHA_THRESHOLD) {\n    discard;\n  }\n#endif\n\n#ifndef BIAS_SHADOWMAP\n  gl_FragColor = float2rgba(depth);\n#else\n  gl_FragColor = float2rgba(calcFragDepth(depth));\n#endif\n}\n","depthPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/pathMaterial/commonInputs.glsl>\n\nuniform vec2 nearFar;\nattribute vec3 position;\nattribute vec4 auxpos1; // direction offset\n\nvarying float depth;\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#include <materials/pathMaterial/visualVariables.glsl>\n\n#if defined(VV_SIZE)\nattribute vec4 auxpos2;\n#endif\n\n#include <materials/pathMaterial/commonFunctions.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n  vec4 eye = view * vec4(vpos, 1.0);\n\n  gl_Position = proj * eye;\n  depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","highlightPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n#include <util/highlight.glsl>\n\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\n#ifdef TEXTURING\n#include <materials/pathMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  if (textureLookup(tex, vtc).a < ALPHA_THRESHOLD) {\n    discard;\n  }\n#endif\n\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}\n","highlightPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/pathMaterial/commonInputs.glsl>\n\nattribute vec3 position;\nattribute vec4 auxpos1; // direction offset\n\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\n#include <materials/pathMaterial/visualVariables.glsl>\n\n#if defined(VV_SIZE)\nattribute vec4 auxpos2;\n#endif\n\n#include <materials/pathMaterial/commonFunctions.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","localNormal.glsl":"#include <util/normalEncoding.glsl>\n\n# ifdef COMPRESSED_NORMALS\nvec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\n# else\nvec4 localNormal() { return vec4(normal, 1.0); }\n# endif\n","localPosition.glsl":"#ifdef VV_SIZE\nvec4 localPosition() {\n    vec3 sizeScale = vvGetScale(auxpos2);\n    vec3 positionOffset = auxpos1.xyz*sizeScale;\n    return vec4( position+positionOffset, 1.0 );\n}\n#else\nvec4 localPosition() {\n    vec3 sizeScale = vec3(size);\n    vec3 positionOffset = auxpos1.xyz*sizeScale;\n    return vec4(position+positionOffset, 1.0);\n}\n#endif\n","normalPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\n#ifdef TEXTURING\nuniform sampler2D tex;\nuniform vec2 texSize;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nvarying vec4 regionV;\n#endif\n#endif\n\n#ifdef TEXTURING\n#include <materials/pathMaterial/texturing.glsl>\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef TEXTURING\n  if (textureLookup(tex, vtc).a < ALPHA_THRESHOLD) {\n    discard;\n  }\n#endif\n\n  vec3 normal = normalize(vnormal);\n  if (gl_FrontFacing == false) normal = -normal;\n\n#ifndef ALPHA_ZERO\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n}\n","normalPass.vert":"#include <util/vsPrecision.glsl>\n\n#include <materials/pathMaterial/commonInputs.glsl>\n\nuniform mat4 viewNormal;\nattribute vec3 position;\nattribute vec4 auxpos1; // direction offset\n#ifdef COMPRESSED_NORMALS\nattribute vec2 normalCompressed;\n#else\nattribute vec3 normal;\n#endif\n\n#ifdef TEXTURING\nattribute vec2 uv0;\nvarying vec2 vtc;\n#ifdef TEXTURE_ATLAS\nattribute vec4 region;\nvarying vec4 regionV;\n#endif\n#endif\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\n#include <materials/pathMaterial/visualVariables.glsl>\n\n#if defined(VV_SIZE)\nattribute vec4 auxpos2;\n#endif\n\n#include <materials/pathMaterial/commonFunctions.glsl>\n#include <materials/pathMaterial/localNormal.glsl>\n\nvoid main(void) {\n  vpos = calculateVPos();\n\n  vnormal = normalize((viewNormal * modelNormal * localNormal()).xyz);\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef TEXTURING\n#ifndef FLIPV\n  vtc = uv0;\n#else\n  vtc = vec2(uv0.x, 1.0-uv0.y);\n#endif\n#ifdef TEXTURE_ATLAS\n  regionV = region;\n#endif\n#endif /* TEXTURING */\n\n}\n","texturing.glsl":"float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n  // from:\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\n  //   - http://www.linedef.com/virtual-texture-demo.html\n  float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\n}\n\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\n  //[umin, vmin, umax, vmax]\n  vec2 atlasScale = region.zw - region.xy;\n  vec2 uvAtlas = fract(uv) * atlasScale + region.xy;\n\n  // calculate derivative of continuous texture coordinate\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\n  vec2 dUVdx = dFdx(uv) * atlasScale;\n  vec2 dUVdy = dFdy(uv) * atlasScale;\n\n#ifdef GL_EXT_shader_texture_lod\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\n#else\n  // use bias to compensate for difference in automatic vs desired mipmap level\n  vec2 dUVdxAuto = dFdx(uvAtlas);\n  vec2 dUVdyAuto = dFdy(uvAtlas);\n  float mipMapLevel = calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\n  float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\n\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\n#endif\n}\n\nvec4 textureLookup(sampler2D tex, vec2 uv) {\n#ifdef TEXTURE_ATLAS\n  return textureAtlasLookup(tex, uv, regionV, texSize);\n#else\n  return texture2D(tex, uv);\n#endif\n}\n\n","visualVariables.glsl":"\n#if defined(VV_SIZE)\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n\n  vec3 vvGetScale(vec4 featureAttribute) {\n    // the 0.5 factor comes from the fact that the generated profiles have radius of 1\n    // but the old implementation of the Graphics3DPathSymbolLayer actually had a profile radius of 0.5\n    // for constant size values the 0.5 is applied in Graphcis3DPathSymbolLayer when setting material parms\n    // we might want to change the path geometry generation so that it produces profile radius of 0.5 too\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize)*0.5;\n  }\n#endif\n\n#ifdef VV_COLOR\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n    float value = featureAttribute.y;\n    if (value <= values[0]) {\n      return colors[0];\n    }\n\n    for (int i = 1; i < VV_COLOR_N; ++i) {\n      if (values[i] >= value) {\n        float f = (value - values[i-1]) / (values[i] - values[i-1]);\n        return mix(colors[i-1], colors[i], f);\n      }\n    }\n\n    return colors[VV_COLOR_N - 1];\n  }\n#endif\n\n\n#ifdef VV_OPACITY\n  #define VV_OPACITY_N 8\n  uniform float vvOpacityValues[VV_OPACITY_N];\n  uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n  float vvGetOpacity(vec4 featureAttribute, float values[VV_OPACITY_N], float opacities[VV_OPACITY_N]) {\n    float value = featureAttribute.z;\n    if (value <= values[0]) {\n      return opacities[0];\n    }\n\n    for (int i = 1; i < VV_OPACITY_N; ++i) {\n      if (values[i] >= value) {\n        float f = (value - values[i-1]) / (values[i] - values[i-1]);\n        return mix(opacities[i-1], opacities[i], f);\n      }\n    }\n\n    return opacities[VV_OPACITY_N - 1];\n  }\n#endif\n\n"},ribbonLine:{"colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nuniform vec4 eColor;\nvarying vec4 vColor;\nvarying vec2 vtc;\nvarying vec3 vpos;\n\n#ifdef STIPPLE\nuniform float stippleLengthDoubleInv;\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef STIPPLE\n  if (fract(vtc.x * stippleLengthDoubleInv) > 0.5) {\n    discard;\n  }\n#endif\n\n  gl_FragColor = highlightSlice(eColor * vColor, vpos);\n}\n","highlightPass.frag":"#include <util/fsPrecision.glsl>\n#include <util/slice.glsl>\n\nvarying vec2 vtc;\nvarying vec3 vpos;\n\n#ifdef STIPPLE\nuniform float stippleLengthDoubleInv;\n#endif\n\nvoid main() {\n  discardBySlice(vpos);\n\n#ifdef STIPPLE\n  if (fract(vtc.x * stippleLengthDoubleInv) > 0.5) {\n    discard;\n  }\n#endif\n\n  gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}\n","ribbonLine.vert":'#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nuniform float extLineWidth;\nuniform float nearPlane;\nuniform float pixelRatio;\n\nattribute vec3 position;\nattribute vec2 uv0;\nattribute vec4 color;\n\nvarying vec2 vtc;\nvarying vec4 vColor;\nvarying vec3 vpos;\n\nattribute float size;\n\n#ifndef WALL\nuniform float miterLimit;\nattribute vec3 auxpos1;\nattribute vec3 auxpos2;\n#endif\n\n#ifdef SCREENSCALE\nuniform vec2 screenSize;\n\nvec4 toScreenCoords(vec3 vertex) {\n  vec4 vClipSpace = proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\n  vClipSpace.xy *= screenSize;\n  return vClipSpace/abs(vClipSpace.w);\n}\n\n#define VECTYPE vec2\n#define ZEROVEC vec2(0.0, 0.0)\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0\n\n#else //ifdef SCREENSCALE\n\n#define VECTYPE vec3\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\n// these macros are only valid for "strip" type lines:\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*uv0.y < 0.0\n\n#endif //ifdef SCREENSCALE\n\nfloat interp(float ncp, vec4 a, vec4 b) {\n  return (-ncp - a.z) / (b.z - a.z);\n}\n\n#ifdef SCREENSCALE\n\nvoid clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\n  float vnp = nearPlane*0.99;\n\n  //We have four vertices per point on the line. Start and end vertices\n  //are treated differently --\x3e d > 0, d < 0\n  float d = abs(uv0.y) - 1.1;\n\n  //current pos behind ncp --\x3e we need to clip\n  if(pos.z > -nearPlane) {\n    if (d < 0.0) {\n      //previous in front of ncp\n      if(prev.z < -nearPlane) {\n        pos = mix(prev, pos, interp(vnp, prev, pos));\n        next = pos;\n      } else {\n        pos = vec4(0.0, 0.0, 0.0, 1.0);\n      }\n    }\n    //next in front of ncp\n    if(d > 0.0) {\n      if(next.z < -nearPlane) {\n        pos = mix(pos, next, interp(vnp, pos, next));\n        prev = pos;\n      } else {\n        pos = vec4(0.0, 0.0, 0.0, 1.0);\n      }\n    }\n  } else {\n    //current position visible\n    //previous behind ncp\n    if (prev.z > -nearPlane) {\n      prev = mix(pos, prev, interp(vnp, pos, prev));\n    }\n    //next behind ncp\n    if (next.z > -nearPlane) {\n      next = mix(next, pos, interp(vnp, next, pos));\n    }\n  }\n\n  pos= proj * pos;\n  pos.xy *= screenSize;\n  pos /= pos.w;\n\n  next = proj * next;\n  next.xy *= screenSize;\n  next /= next.w;\n\n  prev = proj * prev;\n  prev.xy *= screenSize;\n  prev /= prev.w;\n}\n\n#endif // SCREENSCALE\n\nvoid main(void) {\n  vpos = (model * vec4(position, 1.0)).xyz;\n\n#ifdef SCREENSCALE\n// Check for special value of uv0.y which is used by the Renderer when graphics\n// are removed before the VBO is recompacted. If this is the case, then we just\n// project outside of clip space.\nif (uv0.y == 0.0) {\n  // Project out of clip space\n  gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n}\nelse {\n#endif\n\nfloat lineWidth = (extLineWidth + size) * pixelRatio;\n\n#ifdef SCREENSCALE\n\n#if 0\n  vec4 pos = toScreenCoords(position.xyz);\n  vec2 left = (pos - toScreenCoords(auxpos1)).xy;\n  vec2 right = (toScreenCoords(auxpos2) - pos).xy;\n#else\n  vec4 pos  = view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\n  vec4 prev = view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\n  vec4 next = view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\n\n  clipAndTransform(pos, prev, next);\n\n  vec2 left = (pos - prev).xy;\n  vec2 right = (next - pos).xy;\n#endif\n\n#else // ifdef SCREENSCALE\n  vec4 pos = vec4(position, 1.0);\n#ifndef WALL\n  vec3 left = position.xyz - auxpos1;\n  vec3 right = auxpos2 - position.xyz;\n  vec3 up = normalize(position.xyz);\n#endif // ifndef WALL\n#endif // ifdef SCREENSCALE\n\n#ifdef WALL\n  float displacementLen = lineWidth;\n  vec3 displacementDir = normalize(position.xyz);//vec3(0.0, 1.0, 0.0);\n#else // ifdef WALL\n\n  float leftLen = length(left);\n  left = (leftLen > 0.001) ? left/leftLen : ZEROVEC;\n\n  float rightLen = length(right);\n  right = (rightLen > 0.001) ? right/rightLen : ZEROVEC;\n\n  // determine if vertex is on the "outside or "inside" of the join\n  bool isOutside = ISOUTSIDE;\n\n  // compute miter join position first\n  float displacementLen = lineWidth;\n  VECTYPE displacementDir = normalize(left + right);\n  displacementDir = PERPENDICULAR(displacementDir);\n  if (leftLen > 0.001 && rightLen > 0.001) {\n    float nDotSeg = dot(displacementDir, left);\n    displacementLen /= length(nDotSeg*left - displacementDir);\n\n    // limit displacement of inner vertices\n    if (!isOutside) {\n      displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n    }\n  }\n\n  if (isOutside && (displacementLen > miterLimit*lineWidth)) {\n    // convert to bevel join if miterLimit is exceeded\n    if (leftLen < 0.001) {\n      displacementDir = right;\n    }\n    else if (rightLen < 0.001) {\n      displacementDir = left;\n    }\n    else {\n      displacementDir = (abs(uv0.y) - 1.1 < 0.0) ? left : right;\n    }\n    displacementDir = normalize(displacementDir);\n    displacementDir = PERPENDICULAR(displacementDir);\n    displacementLen = lineWidth;\n  }\n\n#endif // ifdef WALL\n\n#ifdef SCREENSCALE\n  pos.xy += displacementDir * floor(uv0.y + 0.5) * displacementLen;\n  pos.xy /= screenSize;\n#else\n  pos.xyz += displacementDir * floor(uv0.y + 0.5) * displacementLen;\n  pos = proj * view * model * pos;\n#endif\n\n  vtc = uv0;\n  vColor = color * 0.003921568627451; // = 1/255\n  gl_Position = pos;\n\n#ifdef SCREENSCALE\n  }\n#endif\n}\n'},slicePlane:{"slicePlane.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n\nuniform vec4 backgroundColor;\nuniform vec4 gridColor;\nuniform float ratio;\nuniform float gridWidth;\n\nvarying vec2 vUV;\n\nvoid main() {\n  const float LINE_WIDTH = 1.0;\n\n  vec2 uvScaled = vUV * gridWidth;\n  vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\n  vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\n\n  // mask aliasing along edges\n  grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\n  grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\n\n  float gridFade = max(grid.x, grid.y);\n\n  float gridAlpha = gridColor.a * gridFade;\n\n  // premultiply alpha in output\n  gl_FragColor =\n    vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\n    vec4(gridColor.rgb, 1.0) * gridAlpha;\n}\n","slicePlane.vert":"#include <util/vsPrecision.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 model;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec2 vUV;\n\nvoid main(void) {\n  vUV = uv0;\n  gl_Position = proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n}\n"}},misc:{"blendLayers.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec2 uv;\n\nuniform sampler2D tex;\nuniform float opacity;\n\nvoid main() {\n  vec4 color = texture2D(tex, uv);\n\n  // Note: output in pre-multiplied alpha for correct alpha compositing\n  gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;\n}\n","blendLayers.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nuniform float scale;\nuniform vec2 offset;\n\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(position, 1.0);\n  uv = uv0 * scale + offset;;\n}\n","texOnly.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\nuniform vec4 color;\nvarying vec2 vtc;\n\nvoid main() {\n  vec4 texColor = texture2D(tex, vtc);\n  gl_FragColor = texColor * color;\n}\n","texOnly.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec2 vtc;\n\nvoid main(void) {\n  gl_Position = vec4(position, 1.0);\n  vtc = uv0;\n}\n"},pointRenderer:{"pointRenderer.frag":"#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n\n#ifdef DEPTH_PASS\nvarying float depth;\n#else\nvarying vec3 vColor;\n#endif\n\nvoid main(void) {\n  vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);\n  float r2 = dot(vOffset, vOffset);\n\n  if (r2 > 0.25) {\n    discard;\n  }\n\n#ifdef DEPTH_PASS\n  gl_FragColor = float2rgba(depth);\n#else\n  gl_FragColor = vec4(vColor, 1.0);\n#endif\n}\n","pointRenderer.vert":"#include <util/slice.glsl>\n#include <util/vsPrecision.glsl>\n\nattribute vec3 aPosition;\nattribute vec3 aColor;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform vec2 uScreenMinMaxSize;\nuniform vec2 uPointScale;\nuniform vec3 uClipMin;\nuniform vec3 uClipMax;\n\n#ifdef DEPTH_PASS\nuniform vec2 nearFar;\n\nvarying float depth;\n#else\nvarying vec3 vColor;\n#endif\n\nvoid main(void) {\n\n  // Move clipped points outside of clipspace\n  if (aPosition.x < uClipMin.x || aPosition.y < uClipMin.y || aPosition.z < uClipMin.z ||\n      aPosition.x > uClipMax.x || aPosition.y > uClipMax.y || aPosition.z > uClipMax.z) {\n    gl_Position = vec4(0.0,0.0,0.0,2.0);\n    gl_PointSize = 0.0;\n    return;\n  }\n\n  if (rejectBySlice(aPosition)) {\n    gl_Position = vec4(0.0,0.0,0.0,2.0);\n    gl_PointSize = 0.0;\n    return;\n  }\n\n  // Position in camera space\n  vec4 camera = uModelViewMatrix * vec4(aPosition, 1.0);\n\n  float pointSize = uPointScale.x;\n  vec4 position = uProjectionMatrix * camera;\n\n  // Calculate Size\n#ifdef DRAW_SCREEN_SIZE\n    float clampedScreenSize = pointSize;\n#else\n    float pointRadius = 0.5 * pointSize;\n    vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);\n    vec4 positionOffset = uProjectionMatrix * cameraOffset;\n    float radius = abs(positionOffset.y - position.y);\n\n    float viewHeight = uPointScale.y;\n\n    // screen diameter = (2 * r / w) * (h / 2)\n    float screenPointSize = (radius / position.w) * viewHeight;\n    float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n\n    // Shift towards camera, to move rendered point out of terrain i.e. to\n    // the camera-facing end of the virtual point when considering it as a\n    // 3D sphere.\n    camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n    position = uProjectionMatrix * camera;\n#endif\n\n  gl_PointSize = clampedScreenSize;\n  gl_Position = position;\n\n#ifdef DEPTH_PASS\n  depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n#else\n  vColor = aColor;\n#endif\n}\n"},renderer:{highlight:{"apply.frag":"#include <util/fsPrecision.glsl>\n\n// ===============================================================================\n// Merging blurred outlines with source image, advanced version\n\n// Defines:\n// GRID_OPTIMIZATION (set or !set)\n// GRID_DEBUG (set or !set)\n// ===============================================================================\n\nuniform sampler2D tex;\nuniform sampler2D origin;\n\nuniform vec4 color;\nuniform float outlineSize;\nuniform float blurSize;\nuniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\n\nvarying vec2 uv;\n\nvoid main() {\n  #if defined(GRID_OPTIMIZATION) && defined(GRID_DEBUG)\n    gl_FragColor = vec4(uv, 0.0, 1.0);\n  #else\n    // Read the highlight intensity from the blurred highlight image\n    vec4 blurredHighlightValue = texture2D(tex, uv);\n    float highlightIntensity = blurredHighlightValue.a;\n\n    // Discard all pixels which are not affected by highlight\n    if (highlightIntensity == 0.0) {\n      discard;\n    }\n\n    vec4 origin_color = texture2D(origin, uv);\n\n    float outlineIntensity;\n    float fillIntensity;\n\n    // if occluded\n    if (blurredHighlightValue.g > blurredHighlightValue.b) {\n      outlineIntensity = color.w * opacities[1];\n      fillIntensity = color.w * opacities[3];\n    }\n    // if unoccluded\n    else {\n      outlineIntensity = color.w * opacities[0];\n      fillIntensity = color.w * opacities[2];\n    }\n\n    float inner = 1.0 - outlineSize / 9.0;\n    float outer = 1.0 - (outlineSize + blurSize) / 9.0;\n\n    float outlineFactor = smoothstep(outer, inner, highlightIntensity);\n    //float fillFactor = smoothstep(0.6, 0.72, highlightIntensity);\n    float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n    float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n    // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    // I.e., color should not be premultiplied with alpha\n    gl_FragColor = vec4(color.xyz, intensity);\n  #endif\n}\n","apply.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nvarying vec2 uv;\n\n#ifdef GRID_OPTIMIZATION\n  attribute vec2 uv0;\n  uniform sampler2D coverageTex;\n#endif\n\nvoid main() {\n  #ifdef GRID_OPTIMIZATION\n    #ifdef GRID_DEBUG\n      vec4 cov = texture2D(coverageTex, uv0);\n      // if no highlight pixel set in this block,\n      // or all pixels set, hide block\n      if (cov.r == 0.0 || cov.g == 1.0 || cov.b == 1.0) {\n        gl_Position = vec4(0.0);\n        return;\n      }\n      gl_Position = vec4(position, .0, 1.0);\n      uv = uv0;\n      return;\n    #else\n      vec4 cov = texture2D(coverageTex, uv0);\n      // if no highlight pixel set in this block, hide block\n      if (cov.r == 0.0) {\n        gl_Position = vec4(0.0);\n        return;\n      }\n    #endif\n  #endif\n\n  gl_Position = vec4(position, .0, 1.0);\n  uv = position.xy * .5 + vec2(.5);\n}\n","blur.frag":"#include <util/fsPrecision.glsl>\n\n// ===============================================================================\n// Gaussian blur with linear sampling. Supports different number of samples, but\n// only 5 samples have proper weights. Uses linear texture interpolation to reduce\n// the number of samples taken.\n\n// Defines:\n// GRID_OPTIMIZATION (set or !set)\n// GAUSSIAN_SAMPLES (3,5,7)\n\n// This technique requires linear filtering on source texture\n// http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\n// ===============================================================================\n\nuniform sampler2D tex;\n\n#ifdef GRID_OPTIMIZATION\n  uniform vec2 blurSize;\n  varying vec3 blurCoordinate;\n#else\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n#endif\n\nvoid main() {\n  #ifdef GRID_OPTIMIZATION\n    vec2 uv = blurCoordinate.xy;\n    vec4 center = texture2D(tex, uv);\n\n    // do not blur if no pixel or all pixels in neighborhood are set\n    if (blurCoordinate.z == 1.0) {\n      gl_FragColor = center;\n    }\n    else {\n      vec4 sum = vec4(0.0);\n\n      #if GAUSSIAN_SAMPLES == 3\n        // not proper gaussian weights\n        sum += center * 0.204164;\n        sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n      #elif GAUSSIAN_SAMPLES == 5\n        sum += center * 0.204164;\n        sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n        sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n      #elif GAUSSIAN_SAMPLES == 7\n        // not proper gaussian weights\n        sum += center * 0.204164;\n        sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n        sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n        sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n        sum += texture2D(tex, uv + blurSize * 5.1) * 0.03;\n        sum += texture2D(tex, uv - blurSize * 5.1) * 0.03;\n      #elif GAUSSIAN_SAMPLES == 9\n        // not proper gaussian weights\n        sum += center * 0.154164;\n        sum += texture2D(tex, uv + blurSize * 1.5) * 0.204005;\n        sum += texture2D(tex, uv - blurSize * 1.5) * 0.204005;\n        sum += texture2D(tex, uv + blurSize * 3.5) * 0.123913;\n        sum += texture2D(tex, uv - blurSize * 3.5) * 0.123913;\n        sum += texture2D(tex, uv + blurSize * 5.5) * 0.123913;\n        sum += texture2D(tex, uv - blurSize * 5.5) * 0.123913;\n        sum += texture2D(tex, uv + blurSize * 7.5) * 0.05;\n        sum += texture2D(tex, uv - blurSize * 7.5) * 0.05;\n      #endif\n\n      gl_FragColor = sum;\n    }\n  #else\n    vec4 sum = vec4(0.0);\n\n    #if GAUSSIAN_SAMPLES == 3\n      // not proper gaussian weights\n      sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n    #elif GAUSSIAN_SAMPLES == 5\n      sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n      sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n    #elif GAUSSIAN_SAMPLES == 7\n      // not proper gaussian weights\n      sum += texture2D(tex, blurCoordinates[0]) * 0.204164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.304005;\n      sum += texture2D(tex, blurCoordinates[3]) * 0.093913;\n      sum += texture2D(tex, blurCoordinates[4]) * 0.093913;\n      sum += texture2D(tex, blurCoordinates[5]) * 0.03;\n      sum += texture2D(tex, blurCoordinates[6]) * 0.03;\n    #elif GAUSSIAN_SAMPLES == 9\n      // not proper gaussian weights\n      sum += texture2D(tex, blurCoordinates[0]) * 0.154164;\n      sum += texture2D(tex, blurCoordinates[1]) * 0.204005;\n      sum += texture2D(tex, blurCoordinates[2]) * 0.204005;\n      sum += texture2D(tex, blurCoordinates[3]) * 0.123913;\n      sum += texture2D(tex, blurCoordinates[4]) * 0.123913;\n      sum += texture2D(tex, blurCoordinates[5]) * 0.09;\n      sum += texture2D(tex, blurCoordinates[6]) * 0.09;\n      sum += texture2D(tex, blurCoordinates[7]) * 0.05;\n      sum += texture2D(tex, blurCoordinates[8]) * 0.05;\n    #endif\n\n    gl_FragColor = sum;\n  #endif\n}\n","blur.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nattribute vec2 uv0;\n\n#ifdef GRID_OPTIMIZATION\n  uniform sampler2D coverageTex;\n  varying vec3 blurCoordinate;\n#else\n  uniform vec2 blurSize;\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\n#endif\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n\n  #ifdef GRID_OPTIMIZATION\n    // sample the coverage texture at the block center\n    // and if no coverage detected, create degenerate triangle\n    vec4 cov = texture2D(coverageTex, uv0);\n    if (cov.r == 0.0) {\n      gl_Position = vec4(0.0);\n    }\n\n    // create texture coordinate for blur center\n    // encode information about fully inside block in z coordinate\n    blurCoordinate = vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\n  #else\n    vec2 uv = position.xy * .5 + vec2(.5);\n\n    #if GAUSSIAN_SAMPLES == 3\n      // not proper gaussian weights\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n    #elif GAUSSIAN_SAMPLES == 5\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n      blurCoordinates[3] = uv + blurSize * 3.294215;\n      blurCoordinates[4] = uv - blurSize * 3.294215;\n    #elif GAUSSIAN_SAMPLES == 7\n      // not proper gaussian weights\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n      blurCoordinates[3] = uv + blurSize * 3.294215;\n      blurCoordinates[4] = uv - blurSize * 3.294215;\n      blurCoordinates[5] = uv + blurSize * 5.1;\n      blurCoordinates[6] = uv - blurSize * 5.1;\n    #elif GAUSSIAN_SAMPLES == 9\n      // not proper gaussian weights\n      blurCoordinates[0] = uv;\n      blurCoordinates[1] = uv + blurSize * 1.407333;\n      blurCoordinates[2] = uv - blurSize * 1.407333;\n      blurCoordinates[3] = uv + blurSize * 3.294215;\n      blurCoordinates[4] = uv - blurSize * 3.294215;\n      blurCoordinates[5] = uv + blurSize * 5.1;\n      blurCoordinates[6] = uv - blurSize * 5.1;\n      blurCoordinates[7] = uv + blurSize * 7.1;\n      blurCoordinates[8] = uv - blurSize * 7.1;\n    #endif\n  #endif\n}\n","downsample.frag":"#include <util/fsPrecision.glsl>\n\n// ===============================================================================\n// Smartly downsamples a texture, halfing its resolution. This allows for a square\n// screen region to check if none, any or all pixels were set.\n\n// The red channel is always ceiled after interpolating the 4 merged pixels.\n// This allows to evaluate:\n// any(pixels.red != 0.0) as red == 1.0\n// none(pixels.red != 0.0) as red == 0.0\n\n// The green and blue channels are set to floor(max(green, blue)).\n// This allows to evaluate:\n// all(pixels.green || pixels.blue) as green == 1.0\n// ===============================================================================\n\nuniform sampler2D tex;\nuniform vec2 invFramebufferDim;\n\nvoid main() {\n  vec2 coord = gl_FragCoord.xy * invFramebufferDim;\n  vec4 value = texture2D(tex, coord);\n  float mx = floor(max(value.g, value.b));\n  gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);\n}\n","downsample.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\n\nvoid main() {\n  gl_Position = vec4(vec2(1.0) - position * 2.0, .0, 1.0);\n}\n"},laserLine:{"laserLine.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/depth.glsl>\n\n//--------------------------------------------------------------------------\n// Uniforms\n//--------------------------------------------------------------------------\n\nuniform sampler2D depthMap;\n\nuniform vec2 nearFar;\nuniform vec4 projInfo;\nuniform vec2 zScale;\nuniform float maxPixelDistance;\n\n// focus plane in camera space\nuniform vec4 focusPlane;\n\n// focus sphere in camera space\nuniform vec4 focusSphere;\n\n// segment plane in camera space\nuniform vec4 segmentPlane;\n\n// line segment\nuniform vec3 segmentStart;\nuniform vec3 segmentEnd;\n\n// styling\nuniform vec3 glowColor;\nuniform float glowWidth;\nuniform vec3 innerColor;\nuniform float innerWidth;\nuniform float globalAlpha;\n\n//--------------------------------------------------------------------------\n// Inputs\n//--------------------------------------------------------------------------\n\nvarying vec2 uv;\n\n//--------------------------------------------------------------------------\n// Defines\n//--------------------------------------------------------------------------\n\n#define INFINITY 100000.0\n\n// reconstruct position in view space\nvec3 reconstructPosition(vec2 fragCoord, float depth) {\n  return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n}\n\nfloat planeDistancePixels(vec4 plane, vec3 pos) {\n  // compute distance to plane\n  float dist = dot(plane.xyz, pos) + plane.w;\n  // compute derivative of distance function with respect to pixels\n  float width = fwidth(dist);\n  // normalize distance by the derivative to get a measurement with respect to pixels\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\n  dist /= min(width, maxPixelDistance);\n  return abs(dist);\n}\n\nfloat sphereDistancePixels(vec4 sphere, vec3 pos) {\n  // compute distance to sphere\n  float dist = distance(sphere.xyz, pos) - sphere.w;\n  // compute derivative of distance function with respect to pixels\n  float width = fwidth(dist);\n  // normalize distance by the derivative to get a measurement with respect to pixels\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\n  dist /= min(width, maxPixelDistance);\n  return abs(dist);\n}\n\nvec4 blendPremultiplied(vec4 source, vec4 dest) {\n  float oneMinusSourceAlpha = 1.0 - source.a;\n\n  return vec4(\n    source.rgb + dest.rgb * oneMinusSourceAlpha,\n    source.a + dest.a * oneMinusSourceAlpha\n  );\n}\n\nvec4 premultipliedColor(vec3 rgb, float alpha) {\n  return vec4(rgb * alpha, alpha);\n}\n\n// computes laser line color based on distance in pixels\nvec4 laserLineProfile(float dist) {\n  if (dist > glowWidth) {\n    return vec4(0.0);\n  }\n\n  float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\n  float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), 8.0);\n\n  return blendPremultiplied(\n    premultipliedColor(innerColor, innerAlpha),\n    premultipliedColor(glowColor, glowAlpha)\n  );\n}\n\nvoid main() {\n  // do not draw laserline on background\n  float depth = linearDepth(depthMap, uv, nearFar);\n  if (-depth == nearFar[0]) {\n    discard;\n  }\n\n  // reconstruct position in view space\n  vec3 pos = reconstructPosition(gl_FragCoord.xy, depth);\n\n  // empirical hack to fade out laser line in problematic areas:\n  // the derivatives to normalize the distance function are valid inside smooth surfaces,\n  // but break down at depth discontinuities (e.g. edges). We fade out the laser lines in\n  // areas where depth valus have large variations in order to avoid this problem.\n  float ddepth = fwidth(depth);\n  float depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n\n  // reconstruct normal using derivatives\n  vec3 normal = normalize(cross(dFdx(pos), dFdy(pos)));\n\n  // distance to focus plane\n  float focusPlaneDistance = planeDistancePixels(focusPlane, pos);\n\n  // distance to focus sphere\n  float focusSphereDistance = sphereDistancePixels(focusSphere, pos);\n\n  // distance to segment plane\n  float segmentDistance = INFINITY;\n  float segmentLength = length(segmentEnd - segmentStart);\n  vec3 segmentDir = (segmentEnd - segmentStart) / segmentLength;\n  float t = dot(segmentDir, pos - segmentStart);\n\n  if (segmentLength > 0.0 && t >= 0.0 && t <= segmentLength) {\n    segmentDistance = planeDistancePixels(segmentPlane, pos);\n  }\n\n  // evaluate color profile for both planes and the sphere\n  vec4 focusPlaneColor = laserLineProfile(focusPlaneDistance);\n  vec4 focusSphereColor = laserLineProfile(focusSphereDistance);\n  vec4 segmentColor = laserLineProfile(segmentDistance);\n\n  // empirical hack to fade out laser line when planes are nearly parallel\n  float focusPlaneAlpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, focusPlane.xyz)));\n  float focusSphereAlpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, normalize(pos - focusSphere.xyz))));\n  float segmentAlpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, segmentPlane.xyz)));\n\n  // combine colors\n  vec4 color = max(\n    focusPlaneColor * focusPlaneAlpha,\n    max(\n      focusSphereColor * focusSphereAlpha,\n      segmentColor * segmentAlpha\n    )\n  );\n\n  gl_FragColor = color * globalAlpha * depthDiscontinuityAlpha;\n}\n"},offscreen:{"composite.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\n\nvarying vec2 vtc;\n\nvoid main() {\n  gl_FragColor = texture2D(tex, vtc);\n}\n","compositeOccluded.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D occludedColorMap;\nuniform float opacity;\n\nvarying vec2 vtc;\n\nvoid main() {\n  vec4 occludedColor = texture2D(occludedColorMap, vtc);\n  gl_FragColor = occludedColor * opacity;\n}\n","compositeTransparentToHUDVisibility.frag":"#include <util/fsPrecision.glsl>\n\nuniform sampler2D tex;\n\nvarying vec2 vtc;\n\nvoid main() {\n  gl_FragColor = vec4(1.0 - texture2D(tex, vtc).a);\n}\n","offscreen.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nvarying vec2 vtc;\n\nvoid main(void) {\n  gl_Position = vec4(position.xy, 0.0, 1.0);\n  vtc = position.xy * 0.5 + 0.5;\n}\n"},ssao:{"blur.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/depth.glsl>\n\n#ifndef RADIUS\n#define RADIUS 4\n#endif\n\nuniform sampler2D normalMap;\nuniform sampler2D depthMap;\nuniform sampler2D tex;\n\nuniform vec2 blurSize;\n\nuniform float g_BlurFalloff;\nuniform float projScale;\n\nuniform vec2 nearFar;\n//set z scaling, used to prevent division in ortho mode\nuniform vec2 zScale;\n\nvarying vec2 uv;\n\nfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n  float c = texture2D(tex, uv).r;\n  float d = linearDepth(depthMap, uv, nearFar);\n\n  float ddiff = d - center_d;\n\n  float w = exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n  w_total += w;\n\n  return w*c;\n}\n\nvoid main(void) {\n  float b = 0.0;\n  float w_total = 0.0;\n\n  float center_d = linearDepth(depthMap, uv, nearFar);\n\n  float sharpness = -0.05 * projScale/(center_d*zScale.x+zScale.y);\n  for (int r = -RADIUS; r <= RADIUS; ++r) {\n    float rf = float(r);\n    vec2 uvOffset = uv + rf*blurSize;\n    b += BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\n  }\n\n  gl_FragColor = vec4(b/w_total);\n}\n","ssao.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/depth.glsl>\n\n#ifndef SAMPLES\n#define SAMPLES 4\n#endif\n\nuniform mat4 projMatrixInv;\n\nuniform sampler2D normalMap;\nuniform sampler2D depthMap;\n\nuniform float intensity;\n\nuniform float projScale;\nuniform float radius;\nuniform vec2 nearFar;\nuniform vec4 projInfo;\nuniform vec2 screenDimensions;\n\n//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\nuniform vec3 pSphere[SAMPLES]; //tap position\nuniform vec2 rnmScale;\nuniform sampler2D rnm; //noise texture\n\n//set z scaling, used to prevent division in ortho mode\nuniform vec2 zScale;\n\nvarying vec2  uv;\nvarying vec4  camPos;\n\nfloat fallOffFunction(float vv, float vn, float bias) {\n  float radius2 = radius * radius;\n\n  // A: From the HPG12 paper\n  // Note large epsilon to avoid overdarkening within cracks\n  // return float(vv < radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n  // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n  float f = max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n  // C: Medium contrast (which looks better at high radii), no division.  Note that the\n  // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n  // more computationally efficient and happens to be aesthetically pleasing.\n  // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n  // D: Low contrast, no division operation\n  // return 2.0 * float(vv < radius * radius) * max(vn - bias, 0.0);\n}\n\n\n/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\nfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n  vec3 v = Q - C;\n  float vv = dot(v, v);\n  float vn = dot(normalize(v), n_C);\n  return fallOffFunction(vv, vn, 0.1);\n}\n\n\n/**\n * Reconstruct camera-space P.xyz from screen-space S = (x, y) in\n * pixels and camera-space z < 0.  Assumes that the upper-left pixel center\n * is at (0.5, 0.5) [but that need not be the location at which the sample tap\n * was placed!]\n *\n * Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\n */\nvec3 reconstructCSPosition(vec2 S, float z) {\n  return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\n}\n\nvoid main(void) {\n  //Hash function used in the HPG12 AlchemyAO paper\n  //Not supported in WebGL -> using texture lookup as in old SSAO shader instead\n  //ivec2 ssC = ivec2(gl_FragCoord.xy);\n  //float randomPatternRotationAngle = float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n  vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n  float currentPixelDepth = linearDepth(depthMap, uv, nearFar);\n\n  if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {\n    gl_FragColor = vec4(0.0);\n    return;\n  }\n\n  vec3 currentPixelPos = reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\n\n  // get the normal of current fragment\n  vec4 norm4 = texture2D(normalMap, uv);\n  vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;\n  bool isTerrain = norm4.w<0.5;\n\n  float sum = .0;\n\n  vec4 occluderFragment;\n  vec3 ray;\n\n  vec3 tapPixelPos;\n\n  // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n  // bug or deviation from CE somewhere else?\n  float ps = projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n  for(int i = 0; i < SAMPLES; ++i) {\n    // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n    //float ssR;\n    //vec2 unitOffset = tapLocation(i, randomPatternRotationAngle, ssR);\n    // get the depth of the occluder fragment\n    //vec2 offset = vec2(-unitOffset*radius*ssR*ps);\n\n    vec2 unitOffset = reflect(pSphere[i], fres).xy;\n    vec2 offset = vec2(-unitOffset*radius*ps);\n\n    //don't use current or very nearby samples\n    if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;\n\n    vec2 tc = vec2(gl_FragCoord.xy + offset);\n    if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;\n    vec2 tcTap = tc/screenDimensions;\n    float occluderFragmentDepth = linearDepth(depthMap, tcTap, nearFar);\n\n    if (isTerrain) {\n      bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;\n      if (isTerrainTap) {\n        continue;\n      }\n    }\n\n    tapPixelPos = reconstructCSPosition(tc, occluderFragmentDepth);\n\n    sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n  }\n\n  // output the result\n\n  float A = max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n  // Anti-tone map to reduce contrast and drag dark region farther\n  // (x^0.2 + 1.2 * x^4)/2.2\n  A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n  //gl_FragColor = vec4(norm/2.0+0.5, 1.0);\n  //gl_FragColor = vec4(-currentPixelDepth/1000.0);\n  //gl_FragColor = vec4(tapPixelPos.x/100.0);\n  gl_FragColor = vec4(A);\n}\n"}},terrainRenderer:{"colorPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/sceneLighting.glsl>\n#include <util/screenSizePerspective.glsl>\n#include <util/shadow.glsl>\n#include <util/slice.glsl>\n#include <terrainRenderer/overlay.glsl>\n\nuniform vec3 lightDirection;\nuniform vec3 viewDirection;\nuniform sampler2D depthTex;\nuniform int shadowMapNum;\nuniform vec4 shadowMapDistance;\nuniform mat4 shadowMapMatrix[4];\nuniform float depthHalfPixelSz;\nuniform sampler2D ssaoTex;\nuniform vec4 viewportPixelSz;\nuniform sampler2D tex;\nuniform float opacity;\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\nstruct WireframeSettings {\n  float width;\n  float falloff;\n  float subdivision;\n  vec4 color;\n  float wireOpacity;\n  float surfaceOpacity;\n};\n\nuniform WireframeSettings wireframe;\n#endif\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvarying vec2 vtc;\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\nvarying vec2 vuv;\n#endif\n\n#ifdef ATMOSPHERE\nvarying vec3 wpos;\nvarying vec3 wview;\nvarying vec3 wnormal;\nvarying vec3 wlight;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\nuniform vec4 screenSizePerspective;\n\nvarying float screenSizeDistanceToCamera;\nvarying float screenSizeCosAngle;\n#endif\n\nconst vec3 ambient = vec3(0.2,0.2,0.2);\nconst vec3 diffuse = vec3(0.8,0.8,0.8);\nconst float diffuseHardness = 2.5;\nconst float sliceOpacity = 0.2;\n\n#ifdef OVERLAY\nuniform sampler2D overlay0Tex;\nuniform sampler2D overlay1Tex;\nuniform float overlayOpacity;\nvarying vec4 vtcOverlay;\n#endif\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n\nfloat lum(vec3 c) {\n  float max = max(max(c.r, c.g), c.b);\n  float min = min(min(c.r, c.g), c.b);\n  return (min + max) * 0.5;\n}\n\n#ifdef ATMOSPHERE\nvec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n  vec3 surfaceColor   = vec3(0.0);\n  vec3 fuzzySpecColor = vec3(1.0);\n  vec3 subColor       = vec3(0.0);\n  float rollOff       = 1.0;\n\n  vec3 Ln = normalize(lightPos);\n  vec3 Nn = normalize(normal);\n  vec3 Hn = normalize(view + Ln);\n\n  float ldn = dot(Ln, Nn);\n  float diffComp = max(0.0, ldn);\n  float vdn = 1.0 - dot(view, Nn);\n  float ndv = dot(view, Ln);\n\n  vec3 diffContrib = surfaceColor * diffComp;\n  float subLamb = max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n  vec3 subContrib = subLamb * subColor;\n  vec3 vecColor = vec3(vdn);\n\n  vec3 diffuseContrib = (subContrib + diffContrib);\n  vec3 specularContrib = (vecColor * fuzzySpecColor);\n\n  return (diffContrib + specularContrib) * rollOff;\n}\n#endif\n\nvoid main() {\n  vec3 a = ambient;\n\n  float shadow = 0.0;\n#ifdef RECEIVE_SHADOWS\n  shadow = evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\n#endif\n  float vndl = dot(normalize(vnormal), lightDirection);\n  float k = smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n  vec3 d = (1.0 - shadow/1.8) * diffuse * k;\n\n  float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n\n  vec4 tileColor = texture2D(tex, vtc) * opacity;\n\n#ifdef OVERLAY\n  vec4 overlayColor = getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\n\n  // tileColor and overlayTexCols have pre-multiplied alpha\n  tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;\n#endif\n\n  if (rejectBySlice(vpos)) {\n    tileColor *= sliceOpacity;\n  }\n\n  vec3 atm = vec3(0.0);\n#ifdef ATMOSPHERE\n  float ndotl = max(0.0, min(1.0, vndl));\n  atm = atmosphere(wlight, wnormal, -viewDirection);\n  atm *= max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n  atm *= max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n  atm *= tileColor.a; // premultiply with tile alpha\n#endif\n\n  vec3 albedo = atm + tileColor.rgb;\n  vec3 normal = normalize(vnormal);\n\n  // heuristic shading function used in the old terrain, now used to add ambient lighting\n  float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n  vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n  gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n  // This is only used for debug rendering the screenSize perspective\n\n  float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n\n  if (perspectiveScale <= 0.25) {\n    gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n  }\n  else if (perspectiveScale <= 0.5) {\n    gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n  }\n  else if (perspectiveScale >= 0.99) {\n    gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n  }\n  else {\n    gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n  }\n\n#endif\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\n\n  vec2 vuvScaled = vuv * wireframe.subdivision;\n  vec2 vuvMod = fract(vuvScaled);\n\n  vec2 dVuv = fwidth(vuvScaled);\n  dVuv = max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\n\n  vec2 edgeFactors = smoothstep((wireframe.width - wireframe.falloff) * dVuv,\n                                wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\n\n  float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n#ifdef WIREFRAME_TEXTURE\n  vec3 wireframeColor = mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a);\n  float wireframeAlpha = mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor);\n  gl_FragColor = vec4(wireframeColor * wireframeAlpha, wireframeAlpha * gl_FragColor.a);\n#endif\n\n\n#ifdef TILE_BORDERS\n  dVuv = fwidth(vuv);\n  edgeFactors = smoothstep((wireframe.width - wireframe.falloff) * dVuv,\n                            wireframe.width * dVuv, min(vuv, 1.0 - vuv));\n  edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n  gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\n#endif\n\n#endif // defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\n\n  gl_FragColor = highlightSlice(gl_FragColor, vpos);\n}\n","colorPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec3 origin;\nuniform vec4 texOffsetAndScale;\nuniform mat4 viewNormal;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\nvarying vec2 vtc;\n\n#ifdef RECEIVE_SHADOWS\nvarying float linearDepth;\n#endif\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\nvarying vec2 vuv;\n#endif\n\n#ifdef ATMOSPHERE\nuniform vec3 lightDirection;\nvarying vec3 wpos;\nvarying vec3 wview;\nvarying vec3 wnormal;\nvarying vec3 wlight;\n#endif\n\n#ifdef OVERLAY\n// these variables combine two possible overlays into one by using a vec4:\n// components x/y are x/y of overlay 0, and components z/w are x/y of overlay 1\nuniform vec4 overlayTexOffset;\nuniform vec4 overlayTexScale;\nvarying vec4 vtcOverlay;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n\nuniform vec4 screenSizePerspective;\n\nvarying float screenSizeDistanceToCamera;\nvarying float screenSizeCosAngle;\n\n#endif\n\nvoid main(void) {\n  vpos = position;\n\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n  vnormal = normalize(vpos + origin);\n#else\n  vnormal = vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n#endif\n\nvec2 uv = uv0;\nvpos = applySkirts(uv, vpos, vnormal, skirtScale);\n\n#ifdef ATMOSPHERE\n  wpos = (view * vec4(vpos, 1.0)).xyz;\n  wnormal = (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n  wlight = (view  * vec4(lightDirection, 1.0)).xyz;\n#endif\n\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\n  vuv = uv;\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\n\n  vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;\n\n  screenSizeDistanceToCamera = length(viewPos);\n\n  vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n  screenSizeCosAngle = abs(viewSpaceNormal.z);\n\n#endif\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n\n#ifdef RECEIVE_SHADOWS\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\n  // issues on iPad/iPhone with the 'w' component require the depth to be\n  // passed as varying to properly drive the cascading shadow map index.\n  linearDepth = gl_Position.w;\n#endif\n\n  vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n\n#ifdef OVERLAY\n  vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n#endif\n}\n","depthPass.frag":"#include <util/enableExtensions.glsl>\n#include <util/fsPrecision.glsl>\n#include <util/encoding.glsl>\n#include <util/depth.glsl>\n\nvarying float depth;\nvarying vec3 vpos;\n\nvoid main() {\n#ifndef BIAS_SHADOWMAP\n  gl_FragColor = float2rgba(depth);\n#else\n  gl_FragColor = float2rgba(calcFragDepth(depth));\n#endif\n}\n","depthPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec2 nearFar;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying float depth;\nvarying vec3 vpos;\n\nvoid main(void) {\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n  vec3 normal = normalize(position + origin);\n#else\n  vec3 normal = vec3(0.0, 0.0, 1.0);\n#endif\n\n  vec2 uv = uv0;\n  vpos = applySkirts(uv, position, normal.xyz, skirtScale);\n\n  vec4 eye = view * vec4(vpos, 1.0);\n  gl_Position = proj * eye;\n  depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n}\n","highlightPass.frag":"#include <util/fsPrecision.glsl>\n#include <util/highlight.glsl>\n#include <terrainRenderer/overlay.glsl>\n\nuniform sampler2D overlay0Tex;\nuniform sampler2D overlay1Tex;\nuniform float overlayOpacity;\n\nuniform sampler2D depthTex;\nuniform vec4 highlightViewportPixelSz;\n\nvarying vec4 vtcOverlay;\n\nvoid main() {\n  vec4 overlayColor = getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\n\n  if (overlayColor.a == 0.0) {\n    // Here we have to write black, instead of discarding the fragment in order to overwrite\n    // the highlights which might have been written by skirts of other tiles.\n    // As a consequence skirts are not visible, but terrain overwrites draped highlights.\n    gl_FragColor = vec4(0.0);\n    return;\n  }\n\n  gl_FragColor = highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\n}\n","highlightPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform vec4 overlayTexScale;\nuniform vec4 overlayTexOffset;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec3 vpos;\nvarying vec4 vtcOverlay;\n\nvoid main() {\n  #if VIEWING_MODE == VIEWING_MODE_GLOBAL\n    vec3 vnormal = normalize(position + origin);\n  #else\n    vec3 vnormal = vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n  #endif\n\n  vec2 uv = uv0;\n  vpos = applySkirts(uv, position, vnormal, skirtScale);\n\n  vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n}\n","normalPass.frag":"#include <util/fsPrecision.glsl>\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\nvoid main() {\n  vec3 normal = normalize(vnormal);\n  if (gl_FrontFacing == false) normal = -normal;\n\n#ifndef ALPHA_ZERO\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 1.0);\n#else\n  gl_FragColor = vec4(vec3(.5) + .5 * normal, 0.0);\n#endif\n}\n","normalPass.vert":"#include <util/vsPrecision.glsl>\n#include <terrainRenderer/skirts.glsl>\n\nuniform vec3 origin;\nuniform mat4 proj;\nuniform mat4 view;\nuniform mat4 viewNormal;\nuniform float skirtScale;\n\nattribute vec3 position;\nattribute vec2 uv0;\n\nvarying vec3 vnormal;\nvarying vec3 vpos;\n\nvoid main(void) {\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n  vec4 normal = vec4(normalize(position + origin), 1.0);\n#else\n  vec4 normal = vec4(0.0, 0.0, 1.0, 1.0);\n#endif\n\n  vec2 uv = uv0;\n  vpos = applySkirts(uv, position, normal.xyz, skirtScale);\n\n  gl_Position = proj * view * vec4(vpos, 1.0);\n  vnormal = normalize((viewNormal * normal).xyz);\n}\n","overlay.glsl":"vec4 getOverlayColor(sampler2D overlay0Tex, sampler2D overlay1Tex, vec4 texCoords, float opacity) {\n  vec4 color = vec4(0.0);\n\n  // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n  // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n  // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n  vec4 colorInner = texture2D(overlay0Tex, texCoords.xy);\n  vec4 colorOuter = texture2D(overlay1Tex, texCoords.zw);\n\n  if ((texCoords.x > 0.0) && (texCoords.x < 1.0) && (texCoords.y > 0.0) && (texCoords.y < 1.0)) {\n    // inner overlay texture coordinates are within bounds -> sample from inner overlay\n    color = colorInner;\n  } else if ((texCoords.z > 0.0) && (texCoords.z < 1.0) && (texCoords.w > 0.0) && (texCoords.w < 1.0)) {\n    // sample from outer overlay\n    color = colorOuter;\n  }\n\n  return color * opacity;\n}\n","skirts.glsl":'vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n  float skirtLength = 0.0;\n\n  if (uv.x >= 2.0) {\n    skirtLength = uv.y * skirtScale;\n    // decode original uv-coordinates (see "encodeSkirtPos")\n    vec2 x = vec2(uv.x) - vec2(3.5, 4.5);\n    uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n  }\n\n  return vpos - vnormal * skirtLength;\n}\n'},util:{"alignPixel.glsl":"vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n  // From clip space to (0 : 1), bias towards right pixel edge\n  vec2 xy = vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\n\n  // Size of a pixel in range (0 : 1)\n  vec2 pixelSz = vec2(1.0) / widthHeight;\n\n  // Round to nearest pixel center\n  vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n\n  // Convert back to clip space\n  vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n  return vec4(result, clipCoord.zw);\n}\n\nvec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n  // From clip space to (0 : 1),\n  vec2 xy = vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\n\n  // Size of a pixel in range (0 : 1)\n  vec2 pixelSz = vec2(1.0) / widthHeight;\n\n  // Round to nearest pixel border, (0 : 1)\n  vec2 ij = floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\n\n  // Convert back to clip space\n  vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n\n  return vec4(result, clipCoord.zw);\n}\n","color.glsl":"vec4 premultiplyAlpha(vec4 v) {\n  return vec4(v.rgb * v.a, v.a);\n}\n\nvec3 rgb2hsv(vec3 c) {\n  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n  vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n  float d = q.x - min(q.w, q.y);\n  float e = 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n","depth.glsl":"#include <util/encoding.glsl>\n\n// read linear depth either from native depth texture or custom depth texture encoded in rgba\nfloat linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n  return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n}\n\nfloat calcFragDepth(const in float depth) {\n  // calc polygon offset\n  const float SLOPE_SCALE = 2.0;\n  const float BIAS = 2.0 * .000015259;    // 1 / (2^16 - 1)\n  float m = max(abs(dFdx(depth)), abs(dFdy(depth)));\n  float result = depth + SLOPE_SCALE * m + BIAS;\n  return clamp(result, .0, .999999);\n}\n","doublePrecision.glsl":"// based on https://www.thasler.com/blog/blog/glsl-part2-emu\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n  vec3 t1 = hiA + hiB;\n  vec3 e = t1 - hiA;\n  vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n  return t1 + t2;\n}\n","enableExtensions.glsl":"#define EXTENSIONS_ENABLED\n#extension GL_OES_standard_derivatives : enable\n#extension GL_EXT_shader_texture_lod : enable\n","encoding.glsl":"// This is the maximum float value representable as 32bit fixed point,\n// it is rgba2float(vec4(1)) inlined.\nconst float MAX_RGBA_FLOAT =\n  255.0 / 256.0 +\n  255.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n// Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\nconst vec4 fixedPointFactors = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\nvec4 float2rgba(const float value) {\n  // Make sure value is in the domain we can represent\n  float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n  // Decompose value in 32bit fixed point parts represented as\n  // uint8 rgba components. Decomposition uses the fractional part after multiplying\n  // by a power of 256 (this removes the bits that are represented in the previous\n  // component) and then converts the fractional part to 8bits.\n  vec4 fixedPointU8 = floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\n\n  // Convert uint8 values (from 0 to 255) to floating point representation for\n  // the shader\n  const float toU8AsFloat = 1.0 / 255.0;\n\n  return fixedPointU8 * toU8AsFloat;\n}\n\n// Factors to convert rgba back to float\nconst vec4 rgba2float_factors = vec4(\n  255.0 / (256.0),\n  255.0 / (256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\n\nfloat rgba2float(vec4 rgba) {\n  // Convert components from 0->1 back to 0->255 and then\n  // add the components together with their corresponding\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n  return dot(rgba, rgba2float_factors);\n}\n","fsPrecision.glsl":"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif\n","highlight.glsl":"vec4 highlightData(vec4 fragCoord, sampler2D depthTex, vec4 viewportPixelSize) {\n  float sceneDepth = texture2D(depthTex, (fragCoord.xy - viewportPixelSize.xy) * viewportPixelSize.zw).r;\n  if (fragCoord.z > sceneDepth + 5e-7) {\n    return vec4(1.0, 1.0, 0.0, 1.0);\n  }\n  else {\n    return vec4(1.0, 0.0, 1.0, 1.0);\n  }\n}\n","hud.glsl":"#include <util/screenSizePerspective.glsl>\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 auxpos1;\n\nuniform mat4 proj;\n\nuniform mat4 view;\nuniform mat4 viewNormal;\n\nuniform mat4 model;\nuniform mat4 modelNormal;\n\nuniform vec4 viewport;\n\nuniform vec3 camPos;\n\nuniform float polygonOffset;\nuniform float cameraGroundRelative;\nuniform float pixelRatio;\n\nuniform float perDistancePixelRatio;\n\n#ifdef VERTICAL_OFFSET\n\n// [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\nuniform vec4 verticalOffset;\n\n#endif\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n// [ divisor, offset, minPixelSize, paddingPixels ]\nuniform vec4 screenSizePerspectiveAlignment;\n\n#endif\n\nuniform sampler2D hudVisibilityTexture;\n\n\n// Corresponds to cos(10 deg), used to compare against dot product of two vectors\nconst float SMALL_OFFSET_ANGLE = 0.984807753012208;\n\nstruct ProjectHUDAux {\n  vec3 posModel;\n  vec3 posView;\n  vec3 vnormal;\n\n  float distanceToCamera;\n  float absCosAngle;\n};\n\n\n/**\n  * Apply the simulated polygon offset for HUD objects that improves\n  * issues with Z-fighting.\n  *\n  * @param posView {vec3} (inout) the position in view space. Will be modified in place.\n  * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\n  * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\n  *   and the view direction.\n  *\n  * Dependencies:\n  *\n  *   Attributes:\n  *     - auxpos1: contains centerOffset and pointGroundDistance\n  *\n  *   Uniforms:\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n  *         reduced flickering.\n  *     - viewport: the viewport [x, y, width, height]\n  */\nfloat applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n  float pointGroundSign = sign(pointGroundDistance);\n\n  if (pointGroundSign == 0.0) {\n    pointGroundSign = cameraGroundRelative;\n  }\n\n  // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n  // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n  float groundRelative = cameraGroundRelative * pointGroundSign;\n\n  // view angle dependent part of polygon offset emulation\n  // we take the absolute value because the sign that is dropped is\n  // instead introduced using the ground-relative position of the symbol and the camera\n  if (polygonOffset > .0) {\n    float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n\n    float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n    float factor = (1.0 - tanAlpha / viewport[2]);\n\n    // same side of the terrain\n    if (groundRelative > 0.0) {\n      posView *= factor;\n    }\n    // opposite sides of the terrain\n    else {\n      posView /= factor;\n    }\n  }\n\n  return groundRelative;\n}\n\n/**\n * Apply small vertical offset along world normal to reduce flickering. The offset\n * is distance based is approximately half of a pixel in the plane parallel to the\n * view at the HUD origin.\n *\n * @param normalModel {vec3} the normal in model/world space.\n * @param posModel {vec3} (inout) the position in model/world space. This value will\n *   be updated with the additional vertical offset.\n * @param posView {vec3} (inout) the position in view space. This value is used to\n *   determine the distance to the HUD origin and will also be updated with the\n *   additional vertical offset.\n *\n * Dependencies:\n *\n *   Uniforms:\n *     - perDistancePixelRatio: world units per distance per pixel.\n *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n *     - viewNormal: the view normal transformation.\n */\nvoid applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n  float distanceToCamera = length(posView);\n\n  // Compute offset in world units for a half pixel shift\n  float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\n\n  // Apply offset along normal in the direction away from the ground surface\n  vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n  // Apply the same offset also on the view space position\n  vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n  posModel += modelOffset;\n  posView += viewOffset;\n}\n\n/**\n  * Project the 3d position of a HUD object from world space to clip space. In addition\n  * to standard model view projection, it also emulates a polygon offset to\n  * help with points above/below ground and icon flickering. The resulting location\n  * is the anchor of the HUD object, i.e. the position that is used also for testing\n  * visibility of the HUD object. Note that the returned projected position is not\n  * aligned to a pixel center or border, it is up to the caller to align if necessary.\n  *\n  * Dependencies:\n  *\n  *   Attributes:\n  *     - position: contains the point world position\n  *     - normal: contains the world normal pointing up at the point\n  *     - auxpos1: contains centerOffset and pointGroundDistance\n  *\n  *   Uniforms:\n  *     - model: the object -> world transformation matrix\n  *     - modelNormal: the object -> world normal transformation matrix (inv transp of model)\n  *     - view: the world -> view transformation matrix\n  *     - viewNormal: the world -> view normal transformation matrix (inv transp of view)\n  *     - proj: the view -> clip projection matrix\n  *     - verticalOffset: a vec4 containing:\n  *         - the screen height of the vertical offset\n  *         - the screen height of the vertical offset as a fraction of camera distance.\n  *         - the minimum world size vertical offset.\n  *         - the maximum world size vertical offset.\n  *       This will do a screen sized offset of the point along its normal (used for line callouts)\n  *     - screenSizePerspectiveAlignment: a vec3 containing\n  *         - the view distance dependent divisor\n  *         - the view distance dependent offset\n  *         - the minimum pixel size\n  *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\n  *         reduced flickering.\n  *     - camPos: the position of the camera in world space\n  *     - viewport: the viewport [x, y, width, height]\n  */\nvec4 projectPositionHUD(out ProjectHUDAux aux) {\n  // centerOffset is in view space and is used to implement world size offsetting\n  // of labels with respect to objects. It also pulls the label towards the viewer\n  // so that the label is visible in front of the object.\n  vec3 centerOffset = auxpos1.xyz;\n\n  // The pointGroundDistance is the distance of the geometry to the ground and is\n  // negative if the point is below the ground, or positive if the point is above\n  // ground.\n  float pointGroundDistance = auxpos1.w;\n\n  aux.posModel = (model * vec4(position, 1.0)).xyz;\n  aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n  aux.vnormal = (modelNormal * vec4(normal, 1.0)).xyz;\n\n  applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n  // Screen sized offset in world space, used for example for line callouts\n  // Note: keep this implementation in sync with the CPU implementation, see\n  //   - MaterialUtil.verticalOffsetAtDistance\n  //   - HUDMaterial.applyVerticalOffsetTransformation\n\n  aux.distanceToCamera = length(aux.posView);\n\n  vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n  float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n  aux.absCosAngle = abs(cosAngle);\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\n  vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\n#endif\n\n#endif\n\n#ifdef VERTICAL_OFFSET\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\n#else\n  float verticalOffsetScreenHeight = verticalOffset.x;\n#endif\n\n  float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n  vec3 modelOffset = aux.vnormal * worldOffset;\n\n  aux.posModel += modelOffset;\n\n  vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n  aux.posView += viewOffset;\n\n  // Since we elevate the object, we need to take that into account\n  // in the distance to ground\n  pointGroundDistance += worldOffset;\n\n#endif\n\n  float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n#ifndef CENTER_OFFSET_UNITS_SCREEN\n  // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n  aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n  // Same material all have same z != 0.0 condition so should not lead to\n  // branch fragmentation and will save a normalization if it's not needed\n  if (centerOffset.z != 0.0) {\n    aux.posView -= normalize(aux.posView) * centerOffset.z;\n  }\n#endif\n\n  vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n#ifdef CENTER_OFFSET_UNITS_SCREEN\n\n#ifdef SCREEN_SIZE_PERSPECTIVE\n  float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\n#else\n  float centerOffsetY = centerOffset.y;\n#endif\n\n  posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;\n\n#endif\n\n  // constant part of polygon offset emulation\n  posProj.z -= groundRelative * polygonOffset * posProj.w;\n\n  return posProj;\n}\n\nuniform float uRenderTransparentlyOccludedHUD;\n\n/**\n  * Test for visibility of a HUD object.\n  *\n  * Dependencies:\n  *\n  *   Uniforms:\n  *     - hudVisibilityTexture: the texture that contains the visibility information\n  *     - markerColor: the special marker color that is used to write visibility information\n  *     - viewport: the viewport\n  */\nbool testVisibilityHUD(vec4 posProj) {\n  // For occlusion testing, use the nearest pixel center to avoid\n  // subpixel filtering messing up the color we use to test for\n  vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n  vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n  // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n  // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)\n  // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts\n\n  // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n  if (uRenderTransparentlyOccludedHUD > 0.5) {\n    // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n    // uRenderTransparentlyOccludedHUD = 0.75\n    return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n  }\n  // and visible pixels that are not occluded by semi-transparent geometry here\n  else {\n    return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n  }\n\n  // return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r > 0.0;\n}\n","normalEncoding.glsl":"vec3 decodeNormal(vec2 f) {\n    float z = 1.0 - abs(f.x) - abs(f.y);\n    return vec3(f + sign(f) * min(z, 0.0), z);\n}\n","quad.vert":"#include <util/vsPrecision.glsl>\n\nattribute vec2 position;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(position.x, position.y, .0, 1.0);\n  uv = position * .5 + vec2(.5);\n}\n","sceneLighting.glsl":"// Scene Lighting Definitions:\n// ================================\n\n// defines:\n//   - SH_ORDER: 1|2|3\n// input:\n//   - normal: vec3\n//   - albedo: vec3\n//   - shadow: float\n//   - ssao: float\n// return:\n//   - color: vec3\n\n// main light\n/////////////////////////////////////////\nuniform vec3 lightingMainDirection;\nuniform vec3 lightingMainIntensity;\n\n// ambient lighting\n/////////////////////////////////////////\n#ifndef SH_ORDER\n  #define SH_ORDER 2\n#endif\n\n#if SH_ORDER == 0\n  uniform vec3 lightingAmbientSH0;\n#elif SH_ORDER == 1\n  uniform vec4 lightingAmbientSH_R;\n  uniform vec4 lightingAmbientSH_G;\n  uniform vec4 lightingAmbientSH_B;\n#elif SH_ORDER == 2\n  uniform vec3 lightingAmbientSH0;\n  uniform vec4 lightingAmbientSH_R1;\n  uniform vec4 lightingAmbientSH_G1;\n  uniform vec4 lightingAmbientSH_B1;\n  uniform vec4 lightingAmbientSH_R2;\n  uniform vec4 lightingAmbientSH_G2;\n  uniform vec4 lightingAmbientSH_B2;\n#endif\n\n// special tweaking\n//////////////////////////////////////////\nuniform float lightingFixedFactor;\nuniform float lightingGlobalFactor;\n\nuniform float ambientBoostFactor;\n\n// evaluation\n//////////////////////////////////////////\n\nvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n  // evaluate the main light\n  #if defined(TREE_RENDERING)\n    // Special case for tree rendering:\n    // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n    // facing away from the light. The idea is to get an effect where light is transmitted\n    // through the tree.\n    float minDot = -0.5;\n    float dotRange = 1.0 - minDot;\n    float dotNormalization = 0.66; // guessed & hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n    float dotVal = dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n  #else\n    float dotVal = clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n  #endif\n\n  // move lighting towards (1.0, 1.0, 1.0) if requested\n  dotVal = mix(dotVal, 1.0, lightingFixedFactor);\n\n  vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;\n\n  // evaluate the sh ambient light\n  #if SH_ORDER == 0\n    vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n  #elif SH_ORDER == 1\n    vec4 sh0 = vec4(\n      0.282095,\n      0.488603 * normal.x,\n      0.488603 * normal.z,\n      0.488603 * normal.y\n    );\n    vec3 ambientLight = vec3(\n      dot(lightingAmbientSH_R, sh0),\n      dot(lightingAmbientSH_G, sh0),\n      dot(lightingAmbientSH_B, sh0)\n    );\n  #elif SH_ORDER == 2\n    vec3 ambientLight = 0.282095 * lightingAmbientSH0;\n\n    vec4 sh1 = vec4(\n      0.488603 * normal.x,\n      0.488603 * normal.z,\n      0.488603 * normal.y,\n      1.092548 * normal.x * normal.y\n    );\n    vec4 sh2 = vec4(\n      1.092548 * normal.y * normal.z,\n      0.315392 * (3.0 * normal.z * normal.z - 1.0),\n      1.092548 * normal.x * normal.z,\n      0.546274 * (normal.x * normal.x - normal.y * normal.y)\n    );\n    ambientLight += vec3(\n      dot(lightingAmbientSH_R1, sh1),\n      dot(lightingAmbientSH_G1, sh1),\n      dot(lightingAmbientSH_B1, sh1)\n    );\n    ambientLight += vec3(\n      dot(lightingAmbientSH_R2, sh2),\n      dot(lightingAmbientSH_G2, sh2),\n      dot(lightingAmbientSH_B2, sh2)\n    );\n  #endif\n  ambientLight *= (1.0 - ssao);\n\n  // inverse gamma correction on the albedo color\n  float gamma = 2.1;\n  vec3 albedoGammaC = pow(albedo, vec3(gamma));\n\n  // physically correct BRDF normalizes by PI\n  const float PI = 3.14159;\n  vec3 totalLight = mainLight + ambientLight + additionalLight;\n  totalLight = min(totalLight, vec3(PI, PI, PI));\n  vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));\n\n  // apply gamma correction to the computed color\n  outColor = pow(outColor, vec3(1.0/gamma));\n\n  return outColor;\n}\n\nvec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\n  // heuristic lighting model originally used in the terrain shading\n  // now used to generated additional ambient light\n\n#if VIEWING_MODE == VIEWING_MODE_GLOBAL\n    float vndl = -dot(normalize(worldPos), lightingMainDirection);\n#else\n    float vndl = -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n#endif\n\n  additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n  return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n}\n","screenSizePerspective.glsl":"// Note that the implementation here should be kept in sync with the corresponding\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\n\n/**\n * Compute the screen size perspective lower bound from pre-computed screen\n * size perspective factors (or parameters, since both store the pixel lower\n * bound information in the same place). When computing the minimum size,\n * the padding (e.g. text halo) is scaled with the same factor as the\n * original size scales to reach the minimum size.\n *\n * {\n *    x: N/A\n *    y: N/A\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\n\n  // Original calculation:\n  //   padding = 2 * factor.w\n  //   minSize = factor.z\n  //\n  //   minSize + minSize / size * padding\n  //\n  // Incorporates padding (factor.w, e.g. text halo size) into the\n  // minimum bounds calculation, taking into account that padding\n  // would scale down proportionally to the size.\n  //\n  // Calculation below is the same, but avoids division by zero when\n  // size would be zero, without branching using step.\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\n\n  // nonZeroSize is 1 if size > 0, and 0 otherwise\n  float nonZeroSize = 1.0 - step(size, 0.0);\n\n  return (\n    factor.z * (\n      1.0 +\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                   // proportionally scaled padding\n      2.0 * factor.w / (\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n      )\n    )\n  );\n}\n\n/**\n * Computes the view angle dependent screen size perspective factor. The goal\n * of this factor is that:\n *\n *   1. There is no perspective when looking top-down\n *   2. There is a smooth and quick transition to full perspective when\n *      tilting.\n */\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n  return absCosAngle * absCosAngle * absCosAngle;\n}\n\n/**\n * Precomputes a set of factors that can be used to apply screen size perspective\n * The factors are based on the viewing angle, distance to camera and the screen size\n * perspective parameters:\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n *\n * The result is a set of factors that can be used to apply the perspective:\n *\n * {\n *    x: distance based relative scale factor (0 -> 1)\n *    y: view dependent scale factor\n *    z: minPixelSize (abs)\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n}\n\n/**\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\n */\n\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n}\n\n/**\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n\n/**\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\n *\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\n */\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n}\n\n/**\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\n * distance to camera and perspective parameters\n * {\n *    x: distanceDivisor,\n *    y: distanceOffset,\n *    z: minPixelSize (abs),\n *    w: sizePaddingInPixels (abs)\n * }\n */\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}\n","shadow.glsl":'#include <util/encoding.glsl>\n\n// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\n// once IE11 is fine with it, const should probably be re-introduced\nfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\n  //choose correct cascade\n  int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;\n\n  if (i >= num) { return .0; }\n\n  mat4 mat = i == 0 ? matrix[0] : i == 1 ? matrix[1] : i == 2 ? matrix[2] : matrix[3];\n\n  vec4 lv = mat * vec4(vpos, 1.0);\n  lv.xy /= lv.w;\n\n  //vertex completely outside? -> no shadow\n  vec3 lvpos = .5 * lv.xyz + vec3(.5);\n  if (lvpos.z >= 1.0) { return .0; }\n  if (lvpos.x < .0 || lvpos.x > 1.0 || lvpos.y < .0 || lvpos.y > 1.0) { return .0; }\n\n  //calc coord in cascade texture\n  vec2 uv = vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\n\n  float texSize = .5 / halfPxSz;\n\n  //filter, offset by half pixels\n  vec2 st = fract((vec2(halfPxSz) + uv) * texSize);\n\n  float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) < lvpos.z ? 1.0 : .0;\n  float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) < lvpos.z ? 1.0 : .0;\n  float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) < lvpos.z ? 1.0 : .0;\n  float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) < lvpos.z ? 1.0 : .0;\n\n  return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n}\n',"slice.glsl":"#ifdef SLICE\nuniform vec3 slicePlaneOrigin;\nuniform vec3 slicePlaneBasis1;\nuniform vec3 slicePlaneBasis2;\n\nstruct SliceFactors {\n  float front;\n  float side0;\n  float side1;\n  float side2;\n  float side3;\n};\n\nSliceFactors calculateSliceFactors(vec3 pos) {\n  vec3 rel = pos - slicePlaneOrigin;\n\n  vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\n  float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\n\n  float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\n  float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\n\n  float basis1Dot = dot(slicePlaneBasis1, rel);\n  float basis2Dot = dot(slicePlaneBasis2, rel);\n\n  return SliceFactors(\n    dot(slicePlaneNormal, pos) + slicePlaneW,\n    -basis1Dot - basis1Len2,\n    basis1Dot - basis1Len2,\n    -basis2Dot - basis2Len2,\n    basis2Dot - basis2Len2\n  );\n}\n\nbool sliceByFactors(SliceFactors factors) {\n  return factors.front < 0.0\n    && factors.side0 < 0.0\n    && factors.side1 < 0.0\n    && factors.side2 < 0.0\n    && factors.side3 < 0.0;\n}\n\nbool sliceByPlane(vec3 pos) {\n  return sliceByFactors(calculateSliceFactors(pos));\n}\n\n#ifdef EXTENSIONS_ENABLED\n\nvec4 applySliceHighlight(vec4 color, vec3 pos) {\n  SliceFactors factors = calculateSliceFactors(pos);\n\n  if (sliceByFactors(factors)) {\n    return color;\n  }\n\n  const float HIGHLIGHT_WIDTH = 1.0;\n  const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);\n\n  factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n  factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n  factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n  factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n  factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n  float highlightFactor = (1.0 - step(0.5, factors.front))\n    * (1.0 - step(0.5, factors.side0))\n    * (1.0 - step(0.5, factors.side1))\n    * (1.0 - step(0.5, factors.side2))\n    * (1.0 - step(0.5, factors.side3));\n\n  return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n}\n\n#else // EXTENSIONS_ENABLED\n\n// GL_OES_standard_derivatives must be enabled for applySliceHighlight\n\n#endif // EXTENSIONS_ENABLED\n\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n#define highlightSlice(_color_, _pos_) applySliceHighlight(_color_, _pos_)\n\n#else // SLICE\n\n#define rejectBySlice(_pos_) false\n#define discardBySlice(_pos_) {}\n#define highlightSlice(_color_, _pos_) (_color_)\n\n#endif // SLICE\n","visualVariables.glsl":"#if defined(VV_SIZE)\n  #define VV_CUSTOM_MODEL_MATRIX\n#endif\n\n#if defined(VV_SIZE)\n  uniform vec3 vvSizeMinSize;\n  uniform vec3 vvSizeMaxSize;\n  uniform vec3 vvSizeOffset;\n  uniform vec3 vvSizeFactor;\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  uniform vec3 vvSizeValue;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform mat3 vvSymbolRotationMatrix;\n#endif\n\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  uniform vec3 vvSymbolAnchor;\n#endif\n\n#ifdef VV_COLOR\n  #define VV_COLOR_N 8\n  uniform float vvColorValues[VV_COLOR_N];\n  uniform vec4 vvColorColors[VV_COLOR_N];\n#endif\n\n// Evaluation of size\n#if defined(VV_SIZE)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n  }\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\n  vec3 vvGetScale(vec4 featureAttribute) {\n    return vvSizeValue;\n  }\n#endif\n\n// Applying the model matrix\n#ifdef VV_CUSTOM_MODEL_MATRIX\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\n    return vec4(vvSymbolRotationMatrix * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n  }\n\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\n    // Normal transform is the inverse transpose of model transform\n    return vec4(vvSymbolRotationMatrix * normal / vvGetScale(featureAttribute), 1.0);\n  }\n#endif\n\n#ifdef VV_COLOR\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n    float value = featureAttribute.y;\n    if (value <= values[0]) {\n      return colors[0];\n    }\n\n    for (int i = 1; i < VV_COLOR_N; ++i) {\n      if (values[i] >= value) {\n        float f = (value - values[i-1]) / (values[i] - values[i-1]);\n        return mix(colors[i-1], colors[i], f);\n      }\n    }\n\n    return colors[VV_COLOR_N - 1];\n  }\n#endif\n","vsPrecision.glsl":"precision highp float;\nprecision highp sampler2D;\n"}}}.apply(null,n))||(e.exports=i)},VW5z:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("oxlp"),r("zF3d"),r("BwdQ"),r("Dk48"),r("mmEe"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d){Object.defineProperty(t,"__esModule",{value:!0});var f=d.VertexAttrConstants,p=new o,h=a.vec3f64.create(),v=a.vec3f64.create(),m=a.vec3f64.create(),g=n.mat4f64.create(),y=a.vec3f64.create(),b={verticalDistanceToGround:0,terrainElevation:0};t.perVertexElevationAligner=function(e,r,n,i){var a=e.stageObject,o=n.spatialReference;p.spatialReference=o;for(var l=a.getGeometryRecords(),u=l.length,d="absolute-height"!==r.mode,g=0,y=0;y<u;y++){var x=l[y].geometry,_=l[y].getShaderTransformation();v[0]=_[12],v[1]=_[13],v[2]=_[14],x.invalidateBoundingInfo();for(var S=x.data.getVertexAttr(),w=S[f.POSITION],C=w.data,P=S.mapPos.data,E=w.size,T=C.length/E,O=0,A=0,R=!1,M=0,I=0;I<T;I++){p.x=P[A++],p.y=P[A++],p.z=P[A++],m[0]=C[O],m[1]=C[O+1],m[2]=C[O+2];var D=s.computeElevation(n,p,r,i,d?b:null);if(d&&(M+=b.terrainElevation),h[0]=C[O]+v[0],h[1]=C[O+1]+v[1],h[2]=C[O+2]+v[2],i.setAltitude(D,h),C[O]=h[0]-v[0],C[O+1]=h[1]-v[1],C[O+2]=h[2]-v[2],c.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)R=!0;else{var V=t.updateThresholdInMeters/i.unitInMeters;(Math.abs(m[0]-C[O])>=V||Math.abs(m[1]-C[O+1])>=V||Math.abs(m[2]-C[O+2])>=V)&&(R=!0)}O+=E}g+=M/T,R&&a.geometryVertexAttrsUpdated(y)}return g/u},t.perObjectElevationAligner=function(e,n,a,o,d){var f=e.stageObject,p=n.centerPointInElevationSR,v=0,m=0;if(f.metadata.usesVerticalDistanceToGround)v=s.computeElevation(a,p,n,o,b),l.updateVertexAttributeAuxpos1w(f,b.verticalDistanceToGround),m=b.terrainElevation;else{var g="absolute-height"!==n.mode;v=s.computeElevation(a,p,n,o,g?b:null),g&&(m=b.terrainElevation)}var _=r.mat4.copy(x,f.objectTransformation),S=i.vec3.set(y,_[12],_[13],_[14]);c.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(h[0]=p.x,h[1]=p.y,h[2]=v,u.computeLinearTransformation(p.spatialReference,h,_,o.spatialReference)&&(f.objectTransformation=_)):o.setAltitudeOfTransformation(v,_);var w=t.updateThresholdInMeters/o.unitInMeters;return(Math.abs(_[12]-S[0])>=w||Math.abs(_[13]-S[1])>=w||Math.abs(_[14]-S[2])>=w)&&(f.objectTransformation=_),m};var x=n.mat4f64.create();t.perLodInstanceElevationAligner=function(e,r,n,a,o){var l,d=r.centerPointInElevationSR,f=0,p="absolute-height"!==r.mode;l=s.computeElevation(n,d,r,a,p?b:null),p&&(f=b.terrainElevation);var v=e.graphics3DSymbolLayer.lodRenderer.instanceData,m=e.instanceIndex,x=g;v.getGlobalTransform(m,x);var _=i.vec3.set(y,x[12],x[13],x[14]);c.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(h[0]=d.x,h[1]=d.y,h[2]=l,u.computeLinearTransformation(d.spatialReference,h,x,a.spatialReference)&&v.setGlobalTransform(m,x)):a.setAltitudeOfTransformation(l,x);var S=t.updateThresholdInMeters/a.unitInMeters;return(Math.abs(x[12]-_[0])>=S||Math.abs(x[13]-_[1])>=S||Math.abs(x[14]-_[2])>=S)&&v.setGlobalTransform(m,x),f},t.updateThresholdInMeters=.01,t.iterativeUpdatesEnabled=!0}.apply(null,n))||(e.exports=i)},VfPl:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("pIuP"),r("fHyw"),r("zlCF"),r("bduU"),r("hQPx"),r("MI3s")],void 0===(i=function(e,t,r,n,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float32Array,t,r,n,i)||this;return a.elementType="f32",a}return r(t,e),t.ElementType="f32",t}(a.BufferViewScalarImpl);t.BufferViewFloat=c;var u=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float32Array,t,r,n,i)||this;return a.elementType="f32",a}return r(t,e),t.ElementType="f32",t}(o.BufferViewVec2Impl);t.BufferViewVec2f=u;var d=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float32Array,t,r,n,i)||this;return a.elementType="f32",a}return r(t,e),t.ElementType="f32",t}(s.BufferViewVec3Impl);t.BufferViewVec3f=d;var f=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float32Array,t,r,n,i)||this;return a.elementType="f32",a}return r(t,e),t.ElementType="f32",t}(l.BufferViewVec4Impl);t.BufferViewVec4f=f;var p=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float32Array,t,r,n,i)||this;return a.elementType="f32",a}return r(t,e),t.ElementType="f32",t}(n.BufferViewMat3Impl);t.BufferViewMat3f=p;var h=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float64Array,t,r,n,i)||this;return a.elementType="f64",a}return r(t,e),t.ElementType="f64",t}(n.BufferViewMat3Impl);t.BufferViewMat3f64=h;var v=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float32Array,t,r,n,i)||this;return a.elementType="f32",a}return r(t,e),t.ElementType="f32",t}(i.BufferViewMat4Impl);t.BufferViewMat4f=v;var m=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float64Array,t,r,n,i)||this;return a.elementType="f64",a}return r(t,e),t.ElementType="f64",t}(i.BufferViewMat4Impl);t.BufferViewMat4f64=m;var g=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float64Array,t,r,n,i)||this;return a.elementType="f64",a}return r(t,e),t.ElementType="f64",t}(a.BufferViewScalarImpl);t.BufferViewFloat64=g;var y=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float64Array,t,r,n,i)||this;return a.elementType="f64",a}return r(t,e),t.ElementType="f64",t}(o.BufferViewVec2Impl);t.BufferViewVec2f64=y;var b=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float64Array,t,r,n,i)||this;return a.elementType="f64",a}return r(t,e),t.ElementType="f64",t}(s.BufferViewVec3Impl);t.BufferViewVec3f64=b;var x=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Float64Array,t,r,n,i)||this;return a.elementType="f64",a}return r(t,e),t.ElementType="f64",t}(l.BufferViewVec4Impl);t.BufferViewVec4f64=x;var _=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint8Array,t,r,n,i)||this;return a.elementType="u8",a}return r(t,e),t.ElementType="u8",t}(a.BufferViewScalarImpl);t.BufferViewUint8=_;var S=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint8Array,t,r,n,i)||this;return a.elementType="u8",a}return r(t,e),t.ElementType="u8",t}(o.BufferViewVec2Impl);t.BufferViewVec2u8=S;var w=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint8Array,t,r,n,i)||this;return a.elementType="u8",a}return r(t,e),t.ElementType="u8",t}(s.BufferViewVec3Impl);t.BufferViewVec3u8=w;var C=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint8Array,t,r,n,i)||this;return a.elementType="u8",a}return r(t,e),t.ElementType="u8",t}(l.BufferViewVec4Impl);t.BufferViewVec4u8=C;var P=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint16Array,t,r,n,i)||this;return a.elementType="u16",a}return r(t,e),t.ElementType="u16",t}(a.BufferViewScalarImpl);t.BufferViewUint16=P;var E=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint16Array,t,r,n,i)||this;return a.elementType="u16",a}return r(t,e),t.ElementType="u16",t}(o.BufferViewVec2Impl);t.BufferViewVec2u16=E;var T=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint16Array,t,r,n,i)||this;return a.elementType="u16",a}return r(t,e),t.ElementType="u16",t}(s.BufferViewVec3Impl);t.BufferViewVec3u16=T;var O=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint16Array,t,r,n,i)||this;return a.elementType="u16",a}return r(t,e),t.ElementType="u16",t}(l.BufferViewVec4Impl);t.BufferViewVec4u16=O;var A=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint32Array,t,r,n,i)||this;return a.elementType="u32",a}return r(t,e),t.ElementType="u32",t}(a.BufferViewScalarImpl);t.BufferViewUint32=A;var R=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint32Array,t,r,n,i)||this;return a.elementType="u32",a}return r(t,e),t.ElementType="u32",t}(o.BufferViewVec2Impl);t.BufferViewVec2u32=R;var M=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint32Array,t,r,n,i)||this;return a.elementType="u32",a}return r(t,e),t.ElementType="u32",t}(s.BufferViewVec3Impl);t.BufferViewVec3u32=M;var I=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Uint32Array,t,r,n,i)||this;return a.elementType="u32",a}return r(t,e),t.ElementType="u32",t}(l.BufferViewVec4Impl);t.BufferViewVec4u32=I;var D=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int8Array,t,r,n,i)||this;return a.elementType="i8",a}return r(t,e),t.ElementType="i8",t}(a.BufferViewScalarImpl);t.BufferViewInt8=D;var V=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int8Array,t,r,n,i)||this;return a.elementType="i8",a}return r(t,e),t.ElementType="i8",t}(o.BufferViewVec2Impl);t.BufferViewVec2i8=V;var L=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int8Array,t,r,n,i)||this;return a.elementType="i8",a}return r(t,e),t.ElementType="i8",t}(s.BufferViewVec3Impl);t.BufferViewVec3i8=L;var F=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int8Array,t,r,n,i)||this;return a.elementType="i8",a}return r(t,e),t.ElementType="i8",t}(l.BufferViewVec4Impl);t.BufferViewVec4i8=F;var B=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int16Array,t,r,n,i)||this;return a.elementType="i16",a}return r(t,e),t.ElementType="i16",t}(a.BufferViewScalarImpl);t.BufferViewInt16=B;var N=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int16Array,t,r,n,i)||this;return a.elementType="i16",a}return r(t,e),t.ElementType="i16",t}(o.BufferViewVec2Impl);t.BufferViewVec2i16=N;var U=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int16Array,t,r,n,i)||this;return a.elementType="i16",a}return r(t,e),t.ElementType="i16",t}(s.BufferViewVec3Impl);t.BufferViewVec3i16=U;var z=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int16Array,t,r,n,i)||this;return a.elementType="i16",a}return r(t,e),t.ElementType="i16",t}(l.BufferViewVec4Impl);t.BufferViewVec4i16=z;var j=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int32Array,t,r,n,i)||this;return a.elementType="i32",a}return r(t,e),t.ElementType="i32",t}(a.BufferViewScalarImpl);t.BufferViewInt32=j;var G=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int32Array,t,r,n,i)||this;return a.elementType="i32",a}return r(t,e),t.ElementType="i32",t}(o.BufferViewVec2Impl);t.BufferViewVec2i32=G;var H=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int32Array,t,r,n,i)||this;return a.elementType="i32",a}return r(t,e),t.ElementType="i32",t}(s.BufferViewVec3Impl);t.BufferViewVec3i32=H;var k=function(e){function t(t,r,n,i){void 0===r&&(r=0);var a=e.call(this,Int32Array,t,r,n,i)||this;return a.elementType="i32",a}return r(t,e),t.ElementType="i32",t}(l.BufferViewVec4Impl);t.BufferViewVec4i32=k}.apply(null,n))||(e.exports=i)},W0kZ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this._count=0}return e.prototype.gen=function(e){return null==e&&(e="a"),e+"_"+this._count++},e}()}.apply(null,n))||(e.exports=i)},W5Zm:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*o,u=0;u<s;++u)n[l]=a[c],n[l+1]=a[c+1],n[l+2]=a[c+2],l+=i,c+=o}}.apply(null,n))||(e.exports=i)},W7eI:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("MzcX"),r("2B1V")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeInputBufferLayout=n.newLayout().vec3f("position").u16("componentIndex").u16("_padding"),t.VertexLayout=n.newLayout().vec2u8("sideness"),t.glVertexLayout=r.glLayout(t.VertexLayout,{prefixA:!0}),t.CommonInstancesLayout=n.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0}),t.RegularEdgeInstancesLayout=t.CommonInstancesLayout.clone().vec3f("normal"),t.SilhouetteEdgeInstancesLayout=t.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB"),t.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}.apply(null,n))||(e.exports=i)},WRNQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("LxLY"),r("jBNx"),r("DIqE"),r("dZE1"),r("VW5z"),r("s4LJ"),r("zF3d"),r("JzVu"),r("BwdQ"),r("ys4y"),r("4ziW"),r("K9FT"),r("fZgo"),r("xFEL")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m){function g(e,t,r){e&&e.forEach(function(e){var n=t(e);n&&r(n,e.graphic)})}Object.defineProperty(t,"__esModule",{value:!0});var y=[0,0,1],b=function(e){function t(t,r,n,i){var a=e.call(this,t,r,n,i)||this;if(a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},!a._isPropertyDriven("size")){var o=d.validateSymbolLayerSize(a.symbolLayer.size);if(o)return a._logWarning(o),a.reject(),a}return a._createTextRenderParameters(),a.resolve(),a}return r(t,e),t.prototype._createTextRenderParameters=function(){var e=this._context.layerView.view.pixelRatio;this._textRenderParameters=h.default.fromSymbol(this.symbolLayer,e)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject()},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic,r=c.placePointOnGeometry(t.geometry);if(!r)return this._logWarning("unsupported geometry type for text symbol: "+t.geometry.type),null;var n=this.symbolLayer.text;if(!n)return null;var i=o.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(t,r,n,i)},t.prototype.createLabel=function(e,t,r,n){var i=e.graphic,a=c.placePointOnGeometry(i.geometry);if(!a)return this._logWarning("unsupported geometry type for label: "+i.geometry.type),null;var o=t.text;return o?this._createAs3DShape(i,a,o,t,t,r,n):null},t.prototype.getGraphicElevationContext=function(t,r){void 0===r&&(r=0);var n=e.prototype.getGraphicElevationContext.call(this,t);return n.addOffsetRenderUnits(r),n},t.prototype.layerOpacityChanged=function(){return this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1},t.prototype.layerElevationInfoChanged=function(e,t){var r=this;return g(e,t,function(e,t){r.updateGraphicElevationContext(t,e)}),!0},t.prototype.slicePlaneEnabledChanged=function(e,t){var r=this;return g(e,t,function(e){for(var t=0,n=e.stageObject.geometryRecords;t<n.length;t++)n[t].material.setParameterValues({slicePlaneEnabled:r._context.slicePlaneEnabled})}),!0},t.prototype.pixelRatioChanged=function(e,t){return!1},t.prototype.updateGraphicElevationContext=function(e,t){var r=this.getGraphicElevationContext(e,t.metadata.elevationOffset);t.elevationContext.set(r),t.needsElevationUpdates=c.needsElevationUpdates2D(r.mode)||"absolute-height"===r.mode},t.prototype._defaultElevationInfoNoZ=function(){return x},t.prototype._createAs3DShape=function(e,t,r,o,u,h,g){void 0===u&&(u=_);var b=this.getGraphicElevationContext(e,u.elevationOffset),x=this._context.layer.id+"_label_"+e.uid,S="polyline"===e.geometry.type,w=e.uid,C=this._context.stage.view.renderingContext,P=u.anchor in d.namedAnchorToHUDMaterialAnchorPos?u.anchor:"center",E=d.namedAnchorToHUDMaterialAnchorPos[P],T=n.isNone(g)?new v(C,r,this._textRenderParameters,x):null,O={occlusionTest:!0,screenOffset:u.screenOffset,anchorPos:E,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:u.centerOffsetUnits,debugDrawBorder:u.debugDrawBorder,drawInSecondSlot:!0};if(n.isSome(T)&&(O.textureId=T.id,O.texCoordScale=T.texcoordScale),n.isSome(g)&&(O.textureId=g.textureId),n.isSome(o)&&n.isSome(o.verticalOffset)){var A=o.verticalOffset,R=A.screenLength,M=A.minWorldLength,I=A.maxWorldLength;O.verticalOffset={screenLength:i.pt2px(R),minWorldLength:M||0,maxWorldLength:null!=I?I:1/0}}if(this._context.screenSizePerspectiveEnabled){var D=this._context.sharedResources,V=D.screenSizePerspectiveSettings,L=D.screenSizePerspectiveSettingsLabels;O.screenSizePerspective=L.overridePadding(this._textRenderParameters.haloSize),O.screenSizePerspectiveAlignment=V}S&&(O.shaderPolygonOffset=1e-4),O.slicePlaneEnabled=this._context.slicePlaneEnabled;var F=null,B=JSON.stringify(O);n.isSome(h)?null==(F=h.getMaterial(B))&&(F=new m(O,x),h.addMaterial(B,F)):F=new m(O,x);var N=[F],U=p.createPointGeometry(y,u.translation,void 0,n.isSome(T)?[T.displayWidth,T.displayHeight]:[0,0],u.centerOffset,n.isSome(g)?[0,0]:null),z=[new f(U,x)],j=this._context.layer.uid,G=c.createStageObjectForPoint(this._context,t,z,N,null,null,b,x,j,w,!0);if(null===G)return null;var H=s.perObjectElevationAligner,k=new l(this,G.object,z,n.isNone(h)?N:null,n.isSome(T)?[T]:null,H,b);k.alignedTerrainElevation=G.terrainElevation,k.needsElevationUpdates=c.needsElevationUpdates2D(b.mode)||"absolute-height"===b.mode;var W=n.isSome(T)?T:u,q=W.displayWidth,X=W.displayHeight;k.getScreenSize=function(e){return void 0===e&&(e=a.vec2f64.create()),e[0]=q,e[1]=X,e};var Y={labelText:r,elevationOffset:u.elevationOffset};return k.metadata=Y,c.extendPointGraphicElevationContext(k,t,this._context.elevationProvider),k},t}(u.default);t.Graphics3DTextSymbolLayer=b;var x={mode:"relative-to-ground",offset:0},_={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};t.default=b}.apply(null,n))||(e.exports=i)},WsO6:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("BcWh"),r("7MDj"),r("NfRO"),r("qsST"),r("SZNs"),r("qMld"),r("Vx27")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u){return function(e){function t(t){var r=e.call(this)||this;return r.layer=null,r.parent=null,r.view=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";return s.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+n+"', id: '"+r+"')",t),c.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},n([u.property()],t.prototype,"layer",void 0),n([u.property()],t.prototype,"parent",void 0),n([u.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),n([u.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),n([u.property()],t.prototype,"view",void 0),n([u.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),n([u.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),n([u.subclass("esri.views.layers.LayerView")],t)}(u.declared(a,i,o.Identifiable,l))}.apply(null,n))||(e.exports=i)},XCS5:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+")],void 0===(i=function(e,t,r){return function(){function e(e){null==e?e=16:e<65536&&(e=r.nextHighestPowerOfTwo(e)),this.array=new Float32Array(e),this.size=0}return e.prototype.resize=function(e,t){var r,n;if(void 0===t&&(t=!1),this.size=e,this.size>this.array.length){for(r=this.array.length||1;r<this.size;)r*=2;return n=new Float32Array(r),t&&n.set(this.array),this.array=n,!0}if(this.size<=this.array.length/2){r=this.array.length;for(var i=2*this.size;r>=i;)r=Math.floor(r/2);return n=new Float32Array(r),t&&n.set(this.array.subarray(0,r)),this.array=n,!0}return!1},e.prototype.append=function(e){var t=this.size;this.resize(this.size+e.length,!0),this.array.set(e,t)},e.prototype.erase=function(e,t){for(var r=e;r<t;++r)this.array[r]=0},e.prototype.getArray=function(){return this.array},e.prototype.getSize=function(){return this.size},e}()}.apply(null,n))||(e.exports=i)},XIUG:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("GNH0"),r("s4LJ"),r("foHJ"),r("LiJt"),r("LFjk")],void 0===(i=function(e,t,r,n,i,a,o,s){return function(e){function t(t,r,n){var i=e.call(this)||this;i._symbol=t,i.referenced=0;var o=t.symbolLayers;n&&(o=n.concat(o));var s=o.length;i.childGraphics3DSymbols=new Array(o.length),i.childGraphics3DSymbolPromises=new Array(o.length);for(var l=r.layerOrder,c=0,u=0,d=function(e,t){t&&(i.childGraphics3DSymbols[e]=t,u++),c--,!i.isRejected()&&c<1&&(u>0?i.resolve():i.reject())},f=0;f<s;f++){var p=o.getItemAt(f);if(!1!==p.enabled){r.layerOrder=l+(1-(1+f)/s),r.layerOrderDelta=1/s;var h=a.make(i.symbol,p,r,p._ignoreDrivers);h&&(c++,i.childGraphics3DSymbolPromises[f]=h)}}if(r.layerOrder=l,0===c)i.resolve();else{var v=this;for(f=0;f<s;f++)!function(e){var t=v.childGraphics3DSymbolPromises[e];t&&t.then(function(){return d(e,t)},function(){return d(e,null)})}(f)}return i}return r(t,e),t.prototype.getSymbolLayerSize=function(e,t){var r=this;this.then(function(){var n=r.childGraphics3DSymbols[e];t(n?n.getCachedSize():null)},function(){return t(null)})},Object.defineProperty(t.prototype,"symbol",{get:function(){return this._symbol},set:function(e){if(this._symbol=e,this.childGraphics3DSymbols)for(var t=0;t<e.symbolLayers.length;t++){var r=this.childGraphics3DSymbols[t];r&&(r.symbol=e,r.symbolLayer=e.symbolLayers.items[t])}},enumerable:!0,configurable:!0}),t.prototype.createGraphics3DGraphic=function(e,t){for(var r=e.graphic,i=new Array(this.childGraphics3DSymbols.length),a=0;a<this.childGraphics3DSymbols.length;a++){var o=this.childGraphics3DSymbols[a];o&&(i[a]=o.createGraphics3DGraphic(e))}return new n(r,t||this,i,e.layer)},Object.defineProperty(t.prototype,"complexity",{get:function(){return o.totalSymbolComplexities(this.childGraphics3DSymbols.map(function(e){return e&&e.complexity}))},enumerable:!0,configurable:!0}),t.prototype.globalPropertyChanged=function(e,t){for(var r=this.childGraphics3DSymbols.length,n=this,a=0;a<r;a++){var o=function(r){var a=n.childGraphics3DSymbols[r];if(a&&!a.globalPropertyChanged(e,t,function(e){var t=e._graphics[r];return t instanceof i?t:null}))return{value:!1}}(a);if("object"==typeof o)return o.value}return!0},t.prototype.applyRendererDiff=function(e,t){return!!this.isResolved()&&this.childGraphics3DSymbols.reduce(function(r,n,i){return r&&(!n||n.applyRendererDiff(e,t))},!0)},t.prototype.prepareSymbolPatch=function(e){if(!this.isRejected()&&"partial"===e.diff.type){var t=e.diff.diff;if(t.symbolLayers&&"partial"===t.symbolLayers.type){var r=t.symbolLayers.diff;(this.isResolved()?this.childGraphics3DSymbols:this.childGraphics3DSymbolPromises).forEach(function(t,n){var i;if(t){var a=r[n];if(a){var o={diff:a,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(o),(i=e.symbolStatePatches).push.apply(i,o.symbolLayerStatePatches),o.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push(function(e,t){var r=e._graphics[n];o.graphics3DGraphicPatches.forEach(function(e){return e(r,t)})})}}})}}},t.prototype.updateGeometry=function(e,t){for(var r=0;r<this.childGraphics3DSymbols.length;r++){var n=this.childGraphics3DSymbols[r];if(n&&!n.updateGeometry(e._graphics[r],t))return!1}return!0},t.prototype.getFastUpdateStatus=function(){var e=0,t=0,r=0;return this.childGraphics3DSymbolPromises.forEach(function(n){n&&!n.isFulfilled()?e++:n&&n.isFastUpdatesEnabled()?r++:n&&t++}),{loading:e,slow:t,fast:r}},t.prototype.setDrawOrder=function(e,t){for(var r=this.childGraphics3DSymbols.length,n=1/r,i=0;i<r;i++){var a=this.childGraphics3DSymbols[i];if(a){var o=e+(1-(1+i)/r);a.setDrawOrder(o,n,t)}}},t.prototype.destroy=function(){if(!this.destroyed){this.isFulfilled()||this.reject();for(var e=0;e<this.childGraphics3DSymbolPromises.length;e++)this.childGraphics3DSymbolPromises[e]&&this.childGraphics3DSymbolPromises[e].destroy();this.childGraphics3DSymbolPromises=null,this.childGraphics3DSymbols=null}},Object.defineProperty(t.prototype,"destroyed",{get:function(){return null==this.childGraphics3DSymbols},enumerable:!0,configurable:!0}),t}(s.default)}.apply(null,n))||(e.exports=i)},XJx5:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("TMur"),r("Gtr7"),r("ma1f"),r("qMld"),r("Vx27"),r("lRq4"),r("ZcgO"),r("w1v0")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d){var f=function(e){function t(t){var r=e.call(this)||this;return r.features=null,r.layer=null,r.objectIdField=null,r.dataSpatialReference=null,r}return r(t,e),t.prototype.queryFeatures=function(e){var t=this;return this._queryFeatures(e).then(function(e){var r=e.map(function(e){return u.hydrateGraphic(e,t.layer)});return new d({features:r,fields:t.layer?t.layer.fields.slice():null,geometryType:t.layer?t.layer.geometryType:null,spatialReference:t.dataSpatialReference?t.dataSpatialReference.clone():null})})},t.prototype.queryObjectIds=function(e){var t=this;return this.objectIdField?this.queryFeatures(e).then(function(e){return t._getObjectIds(e.features)}):this._rejectQuery("Unsupported query")},t.prototype.queryFeatureCount=function(e){return this.features&&!e?s.resolve(this.features.length):this._queryFeatures(e).then(function(e){return e.length})},t.prototype.queryExtent=function(e){var t=this;return this.queryFeatures(e).then(function(e){return{count:e.features.length,extent:t._getExtent(e.features)}})},t.prototype._queryFeatures=function(e){if(this.features){if(e){if(this._isSupportedQuery(e)){var t=this._createFilters(e);return t.length?this._executeQuery(e,t):this._rejectQuery("Invalid query")}return this._rejectQuery("Unsupported query")}return this._returnAllFeatures()}return this._rejectQuery("Engine not initialized")},t.prototype._returnAllFeatures=function(){return s.resolve(this.features.toArray())},t.prototype._executeQuery=function(e,t){var r=this,n=[];return this.features.forEach(function(i){t.every(function(t){return t.call(r,i,e)})&&n.push(i)}),s.resolve(n)},t.prototype._isSupportedQuery=function(e){var t=!0;return(null!=e.distance||null!=e.geometryPrecision||e.groupByFieldsForStatistics&&e.groupByFieldsForStatistics.length||null!=e.maxAllowableOffset||e.multipatchOption||null!=e.num||e.orderByFields&&e.orderByFields.length||e.outFields&&e.outFields.length||e.outSpatialReference||e.outStatistics&&e.outStatistics.length||e.pixelSize||e.quantizationParameters||e.relationParameter||e.returnDistinctValues||null!=e.start||e.text||e.timeExtent||e.where||e.objectIds&&e.objectIds.length&&!this.objectIdField)&&(t=!1),t},t.prototype._createFilters=function(e){var t=[];return e.objectIds&&e.objectIds.length&&t.push(this._createObjectIdFilter()),e.geometry&&"extent"===e.geometry.type&&"intersects"===e.spatialRelationship&&t.push(this._createExtentFilter()),t},t.prototype._createExtentFilter=function(){return function(e,t){var r=e.geometry;if(!r)return!1;var n=t.geometry;return c.fromExtent(n,p),u.computeAABR(r,h),c.intersects(p,h)}},t.prototype._createObjectIdFilter=function(){var e=this;return function(t,r){var n=t.attributes,i=n&&n[e.objectIdField];return r.objectIds.indexOf(i)>-1}},t.prototype._rejectQuery=function(e){return s.reject(new o(this.declaredClass,e))},t.prototype._getObjectIds=function(e){var t=this.objectIdField,r=[];return e.forEach(function(e){var n=e.attributes,i=n&&n[t];null!=i&&r.push(i)}),r},t.prototype._getExtent=function(e){if(0===e.length)return null;c.empty(p);for(var t=0;t<e.length;t++){var r=e[t].geometry;u.computeAABR(r,h),c.expand(p,h,p)}return new i.Extent({xmin:p[0],ymin:p[1],xmax:p[2],ymax:p[3],spatialReference:e[0].geometry.spatialReference})},n([l.property()],t.prototype,"features",void 0),n([l.property({constructOnly:!0})],t.prototype,"layer",void 0),n([l.property()],t.prototype,"objectIdField",void 0),n([l.property()],t.prototype,"dataSpatialReference",void 0),n([l.subclass("esri.layers.graphics.QueryEngine")],t)}(l.declared(a)),p=c.create(),h=c.create();return f}.apply(null,n))||(e.exports=i)},Xih7:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KY0m"),r("9sIV"),r("05NA"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a){return function(){function e(e){this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this._dirtyMaterials=new Set,this._model=e}return Object.defineProperty(e.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"residentObjectCount",{get:function(){var e=0;return this._residentGeomRecords.forEach(function(t){e+=t.size}),e},enumerable:!0,configurable:!0}),e.prototype.getDirtyMaterials=function(){return this._dirtyMaterials.size>0?this._dirtyMaterials:null},e.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()},e.prototype.hasDirtyGeometryRecords=function(){var e=!1;return n.everyMap(this._dirtyGeomRecords,function(t){if(e)return!1;n.everyMap(t,function(t){if(!e&&t&&t.size>0)return e=!0,!1})}),e},e.prototype.handleUpdate=function(e,t,r){return a.assert(this[t],"ModelDirtySet doesn't know how to process "+t),this[t](e,r)},e.prototype.shaderTransformationChanged=function(e){var t=this,r=this._residentGeomRecords.get(e.id);r&&r.forEach(function(e,r){var n=t._model.content[i.OBJECT][r];n&&n.hasVolativeTransformation()&&e.forEach(function(e){for(var t=0,r=e[1];t<r.length;t++)r[t].shaderTransformationChanged()})})},e.prototype.commit=function(){return this.commitLayers(r.keysOfMap(this._dirtyGeomRecords))},e.prototype.commitLayers=function(e){for(var t=this,r=[],n=[],o=[],s=this,l=0;l<e.length;l++)!function(l){var c=e[l],u=s._dirtyGeomRecords.get(c);if(!u)return"continue";u.forEach(function(e,s){var l=t._ensureGeomRecord(c,s);e.forEach(function(e,c){var u,d=e[0],f=e[1],p=e[2],h=!1;if(2&f)if(u=l.get(c)){var v=u[1];if(4&p)for(var m=t._model.get(i.OBJECT,s),g=0,y=v;g<y.length;g++){var b=y[g];if(t._model.updateRenderGeometryTransformation(m,d,b)){h=!0;break}}if(!h)for(var x=0,_=v;x<_.length;x++){b=_[x];o.push({renderGeometry:b,updateType:p})}}else a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update");(4&f||h)&&((u=l.get(c))?n.push.apply(n,u[1]):4===f&&a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),u&&l.delete(c));if(1&f||h){var S=[d,[]];m=t._model.get(i.OBJECT,s);t._model.getGeometryRenderGeometries(m,d,S[1]),r.push.apply(r,S[1]),l.set(c,S)}}),0===l.size&&t._residentGeomRecords.get(c).delete(s)}),0===s._residentGeomRecords.get(c).size&&s._residentGeomRecords.delete(c),s._dirtyGeomRecords.delete(c)}(l);return[r,n,o]},e.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(r.keysOfMap(this._residentGeomRecords))},e.prototype.getResidentRenderGeometriesFilteredByLayers=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=this._residentGeomRecords.get(n);i&&i.forEach(function(e){e.forEach(function(e){t.push.apply(t,e[1])})})}return t},e.prototype.visibilityChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,1);else for(var n=0,i=e.getGeometryRecords();n<i.length;n++){var a=i[n];this._componentPropertyChanged(e,a,r,1)}},e.prototype.componentHighlightChanged=function(e,t,r){if(null!=t)this._componentPropertyChanged(e,t,r,16);else for(var n=0,i=e.getGeometryRecords();n<i.length;n++){var a=i[n];this._componentPropertyChanged(e,a,r,16)}},e.prototype.vertexAttrsUpdated=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,2)},e.prototype.matChanged=function(e){this._dirtyMaterials.add(e.id),this.onMaterialChanged&&this.onMaterialChanged(e)},e.prototype.layerAdded=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectAdded(e,t[r])},e.prototype.layerRemoved=function(e){for(var t=e.getObjects(),r=0;r<t.length;r++)this.layObjectRemoved(e,t[r])},e.prototype.layObjectAdded=function(e,t){for(var r=e.id,n=t.getGeometryRecords(),i=0;i<n.length;i++)this.objGeometryAdded(t,n[i],r)},e.prototype.layObjectRemoved=function(e,t){for(var r=e.id,n=t.getGeometryRecords(),i=0;i<n.length;i++)this.objGeometryRemoved(t,n[i],r)},e.prototype.layObjectReplaced=function(e,t){this.layObjectRemoved(e,t[0]),this.layObjectAdded(e,t[1])},e.prototype.objTransformation=function(e,t){var r=this;t=t||this._getParentLayerId(e);var n=e.id;this._ensureGeomRecord(t,n).forEach(function(n){r._updateOrCreateDirtyRecord(e,n[0],t,2,0,0,2,5,4)})},e.prototype.objGeometryAdded=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,1,4,0,0,0)},e.prototype.objGeometryRemoved=function(e,t,r){this._updateOrCreateDirtyRecord(e,t,r,4,1,2,0,0)},e.prototype.objGeometryReplaced=function(e,t){this.objGeometryRemoved(e,t[0]),this.objGeometryAdded(e,t[1])},e.prototype.objGeometryTransformation=function(e,t){this.objGeometryReplaced(e,t)},e.prototype._componentPropertyChanged=function(e,t,r,n){this._updateOrCreateDirtyRecord(e,t,r,2,0,0,2,5,n)},e.prototype._updateOrCreateDirtyRecord=function(e,t,r,n,i,o,s,l,c){r=r||this._getParentLayerId(e);var u=e.id,d=t.id,f=this._ensureDirtyRecord(r,u),p=f.get(d);if(p){var h=p[1];h&i?f.delete(d):h&o?(p[1]=n,p[2]=c):h&s?p[2]|=c:h&l||a.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")}else f.set(d,[t,n,c])},e.prototype._ensureGeomRecord=function(e,t){var r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));var n=r.get(t);return n||(n=new Map,r.set(t,n)),n},e.prototype._ensureDirtyRecord=function(e,t){var r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));var n=r.get(t);return n||(n=new Map,r.set(t,n)),n},e.prototype._getParentLayerId=function(e){return e.parentLayer.id},e.prototype.formatDebugInfo=function(e){if(e)return"";var t=["ADD","UPD",void 0,"REM"],r="";return this._dirtyGeomRecords.forEach(function(e,n){e.forEach(function(e,i){r.length>0&&(r+="\n"),r+=n+"."+i;var a=[];e.forEach(function(e){var t=e[1];a[t]||(a[t]=[]),a[t].push(e[0].geometry.id)});for(var o=0;o<a.length;o++)if(a[o]){r+=" "+t[o-1]+": ";for(var s=0;s<a[o].length;s++)r+=a[o][s]+", "}})}),r},e}()}.apply(null,n))||(e.exports=i)},"Yr/n":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zbgD"),r("U+8K")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return i.glslifyDefineMap({OCCL_TEST:e.occlTest,SIGNED_DISTANCE_FIELD:e.sdf,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:e.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:e.binaryHighlightOcclusion,SLICE:e.slice})},o=function(e){return i.glslifyDefineMap({VERTICAL_OFFSET:e.verticalOffset,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:e.centerOffsetUnitsScreen,SLICE:e.slice})};t.colorPass={name:"hud-color",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/hud/hud.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/hud/colorPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"hud-highlight",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/hud/hud.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:r.Default3D},t.occlusionPass={name:"hud-occlusion",shaders:function(e){return{vertexShader:o(e)+n.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:n.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},Ytki:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("PND3"),r("ma1f"),r("ZHL0"),r("1eyA")],void 0===(i=function(e,t,r,n,i,a){function o(e){if(!e)return null;var r=t.invalidClauseCache.get(e);if(void 0!==r)return r;var n,i=t.whereClausesCache.get(e);return void 0!==i?i:(n=a.create(e),t.whereClausesCache.put(e,n),n)}function s(e,t,r,i){void 0===i&&(i=!0);for(var a=[],u=0,d=t;u<d.length;u++){var f=d[u];if("*"!==f&&!e.has(f))if(i){var p=l(f);try{var h=o(p);if(!h.isStandardized())throw new n(c,"expression is not standard",{clause:h});s(e,h.getFields(),"expression contains missing fields")}catch(e){var v=e&&e.details;if(v&&v.clause)throw e;v&&v.missingFields?Array.prototype.push.apply(a,v.missingFields):a.push(f)}}else a.push(f)}if(a.length)throw new n(c,r,{missingFields:a})}function l(e){return e.split(u)[0]}Object.defineProperty(t,"__esModule",{value:!0}),t.invalidClauseCache=new i(500),t.whereClausesCache=new i(50);var c="feature-store:unsupported-query",u=" as ",d=new r.default(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);t.validateWhere=function(e,r){if(!r)return!0;var i;try{i=a.create(r),t.whereClausesCache.put(r,i)}catch(e){throw t.invalidClauseCache.put(r,null),new n(c,"invalid SQL expression",{where:r})}if(!i.isStandardized())throw new n(c,"where clause is not standard",{where:r});return s(e,i.getFields(),"where clause contains missing fields"),!0},t.validateHaving=function(e,r,i){if(!r)return!0;var o;try{o=a.create(r),t.whereClausesCache.put(r,o)}catch(e){throw t.invalidClauseCache.put(r,null),new n(c,"invalid SQL expression",{having:r})}if(!o.isAggregate())throw new n(c,"having does not contain a valid aggregate function",{having:r});var l=o.getFields();if(s(e,l,"having contains missing fields"),!o.getExpressions().every(function(t){var r=t.aggregateType,n=t.field,a=e.has(n)&&e.get(n).name;return i.some(function(t){var n=t.onStatisticField,i=t.statisticType,o=n.toLowerCase().trim();return(e.has(o)&&e.get(o).name)===a&&i.toLowerCase().trim()===r})}))throw new n(c,"expressions in having should also exist in outStatistics",{having:r});return!0},t.getWhereClause=o,t.validateFields=s,t.getExpressionFromFieldName=l,t.getAliasFromFieldName=function(e){return e.split(u)[1]},t.hasInvalidFieldType=function(e,t){var r=!1;if(-1!==o(e).getFields().indexOf(e)){var n=t.get(e);r=!d.has(n.type)}return r}}.apply(null,n))||(e.exports=i)},ZJC8:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("AzkI"),r("rjU6"),r("Cvn+"),r("xsp2"),r("W0kZ"),r("05NA"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f){var p=f.assert,h=n.mat4f64.create(),v=function(){function e(t){void 0===t&&(t={}),this._objectTransformation=n.mat4f64.create(),this._bvObjectSpace=new m,this._bvWorldSpace=new m,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._allComponentsHiddenDirty=!0,this._allComponentsVisibleDirty=!0,this.id=e._idGen.gen(t.idHint),this.name=t.name,this.castShadow=null==t.castShadow||t.castShadow,this.metadata=t.metadata,this.objectTransformation=n.mat4f64.create(),this._initializeGeometryRecords(t.geometries,t.materials,t.transformations,t.origins)}return Object.defineProperty(e.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(e){r.mat4.copy(this._objectTransformation,e),this._invalidateBoundingVolume(),this._notifyDirty("objTransformation")},enumerable:!0,configurable:!0}),e.prototype._initializeGeometryRecords=function(e,t,r,i){if(!Array.isArray(e))return this.geometryRecords=[],void(this.geometries=[]);p(t.length===e.length,"Object3D: materials don't match geometries"),p(r.length===e.length,"Object3D: transformations don't match geometries"),this.geometryRecords=new Array(e.length),this.geometries=e.slice();for(var a=0;a<e.length;a++){this.geometryRecords[a]=new l(e[a],t[a],n.mat4f64.clone(r[a]),{},i&&i[a])}this._hasVolatileTransformation=!1},Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(e){p(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e},enumerable:!0,configurable:!0}),e.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length},e.prototype.getFirstGeometryIndex=function(e){var t=this.geometries.indexOf(e);return p(t>-1,"Object3D.getFirstGeometryIndex: geometry not found"),t},e.prototype.findGeometryRecords=function(e){for(var t=[],r=0;r<this.geometries.length;r++)this.geometries[r]===e&&t.push(this.geometryRecords[r]);return t},e.prototype.getGeometryRecord=function(e){return p(e>=0&&e<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this.geometryRecords[e]},e.prototype.getGeometryRecords=function(){return this.geometryRecords},e.prototype.addGeometry=function(e,t,r,i,a,o){void 0===r&&(r=h),this.geometries.push(e);var s=new l(e,t,n.mat4f64.clone(r),i||{},a,o);return this.geometryRecords.push(s),this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.shaderTransformation}),this._notifyDirty("objGeometryAdded",s),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,this._allComponentsVisibleDirty=!0,s},e.prototype.hasGeometry=function(e){return this.geometries.indexOf(e)>-1},e.prototype.removeGeometry=function(e){var t=this.geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=this.geometryRecords.some(function(e){return!!e.shaderTransformation}),this.geometries.splice(e,1),this._notifyDirty("objGeometryRemoved",t),this._invalidateBoundingVolume(),this._allComponentsHiddenDirty=!0,this._allComponentsVisibleDirty=!0,t},e.prototype.removeAllGeometries=function(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)},e.prototype.geometryVertexAttrsUpdated=function(e){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[e]),this._invalidateBoundingVolume()},e.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1,this._allComponentsHidden=!0;for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],n=r.instanceParameters.componentVisibilities,i=r.geometry.data.componentOffsets;if(!s.isAllHidden(n,i)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden},e.prototype.areAllComponentsVisible=function(){if(this._allComponentsVisibleDirty){this._allComponentsVisibleDirty=!1,this._allComponentsVisible=!0;for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],n=r.instanceParameters.componentVisibilities,i=r.geometry.data.componentOffsets;if(!s.isAllVisible(n,i)){this._allComponentsVisible=!1;break}}}return this._allComponentsVisible},e.prototype.hasComponents=function(){for(var e=!1,t=0;t<this.geometries.length;t++){var r=this.geometries[t];if(e=s.hasComponents(r.data.componentOffsets))break}return e},e.prototype.setComponentVisibility=function(e,t,r){var n=e.geometry,i=e.instanceParameters.componentVisibilities,a=n.data.componentOffsets,o=s.updateVisibility(i,a,t,r);e.instanceParameters.componentVisibilities=o,this._notifyDirty("visibilityChanged",e),this._allComponentsHiddenDirty=!0,this._allComponentsVisibleDirty=!0},e.prototype.setHidden=function(e,t){e.instanceParameters.hidden=!!t,this._notifyDirty("visibilityChanged",e)},e.prototype.isHidden=function(e){return!!e.instanceParameters.hidden},e.prototype.getComponentVisibility=function(e,t){var r=e.instanceParameters.componentVisibilities;return s.getVisibility(r,t)},e.prototype.hideAllComponents=function(){if(this._allComponentsHiddenDirty||!this._allComponentsHidden){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],n=r.instanceParameters.componentVisibilities,i=s.hideAllComponents(n);r.instanceParameters.componentVisibilities=i}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!1,this._allComponentsVisibleDirty=!1,this._allComponentsHidden=!0,this._allComponentsVisible=!1}},e.prototype.unhideAllComponents=function(){if(this._allComponentsVisibleDirty||!this._allComponentsVisible){for(var e=0,t=this.geometryRecords;e<t.length;e++){var r=t[e],n=r.instanceParameters.componentVisibilities,i=s.unhideAllComponents(n);r.instanceParameters.componentVisibilities=i}this._notifyDirty("visibilityChanged"),this._allComponentsHiddenDirty=!1,this._allComponentsVisibleDirty=!1,this._allComponentsHidden=!1,this._allComponentsVisible=!0}},e.prototype._setComponentHighlight=function(e,t,r,n){var i=e.instanceParameters.componentHighlights,a=s.addHighlight(i,t,r,n);e.instanceParameters.componentHighlights=a},e.prototype.setComponentHighlight=function(e,t,r){var n=c.generateHighlightId();return this._setComponentHighlight(e,t,r,n),this._notifyDirty("componentHighlightChanged"),n},e.prototype.highlightAllComponents=function(e){for(var t=c.generateHighlightId(),r=0,n=this.geometryRecords;r<n.length;r++){var i=n[r];this._setComponentHighlight(i,null,e,t)}return this._notifyDirty("componentHighlightChanged"),t},e.prototype.removeHighlights=function(e){for(var t=0,r=this.geometryRecords;t<r.length;t++){var n=r[t].instanceParameters,i=n.componentHighlights,a=s.removeHighlight(i,e);n.componentHighlights=a}this._notifyDirty("componentHighlightChanged")},e.prototype.getComponentFromTriangleNr=function(e,t){p(e>=0&&e<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");var r=this.geometryRecords[e].geometry.data.componentOffsets;return s.componentFind(r,3*t)},e.prototype.setGeometryTransformation=function(e,t){p(e>=0&&e<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var r=this.geometryRecords[e],i=new l(r.geometry,r.material,n.mat4f64.clone(t),r.instanceParameters);this.geometryRecords[e]=i,this._notifyDirty("objGeometryReplaced",[r,i]),this._invalidateBoundingVolume()},e.prototype.getCombinedStaticTransformation=function(e,t){return t=t||n.mat4f64.create(),r.mat4.multiply(t,this.objectTransformation,e.getStaticTransformation()),t},e.prototype.getCombinedShaderTransformation=function(e,t){return t=t||n.mat4f64.create(),r.mat4.multiply(t,this.objectTransformation,e.getShaderTransformation()),t},e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation},e.prototype.getCastShadow=function(){return this.castShadow},e.prototype.setCastShadow=function(e){this.castShadow=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.getName=function(){return this.name},e.prototype.getBBMin=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin},e.prototype.getBBMax=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax},e.prototype.getCenter=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.center:this._bvWorldSpace.center},e.prototype.getBSRadius=function(e){return this._validateBoundingVolume(),e?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius},e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this.geometryRecords.length;++e){var t=this.geometries[e],r=this.geometryRecords[e],n=t.boundingInfo;this._calculateTransformedBoundingVolume(n,this._bvObjectSpace,r.getShaderTransformation()),this._calculateTransformedBoundingVolume(n,this._bvWorldSpace,this.getCombinedShaderTransformation(r))}i.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5),i.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);var s=a.vec3f64.create(),l=a.vec3f64.create(),c=o.maxScale(this.objectTransformation);for(e=0;e<this.geometryRecords.length;++e){t=this.geometries[e];var u=this.geometryRecords[e].getShaderTransformation(),d=o.maxScale(u);n=t.boundingInfo;i.vec3.transformMat4(s,n.getCenter(),u);var f=i.vec3.distance(s,this._bvObjectSpace.center),p=n.getBSRadius()*d;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,f+p),i.vec3.transformMat4(l,s,this.objectTransformation);var h=i.vec3.distance(l,this._bvWorldSpace.center),v=p*c;this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,h+v)}this._bvDirty=!1}},e.prototype._calculateTransformedBoundingVolume=function(e,t,r){var n=e.getBBMin(),o=e.getBBMax(),s=a.vec3f64.clone(n),l=a.vec3f64.clone(o);i.vec3.transformMat4(s,s,r),i.vec3.transformMat4(l,l,r);for(var c=0;c<3;++c)t.bbMin[c]=Math.min(t.bbMin[c],s[c],l[c]),t.bbMax[c]=Math.max(t.bbMax[c],s[c],l[c]);for(c=0;c<3;++c){i.vec3.copy(s,n),i.vec3.copy(l,o),s[c]=o[c],l[c]=n[c],i.vec3.transformMat4(s,s,r),i.vec3.transformMat4(l,l,r);for(var u=0;u<3;++u)t.bbMin[u]=Math.min(t.bbMin[u],s[u],l[u]),t.bbMax[u]=Math.max(t.bbMax[u],s[u],l[u])}},e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0,this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})},e.prototype._notifyDirty=function(e,t,r,n){if(this._parentLayer){r=r||d.OBJECT;var i=n||this;this._parentLayer.notifyDirty(e,t,r,i)}},e._idGen=new u,e}(),m=function(){function e(){this.bbMin=a.vec3f64.create(),this.bbMax=a.vec3f64.create(),this.center=a.vec3f64.create(),this.bsRadius=0}return e.prototype.init=function(){i.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i.vec3.set(this.center,0,0,0),this.bsRadius=0},e.prototype.getCenter=function(){return this.center},e.prototype.getBSRadius=function(){return this.bsRadius},e}();return v}.apply(null,n))||(e.exports=i)},ZO6V:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KY0m"),r("0LE5"),r("Rdxj"),r("W0kZ"),r("05NA"),r("mYMs")],void 0===(i=function(e,t,r,n,i,a,o,s){return function(){function e(t,r,n){this._parentStages=[],this._children=new Set,this.id=e._idGen.gen(t),this.apiLayerUid=n,this.name=t,r=r||{},this.group=r.group||"",this.isVisible=null==r.isVisible||r.isVisible,this.isPickable=null==r.isPickable||r.isPickable,this.isSliceable=!1,this.translation=r.translation?i.vec3f64.clone(r.translation):i.vec3f64.create(),this._extent=[i.vec3f64.fromValues(0,0,0),i.vec3f64.fromValues(1e3,1e3,1e3)],this._extentDirty=!0}return e.prototype.addParentStage=function(e){-1===this._parentStages.indexOf(e)&&this._parentStages.push(e)},e.prototype.removeParentStage=function(e){var t=this._parentStages.indexOf(e);t>-1&&this._parentStages.splice(t,1),this.invalidateSpatialQueryAccelerator()},e.prototype.getName=function(){return this.name},e.prototype.getGroup=function(){return this.group},e.prototype.getTranslation=function(){return this.translation},e.prototype.getObjectIds=function(){return r.keysOfSet(this._children,function(e){return e.id})},e.prototype.getObjects=function(){return r.keysOfSet(this._children)},e.prototype.getExtent=function(){return this._updateExtent(),this._extent},e.prototype.addObject=function(e){this._children.add(e),e.parentLayer=this,this.notifyDirty("layObjectAdded",e),this._invalidateExtent(),this._octree&&this._octree.add(e)},e.prototype.hasObject=function(e){return this._children.has(e)},e.prototype.removeObject=function(e){return!!this._children.delete(e)&&(e.parentLayer=null,this.notifyDirty("layObjectRemoved",e),this._invalidateExtent(),this._octree&&this._octree.remove(e),!0)},e.prototype.notifyObjectBBChanged=function(e,t){this._octree&&this._octree.update(e,t)},e.prototype.getCenter=function(){this._updateExtent();var e=i.vec3f64.create();return n.vec3.lerp(e,this._extent[0],this._extent[1],.5)},e.prototype.getBSRadius=function(){return this._updateExtent(),.5*n.vec3.distance(this._extent[0],this._extent[1])},e.prototype.getSpatialQueryAccelerator=function(){return!this._octree&&this._children.size>50&&this._createOctree(),this._octree},e.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)},e.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)},e.prototype.notifyDirty=function(e,t,r,n){r=r||o.LAYER;for(var i=n||this,a=0;a<this._parentStages.length;a++)this._parentStages[a].notifyDirty(r,i,e,t)},e.prototype._createOctree=function(){for(var e=this.getExtent(),t=0,a=0;a<3;a++)t=Math.max(t,e[1][a]-e[0][a]);var o=i.vec3f64.create();n.vec3.lerp(o,e[0],e[1],.5),this._octree=new s(o,1.2*t,{getRadius:function(e){return e.getBSRadius()},getCenter:function(e){return e.getCenter()}}),this._octree.add(r.keysOfSet(this._children))},e.prototype._invalidateExtent=function(){this._extentDirty=!0},e.prototype._updateExtent=function(){var e=this;if(this._extentDirty){if(this._extentDirty=!1,0===this._children.size)return void(this._extent=[[0,0,0],[0,0,0]]);var t=null;this._children.forEach(function(r){var n=r.getBBMin(),a=r.getBBMax();if(t)for(var o=0;o<3;++o)e._extent[0][o]=Math.min(e._extent[0][o],n[o]),e._extent[1][o]=Math.max(e._extent[1][o],a[o]);else t=[i.vec3f64.clone(n),i.vec3f64.clone(a)]}),this._extent=t}},e._idGen=new a,e}()}.apply(null,n))||(e.exports=i)},ZeO9:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("1m5D"),r("MzcX"),r("ff/U"),r("XCS5"),r("AASg"),r("CIy2"),r("pbva"),r("PwS/"),r("QFi0"),r("Kfys"),r("z2+Q")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p){function h(e,t,r,n){for(var i=new Map,a=t.vertexBufferLayout.stride/4,o=function(r,n){var o=r.origin,s=e.get(o.id),l=i.get(o.id);null==l&&(l={optimalCount:null==s?0:s.optimalCount,sparseCount:null==s?0:s.buffer.getSize(),toAdd:[],toRemove:[],origin:o.vec3},i.set(o.id,l));var c=t.elementCount(r.data)*a;n?(l.optimalCount+=c,l.sparseCount+=c,l.toAdd.push(r)):(l.optimalCount-=c,l.toRemove.push(r))},s=0,l=r;s<l.length;s++){o(l[s],!0)}for(var c=0,u=n;c<u.length;c++){o(u[c],!1)}return i}var v=function(){function e(e,t,r){this._dataByOrigin=new Map,this._highlightCount=0,this._rctx=e,this._material=r,this._materialRep=t,this._glMaterials=u.acquireMaterials(this._material,this._materialRep),this._bufferWriter=r.createBufferWriter()}return e.prototype.dispose=function(){u.releaseMaterials(this._material,this._materialRep)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlightCount>0},enumerable:!0,configurable:!0}),e.prototype.renderPriority=function(){return this._material.renderPriority},e.prototype.modify=function(e){var t=this,r=_;r.clear(),this.updateGeometries(e.toUpdate,r),this.addAndRemoveGeometries(e.toAdd,e.toRemove,r),this.updateHighlightCount(),r.forEach(function(e){return t.updateDisplayedIndexRanges(e)})},e.prototype.addAndRemoveGeometries=function(e,t,r){var n=this,i=this._material,a=this._bufferWriter,o=a.vertexBufferLayout,s=o.stride/4,c=this._dataByOrigin,u=h(c,a,e,t);u.forEach(function(e,t){u.delete(t);var a=e.optimalCount,d=e.sparseCount,f=c.get(t);if(null==f&&(l.assert(a>0),f=n.createData(o,a,e.origin),c.set(t,f)),0===a)return f.vao.dispose(!0),f.vao=null,void c.delete(t);var p=a<e.sparseCount/2,h=p?a:d,v=m,y=f.buffer.getSize(),b=f.buffer.getArray(),x=f.buffer.resize(h);p||x?n.removeAndRebuild(f,e.toRemove,s,b,v):e.toRemove.length>0?(n.removeByErasing(f,e.toRemove,s,v),e.toAdd.length>0&&(v.end=y)):(v.begin=y,v.end=y);var _=g;l.setMatrixTranslation3(_,-e.origin[0],-e.origin[1],-e.origin[2]),n.append(f,i,e.toAdd,s,_,v);var S=f.vao.vertexBuffers.geometry;if(S.byteSize!==f.buffer.getArray().buffer.byteLength)S.setData(f.buffer.getArray());else{var w=v.begin,C=v.end;if(w<C){var P=f.buffer.getArray(),E=4*w,T=4*C;S.setSubData(P,E,E,T)}}(v.updatedDisplayedIndexRange||f.displayedIndexRanges)&&r.add(f)})},e.prototype.updateGeometries=function(e,t){for(var r=this._bufferWriter,n=r.vertexBufferLayout.stride/4,i=0,a=e;i<a.length;i++){var o=a[i],s=o.updateType,c=o.renderGeometry,d=this._dataByOrigin.get(c.origin.id),f=d&&d.instances.get(c.uniqueName);if(!f)return;if(1&s&&(f.displayedIndexRange=u.generateRenderGeometryVisibleIndexRanges(c),t.add(d)),17&s&&(f.highlightedIndexRanges=u.generateRenderGeometryHighlightRanges(c),d.highlightCount=null),6&s){var p=d.buffer.getArray(),h=d.vao;u.calculateTransformRelToOrigin(c,y,b),r.write({transformation:y,invTranspTransformation:b},c.data,c.instanceParameters,r.vertexBufferLayout.createView(p.buffer),f.from),l.assert(f.from+r.elementCount(c.data)===f.to,"material VBO layout has changed"),h.vertexBuffers.geometry.setSubData(p,f.from*n*4,f.from*n*4,f.to*n*4)}}},e.prototype.updateDisplayedIndexRanges=function(e){var t=e.instances;e.displayedIndexRanges=[];var r=!0;t.forEach(function(t){t.displayedIndexRange?(e.displayedIndexRanges.push.apply(e.displayedIndexRanges,s.offsetIntervals(t.displayedIndexRange,t.from)),r=!1):e.displayedIndexRanges.push([t.from,t.to-1])}),e.displayedIndexRanges=r?null:s.mergeIntervals(e.displayedIndexRanges)},e.prototype.updateHighlightCount=function(){var e=this;this._highlightCount=0,this._dataByOrigin.forEach(function(t){if(null==t.highlightCount){var r=0;t.instances.forEach(function(e){e.highlightedIndexRanges&&++r}),t.highlightCount=r}e._highlightCount+=t.highlightCount})},e.prototype.render=function(e,t,r,n){var i=this,a=this._rctx,o=this._glMaterials.get(t.pass),s=4===t.pass;if(!o||null!=e&&!o.beginSlot(e)||s&&0===this._highlightCount)return!1;o.bind(a,r);var l=o.getProgram();l.setUniformMatrix4fv("model",x),l.hasUniform("modelNormal")&&l.setUniformMatrix4fv("modelNormal",x);var c=!1;return this._dataByOrigin.forEach(function(e){s&&0===e.highlightCount||(r.origin=e.origin,o.bindView(a,r),c=s?i.renderHighlightPass(o,e,n)||c:i.renderDefaultPass(o,e,n)||c)}),o.release(a,r),c},e.prototype.renderDefaultPass=function(e,t,r){var n=this._rctx,i=e.getProgram(),a=e.getDrawMode(),o=t.displayedIndexRanges;return!(o&&0===o.length||(f.assertCompatibleVertexAttributeLocations(t.vao,i),n.bindVAO(t.vao),o?u.drawArraysFaceRange(n,o,0,a,r):u.drawArrays(n,a,0,f.vertexCount(t.vao,"geometry"),r),0))},e.prototype.renderHighlightPass=function(e,t,r){var n=this._rctx,i=e.getProgram(),a=e.getDrawMode(),o=t.vao;f.assertCompatibleVertexAttributeLocations(o,i),n.bindVAO(o);var s=!1;return t.instances.forEach(function(e){var t=e.highlightedIndexRanges;if(t&&0!==t.length)for(var i=0;i<t.length;i++){var o=t[i],l=o.range?o.range[0]+e.from:e.from,c=o.range?o.range[1]-o.range[0]+1:e.to-e.from;u.drawArrays(n,a,l,c,r),s=!0}}),s},e.prototype.createData=function(e,t,r){return{instances:new Map,vao:new p(this._rctx,a.Default3D,{geometry:i.glLayout(e)},{geometry:d.createVertex(this._rctx,35044)}),buffer:new o(t),optimalCount:0,origin:r,highlightCount:0}},e.prototype.removeAndRebuild=function(e,t,r,n,i){for(var a=0,o=t;a<o.length;a++){var s=o[a].uniqueName,l=e.instances.get(s);e.optimalCount-=(l.to-l.from)*r,e.instances.delete(s)}var c=0,u=e.buffer.getArray();i.begin=0,i.end=0;var d=-1,f=-1,p=0;e.instances.forEach(function(e){var t=e.from*r,i=e.to*r,a=i-t;d!==f&&f!==t?(u.set(n.subarray(d,f),p),p+=f-d,d=t):-1===d&&(d=t),f=i,e.from=c/r,c+=a,e.to=c/r}),d!==f&&u.set(n.subarray(d,f),p),i.end=c},e.prototype.removeByErasing=function(e,t,r,n){if(0!==t.length){n.begin=1/0,n.end=-1/0;for(var i=-1,a=-1,o=0,s=t;o<s.length;o++){var l=s[o].uniqueName,c=e.instances.get(l),u=c.from*r,d=c.to*r;i!==a&&a!==u?(e.buffer.erase(i,a),i=u):-1===i&&(i=u),a=d,e.instances.delete(l),e.optimalCount-=d-u,u<n.begin&&(n.begin=u),d>n.end&&(n.end=d)}i!==a&&e.buffer.erase(i,a)}},e.prototype.append=function(e,t,n,i,a,o){o.updatedDisplayedIndexRange=!1;for(var s=this._bufferWriter,d=0,f=n;d<f.length;d++){var p=f[d],h=p.data;r.mat4.multiply(y,a,p.transformation),r.mat4.invert(b,y),r.mat4.transpose(b,b);var v=o.end;s.write({transformation:y,invTranspTransformation:b},h,p.instanceParameters,s.vertexBufferLayout.createView(e.buffer.getArray().buffer),o.end/i);var m=s.elementCount(h)*i,g=v+m;l.assert(null==e.instances.get(p.uniqueName));var x=u.generateRenderGeometryVisibleIndexRanges(p),_=u.generateRenderGeometryHighlightRanges(p);_&&(e.highlightCount=null);var S=new c(p.name,v/i,g/i,x,_,void 0,void 0,p.idx);e.instances.set(p.uniqueName,S),x&&(o.updatedDisplayedIndexRange=!0),e.optimalCount+=m,o.end+=m}},e}(),m={updatedDisplayedIndexRange:!1,begin:0,end:0},g=n.mat4f64.create(),y=n.mat4f64.create(),b=n.mat4f64.create(),x=n.mat4f64.create(),_=new Set;return v}.apply(null,n))||(e.exports=i)},ZjcA:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("PHan"),r("W9tT"),r("0LE5"),r("Rdxj"),r("JjCO"),r("N5NQ")],void 0===(i=function(e,t,r,n,i,a,o,s){function l(e){return e?{p0:a.vec3f64.clone(e.p0),p1:a.vec3f64.clone(e.p1),p2:a.vec3f64.clone(e.p2)}:{p0:a.vec3f64.create(),p1:a.vec3f64.create(),p2:a.vec3f64.create()}}function c(e,t,r,n){return void 0===n&&(n=l()),i.vec3.copy(n.p0,e),i.vec3.copy(n.p1,t),i.vec3.copy(n.p2,r),n}function u(e,t,r){var i=n.vec2.distance(e,t),a=n.vec2.distance(t,r),o=n.vec2.distance(r,e),s=(i+a+o)/2,l=s*(s-i)*(s-a)*(s-o);return l<=0?0:Math.sqrt(l)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=l,t.wrap=function(e,t,r){var n=f.get();return n.p0=e,n.p1=t,n.p2=r,n},t.copy=function(e,t){return void 0===t&&(t=l()),c(e.p0,e.p1,e.p2,t)},t.fromValues=c,t.distance2=function(e,t){var r=e.p0,n=e.p1,a=e.p2,l=i.vec3.subtract(o.sv3d.get(),n,r),c=i.vec3.subtract(o.sv3d.get(),a,n),u=i.vec3.subtract(o.sv3d.get(),r,a),f=i.vec3.subtract(o.sv3d.get(),t,r),p=i.vec3.subtract(o.sv3d.get(),t,n),h=i.vec3.subtract(o.sv3d.get(),t,a),v=i.vec3.cross(l,l,u),m=i.vec3.dot(i.vec3.cross(o.sv3d.get(),l,v),f),g=i.vec3.dot(i.vec3.cross(o.sv3d.get(),c,v),p),y=i.vec3.dot(i.vec3.cross(o.sv3d.get(),u,v),h);if(m>0&&g>0&&y>0){var b=i.vec3.dot(v,f);return b*b/i.vec3.dot(v,v)}var x=s.distance2(s.fromValues(r,l,d.get()),t),_=s.distance2(s.fromValues(n,c,d.get()),t),S=s.distance2(s.fromValues(a,u,d.get()),t);return Math.min(x,_,S)},t.areaPoints2d=u,t.area2d=function(e){return u(e.p0,e.p1,e.p2)};var d=new r.ObjectStack(s.create),f=new r.ObjectStack(function(){return{p0:null,p1:null,p2:null}})}.apply(null,n))||(e.exports=i)},ZooB:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("ll/V"),r("xdHJ"),r("PND3"),r("WYKK"),r("ma1f"),r("rg9i"),r("qsST"),r("r7jh"),r("qMld"),r("8uEs"),r("lRq4"),r("hBh5"),r("Lzvl"),r("nrlZ"),r("Ytki"),r("Q2Em"),r("4/qq"),r("d81A"),r("V1i6"),r("/61J"),r("zDti"),r("tZaU")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w,C){function P(e,t,r,n,i,a,o,s,l){l||(l=E),o&&!a?n.forEachInBounds(i,function(n){if(!t.has(n.objectId)){var i=w.getCentroid(r,n,s),a=n.attributes;i&&(t.add(n.objectId),e.push(new O(a,null,i,l(n))))}}):a&&!o?n.forEachInBounds(i,function(n){if(!t.has(n.objectId)){var i=n.attributes,a=w.getGeometry(r,n,0,s);a&&(t.add(n.objectId),e.push(new O(i,a,null,l(n))))}}):n.forEachInBounds(i,function(n){if(!t.has(n.objectId)){var i=n.attributes,a=w.getGeometry(r,n,0,s),o=w.getCentroid(r,n,s);a&&o&&(t.add(n.objectId),e.push(new O(i,a,o,l(n))))}})}Object.defineProperty(t,"__esModule",{value:!0});var E=function(e){return 1},T=c.getLogger("esri.layers.graphics.data.QueryEngine"),O=function(e,t,r,n){this.attributes=e,this.geometry=t,this.centroid=r,this.filterFlags=n},A=new a.default,R=new u.Storage(2e6),M=0,I=function(){function e(e){var t=this;this.capabilities={query:b.queryCapabilities},this.fieldsMap=new i.default,this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.cacheSpatialQueries=e.cacheSpatialQueries||!1,this.gdbVersion=e.gdbVersion,this.historicMoment=e.historicMoment,this.featureStore=e.featureStore,this.featureStore.setEngine(this),this.timeInfo=e.timeInfo,this.cacheSpatialQueries&&(this._geometryQueryCache=new u(M+++"$$",R)),e.fields.forEach(function(e){t.fieldsMap.set(e.name.trim(),e),t.fieldsMap.set(e.name.trim().toLowerCase(),e)}),e.scheduler&&e.priority&&(this._frameQueue=new C.PromiseQueue,this._frameTask=e.scheduler.registerTask(e.priority,function(e){return t._update(e)},function(){return t._frameQueue.length>0}))}return e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null),this.clearCache(),this._geometryQueryCache&&this._geometryQueryCache.destroy(),this.fieldsMap.clear()},Object.defineProperty(e.prototype,"fullExtent",{get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:w.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeExtent",{get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:(this._timeExtent=S.getTimeExtent(this.timeInfo,this.featureStore),this._timeExtent):null},enumerable:!0,configurable:!0}),e.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null},e.prototype.executeQuery=function(e){var t=this;void 0===e&&(e={});var r=l.clone(e);return o.safeCast(w.normalizeQuery(r,this.definitionExpression,this.spatialReference)).then(function(e){return t._schedule(e)}).then(function(e){return t._checkQuerySupport(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeTimeQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeAttributesQuery(r)}).catch(function(e){if(e===w.QUERY_ENGINE_EMPTY_RESULT)return new x.default([],null,t);throw e}).then(function(e){return e.createQueryResponse(r)})},e.prototype.executeQueryForCount=function(e){var t=this;void 0===e&&(e={});var r=l.clone(e);return r.returnGeometry=!1,r.returnCentroid=!1,r.outSR=null,o.safeCast(w.normalizeQuery(r,this.definitionExpression,this.spatialReference)).then(function(e){return t._schedule(e)}).then(function(e){return t._checkQuerySupport(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeTimeQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeAttributesQuery(r)}).then(function(e){return e.size}).catch(function(e){if(e===w.QUERY_ENGINE_EMPTY_RESULT)return 0;throw e})},e.prototype.executeQueryForExtent=function(e){var t=this;void 0===e&&(e={});var r=l.clone(e),n=r.outSR;return o.safeCast(w.normalizeQuery(r,this.definitionExpression,this.spatialReference)).then(function(e){return t._schedule(e)}).then(function(e){return t._checkQuerySupport(e)}).then(function(){return r.returnGeometry=!0,r.returnCentroid=!1,r.outSR=null,r}).then(function(e){return t._reschedule(e)}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeTimeQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeAttributesQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){var r=e.size;if(!r)return{count:r,extent:null};var i={xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:w.cleanFromGeometryEngine(t.spatialReference)};t.featureStore.forEachBounds(e.items,function(e){i.xmin=Math.min(e[0],i.xmin),i.ymin=Math.min(e[1],i.ymin),i.xmax=Math.max(e[2],i.xmax),i.ymax=Math.max(e[3],i.ymax)});var a=y.project(i,e.spatialReference,n);if(a.spatialReference=w.cleanFromGeometryEngine(n||t.spatialReference),a.xmax-a.xmin==0){var o=f.getMetersPerUnitForSR(a.spatialReference);a.xmin-=o,a.xmax+=o}if(a.ymax-a.ymin==0){o=f.getMetersPerUnitForSR(a.spatialReference);a.ymin-=o,a.ymax+=o}return{count:r,extent:a}}).catch(function(e){if(e===w.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw e})},e.prototype.executeQueryForIds=function(e){return void 0===e&&(e={}),this.executeQueryForIdSet(e).then(function(e){return n.from(e)})},e.prototype.executeQueryForIdSet=function(e){var t=this;void 0===e&&(e={});var r=l.clone(e);return r.returnGeometry=!1,r.returnCentroid=!1,r.outSR=null,o.safeCast(w.normalizeQuery(r,this.definitionExpression,this.spatialReference)).then(function(e){return t._schedule(e)}).then(function(e){return t._executeGeometryQuery(e)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeObjectIdsQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeTimeQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){return e.executeAttributesQuery(r)}).then(function(e){return t._reschedule(e)}).then(function(e){for(var t=e.items,r=new a.default,n=0,i=t;n<i.length;n++){var o=i[n];r.add(o.objectId)}return r}).catch(function(e){if(e===w.QUERY_ENGINE_EMPTY_RESULT)return new a.default;throw e})},e.prototype.executeTileQuery=function(e,t,r){var n=this;void 0===r&&(r=null);var i=t.returnGeometry,o=t.returnCentroid,s=t.pixelBuffer,l=new a.default,c=[],u=s*e.resolution,d=p.pad(e.bounds,u,p.create());if(P(c,l,this,this.featureStore,d,i,o,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},r),"esriGeometryPoint"===this.geometryType||o){var f=m.getInfo(this.spatialReference);if(f){var h=f.valid,v=h[0],g=h[1];if(d[0]<v){var y=p.fromValues(g-u,d[1],g,d[3]);P(c,l,this,this.featureStore,y,i,o,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[g,e.bounds[3]]},r)}if(d[2]>g){var b=p.fromValues(v,d[1],v+u,d[3]);P(c,l,this,this.featureStore,b,i,o,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[v-g+e.bounds[0],e.bounds[3]]},r)}}}return c.sort(function(e,t){return e.attributes[n.objectIdField]-t.attributes[n.objectIdField]}),{features:c,objectIds:l}},e.prototype.executeTileQueryForIds=function(e,t){var r=t.pixelBuffer*e.resolution,n=p.pad(e.bounds,r,p.create()),i=[];return this.featureStore.forEachInBounds(n,function(e){return i.push(e.objectId)}),i},e.prototype.executeQueryForLatestObservations=function(e){var t=this;return this.timeInfo?this.executeQuery(e).then(function(e){return t._filterLatest(e,t.timeInfo)}):void T.error(new s("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))},e.prototype._schedule=function(e){return this._frameQueue?this._frameQueue.push(e).then(function(e){return e}):d.resolve(e)},e.prototype._reschedule=function(e){return this._frameQueue?this._frameQueue.push(e).then(function(e){return e}):d.resolve(e)},e.prototype._update=function(e){for(this._budget=e;!e.done&&this._frameQueue.process();)e.madeProgress();this._budget=null},e.prototype._filterLatest=function(e,t){for(var n=t.trackIdField,a=t.startTimeField,o=t.endTimeField||a,s=new i.default,l=[],c=0,u=e.features;c<u.length;c++){var d=u[c],f=d.attributes[n],p=d.attributes[o];(!s.has(f)||s.get(f).attributes[o]<p)&&s.set(f,d)}return s.forEach(function(e){return l.push(e)}),r({},e,{features:l})},e.prototype._getAll=function(){if(!this._allItems){var e=[];this.featureStore.forEach(function(t){return e.push(t)}),this._allItems=new x.default(e,null,this)}return this._allItems},e.prototype._executeGeometryQuery=function(e){var t=this,r=e.geometry,n=e.outSR,i=e.spatialRel,o=m.isValid(n)&&!m.equals(this.spatialReference,n),s=this.cacheSpatialQueries?o?JSON.stringify({geometry:r,spatialRelationship:i,outSpatialReference:n}):JSON.stringify({geometry:r,spatialRelationship:i}):null;if(s){var l=this._geometryQueryCache.get(s);if(void 0!==l)return d.resolve(l)}var c=function(r){return o&&(e.returnGeometry||e.returnCentroid)?r.project(n).then(function(e){return s&&t._geometryQueryCache.put(s,e,e.size||1),e}):(s&&t._geometryQueryCache.put(s,r,r.size||1),r)};if(!r)return d.resolve(this._getAll()).then(function(e){return c(e)});if("esriSpatialRelDisjoint"===i){var u,f,p=this._searchFeatures(this._getQueryBBoxes(r));return p.length?this._reschedule(p).then(function(e){return new a.default(e)}).then(function(e){return t._reschedule(e)}).then(function(e){var r=0;u=new Array(e.size),t.featureStore.forEach(function(e){return u[r++]=e}),f=e}).then(function(){return t._reschedule()}).then(function(){return _.getSpatialQueryOperator(i,r,t)}).then(function(e){return t._runSpatialFilter(u,function(t){return!f.has(t)||e(t.geometry)}).then(function(e){return new x.default(e,r,t)}).then(function(e){return c(e)})}):d.resolve(this._getAll()).then(function(e){return c(e)})}var h=this._searchFeatures(this._getQueryBBoxes(r));if(!h.length){var v=new x.default([],r,this);return s&&this._geometryQueryCache.put(s,v,v.size||1),d.resolve(v)}return this._canExecuteSoloPass(r,e)?d.resolve(new x.default(h,r,this)).then(function(e){return c(e)}):_.getSpatialQueryOperator(i,r,this).then(function(e){return t._runSpatialFilter(h,function(t){return e(t.geometry)})}).then(function(e){return new x.default(e,r,t)}).then(function(e){return c(e)})},e.prototype._runSpatialFilter=function(e,t){var r=this;if(!t)return d.resolve(e);if(!this._budget)return d.resolve(e.filter(function(e){return t(e)}));var n=0,i=new Array,a=function(){for(;n<e.length;){var o=e[n];if(t(o)&&i.push(o),r._budget.done)return r._reschedule().then(function(){return a()});++n}return d.resolve()};return this._reschedule().then(function(){return a()}).then(function(){return i})},e.prototype._canExecuteSoloPass=function(e,t){var r=this.geometryType,n=t.spatialRel;return _.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===n||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===n||"esriSpatialRelContains"===n||"esriSpatialRelWithin"===n))},e.prototype._getQueryBBoxes=function(e){if(_.canQueryWithRBush(e)){if(v.isExtent(e))return[p.fromValues(e.xmin,e.ymin,e.xmax,e.ymax)];if(v.isPolygon(e))return e.rings.map(function(e){return p.fromValues(e[0][0],e[0][1],e[2][0],e[2][1])})}return[h.getBoundsXY(p.create(),e)]},e.prototype._searchFeatures=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this.featureStore.forEachInBounds(n,function(e){A.add(e)})}var i=new Array(A.size),a=0;return A.forEach(function(e){return i[a++]=e}),A.clear(),i},e.prototype._checkQuerySupport=function(e){return e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text?d.reject(new s("feature-store:unsupported-query","Unsupported query options",{query:e})):d.all([this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),_.checkSpatialQuerySupport(e,this.geometryType,this.spatialReference),y.checkProjectionSupport(this.spatialReference,e.outSR)]).then(function(){return e})},e.prototype._checkAttributesQuerySupport=function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues;if(r&&r.length>0){var i=r.map(function(e){return e.indexOf(" ASC")>-1?e.split(" ASC")[0]:e.indexOf(" DESC")>-1?e.split(" DESC")[0]:e});g.validateFields(this.fieldsMap,i,"orderByFields contains missing fields")}if(t&&t.length>0)g.validateFields(this.fieldsMap,t,"outFields contains missing fields");else if(n)throw new s("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:e});g.validateWhere(this.fieldsMap,e.where)},e.prototype._checkStatisticsQuerySupport=function(e){var t=e.outStatistics,r=e.groupByFieldsForStatistics,n=e.having,i=r&&r.length,a=t&&t.length;if(n){if(!i||!a)return d.reject(new s("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:e}));g.validateHaving(this.fieldsMap,n,t)}if(a){if(t.some(function(e){return"exceedslimit"===e.statisticType}))return;var o=t.map(function(e){return e.onStatisticField});g.validateFields(this.fieldsMap,o,"onStatisticFields contains missing fields"),i&&g.validateFields(this.fieldsMap,r,"groupByFieldsForStatistics contains missing fields");for(var l=0,c=t;l<c.length;l++){var u=c[l],f=u.onStatisticField,p=u.statisticType;if("exceedslimit"===p)return d.reject(new s("feature-store:unsupported-query","statistic type exceedslimit is not supported",{definition:u,query:e}));if((!i||"count"!==p)&&f&&g.hasInvalidFieldType(f,this.fieldsMap))return d.reject(new s("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:u,query:e}))}}},e}();t.default=I}.apply(null,n))||(e.exports=i)},Zp3t:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("H1tY")],void 0===(i=function(e,t,r){function n(e){return null!=e&&"type"in e&&"compressed"===e.type}return function(){function e(t,n,i){this._context=null,this._glName=null,this._id=-1,this._desc=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._boundToUnits=new Set,this._context=t,this._desc={pixelFormat:n.pixelFormat,internalFormat:n.internalFormat,dataType:n.dataType,target:n.target?n.target:3553,samplingMode:n.samplingMode?n.samplingMode:9729,wrapMode:n.wrapMode?n.wrapMode:10497,maxAnisotropy:n.maxAnisotropy,flipped:void 0!==n.flipped&&n.flipped,hasMipmap:void 0!==n.hasMipmap&&n.hasMipmap,unpackAlignment:n.unpackAlignment?n.unpackAlignment:4,width:n.width,height:n.height,preMultiplyAlpha:void 0!==n.preMultiplyAlpha&&n.preMultiplyAlpha,textureCoordinateScaleFactor:n.textureCoordinateScaleFactor||null},this._id=++e._nextId,r("esri-webgl-debug")&&t.instanceCounter.incrementCount(0),this.setData(i)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(this._context){if(this._glName){var t=this._context.gl;this._boundToUnits.forEach(function(t){e._context.bindTexture(null,t)}),t.deleteTexture(this._glName),this._glName=null}r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(0),this._context=null}},e.prototype.resize=function(e,t){var r=this._desc;r.width===e&&r.height===t||(r.width=e,r.height=t,this.setData(null))},e.prototype.setData=function(t){var r=this._context.gl;this._glName||(this._glName=r.createTexture()),void 0===t&&(t=null),null===t&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var i=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var a=this._desc;e._validateTexture(a),r.pixelStorei(r.UNPACK_ALIGNMENT,a.unpackAlignment),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,a.flipped?1:0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.preMultiplyAlpha?1:0);var o=a.pixelFormat,s=a.internalFormat?a.internalFormat:o;if(t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)a.width&&a.height,r.texImage2D(r.TEXTURE_2D,0,s,o,a.dataType,t),a.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=t.width),void 0===this._desc.height&&(this._desc.height=t.height);else{null!=a.width&&a.height,r.DEPTH24_STENCIL8&&s===r.DEPTH_STENCIL&&(s=r.DEPTH24_STENCIL8);var l=a.width,c=a.height;if(n(t)){var u=Math.round(Math.log(Math.max(l,c))/Math.LN2)+1;a.hasMipmap=a.hasMipmap&&u===t.levels.length;for(var d=0;;++d){var f=t.levels[Math.min(d,t.levels.length-1)];if(r.compressedTexImage2D(r.TEXTURE_2D,d,s,l,c,0,f),1===l&&1===c||!a.hasMipmap)break;l=Math.max(1,l>>1),c=Math.max(1,c>>1)}}else if(t)r.texImage2D(r.TEXTURE_2D,0,s,l,c,0,o,a.dataType,t),a.hasMipmap&&this.generateMipmap();else for(d=0;r.texImage2D(r.TEXTURE_2D,d,s,l,c,0,o,a.dataType,null),(1!==l||1!==c)&&a.hasMipmap;++d)l=Math.max(1,l>>1),c=Math.max(1,c>>1)}e._applySamplingMode(r,this._desc),e._applyWrapMode(r,this._desc),e._applyAnisotropicFilteringParameters(this._context,this._desc),this._context.bindTexture(i,0)},e.prototype.updateData=function(e,t,r,n,i,a){this._glName;var o=this._context.gl,s=this._desc,l=this._context.getBoundTexture(0);this._context.bindTexture(this,0),t<0||r<0||n>s.width||i>s.height||t+n>s.width||s.height,a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?o.texSubImage2D(o.TEXTURE_2D,e,t,r,s.pixelFormat,s.dataType,a):o.texSubImage2D(o.TEXTURE_2D,e,t,r,n,i,s.pixelFormat,s.dataType,a),this._context.bindTexture(l,0)},e.prototype.generateMipmap=function(){var t=this._desc;t.hasMipmap||(t.hasMipmap=!0,e._validateTexture(t)),9729===t.samplingMode?(this._samplingModeDirty=!0,t.samplingMode=9985):9728===t.samplingMode&&(this._samplingModeDirty=!0,t.samplingMode=9984);var r=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var n=this._context.gl;n.generateMipmap(n.TEXTURE_2D),this._context.bindTexture(r,0)},e.prototype.setSamplingMode=function(t){t!==this._desc.samplingMode&&(this._desc.samplingMode=t,e._validateTexture(this._desc),this._samplingModeDirty=!0)},e.prototype.setWrapMode=function(t){t!==this._desc.wrapMode&&(this._desc.wrapMode=t,e._validateTexture(this._desc),this._wrapModeDirty=!0)},e.prototype.applyChanges=function(){var t=this._context.gl,r=this._desc;this._samplingModeDirty&&(e._applySamplingMode(t,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(e._applyWrapMode(t,r),this._wrapModeDirty=!1)},e.prototype.setBoundToUnit=function(e,t){t?this._boundToUnits.add(e):this._boundToUnits.delete(e)},e._isPowerOfTwo=function(e){return 0==(e&e-1)},e._validateTexture=function(t){t.width<0||t.height,e._isPowerOfTwo(t.width)&&e._isPowerOfTwo(t.height)||("number"==typeof t.wrapMode?t.wrapMode:33071===t.wrapMode.s&&t.wrapMode.t,t.hasMipmap)},e._applySamplingMode=function(e,t){var r=t.samplingMode,n=t.samplingMode;9985===r||9987===r?(r=9729,t.hasMipmap||(n=9729)):9984!==r&&9986!==r||(r=9728,t.hasMipmap||(n=9728)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n)},e._applyWrapMode=function(e,t){"number"==typeof t.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode.t))},e._applyAnisotropicFilteringParameters=function(e,t){if(null!=t.maxAnisotropy){var r=e.capabilities.textureFilterAnisotropic;if(r){var n=e.gl;n.texParameterf(n.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy)}}},e._nextId=0,e}()}.apply(null,n))||(e.exports=i)},ZuXA:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("rusB"),r("+nCE")],void 0===(i=function(e,t,r,n){function i(e){return n.generateDefaultIndexArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.linearIndexArray=i,t.trianglesToTriangles=function(e){return"number"==typeof e?i(e):r.isUint16Array(e)||r.isUint8Array(e)?new Uint32Array(e):e},t.triangleStripToTriangles=function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint32Array(0);var r=t-2,n=new Uint32Array(3*r);if("number"==typeof e)for(var i=0,a=0;a<r;a+=1)a%2==0?(n[i++]=a,n[i++]=a+1,n[i++]=a+2):(n[i++]=a+1,n[i++]=a,n[i++]=a+2);else for(i=0,a=0;a<r;a+=1)if(a%2==0){var o=e[a],s=e[a+1],l=e[a+2];n[i++]=o,n[i++]=s,n[i++]=l}else o=e[a+1],s=e[a],l=e[a+2],n[i++]=o,n[i++]=s,n[i++]=l;return n},t.triangleFanToTriangles=function(e){var t="number"==typeof e?e:e.length;if(t<3)return new Uint32Array(0);var r=t-2,n=new Uint32Array(3*r);if("number"==typeof e){for(var i=0,a=0;a<r;++a)n[i++]=0,n[i++]=a+1,n[i++]=a+2;return n}var o=e[0],s=e[1];for(i=0,a=0;a<r;++a){var l=e[a+2];n[i++]=o,n[i++]=s,n[i++]=l,s=l}return n}}.apply(null,n))||(e.exports=i)},aWgr:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("GyfB"),r("2eYJ"),r("cpxo"),r("N5NQ"),r("GG08"),r("4p4v"),r("/dtL"),r("ZjcA"),r("18xY")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0}),t.plane=o,t.boundedPlane=n,t.triangle=c,t.lineSegment=a,t.ray=s,t.sphere=l,t.frustum=i,t.vector=u,t.axisAngle=r}.apply(null,n))||(e.exports=i)},ama6:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("1m5D"),r("vlC2")],void 0===(i=function(e,t,r,n){var i;return(i||(i={})).Default={vvSizeEnabled:!1,vvSizeMinSize:n.vec3f32.fromValues(1,1,1),vvSizeMaxSize:n.vec3f32.fromValues(100,100,100),vvSizeOffset:n.vec3f32.fromValues(0,0,0),vvSizeFactor:n.vec3f32.fromValues(1,1,1),vvSizeValue:n.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:r.mat4f64.create()},i}.apply(null,n))||(e.exports=i)},bH65:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qysZ")],void 0===(i=function(e,t,r){function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function i(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function a(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function o(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+n*n+i*i+a*a)}function s(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function l(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)}function c(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=n,t.multiply=i,t.divide=a,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.scaleAndAdd=function(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e},t.distance=o,t.squaredDistance=s,t.length=l,t.squaredLength=c,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o),e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e[3]=s+n*(r[3]-s),e},t.random=function(e,t){var n,i,a,o,s,l;t=t||1;do{s=(n=2*r.RANDOM()-1)*n+(i=2*r.RANDOM()-1)*i}while(s>=1);do{l=(a=2*r.RANDOM()-1)*a+(o=2*r.RANDOM()-1)*o}while(l>=1);var c=Math.sqrt((1-s)/l);return e[0]=t*n,e[1]=t*i,e[2]=t*a*c,e[3]=t*o*c,e},t.transformMat4=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e},t.transformQuat=function(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],l=r[2],c=r[3],u=c*n+s*a-l*i,d=c*i+l*n-o*a,f=c*a+o*i-s*n,p=-o*n-s*i-l*a;return e[0]=u*c+p*-o+d*-l-f*-s,e[1]=d*c+p*-s+f*-o-u*-l,e[2]=f*c+p*-l+u*-s-d*-o,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var n=e[0],i=e[1],a=e[2],o=e[3],s=t[0],l=t[1],c=t[2],u=t[3];return Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(a-c)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(o-u)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},t.sub=n,t.mul=i,t.div=a,t.dist=o,t.sqrDist=s,t.len=l,t.sqrLen=c}.apply(null,n))||(e.exports=i)},bduU:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("W9tT")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=2;var a=this.TypedArrayConstructor;void 0===n&&(n=2*a.BYTES_PER_ELEMENT);var o=0===t.byteLength?0:r;this.typedBuffer=null==i?new a(t,o):new a(t,o,(i-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return r.vec2.set(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1])},e.prototype.setVec=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r},e.prototype.copyFrom=function(e,t,r){var n=this.typedBuffer,i=t.typedBuffer,a=e*this.typedBufferStride,o=r*t.typedBufferStride;n[a]=i[o],n[a+1]=i[o+1]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=2,e}();t.BufferViewVec2Impl=n}.apply(null,n))||(e.exports=i)},c7Gp:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("LxLY"),r("1E+e"),r("YX1r"),r("51bw"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("Vt+U"),r("ZcgO"),r("s4LJ"),r("zF3d"),r("JzVu"),r("BwdQ"),r("763n"),r("mmEe"),r("VfPl"),r("fV0t"),r("krVM"),r("ys4y"),r("AgDx"),r("ZJC8"),r("CIy2"),r("TP2F")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w,C,P,E){function T(e,t,r,n,i,a,o,s,l,c,u,d,f,p){var h=r.length/3,v=0;u+=2*n.count,O(e,t,n.index,n.count,r,0,h,i,a,o,s,l,c,u,d,f,p),l+=2*n.count,u+=2*h,u-=2*n.count+2*h,R(i,a,s,o,v,n.pathLengths[0],n.count,l,c,u,d),l+=4*n.pathLengths[0],u+=2*n.pathLengths[0],v+=n.pathLengths[0];for(var m=1;m<n.pathLengths.length;++m)R(i,a,s,o,v,n.pathLengths[m],n.count,l,c,u,d),l+=4*n.pathLengths[m],u+=2*n.pathLengths[m],v+=n.pathLengths[m]}function O(e,t,r,n,i,a,o,s,l,u,d,f,p,h,v,m,g){c.vec3.copy(V,m);for(var y=v>0?1:-1,b=3*r,x=f,_=3*x,S=f+n,w=3*S,C=0;C<n;++C)g&&(V[0]=e[b+0],V[1]=e[b+1],V[2]=e[b+2],c.vec3.normalize(V,V)),s[_+0]=e[b+0],s[_+1]=e[b+1],s[_+2]=e[b+2],l[_+0]=t[b+0],l[_+1]=t[b+1],l[_+2]=t[b+2],u[_+0]=-y*V[0],u[_+1]=-y*V[1],u[_+2]=-y*V[2],d[x]=0,s[w+0]=e[b+0]+v*V[0],s[w+1]=e[b+1]+v*V[1],s[w+2]=e[b+2]+v*V[2],l[w+0]=t[b+0],l[w+1]=t[b+1],l[w+2]=t[b+2],u[w+0]=y*V[0],u[w+1]=y*V[1],u[w+2]=y*V[2],d[S]=v,_+=3,w+=3,b+=3,x+=1,S+=1;b=3*a,_=3*h,w=3*(h+o),_=3*(h+o),w=3*h;var P=L,E=F;v<0&&(P=F,E=L);for(C=0;C<o;++C)p[_+0]=i[b+P[0]],p[_+1]=i[b+P[1]],p[_+2]=i[b+P[2]],p[w+0]=i[b+E[0]]+n,p[w+1]=i[b+E[1]]+n,p[w+2]=i[b+E[2]]+n,_+=3,w+=3,b+=3}function A(e,t,r,n,i,a,o){n[a]=n[o],o*=3,e[(a*=3)+0]=e[o+0],e[a+1]=e[o+1],e[a+2]=e[o+2],t[a+0]=t[o+0],t[a+1]=t[o+1],t[a+2]=t[o+2],r[a+0]=i[0],r[a+1]=i[1],r[a+2]=i[2]}function R(e,t,r,n,i,a,o,s,l,c,u){var d=i,f=i+1,p=i+o,h=i+o+1,v=s,m=s+1,g=s+2*a,y=s+2*a+1;u<0&&(d=i+o+1,h=i),c*=3;for(var b=0;b<a;++b)b===a-1&&(u>0?(f=i,h=i+o):(f=i,d=i+o)),M(e,d,f,p,z),A(e,t,n,r,z,v,d),A(e,t,n,r,z,m,f),A(e,t,n,r,z,g,p),A(e,t,n,r,z,y,h),l[c++]=v,l[c++]=g,l[c++]=y,l[c++]=v,l[c++]=y,l[c++]=m,d++,f++,p++,h++,v+=2,m+=2,g+=2,y+=2}function M(e,t,r,n,i){t*=3,r*=3,n*=3,c.vec3.set(j,e[t++],e[t++],e[t++]),c.vec3.set(G,e[r++],e[r++],e[r++]),c.vec3.set(H,e[n++],e[n++],e[n++]),c.vec3.subtract(k,G,j),c.vec3.subtract(W,H,j),c.vec3.cross(i,W,k),c.vec3.normalize(i,i)}function I(e,t,r,n){B.spatialReference=r.spatialReference;for(var i=e.getGeometryRecords(),a=i.length,o="absolute-height"!==t.mode,u=0,d=e.objectTransformation,f=s.mat4.invert(l.mat4f64.create(),d),p=0;p<a;p++){var v=i[p].geometry;v.invalidateBoundingInfo();for(var m=v.data.getVertexAttr(),g=m[P.VertexAttrConstants.POSITION].data,y=m[P.VertexAttrConstants.SIZE].data,b=m.mapPos.data,x=g.length/3,_=0,S=0,w=!1,C=0,E=0;E<x;E++){B.x=b[S],B.y=b[S+1],B.z=b[S+2],q[0]=g[_],q[1]=g[_+1],q[2]=g[_+2];var T=h.computeElevation(r,B,t,n,o?N:null);o&&(C+=N.terrainElevation),c.vec3.set(D,g[_+0],g[_+1],g[_+2]),c.vec3.transformMat4(D,D,d),n.setAltitude(T+y[_/3],D),c.vec3.transformMat4(D,D,f),g[_]=D[0],g[_+1]=D[1],g[_+2]=D[2];var O=.01/n.unitInMeters;(Math.abs(q[0]-g[_])>O||Math.abs(q[1]-g[_+1])>O||Math.abs(q[2]-g[_+2])>O)&&(w=!0),S+=3,_+=3}w&&e.geometryVertexAttrsUpdated(p),u+=C/x}return u/a}Object.defineProperty(t,"__esModule",{value:!0});var D=u.vec3f64.create(),V=u.vec3f64.create(),L=[0,2,1],F=[0,1,2],B=f.makeDehydratedPoint(0,0,0,null),N={verticalDistanceToGround:0,terrainElevation:0},U=function(e){function t(t,r,n,i){var a=e.call(this,t,r,n,i)||this;if(a._edgeStageObjects=new Set,!a._isPropertyDriven("size")){var o=m.validateSymbolLayerSize(a._getSymbolSize());if(o)return a._logWarning(o),a.reject(),a}var s=a._getStageIdHint(),l=a._getMaterialOpacityAndColor(),c=u.vec3f64.fromArray(l),d=l[3],f={diffuse:c,ambient:c,opacity:d,transparent:d<1||a._isPropertyDriven("opacity"),vertexColors:!0,slicePlaneEnabled:a._context.slicePlaneEnabled,castShadows:a.symbolLayer.castShadows};return a._material=new E(f,s+"_3dlinemat"),a._context.stage.add(_.ModelContentType.MATERIAL,a._material),a.resolve(),a}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&this._context.stage.remove(_.ModelContentType.MATERIAL,this._material.id)},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,r=e.graphic,n=r.geometry;if("polygon"!==n.type&&"extent"!==n.type)return this._logWarning("unsupported geometry type for extrude symbol: "+n.type),null;if(!this._validateGeometry(n))return null;var i="graphic"+r.uid,a=this._getVertexOpacityAndColor(t,Float32Array,255),o=this.getGraphicElevationContext(r);return this._createAs3DShape(n,t,a,o,i,r.uid)},t.prototype.layerOpacityChanged=function(){var e=this._getMaterialOpacity(),t=e<1||this._isPropertyDriven("opacity");if(this._material.setParameterValues({opacity:e,transparent:t}),this._edgeStageObjects.size>0){var r=this._context.stage.view.ensureEdgeView(),n=this._getLayerOpacity();this._edgeStageObjects.forEach(function(e){return r.updateAllComponentOpacities(e,[n])})}return!0},t.prototype.layerElevationInfoChanged=function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,h.needsElevationUpdates3D)},t.prototype.slicePlaneEnabledChanged=function(e,t){var r=this;if(this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),this._edgeStageObjects.size>0){var i=this._context.stage.view.ensureEdgeView(),a=this._createEdgeMaterial(i);if(n.isSome(a)){var o=[a];this._edgeStageObjects.forEach(function(e){return i.updateAllComponentMaterials(e,o,{slicePlaneEnabled:r._context.slicePlaneEnabled},!1)})}}return!0},t.prototype.pixelRatioChanged=function(e,t){return!0},t.prototype._getExtrusionSize=function(e){return(e.size&&this._isPropertyDriven("size")?h.getSingleSizeDriver(e.size,2):this._getSymbolSize())/this._context.renderCoordsHelper.unitInMeters},t.prototype._getSymbolSize=function(){return this.symbolLayer.size||1},t.prototype._createAs3DShape=function(e,t,r,c,f,v){var g=this,_="extent"===e.type?d.fromExtent(e):e,w=_.rings,P=[],E=[],O=[],A=new Array(6),R=this._context.renderSpatialReference===y.SphericalECEFSpatialReference,M=this._getExtrusionSize(t),D=u.vec3f64.create();R||this._context.renderCoordsHelper.worldUpAtPosition(null,D);var V=h.getGeometryVertexData3D(w,_.hasZ,_.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,c);if(this._logGeometryCreationWarnings(V,w,"rings","ExtrudeSymbol3DLayer"),0===w.length||!w.some(function(e){return e.length>0}))return null;var L=m.computeCentroid(_),F=l.mat4f64.create();y.computeLinearTransformation(_.spatialReference,[L.x,L.y,0],F,this._context.renderSpatialReference);var B=l.mat4f64.create();s.mat4.invert(B,F);var N=o.mat3f64.create();a.mat3.normalFromMat4(N,B);for(var U=V.geometryData.polygons,z=V.eleVertexData,j=V.vertexData,G=j.length/3,H=new Float64Array(3*G*6),k=new Float64Array(3*G*6),W=new Float64Array(3*G*6),q=new Float64Array(1*G*6),X=0,Y=this,Q=0;Q<U.length;++Q)!function(e){var t=U[e],n=t.count,a=t.index;if(Y._context.clippingExtent&&(h.computeBoundingBox(z,a,n,A),h.boundingBoxClipped(A,Y._context.clippingExtent)))return"continue";var o=new Float64Array(z.buffer,3*a*H.BYTES_PER_ELEMENT,3*n),s=t.holeIndices.map(function(e){return e-a}),c=i(o,s,3);if(0===c.length)return"continue";var u=3*n*2+2*c.length,d=new Uint32Array(u),p=6*n,v=3*H.BYTES_PER_ELEMENT,m=new b.BufferViewVec3f64(H.buffer,X*v,v,(X+p)*v),g=3*k.BYTES_PER_ELEMENT,y=new b.BufferViewVec3f64(k.buffer,X*g,g,(X+p)*g),_=new Float64Array(W.buffer,3*X*W.BYTES_PER_ELEMENT,3*p),w=new Float64Array(q.buffer,1*X*q.BYTES_PER_ELEMENT,1*p);T(j,z,c,t,m.typedBuffer,_,y.typedBuffer,w,0,d,0,M,D,R),x.transformMat4(m,m,B),x.transformMat3(y,y,N),X+=6*n;var C=Y._createExtrudeGeometry(d,{positions:m.typedBuffer,elevation:_,normals:y.typedBuffer,heights:w},r),I=new S(C,f+"path"+e);I.singleUse=!0,P.push(I),E.push(Y._material),O.push(l.mat4f64.create())}(Q);if(0===P.length)return null;var Z=new C({geometries:P,materials:E,transformations:O,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:v},idHint:f});Z.objectTransformation=F;var J=function(e){var t=g._context.stage.view.ensureEdgeView();t.removeObject(e),g._edgeStageObjects.delete(e);var r=g._createEdgeMaterial(t);n.isSome(r)&&(g._edgeStageObjects.add(e),t.addObject(e,[r],{slicePlaneEnabled:g._context.slicePlaneEnabled},!g._context.isAsync))};J(Z);var K=new p(this,Z,P,null,null,function(e,t,r,n){var i=I(e.stageObject,t,r,n);return J(Z),i},c);return K.alignedTerrainElevation=V.terrainElevation,K.needsElevationUpdates=h.needsElevationUpdates3D(c.mode),K},t.prototype._createExtrudeGeometry=function(e,t,r){for(var n=e.length,i=e,a=new Uint32Array(n),o=0;o<n;o++)a[o]=0;var s={},l={};return s[P.VertexAttrConstants.POSITION]=i,s[P.VertexAttrConstants.NORMAL]=i,s[P.VertexAttrConstants.COLOR]=a,l[P.VertexAttrConstants.POSITION]={size:3,data:t.positions},l[P.VertexAttrConstants.NORMAL]={size:3,data:t.normals},l[P.VertexAttrConstants.COLOR]={size:4,data:r},l[P.VertexAttrConstants.SIZE]={size:1,data:t.heights},t.elevation&&(l.mapPos={size:3,data:t.elevation},s.mapPos=i),new w(l,s)},t.prototype._createEdgeMaterial=function(e){var t={opacity:this._getLayerOpacity()};return g.createMaterial(e,this.symbolLayer,t)},t}(v.default);t.Graphics3DExtrudeSymbolLayer=U;var z=u.vec3f64.create(),j=u.vec3f64.create(),G=u.vec3f64.create(),H=u.vec3f64.create(),k=u.vec3f64.create(),W=u.vec3f64.create(),q=u.vec3f64.create();t.default=U}.apply(null,n))||(e.exports=i)},cE5x:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qsST")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r.getLogger("esri.views.3d.glTF"),i=function(){function e(){}return e.prototype.error=function(e){throw new Error("[glTF loader]"+e)},e.prototype.errorUnsupported=function(e){this.error("[Unsupported Feature] "+e)},e.prototype.errorUnsupportedIf=function(e,t){e&&this.error("[Unsupported Feature] "+t)},e.prototype.assert=function(e,t){e||this.error(t)},e.prototype.warn=function(e){n.warn(e)},e.prototype.warnUnsupported=function(e){this.warn("[Unsupported Feature] "+e)},e.prototype.warnUnsupportedIf=function(e,t){e&&this.warnUnsupported(t)},e}();t.DefaultErrorContext=i}.apply(null,n))||(e.exports=i)},cMCQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("Q2wQ"),r("HZ3d"),r("2Atf"),r("rg9i"),r("LxLY"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("WRgd"),r("5PWn"),r("pN8M"),r("jj3b"),r("ZuXA"),r("Rqxa"),r("AzkI"),r("VfPl"),r("Q39H"),r("TqPN"),r("ys4y"),r("AgDx"),r("yqrJ"),r("TP2F")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w,C,P){function E(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function T(e,t,r){var n=e.model,i=c.mat4f64.create(),o=new Array,u=new Map,d=new Map;return n.lods.forEach(function(e,c){if(void 0===r||c===r){var p=0,h={stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:s.isSome(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:f.empty()};o.push(h),e.parts.forEach(function(r){var o=r.material+(r.attributes.normal?"_normal":"")+(r.attributes.color?"_color":"")+(r.attributes.texCoord0?"_texCoord0":"")+(r.attributes.tangent?"_tangent":""),c=n.materials.get(r.material),v=s.isSome(r.attributes.texCoord0),m=s.isSome(r.attributes.normal);if(!u.has(o)){if(s.isSome(c.textureColor)&&v&&!d.has(c.textureColor)){var g=n.textures.get(c.textureColor),y=a({},g.parameters,{preMultiplyAlpha:!0});d.set(c.textureColor,new C(g.data,c.textureColor,y))}if(s.isSome(c.textureNormal)&&v&&!d.has(c.textureNormal)){g=n.textures.get(c.textureNormal),y=a({},g.parameters,{preMultiplyAlpha:!0});d.set(c.textureNormal,new C(g.data,c.textureNormal,y))}var E=P.COLOR_GAMMA,T=Math.pow(c.color[0],1/E),R=Math.pow(c.color[1],1/E),M=Math.pow(c.color[2],1/E);u.set(o,new P(a({transparent:"BLEND"===c.alphaMode,textureAlphaMode:O(c.alphaMode),textureAlphaCutoff:c.alphaCutoff,diffuse:[T,R,M],ambient:[T,R,M],opacity:c.opacity,doubleSided:c.doubleSided,doubleSidedType:"winding-order",vertexColors:!!r.attributes.color,vertexTangents:!!r.attributes.tangent,normals:m?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:s.isSome(c.textureColor)&&v?d.get(c.textureColor).id:void 0,colorMixMode:c.colorMixMode,normalTextureId:s.isSome(c.textureNormal)&&v?d.get(c.textureNormal).id:void 0,textureAlphaPremultiplied:!0},t),o))}var I=A(r.indices||r.attributes.position.count,r.primitiveType),D={},V={},L=r.attributes.position.count,F=_.createBuffer(b.BufferViewVec3f,L);if(x.vec3.transformMat4(F,r.attributes.position,r.transform),V.position={data:F.typedBuffer,size:F.elementCount},D.position=I,s.isSome(r.attributes.normal)){var B=_.createBuffer(b.BufferViewVec3f,L);l.mat4.invert(i,r.transform),l.mat4.transpose(i,i),x.vec3.transformMat4(B,r.attributes.normal,i),V.normal={data:B.typedBuffer,size:B.elementCount},D.normal=I}if(s.isSome(r.attributes.tangent)){var N=_.createBuffer(b.BufferViewVec4f,L);l.mat4.invert(i,r.transform),l.mat4.transpose(i,i),x.vec4.transformMat4(N,r.attributes.tangent,i),V.aTangent={data:N.typedBuffer,size:N.elementCount},D.aTangent=I}if(s.isSome(r.attributes.texCoord0)){var U=_.createBuffer(b.BufferViewVec2f,L);_.vec2.normalizeIntegerBuffer(U,r.attributes.texCoord0),V.uv0={data:U.typedBuffer,size:U.elementCount},D.uv0=I}if(s.isSome(r.attributes.color)){var z=_.createBuffer(b.BufferViewVec4u8,L);if(4===r.attributes.color.elementCount)r.attributes.color instanceof b.BufferViewVec4f?x.vec4.scale(z,r.attributes.color,255):r.attributes.color instanceof b.BufferViewVec4u8?_.vec4.copy(z,r.attributes.color):r.attributes.color instanceof b.BufferViewVec4u16&&x.vec4.scale(z,r.attributes.color,1/256);else{_.vec4.fill(z,255,255,255,255);var j=new b.BufferViewVec3u8(z.buffer,0,4);r.attributes.color instanceof b.BufferViewVec3f?x.vec3.scale(j,r.attributes.color,255):r.attributes.color instanceof b.BufferViewVec3u8?_.vec3.copy(j,r.attributes.color):r.attributes.color instanceof b.BufferViewVec3u16&&x.vec3.scale(j,r.attributes.color,1/256)}V.color={data:z.typedBuffer,size:z.elementCount},D.color=I}var G=new S(new w(V,D),"gltf_"+e.name+"_"+p++);h.stageResources.geometries.push(G),h.stageResources.materials.push(u.get(o)),s.isSome(c.textureColor)&&v&&h.stageResources.textures.push(d.get(c.textureColor)),s.isSome(c.textureNormal)&&v&&h.stageResources.textures.push(d.get(c.textureNormal)),h.numberOfVertices+=L;var H=G.boundingInfo;f.expand(h.boundingBox,H.getBBMin()),f.expand(h.boundingBox,H.getBBMax())})}}),o}function O(e){switch(e){case"BLEND":return"blend";case"MASK":return"mask";case"OPAQUE":return"opaque";default:return"blend"}}function A(e,t){switch(t){case 4:return m.trianglesToTriangles(e);case 5:return m.triangleStripToTriangles(e);case 6:return m.triangleFanToTriangles(e)}}function R(e,t){void 0===e&&(e=""),void 0===t&&(t="");var r=o.endsWith(e,"Imposter"),n=e.split("__")[0];if(-1!==t.indexOf("/RealisticTrees/")){var i=h.treeParamsTable[n];if(i)return{crownCenter:i.center,crownDimensions:i.radius,imposter:r}}}function M(e){if(e.meta.isEsriSymbolResource){var t=function(e,t){var r=e.attributes.normal,n=e.attributes.position,i=n.count;if(!s.isNone(r)){for(var a=d.vec3f64.create(),o=d.vec3f64.create(),f=d.vec3f64.create(),p=_.createBuffer(b.BufferViewVec4u8,i),h=_.createBuffer(b.BufferViewVec3f,i),v=l.mat4.invert(c.mat4f64.create(),e.transform),m=u.vec3.transformMat4(d.vec3f64.create(),t.crownCenter,v),g=u.vec3.transformMat4(d.vec3f64.create(),t.crownDimensions,v),x=0;x<i;x++){n.getVec(x,o),r.getVec(x,a),u.vec3.subtract(f,o,m),u.vec3.divide(f,f,g);var S=y.clamp(u.vec3.length(f),0,1),w=.6+.4*S*S;u.vec3.lerp(f,f,a,.2),h.setVec(x,f),p.set(x,0,255*w),p.set(x,1,255*w),p.set(x,2,255*w),p.set(x,3,255)}e.attributes.normal=h,e.attributes.color=p}};e.model.lods.forEach(function(r){var n=R(r.name,e.meta.uri);n&&(e.customMeta.esriTreeRendering=!0,r.parts.forEach(function(e){t(e,n)}))})}}function I(e){var t=e.model.lods.length;e.meta.isEsriSymbolResource&&e.model.lods.forEach(function(e){if(!s.isSome(e.lodThreshold)){var r=(e.name||"").split("__")[0],n=e.parts.reduce(function(e,t){return e+t.attributes.position.count},0);e.lodThreshold=D(r,n,t)}})}function D(e,t,r){if(void 0===e&&(e=""),1===r)return null;if(e in h.lodThresholdLUT){var n=h.lodThresholdLUT[e].vertexCounts,i=h.lodThresholdLUT[e].thresholds,a=n.length,o=t;if(a<=1)return null;if(o<=n[0]){var s=(n[1]-n[0])/(i[1]-i[0]),l=o-n[0];return Math.max(0,i[0]+l*s)}if(o>=n[a-1]){s=(n[a-1]-n[a-2])/(i[a-1]-i[a-2]),l=o-n[a-1];return i[a-1]+l*s}for(var c=1;c<n.length;++c){var u=n[c-1],d=n[c],f=i[c-1],p=i[c];if(o<d){var v=(o-u)/(d-u);return f*(1-v)+p*v}}}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.fetch=function(e,t){return void 0===t&&(t={}),i(this,void 0,void 0,function(){var r,i,o,s,l,c,u,d,f,h;return n(this,function(n){switch(n.label){case 0:return"wosr"!==(r=E(e)).fileType?[3,2]:[4,g.load(r.url,t)];case 1:return[2,{lods:[i=n.sent()],referenceBoundingBox:i.boundingBox}];case 2:return o=new p.DefaultLoadingContext(t.streamDataSupplier),[4,v.load(o,r.url,t)];case 3:return M(s=n.sent()),I(s),l=a({},t.materialParamsMixin,{treeRendering:s.customMeta.esriTreeRendering}),null!=r.specifiedLodIndex?(c=T(s,l,r.specifiedLodIndex),u=c[0].boundingBox,0!==r.specifiedLodIndex&&(d=T(s,l,r.specifiedLodIndex),u=d[0].boundingBox),[2,{lods:c,referenceBoundingBox:u}]):(f=T(s,l),h=f[0].boundingBox,[2,{lods:f,referenceBoundingBox:h}])}})})},t.parseUrl=E,t.gltfToEngineResources=T}.apply(null,n))||(e.exports=i)},cjy9:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("AzkI"),r("rjU6"),r("xsp2")],void 0===(i=function(e,t,r,n,i,a,o,s,l){return function(){function e(e,t,r,n,i,o,s,l,c,u,d){this.shaderTransformationDirty=!0,this.data=e.toRenderData(),this.componentOffsets=e.componentOffsets,this.boundingInfo=t,this.material=r,this.origin=null,this.center=a.vec3f64.create(),this.bsRadius=0,this.transformation=null,this.calculateShaderTransformation=i,n&&this.updateTransformation(n,o),this.castShadow=s,this.singleUse=l,this.name=c,this.uniqueName=u,this.idx=d,this.instanceParameters={}}return e.prototype.updateTransformation=function(e,t){this.transformation=e,this.shaderTransformationDirty=!0,this.bsRadius=this.getBoundingSphere(e,t,this.center)},e.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0},e.prototype.getBoundingSphere=function(e,t,r){return t=t||o.maxScale(e),i.vec3.transformMat4(r,this.boundingInfo.getCenter(),e),this.boundingInfo.getBSRadius()*t},Object.defineProperty(e.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentCount",{get:function(){return s.componentCount(this.componentOffsets)},enumerable:!0,configurable:!0}),e.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=n.mat4f64.create()),r.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(this.transformation)),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation},e.prototype.getIndices=function(e){return"indices"in this.data?this.data.indices[e]:null},e.prototype.getAttribute=function(e){return"vertexAttr"in this.data?this.data.vertexAttr[e]:null},e.prototype.addHighlight=function(e){var t=l.generateHighlightId(),r=this.instanceParameters;return r.componentHighlights=s.addHighlight(r.componentHighlights,null,e,t),t},e.prototype.removeHighlight=function(e){var t=this.instanceParameters;t.componentHighlights=s.removeHighlight(t.componentHighlights,e)},e}()}.apply(null,n))||(e.exports=i)},cpxo:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("PHan"),r("FXVB"),r("0LE5"),r("Rdxj"),r("2fXB"),r("O7NG"),r("JjCO"),r("fXZm"),r("GG08")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u){function d(e){if(e){var t=e.planes,r=e.points;return{planes:[u.create(t[0]),u.create(t[1]),u.create(t[2]),u.create(t[3]),u.create(t[4]),u.create(t[5])],points:[a.vec3f64.clone(r[0]),a.vec3f64.clone(r[1]),a.vec3f64.clone(r[2]),a.vec3f64.clone(r[3]),a.vec3f64.clone(r[4]),a.vec3f64.clone(r[5]),a.vec3f64.clone(r[6]),a.vec3f64.clone(r[7])]}}return{planes:[u.create(),u.create(),u.create(),u.create(),u.create(),u.create()],points:[a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create()]}}function f(e,t,r){void 0===r&&(r=d());for(var n=0;n<6;n++)u.copy(e[n],r.planes[n]);for(n=0;n<8;n++)i.vec3.copy(r.points[n],t[n]);return r}function p(e){var t=e.planes,r=e.points;u.fromPoints(r[4],r[0],r[3],t[0]),u.fromPoints(r[1],r[5],r[6],t[1]),u.fromPoints(r[4],r[5],r[1],t[2]),u.fromPoints(r[3],r[2],r[6],t[3]),u.fromPoints(r[0],r[1],r[2],t[4]),u.fromPoints(r[5],r[4],r[7],t[5])}function h(e,t){for(var r=0;r<6;r++)if(!u.clip(e[r],t))return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.create=d,t.copy=function(e,t){return void 0===t&&(t=d()),f(e.planes,e.points,t)},t.fromValues=f,t.fromMatrix=function(e,t,r){void 0===r&&(r=d());var a=r.points,s=n.mat4.multiply(l.sm4d.get(),t,e);n.mat4.invert(s,s);for(var c=0;c<8;++c){var u=o.vec4.transformMat4(l.sv4d.get(),v[c],s);i.vec3.set(a[c],u[0]/u[3],u[1]/u[3],u[2]/u[3])}return p(r),r},t.recomputePlanes=p,t.intersectsSphere=function(e,t){for(var r=0;r<6;r++)if(u.isSphereFullyInside(e[r],t))return!1;return!0},t.intersectsRay=function(e,t){return h(e,c.fromRay(t,m.get()))},t.intersectsLineSegment=function(e,t,r){return h(e,c.fromLineSegmentAndDirection(t,r,m.get()))},t.intersectsPoint=function(e,t){for(var r=0;r<6;r++)if(u.signedDistance(e[r],t)>0)return!1;return!0},t.intersectsAABB=function(e,t){for(var r=0;r<6;r++)if(u.isAABBFullyInside(e[r],t))return!1;return!0},t.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};var v=[s.vec4f64.fromValues(-1,-1,-1,1),s.vec4f64.fromValues(1,-1,-1,1),s.vec4f64.fromValues(1,1,-1,1),s.vec4f64.fromValues(-1,1,-1,1),s.vec4f64.fromValues(-1,-1,1,1),s.vec4f64.fromValues(1,-1,1,1),s.vec4f64.fromValues(1,1,1,1),s.vec4f64.fromValues(-1,1,1,1)],m=new r.ObjectStack(c.create)}.apply(null,n))||(e.exports=i)},cza4:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*o,u=0;u<s;++u)n[l]=a[c],l+=i,c+=o},t.makeDense=function(e,t){var r=e.count;t||(t=new e.TypedArrayConstructor(r));for(var n=0;n<r;n++)t[n]=e.get(n);return t}}.apply(null,n))||(e.exports=i)},d81A:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("PND3"),r("LxLY"),r("qMld"),r("u90+"),r("nrlZ"),r("+6sX"),r("700l"),r("Ytki"),r("Q2Em"),r("/61J"),r("zDti")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p){Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function e(e,t,r){this.items=e,this.queryGeometry=t,this.definitionExpression=r.definitionExpression,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.fieldsMap=r.fieldsMap,this.timeInfo=r.timeInfo}return Object.defineProperty(e.prototype,"size",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),e.prototype.createQueryResponse=function(e){var t;return t=e.outStatistics?e.outStatistics.some(function(e){return"exceedslimit"===e.statisticType})?this._createExceedsLimitQueryResponse(e):this._createStatisticsQueryResponse(e):this._createFeatureQueryResponse(e),e.returnQueryGeometry&&(s.isValid(e.outSR)&&!s.equals(this.queryGeometry.spatialReference,e.outSR)?t.queryGeometry=p.cleanFromGeometryEngine(r({spatialReference:e.outSR},d.project(this.queryGeometry,this.queryGeometry.spatialReference,e.outSR))):t.queryGeometry=p.cleanFromGeometryEngine(r({spatialReference:e.outSR},this.queryGeometry))),t},e.prototype.executeAttributesQuery=function(t){var r=u.getWhereClause(t.where);if(!r)return a.resolve(this);if(r.isStandardized()){for(var n=0,i=[],o=0,s=this.items;o<s.length;o++){var l=s[o];r.testFeature(l.attributes)&&(i[n++]=l)}var c=new e(i,this.queryGeometry,this);return c.definitionExpression=t.where,a.resolve(c)}return a.reject(new TypeError("Where clause is not standardized"))},e.prototype.executeObjectIdsQuery=function(t){if(!t.objectIds||!t.objectIds.length)return a.resolve(this);var r=new n.default(t.objectIds);return a.resolve(new e(this.items.filter(function(e){return r.has(e.objectId)}),this.queryGeometry,this))},e.prototype.executeTimeQuery=function(t){var r=f.getTimeOperator(this.timeInfo,t.timeExtent);if(!i.isSome(r))return a.resolve(this);var n=this.items.filter(r);return a.resolve(new e(n,this.queryGeometry,this))},e.prototype.project=function(t){var r=this;return!t||s.equals(this.spatialReference,t)?a.resolve(this):d.projectMany(this.items.map(function(e){return p.getGeometry(r,e)}),this.spatialReference,t).then(function(n){for(var i=[],a=0;a<r.items.length;a++)i[a]={attributes:r.items[a].attributes,geometry:n[a]};var o=[];return l.convertFromFeatures(o,i,r.geometryType,r.hasZ,r.hasM,r.objectIdField),new e(o,r.queryGeometry,{definitionExpression:r.definitionExpression,geometryType:r.geometryType,hasM:r.hasM,hasZ:r.hasZ,objectIdField:r.objectIdField,spatialReference:t,fieldsMap:r.fieldsMap,timeInfo:r.timeInfo})})},e.prototype._createFeatureQueryResponse=function(e){var t=this,r=this.items,n=this,i=n.geometryType,a=n.hasM,s=n.hasZ,l=n.objectIdField,c=n.spatialReference,u=e.outFields,d=e.outSR,f=e.quantizationParameters,h=e.resultRecordCount,v=e.resultOffset,m=!1;if(null!=h&&null!=v){var g=v+h;m=r.length>g,r=r.slice(v,Math.min(r.length,g))}return{exceededTransferLimit:m,features:this._createFeatures(e,r),fields:u&&u.map(function(e){return t.fieldsMap.get(e)}),geometryType:i,hasM:a,hasZ:s,objectIdFieldName:l,spatialReference:p.cleanFromGeometryEngine(d||c),transform:f&&o.toQuantizationTransform(f)||null}},e.prototype._createFeatures=function(e,t){var r=new c.default(e,this.fieldsMap),n=e.quantizationParameters,i=e.returnGeometry,a=e.returnCentroid,s=e.maxAllowableOffset,l=e.orderByFields,u=[],d=0;if(t.length&&l&&l.length){var f=l[0].split(" "),h=f[0],v="DESC"===f[1];t.sort(function(e,t){var n=r.getFieldValue(e,h),i=r.getFieldValue(t,h);if("number"==typeof n&&"number"==typeof i)return v?i-n:n-i;if("string"==typeof n&&"string"==typeof i){var a=n.toUpperCase(),o=i.toUpperCase();return(v?a>o:a<o)?-1:(v?a<o:a>o)?1:0}})}if(i||a){var m=o.toQuantizationTransform(n);if(i&&!a)for(var g=0,y=t;g<y.length;g++){var b=y[g];u[d++]={attributes:r.getAttributes(b),geometry:p.getGeometry(this,b,s,m)}}else if(!i&&a)for(var x=0,_=t;x<_.length;x++){b=_[x];u[d++]={attributes:r.getAttributes(b),centroid:p.getCentroid(this,b,m)}}else for(var S=0,w=t;S<w.length;S++){b=w[S];u[d++]={attributes:r.getAttributes(b),centroid:p.getCentroid(this,b,m),geometry:p.getGeometry(this,b,s,m)}}}else for(var C=0,P=t;C<P.length;C++){b=P[C];var E=r.getAttributes(b);E&&(u[d++]={attributes:E})}return u},e.prototype._createExceedsLimitQueryResponse=function(e){for(var t=!1,r=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,a=0,o=e.outStatistics;a<o.length;a++){var s=o[a];if("exceedslimit"===s.statisticType){r=null!=s.maxPointCount?s.maxPointCount:Number.POSITIVE_INFINITY,n=null!=s.maxRecordCount?s.maxRecordCount:Number.POSITIVE_INFINITY,i=null!=s.maxVertexCount?s.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)t=this.items.length>r;else if(this.items.length>n)t=!0;else{var l=this.hasZ?this.hasM?4:3:this.hasM?3:2;t=this.items.reduce(function(e,t){return e+(t.geometry&&t.geometry.coords.length||0)},0)/l>i}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(t)}}]}},e.prototype._createStatisticsQueryResponse=function(e){for(var t=new c.default(e,this.fieldsMap),r=e.outStatistics,n=[],i=[],a=e.groupByFieldsForStatistics,o=e.having,s=a&&a.length,l=s&&a[0],u={},d={},f={},p={attributes:{}},h=0,v=r;h<v.length;h++){var m=v[h],g=m.outStatisticFieldName,y=m.statisticType,b="exceedslimit"!==m.statisticType?m.onStatisticField:void 0,x="1"===b;if(s&&(b===l||x)&&"count"===m.statisticType){u[b]||(u[b]=this._calculateUniqueValues(t,x?l:b));var _=u[b];for(var S in _){var w=_[S],C=w.count,P=w.data,E=w.items,T=d[P]||{attributes:{}};o&&!t.validateItems(E,o)||(T.attributes[g]=C,T.attributes[x?"EXPR_1":b]=P,d[P]=T)}i.push({name:g,alias:g,type:"esriFieldTypeString"})}else{if(s){var O=this._calculateUniqueValues(t,l);for(var S in O){var A=O[S];P=A.data,E=A.items;if(!o||t.validateItems(E,o)){T=d[P]||{attributes:{}};var R=this._calculateStatistics(E,t,b),M="var"===y?"variance":y;T.attributes[g]=R[M],T.attributes[l]=P,d[P]=T}}}else{f[b]||(f[b]=this._calculateStatistics(this.items,t,b));R=f[b],M="var"===y?"variance":y;p.attributes[g]=R[M]}i.push({name:g,alias:g,type:"esriFieldTypeDouble"})}}if(s)for(var I in d)n.push(d[I]);else n.push(p);return{fields:i,features:n}},e.prototype._calculateStatistics=function(e,t,r){for(var n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=null,o=null,s=null,l=null,c=[],u=0;u<e.length;u++){var d=e[u];null==(m=t.getFieldValue(d,r))||isNaN(m)||(a+=m,n=Math.min(n,m),i=Math.max(i,m),c.push(m))}var f=c.length;if(f){o=a/f;for(var p=0,h=0,v=c;h<v.length;h++){var m=v[h];p+=Math.pow(m-o,2)}l=f>1?p/(f-1):0,s=Math.sqrt(l)}else n=null,i=null;return{avg:o,count:f,max:i,min:n,stddev:s,sum:a,variance:l}},e.prototype._calculateUniqueValues=function(e,t){for(var r={},n=0,i=this.items;n<i.length;n++){var a=i[n],o=e.getFieldValue(a,t);(null==o||"string"==typeof o&&""===o.trim())&&(o=null),null==r[o]?r[o]={count:1,data:o,items:[a]}:(r[o].count++,r[o].items.push(a))}return r},e}();t.default=h}.apply(null,n))||(e.exports=i)},"dB/a":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*o,u=0;u<s;++u){for(var d=0;d<16;++d)n[l+d]=a[c+d];l+=i,c+=o}}}.apply(null,n))||(e.exports=i)},dJJN:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ma1f"),r("6zaU")],void 0===(i=function(e,t,r,n){function i(e,t){if(!t)return null;var n;if((n=Array.isArray(t)?t:[t]).length>0){var i=n.map(function(e){return e.details.symbol.type||e.details.symbol.declaredClass}).filter(function(e){return!!e});i.sort();var a=[];return i.forEach(function(e,t){0!==t&&e===i[t-1]||a.push(e)}),new r("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+a.join(", ")+") which are not supported in 3D",{renderer:e,symbolErrors:n})}return null}function a(e){return i(e,n.to3D(e.symbol).error)}function o(e){var t=e.uniqueValueInfos.map(function(e){return n.to3D(e.symbol).error}).filter(function(e){return!!e}),r=n.to3D(e.defaultSymbol);return r.error&&t.unshift(r.error),i(e,t)}function s(e){var t=e.classBreakInfos.map(function(e){return n.to3D(e.symbol).error}).filter(function(e){return!!e}),r=n.to3D(e.defaultSymbol);return r.error&&t.unshift(r.error),i(e,t)}function l(e){return"simple"===e.type}function c(e){return"unique-value"===e.type}function u(e){return"class-breaks"===e.type}Object.defineProperty(t,"__esModule",{value:!0}),t.validateTo3D=function(e){return e?l(e)?a(e):c(e)?o(e):u(e)?s(e):new r("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(e.type||e.declaredClass)+"'",{renderer:e}):null}}.apply(null,n))||(e.exports=i)},dQtU:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("WRgd"),r("ys4y"),r("4ziW")],void 0===(i=function(e,t,r,n,i,a){Object.defineProperty(t,"__esModule",{value:!0});var o=n.fromValues(-.5,-.5,-.5,.5,.5,.5),s=n.fromValues(-.5,-.5,0,.5,.5,1),l=n.fromValues(-.5,-.5,0,.5,.5,.5);t.isValidPrimitive=function(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1},t.primitiveBoundingBox=function(e){switch(e){case"sphere":case"cube":case"diamond":return o;case"cylinder":case"cone":case"inverted-cone":return s;case"tetrahedron":return l;default:r.neverReached(e)}},t.primitiveGeometryData=function(e){switch(e){case"sphere":return a.createPolySphereGeometry(.5,2,!0);case"cube":return a.createBoxGeometry(1);case"cylinder":return a.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case"cone":return a.cgToGIS(a.createConeGeometry(1,.5,15,!1));case"inverted-cone":return a.cgToGIS(a.createConeGeometry(1,.5,15,!0));case"tetrahedron":return a.cgToGIS(a.createTetrahedronGeometry(1));case"diamond":return a.cgToGIS(a.createDiamondGeometry(1));default:r.neverReached(e)}},t.primitiveLodResources=function(e,t,n){var o=function(e,r,o){return void 0===o&&(o=!1),{levels:e.map(function(e,s){var l=r(e.tesselation);return o&&a.cgToGIS(l),{components:[{geometry:new i(l,n+"_lod"+s),material:t}],faceCount:l.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}})}};switch(e){case"sphere":return o([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],function(e){return a.createPolySphereGeometry(.5,e,!0)});case"cube":return o([{tesselation:0,minScreenSpaceRadius:0}],function(e){return a.createBoxGeometry(1)});case"cone":return o(c,function(e){return a.createConeGeometry(1,.5,e,!1)},!0);case"inverted-cone":return o(c,function(e){return a.createConeGeometry(1,.5,e,!0)},!0);case"cylinder":return o(c,function(e){return a.createCylinderGeometry(1,.5,e,[0,0,1],[0,0,.5])});case"tetrahedron":return o([{tesselation:0,minScreenSpaceRadius:0}],function(e){return a.createTetrahedronGeometry(1)},!0);case"diamond":return o([{tesselation:0,minScreenSpaceRadius:0}],function(e){return a.createDiamondGeometry(1)},!0);default:r.neverReached(e)}};var c=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]}.apply(null,n))||(e.exports=i)},deO7:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.startMeasurement=function(e){var t=e.capabilities.disjointTimerQuery;return t?new r(t):null},t.getTimestamp=function(e,t,r){void 0===r&&(r=50);var n=e.capabilities.disjointTimerQuery;if(!n)return null;if(n.timestampBits()<=0)return null;var i=n.createQuery();n.createTimestamp(i);var a=function(){var e=n.resultAvailable(i),o=n.disjoint();if(!e||o)o?t():setTimeout(a,r);else{var s=n.getResult(i);t(s/1e6)}};a()},t.supportsTimestamps=function(e){var t=e.capabilities.disjointTimerQuery;return!!t&&t.timestampBits()>0};var r=function(){function e(e){this.timer=e,this.query=e.createQuery(),this.timer.beginTimeElapsed(this.query)}return e.prototype.stop=function(e,t){void 0===t&&(t=50),this.cb=e,this.checkInterval=t,this.timer.endTimeElapsed(),this.checkQueryResult()},e.prototype.checkQueryResult=function(){var e=this.timer.resultAvailable(this.query),t=this.timer.disjoint();if(!e||t)t?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval);else{var r=this.timer.getResult(this.query);this.cb(r/1e6)}},e}()}.apply(null,n))||(e.exports=i)},doLD:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("51bw"),r("FXVB"),r("1m5D"),r("W9tT"),r("DIqE"),r("0LE5"),r("Rdxj"),r("2fXB"),r("O7NG"),r("AzkI"),r("RsYQ"),r("/Bau"),r("CIy2"),r("/f24"),r("Zp3t"),r("Kfys")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g){function y(e,t,r,n,i,o,s,l){a.vec2.set(G,0,0);for(var c=0;c<4;++c)a.vec2.add(G,G,e[c]);a.vec2.scale(G,G,.25),a.vec2.set(H,0,0);for(c=4;c<8;++c)a.vec2.add(H,H,e[c]);a.vec2.scale(H,H,.25),a.vec2.lerp(k[0],e[4],e[5],.5),a.vec2.lerp(k[1],e[5],e[6],.5),a.vec2.lerp(k[2],e[6],e[7],.5),a.vec2.lerp(k[3],e[7],e[4],.5);var u=0,d=a.vec2.squaredDistance(k[0],G);for(c=1;c<4;++c){var f=a.vec2.squaredDistance(k[c],G);f<d&&(d=f,u=c)}a.vec2.subtract(W,k[u],e[u+4]);var p,v,m=W[0];W[0]=-W[1],W[1]=m,a.vec2.subtract(q,H,G),a.vec2.lerp(W,W,q,r),a.vec2.normalize(W,W),p=v=a.vec2.dot(a.vec2.subtract(X,e[0],G),W);for(c=1;c<8;++c){var g=a.vec2.dot(a.vec2.subtract(X,e[c],G),W);g<p?p=g:g>v&&(v=g)}a.vec2.copy(n,G),a.vec2.scale(X,W,p-t),a.vec2.add(n,n,X);var y=-1,b=1,x=0,_=0;for(c=0;c<8;++c){a.vec2.subtract(Y,e[c],n),a.vec2.normalize(Y,Y);var S=W[0]*Y[1]-W[1]*Y[0];S>0?S>y&&(y=S,x=c):S<b&&(b=S,_=c)}h.verify(y>0,"leftArea"),h.verify(b<0,"rightArea"),a.vec2.scale(Q,W,p),a.vec2.add(Q,Q,G),a.vec2.scale(Z,W,v),a.vec2.add(Z,Z,G),J[0]=-W[1],J[1]=W[0];var w=h.rayRay2D(n,e[_],Z,a.vec2.add(X,Z,J),1,i),C=h.rayRay2D(n,e[x],Z,X,1,o),P=h.rayRay2D(n,e[x],Q,a.vec2.add(X,Q,J),1,s),E=h.rayRay2D(n,e[_],Q,X,1,l);h.verify(w,"rayRay"),h.verify(C,"rayRay"),h.verify(P,"rayRay"),h.verify(E,"rayRay")}function b(e,t){return 3*t+e}function x(e,t){return a.vec2.set(K,e[t],e[t+3]),K}function _(e,t,r,n,i){a.vec2.subtract($,r,n),a.vec2.scale($,$,.5),ee[0]=$[0],ee[1]=$[1],ee[2]=0,ee[3]=$[1],ee[4]=-$[0],ee[5]=0,ee[6]=$[0]*$[0]+$[1]*$[1],ee[7]=$[0]*$[1]-$[1]*$[0],ee[8]=1,ee[b(0,2)]=-a.vec2.dot(x(ee,0),e),ee[b(1,2)]=-a.vec2.dot(x(ee,1),e);var o=a.vec2.dot(x(ee,0),r)+ee[b(0,2)],s=a.vec2.dot(x(ee,1),r)+ee[b(1,2)],l=a.vec2.dot(x(ee,0),n)+ee[b(0,2)],c=a.vec2.dot(x(ee,1),n)+ee[b(1,2)];o=-(o+l)/(s+c),ee[b(0,0)]+=ee[b(1,0)]*o,ee[b(0,1)]+=ee[b(1,1)]*o,ee[b(0,2)]+=ee[b(1,2)]*o,o=1/(a.vec2.dot(x(ee,0),r)+ee[b(0,2)]),s=1/(a.vec2.dot(x(ee,1),r)+ee[b(1,2)]),ee[b(0,0)]*=o,ee[b(0,1)]*=o,ee[b(0,2)]*=o,ee[b(1,0)]*=s,ee[b(1,1)]*=s,ee[b(1,2)]*=s,ee[b(2,0)]=ee[b(1,0)],ee[b(2,1)]=ee[b(1,1)],ee[b(2,2)]=ee[b(1,2)],ee[b(1,2)]+=1,o=-.5*((o=a.vec2.dot(x(ee,1),t)+ee[b(1,2)])/(s=a.vec2.dot(x(ee,2),t)+ee[b(2,2)])+(l=a.vec2.dot(x(ee,1),r)+ee[b(1,2)])/(c=a.vec2.dot(x(ee,2),r)+ee[b(2,2)])),ee[b(1,0)]+=ee[b(2,0)]*o,ee[b(1,1)]+=ee[b(2,1)]*o,ee[b(1,2)]+=ee[b(2,2)]*o,o=a.vec2.dot(x(ee,1),t)+ee[b(1,2)],l=-(s=a.vec2.dot(x(ee,2),t)+ee[b(2,2)])/o,ee[b(1,0)]*=l,ee[b(1,1)]*=l,ee[b(1,2)]*=l,i[0]=ee[0],i[1]=ee[1],i[2]=0,i[3]=ee[2],i[4]=ee[3],i[5]=ee[4],i[6]=0,i[7]=ee[5],i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=ee[6],i[13]=ee[7],i[14]=0,i[15]=ee[8]}for(var S=function(){this.camera=new f,this.lightMat=i.mat4f64.create()},w=function(){function e(e){this.doShadowMapMipmapsWork=!1,this.textureRes=4096,this.numCascades=1,this.maxNumCascades=2,this.cascadeDistances=[0,0,0,0,0],this.cascades=[],this.rctx=e,this.emptyTexture=p.createEmptyTexture(e);for(var t=0;t<4;++t)this.cascades.push(new S)}return e.prototype.dispose=function(){this.emptyTexture.dispose(),this.emptyTexture=null},Object.defineProperty(e.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(e){this.textureRes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(e){this.maxNumCascades=d.clamp(Math.floor(e),1,4)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),e.prototype.getDepthTexture=function(){return this.depthTexture},e.prototype.getCascades=function(){for(var e=0;e<this.numCascades;++e)U[e]=this.cascades[e];return U.length=this.numCascades,U},e.prototype.prepare=function(e,t,r){h.assert(this.enabled),n.mat4.multiply(P,e.projectionMatrix,e.viewMatrix);var i=r.near,a=r.far;i<2&&(i=2),a<2&&(a=2),i>=a&&(i=2,a=4),this.numCascades=Math.min(1+Math.floor(h.logWithBase(a/i,4)),this.maxNumCascades);for(var o=Math.pow(a/i,1/this.numCascades),l=0;l<this.numCascades+1;++l)this.cascadeDistances[l]=i*Math.pow(o,l);n.mat4.invert(E,P),n.mat4.lookAt(B,[0,0,0],[-t[0],-t[1],-t[2]],[0,1,0]);var u=e.viewMatrix,f=e.projectionMatrix;for(l=0;l<this.numCascades;++l){var p=this.cascades[l],v=-this.cascadeDistances[l],m=-this.cascadeDistances[l+1],g=(f[10]*v+f[14])/Math.abs(f[11]*v+f[15]),b=(f[10]*m+f[14])/Math.abs(f[11]*m+f[15]);h.assert(g<b);for(var x=0;x<8;++x){var S=x%4==0||x%4==3?-1:1,w=x%4==0||x%4==1?-1:1,A=x<4?g:b;c.vec4.set(T,S,w,A,1),c.vec4.transformMat4(O[x],T,E);for(var U=0;U<3;++U)O[x][U]/=O[x][3]}s.vec3.negate(N,O[0]),n.mat4.translate(C,B,N),p.camera.viewMatrix=C;for(x=0;x<8;++x)s.vec3.transformMat4(O[x],O[x],p.camera.viewMatrix);s.vec3.copy(R,O[0]),s.vec3.copy(M,O[0]);for(x=1;x<8;++x)for(U=0;U<3;++U)R[U]=Math.min(R[U],O[x][U]),M[U]=Math.max(M[U],O[x][U]);R[2]-=200,M[2]+=200,p.camera.near=-M[2],p.camera.far=-R[2],i=1/O[0][3],a=1/O[4][3],h.assert(i<a);var z=i+Math.sqrt(i*a),j=Math.sin(d.acos(u[2]*t[0]+u[6]*t[1]+u[10]*t[2]));y(O,z/=j,j,I,D,V,L,F),_(I,D,L,F,p.camera.projectionMatrix),p.camera.projectionMatrix[10]=2/(R[2]-M[2]),p.camera.projectionMatrix[14]=-(R[2]+M[2])/(R[2]-M[2]),n.mat4.multiply(p.lightMat,p.camera.projectionMatrix,p.camera.viewMatrix);var G=this.textureRes/2;p.camera.viewport[0]=l%2==0?0:G,p.camera.viewport[1]=0===Math.floor(l/2)?0:G,p.camera.viewport[2]=G,p.camera.viewport[3]=G}this.lastOrigin=null,this.cascadeDistances[this.numCascades]=100*a;var H=this.rctx;H.bindFramebuffer(this.fbo),H.bindTexture(null,7),H.setClearColor(1,1,1,1),H.clearSafe(16640)},e.prototype.finish=function(e){h.assert(this.enabled),this.rctx.bindFramebuffer(e),this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()},e.prototype.bind=function(e){var t=this.rctx,r=this.enabled;t.bindTexture(r?this.depthTexture:this.emptyTexture,7),t.bindProgram(e),e.setUniform1i("depthTex",7),e.setUniform1f("depthHalfPixelSz",r?.5/this.textureRes:-1),e.setUniform1i("shadowMapNum",this.numCascades),e.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])},e.prototype.bindAll=function(e){for(var t=e.getProgramsUsingUniform("shadowMapDistance"),r=0;r<t.length;r++)this.bind(t[r])},e.prototype.bindView=function(e,t){if(this.enabled){var r=this.lastOrigin;if(!r||r[0]!==t[0]||r[1]!==t[1]||r[2]!==t[2]){this.lastOrigin=this.lastOrigin||l.vec3f64.create(),s.vec3.copy(this.lastOrigin,t);for(var i=0;i<this.numCascades;++i){n.mat4.translate(z,this.cascades[i].lightMat,t);for(var a=0;a<16;++a)j[16*i+a]=z[a]}}e.setUniformMatrix4fv("shadowMapMatrix",j)}},e.prototype.enable=function(){if(!this.enabled){var e={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureRes,height:this.textureRes};this.depthTexture=new m(this.rctx,e),this.fbo=v.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}},e.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.fbo=null,this.depthTexture=null)},e.prototype.getGpuMemoryUsage=function(){return g.getGpuMemoryUsage(this.fbo)},e}(),C=i.mat4f64.create(),P=i.mat4f64.create(),E=i.mat4f64.create(),T=u.vec4f64.create(),O=[],A=0;A<8;++A)O.push(u.vec4f64.create());var R=l.vec3f64.create(),M=l.vec3f64.create(),I=o.vec2f64.create(),D=o.vec2f64.create(),V=o.vec2f64.create(),L=o.vec2f64.create(),F=o.vec2f64.create(),B=i.mat4f64.create(),N=l.vec3f64.create(),U=[],z=i.mat4f64.create(),j=new Float32Array(64),G=o.vec2f64.create(),H=o.vec2f64.create(),k=[o.vec2f64.create(),o.vec2f64.create(),o.vec2f64.create(),o.vec2f64.create()],W=o.vec2f64.create(),q=o.vec2f64.create(),X=o.vec2f64.create(),Y=o.vec2f64.create(),Q=o.vec2f64.create(),Z=o.vec2f64.create(),J=o.vec2f64.create(),K=o.vec2f64.create(),$=o.vec2f64.create(),ee=r.mat3f64.create();return w}.apply(null,n))||(e.exports=i)},eCSb:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("eIBl"),r("KBgh"),r("Vx27"),r("lRq4")],void 0===(i=function(e,t,r,n,i,a,o,s,l){var c=function(){function e(){this.extents=new o({allocator:function(e){return e||l.create()}}),this.tempExtent=l.create(),this.dirty=!1}return Object.defineProperty(e.prototype,"length",{get:function(){return this.extents.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.extents.clear()},e.prototype.add=function(e){this.contains(e)||(this.removeContained(e),l.set(this.extents.pushNew(),e),this.dirty=!0)},e.prototype.pop=function(){return this.dirty&&(this.mergeTight(),this.dirty=!1),this.extents.pop()},e.prototype.mergeTight=function(){for(var e=this.extents,t=this.tempExtent,r=!1;!r;){r=!0;for(var n=0;n<e.length;++n)if(function(r){for(var n=e.data[r],i=l.area(n),a=!1,o=e.length-1;o>r;--o){var s=e.data[o],c=l.area(s);l.expand(n,s,t);var u=i+c;(l.area(t)-u)/u<.05&&(l.set(n,t),i=l.area(n),e.swapElements(o,e.length-1),e.pop(),a=!0)}return a}(n)){r=!1;break}}},e.prototype.contains=function(e){return this.extents.some(function(t){return l.contains(t,e)})},e.prototype.removeContained=function(e){for(var t=this.extents.length-1;t>=0;--t)l.contains(e,this.extents.data[t])&&this.extents.removeUnorderedIndex(t)},e}();return function(e){function t(){var t=e.call(this)||this;return t.dirtyExtents=new c,t.globalDirty=!1,t.dirtyGraphicsQueue=new o({deallocator:null}),t.handles=new a,t.updateElevation=!1,t.layerView=null,t.graphicsCore=null,t}return r(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,r,n){var i=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=r,this.elevationProvider=n;var a=this.layerView.view.resourceController.scheduler;this.handles.add([n.on("elevation-change",function(e){return i.elevationUpdateHandler(e)}),this.layerView.watch("suspended",function(){return i.suspendedChange()}),a.registerTask(12,function(e){return i.update(e)},function(){return i.needsUpdate()})])},t.prototype.destroy=function(){this.dirtyGraphicsQueue=null,this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},t.prototype.clear=function(){this.dirtyGraphicsQueue.clear(),this.notifyChange("updating")},t.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))},t.prototype.elevationInfoChange=function(){this.globalDirty=!0,this.notifyChange("updating")},t.prototype.needsUpdate=function(){return this.dirtyGraphicsQueue.length>0||this.dirtyExtents.length>0||this.globalDirty},t.prototype.update=function(e){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress());this.needsUpdate()&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")},t.prototype._updateDirtyGraphics=function(e){for(var t=this.layerView.view,r=this.graphicsCore.stageLayer.id,n=this.layerView.labeling;this.dirtyGraphicsQueue.length>0&&!e.done;){for(var i=Math.min(this.dirtyGraphicsQueue.length,100);i--&&!e.done;){var a=this.dirtyGraphicsQueue.pop(),o=this.graphicsCore.getGraphics3DGraphicById(a);o&&o.alignWithElevation(this.elevationProvider,t.renderCoordsHelper),e.madeProgress()}t._stage.processDirtyLayer(r),n&&n.processStageDirty()}},t.prototype._updateDirtyExtents=function(e){for(var t=this;this.dirtyExtents.length>0&&this.dirtyGraphicsQueue.length<100&&!e.done;){var r=this.dirtyExtents.pop();this.queryGraphicUIDsInExtent(r,this.spatialReference,function(e){var r=t.graphicsCore.getGraphics3DGraphicById(e);r&&r.needsElevationUpdates()&&t.dirtyGraphicsQueue.push(e)}),e.madeProgress()}},t.prototype.markAllGraphicsElevationDirty=function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsQueue.clear(),this.graphicsCore.graphics3DGraphics.forEach(function(t,r){return e.dirtyGraphicsQueue.push(r)})},t.prototype.elevationUpdateHandler=function(e){var t=e.extent;if(this.layerView.suspended){if(!this.updateElevation){var r=this.graphicsCore.computedExtent;r&&t[2]>r.xmin&&t[0]<r.xmax&&t[3]>r.ymin&&t[1]<r.ymax&&(this.updateElevation=!0)}}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.spatialReference=e.spatialReference,this.notifyChange("updating")},n([s.property({readOnly:!0})],t.prototype,"updating",null),n([s.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t)}(s.declared(i))}.apply(null,n))||(e.exports=i)},eHCP:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Rdxj")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.fromVector=function(e,t){return{vec3:r.vec3f64.clone(e),id:t}},t.fromValues=function(e,t,n,i){return{vec3:r.vec3f64.fromValues(e,t,n),id:i}}}.apply(null,n))||(e.exports=i)},f3AO:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.copy=function(e,t,r){for(var n=e.typedBuffer,i=e.typedBufferStride,a=t.typedBuffer,o=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*i,c=(r&&r.srcIndex?r.srcIndex:0)*o,u=0;u<s;++u){for(var d=0;d<9;++d)n[l+d]=a[c+d];l+=i,c+=o}}}.apply(null,n))||(e.exports=i)},fHD9:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.dispose=function(){var e=this;(this.__proto__.__managedDisposables__||[]).forEach(function(t){e[t]&&(e[t].dispose(),e[t]=void 0)})},e}();t.ManagingDisposable=r,t.manageDisposal=function(){return function(e,t){e.__managedDisposables__=e.__managedDisposables__||[],e.__managedDisposables__.push(t)}}}.apply(null,n))||(e.exports=i)},fHyw:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=16;var a=this.TypedArrayConstructor;void 0===n&&(n=16*a.BYTES_PER_ELEMENT);var o=0===t.byteLength?0:r;this.typedBuffer=null==i?new a(t,o):new a(t,o,(i-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getMat=function(e,t){for(var r=e*this.typedBufferStride,n=0;n<16;n++)t[n]=this.typedBuffer[r+n];return t},e.prototype.setMat=function(e,t){for(var r=e*this.typedBufferStride,n=0;n<16;n++)this.typedBuffer[r+n]=t[n]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r},e.prototype.copyFrom=function(e,t,r){for(var n=this.typedBuffer,i=t.typedBuffer,a=e*this.typedBufferStride,o=r*t.typedBufferStride,s=0;s<16;++s)n[a+s]=i[o+s]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=16,e}();t.BufferViewMat4Impl=r}.apply(null,n))||(e.exports=i)},fOZq:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("sSIw"),r("yVFQ")],void 0===(i=function(e,t,r,n){return function(){function e(e){e?this.set(e):this.setDefaults()}return Object.defineProperty(e.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0}),e.prototype.setUnit=function(e){this._unit=e,this._metersPerElevationInfoUnit=r.getMetersPerUnit(e)},e.prototype.setDefaults=function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this.featureExpressionInfoContext=null,this.setUnit("meters")},e.prototype.set=function(e){this.mode=e.mode,this._meterUnitOffset=e._meterUnitOffset||0,this._renderUnitOffset=e._renderUnitOffset||0,this.featureExpressionInfoContext=e.featureExpressionInfoContext,this.setUnit(e.unit)},e.prototype.setOffsetMeters=function(e){this._meterUnitOffset=e,this._renderUnitOffset=0},e.prototype.setOffsetElevationInfoUnits=function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0},e.prototype.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e},e.prototype.mixinApi=function(e){null!=e.mode&&(this.mode=e.mode),null!=e.unit&&this.setUnit(e.unit),null!=e.offset&&this.setOffsetElevationInfoUnits(e.offset)},e.prototype.calculateOffsetRenderUnits=function(e){var t=this._meterUnitOffset,r=this.featureExpressionInfoContext;return null!=r&&(t+=n.execute(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset},e}()}.apply(null,n))||(e.exports=i)},fPnv:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("1m5D"),r("VfPl"),r("MzcX"),r("ff/U"),r("D8s1"),r("PwS/"),r("QFi0"),r("Kfys"),r("z2+Q")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u){function d(e,t){var r=new Map,n=function(e,t){var n=e.origin.id,i=e.data.id,a=r.get(n);a||(a={origin:e.origin.vec3,deltaByGeometry:new Map},r.set(n,a));var o=a.deltaByGeometry.get(i);o||(o={renderData:e.data,toAdd:[],toRemove:[]},a.deltaByGeometry.set(i,o)),(t?o.toAdd:o.toRemove).push(e)};return e.forEach(function(e){n(e,!0)}),t.forEach(function(e){n(e,!1)}),r}function f(e,t,r){var n=t.elementCount(e),i=t.allocate(n);t.write({},e,null,i,0),r.setData(i.buffer)}var p=function(){function e(e,t,r,n,s){void 0===s&&(s=0),this.data=new o(r,s),this.instanceBuffer=l.createVertex(e,35044),this.vao=new u(e,a.Default3D,{geometry:i.glLayout(t),instance:i.glLayout(r,{divisor:1})},{geometry:n,instance:this.instanceBuffer})}return e.prototype.dispose=function(){this.vao.dispose(!1),this.instanceBuffer.dispose()},Object.defineProperty(e.prototype,"count",{get:function(){return this.data.getCount()},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this.data.hasSlot(e.idx)},e.prototype.prepareAdd=function(e){this.data.prepareAllocate(e)},e.prototype.add=function(e){var t=this.data.allocate(e.idx);this.writeInstance(e,t)},e.prototype.prepareRemove=function(e){this.data.prepareFree(e)},e.prototype.remove=function(e){this.data.free(e.idx)},e.prototype.updateTransform=function(e,t){void 0===t&&(t=!0);var r=this.data.getSlot(e.idx);null!=r&&(this.writeTransform(e,r),t&&this.uploadSlot(r))},e.prototype.uploadAll=function(){this.data.compact(),this.instanceBuffer.setData(this.data.getBuffer().buffer)},e.prototype.uploadSlot=function(e){var t=this.data,r=t.layout.stride,n=e*r;this.instanceBuffer.setSubData(t.getBuffer().buffer,n,n,n+r)},e.prototype.instanceBufferView=function(){var e=this.data.getBuffer();return this._buffer!==e&&(this._bufferView={transformation:e.getField("model",n.BufferViewMat4f),transformationNormal:e.getField("modelNormal",n.BufferViewMat4f),instanceColor:e.getField("instanceColor",n.BufferViewVec4f),instanceFeatureAttribute:e.getField("instanceFeatureAttribute",n.BufferViewVec4f)}),this._bufferView},e.prototype.writeTransform=function(e,t){var r=this.instanceBufferView();s.calculateTransformRelToOrigin(e,v,m),r.transformation.setMat(t,v),r.transformationNormal.setMat(t,m)},e.prototype.writeInstance=function(e,t){var r=this.instanceBufferView();s.calculateTransformRelToOrigin(e,v,m),r.transformation.setMat(t,v),r.transformationNormal.setMat(t,m),r.instanceColor&&r.instanceColor.setVec(t,e.instanceParameters.color),r.instanceFeatureAttribute&&r.instanceFeatureAttribute.setVec(t,e.instanceParameters.featureAttribute)},e}(),h=function(){function e(e,t,r){this._dataByOrigin=new Map,this._highlightCount=0,this._instanceDataToUploadCache=new Set,this._rctx=e,this._material=r,this._materialRep=t,this._glMaterials=s.acquireMaterials(this._material,this._materialRep),this._bufferWriter=r.createBufferWriter()}return e.prototype.dispose=function(){s.releaseMaterials(this._material,this._materialRep)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlightCount>0},enumerable:!0,configurable:!0}),e.prototype.renderPriority=function(){return this._material.renderPriority},e.prototype.modify=function(e){this.updateGeometries(e.toUpdate),this.addAndRemoveGeometries(e.toAdd,e.toRemove),this.updateHighlightCount()},e.prototype.addAndRemoveGeometries=function(e,t){var r=this._rctx,n=this._bufferWriter,i=this._dataByOrigin,a=d(e,t),o=n.vertexBufferLayout,c=n.instanceBufferLayout;a.forEach(function(e,t){var a=i.get(t);a||(a={origin:e.origin,highlightCount:0,dataByGeometry:new Map},i.set(t,a)),e.deltaByGeometry.forEach(function(e,t){var i=a.dataByGeometry.get(t);if(!i&&e.toAdd.length>0){var u=l.createVertex(r,35044);f(e.renderData,n,u),i={count:0,vertexBuffer:u,instanceData:new p(r,o,c,u,e.toAdd.length),highlightInstanceData:new p(r,o,c,u)},a.dataByGeometry.set(t,i)}var d=i.instanceData,h=i.highlightInstanceData;d.prepareAdd(e.toAdd.length),e.toAdd.forEach(function(e){s.isRenderGeometryHidden(e)||(d.add(e),s.doesRenderGeometryHaveHighlights(e)&&(h.add(e),a.highlightCount=null))}),d.prepareRemove(e.toRemove.length),e.toRemove.forEach(function(e){d.remove(e),h.remove(e)}),e.toAdd.length+e.toRemove.length&&(d.uploadAll(),h.uploadAll()),i.count+=e.toAdd.length,i.count-=e.toRemove.length,0===i.count&&(i.instanceData.dispose(),i.highlightInstanceData.dispose(),i.vertexBuffer.dispose(),a.dataByGeometry.delete(t))}),0===a.dataByGeometry.size&&i.delete(t)})},e.prototype.updateGeometries=function(e){var t=this._dataByOrigin,r=this._bufferWriter;this._instanceDataToUploadCache.clear();var n=this._instanceDataToUploadCache;e.forEach(function(e){var i=e.updateType,a=e.renderGeometry,o=t.get(a.origin.id),l=o&&o.dataByGeometry.get(a.data.id);if(l){var c=l.instanceData,u=l.highlightInstanceData,d=1&i;d&&(s.isRenderGeometryHidden(a)?(c.remove(a),n.add(c),u.has(a)&&(u.remove(a),n.add(u))):c.has(a)||(c.add(a),n.add(c),s.doesRenderGeometryHaveHighlights(a)&&!u.has(a)&&(u.add(a),n.add(u))));var p=16&i;p&&(s.doesRenderGeometryHaveHighlights(a)?u.has(a)||(u.add(a),n.add(u)):(u.remove(a),n.add(u)),o.highlightCount=null),2&i&&f(a.data,r,l.vertexBuffer),4&i&&(l.instanceData.updateTransform(a,!d),l.highlightInstanceData.updateTransform(a,!p))}}),n.forEach(function(e){e.uploadAll()})},e.prototype.updateHighlightCount=function(){var e=this;this._highlightCount=0,this._dataByOrigin.forEach(function(t){if(null==t.highlightCount){var r=0;t.dataByGeometry.forEach(function(e){r+=e.highlightInstanceData.count}),t.highlightCount=r}e._highlightCount+=t.highlightCount})},e.prototype.render=function(e,t,r,n){var i=this._rctx,a=i.capabilities.instancing,o=this._glMaterials.get(t.pass),s=4===t.pass;if(!o||null!=e&&!o.beginSlot(e)||s&&0===this._highlightCount)return!1;var l=o.getProgram(),u=o.getDrawMode();o.bind(i,r);var d=!1;return this._dataByOrigin.forEach(function(e){s&&0===e.highlightCount||(r.origin=e.origin,o.bindView(i,r),e.dataByGeometry.forEach(function(e){var t=s?e.highlightInstanceData:e.instanceData,r=t.count;if(!s||0!==r){var o=t.vao;c.assertCompatibleVertexAttributeLocations(o,l),i.bindVAO(o);var f=c.vertexCount(o,"geometry");a.drawArraysInstanced(u,0,f,r),n&&(n.drawCallsInstanced++,4===u&&(n.triangles+=r*(f/3))),d=!0}}))}),i.bindVAO(null),o.release(i,r),d},e}(),v=r.mat4f64.create(),m=r.mat4f64.create();return h}.apply(null,n))||(e.exports=i)},fV0t:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("TUJR")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.transformMat4=function(e,t,n){if(e.count===t.count)for(var i=e.count,a=n[0],o=n[1],s=n[2],l=n[4],c=n[5],u=n[6],d=n[8],f=n[9],p=n[10],h=n[12],v=n[13],m=n[14],g=e.typedBuffer,y=e.typedBufferStride,b=t.typedBuffer,x=t.typedBufferStride,_=0;_<i;_++){var S=_*y,w=_*x,C=b[w],P=b[w+1],E=b[w+2];g[S]=a*C+l*P+d*E+h,g[S+1]=o*C+c*P+f*E+v,g[S+2]=s*C+u*P+p*E+m}else r.logger.error("source and destination buffers need to have the same number of elements")},t.transformMat3=function(e,t,n){if(e.count===t.count)for(var i=e.count,a=n[0],o=n[1],s=n[2],l=n[3],c=n[4],u=n[5],d=n[6],f=n[7],p=n[8],h=e.typedBuffer,v=e.typedBufferStride,m=t.typedBuffer,g=t.typedBufferStride,y=0;y<i;y++){var b=y*v,x=y*g,_=m[x],S=m[x+1],w=m[x+2];h[b]=a*_+l*S+d*w,h[b+1]=o*_+c*S+f*w,h[b+2]=s*_+u*S+p*w}else r.logger.error("source and destination buffers need to have the same number of elements")},t.scale=function(e,t,r){for(var n=Math.min(e.count,t.count),i=e.typedBuffer,a=e.typedBufferStride,o=t.typedBuffer,s=t.typedBufferStride,l=0;l<n;l++){var c=l*a,u=l*s;i[c]=r*o[u],i[c+1]=r*o[u+1],i[c+2]=r*o[u+2]}}}.apply(null,n))||(e.exports=i)},fXZm:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("PHan"),r("0LE5"),r("JjCO"),r("4p4v")],void 0===(i=function(e,t,r,n,i,a){function o(e){return e?{ray:a.create(e.ray),c0:e.c0,c1:e.c1}:{ray:a.create(),c0:0,c1:Number.MAX_VALUE}}function s(e,t,r,n){return void 0===n&&(n=o()),a.copy(e,n.ray),n.c0=t,n.c1=r,n}function l(e,t,r){void 0===r&&(r=o());var i=n.vec3.length(e.vector);return a.fromValues(e.origin,t,r.ray),r.c0=0,r.c1=i,r}Object.defineProperty(t,"__esModule",{value:!0}),t.create=o,t.wrap=function(e,t,r){var n=c.get();return n.ray=e,n.c0=t,n.c1=r,n},t.copy=function(e,t){return void 0===t&&(t=o()),s(e.ray,e.c0,e.c1,t)},t.fromValues=s,t.fromRay=function(e,t){return void 0===t&&(t=o()),a.copy(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t},t.fromLineSegment=function(e,t){return void 0===t&&(t=o()),l(e,n.vec3.normalize(i.sv3d.get(),e.vector),t)},t.fromLineSegmentAndDirection=l;var c=new r.ObjectStack(function(){return{c0:0,c1:0,ray:null}})}.apply(null,n))||(e.exports=i)},fXwo:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("QDcU"),r("QDcU"),r("pcDC"),r("LxLY"),r("YX1r"),r("51bw"),r("FXVB"),r("1m5D"),r("0LE5"),r("Rdxj"),r("WRgd"),r("TsU/"),r("vtMp"),r("s3uR"),r("VW5z"),r("s4LJ"),r("zF3d"),r("JzVu"),r("763n"),r("55f2"),r("Dk48"),r("mmEe"),r("krVM"),r("ys4y"),r("AgDx"),r("ZJC8"),r("yqrJ"),r("CIy2"),r("TP2F"),r("+v1/")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w,C,P,E,T,O,A,R,M,I){Object.defineProperty(t,"__esModule",{value:!0});var D=R.VertexAttrConstants,V=function(e){function t(t,r,n,i){var a=e.call(this,t,r,n,i)||this;return a._edgeStageObjects=new Set,a._materials={},a._textures={},w.DRAW_MESH_GEOMETRY_NORMALS&&(a._debugVertexNormalMaterial=new I({color:[1,0,1,1]},"debugVertexNormal"),a._debugFaceNormalMaterial=new I({color:[0,1,1,1]},"debugFAceNormal")),a.resolve(),a}return r(t,e),t.prototype.destroy=function(){for(var t in e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._materials){var r=this._materials[t];this._context.stage.remove(P.ModelContentType.MATERIAL,r.material.id)}for(var t in this._textures){var n=this._textures[t];this._context.stage.remove(P.ModelContentType.TEXTURE,n.id)}this._materials={},this._textures={}},t.prototype.createGraphics3DGraphic=function(e){var t=e.graphic;if("mesh"!==t.geometry.type)return this._logWarning("unsupported geometry type for fill on mesh-3d symbol: "+t.geometry.type),null;if(!this._validateGeometry(t.geometry))return null;var r="graphic"+t.uid,n=this.getGraphicElevationContext(t),i=e.renderingInfo;return this._createAs3DShape(t,i,n,r,t.uid)},t.prototype.layerOpacityChanged=function(){var e=this._getLayerOpacity();for(var t in this._materials){var r=this._materials[t];r.material.setParameterValues({layerOpacity:e});var n=r.material.getParameters();this._setMaterialTransparentParameter(n,r),r.material.setParameterValues({transparent:n.transparent})}if(this._edgeStageObjects.size>0){var i=this._context.stage.view.ensureEdgeView(),a=this._getLayerOpacity();this._edgeStageObjects.forEach(function(e){return i.updateAllComponentOpacities(e,[a])})}return!0},t.prototype.layerElevationInfoChanged=function(e,t){return this.updateGraphics3DGraphicElevationInfo(e,t,b.needsElevationUpdates3D)},t.prototype.slicePlaneEnabledChanged=function(e,t){var r=this;for(var n in this._materials)this._materials[n].material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});if(this._edgeStageObjects.size>0){var i=this._context.stage.view.ensureEdgeView(),a=this._createEdgeMaterial(i);if(o.isSome(a)){var s=[a];this._edgeStageObjects.forEach(function(e){return i.updateAllComponentMaterials(e,s,{slicePlaneEnabled:r._context.slicePlaneEnabled},!1)})}}return!0},t.prototype.pixelRatioChanged=function(e,t){return!0},t.prototype._requiresSymbolVertexColors=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")},t.prototype._colorOrTextureUid=function(e){return e?e instanceof i?e.toHex():e.uid:"-"},t.prototype._materialProperties=function(e,t,r){var n,i,a,o,s,l,c=this._requiresSymbolVertexColors();t.material&&(i=t.material.color,n=this._colorOrTextureUid(t.material.color),a=t.material.colorTexture,o=this._colorOrTextureUid(t.material.colorTexture),s=t.material.normalTexture,l=this._colorOrTextureUid(t.material.normalTexture));var u=!!e.vertexAttributes.color,d=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:c,hasVertexColors:u,hasVertexTangents:d,color:i,colorTexture:a,normalTexture:s,uid:"vc:"+u+",vt:"+d+",vct"+r+",svc:"+c+",cmuid:"+n+",ctmuid:"+o+",ntmuid:"+l}},t.prototype._setInternalColorValueParameters=function(e,t){t.diffuse=n.toUnitRGB(e),t.opacity=e.a},t.prototype._getLoadableTextureResource=function(e){return e.data?e.data instanceof HTMLImageElement?e.data.complete?e.data:e.data.src:e.data:e.url},t.prototype._getInternalTextureId=function(e,t){var r=this._getLoadableTextureResource(e);if(r){var n=this._textures[e.uid];return n||(n=new A(r,t+"_"+e.uid+"_tex",{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0}),this._textures[e.uid]=n,this._context.stage.add(P.ModelContentType.TEXTURE,n)),n.id}},t.prototype._castTextureWrap=function(e){if(void 0===e&&(e="repeat"),"string"==typeof e){var t=this._castTextureWrapIndividual(e);return{s:t,t:t}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}},t.prototype._castTextureWrapIndividual=function(e){switch(e){case"clamp":return 33071;case"mirror":return 33648;case"repeat":default:return 10497}},t.prototype._setInternalMaterialParameters=function(e,t,r){e.color&&this._setInternalColorValueParameters(e.color,r),e.colorTexture&&(r.textureId=this._getInternalTextureId(e.colorTexture,t)),e.hasVertexTangents&&e.normalTexture&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture,t))},t.prototype._setExternalMaterialParameters=function(e){if(this._isPropertyDriven("color"))e.externalColor=F;else{var t=this.symbolLayer.material?n.toUnitRGBA(this.symbolLayer.material.color):F;e.externalColor=t}var r=this.symbolLayer.material&&this.symbolLayer.material.colorMixMode;r&&(e.colorMixMode=r)},t.prototype._hasTransparentVertexColors=function(e){var t=e.vertexAttributes.color;if(!t)return!1;for(var r=3;r<t.length;r+=4)if(255!==t[r])return!0;return!1},t.prototype._getOrCreateMaterial=function(e,t){var r=t.material&&t.material.color,n=t.material&&t.material.colorTexture,i=this._hasTransparentVertexColors(e)||r&&r.a<1||n&&n.transparent,a=this._materialProperties(e,t,i),o=this._materials[a.uid];if(o)return o.material;var s={material:null,isComponentTransparent:i,alphaMode:t.material?t.material.alphaMode:"opaque"},l=this._getStageIdHint(),c={specular:B,vertexColors:a.hasVertexColors,symbolColors:a.hasSymbolVertexColors,vertexTangents:a.hasVertexTangents,ambient:B,diffuse:L,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,textureInitTransparent:!0};t.material&&(c.doubleSided=t.material.doubleSided,c.cullFace=t.material.doubleSided?"none":"back",c.textureAlphaCutoff=t.material.alphaCutoff),this._setInternalMaterialParameters(a,l,c),this._setExternalMaterialParameters(c),this._setMaterialTransparentParameter(c,s);var u=new M(c,l+"_"+a.uid+"_mat");return s.material=u,this._materials[a.uid]=s,this._context.stage.add(P.ModelContentType.MATERIAL,u),u},t.prototype._setMaterialTransparentParameter=function(e,t){var r=this._isPropertyDriven("opacity");e.transparent=r||t.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,"auto"===t.alphaMode?e.textureAlphaMode=e.transparent?"maskBlend":"opaque":e.textureAlphaMode=t.alphaMode},t.prototype._addDebugNormals=function(e,t,r,n){for(var i,a,o,s,l=t.length,c=e.spatialReference.isWGS84?20015077/180:1,f=.1*Math.max(e.extent.width*c,e.extent.height*c,e.extent.zmax-e.extent.zmin),p=[],h=[],v=[],m=[],g=0;g<l;g++)for(var y=t[g],b=y.data.getAttribute(D.POSITION),x=y.data.getAttribute(D.NORMAL),_=y.data.getIndices(D.POSITION),S=y.data.getIndices(D.NORMAL),w=b.data,C=x.data,P=0;P<_.length;P++){for(var O=3*_[P],A=3*S[P],R=0;R<3;R++)p.push(w[O+R]);for(R=0;R<3;R++)p.push(w[O+R]+C[A+R]*f);if(h.push(h.length),h.push(h.length),P%3==0){this._calculateFaceNormal(w,_,P,G),this._getFaceVertices(w,_,P,U,z,j),d.vec3.add(U,U,z),d.vec3.add(U,U,j),d.vec3.scale(U,U,1/3);for(R=0;R<3;R++)v.push(U[R]);for(R=0;R<3;R++)v.push(U[R]+G[R]*f);m.push(m.length),m.push(m.length)}}var M=((i={})[D.POSITION]={data:new Float64Array(p),size:3},i),I=((a={})[D.POSITION]=new Uint32Array(h),a),V=new T(M,I,void 0,"line");(L=new E(V,"debugVertexNormal")).singleUse=!0,t.push(L),r.push(this._debugVertexNormalMaterial),n.push(u.mat4f64.clone(n[0]));var L;(o={})[D.POSITION]={data:new Float64Array(v),size:3},M=o,(s={})[D.POSITION]=new Uint32Array(m),I=s,V=new T(M,I,void 0,"line");(L=new E(V,"debugFaceNormal")).singleUse=!0,t.push(L),r.push(this._debugFaceNormalMaterial),n.push(u.mat4f64.clone(n[0]))},t.prototype._createAs3DShape=function(e,t,r,n,i){var a=this,s=e.geometry;if("mesh"!==s.type)return null;var l=this._createGeometryInfo(s,t,n);if(!l)return null;var c=l.geometries,u=l.materials,d=l.transformations,f=l.objectTransformation;w.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,c,u,d);var p=new O({geometries:c,materials:u,transformations:d,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:i},idHint:n});p.objectTransformation=f;var h=function(e){var t=a._context.stage.view.ensureEdgeView();t.removeObject(e),a._edgeStageObjects.delete(e);var r=a._createEdgeMaterial(t);o.isSome(r)&&(a._edgeStageObjects.add(e),t.addObject(e,[r],{slicePlaneEnabled:a._context.slicePlaneEnabled},!a._context.isAsync,{mergeGeometries:!0}))};h(p);var v=function(e,t,r,n,i){var a=g.perObjectElevationAligner(e,t,r,n,i);return h(p),a},m=new y(this,p,c,null,null,v,r);m.needsElevationUpdates=b.needsElevationUpdates3D(r.mode);var x=s.extent.center.clone();return x.z=0,m.elevationContext.centerPointInElevationSR=x,m.alignedTerrainElevation=v(m,m.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext),m},t.prototype._createComponentNormals=function(e,t,r,n){var i=r.shading||"flat";switch(i){case"source":return this._createComponentNormalsSource(e,t,r,n);case"flat":return this._createComponentNormalsFlat(e,r,n);case"smooth":return this._createComponentNormalsSmooth(e,r,n);default:a.neverReached(i)}},t.prototype._createComponentNormalsSource=function(e,t,r,n){if(!t)return this._createComponentNormalsFlat(e,r,n);var i=!1;if(!r.trustSourceNormals)for(var a=0;a<n.length;a+=3){this._calculateFaceNormal(e,n,a,G);for(var o=0;o<3;o++){var s=3*n[a+o];U[0]=t[s+0],U[1]=t[s+1],U[2]=t[s+2],d.vec3.dot(G,U)<0&&(t[s+0]=-t[s+0],t[s+1]=-t[s+1],t[s+2]=-t[s+2],i=!0)}}return{normals:t,indices:n,didFlipNormals:i}},t.prototype._createComponentNormalsFlat=function(e,t,r){for(var n=new Float32Array(r.length),i=new Uint32Array(3*r.length),a=0;a<r.length;a+=3)for(var o=this._calculateFaceNormal(e,r,a,G),s=0;s<3;s++)n[a+s]=o[s],i[a+s]=a/3;return{normals:n,indices:i,didFlipNormals:!1}},t.prototype._createComponentNormalsSmooth=function(e,t,r){for(var n={},i=0;i<r.length;i+=3)for(var a=this._calculateFaceNormal(e,r,i,G),o=0;o<3;o++){(u=n[c=r[i+o]])||(u={normal:f.vec3f64.create(),count:0},n[c]=u),d.vec3.add(u.normal,u.normal,a),u.count++}var s=new Float32Array(3*r.length),l=new Uint32Array(3*r.length);for(i=0;i<r.length;i++){var c,u;1!==(u=n[c=r[i]]).count&&(d.vec3.normalize(u.normal,u.normal),u.count=1);for(o=0;o<3;o++)s[3*i+o]=u.normal[o];l[i]=i}return{normals:s,indices:l,didFlipNormals:!1}},t.prototype._getFaceVertices=function(e,t,r,n,i,a){var o=3*t[r+0],s=3*t[r+1],l=3*t[r+2];n[0]=e[o+0],n[1]=e[o+1],n[2]=e[o+2],i[0]=e[s+0],i[1]=e[s+1],i[2]=e[s+2],a[0]=e[l+0],a[1]=e[l+1],a[2]=e[l+2]},t.prototype._calculateFaceNormal=function(e,t,r,n){return this._getFaceVertices(e,t,r,U,z,j),d.vec3.subtract(z,z,U),d.vec3.subtract(j,j,U),d.vec3.cross(U,z,j),d.vec3.normalize(n,U),n},t.prototype._getOrCreateComponents=function(e){return e.components?e.components:q},t.prototype._createPositionBuffer=function(e){var t=e.vertexAttributes.position,r=new Float64Array(t.length),n=this._context.renderSpatialReference;return b.reproject(e.vertexAttributes.position,0,e.spatialReference,r,0,n,t.length/3),r},t.prototype._createNormalBuffer=function(e,t){var r=e.vertexAttributes.normal;if(!r)return null;if("local"===this._context.layerView.view.viewingMode)return r;var n=e.vertexAttributes.position,i=new Float32Array(r.length);return m.projectNormalToECEF(r,n,t,e.spatialReference,i)},t.prototype._createTangentBuffer=function(e,t){var r=e.vertexAttributes.tangent;if(!r)return null;if("local"===this._context.layerView.view.viewingMode)return r;var n=e.vertexAttributes.position,i=new Float32Array(r.length);return m.projectTangentToECEF(r,n,t,e.spatialReference,i)},t.prototype._createColorBuffer=function(e){return e.vertexAttributes.color},t.prototype._createSymbolColorBuffer=function(e){if(this._requiresSymbolVertexColors()){var t=this._getVertexOpacityAndColor(e),r=this.symbolLayer.material&&this.symbolLayer.material.colorMixMode||null,n=new Uint8Array(4);return S.encodeSymbolColor(t,r,n),n}return null},t.prototype._createColorIndices=function(e,t){for(var r=new Uint32Array(t.length),n=0;n<r.length;n++)r[n]=0;return r},t.prototype._createBuffers=function(e,t){var r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this._logWarning("Mesh geometry must contain position vertex attributes"),null;var n=e.vertexAttributes.normal,i=e.vertexAttributes.uv,a=e.vertexAttributes.tangent;if(n&&n.length!==r.length)return this._logWarning("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(a&&a.length/4!=r.length/3)return this._logWarning("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(i&&i.length/2!=r.length/3)return this._logWarning("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;var o=this._createPositionBuffer(e),s=this._createColorBuffer(e),l=this._createSymbolColorBuffer(t),c=this._createNormalBuffer(e,o);return{positionBuffer:o,normalBuffer:c,tangentBuffer:this._createTangentBuffer(e,o),uvBuffer:i,colorBuffer:s,symbolColorBuffer:l,objectTransformation:this._transformCenterLocal(e,o,c)}},t.prototype._transformCenterLocal=function(e,t,r){var n=e.extent.center,i=this._context.renderSpatialReference;N[0]=n.x,N[1]=n.y,N[2]=0;var a=u.mat4f64.create();C.computeLinearTransformation(e.spatialReference,N,a,i),c.mat4.invert(H,a);for(var o=0;o<t.length;o+=3)U[0]=t[o+0],U[1]=t[o+1],U[2]=t[o+2],d.vec3.transformMat4(U,U,H),t[o+0]=U[0],t[o+1]=U[1],t[o+2]=U[2];if(r){s.mat3.fromMat4(k,a),s.mat3.transpose(k,k);for(o=0;o<r.length;o+=3)U[0]=r[o+0],U[1]=r[o+1],U[2]=r[o+2],d.vec3.transformMat3(U,U,k),r[o+0]=U[0],r[o+1]=U[1],r[o+2]=U[2]}return a},t.prototype._validateFaces=function(e,t){var r=e.vertexAttributes.position.length/3,n=t.faces;if(n){for(var i=-1,a=0;a<n.length;a++){var o=n[a];o>i&&(i=o)}if(r<=i)return this._logWarning("Vertex index "+i+" is out of bounds of the mesh position buffer"),!1}else if(r%3!=0)return this._logWarning("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0},t.prototype._getOrCreateFaces=function(e,t){if(t.faces)return t.faces;for(var r=new Uint32Array(e.vertexAttributes.position.length/3),n=0;n<r.length;n++)r[n]=n;return r},t.prototype._isOutsideClippingArea=function(e){if(!this._context.clippingExtent)return!1;var t=e.vertexAttributes&&e.vertexAttributes.position;if(!t)return!1;var r,n=this._context.elevationProvider.spatialReference,i=t.length/3;return e.spatialReference.equals(n)?r=t:(r=new Float64Array(t.length),b.reproject(e.vertexAttributes.position,0,e.spatialReference,r,0,n,i)),b.computeBoundingBox(r,0,i,W),b.boundingBoxClipped(W,this._context.clippingExtent)},t.prototype._createGeometryInfo=function(e,t,r){var n,i;if(!v.canProject(e,this._context.layerView.view.spatialReference))return this._logWarning("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;var a=this._createBuffers(e,t);if(!a)return null;for(var o=a.positionBuffer,s=a.uvBuffer,l=a.colorBuffer,c=a.symbolColorBuffer,d=a.normalBuffer,f=a.tangentBuffer,p=a.objectTransformation,h=[],m=[],g=[],y=!1,b=0,x=this._getOrCreateComponents(e);b<x.length;b++){var _=x[b];if(!this._validateFaces(e,_))return null;var S=this._getOrCreateFaces(e,_);if(0!==S.length){var w=this._createComponentNormals(o,d,_,S);w.didFlipNormals&&(y=!0);var C=((n={})[D.POSITION]={size:3,data:o},n[D.NORMAL]={size:3,data:w.normals},n),P=((i={})[D.POSITION]=S,i[D.NORMAL]=w.indices,i);l&&(C[D.COLOR]={size:4,data:l},P[D.COLOR]=S),c&&(C[D.SYMBOLCOLOR]={size:4,data:c},P[D.SYMBOLCOLOR]=this._createColorIndices(_,S)),e.vertexAttributes.uv&&(C[D.UV0]={size:2,data:s},P[D.UV0]=S),e.vertexAttributes.tangent&&(C[D.TANGENT]={size:4,data:f},P[D.TANGENT]=S);var O=new T(C,P),A=new E(O,r+"_mesh");A.singleUse=!0,h.push(A),m.push(u.mat4f64.create()),g.push(this._getOrCreateMaterial(e,_))}}return y&&this._logWarning("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:h,transformations:m,materials:g,objectTransformation:p}},t.prototype._createEdgeMaterial=function(e){var t={opacity:this._getLayerOpacity()};return _.createMaterial(e,this.symbolLayer,t)},t}(x.default);t.Graphics3DMeshFillSymbolLayer=V;var L=[1,1,1],F=[1,1,1,1],B=[0,0,0],N=f.vec3f64.create(),U=f.vec3f64.create(),z=f.vec3f64.create(),j=f.vec3f64.create(),G=f.vec3f64.create(),H=u.mat4f64.create(),k=l.mat3f64.create(),W=p.create(),q=[new h];t.default=V}.apply(null,n))||(e.exports=i)},fZgo:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+"),r("ybft"),r("yqrJ"),r("Zp3t"),r("7laH")],void 0===(i=function(e,t,r,n,i,a,o){var s={canvas:null};return function(){function e(e,t,r,i){this._idHint=i,this._requiresPowerOfTwo=!o.default(e.gl),this._renderer=new n.default(t,r)}return Object.defineProperty(e.prototype,"id",{get:function(){return null==this._id&&(this._id=i.idGen.gen(this._idHint)),this._id},enumerable:!0,configurable:!0}),e.prototype.deferredLoading=function(){return!1},e.prototype.getWidth=function(){return this._renderer.renderedWidth},e.prototype.getHeight=function(){return this._renderer.renderedHeight},Object.defineProperty(e.prototype,"textureWidth",{get:function(){var e=this.getWidth();return this._requiresPowerOfTwo?r.nextHighestPowerOfTwo(e):e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHeight",{get:function(){var e=this.getHeight();return this._requiresPowerOfTwo?r.nextHighestPowerOfTwo(e):e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayWidth",{get:function(){return this._renderer.displayWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayHeight",{get:function(){return this._renderer.displayHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texcoordScale",{get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]},enumerable:!0,configurable:!0}),e.prototype.initializeThroughRender=function(e,t){var r=n.getTextHelperCanvas(s,this.textureWidth,this.textureHeight),i=r.getContext("2d");i.save(),t.samplingMode=9987,t.wrapMode=33071,t.flipped=!0,t.preMultiplyAlpha=!0,t.hasMipmap=!0,this._renderer.render(i,0,this.textureHeight-this._renderer.renderedHeight);var o=new a(e,t,r);return i.restore(),o},e.prototype.setUnloadFunc=function(e){this._unloadFunc=e},e.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)},e}()}.apply(null,n))||(e.exports=i)},"ff/U":function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,aTangent:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}}.apply(null,n))||(e.exports=i)},flZ8:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zbgD"),r("U+8K")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return i.glslifyDefineMap({TEXTURING:"none"!==e.textureMode,TEXTURE_ATLAS:"AtlasTextured"===e.textureMode,SYMBOLVERTEXCOLORS:e.symbolColors,FLIPV:e.flipV,DOUBLESIDED:e.doubleSided,WINDINGORDERDOUBLESIDED:e.windowOrderDoubleSided,RECEIVE_SHADOWS:e.receiveShadows,RECEIVE_SSAO:e.receiveSSAO,VV_SIZE:e.vvSize,VV_COLOR:e.vvColor,VV_OPACITY:e.vvOpacity,SCREEN_SIZE_PERSPECTIVE:e.screenSizePerspective,SLICE:e.slice,COMPRESSED_NORMALS:e.compressedNormals,COMPONENTCOLORS:e.componentColor,TRANSPARENCY_DISCARD:e.transparencyDiscard,BIAS_SHADOWMAP:e.shadowMap,WIREFRAME:e.wireframe})};t.colorPass={name:"path-color",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/pathMaterial/colorPass.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/pathMaterial/colorPass.frag")}},attributes:r.Default3D},t.depthPass={name:"path-depth",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/pathMaterial/depthPass.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/pathMaterial/depthPass.frag")}},attributes:r.Default3D},t.normalPass={name:"path-normal",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/pathMaterial/normalPass.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/pathMaterial/normalPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"path-highlight",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/pathMaterial/highlightPass.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/pathMaterial/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},foHJ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qsST"),r("c7Gp"),r("ByvF"),r("txdo"),r("fXwo"),r("Ozid"),r("PNay"),r("1+3M"),r("WRNQ")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u){Object.defineProperty(t,"__esModule",{value:!0});var d=r.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");t.make=function(e,t,r,n){var i=p[e.type]&&p[e.type][t.type]||f[t.type];return i?new i(e,t,r,n):(d.error("GraphicsLayerFactory#make","unknown symbol type "+t.type),null)};var f={icon:i.default,object:s.default,line:a.default,path:l.default,fill:c.default,extrude:n.default,text:u.default};t.setSymbolClass=function(e,t){f[e]=t};var p={"mesh-3d":{fill:o.default}}}.apply(null,n))||(e.exports=i)},"gT/q":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("MYn5")],void 0===(i=function(e,t,r){function n(e,t,n,a,o){if(!e)return!1;for(var s=r.getStride(t,n),l=e.coords,c=!1,u=0,d=0,f=e.lengths;d<f.length;d++){var p=f[d];c=i(c,l,s,u,p,a,o),u+=p*s}return c}function i(e,t,r,n,i,a,o){for(var s=e,l=n,c=n,u=n+i*r;c<u;c+=r){(l=c+r)===u&&(l=n);var d=t[c],f=t[c+1],p=t[l],h=t[l+1];(f<o&&h>=o||h<o&&f>=o)&&d+(o-f)/(h-f)*(p-d)<a&&(s=!s)}return s}Object.defineProperty(t,"__esModule",{value:!0}),t.polygonContainsPoint=function(e,t,r,i){return n(e,t,r,i.coords[0],i.coords[1])},t.polygonContainsMultipoint=function(e,t,i,a,o,s){var l=r.getStride(o,s),c=a.coords,u=a.lengths;if(!u)return!1;for(var d=0,f=0;d<u.length;d++,f+=l)if(!n(e,t,i,c[f],c[f+1]))return!1;return!0},t.polygonContainsCoords=n}.apply(null,n))||(e.exports=i)},gldz:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("VfPl"),r("qVs7"),r("Kfys")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=i.assert,o=function(e){this.modelOriginHi=e.getField("modelOriginHi",r.BufferViewVec3f),this.modelOriginLo=e.getField("modelOriginLo",r.BufferViewVec3f),this.model=e.getField("model",r.BufferViewMat3f),this.modelNormal=e.getField("modelNormal",r.BufferViewMat3f),this.color=e.getField("instanceColor",r.BufferViewVec4f),this.featureAttribute=e.getField("instanceFeatureAttribute",r.BufferViewVec4f)};t.View=o;var s=function(){function e(e,t){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=t,this._elementSize=t.stride,this._capacity=1}return e.prototype.destroy=function(){this._buffer&&this._buffer.destroy()},Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){var e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null},e.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0},e.prototype.beginUpdate=function(){a(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex},e.prototype.endUpdate=function(){a(this._updating,"not updating"),this.size<u*this.capacity&&this.shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1},e.prototype.allocateHead=function(){a(this._updating,"not updating"),this.isFull&&this.grow();var e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this.incrementHead(),a(this._headIndex!==this._tailIndex,"invalid pointers"),e},e.prototype.freeTail=function(){a(this._updating,"not updating"),a(this.size>0,"invalid size");var e=this._tailIndex===this._firstIndex;this.incrementTail(),e&&(this._firstIndex=this._tailIndex)},e.prototype.grow=function(){var e=Math.max(l,Math.floor(this._capacity*c));this.resize(e)},e.prototype.shrink=function(){if(f){var e=Math.max(l,Math.floor(this._capacity*d));this.resize(e)}},e.prototype.resize=function(e){if(a(this._updating,"not updating"),e!==this._capacity){var t=new n(this._rctx,34962,35044,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var r=this.size,i=this.compactInstances(t);a(i===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=i,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new o(this._instanceBufferLayout.createView(this._buffer.array))}},e.prototype.compactInstances=function(e){var t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0},e.prototype.incrementHead=function(e){void 0===e&&(e=1),this._headIndex=(this._headIndex+e)%this._capacity},e.prototype.incrementTail=function(e){void 0===e&&(e=1),this._tailIndex=(this._tailIndex+e)%this._capacity},e.prototype.transferRange=function(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))},e}();t.RenderInstanceData=s;var l=1024,c=2,u=.3,d=.5,f=!0}.apply(null,n))||(e.exports=i)},h2zc:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("pcDC"),r("NfRO"),r("ycL1"),r("jfWY"),r("Vx27"),r("dlMz")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c){return function(e){function t(t){var r=e.call(this)||this;return r.wrap="repeat",r}var a;return r(t,e),a=t,Object.defineProperty(t.prototype,"url",{get:function(){return this._get("url")||null},set:function(e){this._set("url",e),e&&this._set("data",null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._get("data")||null},set:function(e){this._set("data",e),e&&this._set("url",null)},enumerable:!0,configurable:!0}),t.prototype.writeData=function(e,t,r,n){if(e instanceof HTMLImageElement){var i={type:"image-element",src:s.toJSON(e.src,n)};t[r]=i}else if(e instanceof HTMLCanvasElement){var a=e.getContext("2d").getImageData(0,0,e.width,e.height);i={type:"canvas-element",imageData:this.encodeImageData(a)};t[r]=i}else{i={type:"image-data",imageData:this.encodeImageData(e)};t[r]=i}},t.prototype.readData=function(e,t){switch(e.type){case"image-element":var r=new Image;return r.src=e.src,r;case"canvas-element":var n=this.decodeImageData(e.imageData),a=document.createElement("canvas");return a.width=n.width,a.height=n.height,a.getContext("2d").putImageData(n,0,0),a;case"image-data":return this.decodeImageData(e.imageData);default:i.neverReached(e)}},Object.defineProperty(t.prototype,"transparent",{get:function(){var e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this.imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this.imageDataContainsTransparent(e);if(t){var r=t.substr(t.length-4,4).toLowerCase(),n=t.substr(0,15).toLocaleLowerCase();if(".png"===r||"data:image/png;"===n)return!0}return!1},set:function(e){null!=e?this._override("transparent",e):this._clearOverride("transparent")},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new a({url:this.url,data:this.data,wrap:this.cloneWrap()})},t.prototype.cloneWrap=function(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}},t.prototype.encodeImageData=function(e){for(var t="",r=0;r<e.data.length;r++)t+=String.fromCharCode(e.data[r]);return{data:btoa(t),width:e.width,height:e.height}},t.prototype.decodeImageData=function(e){for(var t=atob(e.data),r=new Uint8ClampedArray(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return c.wrapImageData(r,e.width,e.height)},t.prototype.imageDataContainsTransparent=function(e){for(var t=3;t<e.data.length;t+=4)if(255!==e.data[t])return!0;return!1},n([l.property({type:String,json:{write:s.write}})],t.prototype,"url",null),n([l.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),l.property()],t.prototype,"data",null),n([l.writer("data")],t.prototype,"writeData",null),n([l.reader("data")],t.prototype,"readData",null),n([l.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],t.prototype,"transparent",null),n([l.property({json:{write:!0}})],t.prototype,"wrap",void 0),a=n([l.subclass("esri.geometry.support.MeshTexture")],t)}(l.declared(o,a.Identifiable))}.apply(null,n))||(e.exports=i)},hADE:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("AgDx"),r("CIy2"),r("+v1/"),r("RC9r")],void 0===(i=function(e,t,r,n,i,a){function o(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}Object.defineProperty(t,"__esModule",{value:!0});var s=n.VertexAttrConstants;t.createRibbonMaterial=function(e){var t={width:e.width,color:e.color,miterLimit:e.miterLimit,polygonOffset:!0,join:"miter",slicePlaneEnabled:e.slicePlaneEnabled};return"miter"===e.join||"bevel"===e.join?t.join=e.join:e.join,new a(t,e.idHint+"_ribbonlinemat")},t.createNativeMaterial=function(e){var t={color:e.color,slicePlaneEnabled:e.slicePlaneEnabled};return new i(t,e.idHint+"_nativelinemat")},t.isClosed=o,t.createPolylineGeometry=function(e,t,n,i,a){var l,c,u,d;if(n=n&&!o(e)){for(var f=new Float32Array(e.length+3),p=0;p<e.length;p++)f[p]=e[p];var h=f.length;f[h-3]=e[0],f[h-2]=e[1],f[h-1]=e[2],c=f,l=e.length/3+1,u=new Uint32Array(2*(l-1)),d=new Uint32Array(2*(l-1))}else l=e.length/3,u=new Uint32Array(2*(l-1)),d=new Uint32Array(2*(l-1)),c=e;var v=new Float32Array(1);v[0]=a;for(var m=0,g=0,y=0;y<l-1;y++)u[m++]=y,u[m++]=y+1,d[g++]=0,d[g++]=0;var b={},x={};return b[s.POSITION]=u,b[s.COLOR]=d,b[s.SIZE]=d,x[s.POSITION]={size:3,data:c,offsetIdx:0,strideIdx:3},x[s.COLOR]={size:4,data:i,offsetIdx:0,strideIdx:4},x[s.SIZE]={size:1,data:v,offsetIdx:0,strideIdx:1},t&&(b.mapPos=u,x.mapPos={size:3,data:t,offsetIdx:0,strideIdx:3}),new r(x,b,r.DefaultOffsets,"line")}}.apply(null,n))||(e.exports=i)},hCl0:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e,t){if(!e||e.symbol)return null;var r=t.renderer;return e&&r&&r.getObservationRenderer?r.getObservationRenderer(e):r}function n(e,t){if(e.symbol)return e.symbol;var n=r(e,t);return n&&n.getSymbol(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.getRenderer=r,t.getSymbol=n,t.getRenderingInfo=function(e,t){var i=r(e,t),a=n(e,t);if(!a)return null;var o={renderer:i,symbol:a};if(!(i&&"visualVariables"in i&&i.visualVariables))return o;for(var s=["proportional","proportional","proportional"],l=0,c=i.getVisualVariableValues(e,t);l<c.length;l++){var u=c[l],d=u.variable,f=u.value;if("color"===d.type)o.color=f.toRgba();else if("size"===d.type)if("outline"===d.target)o.outlineSize=f;else{var p=d.axis,h=d.useSymbolValue?"symbolValue":f;"width"===p?s[0]=h:"depth"===p?s[1]=h:"height"===p?s[2]=h:s[0]=s[1]="width-and-depth"===p?h:s[2]=h}else"opacity"===d.type?o.opacity=f:"rotation"===d.type&&"tilt"===d.axis?o.tilt=f:"rotation"===d.type&&"roll"===d.axis?o.roll=f:"rotation"===d.type&&(o.heading=f)}return(isFinite(s[0])||isFinite(s[1])||isFinite(s[2]))&&(o.size=s),o}}.apply(null,n))||(e.exports=i)},hQPx:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("0LE5")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=3;var a=this.TypedArrayConstructor;void 0===n&&(n=3*a.BYTES_PER_ELEMENT);var o=0===t.byteLength?0:r;this.typedBuffer=null==i?new a(t,o):new a(t,o,(i-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getVec=function(e,t){return r.vec3.set(t,this.typedBuffer[e*this.typedBufferStride],this.typedBuffer[e*this.typedBufferStride+1],this.typedBuffer[e*this.typedBufferStride+2])},e.prototype.setVec=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t[0],this.typedBuffer[e*this.typedBufferStride+1]=t[1],this.typedBuffer[e*this.typedBufferStride+2]=t[2]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r},e.prototype.copyFrom=function(e,t,r){var n=this.typedBuffer,i=t.typedBuffer,a=e*this.typedBufferStride,o=r*t.typedBufferStride;n[a]=i[o],n[a+1]=i[o+1],n[a+2]=i[o+2]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=3,e}();t.BufferViewVec3Impl=n}.apply(null,n))||(e.exports=i)},hkmr:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("1m5D"),r("0LE5"),r("Rdxj"),r("Z4y+"),r("mmEe"),r("ys4y"),r("AgDx"),r("ZO6V"),r("eHCP"),r("ZJC8"),r("CIy2"),r("RC9r"),r("I67D")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v){var m=0,g="rg_",y=function(){function e(){if(this.ROOT_ORIGIN_ID=g+"root_"+m++,this._origins=new Map,this._gridSize=42e5,r.isSome(e.testOrigin)){var t=e.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,d.fromValues(t[0],t[1],t[2],this.ROOT_ORIGIN_ID))}}return e.prototype.getOrigin=function(e){var t=this._origins.get(this.ROOT_ORIGIN_ID);if(null==t){var r=d.fromValues(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,r),r}i.vec3.subtract(x,e,t.vec3),x[0]=Math.abs(x[0]),x[1]=Math.abs(x[1]),x[2]=Math.abs(x[2]);var n=this._gridSize;if(x[0]<n&&x[1]<n&&x[2]<n)return t;var a=Math.round(e[0]/n),o=Math.round(e[1]/n),s=Math.round(e[2]/n),l=""+g+a+"/"+o+"/"+s,c=this._origins.get(l);return c||(c=d.fromValues(a*n,o*n,s*n,l),this._origins.set(l,c)),c},e.prototype._drawOriginBox=function(e){var t=window.view,r=t._stage;if(null==this._object){this._material=new h({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial"),r.add(v.ContentType.MATERIAL,this._material);var n=new u("GridLocalOrigin",{isPickable:!1});r.add(v.ContentType.LAYER,n),this._object=new f({name:"GridLocalOrigin",idHint:"GridLocalOrigin",castShadow:!1}),r.add(v.ContentType.OBJECT,this._object),n.addObject(this._object),r.addToViewContent([n.id])}for(var i=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],a=i.length,d=new Float32Array(3*a),m=new Uint32Array(2*(a-1)),g=.5*this._gridSize,y=0;y<a;y++)d[3*y+0]=e[0]+(1&i[y]?g:-g),d[3*y+1]=e[1]+(2&i[y]?g:-g),d[3*y+2]=e[2]+(4&i[y]?g:-g),y>0&&(m[2*y+0]=y-1,m[2*y+1]=y);s.bufferToBuffer(d,o.WebMercator,0,d,t.spatialReference,0,a);var x={};x[p.VertexAttrConstants.POSITION]={size:3,data:d};var _={};_[p.VertexAttrConstants.POSITION]=m;var S=new c(x,_,void 0,"line"),w=new l(S,"GridLocalOriginBox");r.add(v.ContentType.GEOMETRY,w),this._object.addGeometry(w,this._material,b)},e}(),b=n.mat4f64.create(),x=a.vec3f64.create();return(y||(y={})).testOrigin=null,y}.apply(null,n))||(e.exports=i)},hnAi:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("VfPl"),r("CIy2")],void 0===(i=function(e,t,r,n){function i(e,t,r,n,i){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(n*=o,null==i||1===i)for(var l=0;l<s;++l){var c=2*e[l];a[n]=t[c],a[n+1]=t[c+1],n+=o}else for(l=0;l<s;++l){c=2*e[l];for(var u=0;u<i;++u)a[n]=t[c],a[n+1]=t[c+1],n+=o}}function a(e,t,r,n,i){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(n*=o,null==i||1===i)for(var l=0;l<s;++l){var c=3*e[l];a[n]=t[c],a[n+1]=t[c+1],a[n+2]=t[c+2],n+=o}else for(l=0;l<s;++l){c=3*e[l];for(var u=0;u<i;++u)a[n]=t[c],a[n+1]=t[c+1],a[n+2]=t[c+2],n+=o}}function o(e,t,r,n,i){var a=r.typedBuffer,o=r.typedBufferStride,s=e.length;if(n*=o,null==i||1===i)for(var l=0;l<s;++l){var c=4*e[l];a[n]=t[c],a[n+1]=t[c+1],a[n+2]=t[c+2],a[n+3]=t[c+3],n+=o}else for(l=0;l<s;++l){c=4*e[l];for(var u=0;u<i;++u)a[n]=t[c],a[n+1]=t[c+1],a[n+2]=t[c+2],a[n+3]=t[c+3],n+=o}}function s(e,t,r,n,i,o){if(r){var s=r,l=n.typedBuffer,c=n.typedBufferStride,u=e.length;if(i*=c,null==o||1===o)for(var d=0;d<u;++d){var f=t[v=3*e[d]],p=t[v+1],h=t[v+2];l[i]=s[0]*f+s[4]*p+s[8]*h+s[12],l[i+1]=s[1]*f+s[5]*p+s[9]*h+s[13],l[i+2]=s[2]*f+s[6]*p+s[10]*h+s[14],i+=c}else for(d=0;d<u;++d){f=t[v=3*e[d]],p=t[v+1],h=t[v+2];for(var v,m=s[0]*f+s[4]*p+s[8]*h+s[12],g=s[1]*f+s[5]*p+s[9]*h+s[13],y=s[2]*f+s[6]*p+s[10]*h+s[14],b=0;b<o;++b)l[i]=m,l[i+1]=g,l[i+2]=y,i+=c}}else a(e,t,n,i,o)}function l(e,t,r,n,i,o){if(r){var s=r,l=n.typedBuffer,c=n.typedBufferStride,u=e.length;if(i*=c,null==o||1===o)for(var d=0;d<u;++d){var f=t[v=3*e[d]],p=t[v+1],h=t[v+2];l[i]=s[0]*f+s[4]*p+s[8]*h,l[i+1]=s[1]*f+s[5]*p+s[9]*h,l[i+2]=s[2]*f+s[6]*p+s[10]*h,i+=c}else for(d=0;d<u;++d){f=t[v=3*e[d]],p=t[v+1],h=t[v+2];for(var v,m=s[0]*f+s[4]*p+s[8]*h,g=s[1]*f+s[5]*p+s[9]*h,y=s[2]*f+s[6]*p+s[10]*h,b=0;b<o;++b)l[i]=m,l[i+1]=g,l[i+2]=y,i+=c}}else a(e,t,n,i,o)}function c(e,t,r,n,i,a){var o=n.typedBuffer,s=n.typedBufferStride,l=e.length;if(i*=s,null==a||1===a){if(4===r)for(var c=0;c<l;++c){var u=4*e[c];o[i]=t[u],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=t[u+3],i+=s}else if(3===r)for(c=0;c<l;++c){u=3*e[c];o[i]=t[u],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=255,i+=s}}else if(4===r)for(c=0;c<l;++c){u=4*e[c];for(var d=0;d<a;++d)o[i]=t[u],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=t[u+3],i+=s}else if(3===r)for(c=0;c<l;++c)for(u=3*e[c],d=0;d<a;++d)o[i]=t[u],o[i+1]=t[u+1],o[i+2]=t[u+2],o[i+3]=255,i+=s}function u(e,t,r,n,i,a,o){var s=i.typedBuffer,l=i.typedBufferStride,c=e.length;if(a*=l,null==o||1===o){if(4===r)for(var u=0;u<c;++u){var d=4*e[u];s[a]=t[d]*n[0],s[a+1]=t[d+1]*n[1],s[a+2]=t[d+2]*n[2],s[a+3]=t[d+3]*n[3],a+=l}else if(3===r){var f=255*n[3];for(u=0;u<c;++u){d=3*e[u];s[a]=t[d]*n[0],s[a+1]=t[d+1]*n[1],s[a+2]=t[d+2]*n[2],s[a+3]=f,a+=l}}}else if(4===r)for(u=0;u<c;++u){d=4*e[u];for(var p=0;p<o;++p)s[a]=t[d]*n[0],s[a+1]=t[d+1]*n[1],s[a+2]=t[d+2]*n[2],s[a+3]=t[d+3]*n[3],a+=l}else if(3===r)for(f=255*n[3],u=0;u<c;++u)for(d=3*e[u],p=0;p<o;++p)s[a]=t[d]*n[0],s[a+1]=t[d+1]*n[1],s[a+2]=t[d+2]*n[2],s[a+3]=f,a+=l}Object.defineProperty(t,"__esModule",{value:!0}),t.writeBufferVec2=i,t.writeBufferVec3=a,t.writeBufferVec4=o,t.writePosition=s,t.writeNormal=l,t.writeColor=c,t.writeMultipliedColor=u,t.writeDefaultAttributes=function(e,t,a,d,f,p,h){for(var v=0,m=a.fieldNames;v<m.length;v++){var g=m[v],y=e.vertexAttr[g],b=e.indices[g];if(y&&b)switch(g){case n.VertexAttrConstants.POSITION:n.assert(3===y.size);var x=p.getField(g,r.BufferViewVec3f);x&&s(b,y.data,d,x,h);break;case n.VertexAttrConstants.NORMAL:n.assert(3===y.size);var _=p.getField(g,r.BufferViewVec3f);_&&l(b,y.data,f,_,h);break;case n.VertexAttrConstants.UV0:n.assert(2===y.size);var S=p.getField(g,r.BufferViewVec2f);S&&i(b,y.data,S,h);break;case n.VertexAttrConstants.REGION:n.assert(4===y.size);var w=p.getField(g,r.BufferViewVec4u16);w&&o(b,y.data,w,h);break;case n.VertexAttrConstants.COLOR:n.assert(3===y.size||4===y.size);var C=p.getField(g,r.BufferViewVec4u8);C&&(t&&t.color?u(b,y.data,y.size,t.color,C,h):c(b,y.data,y.size,C,h));break;case n.VertexAttrConstants.SYMBOLCOLOR:n.assert(3===y.size||4===y.size);var P=p.getField(g,r.BufferViewVec4u8);P&&c(b,y.data,y.size,P,h);break;case n.VertexAttrConstants.TANGENT:n.assert(4===y.size);var E=p.getField(g,r.BufferViewVec4f);E&&o(b,y.data,E,h)}}}}.apply(null,n))||(e.exports=i)},i9pz:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zbgD"),r("U+8K")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return i.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GAUSSIAN_SAMPLES:e.gaussianSamples})},o=function(e){return i.glslifyDefineMap({GRID_OPTIMIZATION:e.gridOptimization,GRID_DEBUG:e.gridDebug})};t.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:n.resolveIncludes("renderer/highlight/downsample.vert"),fragmentShader:n.resolveIncludes("renderer/highlight/downsample.frag")},attributes:r.Default3D},t.blurPass={name:"highlight-blur",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:a(e)+n.resolveIncludes("renderer/highlight/blur.frag")}},attributes:r.Default3D},t.applyPass={name:"highlight-apply",shaders:function(e){return{vertexShader:o(e)+n.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:o(e)+n.resolveIncludes("renderer/highlight/apply.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)},icpk:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("QDcU"),r("ycL1"),r("rg9i"),r("qsST"),r("Vx27"),r("1dvD"),r("L6ij"),r("h2zc"),r("9Ros")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f){function p(){h.warn('Assigning ImageMeshColor to "MeshMaterial.color" is deprecated. Assigning to "MeshMaterial.colorTexture" instead.')}Object.defineProperty(t,"__esModule",{value:!0});var h=s.getLogger("esri.geometry.support.MeshMaterial"),v=function(e){function t(t){var r=e.call(this)||this;return r.color=null,r.colorTexture=null,r.normalTexture=null,r.alphaMode="auto",r.alphaCutoff=.5,r.doubleSided=!0,r}var a;return r(t,e),a=t,t.prototype.castColor=function(e){return e?Array.isArray(e)?new i(e):e instanceof i||e instanceof d?e:"string"==typeof e?m.test(e)||i.named[e]?new i(e):(p(),this.colorTexture=new d({url:e}),null):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData?(p(),this.colorTexture=new d({data:e}),null):e instanceof u?(p(),this.colorTexture=new d({url:e.url,data:e.data}),null):"image"===e.type?(p(),this.colorTexture=new d(e),null):e instanceof f?(h.warn('Assigning ValueMeshColor to "MeshMaterial.color" is deprecated. Automatically converting it to esri.Color.'),new i(e.value)):c.ensureType(i,e):e},t.prototype.castColorTexture=function(e){return e?"string"==typeof e?new d({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData?new d({data:e}):c.ensureType(d,e):e},t.prototype.readColorTexture=function(e,t,r){if(e)return new d(e)},t.prototype.castNormalTexture=function(e){return e?"string"==typeof e?new d({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData?new d({data:e}):c.ensureType(d,e):e},t.prototype.readNormalTexture=function(e,t,r){if(e)return new d(e)},t.prototype.clone=function(){return new a({color:o.clone(this.color),colorTexture:o.clone(this.colorTexture),normalTexture:o.clone(this.normalTexture),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided})},t.prototype.cloneWithSharedTextures=function(){return new a({color:o.clone(this.color),colorTexture:this.colorTexture,normalTexture:this.normalTexture,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided})},n([l.property({type:i,json:{write:!0}})],t.prototype,"color",void 0),n([l.cast("color")],t.prototype,"castColor",null),n([l.property({json:{write:!0}})],t.prototype,"colorTexture",void 0),n([l.cast("colorTexture")],t.prototype,"castColorTexture",null),n([l.reader("colorTexture")],t.prototype,"readColorTexture",null),n([l.property({json:{write:!0}})],t.prototype,"normalTexture",void 0),n([l.cast("normalTexture")],t.prototype,"castNormalTexture",null),n([l.reader("normalTexture")],t.prototype,"readNormalTexture",null),n([l.property({json:{write:!0}})],t.prototype,"alphaMode",void 0),n([l.property({json:{write:!0}})],t.prototype,"alphaCutoff",void 0),n([l.property({json:{write:!0}})],t.prototype,"doubleSided",void 0),a=n([l.subclass("esri.geometry.support.MeshMaterial")],t)}(l.declared(a));t.MeshMaterial=v;var m=/^\s*(#|rgba?\()/;t.default=v}.apply(null,n))||(e.exports=i)},j2SP:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("3gjc")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.vec4f32=r}.apply(null,n))||(e.exports=i)},jj3b:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("HZ3d"),r("Q2wQ"),r("2Atf"),r("LxLY"),r("qMld"),r("1m5D"),r("cE5x"),r("TqrP"),r("OIWm")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u){function d(e){switch(e){case 4:case 5:case 6:return e;default:return null}}function f(e,t){return r(this,void 0,void 0,function(){function i(o,s){return r(this,void 0,void 0,function(){var r,l,c,u,d,f,p,h;return n(this,function(n){switch(n.label){case 0:if(r=a.nodes[o],l=e.getNodeTransform(o),g.warnUnsupportedIf(null!=r.weights,"Morph targets are not supported."),null==r.mesh)return[3,4];c=a.meshes[r.mesh],u=0,d=c.primitives,n.label=1;case 1:return u<d.length?(f=d[u],[4,t(f,l,s,c.name)]):[3,4];case 2:n.sent(),n.label=3;case 3:return u++,[3,1];case 4:p=0,h=r.children||[],n.label=5;case 5:return p<h.length?[4,i(h[p],s)]:[3,8];case 6:n.sent(),n.label=7;case 7:return p++,[3,5];case 8:return[2]}})})}var a,s,l,c,u,d,f,h,v,m;return n(this,function(t){switch(t.label){case 0:a=e.json,s=a.scenes[a.scene||0],l=s.nodes,c=l.length>1,u=0,d=l,t.label=1;case 1:return u<d.length?(f=d[u],h=a.nodes[f],v=[i(f,0)],p(h)&&!c&&(m=h.extensions.MSFT_lod.ids,v.push.apply(v,m.map(function(e,t){return i(e,t+1)}))),[4,o.all(v)]):[3,4];case 2:t.sent(),t.label=3;case 3:return u++,[3,1];case 4:return[2]}})})}function p(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function h(e,t,r){var n=function(t){var n=r+"_tex_"+(t&&t.id)+(t&&t.name?"_"+t.name:"");if(t&&!e.textures.has(n)){var i=c.makeTextureSource(t.data,{wrap:{s:v(t.wrapS),t:v(t.wrapT)},mipmap:y.some(function(e){return e===t.minFilter}),noUnpackFlip:!0});e.textures.set(n,i)}return n},i=r+"_mat_"+t.id+"_"+t.name;if(!e.materials.has(i)){var a=c.makeMaterialParameters({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?n(t.colorTexture):void 0,textureNormal:t.normalTexture?n(t.normalTexture):void 0});e.materials.set(i,a)}return i}function v(e){if(33071===e||33648===e||10497===e)return e;g.error("Unexpected TextureSampler WrapMode: "+e)}Object.defineProperty(t,"__esModule",{value:!0});var m=0;t.load=function(e,t,i){return void 0===i&&(i={}),r(this,void 0,void 0,function(){var i,o,l,c,p=this;return n(this,function(v){switch(v.label){case 0:return[4,u.Resource.load(e,g,t)];case 1:return i=v.sent(),o="gltf_"+m++,l={lods:[],materials:new Map,textures:new Map},c=!(!i.json.asset.extras||"symbolResource"!==i.json.asset.extras.ESRI_type),[4,f(i,function(e,t,c,u){return r(p,void 0,void 0,function(){var r,f,p,v,m,y,x,_,S,w;return n(this,function(n){switch(n.label){case 0:return r=e.mode||4,f=d(r),a.isNone(f)?(g.warnUnsupported("Unsupported primitive mode ("+b[r]+"). Skipping primitive."),[2]):[4,i.getMaterial(e)];case 1:return p=n.sent(),m={transform:s.mat4f64.clone(t)},y={},[4,i.getPositionData(e)];case 2:return m.attributes=(y.position=n.sent(),y.normal=null,y.texCoord0=null,y.color=null,y.tangent=null,y),[4,i.getIndexData(e)];case 3:return m.indices=n.sent(),m.primitiveType=f,m.material=h(l,p,o),v=m,i.hasNormals(e)?(x=v.attributes,[4,i.getNormalData(e)]):[3,5];case 4:x.normal=n.sent(),n.label=5;case 5:return i.hasTangents(e)?(_=v.attributes,[4,i.getTangentData(e)]):[3,7];case 6:_.tangent=n.sent(),n.label=7;case 7:return i.hasTextureCoordinates(e)?(S=v.attributes,[4,i.getTextureCoordinates(e)]):[3,9];case 8:S.texCoord0=n.sent(),n.label=9;case 9:return i.hasVertexColors(e)?(w=v.attributes,[4,i.getVertexColors(e)]):[3,11];case 10:w.color=n.sent(),n.label=11;case 11:return l.lods[c]=l.lods[c]||{parts:[],name:u,lodThreshold:null},l.lods[c].parts.push(v),[2]}})})})];case 2:return v.sent(),[2,{model:l,meta:{isEsriSymbolResource:c,uri:i.uri},customMeta:{}}]}})})};var g=new l.DefaultErrorContext,y=[9987,9985],b=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"]}.apply(null,n))||(e.exports=i)},jlKI:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("weRx"),r("QFi0"),r("/f24"),r("G0ER"),r("qbr3"),r("Zp3t"),r("z2+Q")],void 0===(i=function(e,t,n,i,a,o,s,l,c){return function(){function e(e){this._isLoadingResources=!1,this.isEnabled=!1,this.vertexAttributeLocations={vPosition:0},this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.loadResources=function(e){var t=this;return!!this.data||(this._isLoadingResources=!0,r.e(94).then(function(){var n=[r("5bH8")];(function(r){t.data=r,t._isLoadingResources=!1,e&&e()}).apply(null,n)}).catch(r.oe),!1)},Object.defineProperty(e.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0}),e.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var e=this.rctx;this.programEdgeDetect=new o(e,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations),this.programBlendWeights=new o(e,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations),this.programBlur=new o(e,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations),this.pipelineState=s.makePipelineState({colorWrite:s.defaultColorWriteParams});var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new c(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new i(e,34962,35044,t)}),this.tmpFramebufferEdges=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.tmpFramebufferBlend=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0}),this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.textureSearch=this.loadTextureFromBase64(this.data.searchTexure,9728,6409),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx,n={x:0,y:0,width:0,height:0};null!=t?(n.width=t.descriptor.width,n.height=t.descriptor.height):(n.width=r.gl.canvas.width,n.height=r.gl.canvas.height),r.bindVAO(this.vao),r.setPipelineState(this.pipelineState),r.setViewport(n.x,n.y,n.width,n.height),this.tmpFramebufferEdges.resize(n.width,n.height),r.bindFramebuffer(this.tmpFramebufferEdges),r.setClearColor(0,0,0,1),r.clear(16384),r.bindProgram(this.programEdgeDetect),r.bindTexture(e.colorTexture,0),this.programEdgeDetect.setUniform1i("tColor",0),this.programEdgeDetect.setUniform4f("uResolution",1/n.width,1/n.height,n.width,n.height),r.drawArrays(4,0,3),this.tmpFramebufferBlend.resize(n.width,n.height),r.bindFramebuffer(this.tmpFramebufferBlend),r.setClearColor(0,0,1,1),r.clear(16384),r.bindProgram(this.programBlendWeights),this.programBlendWeights.setUniform4f("uResolution",1/n.width,1/n.height,n.width,n.height),r.bindTexture(this.textureSearch,1),this.programBlendWeights.setUniform1i("tSearch",1),r.bindTexture(this.textureArea,2),this.programBlendWeights.setUniform1i("tArea",2),r.bindTexture(this.tmpFramebufferEdges.colorTexture,3),this.programBlendWeights.setUniform1i("tEdges",3),r.drawArrays(4,0,3),r.bindFramebuffer(t),r.setClearColor(0,1,0,1),r.clear(16384),r.bindProgram(this.programBlur),this.programBlur.setUniform4f("uResolution",1/n.width,1/n.height,n.width,n.height),r.bindTexture(e.colorTexture,0),this.programBlur.setUniform1i("tColor",0),r.bindTexture(this.tmpFramebufferBlend.colorTexture,1),this.programBlur.setUniform1i("tBlendWeights",1),r.drawArrays(4,0,3)},e.prototype.loadTextureFromBase64=function(e,t,r){var i=new l(this.rctx,{pixelFormat:r,dataType:5121,wrapMode:33071,samplingMode:t},null);return n.requestImage(e).then(function(e){i.resize(e.width,e.height),i.setData(e)}),i},e}()}.apply(null,n))||(e.exports=i)},jmRc:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xoE+")],void 0===(i=function(e,t,r){function n(e,t,n,l){void 0===l&&(l=0);var c=e.byteLength/(4*t),u=new Uint32Array(e,0,c*t),d=new Uint32Array(c),f=Math.floor(1.1*c)+1;(null==s||s.length<2*f)&&(s=new Uint32Array(r.nextHighestPowerOfTwo(2*f)));for(var p=0;p<2*f;p++)s[p]=0;var h=0,v=1.96,m=0!==l?Math.ceil(4*v*v/(l*l)*l*(1-l)):c;for(p=0;p<c;p++){if(p===m){var g=1-h/p;if(g+v*Math.sqrt(g*(1-g)/p)<l)return null;m*=2}for(var y=p*t,b=o(u,y,t),x=b%f,_=h;0!==s[2*x+1];){if(s[2*x]===b){var S=s[2*x+1]-1;if(i(u,y,S*t,t)){_=d[S];break}}++x>=f&&(x-=f)}_===h&&(s[2*x]=b,s[2*x+1]=p+1,h++),d[p]=_}if(0!==l&&1-h/c<l)return null;var w=new Uint32Array(t*h);h=0;for(p=0;p<c;p++)d[p]===h&&(a(u,p*t,w,h*t,t),h++);if(n){var C=new Uint32Array(n.length);for(p=0;p<C.length;p++)C[p]=d[n[p]];d=C}return{buffer:w.buffer,indices:d,uniqueCount:h}}function i(e,t,r,n){for(var i=0;i<n;i++)if(e[t+i]!==e[r+i])return!1;return!0}function a(e,t,r,n,i){for(var a=0;a<i;a++)r[n+a]=e[t+a]}function o(e,t,r){for(var n=0,i=0;i<r;i++)n=(n=e[t+i]+n|0)+(n<<11)+(n>>>2)|0;return n>>>0}Object.defineProperty(t,"__esModule",{value:!0}),t.deduplicate=n;var s=null;t.default=n}.apply(null,n))||(e.exports=i)},joKa:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("3Noo")],void 0===(i=function(e,t,r){return function(){function e(){this.graphicsCore=null,this.highlights=[]}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.setup=function(e){this.graphicsCore=e},e.prototype.acquireSet=function(e,t){var n=this,i=new r(e,t);return this.highlights.push(i),{set:i,handle:{remove:function(){return n.releaseSet(i)},pause:function(){i.highlightSet.removeAll(),i.paused=!0},resume:function(){i.paused=!1,n.initializeSet(i)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setUids=function(e,t){for(var r=this.graphicsCore.graphics3DGraphics,n=0,i=t;n<i.length;n++){var a=i[n];e.ids.add(a);var o=r.get(a);o&&o.addHighlight(e.highlightSet,e.options)}},e.prototype.setObjectIds=function(e,t){t.forEach(function(t){return e.ids.add(t)}),this.initializeSet(e)},e.prototype.addGraphic=function(e){this.highlights.forEach(function(t){!t.paused&&t.hasGraphic(e)&&e.addHighlight(t.highlightSet,t.options)})},e.prototype.removeGraphic=function(e){this.highlights.forEach(function(t){t.hasGraphic(e)&&e.removeHighlight(t.highlightSet)})},e.prototype.allGraphicsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e.prototype.initializeSet=function(e){var t=this.graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach(function(t){t&&e.hasGraphic(t)&&t.addHighlight(e.highlightSet,e.options)}):e.ids.forEach(function(r){var n=t.get(r);n&&n.addHighlight(e.highlightSet,e.options)})},e}()}.apply(null,n))||(e.exports=i)},juQt:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("LiJt"),r("LFjk")],void 0===(i=function(e,t,r,n,i){return function(e){function t(t,r){var n=e.call(this)||this;return n.symbol=t,n.graphics3DSymbol=null,n.referenced=0,t.fetchSymbol().then(function(e){if(n.isRejected())throw new Error;e.id=n.symbol.id,n.graphics3DSymbol=r(e)}).then(function(){if(n.isRejected())throw new Error;n.graphics3DSymbol.then(function(){n.isRejected()||n.resolve()},function(e){n.isRejected()||n.reject(e)})}).catch(function(e){n.isRejected()||n.reject(e)}),n}return r(t,e),t.prototype.getSymbolLayerSize=function(e,t){t(null)},t.prototype.createGraphics3DGraphic=function(e){return this.graphics3DSymbol.createGraphics3DGraphic(e,this)},Object.defineProperty(t.prototype,"complexity",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.complexity:n.emptySymbolComplexity},enumerable:!0,configurable:!0}),t.prototype.globalPropertyChanged=function(e,t){return this.graphics3DSymbol.globalPropertyChanged(e,t)},t.prototype.applyRendererDiff=function(e,t){return this.graphics3DSymbol.applyRendererDiff(e,t)},t.prototype.prepareSymbolPatch=function(e){this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(e)},t.prototype.updateGeometry=function(e,t){return!!this.graphics3DSymbol&&this.graphics3DSymbol.updateGeometry(e,t)},t.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}},t.prototype.setDrawOrder=function(e,t){this.graphics3DSymbol&&this.graphics3DSymbol.setDrawOrder(e,t)},t.prototype.destroy=function(){this.isFulfilled()||this.reject(),this.graphics3DSymbol&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0},Object.defineProperty(t.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!0,configurable:!0}),t}(i.default)}.apply(null,n))||(e.exports=i)},kW7X:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("342/"),r("xtwj")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var i=this;for(var a in this.owner=t,this.properties={},this.afterDispatchHandle=null,e){var o=e[a],s=new r.ReentrantObjectPool(o,null,null,2,2);this.properties[a]={pool:s,acquired:[]}}this.afterDispatchHandle=n.afterDispatch(function(){return i.release()})}return e.prototype.destroy=function(){for(var e in this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null),this.properties){for(var t=this.properties[e],r=0,i=t.acquired;r<i.length;r++){var a=i[r];n.isValueInUse(a)||t.pool.release(a)}t.pool.destroy(),t.pool=null,t.acquired=null}this.properties=null,this.owner=null},e.prototype.get=function(e){var t=this.owner._get(e),r=this.properties[e],n=r.pool.acquire();for(r.acquired.push(n);n===t;)r.acquired.push(n),n=r.pool.acquire();return n},e.prototype.release=function(){for(var e in this.properties){for(var t=this.properties[e],r=0,i=0,a=t.acquired;i<a.length;i++){var o=a[i];n.isValueInUse(o)?t.acquired[r++]=o:t.pool.release(o)}t.acquired.length=r}},e}();t.PropertiesPool=i,t.default=i}.apply(null,n))||(e.exports=i)},kfwU:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KY0m"),r("rusB"),r("0LE5"),r("Rdxj"),r("AzkI")],void 0===(i=function(e,t,r,n,i,a,o){function s(e,t){return e.cosAngle<t}function l(e,t){return e.cosAngle>t}function c(e,t){var r=o.acos(e.cosAngle),n=p.fwd,a=p.ortho;return o.directionFromTo(n,e.position1,e.position0),r*(i.vec3.dot(i.vec3.cross(a,e.faceNormal0,e.faceNormal1),n)>0?-1:1)>t}function u(e){for(var t=e.faces.length/3,r=e.faces,n=e.neighbors,i=0,a=0;a<t;a++){var o=n[3*a+0],s=n[3*a+1],l=n[3*a+2],c=r[3*a+0],u=r[3*a+1],d=r[3*a+2];i+=o===f||c<u?1:0,i+=s===f||u<d?1:0,i+=l===f||d<c?1:0}var p=new Int32Array(4*i),h=0;for(a=0;a<t;a++){o=n[3*a+0],s=n[3*a+1],l=n[3*a+2],c=r[3*a+0],u=r[3*a+1],d=r[3*a+2];(o===f||c<u)&&(p[h++]=c,p[h++]=u,p[h++]=a,p[h++]=o),(s===f||u<d)&&(p[h++]=u,p[h++]=d,p[h++]=a,p[h++]=s),(l===f||d<c)&&(p[h++]=d,p[h++]=c,p[h++]=a,p[h++]=l)}return p}function d(e){for(var t=e.faces.length/3,r=e.vertices.position,n=e.faces,a=h.v0,o=h.v1,s=h.v2,l=new Float32Array(3*t),c=0;c<t;c++){var u=n[3*c+0],d=n[3*c+1],f=n[3*c+2];r.getVec(u,a),r.getVec(d,o),r.getVec(f,s),i.vec3.subtract(o,o,a),i.vec3.subtract(s,s,a),i.vec3.cross(a,o,s),i.vec3.normalize(a,a),l[3*c+0]=a[0],l[3*c+1]=a[1],l[3*c+2]=a[2]}return l}Object.defineProperty(t,"__esModule",{value:!0});var f=-1;t.extractEdges=function(e,t,a,h){void 0===h&&(h=v);var m=e.vertices.position,g=e.vertices.componentIndex,y=o.deg2rad(h.anglePlanar),b=o.deg2rad(h.angleSignificantEdge),x=Math.cos(b),_=Math.cos(y),S=p.edge,w=S.position0,C=S.position1,P=S.faceNormal0,E=S.faceNormal1,T=d(e),O=u(e),A=O.length/4,R=t.allocate(A),M=0,I=A,D=a.allocate(I),V=0,L=0,F=0,B=r.range(0,A),N=new Float32Array(A);n.forEach(N,function(e,t,r){m.getVec(O[4*t+0],w),m.getVec(O[4*t+1],C),r[t]=i.vec3.distance(w,C)}),B.sort(function(e,t){return N[t]-N[e]});for(var U=new Array,z=new Array,j=0;j<A;j++){var G=B[j],H=N[G],k=O[4*G+0],W=O[4*G+1],q=O[4*G+2],X=O[4*G+3],Y=X===f;if(m.getVec(k,w),m.getVec(W,C),Y)i.vec3.set(P,T[3*q+0],T[3*q+1],T[3*q+2]),i.vec3.copy(E,P),S.componentIndex=g.get(k),S.cosAngle=i.vec3.dot(P,E);else{if(i.vec3.set(P,T[3*q+0],T[3*q+1],T[3*q+2]),i.vec3.set(E,T[3*X+0],T[3*X+1],T[3*X+2]),S.componentIndex=g.get(k),S.cosAngle=i.vec3.dot(P,E),l(S,_))continue;S.cosAngle<-.9999&&i.vec3.copy(E,P)}L+=H,F++,Y||s(S,x)?(t.write(R,M++,S),U.push(H)):c(S,y)&&(a.write(D,V++,S),z.push(H))}var Q=new Float32Array(U.reverse()),Z=new Float32Array(z.reverse());return{regular:{instancesData:t.trim(R,M),lodInfo:{lengths:Q}},silhouette:{instancesData:a.trim(D,V),lodInfo:{lengths:Z}},averageEdgeLength:L/F}};var p={edge:{position0:a.vec3f64.create(),position1:a.vec3f64.create(),faceNormal0:a.vec3f64.create(),faceNormal1:a.vec3f64.create(),componentIndex:0,cosAngle:0},ortho:a.vec3f64.create(),fwd:a.vec3f64.create()},h={v0:a.vec3f64.create(),v1:a.vec3f64.create(),v2:a.vec3f64.create()},v={anglePlanar:4,angleSignificantEdge:35}}.apply(null,n))||(e.exports=i)},krVM:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Rdxj"),r("05NA"),r("qUb7"),r("I67D"),r("JUgm")],void 0===(i=function(e,t,r,n,i,a,o){function s(e){return"function"==typeof e.addParentStage&&"function"==typeof e.removeParentStage}return function(){function e(e,t,n,s){this.sceneIntersectionHelper=s,this._viewContent=[],this.container=t,this.viewingMode=e,this.model=new a,this.view=new o(t,this,this.model.getDirtySet(),n),this.view.setLighting({lights:[new i.MainLight(r.vec3f64.fromValues(.7,.7,.7)),new i.AmbientLight(r.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}return e.prototype.setNeedsRender=function(){this.view.setNeedsRender()},e.prototype.dispose=function(){this.view.dispose(),this.view=null,this.model=null},e.prototype.add=function(e,t){this.model.add(e,t),s(t)&&t.addParentStage(this)},e.prototype.remove=function(e,t){var r=this.model.remove(e,t);return s(r)&&r.removeParentStage(this),r},e.prototype.notifyDirty=function(e,t,r,n){this.model.notifyDirty(e,t,r,n)},e.prototype.processDirty=function(){var t=this.model.getDirtySet(),r=t.getDirtyMaterials();if(t.hasDirtyGeometryRecords()||r){e.DebugSettings.logDirtySet;var n=t.commitLayers(this._viewContent);(n[0].length+n[1].length+n[2].length>0||r)&&this.view.modify(n[0],n[1],n[2],r),e.DebugSettings.logDirtySet,t.commit(),t.clearDirtyMaterials(),this.view.setNeedsRender()}},e.prototype.processDirtyLayer=function(e){var t=this.model.getDirtySet(),r=t.getDirtyMaterials(),n=t.commitLayers([e]);(n[0].length+n[1].length+n[2].length>0||r)&&this.view.modify(n[0],n[1],n[2],r),t.clearDirtyMaterials(),this.view.setNeedsRender()},e.prototype.get=function(e,t){return this.model.get(e,t)},e.prototype.getAll=function(e){return this.model.getAll(e)},e.prototype.getCamera=function(){return this.view.getCamera()},e.prototype.setCamera=function(e){this.view.setCamera(e)},e.prototype.setViewParams=function(e){this.view.setViewParams(e)},e.prototype.getLayers=function(){return this.model.getAll(n.LAYER)},e.prototype.setLighting=function(e){this.view.setLighting(e)},e.prototype.getCanvas=function(){return this.view.getCanvas()},e.prototype.setRenderParams=function(e){this.view.setRenderParams(e)},e.prototype.getRenderParams=function(){return this.view.getRenderParams()},e.prototype.has=function(e){return this.view.has(e)},e.prototype.getViewContent=function(){return this._viewContent.slice(0)},e.prototype.addToViewContent=function(e){for(var t=[],r=0;r<e.length;r++)-1===this._viewContent.indexOf(e[r])&&t.push(e[r]);if(e.length>0){this.processDirty();var n=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(t);this.view.modify(n,[],[]),this._viewContent.push.apply(this._viewContent,t)}},e.prototype.removeFromViewContent=function(e){this.processDirty();for(var t=this.model.getDirtySet(),r=this._viewContent,n=[],i=0;i<e.length;i++){var a=r.indexOf(e[i]);a>-1&&(r[a]=r[r.length-1],r.pop(),n.push(e[i]))}var o=t.getResidentRenderGeometriesFilteredByLayers(n);this.view.modify([],o,[])},e.prototype.getFrameTask=function(){return this.view.getFrameTask()},e.prototype.takeScreenshot=function(e){return this.view.takeScreenshot(e)},e.prototype.addRenderPlugin=function(e,t){return"intersect"in t&&this.sceneIntersectionHelper.addIntersectionHandler(t),this.view.renderPlugins.add(e,t)},e.prototype.removeRenderPlugin=function(e){return"intersect"in e&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.view.renderPlugins.remove(e)},e.prototype.getContentDebugStrings=function(e){return this.model.formatDebugInfo(e)},e.prototype.getRenderStats=function(){return this.view.getCombinedStats()},e.prototype.getRenderStatString=function(e){var t=this.getRenderStats(),r="";if(e){for(var n in r+="<table>",t)r+="<tr><td>"+n+'</td><td style="text-align: right">'+Math.round(t[n])+"</td></tr>";r+="</table>"}else for(var n in t)r+=n+": "+t[n]+"\n";return r},e.prototype.getFramebufferTexture=function(e){return void 0===e&&(e="color"),this.view.getFramebufferTexture(e)},e.prototype.getDrapedRenderer=function(){return this.view.getDrapedRenderer()},e.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},e.ModelContentType=n,e}()}.apply(null,n))||(e.exports=i)},l8NS:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("NsUs")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateFunction=function(e,t){var r=n[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isStandardized=function(e,t){var r=n[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var n={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];if(null==r)return null;if(r instanceof Date)switch(t.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=e[0],r=e[1];return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){t=e[0],r=e[1];var n=e[2];return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];return null==t||null==r?null:r.indexOf(t)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,n=t?e[1]:" ",i=t?e[2]:e[1];if(null==n||null==i)return null;var a="("+r.escapeString(n)+")";switch(e[0]){case"BOTH":return i.replace(new RegExp("^"+a+"*|"+a+"*$","g"),"");case"LEADING":return i.replace(new RegExp("^"+a+"*","g"),"");case"TRAILING":return i.replace(new RegExp(a+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}}}.apply(null,n))||(e.exports=i)},l8Vi:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("QDcU"),r("jBNx"),r("VW5z"),r("s4LJ"),r("zF3d"),r("JzVu"),r("BwdQ"),r("LiJt"),r("krVM"),r("ys4y"),r("AgDx"),r("CIy2"),r("M9wp")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v){Object.defineProperty(t,"__esModule",{value:!0});var m,g,y=h.VertexAttrConstants,b=function(e){function t(t,r){var n=e.call(this,t,null,r,!0)||this;n._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};var i=n._getStageIdHint();return n._createMaterialsAndAddToStage(n._context.stage,i),n.resolve(),n}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(d.ModelContentType.MATERIAL,this._material.id),this._material=null)},t.prototype.perInstanceMaterialParameters=function(e){var t=this.materialParameters;return t.screenOffset=e.screenOffset||[0,0],t.centerOffsetUnits=e.centerOffsetUnits||"world",t},Object.defineProperty(t.prototype,"materialParameters",{get:function(){var e=this.symbol,t=e.callout,r=n.toUnitRGBA(t.color);r[3]*=this._getLayerOpacity();var a=i.pt2px(t.size||0),o=null;if(e.verticalOffset){var s=e.verticalOffset,l=s.screenLength,c=s.minWorldLength,u=s.maxWorldLength;o={screenLength:i.pt2px(l),minWorldLength:c||0,maxWorldLength:null!=u?u:1/0}}var d=t.border&&t.border.color?n.toUnitRGBA(t.border.color):null,f="object"===e.symbolLayers.getItemAt(0).type,p=!f,h=f?0:void 0,v="label-3d"===e.type;return{color:r,size:a,verticalOffset:o,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:d,occlusionTest:p,shaderPolygonOffset:h,depthHUDAlignStart:v,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!0,configurable:!0}),t.prototype._createMaterialsAndAddToStage=function(e,t){this._material=new v(this.materialParameters,t+"_lineCallout_common"),e.add(d.ModelContentType.MATERIAL,this._material)},t.prototype._defaultElevationInfoNoZ=function(){return w},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,r=e.graphic,n=this.getGraphicElevationContext(r,t.elevationOffset||0),i=t.symbol,a="on-the-ground"===this._elevationContext.mode&&!i.symbolLayers.some(function(e){return"object"===e.type||"text"===e.type});if("label-3d"!==i.type&&a)return null;var o=c.computeCentroid(r.geometry);if(null==o)return null;var s="graphic"+r.uid;return this._createAs3DShape(r,o,n,t,s,r.uid)},t.prototype.layerOpacityChanged=function(){return this._material.setParameterValues(this.materialParameters),!0},t.prototype.layerElevationInfoChanged=function(e,t,r){var n=this,i=this._elevationContext.mode;return(r===i||"on-the-ground"!==r&&"on-the-ground"!==i)&&(e.forEach(function(e){var r=t(e);r&&n.updateGraphicElevationContext(e.graphic,r)}),!0)},t.prototype.slicePlaneEnabledChanged=function(e,t){return this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled}),!0},t.prototype.pixelRatioChanged=function(e,t){return!0},t.prototype.getGraphicElevationContext=function(t,r){void 0===r&&(r=0);var n=e.prototype.getGraphicElevationContext.call(this,t);return n.addOffsetRenderUnits(r),n},t.prototype.updateGraphicElevationContext=function(e,t){var r=this.getGraphicElevationContext(e,t.metadata.elevationOffset);t.elevationContext.set(r),t.needsElevationUpdates=s.needsElevationUpdates2D(r.mode)},t.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,memory:u.emptySymbolComplexity.memory}},t.prototype.createVertexData=function(e){var t,r=e.translation,n=e.centerOffset;if(!r&&!n)return x;var i=r?{size:3,data:[r[0],r[1],r[2]]}:x[y.POSITION],a=n?{size:4,data:[n[0],n[1],n[2],n[3]]}:x[y.AUXPOS1];return(t={})[y.POSITION]=i,t[y.NORMAL]=x[y.NORMAL],t[y.AUXPOS1]=a,t},t.prototype.getOrCreateMaterial=function(e,t){var r,n=this.perInstanceMaterialParameters(e),i=v.uniqueMaterialIdentifier(n);return i===this._material.uniqueMaterialIdentifier?{material:this._material,isUnique:!1}:e.materialCollection?((r=e.materialCollection.getMaterial(i))||(r=new v(n,t+"_lineCallout_shared"),e.materialCollection.addMaterial(i,r)),{material:r,isUnique:!1}):{material:r=new v(n,t+"_lineCallout_unique"),isUnique:!0}},t.prototype._createAs3DShape=function(e,t,r,n,i,l){var c=new p(this.createVertexData(n),S,p.DefaultOffsets,"point"),u=[new f(c,i)],d=this.getOrCreateMaterial(n,i),h=s.createStageObjectForPoint(this._context,t,u,[d.material],null,null,r,i,this._context.layer.uid,l,!0);if(null===h)return null;var v=a.perObjectElevationAligner,m=new o(this,h.object,u,d.isUnique?[d.material]:null,null,v,r);return m.metadata={elevationOffset:n.elevationOffset||0},m.alignedTerrainElevation=h.terrainElevation,m.needsElevationUpdates=s.needsElevationUpdates2D(r.mode),s.extendPointGraphicElevationContext(m,t,this._context.elevationProvider),m},t}(l.Graphics3DSymbolLayer);t.Graphics3DLineCalloutSymbolLayer=b;var x=((m={})[y.POSITION]={size:3,data:[0,0,0]},m[y.NORMAL]={size:3,data:[0,0,1]},m[y.AUXPOS1]={size:4,data:[0,0,0,1]},m),_=new Uint32Array([0]),S=((g={})[y.POSITION]=_,g[y.NORMAL]=_,g[y.AUXPOS1]=_,g),w={mode:"relative-to-ground",offset:0};t.default=b}.apply(null,n))||(e.exports=i)},lLWD:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("SgdR")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.quatf64=r}.apply(null,n))||(e.exports=i)},mYMs:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("SyoC"),r("KBgh"),r("0LE5"),r("Rdxj"),r("aWgr"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a,o,s){function l(e,t,r){e[0]=Math.min(e[0],t[0]-r),e[1]=Math.min(e[1],t[1]-r),e[2]=Math.min(e[2],t[2]-r)}function c(e,t,r){e[0]=Math.max(e[0],t[0]+r),e[1]=Math.max(e[1],t[1]+r),e[2]=Math.max(e[2],t[2]+r)}function u(e,t,r){return(r=r||e)[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t,r}function d(e,t,r){return!o.frustum.intersectsSphere(r.planes,o.sphere.wrap(t,e))}function f(e,t,r){if(!M.length)for(var n=0;n<8;++n)M.push({index:0,distance:0});for(n=0;n<8;++n){var i=g[n];M.data[n].index=n,M.data[n].distance=h(e,t,i)}M.sort(function(e,t){return e.distance-t.distance}),r.clear();for(n=0;n<8;++n)r.push(M.data[n].index)}function p(e,t){for(var r=1/0,n=null,i=0;i<8;++i){var a=h(e,t,y[i]);a<r&&(r=a,n=y[i])}return n}function h(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}var v=function(){function e(e,t,r,n){this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._objectCount=0,this._objectToBoundingSphere=r,n&&(void 0!==n.maximumObjectsPerNode&&(this._maximumObjectsPerNode=n.maximumObjectsPerNode),void 0!==n.maximumDepth&&(this._maximumDepth=n.maximumDepth)),isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(t)?this._root=new m(null,a.vec3f64.fromValues(0,0,0),.5):this._root=new m(null,e,t/2)}return Object.defineProperty(e.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._degenerateObjects.clear(),this._root=null,m.clearPool(),x=[null],P.prune(),M.prune(),I.prune()},e.prototype.add=function(e,t){var r=this._objectOrObjectsArray(e);t=null==t?r.length:t,this._objectCount+=t,this._grow(r);for(var n=m.acquire(),i=0;i<t;i++){var a=r[i];n.init(this._root),this._isDegenerate(a)?this._degenerateObjects.add(a):this._add(a,n)}m.release(n)},e.prototype.remove=function(e,t){var r=this._objectOrObjectsArray(e);this._objectCount-=r.length;for(var n=m.acquire(),i=0;i<r.length;i++){var a=r[i],o=t||this._boundingSphereFromObject(a,E);this._isValidRadius(o.radius)?(n.init(this._root),this._remove(a,o,n)):this._degenerateObjects.delete(a)}m.release(n),this._shrink()},e.prototype.update=function(e,t){!this._isValidRadius(t.radius)&&this._isDegenerate(e)||(this.remove(e,t),this.add(e))},e.prototype.forEachAlongRay=function(e,t,r){var n=this;this._forEachNode(this._root,function(i){if(!n._intersectsNode(e,t,i))return!1;var a=i.node;return a.terminals.forEach(function(i){n._intersectsObject(e,t,i)&&r(i)}),null!==a.residents&&a.residents.forEach(function(i){n._intersectsObject(e,t,i)&&r(i)}),!0})},e.prototype.forEach=function(e){this._forEachNode(this._root,function(t){var r=t.node;return r.terminals.forEach(e),null!==r.residents&&r.residents.forEach(e),!0}),this._degenerateObjects.forEach(e)},e.prototype.forEachDegenerateObject=function(e){this._degenerateObjects.forEach(e)},e.prototype.findClosest=function(e,t,r,n,i){return this._findClosest(e,"front-to-back"===t?1:-1,r,n,i)},e.prototype.forEachInDepthRange=function(e,t,r,n,i,a,o,s){this._forEachInDepthRange(e,t,"front-to-back"===r?1:-1,n,i,a,o,s)},e.prototype.forEachNode=function(e){this._forEachNode(this._root,function(t){return e(t.node,t.center,2*t.halfSize)})},e.prototype._intersectsNode=function(e,t,r){return u(r.center,2*-r.halfSize,w),u(r.center,2*r.halfSize,C),s.rayBoxTest(e,t,w,C)},e.prototype._intersectsObject=function(e,t,r){var n=this._objectToBoundingSphere.getRadius(r);return!(n>0)||o.sphere.intersectsRay(o.sphere.wrap(n,this._objectToBoundingSphere.getCenter(r)),o.ray.wrap(e,t))},e.prototype._forEachNode=function(e,t){for(var r=m.acquire().init(e),n=[r];0!==n.length;){if(t(r=n.pop())&&!r.isLeaf())for(var i=0;i<r.node.children.length;i++){r.node.children[i]&&n.push(m.acquire().init(r).advance(i))}m.release(r)}},e.prototype._forEachNodeDepthOrdered=function(e,t,r,n){void 0===n&&(n=1);var i=m.acquire().init(e),a=[i];for(f(r,n,I);0!==a.length;){if(t(i=a.pop())&&!i.isLeaf())for(var o=7;o>=0;--o){var s=I.data[o];if(!(s>=i.node.children.length))i.node.children[s]&&a.push(m.acquire().init(i).advance(s))}m.release(i)}},e.prototype._findClosest=function(e,t,r,n,a){var o=this,s=1/0,l=1/0,c=null,u=p(e,t),f=0,v=function(i){if(++f,!n||n(i)){var a=o._objectToBoundingSphere.getCenter(i),u=o._objectToBoundingSphere.getRadius(i);if(!r||!d(a,u,r)){var p=h(e,t,a),v=p-u;v<s&&(s=v,l=p+u,c=i)}}};return this._forEachNodeDepthOrdered(this._root,function(n){if(null!=a&&f>=a)return!1;if(r&&d(n.center,n.halfSize*b,r))return!1;if(i.vec3.scale(S,u,n.halfSize),i.vec3.add(S,S,n.center),h(e,t,S)>l)return!1;var o=n.node;return o.terminals.forEach(function(e){v(e)}),null!==o.residents&&o.residents.forEach(function(e){v(e)}),!0},e,t),c},e.prototype._forEachInDepthRange=function(e,t,r,n,a,o,s,l){var c=this,u=-1/0,f=1/0,v={setRange:function(e){1===r?(u=Math.max(u,e.near),f=Math.min(f,e.far)):(u=Math.max(u,-e.far),f=Math.min(f,-e.near))}};v.setRange(n);var m=h(t,r,e),g=p(t,r),y=p(t,-1*r),x=0,_=function(e){if(++x,!s||s(e)){var n=c._objectToBoundingSphere.getCenter(e),i=c._objectToBoundingSphere.getRadius(e),l=h(t,r,n)-m;l-i>f||l+i<u||o&&d(n,i,o)||a(e,v)}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=l&&x>=l)return!1;if(o&&d(e.center,e.halfSize*b,o))return!1;if(i.vec3.scale(S,g,e.halfSize),i.vec3.add(S,S,e.center),h(t,r,S)-m>f)return!1;if(i.vec3.scale(S,y,e.halfSize),i.vec3.add(S,S,e.center),h(t,r,S)-m<u)return!1;var n=e.node;return n.terminals.forEach(function(e){_(e)}),null!==n.residents&&n.residents.forEach(function(e){_(e)}),!0},t,r)},e.prototype._objectOrObjectsArray=function(e){return Array.isArray(e)?e:(x[0]=e,x)},e.prototype._remove=function(e,t,r){P.clear();var n=r.advanceTo(t,function(e,t){P.push(e.node),P.push(t)})?r.node.terminals:r.node.residents;if(n.removeUnordered(e),0===n.length)for(var i=P.length-2;i>=0;i-=2){var a=P.data[i],o=P.data[i+1];if(!this._purge(a,o))break}},e.prototype._nodeIsEmpty=function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0},e.prototype._purge=function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new n({shrink:!0})),!0)},e.prototype._add=function(e,t){t.advanceTo(this._boundingSphereFromObject(e,E))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))},e.prototype._split=function(e){var t=e.node.residents;e.node.residents=null;for(var r=0;r<t.length;r++){var n=m.acquire().init(e);this._add(t.data[r],n),m.release(n)}},e.prototype._grow=function(e){var t=this;if(0!==e.length){var r=this._boundingSphereFromObjects(e,function(e,r){return t._boundingSphereFromObject(e,r)},T);if(this._isValidRadius(r.radius)&&!this._fitsInsideTree(r))if(this._nodeIsEmpty(this._root.node))i.vec3.copy(this._root.center,r.center),this._root.halfSize=1.25*r.radius;else{var n=m.acquire();this._rootBoundsForRootAsSubNode(r,n),this._placingRootViolatesMaxDepth(n)?this._rebuildTree(r,n):this._growRootAsSubNode(n),m.release(n)}}},e.prototype._rebuildTree=function(e,t){var r=this;i.vec3.copy(O.center,t.center),O.radius=t.halfSize;var n=this._boundingSphereFromObjects([e,O],function(e){return e},A),a=m.acquire().init(this._root);this._root.initFrom(null,n.center,1.25*n.radius),this._forEachNode(a,function(e){return r.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&r.add(e.node.residents.data,e.node.residents.length),!0}),m.release(a)},e.prototype._placingRootViolatesMaxDepth=function(e){var t=0;return this._forEachNode(this._root,function(e){return t=Math.max(t,e.depth),!0}),t+Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth},e.prototype._rootBoundsForRootAsSubNode=function(e,t){for(var r=e.radius,n=e.center,i=-1/0,a=this._root.center,o=this._root.halfSize,s=0;s<3;s++){var l=a[s]-o-(n[s]-r),c=n[s]+r-(a[s]+o),u=Math.max(0,Math.ceil(l/(2*o))),d=Math.max(0,Math.ceil(c/(2*o)))+1,f=Math.pow(2,Math.ceil(Math.log(u+d)*Math.LOG2E));i=Math.max(i,f),R[s].min=u,R[s].max=d}for(s=0;s<3;s++){var p=(i-((u=R[s].min)+(d=R[s].max)))/2;u+=Math.ceil(p),d+=Math.floor(p);var h=a[s]-o-u*o*2;_[s]=h+(d+u)*o}return t.initFrom(null,_,i*o,0)},e.prototype._growRootAsSubNode=function(e){var t=this._root.node;i.vec3.copy(T.center,this._root.center),T.radius=this._root.halfSize,this._root.init(e),e.advanceTo(T,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals},e.prototype._shrink=function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}},e.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,r=0,n=0;n<t.length&&null==e;)e=t[r=n++];for(;n<t.length;)if(t[n++])return-1;return r},e.prototype._isDegenerate=function(e){var t=this._objectToBoundingSphere.getRadius(e);return!this._isValidRadius(t)},e.prototype._isValidRadius=function(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0},e.prototype._fitsInsideTree=function(e){var t=this._root.center,r=this._root.halfSize,n=e.center;return e.radius<=r&&n[0]>=t[0]-r&&n[0]<=t[0]+r&&n[1]>=t[1]-r&&n[1]<=t[1]+r&&n[2]>=t[2]-r&&n[2]<=t[2]+r},e.prototype._boundingSphereFromObject=function(e,t){return i.vec3.copy(t.center,this._objectToBoundingSphere.getCenter(e)),t.radius=this._objectToBoundingSphere.getRadius(e),t},e.prototype._boundingSphereFromObjects=function(e,t,r){if(1===e.length){var n=t(e[0],T);i.vec3.copy(r.center,n.center),r.radius=n.radius}else{w[0]=1/0,w[1]=1/0,w[2]=1/0,C[0]=-1/0,C[1]=-1/0,C[2]=-1/0;for(var a=0;a<e.length;a++){n=t(e[a],T);this._isValidRadius(n.radius)&&(l(w,n.center,n.radius),c(C,n.center,n.radius))}i.vec3.lerp(r.center,w,C,.5),r.radius=Math.max(C[0]-w[0],C[1]-w[1],C[2]-w[2])/2}return r},e}(),m=function(){function e(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this.center=a.vec3f64.create(),this.initFrom(e,t,r,0)}return e.prototype.init=function(e){return this.initFrom(e.node,e.center,e.halfSize,e.depth)},e.prototype.initFrom=function(t,r,n,a){return void 0===t&&(t=null),void 0===n&&(n=this.halfSize),void 0===a&&(a=this.depth),this.node=t||e.createEmptyNode(),r&&i.vec3.copy(this.center,r),this.halfSize=n,this.depth=a,this},e.prototype.advance=function(t){var r=this.node.children[t];r||(r=e.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;var n=g[t];return this.center[0]+=n[0]*this.halfSize,this.center[1]+=n[1]*this.halfSize,this.center[2]+=n[2]*this.halfSize,this},e.prototype.advanceTo=function(e,t,r){for(void 0===r&&(r=!1);;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()&&!r)return t&&t(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var n=this._childIndex(e);t&&t(this,n),this.advance(n)}},e.prototype.isLeaf=function(){return null!=this.node.residents},e.prototype.isTerminalFor=function(e){return e.radius>this.halfSize/2},e.prototype._childIndex=function(e){for(var t=e.center,r=this.center,n=0,i=0;i<3;i++)r[i]<t[i]&&(n|=1<<i);return n},e.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new n({shrink:!0}),residents:new n({shrink:!0})}},e.acquire=function(){return e._pool.acquire()},e.release=function(t){e._pool.release(t)},e.clearPool=function(){e._pool.prune()},e._pool=new r(e),e}(),g=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(1,1,-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(1,-1,1),a.vec3f64.fromValues(-1,1,1),a.vec3f64.fromValues(1,1,1)],y=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(-1,1,1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(1,-1,1),a.vec3f64.fromValues(1,1,-1),a.vec3f64.fromValues(1,1,1)],b=Math.sqrt(3),x=[null],_=a.vec3f64.create(),S=a.vec3f64.create(),w=a.vec3f64.create(),C=a.vec3f64.create(),P=new n,E={center:a.vec3f64.create(),radius:0},T={center:a.vec3f64.create(),radius:0},O={center:a.vec3f64.create(),radius:0},A={center:a.vec3f64.create(),radius:0},R=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],M=new n,I=new n;return v}.apply(null,n))||(e.exports=i)},meB3:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){this.sharedResources=null,this.streamDataSupplier=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.layerOrder=null,this.layerOrderDelta=null,this.clippingExtent=null,this.renderSpatialReference=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.layerView=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.isAsync=!1};t.Graphics3DSymbolCreationContext=r}.apply(null,n))||(e.exports=i)},nBma:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("/Bau"),r("pBV3"),r("CIy2"),r("1CCn"),r("qbr3"),r("Kfys")],void 0===(i=function(e,t,r,n,i,a,o,s){var l=function(){function e(e,t){this.dimensions={width:4,height:4},this._enabled=!1,this._background={type:"color",color:[0,0,0,1]},this._compositePipelineState=new Map,this._rctx=t,this.renderTargetHelper=new n.RenderTargetHelper(t);var r=this.renderTargetHelper;this.mainColor=r.registerColorTarget({name:"mainColor"}),this.mainDepth=r.registerDepthTarget({name:"mainDepth"}),this.linearDepth=r.registerColorTarget({name:"linearDepth"}),this.normal=r.registerColorTarget({name:"normal"}),this.highlight=r.registerColorTarget({name:"highlight",dataType:32819}),this.hudVisibility=r.registerColorTarget({name:"hudVisibility",dataType:32819}),this.tmpColor=r.registerColorTarget({name:"tmpColor"}),this.tmpDepth=r.registerDepthTarget({name:"tmpDepth"}),this._compositeProgram=e.getProgram(a.composite),this._compositePipelineState.set("none",o.makePipelineState({colorWrite:o.defaultColorWriteParams})),this._compositePipelineState.set("alpha",o.makePipelineState({blending:o.separateBlendingParams(770,1,771,771),colorWrite:o.defaultColorWriteParams})),this._compositePipelineState.set("premultiplied-alpha",o.makePipelineState({blending:o.simpleBlendingParams(1,771),colorWrite:o.defaultColorWriteParams})),this._compositeTransparentToHUDVisibilityProgram=e.getProgram(a.compositeTransparentToHUDVisibility),this._compositeTransparentToHUDVisibilityPipelineState=o.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}}),this._compositeOccludedProgram=e.getProgram(a.compositeOccluded),this._compositeOccludedPipelineState=o.makePipelineState({blending:o.simpleBlendingParams(1,771),colorWrite:o.defaultColorWriteParams})}return Object.defineProperty(e.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e?this.enable():this.disable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"background",{get:function(){return this._background},set:function(e){this._background=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTexture",{get:function(){return this.framebuffer.depthStencilTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"highlightTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tmpColorTexture",{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!0,configurable:!0}),e.prototype.initializeFrame=function(e,t){i.assert(this.enabled);var r=this._rctx;this.dimensions.width=e.fullWidth,this.dimensions.height=e.fullHeight,this.outputFramebuffer=t,this.bindTarget(this.mainColor,this.mainDepth),r.setClearStencil(0);var n=this._background.color;r.setClearColor(n[0]*n[3],n[1]*n[3],n[2]*n[3],n[3]),r.clearSafe(17664)},e.prototype.renderSeparateAndComposite=function(e,t,r){void 0===t&&(t=c),void 0===r&&(r=u),this.renderToTargets(e,this.tmpColor,this.mainDepth,t),this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,r)},e.prototype.renderHUDVisibility=function(e){this.renderToTargets(e,this.hudVisibility,this.mainDepth,d)},e.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var e=this,t=this._rctx;this.renderToTargets(function(){var r=e._compositeTransparentToHUDVisibilityProgram;t.bindProgram(r),t.setPipelineState(e._compositeTransparentToHUDVisibilityPipelineState),r.setUniform1i("tex",1),t.bindTexture(e.getColorTexture(e.tmpColor),1),t.bindVAO(e.quadVAO),t.drawArrays(5,0,s.vertexCount(e.quadVAO,"geometry"))},this.hudVisibility,this.mainDepth)},e.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")},e.prototype.compositeOccludedOntoMain=function(e){var t=this._rctx,r=this._compositeOccludedProgram;this.bindFramebuffer(),t.bindProgram(r),t.setPipelineState(this._compositeOccludedPipelineState),t.bindVAO(this.quadVAO),t.bindTexture(this.getColorTexture(this.tmpColor),0),r.setUniform1i("occludedColorMap",0),r.setUniform1f("opacity",e),t.drawArrays(5,0,s.vertexCount(this.quadVAO,"geometry")),t.bindVAO(null)},e.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)},e.prototype.renderDepthDetached=function(e){e(this.bindTarget(this.mainColor)),this.bindTarget(this.mainColor,this.mainDepth)},e.prototype.composite=function(e,t,r){void 0===e&&(e=this.framebuffer.colorTexture),void 0===t&&(t=this.outputFramebuffer),void 0===r&&(r=u);var n=this._rctx,i=this._compositeProgram;n.bindFramebuffer(t),n.bindProgram(i),n.setPipelineState(this._compositePipelineState.get(r)),i.setUniform1i("tex",1),n.bindTexture(e,1),n.bindVAO(this.quadVAO),n.drawArrays(5,0,s.vertexCount(this.quadVAO,"geometry"))},e.prototype.disposeTarget=function(e){this.renderTargetHelper.disposeTargetResource(e)},e.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=r.createQuadVAO(this._rctx))},e.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)},e.prototype.renderToTargets=function(e,t,r,n,i){var a=this._rctx,o=this.bindTarget(t,r),s=0;if(n){var l=Math.max(1e-13,n[3]);a.setClearColor(n[0],n[1],n[2],l),s|=16384}return i&&(s|=256),a.clearSafe(s),e(o),a.gl.flush(),this.bindTarget(this.mainColor,this.mainDepth),o},e.prototype.bindTarget=function(e,t){var r=this.renderTargetHelper.getFramebuffer(this.dimensions,e,t);return this._rctx.bindFramebuffer(r),r},e.prototype.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)},e.prototype.getGpuMemoryUsage=function(){var e=0;return this.renderTargetHelper&&(e+=this.renderTargetHelper.getGpuMemoryUsage()),e},e}(),c=[0,0,0,0],u="none",d=[0,1,0,1];return l}.apply(null,n))||(e.exports=i)},o5p5:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("2B1V"),r("tUyH"),r("FNtW"),r("CIy2"),r("hnAi"),r("s6rJ"),r("ZeO9"),r("FMAd"),r("qbr3")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d){var f=function(e){function t(t,r){var n=e.call(this,r)||this;return n.supportsEdges=!0,n.params=l.copyParameters(t,v),n}return r(t,e),t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)t[r]=e[r];this.notifyDirty("matChanged")},t.prototype.getParameters=function(){return this.params},t.prototype.setColor=function(e){this.params.color=e,this.notifyDirty("matChanged")},t.prototype.getColor=function(){return this.params.color},t.prototype.setTransparent=function(e){this.params.transparent=e,this.notifyDirty("matChanged")},t.prototype.getTransparent=function(){return this.params.transparent},t.prototype.intersect=function(e,t,r,n,i,a,o,s,c){l.intersectTriangleGeometry(e,t,r,n,i,a,o,c)},t.prototype.getGLMaterials=function(){return{color:p,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:h}},t.prototype.getAllTextureIds=function(){return[]},t.prototype.createBufferWriter=function(){return new g},t.prototype.createRenderer=function(e,t){return new c(e,t,this)},t}(a),p=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=l.copyParameters(this.material.getParameters()),this.selectProgram()},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(u.colorPass,{vertexColors:e.vertexColors,slice:e.slicePlaneEnabled}),this.pipelineState=d.makePipelineState({blending:e.transparent&&d.separateBlendingParams(770,1,771,771),polygonOffset:e.polygonOffset&&y,culling:b(e.cullFace),depthTest:e.testDepth&&{func:513},depthWrite:e.writeDepth&&d.defaultDepthWriteParams,colorWrite:d.defaultColorWriteParams})},t.prototype.beginSlot=function(e){var t=4;return this.params.transparent&&(t=this.params.writeDepth?6:9),e===t},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),e.setPipelineState(this.pipelineState),r.setUniform4fv("eColor",n.color)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params;l.bindView(t.origin,t.view,r),n.slicePlaneEnabled&&l.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 4},t}(i),h=function(e){function t(t,r,n){var i=e.call(this,t,r)||this;return i.updateParameters(),i}return r(t,e),t.prototype.updateParameters=function(){this.params=l.copyParameters(this.material.getParameters()),this.selectProgram()},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(u.colorPass,{vertexColors:e.vertexColors,slice:e.slicePlaneEnabled}),this.pipelineState=d.makePipelineState({polygonOffset:e.polygonOffset&&y,culling:b(e.cullFace),depthTest:e.testDepth&&{func:513},depthWrite:e.writeDepth&&d.defaultDepthWriteParams,colorWrite:d.defaultColorWriteParams})},t.prototype.beginSlot=function(e){return 4===e},t.prototype.getProgram=function(){return this.program},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),e.setPipelineState(this.pipelineState),l.bindHighlightRendering(e,t,r),r.setUniform4fv("eColor",n.color)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params;l.bindView(t.origin,t.view,r),n.slicePlaneEnabled&&l.bindSlicePlane(t.origin,t.slicePlane,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return 4},t}(i),v={color:[1,1,1,1],transparent:!1,writeDepth:!0,testDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:"none"},m=n.newLayout().vec3f(o.VertexAttrConstants.POSITION).vec4u8(o.VertexAttrConstants.COLOR),g=function(){function e(){this.vertexBufferLayout=m}return e.prototype.allocate=function(e){return m.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices[o.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,n,i){s.writeDefaultAttributes(t,r,m,e.transformation,e.invTranspTransformation,n,i)},e}(),y={factor:1,units:1},b=function(e){return"none"!==e&&{face:"front"===e?1028:1029,mode:2305}};return f}.apply(null,n))||(e.exports=i)},ocJ8:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qMld"),r("vtMp"),r("1xFi")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,a=e.layer.fullExtent,o=a&&a.spatialReference;return o?o.equals(t)?r.resolve(a.clone()):n.canProject(o,t)?r.resolve(n.project(a,t)):e.view.state.isLocal?i.projectGeometry(a,t,e.layer.portalItem).then(function(t){if(!e.destroyed&&t)return t}).catch(function(){return null}):r.resolve(null):r.resolve(null)}}.apply(null,n))||(e.exports=i)},p23x:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.applyToModelMatrix=function(e,t){var r=t,n=-e[0],i=-e[1],a=-e[2],o=r[3],s=r[7],l=r[11],c=r[15];r[0]+=o*n,r[1]+=o*i,r[2]+=o*a,r[4]+=s*n,r[5]+=s*i,r[6]+=s*a,r[8]+=l*n,r[9]+=l*i,r[10]+=l*a,r[12]+=c*n,r[13]+=c*i,r[14]+=c*a},t.applyToViewMatrix=function(e,t){var r=t,n=e[0],i=e[1],a=e[2];r[12]+=n*r[0]+i*r[4]+a*r[8],r[13]+=n*r[1]+i*r[5]+a*r[9],r[14]+=n*r[2]+i*r[6]+a*r[10],r[14]+=n*r[3]+i*r[7]+a*r[11]}}.apply(null,n))||(e.exports=i)},pBV3:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("/f24"),r("Rrc3"),r("Zp3t"),r("Kfys")],void 0===(i=function(e,t,r,n,i,a,o){Object.defineProperty(t,"__esModule",{value:!0});var s={dataType:5121},l={},c=function(){function e(e){this.rctx=e,this.activeTargets=new Set,this.depthTextures=new Map,this.depthBuffers=new Map,this.colorTextures=new Map,this.framebuffers=new Map,this.nextId=1,this.depthTextureSupported=e.capabilities.depthTexture}return e.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(e){return e.dispose()}),this.depthBuffers.clear(),this.depthTextures.forEach(function(e){return e.dispose()}),this.depthTextures.clear(),this.colorTextures.forEach(function(e){return e.dispose()}),this.colorTextures.clear()},e.prototype.disposeTargetResource=function(e){var t=e.id;this.activeTargets.has(t)&&(this.activeTargets.delete(t),this.depthTextures.has(t)&&(this.depthTextures.get(t).dispose(),this.depthTextures.delete(t)),this.depthBuffers.has(t)&&(this.depthBuffers.get(t).dispose(),this.depthBuffers.delete(t)),this.colorTextures.has(t)&&(this.colorTextures.get(t).dispose(),this.colorTextures.delete(t)))},e.prototype.getDepthTexture=function(e,t){if(this.depthTextureSupported){var r=this.depthTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new a(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height}),this.depthTextures.set(e.id,r),this.activeTargets.add(e.id)),r}},e.prototype.getDepthBuffer=function(e,t){if(!this.depthTextureSupported){var n=this.depthBuffers.get(e.id);return n?n.descriptor.width===t.width&&n.descriptor.height===t.height||n.resize(t.width,t.height):(n=new i(this.rctx,r({internalFormat:34041},t)),this.depthBuffers.set(e.id,n),this.activeTargets.add(e.id)),n}},e.prototype.getColorTexture=function(e,t){var r=this.colorTextures.get(e.id);return r&&(r.descriptor.width===t.width&&r.descriptor.height===t.height||(r.dispose(),r=void 0)),r||(r=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:e.dataType,samplingMode:9729,wrapMode:33071,width:t.width,height:t.height}),this.colorTextures.set(e.id,r),this.activeTargets.add(e.id)),r},e.prototype.getAllocatedColorTexture=function(e){return this.colorTextures.get(e.id)},e.prototype.registerDepthTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},l,e)},e.prototype.registerColorTarget=function(e){void 0===e&&(e={});var t=this.nextId++;return r({id:t},s,e)},e.prototype.getFramebuffer=function(e,t,r){var i=this.getKey(t,r),a=this.framebuffers.get(i),o=this.getColorTexture(t,e);if(this.depthTextureSupported){var s=r?this.getDepthTexture(r,e):void 0;return a?((a.width!==e.width||a.height!==e.height||a.colorTexture!==o||a.depthStencilTexture!==s)&&(a.detachColorTexture(),a.detachDepthStencilTexture(),a.resize(e.width,e.height),a.attachColorTexture(o),a.attachDepthStencilTexture(s)),a):(a=r?n.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:4},s):n.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(i,a),a)}var l=r?this.getDepthBuffer(r,e):void 0;return a?((a.width!==e.width||a.height!==e.height||a.colorTexture!==o)&&(a.detachColorTexture(),a.detachDepthStencilBuffer(),a.resize(e.width,e.height),a.attachColorTexture(o),a.attachDepthStencilBuffer(l)),a):(a=n.createWithAttachments(this.rctx,o,{colorTarget:0,depthStencilTarget:r?3:0},l),this.framebuffers.set(i,a),a)},e.prototype.getKey=function(e,t){return e.id+"_"+(t?t.id:"X")+"_"+e.name+(t?"_"+t.name:"")},e.prototype.getGpuMemoryUsage=function(){var e=0,t=new Set,r=function(r){t.has(r)||(t.add(r),e+=o.getGpuMemoryUsage(r))};return this.depthTextures.forEach(r),this.colorTextures.forEach(r),this.depthBuffers.forEach(r),this.framebuffers.forEach(r),e},e}();t.RenderTargetHelper=c}.apply(null,n))||(e.exports=i)},pIuP:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=9;var a=this.TypedArrayConstructor;void 0===n&&(n=9*a.BYTES_PER_ELEMENT);var o=0===t.byteLength?0:r;this.typedBuffer=null==i?new a(t,o):new a(t,o,(i-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.getMat=function(e,t){for(var r=e*this.typedBufferStride,n=0;n<9;n++)t[n]=this.typedBuffer[r+n];return t},e.prototype.setMat=function(e,t){for(var r=e*this.typedBufferStride,n=0;n<9;n++)this.typedBuffer[r+n]=t[n]},e.prototype.get=function(e,t){return this.typedBuffer[e*this.typedBufferStride+t]},e.prototype.set=function(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r},e.prototype.copyFrom=function(e,t,r){for(var n=this.typedBuffer,i=t.typedBuffer,a=e*this.typedBufferStride,o=r*t.typedBufferStride,s=0;s<9;++s)n[a+s]=i[o+s]},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=9,e}();t.BufferViewMat3Impl=r}.apply(null,n))||(e.exports=i)},pN8M:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.treeParamsTable={Alder_Buckthorn:{center:[0,0,2.5],radius:[2,2,3.5]},American_Chestnut:{center:[0,0,12],radius:[10,10,10]},American_Sycamore:{center:[0,0,16],radius:[6.3,6.3,11.5]},Apricot:{center:[0,0,5],radius:[4.5,4.5,4]},Australian_Pine:{center:[0,0,8],radius:[3,3,11.5]},Baldcypress:{center:[0,0,11.5],radius:[4.2,4.2,16.5]},Balsam_Fir:{center:[0,0,2.9],radius:[3,3,9.7]},Basswood:{center:[0,0,19],radius:[9,9,11]},Bay_Laurel:{center:[0,0,1.4],radius:[.6,.6,2.7]},Black_Locust:{center:[0,0,15],radius:[9.5,9.5,9.5]},Blue_Gum_Eucalyptus:{center:[0,0,12],radius:[5,5,10]},Boxwood:{center:[0,0,.5],radius:[.3,.3,.5]},California_Bay:{center:[0,0,16],radius:[9,9,9.6]},California_Incense_Cedar:{center:[0,0,6.6],radius:[3.8,3.8,14]},California_Redwood:{center:[0,0,55],radius:[6.5,6.5,19]},California_Walnut:{center:[0,0,5.3],radius:[5,5,4.5]},Common_Hawthorn:{center:[0,0,2.8],radius:[1.9,1.9,2.8]},Common_Whitebeam:{center:[0,0,4.5],radius:[2.5,2.5,3.5]},Conker_Tree:{center:[0,0,10],radius:[6,6,10]},Desert_Willow:{center:[0,0,3],radius:[2.4,2.4,2.8]},Douglas_Fir:{center:[0,0,40],radius:[4.5,4.5,22]},European_Beech:{center:[0,0,12],radius:[7.5,7.5,11.5]},European_Larch:{center:[0,0,9],radius:[3,3,9]},Ficus:{center:[0,0,10],radius:[12,12,18.5]},Field_Elm:{center:[0,0,12.5],radius:[10,10,9.5]},Flannelbush:{center:[0,0,0],radius:[1.3,1.3,1.7]},Flowering_Dogwood:{center:[0,0,2.5],radius:[2.4,2.4,3]},Generic_Unknown:{center:[0,0,11.5],radius:[5,5,6.5]},Giant_Sequoia:{center:[0,0,35.5],radius:[11,11,26]},Japanese_Angelica_Tree:{center:[0,0,3.8],radius:[2.8,2.8,2]},Leyland_Cypress:{center:[0,0,2.8],radius:[1,1,4]},Lodgepole_Pine:{center:[0,0,23.25],radius:[4.7,4.7,19]},Mediterranean_Buckthorn:{center:[0,0,1.5],radius:[1.2,1.2,2.5]},Mountain_Mahogany:{center:[0,0,2],radius:[1.3,1.3,1.5]},Northern_Red_Oak:{center:[0,0,11.5],radius:[7.2,7.2,9]},Norway_Maple:{center:[0,0,12.2],radius:[6,6,8.2]},Norway_Spruce:{center:[0,0,5],radius:[6.5,6.5,20]},Oval_Leaved_Privet:{center:[0,0,0],radius:[.45,.45,2.95]},Palo_Verde:{center:[0,0,4.25],radius:[4,4,2.75]},Paper_Birch:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Alder:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Hickory:{center:[0,0,9],radius:[4.5,4.5,7.5]},Rhododendron_Azaleas:{center:[0,0,.55],radius:[.4,.4,.35]},Rose:{center:[0,0,.55],radius:[.45,.45,.55]},Ruffle_Palm:{center:[0,0,6.4],radius:[3,3,3]},Sassafras:{center:[0,0,8],radius:[3,3,7]},Scots_Pine:{center:[0,0,18],radius:[3,3,9]},Shadbush:{center:[0,0,1.5],radius:[1.5,1.5,1.5]},Southern_Magnolia:{center:[0,0,10.5],radius:[5.5,5.5,8]},Spanish_Broom:{center:[0,0,1.5],radius:[2.5,2.5,1.5]},Strawberry_Tree:{center:[0,0,4],radius:[2.8,2.8,3.3]},Sugar_Maple:{center:[0,0,8],radius:[4.5,4.5,7]},Sweetgum:{center:[0,0,8],radius:[4,4,6.5]},Umbrella_Acacia:{center:[0,0,10.8],radius:[15,15,6.8]},Western_Juniper:{center:[0,0,3.2],radius:[2.5,2.5,7]},White_Ash:{center:[0,0,14.5],radius:[9.5,9.5,11]},White_Oak:{center:[0,0,15],radius:[14,14,14]},White_Poplar:{center:[0,0,10],radius:[4.3,4.3,8.2]},White_Willow:{center:[0,0,12],radius:[8.9,8.9,9]},Witch_Hazel:{center:[0,0,1.5],radius:[1.5,1.5,2]}},t.lodThresholdLUT={Alder_Buckthorn:{thresholds:[2,65.698,384.294],vertexCounts:[18,2034,8220]},Amazon_Sword_Plant:{thresholds:[2,22.848,88.819,200.491],vertexCounts:[18,246,888,3246]},American_Chestnut:{thresholds:[2,27.57,59.244,360.286],vertexCounts:[18,444,1782,10332]},American_Sycamore:{thresholds:[2,60.765,228.586],vertexCounts:[18,1740,8562]},Apricot:{thresholds:[2,33.695,132.332],vertexCounts:[18,1776,10626]},Australian_Pine:{thresholds:[2,131.057],vertexCounts:[18,8094]},Baldcypress:{thresholds:[2,31.791,212.226],vertexCounts:[18,1638,10164]},Balsam_Fir:{thresholds:[2,64.674],vertexCounts:[18,10266]},Bamboo:{thresholds:[2,22.347,90.113,213.818],vertexCounts:[18,216,978,7740]},Banana_Tree:{thresholds:[2,28.096,88.837,345.976],vertexCounts:[18,372,1986,10743]},Basswood:{thresholds:[2,59.387,199.555],vertexCounts:[18,1662,7998]},Bay_Laurel:{thresholds:[2,28.653,204.352],vertexCounts:[18,1728,10938]},Black_Locust:{thresholds:[2,28.546,88.164,229.447],vertexCounts:[18,384,1638,9768]},Blue_Gum_Eucalyptus:{thresholds:[2,56.98,201.358],vertexCounts:[18,1530,9762]},Boxwood:{thresholds:[2,28.768,62.215,191.034],vertexCounts:[18,390,1824,9876]},Cabbage_Palm_Fern:{thresholds:[2,26.932,215.221],vertexCounts:[18,150,1314]},California_Bay:{thresholds:[2,30.627,204.223],vertexCounts:[18,1878,9054]},California_Incense_Cedar:{thresholds:[2,30.533,197.262],vertexCounts:[18,1644,11214]},California_Palm:{thresholds:[2,30.538,210.616],vertexCounts:[18,612,5760]},California_Redwood:{thresholds:[2,110.805],vertexCounts:[18,10260]},California_Walnut:{thresholds:[2,26.702,64.525,199.228],vertexCounts:[18,336,1962,10992]},Coconut_Palm:{thresholds:[2,21.77,63.23,199.556],vertexCounts:[18,402,1884,9240]},Common_Hawthorn:{thresholds:[2,45.588,205.35],vertexCounts:[18,300,9492]},Common_Whitebeam:{thresholds:[2,56.42,186.382],vertexCounts:[18,2142,10524]},Conker_Tree:{thresholds:[2,25.977,58.524,195.139],vertexCounts:[18,318,1614,8886]},Date_Palm:{thresholds:[2,31.107,67.609,186.723],vertexCounts:[18,456,2154,9054]},Desert_Willow:{thresholds:[2,29.425,59.815,203.238],vertexCounts:[18,408,1686,9720]},Douglas_Fir:{thresholds:[2,69.576],vertexCounts:[18,8544]},European_Beech:{thresholds:[2,29.854,201.521],vertexCounts:[18,420,7572]},European_Larch:{thresholds:[2,65.346],vertexCounts:[18,10314]},Ficus:{thresholds:[2,28.768,58.849,210.62],vertexCounts:[18,390,1632,7728]},Field_Elm:{thresholds:[2,34.435,192.436],vertexCounts:[18,1746,10950]},Flannelbush:{thresholds:[2,27.408,55.566,196.843],vertexCounts:[18,354,1455,8706]},Flowering_Dogwood:{thresholds:[2,28.768,194.687],vertexCounts:[18,390,8664]},Generic_Dead_Tree:{thresholds:[2,67.891],vertexCounts:[18,2172]},Generic_Stump:{thresholds:[2,19.544,57.757,171.552],vertexCounts:[18,180,1572,2634]},Generic_Unknown:{thresholds:[2,32.379,221.987],vertexCounts:[18,1572,9006]},Giant_Sequoia:{thresholds:[2,30.664,204.84],vertexCounts:[18,2160,8232]},Hedgehog_Agave:{thresholds:[2,28.546,96.141,228.435],vertexCounts:[18,384,1980,11094]},Japanese_Angelica_Tree:{thresholds:[2,25.482,61.287,202.909],vertexCounts:[18,306,1770,7806]},Lacy_Tree_Philodendron:{thresholds:[2,28.768,62.974,231.634],vertexCounts:[18,390,1752,10227]},Leyland_Cypress:{thresholds:[2,66.246],vertexCounts:[18,10182]},Lily_Of_The_Valley:{thresholds:[2,28.322,55.738,198.232],vertexCounts:[18,378,1464,4152]},Scots_Pine:{thresholds:[2,60.554],vertexCounts:[18,7524]},Mediterranean_Buckthorn:{thresholds:[2,31.82,211.856],vertexCounts:[18,2196,9030]},Mexican_Palmetto:{thresholds:[2,29.425,68.358,212.659],vertexCounts:[18,408,2202,10194]},Mountain_Mahogany:{thresholds:[2,31.199,198.614],vertexCounts:[18,1614,8094]},White_Oak:{thresholds:[2,15.204,33.801,129.392],vertexCounts:[18,372,1674,9222]},Sugar_Maple:{thresholds:[2,28.322,59.495,216.901],vertexCounts:[18,378,1668,9462]},Norway_Spruce:{thresholds:[2,63.101],vertexCounts:[18,9630]},Orchid:{thresholds:[2,30.383,63.93,198.664],vertexCounts:[18,435,1926,8346]},Other:{thresholds:[2,30.504,194.487],vertexCounts:[18,1572,9006]},Oval_Leaved_Privet:{thresholds:[2,59.468],vertexCounts:[18,9162]},Palm_Lily:{thresholds:[2,57.977,200.406],vertexCounts:[18,1584,8112]},Palo_Verde:{thresholds:[2,65.31,198.124],vertexCounts:[18,2010,7668]},Paper_Birch:{thresholds:[2,117.074],vertexCounts:[18,10578]},Parlour_Palm:{thresholds:[2,30.695,60.974,194.832],vertexCounts:[18,444,1752,8388]},Prickly_Pear_Cactus:{thresholds:[2,28.657,66.946,214.478],vertexCounts:[18,387,2112,11028]},Red_Alder:{thresholds:[2,30.518,192.513],vertexCounts:[18,1770,8274]},Red_Hickory:{thresholds:[2,31.604,192.085],vertexCounts:[18,1680,7908]},Rhododendron_Azaleas:{thresholds:[2,47.068,192.681],vertexCounts:[18,1044,8160]},Rose:{thresholds:[2,66.085,212.061],vertexCounts:[18,2058,10968]},Ruffle_Palm:{thresholds:[2,64.994],vertexCounts:[18,9534]},Saguaro_Cactus:{thresholds:[2,34.779,56.703,197.566],vertexCounts:[18,570,1050,1992]},Sassafras:{thresholds:[2,110.697],vertexCounts:[18,10944]},Sea_Islands_Yucca:{thresholds:[2,61.287,219.899],vertexCounts:[18,1770,10176]},Shadbush:{thresholds:[2,26.702,64.03,201.856],vertexCounts:[18,336,1932,9030]},Snake_Plant:{thresholds:[2,23.803,68.265,193.203],vertexCounts:[18,267,2196,5280]},Southern_Magnolia:{thresholds:[2,63.431,212.165],vertexCounts:[18,1896,8472]},Spanish_Broom:{thresholds:[2,29.854,192.889],vertexCounts:[18,420,7896]},Strawberry_Tree:{thresholds:[2,16.772,32.081,186.987],vertexCounts:[18,300,1560,8148]},Sunflower:{thresholds:[2,28.768,66.373,194.987],vertexCounts:[18,390,2076,7902]},Sweetgum:{thresholds:[2,31.436,201.223],vertexCounts:[18,1848,7674]},Umbrella_Acacia:{thresholds:[2,62.137],vertexCounts:[18,8880]},Western_Juniper:{thresholds:[2,62.683],vertexCounts:[18,9120]},White_Ash:{thresholds:[2,33.326,192.138],vertexCounts:[18,2070,10542]},White_Poplar:{thresholds:[2,30.615,196.71],vertexCounts:[18,1530,9888]},White_Willow:{thresholds:[2,62.983],vertexCounts:[18,10422]},Witch_Hazel:{thresholds:[2,26.463,66.277,200.916],vertexCounts:[18,330,2070,10386]},ATM:{thresholds:[2,46.933],vertexCounts:[150,1038]},Bus_Stop_1:{thresholds:[2,42.67],vertexCounts:[150,858]},Bus_Stop_2:{thresholds:[2,46.112],vertexCounts:[138,1002]},Dumpster:{thresholds:[2,48.006],vertexCounts:[138,1086]},Newspaper_Vending_Machine:{thresholds:[2,57.203],vertexCounts:[144,1542]},Overhanging_Sidewalk_Light_Off:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Sidewalk_Light_On:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Street_And_Sidewalk_Light_Off:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_And_Sidewalk_Light_On:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_Light_Off:{thresholds:[2,34.225],vertexCounts:[144,552]},Overhanging_Street_Light_On:{thresholds:[2,34.225],vertexCounts:[144,552]},Park_Bench_1:{thresholds:[2,23.669],vertexCounts:[96,264]},Park_Bench_2:{thresholds:[2,44.71],vertexCounts:[144,942]},Park_Bench_3:{thresholds:[2,41.917],vertexCounts:[120,828]},Park_Bench_4:{thresholds:[2,69.923],vertexCounts:[144,2304]},Payphone:{thresholds:[2,58.524],vertexCounts:[156,1614]},Picnic_Table:{thresholds:[2,35.504],vertexCounts:[90,594]},Planter_Circular:{thresholds:[2,99.368],vertexCounts:[153,4653]},Planter_Square:{thresholds:[2,65.212],vertexCounts:[150,2004]},Planter_Tapered:{thresholds:[2,89.669],vertexCounts:[141,3789]},Rock_1:{thresholds:[2,28.768,50.463],vertexCounts:[132,390,1200]},Rock_2:{thresholds:[2,43.556,73.127],vertexCounts:[150,894,2520]},Rock_3:{thresholds:[2,37.931,70.286],vertexCounts:[144,678,2328]},Rock_4:{thresholds:[2,41.613,70.738],vertexCounts:[150,816,2358]},Street_Light_Off:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Street_Light_On:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Traffic_Barrier_2:{thresholds:[2,42.819],vertexCounts:[132,864]},Trash_Bin_1:{thresholds:[2,50.019],vertexCounts:[132,1179]},Trash_Bin_2:{thresholds:[2,36.038,63.028],vertexCounts:[108,612,1872]},Trash_Bin_3:{thresholds:[2,42.371,64.03],vertexCounts:[102,846,1932]},Trash_Can_1:{thresholds:[2,58.524,98.628],vertexCounts:[150,1614,4584]},Trash_Can_2:{thresholds:[2,53.166],vertexCounts:[84,1332]},US_Mailbox:{thresholds:[2,48.402],vertexCounts:[156,1104]},Ambulance:{thresholds:[2,67.121,343.733],vertexCounts:[294,3285,13758]},Audi_A6:{thresholds:[2,63.823,484.156],vertexCounts:[300,4311,14280]},Backhoe:{thresholds:[2,60.173,391.986],vertexCounts:[453,5895,14679]},BMW_3Series:{thresholds:[2,68.886,417.563],vertexCounts:[294,4188,14727]},Bobcat:{thresholds:[2,61.105,269.127],vertexCounts:[438,4476,14952]},Bus:{thresholds:[2,63.803,402.682],vertexCounts:[300,4398,14988]},Crane:{thresholds:[2,65.969,386.67],vertexCounts:[438,4497,14487]},Dumptruck:{thresholds:[2,66.91,354.365],vertexCounts:[456,6294,14052]},Eurocopter_AS365:{thresholds:[2,227.817],vertexCounts:[432,14733]},Eurocopter_AS365_Flying:{thresholds:[2,96.244,380.211],vertexCounts:[306,4365,10575]},Eurocopter_H125:{thresholds:[2,96.567,378.995],vertexCounts:[438,4440,14763]},Eurocopter_H125_Flying:{thresholds:[2,94.002,366.378],vertexCounts:[294,4164,13569]},Firetruck:{thresholds:[2,65.762,383.645],vertexCounts:[276,4482,14901]},Ford_Edge:{thresholds:[2,68.763,419.635],vertexCounts:[294,4368,14733]},Ford_Expedition:{thresholds:[2,62.994,388.251],vertexCounts:[276,4410,14868]},Ford_F150:{thresholds:[2,60.495,394.682],vertexCounts:[300,4950,14988]},Ford_Fiesta:{thresholds:[2,64.994,355.46],vertexCounts:[282,4185,14223]},Ford_Focus_Hatchback:{thresholds:[2,62.072,387.932],vertexCounts:[300,4470,14925]},Ford_Fusion:{thresholds:[2,64.485,370.289],vertexCounts:[294,4500,14955]},Ford_Mustang:{thresholds:[2,64.812,351.721],vertexCounts:[288,4197,14574]},Ford_Taurus:{thresholds:[2,67.461,379.324],vertexCounts:[282,4404,15042]},Ford_Transit_Commercial_Van:{thresholds:[2,88.6,384.491],vertexCounts:[276,4443,14721]},Ford_Transit_Connect:{thresholds:[2,67.006,336.74],vertexCounts:[258,4344,14328]},Mercedes_SClass:{thresholds:[2,66.188,349.491],vertexCounts:[300,4377,14721]},Motorboat:{thresholds:[2,67.436,364.325],vertexCounts:[315,4491,14958]},Motorcycle:{thresholds:[2,35.435,357.215],vertexCounts:[294,4806,14865]},Police_Car:{thresholds:[2,68.116,350.794],vertexCounts:[294,3987,14580]},Porsche_Boxter:{thresholds:[2,67.717,361.95],vertexCounts:[312,6225,14676]},Porsche_Carrera:{thresholds:[2,66.588,392.685],vertexCounts:[306,4473,14571]},Sailboat:{thresholds:[2,97.329,383.075],vertexCounts:[294,4464,14937]},Sailboat_Sails_Up:{thresholds:[2,97.46,360.432],vertexCounts:[300,4476,14967]},Taxi:{thresholds:[2,64.415,381.491],vertexCounts:[300,4305,14721]},Taxi_Van:{thresholds:[2,64.614,364.475],vertexCounts:[288,4341,11949]},Tesla_P7:{thresholds:[2,58.155],vertexCounts:[300,16062]},Tower_Crane:{thresholds:[2,106.34,419.821],vertexCounts:[432,4488,14832]},Toyota_Prius:{thresholds:[2,66.448,357.251],vertexCounts:[288,4266,14370]},Tram:{thresholds:[2,65.43,369.937],vertexCounts:[420,5610,19605]},Volkswagen_Jetta_Wagon:{thresholds:[2,65.925,354.416],vertexCounts:[294,4443,14466]},Traffic_Light_1:{thresholds:[2,75.315],vertexCounts:[135,2673]},Traffic_Light_3:{thresholds:[2,49.12],vertexCounts:[132,1137]},Traffic_Light_4:{thresholds:[2,70.962,115.735],vertexCounts:[96,2373,6312]}}}.apply(null,n))||(e.exports=i)},pbva:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("1m5D")],void 0===(i=function(e,t,r,n){return function(e,t,i,a,o,s,l,c,u){this.name=e,this.from=t,this.to=i,this.displayedIndexRange=a,this.highlightedIndexRanges=o,this.transformation=s,this.instanceParameters=l,this.idx=c,this.dataId=u,null!=s&&(this.transformationNormal=n.mat4f64.clone(s),r.mat4.invert(this.transformationNormal,this.transformationNormal),r.mat4.transpose(this.transformationNormal,this.transformationNormal))}}.apply(null,n))||(e.exports=i)},pgjK:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("DXwx"),r("7laH")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=null,a=[];t.enabled=!1,t.begin=function(){t.enabled&&(i=[])},t.trace=function(e){t.enabled&&null!=i&&i.push(e)},t.end=function(){if(t.enabled){var e=i;return i=null,e&&(a.forEach(function(t){return t(e)}),a.length=0),e}},t.instrumentContext=function(e){return t.enabled?n.default(e)?e:r.makeDebugContext(e,void 0,function(e,n){t.enabled&&i&&i.push("gl."+e+"("+r.glFunctionArgsToString(e,n)+")")}):e},t.request=function(e){a.push(e)}}.apply(null,n))||(e.exports=i)},"qC//":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("AzkI"),r("CIy2"),r("Zp3t")],void 0===(i=function(e,t,r,n,i,a){function o(e,t){if(!e)return null;for(var r=e.length/2,n=s*r,i=new Array(r),a=0,o=1===t,c=0;c<e.length;c+=2){var u=(e[c]+e[c+1])/2;i[a++]=o?Math.min(n,1-(1-u)*l):Math.min(n,u*l)}return i}Object.defineProperty(t,"__esModule",{value:!0}),t.generateStrokesTexture=function(e){for(var r=t.strokesDefinition.resolution,s=r/2,l=new Uint8Array(4*r*r),c=4*r*s,u=t.strokesDefinition.amplitude,d=2*u,f=4*r,p=n.log2(r)+1,h=t.strokesDefinition.strokes.length,v=(p-1)*h*f,m=0,g=t.strokesDefinition.strokes;m<g.length;m++){for(var y=g[m],b=y.distance,x=y.pressure,_=v,S=0;S<p;S++){0!==S&&(b=o(b,0),x=o(x,1));for(var w=0;w<t.strokesDefinition.resolution;w++){var C=.5+(b?b[w%b.length]/d:0),P=x?x[w%x.length]:1;i.packFloatRGBA(C,l,_),i.packFloatRGBA(P,l,_+c),_+=4}_-=f*(h+1)}v+=f}return{resolution:r,texture:new a(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:r,height:r,wrapMode:10497},l),normalizationScale:d,amplitude:u,variants:h}};var s=.1,l=.5;t.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}}.apply(null,n))||(e.exports=i)},qSXe:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("Q2wQ"),r("HZ3d"),r("1m5D"),r("0LE5"),r("Rdxj"),r("WRgd"),r("yVFQ"),r("xlkQ"),r("BwdQ"),r("xsp2")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f){var p=function(){function e(e,t,r,n){this.type="lod-instance",this.alignedTerrainElevation=0,this.needsElevationUpdates=!1,this.graphics3DSymbolLayer=e,this.instanceIndex=t,this.elevationAligner=r,this.elevationContext=new u(n)}return e.prototype.initialize=function(e,t){},e.prototype.setVisibility=function(e){var t=this.lodRenderer.instanceData;return e!==t.getVisible(this.instanceIndex)&&(t.setVisible(this.instanceIndex,e),!0)},e.prototype.destroy=function(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))},e.prototype.alignWithElevation=function(e,t,r){if(this.elevationAligner){c.setContextFeature(this.elevationContext.featureExpressionInfoContext,r);var n=this.elevationAligner(this,this.elevationContext,e,t);null!=n&&(this.alignedTerrainElevation=n)}},e.prototype.getBSRadius=function(){var e=this.lodRenderer;return e.baseBoundingSphere.radius*e.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)},e.prototype.getCenterObjectSpace=function(e){return void 0===e&&(e=s.vec3f64.create()),this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,y),o.vec3.transformMat4(e,this.lodRenderer.baseBoundingSphere.center,y)},e.prototype.getBoundingBoxObjectSpace=function(e){void 0===e&&(e=l.create()),this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,y);var t=this.lodRenderer.baseBoundingBox;l.empty(e);for(var r=0;r<8;++r)o.vec3.set(v,0==(1&r)?t[0]:t[3],0==(2&r)?t[1]:t[4],0==(4&r)?t[2]:t[5]),o.vec3.transformMat4(v,v,y),l.expandPointInPlace(e,v);return e},e.prototype.getProjectedBoundingBox=function(e,t,r,a){return i(this,void 0,void 0,function(){var i,s,c,u,f,p,b,x,_;return n(this,function(n){switch(n.label){case 0:for(i=this.getBoundingBoxObjectSpace(a),s=g,c=l.isPoint(i)?1:s.length,this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,y),p=0;p<c;p++)u=s[p],v[0]=i[u[0]],v[1]=i[u[1]],v[2]=i[u[2]],o.vec3.transformMat4(v,v,y),h[3*p+0]=v[0],h[3*p+1]=v[1],h[3*p+2]=v[2];if(!e(h,0,c))return[2,null];for(l.empty(i),f=null,this.calculateRelativeScreenBounds&&(f=this.calculateRelativeScreenBounds()),p=0;p<3*c;p+=3){for(b=0;b<3;b++)i[b]=Math.min(i[b],h[p+b]),i[b+3]=Math.max(i[b+3],h[p+b]);f&&r.push({location:h.slice(p,p+3),screenSpaceBoundingRect:f})}if(!t)return[3,5];if(l.center(i,m),"absolute-height"===this.elevationContext.mode)return[3,5];x=void 0,_=d.demResolutionForBoundingBox(i,t),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t.service.queryElevation(m[0],m[1],_)];case 2:return x=n.sent(),[3,4];case 3:return n.sent(),x=null,[3,4];case 4:null!=x&&l.offset(i,0,0,-this.alignedTerrainElevation+x),n.label=5;case 5:return[2,i]}})})},e.prototype.addHighlight=function(e,t){var r=this,n=f.generateHighlightId();this.addHighlightId(n),e.addExternal(function(e){r.removeHighlightId(e)},n)},e.prototype.removeHighlight=function(e){this.highlights&&this.highlights.forEach(function(t){return e.remove(t)})},e.prototype.addHighlightId=function(e){this.highlights=this.highlights||new Set,this.highlights.add(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)},e.prototype.removeHighlightId=function(e){this.highlights&&(this.highlights.delete(e),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this.highlights.size>0),0===this.highlights.size&&(this.highlights=null))},Object.defineProperty(e.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0}),e}(),h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v=s.vec3f64.create(),m=s.vec3f64.create(),g=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],y=a.mat4f64.create();return p}.apply(null,n))||(e.exports=i)},qUb7:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Rdxj")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,n){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.fromValues(.57735,.57735,.57735)),void 0===n&&(n=!0),this.intensity=e,this.direction=t,this.castShadows=n};t.MainLight=n;var i=function(e,t){void 0===e&&(e=r.vec3f64.create()),void 0===t&&(t=r.vec3f64.fromValues(.57735,.57735,.57735)),this.intensity=r.vec3f64.create(),this.direction=r.vec3f64.create(),this.intensity=e,this.direction=t};t.FillLight=i;var a=function(e){void 0===e&&(e=r.vec3f64.create()),this.intensity=e};t.AmbientLight=a;var o=function(){this.sh={r:[0],g:[0],b:[0]}};t.SphericalHarmonicsLight=o}.apply(null,n))||(e.exports=i)},qVs7:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("QFi0")],void 0===(i=function(e,t,r){return function(){function e(e,t,n,i,a){this._elementSize=i,this._buffer=new r(e,t,n),this.resize(a)}return e.prototype.destroy=function(){this._buffer.dispose()},Object.defineProperty(e.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0}),e.prototype.copyRange=function(e,t,r,n){void 0===n&&(n=0);var i=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,n*this.elementSize).set(i)},e.prototype.transferAll=function(){this._buffer.setData(this._array)},e.prototype.transferRange=function(e,t){var r=e*this._elementSize,n=t*this._elementSize;this._buffer.setSubData(this._array,r,r,n)},e.prototype.resize=function(e){var t=e*this._elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setData(t),this._capacity=e},e}()}.apply(null,n))||(e.exports=i)},qbr3:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf")],void 0===(i=function(e,t,r){function n(e){return _.intern(e)}function i(e){return S.intern(e)}function a(e){return w.intern(e)}function o(e){return C.intern(e)}function s(e){return P.intern(e)}function l(e){return E.intern(e)}function c(e){return T.intern(e)}function u(e){return O.intern(e)}function d(e){return"["+e.join(",")+"]"}function f(e){return e?d([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}function p(e){return e?d([e.face,e.mode]):null}function h(e){return e?d([e.factor,e.units]):null}function v(e){return e?d([e.func]):null}function m(e){return e?d([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}function g(e){return e?d([e.zNear,e.zFar]):null}function y(e){return e?d([e.r,e.g,e.b,e.a]):null}function b(e){return e?d([e.mask]):null}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleBlendingParams=function(e,t,r,n){return void 0===r&&(r=32774),void 0===n&&(n=[0,0,0,0]),{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:n[0],g:n[1],b:n[2],a:n[3]}}},t.separateBlendingParams=function(e,t,r,n,i,a,o){return void 0===i&&(i=32774),void 0===a&&(a=32774),void 0===o&&(o=[0,0,0,0]),{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:n,opRgb:i,opAlpha:a,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}},t.backFaceCullingParams={face:1029,mode:2305},t.defaultDepthWriteParams={zNear:0,zFar:1},t.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0},t.makeBlending=n,t.makeCulling=i,t.makePolygonOffset=a,t.makeDepthTest=o,t.makeStencilTest=s,t.makeDepthWrite=l,t.makeColorWrite=c,t.makeStencilWrite=u,t.makePipelineState=function(e){return A.intern(e)};var x=function(){function e(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}return e.prototype.intern=function(e){if(!e)return null;var t=this.makeKey(e),r=this.interns;return r.has(t)||r.set(t,this.makeRef(e)),r.get(t)},e}(),_=new x(f,function(e){return r({__tag:"Blending"},e)}),S=new x(p,function(e){return r({__tag:"Culling"},e)}),w=new x(h,function(e){return r({__tag:"PolygonOffset"},e)}),C=new x(v,function(e){return r({__tag:"DepthTest"},e)}),P=new x(m,function(e){return r({__tag:"StencilTest"},e)}),E=new x(g,function(e){return r({__tag:"DepthWrite"},e)}),T=new x(y,function(e){return r({__tag:"ColorWrite"},e)}),O=new x(b,function(e){return r({__tag:"StencilWrite"},e)}),A=new x(function(e){return e?d([f(e.blending),p(e.culling),h(e.polygonOffset),v(e.depthTest),m(e.stencilTest),g(e.depthWrite),y(e.colorWrite),b(e.stencilWrite)]):null},function(e){return{blending:n(e.blending),culling:i(e.culling),polygonOffset:a(e.polygonOffset),depthTest:o(e.depthTest),stencilTest:s(e.stencilTest),depthWrite:l(e.depthWrite),colorWrite:c(e.colorWrite),stencilWrite:u(e.stencilWrite)}}),R=function(){function e(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}return e.prototype.setPipeline=function(e){(this._pipelineInvalid||e!==this._pipeline)&&(this.setBlending(e.blending),this.setCulling(e.culling),this.setPolygonOffset(e.polygonOffset),this.setDepthTest(e.depthTest),this.setStencilTest(e.stencilTest),this.setDepthWrite(e.depthWrite),this.setColorWrite(e.colorWrite),this.setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1},e.prototype.invalidateBlending=function(){this._blendingInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateCulling=function(){this._cullingInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidatePolygonOffset=function(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateDepthTest=function(){this._depthTestInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateStencilTest=function(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateDepthWrite=function(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateColorWrite=function(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0},e.prototype.invalidateStencilWrite=function(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0},e.prototype.setBlending=function(e){this._blending=this.setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1},e.prototype.setCulling=function(e){this._culling=this.setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1},e.prototype.setPolygonOffset=function(e){this._polygonOffset=this.setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1},e.prototype.setDepthTest=function(e){this._depthTest=this.setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1},e.prototype.setStencilTest=function(e){this._stencilTest=this.setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1},e.prototype.setDepthWrite=function(e){this._depthWrite=this.setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1},e.prototype.setColorWrite=function(e){this._colorWrite=this.setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1},e.prototype.setStencilWrite=function(e){this._stencilWrite=this.setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1},e.prototype.setSubState=function(e,t,r,n){return(r||e!==t)&&(n(e),this._pipelineInvalid=!0),e},e}();t.StateTracker=R}.apply(null,n))||(e.exports=i)},qvwY:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){return e instanceof Float32Array&&e.length>=16}function n(e){return Array.isArray(e)&&e.length>=16}Object.defineProperty(t,"__esModule",{value:!0}),t.isMat4f32=r,t.isMat4f64=n,t.isMat4=function(e){return r(e)||n(e)}}.apply(null,n))||(e.exports=i)},rfv1:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q2wQ"),r("HZ3d"),r("xdHJ"),r("ma1f"),r("H1tY"),r("qsST"),r("jEml"),r("lRq4"),r("+6sX")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u){function d(e,t){return h.minX=t[0],h.minY=t[1],h.maxX=t[2],h.maxY=t[3],e.search(h)}Object.defineProperty(t,"__esModule",{value:!0});var f=[],p=s.getLogger("esri.layers.graphics.data.FeatureStore"),h={minX:0,minY:0,maxX:0,maxY:0},v=function(){function e(e){this._featuresById=new i.default,this._boundsByFeature=new i.default,this._featuresByBounds=new i.default,this._index=l(9,o("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._geometryInfo=e}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var e=c.create(c.NEGATIVE_INFINITY);return this._boundsByFeature.forEach(function(t){t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]))}),e},enumerable:!0,configurable:!0}),e.prototype.setEngine=function(e){this._engine=e},e.prototype.add=function(e){this._add(e,f),this._index.load(f),this._clearCache(),f.length=0},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];this._add(n,f)}this._index.load(f),this._clearCache(),f.length=0},e.prototype.clear=function(){this._featuresById.clear(),this._boundsByFeature.clear(),this._featuresByBounds.clear(),this._index.clear(),this._clearCache()},e.prototype.removeManyById=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t],i=this._featuresById.get(n);if(i){var a=this._boundsByFeature.get(i);a&&(this._index.remove(a),this._featuresByBounds.delete(a)),this._boundsByFeature.delete(i)}this._featuresById.delete(n)}this._clearCache()},e.prototype.forEachBounds=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r],a=this._boundsByFeature.get(i);a&&t(a,i)}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach(function(t){return e(t)})},e.prototype.forEachInBounds=function(e,t){for(var r=0,n=d(this._index,e);r<n.length;r++){var i=n[r];t(this._featuresByBounds.get(i))}},e.prototype.transferIds=function(e,t){for(var r=[],n=0,i=t;n<i.length;n++){var a=i[n],o=this._featuresById.get(a);o&&(this._remove(o),r.push(o))}e.addMany(r),this._clearCache()},e.prototype.transferIdRange=function(e,t,r){for(var n=[],i=t;i<r;i++){var a=this._featuresById.get(i);a&&(this._remove(a),n.push(a))}e.addMany(n),this._clearCache()},e.prototype.transferIf=function(e,t){var r=this,n=[];this._featuresById.forEach(function(e,i){t(e)&&(r._remove(e),n.push(e))}),e.addMany(n),this._clearCache()},e.prototype.transferAll=function(e){var t=this,r=[];this._featuresById.forEach(function(e,n){t._remove(e),r.push(e)}),e.addMany(r),this._clearCache()},e.prototype._clearCache=function(){this._engine&&this._engine.clearCache()},e.prototype._add=function(e,t){if(e){var r=e.objectId;if(null==r)return void p.error(new a("featurestore:invalid-feature","feature id is missing",{feature:e}));var n,i=this._featuresById.get(r);if(i&&(n=this._boundsByFeature.get(i))&&(this._index.remove(n),this._boundsByFeature.delete(i),this._featuresByBounds.delete(n)),!e.geometry)return this._boundsByFeature.set(e,null),void this._featuresById.set(r,e);n=u.getBoundsOptimizedGeometry(n||c.create(),e.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(e,n),this._featuresByBounds.set(n,e),this._featuresById.set(r,e),t.push(n)}},e.prototype._remove=function(e){var t;e&&((t=this._boundsByFeature.get(e))&&(this._index.remove(t),this._boundsByFeature.delete(e),this._featuresByBounds.delete(t)),this._featuresById.delete(e.objectId))},e}();t.default=v}.apply(null,n))||(e.exports=i)},rjU6:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("KY0m"),r("LxLY")],void 0===(i=function(e,t,r,n){function i(e,t){if(null!=e){var r=e.isVisibleBit,n=e.data,i=g(n);return t<n.length*i?m(r,n,t,i):v(e)}return!0}function a(e){return n.isSome(e.component)?e.component:-1}function o(e,t,r,n,a){i(t,n)&&s(e,t,r,r[n],_(r[n+1]),a)}function s(e,t,r,n,i,a){var o=e.length>0?e[e.length-1]:null,s=o?o.range[1]:-1,l=o?o.options:null;if(!(s>=n))if(s+1===n&&l===a)o.range[1]=i;else{var c={range:[n,i],options:a};e.push(c)}}function l(e){return void 0===e&&(e=!0),{isVisibleBit:!e,data:new Uint32Array(0)}}function c(e,t){return!d(e,t)}function u(e,t){return f(e,t,!0)}function d(e,t){return f(e,t,!1)}function f(e,t,r){var n=!1,i=(e=e||w).isVisibleBit,a=e.data,o=S(t),s=g(a),l=a.length*s,c=r===i;if(0===a.length||0===o)n=!c;else if(l<o&&!c)n=!0;else{for(var u=x(s),d=x(0),f=0;f<a.length-1;f++)if(n=!c&&a[f]!==u||c&&a[f]!==d)return n;var p=a.length-1,h=x((o-1)%s+1);n=!c&&(a[p]&h)!==h||c&&(a[p]&h)!==d}return n}function p(e,t){return t<S(e)}function h(e){return e.length>0}function v(e){return!e.isVisibleBit}function m(e,t,r,n){var i=r/n|0,a=r-i*n;return b(t[i],a)===e}function g(e){return 8*e.BYTES_PER_ELEMENT}function y(e,t,r){return e&~(1<<t)|(r?1:0)<<t}function b(e,t){return 0!=(e&1<<t)}function x(e){return C[e]}function _(e){return e-1}function S(e){return Math.max(0,e.length-1)}Object.defineProperty(t,"__esModule",{value:!0}),t.updateVisibility=function(e,t,r,n){if(p(t,r)){null==e&&(e=l());var i=e.isVisibleBit,a=e.data,o=g(a),s=r/o|0,c=r-o*s,u=(S(t)-1)/o|0,d=a,f=n===i;if(!(r<d.length*o)&&f){var h=s+1,v=Math.ceil(1.5*d.length),m=u+1,b=Math.max(h,v);b=Math.min(b,m),(a=new Uint32Array(b)).set(d)}s<a.length&&(a[s]=y(a[s],c,f)),e.data=a}return e},t.getVisibility=i,t.hideAllComponents=function(e){var t;if(null==e)t=l(!1);else{(t=e).isVisibleBit=!0;for(var r=0;r<t.data.length;r++)t.data[r]=0}return t},t.unhideAllComponents=function(e){var t;if(null==e);else{(t=e).isVisibleBit=!1;for(var r=0;r<t.data.length;r++)t.data[r]=0}return t},t.generateVisibleIndexRanges=function(e,t){var r;if(e)if(h(t))if(0===e.data.length){var n=[],i=[[t[0],_(t[t.length-1])]];r=v(e)?i:n}else{r=[];for(var a=e.isVisibleBit,o=e.data,s=g(o),l=o.length*s,c=S(t),u=!1,d=0;d<l&&d<c;d++){var f=m(a,o,d,s);if(f!==u){var p=t[d];f?r.push([p,0]):(b=r[r.length-1])[1]=_(p),u=f}}var y=v(e);if(c>l&&y&&!u)r.push([t[l],_(t[c])]);else if(u){var b=r[r.length-1],x=y?c:Math.min(c,l);b[1]=_(t[x])}}else n=[],i=null,r=v(e)?i:n;else r=null;return r},t.addHighlight=function(e,t,r,n){var i,o={component:t,options:r,id:n};(e=e||[]).push(o);for(var s=a(o),l=e.length-1;l>0&&s<a(e[l-1]);)i=[e[l],e[l-1]],e[l-1]=i[0],e[l]=i[1],--l;return e},t.removeHighlight=function(e,t){if(!e)return e;var r=e.filter(function(e){return e.id!==t});return 0===r.length?null:r},t.generateHighlightedIndexRanges=function(e,t,r){if(!t)return null;if(!h(r))return!e||v(e)?t.map(function(e){return{range:null,options:e.options}}):null;for(var i=r[0],a=_(r[r.length-1]),l=[],u=c(e,r),d=0;d<t.length;++d){var f=t[d].options,p=t[d].component;if(n.isSome(p))o(l,e,r,p,f);else if(u)s(l,0,0,i,a,f);else for(var m=0;m<S(r);++m)o(l,e,r,m,f)}return l.length>0?l:null},t.hasHighlights=function(e,t,r){if(!t)return!1;if(!h(r))return!(e&&!v(e))&&t.length>0;for(var i=c(e,r),a=0,o=t;a<o.length;a++){var s=o[a].component;if(n.isSome(s))return!0;if(i)return!0;if(S(r)>0)return!0}return!1},t.defaultVisibilities=l,t.isAllVisible=c,t.isAllHidden=function(e,t){return!u(e,t)},t.hasVisible=u,t.hasHidden=d;var w=l();t.createOffsets=function(e){return Array.isArray(e)?new Uint32Array(e):e},t.hasComponent=p,t.hasComponents=h;for(var C=[],P=0;P<65;P++)C.push(Math.pow(2,P)-1);t.componentCount=S,t.componentFind=function(e,t){var n=r.binaryIndexOf(e,t,!0);return n>=0?n:null}}.apply(null,n))||(e.exports=i)},s3uR:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qsST"),r("YX1r"),r("51bw"),r("1m5D"),r("0LE5"),r("Rdxj"),r("mmEe"),r("VfPl")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c){function u(e,t,r,i,a,s){if(t){var c=a.isWGS84,u=r.count;if(c)for(var d=0;d<u;d++)i.getVec(d,f),t.getVec(d,p),l.computeLinearTransformation(l.SphericalECEFSpatialReference,f,h,l.SphericalECEFSpatialReference),n.mat3.fromMat4(v,h),1===e&&n.mat3.transpose(v,v),o.vec3.transformMat3(p,p,v),s.setVec(d,p);else for(d=0;d<u;d++){i.getVec(d,f),t.getVec(d,p),l.computeLinearTransformation(l.SphericalECEFSpatialReference,f,h,l.SphericalECEFSpatialReference),n.mat3.fromMat4(v,h);var m=l.webMercator.y2lat(r.get(d,1)),g=Math.cos(m);0===e&&(g=1/g),v[0]*=g,v[1]*=g,v[2]*=g,v[3]*=g,v[4]*=g,v[5]*=g,1===e&&n.mat3.transpose(v,v),o.vec3.transformMat3(p,p,v),o.vec3.normalize(p,p),s.setVec(d,p)}return s}}Object.defineProperty(t,"__esModule",{value:!0});var d=r.getLogger("esri.geometry.support.meshUtils.normalProjection");t.projectNormalToECEF=function(e,t,r,n,i){return n.isWebMercator||n.isWGS84?(u(0,new c.BufferViewVec3f(e.buffer,e.byteOffset),new c.BufferViewVec3f64(t.buffer,t.byteOffset),new c.BufferViewVec3f64(r.buffer,r.byteOffset),n,new c.BufferViewVec3f(i.buffer,i.byteOffset)),i):(d.error("Cannot convert PCS spatial reference buffer to ECEF"),i)},t.projectNormalFromECEF=function(e,t,r,n,i){return n.isWebMercator||n.isWGS84?(u(1,new c.BufferViewVec3f(e.buffer,e.byteOffset),new c.BufferViewVec3f64(t.buffer,t.byteOffset),new c.BufferViewVec3f64(r.buffer,r.byteOffset),n,new c.BufferViewVec3f(i.buffer,i.byteOffset)),i):(d.error("Cannot convert to PCS spatial reference buffer from ECEF"),i)},t.projectToECEF=function(e,t,r){return l.bufferToBuffer(e,t,0,r,l.SphericalECEFSpatialReference,0,e.length/3),r},t.projectFromECEF=function(e,t,r){return l.bufferToBuffer(e,l.SphericalECEFSpatialReference,0,t,r,0,e.length/3),t},t.transformBufferInPlace=function(e,t,r){if(void 0===r&&(r=!1),e)for(var n=0;n<e.length;n+=3){for(var i=0;i<3;i++)f[i]=e[n+i];for(o.vec3.transformMat4(f,f,t),r&&o.vec3.normalize(f,f),i=0;i<3;i++)e[n+i]=f[i]}},t.projectTangentToECEF=function(e,t,r,n,i){if(!n.isWebMercator&&!n.isWGS84)return d.error("Cannot convert PCS spatial reference buffer to ECEF"),i;u(0,new c.BufferViewVec3f(e.buffer,e.byteOffset,16),new c.BufferViewVec3f64(t.buffer,t.byteOffset),new c.BufferViewVec3f64(r.buffer,r.byteOffset),n,new c.BufferViewVec3f(i.buffer,i.byteOffset,16));for(var a=3;a<e.length;a+=4)i[a]=e[a];return i},t.projectTangentFromECEF=function(e,t,r,n,i){if(!n.isWebMercator&&!n.isWGS84)return d.error("Cannot convert to PCS spatial reference buffer from ECEF"),i;u(1,new c.BufferViewVec3f(e.buffer,e.byteOffset,16),new c.BufferViewVec3f64(t.buffer,t.byteOffset),new c.BufferViewVec3f64(r.buffer,r.byteOffset),n,new c.BufferViewVec3f(i.buffer,i.byteOffset,16));for(var a=3;a<e.length;a+=4)i[a]=e[a];return i};var f=s.vec3f64.create(),p=s.vec3f64.create(),h=a.mat4f64.create(),v=i.mat3f64.create()}.apply(null,n))||(e.exports=i)},s4LJ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("Q2wQ"),r("HZ3d"),r("0LE5"),r("Rdxj"),r("WRgd"),r("yVFQ"),r("xlkQ"),r("BwdQ"),r("krVM")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d){function f(e,t,r){return r||(r=s.create()),s.setMin(r,e.getBBMin(t)),s.setMax(r,e.getBBMax(t)),r}var p=function(){function e(t,r,n,i,a,o,s,l){this.type="object3d",this._addedToStage=!1,this.alignedTerrainElevation=0,this.needsElevationUpdates=!1,this.graphics3DSymbolLayer=t,this.uniqueMaterials=i,this.uniqueGeometries=n,this.uniqueTextures=a,this.stageObject=r,this.elevationAligner=o,this.elevationContext=new c(s),this.stage=null,this.stageLayer=null,this._visible=!1,this.visibilityMode=null!=l?l:e.VisibilityModes.HIDE_FACERANGE}return e.prototype.initialize=function(e,t){if(this.stageLayer=e,this.stage=t,this.uniqueMaterials)for(var r=0;r<this.uniqueMaterials.length;r++)t.add(d.ModelContentType.MATERIAL,this.uniqueMaterials[r]);if(this.uniqueGeometries)for(r=0;r<this.uniqueGeometries.length;r++)t.add(d.ModelContentType.GEOMETRY,this.uniqueGeometries[r]);if(this.uniqueTextures)for(r=0;r<this.uniqueTextures.length;r++)t.add(d.ModelContentType.TEXTURE,this.uniqueTextures[r]);t.add(d.ModelContentType.OBJECT,this.stageObject)},e.prototype.setVisibility=function(t){if(null!=this.stage){if(this._visible!==t){this._visible=t,this._visible?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===e.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);var r=this.stage.view.ensureEdgeView();return r.hasObject(this.stageObject)&&r.updateObjectVisibility(this.stageObject,this._visible),!0}return!1}},Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){var e=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var t=0;t<this.uniqueMaterials.length;t++)e.remove(d.ModelContentType.MATERIAL,this.uniqueMaterials[t].id);if(this.uniqueGeometries)for(t=0;t<this.uniqueGeometries.length;t++)e.remove(d.ModelContentType.GEOMETRY,this.uniqueGeometries[t].id);if(this.uniqueTextures)for(t=0;t<this.uniqueTextures.length;t++)e.remove(d.ModelContentType.TEXTURE,this.uniqueTextures[t].id)}e.remove(d.ModelContentType.OBJECT,this.stageObject.id),this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);var r=this.stage.view.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this._visible=!1,this.stageLayer=null,this.stage=null},e.prototype.alignWithElevation=function(e,t,r){if(this.elevationAligner){l.setContextFeature(this.elevationContext.featureExpressionInfoContext,r);var n=this.elevationAligner(this,this.elevationContext,e,t);null!=n&&(this.alignedTerrainElevation=n)}},e.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()},e.prototype.getCenterObjectSpace=function(e){return void 0===e&&(e=o.vec3f64.create()),a.vec3.copy(e,this.stageObject.getCenter(!0))},e.prototype.getBoundingBoxObjectSpace=function(e){return void 0===e&&(e=s.create()),f(this.stageObject,!0,e)},e.prototype.getProjectedBoundingBox=function(e,t,r,o){return i(this,void 0,void 0,function(){var i,l,c,d,f,p,y,b,x,_;return n(this,function(n){switch(n.label){case 0:for(i=this.getBoundingBoxObjectSpace(o),l=g,c=s.isPoint(i)?1:l.length,p=0;p<c;p++)d=l[p],v[0]=i[d[0]],v[1]=i[d[1]],v[2]=i[d[2]],a.vec3.transformMat4(v,v,this.stageObject.objectTransformation),h[3*p+0]=v[0],h[3*p+1]=v[1],h[3*p+2]=v[2];if(!e(h,0,c))return[2,null];for(s.empty(i),f=null,this.calculateRelativeScreenBounds&&(f=this.calculateRelativeScreenBounds()),p=0;p<3*c;p+=3){for(y=0;y<3;y++)i[y]=Math.min(i[y],h[p+y]),i[y+3]=Math.max(i[y+3],h[p+y]);f&&r.push({location:h.slice(p,p+3),screenSpaceBoundingRect:f})}return t&&t.service&&"absolute-height"!==this.elevationContext.mode?(s.center(i,m),b="relative-to-scene"===this.elevationContext.mode?"scene":"ground",x=void 0,t.useViewElevation?(x=t.service.getElevation(m[0],m[1],b),[3,4]):[3,1]):[3,5];case 1:return n.trys.push([1,3,,4]),_=u.demResolutionForBoundingBox(i,t),[4,t.service.queryElevation(m[0],m[1],_,b)];case 2:return x=n.sent(),[3,4];case 3:return n.sent(),x=null,[3,4];case 4:s.offset(i,0,0,-this.alignedTerrainElevation+x),n.label=5;case 5:return[2,i]}})})},e.prototype.addHighlight=function(e,t){var r=this.stageObject.highlightAllComponents(t);e.addObject(this.stageObject,r)},e.prototype.removeHighlight=function(e){e.removeObject(this.stageObject)},e}();!function(e){!function(e){e[e.REMOVE_OBJECT=0]="REMOVE_OBJECT",e[e.HIDE_FACERANGE=1]="HIDE_FACERANGE"}(e.VisibilityModes||(e.VisibilityModes={}))}(p||(p={}));var h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v=o.vec3f64.create(),m=o.vec3f64.create(),g=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return p}.apply(null,n))||(e.exports=i)},s6rJ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("FXVB"),r("oZZu"),r("1m5D"),r("0LE5"),r("Rdxj"),r("2fXB"),r("WRgd"),r("AzkI"),r("rjU6"),r("1f+t"),r("+wMf"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p){function h(e,t,r,n,i){var a=b(t,r,T);if(l.setMin(P,e.getBBMin()),l.setMax(P,e.getBBMax()),x(P,t,a,n)){var o=e.getPrimitiveIndices(),s=e.getIndices(),c=e.getPosition(),u=o?o.length:s.length/3;if(u>F){var d=e.getChildren();if(void 0!==d){for(var f=0;f<8;++f)void 0!==d[f]&&h(d[f],t,r,n,i);return}}m(t,r,0,u,s,c,o,i)}}function v(e,t,r,n,i,a){var o=b(r,n,T),s=e.componentCount,c=e.componentOffsets,d=e.getIndices(E.POSITION),f=e.getAttribute(E.POSITION),p=e.boundingInfo;if(!p||(l.setMin(P,p.getBBMin()),l.setMax(P,p.getBBMax()),x(P,r,o,i)))for(var h=0;h<s;h++)if(!t||u.getVisibility(t,h)){if(e.getComponentAABB)if(!x(e.getComponentAABB(h,P),r,o,i))continue;m(r,n,c[h]/3,c[h+1]/3,d,f,void 0,a)}}function m(e,t,r,n,i,a,o,s){if(o)return g(e,t,r,n,i,a,o,s);for(var l=a.data,c=a.offsetIdx,u=a.strideIdx,d=e[0],f=e[1],p=e[2],h=t[0]-d,v=t[1]-f,m=t[2]-p,b=r,x=3*r;b<n;++b){var _=c+u*i[x++],S=l[_++],w=l[_++],C=l[_];_=c+u*i[x++];var P=l[_++],E=l[_++],T=l[_];_=c+u*i[x++];var R=P-S,M=E-w,I=T-C,D=l[_++]-S,V=l[_++]-w,L=l[_]-C,F=v*L-V*m,B=m*D-L*h,N=h*V-D*v,U=R*F+M*B+I*N;if(!(Math.abs(U)<=O)){var z=d-S,j=f-w,G=p-C,H=z*F+j*B+G*N;if(U>0){if(H<0||H>U)continue}else if(H>0||H<U)continue;var k=j*I-M*G,W=G*R-I*z,q=z*M-R*j,X=h*k+v*W+m*q;if(U>0){if(X<0||H+X>U)continue}else if(X>0||H+X<U)continue;var Y=(D*k+V*W+L*q)/U;Y>=0&&s(Y,y(R,M,I,D,V,L,A),b)}}}function g(e,t,r,n,i,a,o,s){for(var l=a.data,c=a.offsetIdx,u=a.strideIdx,d=e[0],f=e[1],p=e[2],h=t[0]-d,v=t[1]-f,m=t[2]-p,g=r;g<n;++g){var b=o[g],x=3*b,_=c+u*i[x++],S=l[_++],w=l[_++],C=l[_];_=c+u*i[x++];var P=l[_++],E=l[_++],T=l[_];_=c+u*i[x];var R=P-S,M=E-w,I=T-C,D=l[_++]-S,V=l[_++]-w,L=l[_]-C,F=v*L-V*m,B=m*D-L*h,N=h*V-D*v,U=R*F+M*B+I*N;if(!(Math.abs(U)<=O)){var z=d-S,j=f-w,G=p-C,H=z*F+j*B+G*N;if(U>0){if(H<0||H>U)continue}else if(H>0||H<U)continue;var k=j*I-M*G,W=G*R-I*z,q=z*M-R*j,X=h*k+v*W+m*q;if(U>0){if(X<0||H+X>U)continue}else if(X>0||H+X<U)continue;var Y=(D*k+V*W+L*q)/U;Y>=0&&s(Y,y(R,M,I,D,V,L,A),b)}}}function y(e,t,r,n,i,o,s){return a.vec3.set(R,e,t,r),a.vec3.set(M,n,i,o),a.vec3.cross(s,R,M),a.vec3.normalize(s,s),s}function b(e,t,r){return a.vec3.set(r,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function x(e,t,r,n){var i=(e[0]-n-t[0])*r[0],a=(e[3]+n-t[0])*r[0],o=Math.min(i,a),s=Math.max(i,a),l=(e[1]-n-t[1])*r[1],c=(e[4]+n-t[1])*r[1];if((o=Math.max(o,Math.min(l,c)))>(s=Math.min(s,Math.max(l,c))))return!1;var u=(e[2]-n-t[2])*r[2],d=(e[5]+n-t[2])*r[2];return(o=Math.max(o,Math.min(u,d)))<=(s=Math.min(s,Math.max(u,d)))}function _(e,t,r,n,i){return f.scale(e,n,r,i)}function S(e,t,r,n){return void 0===n&&(n=B),n.screenLength=e.screenLength,n.perDistance=Math.tan(.5*t)/(.5*r),n.minWorldLength=e.minWorldLength,n.maxWorldLength=e.maxWorldLength,n}function w(e){var t=[];return e.forEach(function(e){return t.push(e)}),t}Object.defineProperty(t,"__esModule",{value:!0});var C=i.mat4f64.create(),P=l.create(),E=p.VertexAttrConstants;t.IDENTITY=i.mat4f64.create(),t.intersectTriangleGeometry=function(e,t,r,n,i,a,o,s){var l=t&&t.componentVisibilities,c=n.tolerance;if(e.componentCount>1)v(e,l,i,a,c,o);else if(!l||u.getVisibility(l,0))if(e.boundingInfo)p.assert("triangle"===e.data.primitiveType),h(e.boundingInfo,i,a,c,o);else{var d=e.getIndices(E.POSITION),f=e.getAttribute(E.POSITION);m(i,a,0,d.length/3,d,f,void 0,o)}};var T=o.vec3f64.create(),O=Math.pow(2,-52),A=o.vec3f64.create();t.intersectTriangles=m;var R=o.vec3f64.create(),M=o.vec3f64.create();t.computeNormal=y,t.intersectAabbInvDir=x,t.transformToWorld=function(e,t,r){return s.vec4.set(r,e[0]-t[0],e[1]-t[1],e[2]-t[2],1)},t.transformToView=function(e,t,n,i){return r.mat4.translate(C,n,t),n=C,s.vec4.transformMat4(i,e,n)},t.transformToProjection=function(e,t,r,n){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n[3]=e[3],s.vec4.transformMat4(n,n,t)},t.transformToNDC=function(e,t){return s.vec4.scale(t,e,1/Math.abs(e[3]))},t.applyScreenSizePerspectiveScale=_,t.verticalOffsetAtDistance=function(e,t,r,n,i){var a=(r.screenLength||0)*e.pixelRatio;i&&(a=_(a,0,t,n,i));var o=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return c.clamp(o*t,r.minWorldLength||0,null!=r.maxWorldLength?r.maxWorldLength:1/0)},t.aquireIfNotUndefined=function(e,t,r){if(void 0!==e)return t.aquire(e,r)},t.releaseIfNotUndefined=function(e,t){void 0!==e&&t.release(e)};var I=n.mat4f32.create();t.bindView=function(e,t,n){r.mat4.translate(I,t,e),n.setUniform3fv("localOrigin",e),n.setUniformMatrix4fv("view",I)},t.bindCamPos=function(e,t,r){r.setUniform3f("camPos",t[3]-e[0],t[7]-e[1],t[11]-e[2])};var D=o.vec3f64.create(),V=o.vec3f64.create();t.bindViewOriginDouble=function(e,t){d.encodeDoubleArraySplit(e,D,V,3),t.setUniform3fv("viewOriginHi",D),t.setUniform3fv("viewOriginLo",V)};var L=o.vec3f64.create();t.bindSlicePlane=function(e,t,r){a.vec3.subtract(L,t.origin,e),r.setUniform3fv("slicePlaneOrigin",L),r.setUniform3fv("slicePlaneBasis1",t.basis1),r.setUniform3fv("slicePlaneBasis2",t.basis2)},t.bindVerticalOffset=function(e,t,r){if(e){var n=S(e,t.fovY,t.viewport[3]),i=t.pixelRatio||1;r.setUniform4f("verticalOffset",n.screenLength*i,n.perDistance,n.minWorldLength,n.maxWorldLength)}},t.bindHighlightRendering=function(e,t,r){e.bindTexture(t.highlightDepthTexture,5),r.setUniform1i("depthTex",5),r.setUniform4f("highlightViewportPixelSz",0,0,1/t.viewport[2],1/t.viewport[3])},t.bindScreenSizePerspective=function(e,t,r){if(void 0===r&&(r="screenSizePerspectiveAlignment"),e){var n=e.parameters,i=e.paddingPixelsOverride;t.setUniform4f(r,n.divisor,n.offset,n.minPixelSize,i)}},t.copyParameters=function e(t,r){var n=r?e(r):{};for(var i in t){var a=t[i];a&&a.forEach&&(a=w(a)),null==a&&i in n||(n[i]=a)}return n},t.updateParameters=function(e,t){var r=!1;for(var n in t){var i=t[n];void 0!==i&&(r=!0,Array.isArray(i)?e[n]=i.slice():e[n]=i)}return r},function(e){function t(e){return(e.shadowMappingEnabled?1:0)|(e.ssaoEnabled?2:0)}e.create=function(e,r){for(var n=[],i=0;i<2;i++)for(var a=0;a<2;a++){var o=t({shadowMappingEnabled:1===i,ssaoEnabled:1===a}),s=t({shadowMappingEnabled:1===i,ssaoEnabled:1===a&&e.receiveSSAO});n[o]=n[s]||r({receiveShadows:1===i,receiveSSAO:1===a&&e.receiveSSAO})}return{programs:n.filter(function(e){return null!=e}),byParameter:n}},e.lookup=function(e,r){return e.byParameter[t(r)]},e.programs=function(e){return e.programs}}(t.BindParametersMap||(t.BindParametersMap={})),t.intersectDrapedRenderLineGeometry=function(e,t,r,n,i,a,o,s,l){if(n.enable.selectionMode){for(var u=e.getAttribute(E.POSITION).data,d=e.getAttribute(E.SIZE),f=d&&d.data[0],p=a[0],h=a[1],v=((f+o)/2+4)*e.pixelRatio,m=Number.MAX_VALUE,g=0;g<u.length-5;g+=3){var y=u[g],b=u[g+1],x=p-y,_=h-b,S=u[g+3]-y,w=u[g+4]-b,C=S*x+w*_,P=S*S+w*w,T=c.clamp(C/P,0,1),O=S*T-x,A=w*T-_,R=O*O+A*A;R<m&&(m=R)}m<v*v&&s()}},t.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var F=1e3,B={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}}.apply(null,n))||(e.exports=i)},sDf1:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("ycL1"),r("rg9i"),r("qsST"),r("Vx27")],void 0===(i=function(e,t,r,n,i,a,o,s){function l(e,t,r,n){var i=t.loggerTag,a=t.stride;return e.length%a!=0?(n.error(i,"Invalid array length, expected a multiple of "+a),new r([])):e}function c(e,t,r,n,i){if(!e)return e;if(e instanceof t)return l(e,n,t,i);for(var a=0,o=r;a<o.length;a++)if(e instanceof o[a])return l(new t(e),n,t,i);if(Array.isArray(e))return l(new t(e),n,t,i);var s=r.map(function(e){return"'"+e.name+"'"});return i.error("Failed to set property, expected one of "+s+", but got "+e.constructor.name),new t([])}function u(e,t,r){t[r]=d(e)}function d(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e[r];return t}Object.defineProperty(t,"__esModule",{value:!0});var f=o.getLogger("esri.geometry.support.MeshVertexAttributes"),p=function(e){function t(t){var r=e.call(this)||this;return r.color=null,r.position=new Float64Array(0),r.uv=null,r.normal=null,r.tangent=null,r}var i;return r(t,e),i=t,t.prototype.castColor=function(e){return c(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},f)},t.prototype.castPosition=function(e){e&&e instanceof Float32Array&&f.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return c(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},f)},t.prototype.castUv=function(e){return c(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},f)},t.prototype.castNormal=function(e){return c(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},f)},t.prototype.castTangent=function(e){return c(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},f)},t.prototype.clone=function(){return new i({position:a.clone(this.position),uv:a.clone(this.uv),normal:a.clone(this.normal),tangent:a.clone(this.tangent)})},n([s.property({json:{write:u}})],t.prototype,"color",void 0),n([s.cast("color")],t.prototype,"castColor",null),n([s.property({nonNullable:!0,json:{write:u}})],t.prototype,"position",void 0),n([s.cast("position")],t.prototype,"castPosition",null),n([s.property({json:{write:u}})],t.prototype,"uv",void 0),n([s.cast("uv")],t.prototype,"castUv",null),n([s.property({json:{write:u}})],t.prototype,"normal",void 0),n([s.cast("normal")],t.prototype,"castNormal",null),n([s.property({json:{write:u}})],t.prototype,"tangent",void 0),n([s.cast("tangent")],t.prototype,"castTangent",null),i=n([s.subclass("esri.geometry.support.MeshVertexAttributes")],t)}(s.declared(i));t.MeshVertexAttributes=p,t.castArray=c,t.default=p}.apply(null,n))||(e.exports=i)},sIhy:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._listeners={}}return e.prototype.hasEventListener=function(e){return null!=this._listeners[e]&&this._listeners[e].size>0},e.prototype.on=function(e,t){var r=this;null==this._listeners[e]&&(this._listeners[e]=new Map);var n={};return this._listeners[e].set(n,t),{remove:function(){return r._listeners[e].delete(n)}}},e.prototype.emit=function(e,t){null!=this._listeners[e]&&this._listeners[e].forEach(function(e){return e(t)})},e}();t.Evented=r}.apply(null,n))||(e.exports=i)},tUyH:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("fHD9")],void 0===(i=function(e,t,r,n){return function(e){function t(t,r){var n=e.call(this)||this;return n.material=t,n.programRep=r,n}return r(t,e),t.prototype.isVisible=function(){return this.material.isVisible()},t.prototype.isVisibleInPass=function(e){return this.material.isVisibleInPass(e)},t.prototype.getPrograms=function(){return[this.getProgram()]},t.prototype.getDrawMode=function(){return 4},t.prototype.release=function(e,t){},t}(n.ManagingDisposable)}.apply(null,n))||(e.exports=i)},tZaU:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("idNY"),r("qMld")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=this;return n.create(function(r,n){t._deferreds.push({resolve:r,reject:n}),t._values.push(e)})},e.prototype.unshift=function(e){var t=this;return n.create(function(r,n){t._deferreds.unshift({resolve:r,reject:n}),t._values.unshift(e)})},Object.defineProperty(e.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,configurable:!0}),e.prototype.process=function(){return 0!==this.length&&(this._deferreds.shift().resolve(this._values.shift()),!0)},e.prototype.cancelAll=function(){for(var e=new r,t=0,n=this._deferreds;t<n.length;t++)n[t].reject(e);this._deferreds.length=0,this._values.length=0},e}();t.PromiseQueue=i}.apply(null,n))||(e.exports=i)},txdo:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("jBNx"),r("FXVB"),r("1m5D"),r("Rdxj"),r("Vt+U"),r("WRgd"),r("VW5z"),r("9v8t"),r("s4LJ"),r("zF3d"),r("JzVu"),r("BwdQ"),r("hADE"),r("krVM"),r("ys4y"),r("ZJC8"),r("cjy9")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b){function x(e){return null!=e.size?n.pt2px(e.size):1}Object.defineProperty(t,"__esModule",{value:!0});var _=function(e){function t(t,r,n,i){var a=e.call(this,t,r,n,i)||this,o={idHint:a._getStageIdHint(),width:x(r),color:a._getMaterialOpacityAndColor(),slicePlaneEnabled:a._context.slicePlaneEnabled};if(!a._isPropertyDriven("size")){var s=h.validateSymbolLayerSize(o.width);if(s)return a._logWarning(s),a.reject(),a}return o.width<=0?(a.reject(),a):(a._isPropertyDriven("size")&&(o.width=0),a._material=v.createRibbonMaterial(o),a._context.stage.add(m.ModelContentType.MATERIAL,a._material),a.resolve(),a)}return r(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.isFulfilled()||this.reject(),this._material&&(this._context.stage.remove(m.ModelContentType.MATERIAL,this._material.id),this._material=null)},t.prototype.createGraphics3DGraphic=function(e){var t=e.renderingInfo,r=e.graphic,i=r.geometry;if("polyline"!==i.type&&"polygon"!==i.type&&"extent"!==i.type)return this._logWarning("unsupported geometry type for line symbol: "+i.type),null;if(!this._validateGeometry(i))return null;var a="polygon"===i.type||"extent"===i.type?"rings":"paths",o="graphic"+r.uid,s=this._getVertexOpacityAndColor(t,Float32Array,255),l=0;t.size&&this._isPropertyDriven("size")&&(l=f.getSingleSizeDriver(t.size),l=n.pt2px(l));var c=this.getGraphicElevationContext(r);return"on-the-ground"===c.mode?this._createAsOverlay(r,a,s,l,c,o,this._context.layer.uid):this._createAs3DShape(r,a,s,l,c,o,r.uid)},t.prototype.layerOpacityChanged=function(){var e=this._material.getColor(),t={color:[e[0],e[1],e[2],this._getMaterialOpacity()]};return this._material.setParameterValues(t),!0},t.prototype.layerElevationInfoChanged=function(e,t,r){var n=this._elevationContext.mode;if(null==r||null==n)return!1;if("on-the-ground"===r&&"on-the-ground"===n)return!0;if(r!==n&&("on-the-ground"===r||"on-the-ground"===n))return!1;var i=f.needsElevationUpdates2D(n);return this.updateGraphics3DGraphicElevationInfo(e,t,function(){return i})},t.prototype.slicePlaneEnabledChanged=function(e,t){var r={slicePlaneEnabled:this._context.slicePlaneEnabled};return this._material.setParameterValues(r),!0},t.prototype.pixelRatioChanged=function(e,t){return!0},t.prototype._getOutlineGeometry=function(e,t){return t},t.prototype._getGeometry=function(e){var t=e.geometry;return"extent"===t.type&&(t=s.fromExtent(t)),t},t.prototype._createAs3DShape=function(e,t,r,n,s,l,u){var p=this._getGeometry(e),h=p[t],m=this._getOutlineGeometry(p,h),b=[],x=[],_=[],S=o.vec3f64.create(),w=new Array(6),C=f.getGeometryVertexData3D(m,p.hasZ,p.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,s);if(this._logGeometryCreationWarnings(C,h,t,"LineSymbol3DLayer"),m.length>0){for(var P=C.geometryData.outlines,E=C.eleVertexData,T=C.vertexData,O=0;O<P.length;++O){var A=P[O];if(!(A.count<=1)){var R=A.index,M=A.count;if(!this._context.clippingExtent||(f.computeBoundingBox(E,R,M,w),!f.boundingBoxClipped(w,this._context.clippingExtent))){f.chooseOrigin(T,R,M,S),f.subtractCoordinates(T,R,M,S);var I=new Float64Array(E.buffer,3*R*E.BYTES_PER_ELEMENT,3*M),D=new Float64Array(T.buffer,3*R*T.BYTES_PER_ELEMENT,3*M),V=v.createPolylineGeometry(D,I,"rings"===t,r,n),L=new g(V,l+"path"+O);L.singleUse=!0,b.push(L),x.push(this._material);var F=a.mat4f64.create();i.mat4.translate(F,F,S),_.push(F)}}}if(b.length>0){var B=new y({geometries:b,materials:x,transformations:_,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:u},idHint:l}),N=c.perVertexElevationAligner,U=new d(this,B,b,null,null,N,s);return U.alignedTerrainElevation=C.terrainElevation,U.needsElevationUpdates=f.needsElevationUpdates2D(s.mode),U}}return null},t.prototype._createAsOverlay=function(e,t,r,n,s,c,d){var p=this._getGeometry(e);this._material.renderPriority=this._symbolLayerOrder;var h=p[t],m=this._getOutlineGeometry(p,h),g=[],y=new Array(6),x=l.empty(),_=o.vec3f64.create(),S=f.getGeometryVertexDataDraped(m,p.spatialReference,this._context.overlaySR);if(this._logGeometryCreationWarnings(S,h,t,"LineSymbol3DLayer"),m.length>0){for(var w=S.vertexData,C=S.geometryData.outlines,P=0;P<C.length;++P){var E=C[P],T=E.index,O=E.count;if(f.computeBoundingBox(w,T,O,y),!f.boundingBoxClipped(y,this._context.clippingExtent)){l.expand(x,y),f.chooseOrigin(w,T,O,_),f.subtractCoordinates(w,T,O,_),f.setZ(w,T,O,this._getDrapedZ());var A=new Float64Array(w.buffer,3*T*w.BYTES_PER_ELEMENT,3*O),R=a.mat4f64.create();i.mat4.translate(R,R,_);var M=v.createPolylineGeometry(A,null,"rings"===t,r,n),I=new b(M);I.data.layerUid=d,I.data.graphicUid=e.uid,I.material=this._material,I.center=[.5*(y[0]+y[3]),.5*(y[1]+y[4]),0],I.bsRadius=.5*Math.sqrt((y[3]-y[0])*(y[3]-y[0])+(y[4]-y[1])*(y[4]-y[1])),I.transformation=R,I.name=c,I.uniqueName=c+"#"+M.id,g.push(I)}}return new u(this,g,x)}return null},t}(p.default);t.Graphics3DLineSymbolLayer=_,t.default=_}.apply(null,n))||(e.exports=i)},uNX8:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("1m5D"),r("MzcX"),r("ff/U"),r("pbva"),r("PwS/"),r("QFi0"),r("Kfys"),r("z2+Q")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c){function u(e,t){var r=new Map,n=function(e,t){var n=e.origin.id,i=e.data.id,a=r.get(n);a||(a={origin:e.origin.vec3,deltaByGeometry:new Map},r.set(n,a));var o=a.deltaByGeometry.get(i);o||(o={renderData:e.data,toAdd:[],toRemove:[]},a.deltaByGeometry.set(i,o)),(t?o.toAdd:o.toRemove).push(e)};return e.forEach(function(e){n(e,!0)}),t.forEach(function(e){n(e,!1)}),r}function d(e,t,r){var n=t.elementCount(e),i=t.allocate(n);t.write({},e,null,i,0),r.setData(i.buffer)}return function(){function e(e,t,r){this._dataByOrigin=new Map,this._highlightCount=0,this._rctx=e,this._material=r,this._materialRep=t,this._glMaterials=o.acquireMaterials(this._material,this._materialRep),this._bufferWriter=r.createBufferWriter()}return e.prototype.dispose=function(){o.releaseMaterials(this._material,this._materialRep)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlightCount>0},enumerable:!0,configurable:!0}),e.prototype.renderPriority=function(){return this._material.renderPriority},e.prototype.modify=function(e){this.updateGeometries(e.toUpdate),this.addAndRemoveGeometries(e.toAdd,e.toRemove),this.updateHighlightCount()},e.prototype.addAndRemoveGeometries=function(e,t){var f=this._rctx,p=this._bufferWriter,h=this._dataByOrigin,v=u(e,t),m=p.vertexBufferLayout;v.forEach(function(e,t){var u=h.get(t);u||(u={origin:e.origin,highlightCount:0,dataByGeometry:new Map},h.set(t,u)),e.deltaByGeometry.forEach(function(e,t){var h=u.dataByGeometry.get(t);!h&&e.toAdd.length>0&&(h={vao:new c(f,i.Default3D,{geometry:n.glLayout(m)},{geometry:s.createVertex(f,35044)}),vertexCount:0,instances:new Map,highlightCount:0},d(e.renderData,p,h.vao.vertexBuffers.geometry),h.vertexCount=l.vertexCount(h.vao,"geometry"),u.dataByGeometry.set(t,h));var v=h.instances;e.toAdd.forEach(function(e){var t=r.mat4f64.create();o.calculateTransformRelToOrigin(e,t);var n=o.generateRenderGeometryVisibleIndexRanges(e),i=o.generateRenderGeometryHighlightRanges(e),s=new a(e.name,0,h.vertexCount,n,i,t,e.instanceParameters,e.idx,e.data.id);v.set(e.uniqueName,s),u.highlightCount=null,h.highlightCount=null}),e.toRemove.forEach(function(e){v.delete(e.uniqueName)}),0===v.size&&(h.vao.dispose(),u.dataByGeometry.delete(t))}),0===u.dataByGeometry.size&&h.delete(t)})},e.prototype.updateGeometries=function(e){var t=this._dataByOrigin,r=this._bufferWriter;e.forEach(function(e){var n=e.updateType,i=e.renderGeometry,a=t.get(i.origin.id),s=a&&a.dataByGeometry.get(i.data.id),l=s&&s.instances.get(i.uniqueName);l&&(1&n&&(l.displayedIndexRange=o.generateRenderGeometryVisibleIndexRanges(i)),17&n&&(l.highlightedIndexRanges=o.generateRenderGeometryHighlightRanges(i),a.highlightCount=null,s.highlightCount=null),2&n&&d(i.data,r,s.vao.vertexBuffers.geometry),4&n&&o.calculateTransformRelToOrigin(i,l.transformation,l.transformationNormal))})},e.prototype.updateHighlightCount=function(){var e=this;this._highlightCount=0,this._dataByOrigin.forEach(function(t){if(null==t.highlightCount){var r=0;t.dataByGeometry.forEach(function(e){if(null==e.highlightCount){var t=0;e.instances.forEach(function(e){e.highlightedIndexRanges&&++t}),e.highlightCount=t}r+=e.highlightCount}),t.highlightCount=r}e._highlightCount+=t.highlightCount})},e.prototype.render=function(e,t,r,n){var i=this,a=this._rctx,o=this._glMaterials.get(t.pass),s=4===t.pass;if(!o||null!=e&&!o.beginSlot(e)||s&&0===this._highlightCount)return!1;o.bind(a,r);var l=!1;return this._dataByOrigin.forEach(function(e){s&&0===e.highlightCount||(r.origin=e.origin,o.bindView(a,r),e.dataByGeometry.forEach(function(e){l=s?i.renderHighlightPass(o,e,n)||l:i.renderDefaultPass(o,e,n)||l}))}),a.bindVAO(null),o.release(a,r),l},e.prototype.renderDefaultPass=function(e,t,r){var n=this._rctx,i=e.getProgram(),a=e.getDrawMode(),s=t.vao,c=t.vertexCount;l.assertCompatibleVertexAttributeLocations(s,i),n.bindVAO(s);var u=!1;return t.instances.forEach(function(t){var i=t.displayedIndexRange;i&&0===i.length||(e.bindInstance(n,t),i?o.drawArraysFaceRange(n,i,0,a,r):o.drawArrays(n,a,0,c,r),u=!0)}),u},e.prototype.renderHighlightPass=function(e,t,r){var n=this._rctx,i=e.getProgram(),a=e.getDrawMode(),s=t.vao,c=t.vertexCount;if(0!==t.highlightCount){l.assertCompatibleVertexAttributeLocations(s,i),n.bindVAO(s);var u=!1;return t.instances.forEach(function(t){var i=t.highlightedIndexRanges;if(i&&0!==i.length){e.bindInstance(n,t);for(var s=0;s<i.length;s++){var l=i[s],d=l.range?l.range[0]:0,f=l.range?l.range[1]-l.range[0]+1:c;o.drawArrays(n,a,d,f,r),u=!0}}}),u}},e}()}.apply(null,n))||(e.exports=i)},uwSd:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BASE_TEXTURE_UNIT=33984}.apply(null,n))||(e.exports=i)},"v+3j":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("1f+t")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.acquireGLMaterials=function(e,t){var r={};return r[0]=t.aquire(e,"color"),r[3]=t.aquire(e,"depthShadowMap"),r[2]=t.aquire(e,"normal"),r[1]=t.aquire(e,"depth"),r[4]=t.aquire(e,"highlight"),r},t.releaseGLMaterials=function(e,t){t.release(e.id,"color"),t.release(e.id,"depthShadowMap"),t.release(e.id,"normal"),t.release(e.id,"depth"),t.release(e.id,"highlight")},t.encodeDoubleVec3=function(e,t,a,o,s){n[0]=e.get(t,0),n[1]=e.get(t,1),n[2]=e.get(t,2),r.encodeDoubleArray(n,i,3),a.set(s,0,i[0]),o.set(s,0,i[1]),a.set(s,1,i[2]),o.set(s,1,i[3]),a.set(s,2,i[4]),o.set(s,2,i[5])};var n=new Float64Array(3),i=new Float32Array(6)}.apply(null,n))||(e.exports=i)},veTl:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("7laH")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.load=function(e,t){if(r.default(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;var n=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return n?{createVertexArray:n.createVertexArrayOES.bind(n),deleteVertexArray:n.deleteVertexArrayOES.bind(n),bindVertexArray:n.bindVertexArrayOES.bind(n)}:null}}.apply(null,n))||(e.exports=i)},vjUK:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){function r(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function n(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function i(e){for(var t=r(e),n=e.length,i=0,a=0,o=e;a<o.length;a++){var s=o[a];i+=Math.pow(s-t,2)}return n>1?i/(n-1):0}Object.defineProperty(t,"__esModule",{value:!0}),t.aggregateFunction=function(e,t){var r=a[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isAggregate=function(e,t){var r=a[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var a={min:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.min.apply(Math,e[0])}},max:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.max.apply(Math,e[0])}},avg:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:r(e[0])}},sum:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:n(e[0])}},stddev:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sqrt(i(e[0]))}},count:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].length}},var:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:i(e[0])}}}}.apply(null,n))||(e.exports=i)},w00x:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ma1f")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,r){void 0===r&&(r=""),this.major=e,this.minor=t,this._context=r}return e.prototype.lessThan=function(e,t){return this.major<e||e===this.major&&this.minor<t},e.prototype.since=function(e,t){return!this.lessThan(e,t)},e.prototype.validate=function(e){if(this.major!==e.major){var t=this._context&&this._context+":",n=this._context&&this._context+" ";throw new r(t+"unsupported-version","Required major "+n+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:e})}},e.prototype.clone=function(){return new e(this.major,this.minor,this._context)},e.parse=function(t,n){void 0===n&&(n="");var i=t.split("."),a=i[0],o=i[1],s=/^\s*\d+\s*$/;if(!a||!a.match||!a.match(s))throw new r((n&&n+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!o||!o.match||!o.match(s))throw new r((n&&n+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});return new e(parseInt(a,10),parseInt(o,10),n)},e}();t.Version=n}.apply(null,n))||(e.exports=i)},w9Zc:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),n=0,i=Object.keys(e);n<i.length;n++){var a=i[n];if(a.toLowerCase()===r)return e[a]}return null}}.apply(null,n))||(e.exports=i)},wCQF:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("qsST"),r("dZE1"),r("l8Vi")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=r.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");t.make=function(e,t){if(!n.isCalloutSupport(e))return a.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+e.type+"' does not support callouts"),null;if(!e.callout)return null;var r=o[e.callout.type];return r?new r(e,t):(a.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+e.callout.type),null)};var o={line:i.default}}.apply(null,n))||(e.exports=i)},wKWA:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.maxCount=e,this._nextIndex=0,this.recycledIndices=[]}return Object.defineProperty(e.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0}),e.prototype.aquire=function(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0},e.prototype.release=function(e){this.recycledIndices.push(e)},e}();t.SimpleIndexManager=r}.apply(null,n))||(e.exports=i)},wR99:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.data=e,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}return e.prototype.readUint32=function(){var e=this.offset4;return this.offset4+=1,this.dataUint32[e]},e.prototype.readUint8Array=function(e){var t=4*this.offset4;return this.offset4+=e/4,new Uint8Array(this.data,t,e)},e.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4},e}();t.BinaryStreamReader=r}.apply(null,n))||(e.exports=i)},"wSO/":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("6DRN"),r("51bw"),r("1m5D"),r("lLWD"),r("DIqE"),r("Rdxj"),r("O7NG")],void 0===(i=function(e,t,r,n,i,a,o,s,l){Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t,n){var i=this;this.itemByteSize=e,this.itemCreate=t,this.buffers=[],this.items=[],this.itemsPerBuffer=0,this.itemsPtr=0,this.itemsPerBuffer=Math.ceil(n/this.itemByteSize),this.tickHandle=r.before(function(){return i.reset()})}return e.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null),this.itemsPtr=0,this.items=null,this.buffers=null},e.prototype.get=function(){0===this.itemsPtr&&r(function(){});for(var e=Math.floor(this.itemsPtr/this.itemsPerBuffer);this.buffers.length<=e;){for(var t=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),n=0;n<this.itemsPerBuffer;++n)this.items.push(this.itemCreate(t,n*this.itemByteSize));this.buffers.push(t)}return this.items[this.itemsPtr++]},e.prototype.reset=function(){for(var e=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>e;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0},e.createVec2f64=function(t){return void 0===t&&(t=u),new e(16,o.vec2f64.createView,t)},e.createVec3f64=function(t){return void 0===t&&(t=u),new e(24,s.vec3f64.createView,t)},e.createVec4f64=function(t){return void 0===t&&(t=u),new e(32,l.vec4f64.createView,t)},e.createMat3f64=function(t){return void 0===t&&(t=u),new e(72,n.mat3f64.createView,t)},e.createMat4f64=function(t){return void 0===t&&(t=u),new e(128,i.mat4f64.createView,t)},e.createQuatf64=function(t){return void 0===t&&(t=u),new e(32,a.quatf64.createView,t)},Object.defineProperty(e.prototype,"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!0,configurable:!0}),e}();t.VectorStack=c;var u=4096}.apply(null,n))||(e.exports=i)},weRx:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("zp6E")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),i=new Uint8Array(n),a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return new Blob([n],{type:r})},t.requestImage=function(e){return r(e,{responseType:"image"}).then(function(e){return e.data})}}.apply(null,n))||(e.exports=i)},weYu:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xf8T"),r("SgdR"),r("jaBu"),r("qysZ"),r("VIrK"),r("bH65")],void 0===(i=function(e,t,r,n,i,a,o,s){function l(e,t,r){r*=.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function c(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],l=r[1],c=r[2],u=r[3];return e[0]=n*u+o*s+i*c-a*l,e[1]=i*u+o*l+a*s-n*c,e[2]=a*u+o*c+n*l-i*s,e[3]=o*u-n*s-i*l-a*c,e}function u(e,t,r,n){var i,o,s,l,c,u=t[0],d=t[1],f=t[2],p=t[3],h=r[0],v=r[1],m=r[2],g=r[3];return(o=u*h+d*v+f*m+p*g)<0&&(o=-o,h=-h,v=-v,m=-m,g=-g),1-o>a.EPSILON?(i=Math.acos(o),s=Math.sin(i),l=Math.sin((1-n)*i)/s,c=Math.sin(n*i)/s):(l=1-n,c=n),e[0]=l*u+c*h,e[1]=l*d+c*v,e[2]=l*f+c*m,e[3]=l*p+c*g,e}function d(e,t){var r,n=t[0]+t[4]+t[8];if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*o+o]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*a+o]-t[3*o+a])*r,e[a]=(t[3*a+i]+t[3*i+a])*r,e[o]=(t[3*o+i]+t[3*i+o])*r}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=l,t.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),n=Math.sin(r/2);return n>a.EPSILON?(e[0]=t[0]/n,e[1]=t[1]/n,e[2]=t[2]/n):(e[0]=1,e[1]=0,e[2]=0),r},t.multiply=c,t.rotateX=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+o*s,e[1]=i*l+a*s,e[2]=a*l-i*s,e[3]=o*l-n*s,e},t.rotateY=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l-a*s,e[1]=i*l+o*s,e[2]=a*l+n*s,e[3]=o*l-i*s,e},t.rotateZ=function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*s,e[1]=i*l-n*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},t.calculateW=function(e,t){var r=t[0],n=t[1],i=t[2];return e[0]=r,e[1]=n,e[2]=i,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),e},t.slerp=u,t.random=function(e){var t=a.RANDOM(),r=a.RANDOM(),n=a.RANDOM(),i=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=i*Math.sin(2*Math.PI*r),e[1]=i*Math.cos(2*Math.PI*r),e[2]=o*Math.sin(2*Math.PI*n),e[3]=o*Math.cos(2*Math.PI*n),e},t.invert=function(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=a*s,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=d,t.fromEuler=function(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(r),l=Math.cos(r),c=Math.sin(n),u=Math.cos(n);return e[0]=a*l*u-o*s*c,e[1]=o*s*u+a*l*c,e[2]=o*l*c-a*s*u,e[3]=o*l*u+a*s*c,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.copy=s.copy,t.set=s.set,t.add=s.add,t.mul=c,t.scale=s.scale,t.dot=s.dot,t.lerp=s.lerp,t.length=s.length,t.len=t.length,t.squaredLength=s.squaredLength,t.sqrLen=t.squaredLength,t.normalize=s.normalize,t.exactEquals=s.exactEquals,t.equals=s.equals,t.rotationTo=function(e,r,n){var i=o.dot(r,n);return i<-.999999?(o.cross(f,p,r),o.len(f)<1e-6&&o.cross(f,h,r),o.normalize(f,f),l(e,f,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(o.cross(f,r,n),e[0]=f[0],e[1]=f[1],e[2]=f[2],e[3]=1+i,t.normalize(e,e))};var f=i.create(),p=i.fromValues(1,0,0),h=i.fromValues(0,1,0);t.sqlerp=function(e,t,r,n,i,a){return u(v,t,i,a),u(m,r,n,a),u(e,v,m,2*a*(1-a)),e};var v=n.create(),m=n.create();t.setAxes=function(e,r,n,i){var a=g;return a[0]=n[0],a[3]=n[1],a[6]=n[2],a[1]=i[0],a[4]=i[1],a[7]=i[2],a[2]=-r[0],a[5]=-r[1],a[8]=-r[2],t.normalize(e,d(e,a))};var g=r.create()}.apply(null,n))||(e.exports=i)},"x+x8":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("ycL1"),r("Vx27")],void 0===(i=function(e,t,r,n,i,a){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this)||this}return r(t,e),t.prototype.clone=function(){throw new Error("not implemented")},n([a.property({readOnly:!0,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0,enabled:!0}}})],t.prototype,"type",void 0),n([a.subclass("esri.geometry.support.MeshColor")],t)}(a.declared(i));t.MeshColor=o,t.default=o}.apply(null,n))||(e.exports=i)},xFEL:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("jBNx"),r("YX1r"),r("51bw"),r("FXVB"),r("1m5D"),r("W9tT"),r("DIqE"),r("0LE5"),r("Rdxj"),r("qvwY"),r("lRq4"),r("2B1V"),r("rjU6"),r("9FJH"),r("FNtW"),r("+wMf"),r("CIy2"),r("hnAi"),r("s6rJ"),r("ZeO9"),r("Yr/n"),r("qbr3")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b,x,_,S,w,C){function P(e,t,r){var n=r.cameraAboveGround?1:-1;e.setUniform1f("cameraGroundRelative",n),e.setUniform1f("polygonOffset",t.shaderPolygonOffset),e.setUniform4fv("viewport",r.viewport),e.setUniform1f("perDistancePixelRatio",Math.tan(r.fovY/2)/(r.viewport[2]/2)),_.bindVerticalOffset(t.verticalOffset,r,e),e.setUniformMatrix4fv("viewNormal",r.viewInvTransp),t.screenSizePerspective&&(_.bindScreenSizePerspective(t.screenSizePerspective,e,"screenSizePerspective"),_.bindScreenSizePerspective(t.screenSizePerspectiveAlignment||t.screenSizePerspective,e,"screenSizePerspectiveAlignment"))}function E(e,t,r,n){r.occlusionTest&&(t.setUniform1i("hudVisibilityTexture",1),e.bindTexture(n.hudVisibilityTexture,1),e.setActiveTexture(0)),t.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===n.renderTransparentlyOccludedHUD?1:"notOccluded"===n.renderTransparentlyOccludedHUD?0:.75);var i=n.pixelRatio||1;t.setUniform4fv("overrideColor",r.color),t.setUniform1f("pixelRatio",i),r.textureIsSignedDistanceField&&(t.setUniform4fv("outlineColor",r.outlineColor),t.setUniform1f("outlineSize",r.outlineSize)),r.vvSizeEnabled&&(t.setUniform3fv("vvSizeMinSize",r.vvSizeMinSize),t.setUniform3fv("vvSizeMaxSize",r.vvSizeMaxSize),t.setUniform3fv("vvSizeOffset",r.vvSizeOffset),t.setUniform3fv("vvSizeFactor",r.vvSizeFactor)),r.vvColorEnabled&&(t.setUniform1fv("vvColorValues",r.vvColorValues),t.setUniform4fv("vvColorColors",r.vvColorColors)),t.setUniform2f("screenOffset",2*r.screenOffset[0]*i,2*r.screenOffset[1]*i),t.setUniform2fv("anchorPos",T(r))}function T(e,t){return void 0===t&&(t=L),e.textureIsSignedDistanceField?A(e.anchorPos,e.distanceFieldBoundingBox,t):l.vec2.copy(t,e.anchorPos),t}function O(e,t,r,n){return void 0===n&&(n=L),l.vec2.copy(n,e.anchorPos),n[0]*=-t[0],n[1]*=-t[1],n[0]+=e.screenOffset[0]*r,n[1]+=e.screenOffset[1]*r,n}function A(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}function R(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+n*n),d=1/Math.sqrt(i*i+a*a+o*o),f=1/Math.sqrt(s*s+l*l+c*c);return e[0]=t*u,e[1]=r*u,e[2]=n*u,e[3]=i*d,e[4]=a*d,e[5]=o*d,e[6]=s*f,e[7]=l*f,e[8]=c*f,e}var M=function(e){function t(t,r){var n=e.call(this,r)||this;return n.params=_.copyParameters(t,Z),n}return r(t,e),t.prototype.dispose=function(){},t.prototype.setParameterValues=function(e){for(var t in e)"textureId"===t&&b.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[t]=e[t];this.notifyDirty("matChanged")},t.prototype.getParameters=function(){return this.params},t.prototype.intersect=function(e,t,r,n,i,a,o,s,l){l?this.intersectDrapedRenderHudGeometry(e,t,r,n,i,a,o,s):this.intersectHudGeometry(e,t,r,n,i,a,o,s)},t.prototype.intersectDrapedRenderHudGeometry=function(e,t,r,n,i,a,o,s){var l=e.getAttribute(b.VertexAttrConstants.POSITION),c=e.getAttribute(b.VertexAttrConstants.SIZE),d=this.params,f=T(d),p=1,h=1;if(s){var v=s(W);p=v[0],h=v[5]}p*=e.pixelRatio,h*=e.pixelRatio;for(var m=X*e.pixelRatio,g=0;g<l.data.length/l.size;g++){var y=g*l.size;u.vec3.set(F,l.data[y],l.data[y+1],l.data[y+2]);var x=g*c.size;Y[0]=c.data[x]*p,Y[1]=c.data[x+1]*h;var _=F[0],S=F[1],w=void 0;d.textureIsSignedDistanceField&&(w=d.outlineSize*e.pixelRatio/2),this._isInsideIconBoundaries(a,_,S,m,w,d,f)&&o()}},t.prototype.intersectHudGeometry=function(e,t,r,n,a,s,l,c){if(n.enable.selectionMode&&n.enable.hud&&!v.isAllHidden(t.componentVisibilities,e.componentOffsets)){var f=e.data,p=this.params,h=1,m=1;if(i.mat3.fromMat4(j,r),c){var g=c(W);h=g[0],m=g[5],R(j)}var x=f.getVertexAttr()[b.VertexAttrConstants.POSITION],_=f.getVertexAttr()[b.VertexAttrConstants.SIZE],S=f.getVertexAttr()[b.VertexAttrConstants.NORMAL],w=f.getVertexAttr()[b.VertexAttrConstants.AUXPOS1];b.assert(x.size>=3);var C=n.point,P=n.camera,E=T(p);h*=P.pixelRatio,m*=P.pixelRatio;for(var O="screen"===this.params.centerOffsetUnits,A=0;A<x.data.length/x.size;A++){var M=A*x.size;u.vec3.set(F,x.data[M],x.data[M+1],x.data[M+2]),u.vec3.transformMat4(F,F,r);var I=A*_.size;Y[0]=_.data[I]*h,Y[1]=_.data[I+1]*m,u.vec3.transformMat4(F,F,P.viewMatrix);var D=A*w.size;if(u.vec3.set(H,w.data[D+0],w.data[D+1],w.data[D+2]),!O&&(F[0]+=H[0],F[1]+=H[1],0!==H[2])){var L=H[2];u.vec3.normalize(H,F),u.vec3.subtract(F,F,u.vec3.scale(H,H,L))}var U=A*S.size;if(u.vec3.set(B,S.data[U],S.data[U+1],S.data[U+2]),this.applyVerticalOffsetTransformation(F,B,j,P,V),P.applyProjection(F,N),N[0]>-1){var k=Math.floor(N[0])+this.params.screenOffset[0],X=Math.floor(N[1])+this.params.screenOffset[1];O&&(k+=H[0],0!==H[1]&&(X+=y.applyScaleFactor(H[1],V.factorAlignment))),y.applyPrecomputedScaleFactorVec2(Y,V.factor,Y);var Q=q*P.pixelRatio,Z=void 0;if(p.textureIsSignedDistanceField&&(Z=p.outlineSize*P.pixelRatio/2),this._isInsideIconBoundaries(C,k,X,Q,Z,p,E)){var J=n.ray;u.vec3.transformMat4(z,F,o.mat4.invert(G,P.viewMatrix)),N[0]=C[0],N[1]=C[1],P.unprojectPoint(N,F);var K=d.vec3f64.create();u.vec3.copy(K,J.direction);var $=1/u.vec3.length(K);u.vec3.scale(K,K,$),l(u.vec3.distance(J.origin,F)*$,K,-1,1,!0,z)}}}}},t.prototype._isInsideIconBoundaries=function(e,t,r,n,i,a,o){var s=t-n-(o[0]>0?Y[0]*o[0]:0),l=s+Y[0]+2*n,c=r-n-(o[1]>0?Y[1]*o[1]:0),u=c+Y[1]+2*n;if(a.textureIsSignedDistanceField){var d=a.distanceFieldBoundingBox;s+=Y[0]*d[0],c+=Y[1]*d[1],l-=Y[0]*(1-d[2]),u-=Y[1]*(1-d[3]),s-=i,l+=i,c-=i,u+=i}return e[0]>s&&e[0]<l&&e[1]>c&&e[1]<u},t.prototype.createBufferWriter=function(){return new K(this)},t.prototype.createRenderer=function(e,t){return new S(e,t,this)},t.prototype.normalAndViewAngle=function(e,t,r,n){return void 0===n&&(n=k),u.vec3.transformMat3(n.normal,e,t),u.vec3.transformMat4(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=u.vec3.dot(U,Q),n},t.prototype.updateScaleInfo=function(e,t,r){var n=this.params;n.screenSizePerspective?e.factor=y.precomputeScaleFactor(k.cosAngle,r,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment?e.factorAlignment=y.precomputeScaleFactor(k.cosAngle,r,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)},t.prototype.applyVerticalOffsetTransformation=function(e,t,r,n,a,o){var s=this.params;if(f.isMat4(r)&&(r=i.mat3.fromMat4(j,r)),!s.verticalOffset||!s.verticalOffset.screenLength){if(a&&(s.screenSizePerspective||s.screenSizePerspectiveAlignment)){var l=this.normalAndViewAngle(t,r,n),c=u.vec3.length(e);this.updateScaleInfo(a,l.cosAngle,c)}else a&&(a.factor.scale=1,a.factorAlignment.scale=1);return o?u.vec3.copy(o,e):e}var d=this.normalAndViewAngle(t,r,n),p=u.vec3.length(e),h=s.screenSizePerspectiveAlignment||s.screenSizePerspective,v=_.verticalOffsetAtDistance(n,p,s.verticalOffset,d.cosAngle,h);return a&&this.updateScaleInfo(a,d.cosAngle,p),u.vec3.add(o||e,e,u.vec3.scale(d.normal,d.normal,v))},t.prototype.getGLMaterials=function(){return{color:I,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:D}},t.prototype.getAllTextureIds=function(){return[this.params.textureId]},t.prototype.calculateRelativeScreenBounds=function(e,t,r){return void 0===r&&(r=p.create()),O(this.params,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r},t.prototype.calculateAnchorPosForRendering=function(e){return T(this.params,e)},t.shouldRenderVisibilityDuringRenderPass=function(e){return 0===e||4},t}(g),I=function(e){function t(t,r,n){var i=e.call(this,t,r,n,t.getParameters().textureId)||this;return i.isOcclusionSlot=!1,i.updateParameters(),i}return r(t,e),t.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?16:15},t.prototype.selectProgram=function(){var e=this.params;this.occlusionProgram=this.programRep.getProgram(w.occlusionPass,{verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,slice:e.slicePlaneEnabled}),this.renderProgram=this.programRep.getProgram(w.colorPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,debugDrawBorder:!!e.debugDrawBorder,slice:e.slicePlaneEnabled}),this.renderPipelineState=C.makePipelineState({blending:C.simpleBlendingParams(1,771),polygonOffset:e.polygonOffset&&$,depthTest:{func:515},depthWrite:C.defaultDepthWriteParams,colorWrite:C.defaultColorWriteParams}),this.occlusionPipelineState=C.makePipelineState({depthTest:{func:515},depthWrite:C.defaultDepthWriteParams,colorWrite:C.defaultColorWriteParams})},t.prototype.beginSlot=function(e){return this.params.occlusionTest?(this.isOcclusionSlot=10===e,10===e||e===this.mainSlot):(this.isOcclusionSlot=!1,e===this.mainSlot)},t.prototype.getProgram=function(){return this.isOcclusionSlot?this.occlusionProgram:this.renderProgram},t.prototype.getPrograms=function(){return[this.occlusionProgram,this.renderProgram]},t.prototype.updateParameters=function(){this.params=_.copyParameters(this.material.getParameters()),this.updateTexture(this.params.textureId),this.selectProgram(),this.selectSlot()},t.prototype.bind=function(e,t){if(this.isOcclusionSlot){var r=this.occlusionProgram;e.bindProgram(r),e.setPipelineState(this.occlusionPipelineState),P(r,this.params,t),r.setUniform4f("color",1,1,1,1),r.setUniform1f("pixelRatio",t.pixelRatio||1)}else{r=this.renderProgram;e.bindProgram(r),e.setPipelineState(this.renderPipelineState),this.bindTexture(e,r),this.bindTextureScale(e,r),P(r,this.params,t),E(e,r,this.params,t)}},t.prototype.bindView=function(e,t){var r=t.origin,n=this.getProgram();_.bindView(r,t.view,n),_.bindCamPos(r,t.viewInvTransp,n),this.params.slicePlaneEnabled&&_.bindSlicePlane(t.origin,t.slicePlane,n)},t.prototype.bindInstance=function(e,t){var r=this.getProgram();r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.release=function(e){},t.prototype.getDrawMode=function(){return this.isOcclusionSlot?0:4},t}(m),D=function(e){function t(t,r,n){var i=e.call(this,t,r,n,t.getParameters().textureId)||this;return i.updateParameters(),i}return r(t,e),t.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?16:15},t.prototype.beginSlot=function(e){return e===this.mainSlot},t.prototype.getProgram=function(){return this.program},t.prototype.updateParameters=function(){this.params=_.copyParameters(this.material.getParameters()),this.updateTexture(this.params.textureId),this.selectProgram(),this.selectSlot()},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(w.highlightPass,{occlTest:e.occlusionTest,sdf:e.textureIsSignedDistanceField,vvSize:!!e.vvSizeEnabled,vvColor:!!e.vvColorEnabled,verticalOffset:!!e.verticalOffset,screenSizePerspective:!!e.screenSizePerspective,centerOffsetUnitsScreen:"screen"===e.centerOffsetUnits,binaryHighlightOcclusion:e.binaryHighlightOcclusion,slice:e.slicePlaneEnabled}),this.pipelineState=C.makePipelineState({blending:C.separateBlendingParams(1,1,771,771),polygonOffset:e.polygonOffset&&$,depthTest:{func:513},colorWrite:C.defaultColorWriteParams})},t.prototype.bind=function(e,t){var r=this.program;e.bindProgram(r),e.setPipelineState(this.pipelineState),this.bindTexture(e,r),this.bindTextureScale(e,r),P(r,this.params,t),E(e,r,this.params,t),_.bindHighlightRendering(e,t,this.program)},t.prototype.bindView=function(e,t){var r=t.origin,n=this.getProgram();_.bindView(r,t.view,n),_.bindCamPos(r,t.viewInvTransp,n),this.params.slicePlaneEnabled&&_.bindSlicePlane(t.origin,t.slicePlane,n)},t.prototype.bindInstance=function(e,t){var r=this.getProgram();r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.release=function(e){},t.prototype.getDrawMode=function(){return 4},t}(m),V={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},L=c.vec2f64.create(),F=d.vec3f64.create(),B=d.vec3f64.create(),N=n.createRenderScreenPointArray3(),U=d.vec3f64.create(),z=d.vec3f64.create(),j=a.mat3f64.create(),G=s.mat4f64.create(),H=d.vec3f64.create(),k={normal:U,cosAngle:0},W=s.mat4f64.create();o.mat4.identity(W);var q=1,X=2,Y=[0,0],Q=d.vec3f64.fromValues(0,0,1),Z={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:c.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},J=h.newLayout().vec3f(b.VertexAttrConstants.POSITION).vec3f(b.VertexAttrConstants.NORMAL).vec2f(b.VertexAttrConstants.UV0).vec4u8(b.VertexAttrConstants.COLOR).vec2f(b.VertexAttrConstants.SIZE).vec4f(b.VertexAttrConstants.AUXPOS1).vec4f(b.VertexAttrConstants.AUXPOS2),K=function(){function e(e){this.material=e,this.vertexBufferLayout=J}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return 6*e.indices[b.VertexAttrConstants.POSITION].length},e.prototype.write=function(e,t,r,n,i){x.writePosition(t.indices[b.VertexAttrConstants.POSITION],t.vertexAttr[b.VertexAttrConstants.POSITION].data,e.transformation,n.position,i,6),x.writeNormal(t.indices[b.VertexAttrConstants.NORMAL],t.vertexAttr[b.VertexAttrConstants.NORMAL].data,e.invTranspTransformation,n.normal,i,6);var a=t.vertexAttr[b.VertexAttrConstants.UV0].data,o=void 0,s=void 0,l=void 0,c=void 0;if(null==a||a.length<4){var u=this.material.getParameters();o=0,s=0,l=u.texCoordScale[0],c=u.texCoordScale[1]}else o=a[0],s=a[1],l=a[2],c=a[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);for(var d=t.indices[b.VertexAttrConstants.POSITION].length,f=n.uv0,p=i,h=0;h<d;++h)f.set(p,0,o),f.set(p,1,s),p+=1,f.set(p,0,l),f.set(p,1,s),p+=1,f.set(p,0,l),f.set(p,1,c),p+=1,f.set(p,0,l),f.set(p,1,c),p+=1,f.set(p,0,o),f.set(p,1,c),p+=1,f.set(p,0,o),f.set(p,1,s),p+=1;x.writeColor(t.indices[b.VertexAttrConstants.COLOR],t.vertexAttr[b.VertexAttrConstants.COLOR].data,4,n.color,i,6);var v=t.indices[b.VertexAttrConstants.SIZE],m=t.vertexAttr[b.VertexAttrConstants.SIZE].data,g=v.length,y=n.size;for(p=i,h=0;h<g;++h)for(var _=m[2*v[h]],S=m[2*v[h]+1],w=0;w<6;++w)y.set(p,0,_),y.set(p,1,S),p+=1;t.indices[b.VertexAttrConstants.AUXPOS1]&&t.vertexAttr[b.VertexAttrConstants.AUXPOS1]&&x.writeBufferVec4(t.indices[b.VertexAttrConstants.AUXPOS1],t.vertexAttr[b.VertexAttrConstants.AUXPOS1].data,n.auxpos1,i,6),t.indices[b.VertexAttrConstants.AUXPOS2]&&t.vertexAttr[b.VertexAttrConstants.AUXPOS2]&&x.writeBufferVec4(t.indices[b.VertexAttrConstants.AUXPOS2],t.vertexAttr[b.VertexAttrConstants.AUXPOS2].data,n.auxpos2,i,6)},e}(),$={factor:0,units:-4};return M}.apply(null,n))||(e.exports=i)},xf8T:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){return[1,0,0,0,1,0,0,0,1]},t.clone=function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},t.fromValues=function(e,t,r,n,i,a,o,s,l){return[e,t,r,n,i,a,o,s,l]},t.createView=function(e,t){return new Float64Array(e,t,9)}}.apply(null,n))||(e.exports=i)},xgKb:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("QFi0"),r("G0ER"),r("qbr3"),r("z2+Q")],void 0===(i=function(e,t,r,n,i,a){var o=function(){function e(e){this.isEnabled=!1,this.vertexAttributeLocations={position:0},this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],this.rctx=e}return e.prototype.enable=function(){if(this.isEnabled)return!0;var e=this.rctx;this.program=new n(e,s.shader.vertex,s.shader.fragment,this.vertexAttributeLocations),this.pipelineState=i.makePipelineState({colorWrite:i.defaultColorWriteParams});var t=new Float32Array([-1,-1,3,-1,-1,3]);return this.vao=new a(e,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new r(e,34962,35044,t)}),this.isEnabled=!0,!0},e.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)},e.prototype.render=function(e,t){this.enable();var r=this.rctx;r.bindVAO(this.vao),r.bindFramebuffer(t);var n={x:0,y:0,width:0,height:0};null!=t?(n.width=t.descriptor.width,n.height=t.descriptor.height):(n.width=r.gl.canvas.width,n.height=r.gl.canvas.height),r.bindProgram(this.program),r.setPipelineState(this.pipelineState),r.bindTexture(e.colorTexture,0),this.program.setUniform1i("uColorTexture",0),this.program.setUniform2f("uRcpFrameDimension",1/n.width,1/n.height),r.drawArrays(4,0,3)},e}(),s={shader:{vertex:"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate = (position + 1.0 ) * 0.5;\n        gl_Position = vec4(position, -1, 1);\n      }",fragment:"\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x = pos.x + float(off.x) * rcpFrame.x;\n        float y = pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -> actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN = FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW = FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM = FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE = FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS = FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN = FxaaLuma(rgbN);\n        float lumaW = FxaaLuma(rgbW);\n        float lumaM = FxaaLuma(rgbM);\n        float lumaE = FxaaLuma(rgbE);\n        float lumaS = FxaaLuma(rgbS);\n        float rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range = rangeMax - rangeMin;\n        if (range < max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL = abs(lumaL - lumaM);\n        float blendL = max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL = min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW = FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE = FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW = FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE = FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL += (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *= vec3(1.0/9.0);\n        float lumaNW = FxaaLuma(rgbNW);\n        float lumaNE = FxaaLuma(rgbNE);\n        float lumaSW = FxaaLuma(rgbSW);\n        float lumaSE = FxaaLuma(rgbSE);\n        float edgeVert =\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz =\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan = edgeHorz >= edgeVert;\n        float lengthSign = horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN = lumaW;\n          lumaS = lumaE;\n        }\n        float gradientN = abs(lumaN - lumaM);\n        float gradientS = abs(lumaS - lumaM);\n        lumaN = (lumaN + lumaM) * 0.5;\n        lumaS = (lumaS + lumaM) * 0.5;\n        if (gradientN < gradientS)\n        {\n          lumaN = lumaS;\n          lumaN = lumaS;\n          gradientN = gradientS;\n          lengthSign *= -1.0;\n        }\n        vec2 posN;\n        posN.x = pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y = pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *= FXAA_SEARCH_THRESHOLD;\n        vec2 posP = posN;\n        vec2 offNP = horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN = lumaN;\n        float lumaEndP = lumaN;\n        bool doneN = false;\n        bool doneP = false;\n        posN += offNP * vec2(-1.0, -1.0);\n        posP += offNP * vec2( 1.0,  1.0);\n        for(int i = 0; i < FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN = FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP = FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);\n          doneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);\n          if(doneN && doneP) { break; }\n          if(!doneN) {\n            posN -= offNP;\n          }\n          if(!doneP) {\n            posP += offNP;\n          }\n        }\n        float dstN = horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP = horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN = dstN < dstP;\n        lumaEndN = directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0)) {\n          lengthSign = 0.0;\n        }\n        float spanLength = (dstP + dstN);\n        dstN = directionN ? dstN : dstP;\n        float subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF = texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord = fCoordinate;\n        // if (screenCoord.x < 0.5) {\n          color.rgb = FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x < 0.501 && screenCoord.x > 0.499) {\n        //   color.rgb = vec3(1,0,0);\n        // } else {\n        //   color = texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a = 1.0;\n        gl_FragColor = color;\n      }"}};return o}.apply(null,n))||(e.exports=i)},xlkQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("xhoE"),r("fOZq")],void 0===(i=function(e,t,r,n){return function(e){function t(t){var r=e.call(this,t)||this;return r.centerPointInElevationSR=null,r}return r(t,e),t}(n)}.apply(null,n))||(e.exports=i)},xsp2:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("W0kZ")],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=new r;t.generateHighlightId=function(){return n.gen("highlight")}}.apply(null,n))||(e.exports=i)},yBJI:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("rjU6"),r("+nCE"),r("Kfys")],void 0===(i=function(e,t,r,n,i){function a(e){switch(e){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw new Error("Unhandled data type: "+e)}return function(){function e(t,o,s,l,c){void 0===s&&(s=null),void 0===l&&(l=e.DefaultOffsets),void 0===c&&(c=e.DefaultIndices),this.preinterleaved=!0,this.primitiveType="triangle",this._positionData=null;var u=i.getStride(o)/4,d=t.length/u;this._hasDefaultIndices=c===e.DefaultIndices,this._hasDefaultIndices&&(c=n.generateDefaultIndexArray(d));for(var f={},p=0,h=o;p<h.length;p++){var v=h[p],m=new(a(v.type))(t.buffer),g=i.getBytesPerElement(v.type),y=v.count,b=v.offset/g,x=v.stride/g;f[v.name]={data:m,size:y,offsetIdx:b,strideIdx:x}}s&&(this._positionData=s,f.position={data:s.data,size:3,offsetIdx:0,strideIdx:3}),this._id=n.getNewId(),this._vertexData=t,this._vertexAttributes=f,this._layout=o,this._indexData=c,this._componentOffsets=r.createOffsets(l),this._gpuMemoryUsage=t.byteLength+(this._hasDefaultIndices?0:c.byteLength),this._indexCount=c.length}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexCount",{get:function(){return this._indexCount},enumerable:!0,configurable:!0}),e.prototype.toRenderData=function(){var e={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,indexCount:this._indexCount,vertexData:this._vertexData,layout:this._layout};return this._vertexData=null,this._indexData=null,this._vertexAttributes={position:this._vertexAttributes.position},e},e.prototype.getIndices=function(e){return"position"===e&&this._positionData?this._positionData.indices:this._indexData},e.prototype.getAttribute=function(e){return this._vertexAttributes[e]},e.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage},Object.defineProperty(e.prototype,"hasPositionData",{get:function(){return!!this._positionData},enumerable:!0,configurable:!0}),e.DefaultOffsets=new Uint32Array(0),e.DefaultIndices=new Uint32Array(0),e}()}.apply(null,n))||(e.exports=i)},yJEJ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("H1tY"),r("KBgh"),r("Vx27"),r("RtHu")],void 0===(i=function(e,t,r,n,i,a,o,s,l){var c=function(e){function t(t){var r=e.call(this)||this;return r.index=new l.default(9,a("csp-restrictions")?function(e){return{minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),r.spatialReference=null,r}return r(t,e),t.prototype.destroy=function(){this.index.destroy(),this.index=null,u.prune()},t.prototype.queryGraphicUIDsInExtent=function(e,t,r){t.equals(this.spatialReference)&&(d.minX=e[0],d.minY=e[1],d.maxX=e[2],d.maxY=e[3],this.index.search(d,function(e){return r(e.graphic.uid)}))},t.prototype.add=function(e){!e.addedToSpatialIndex&&e.computeExtent(this.spatialReference)&&(this.index.insert(e),e.addedToSpatialIndex=!0)},t.prototype.addMany=function(e,t){void 0===t&&(t=e.length),u.clear();for(var r=0;r<t;r++){var n=e[r];!n.addedToSpatialIndex&&n.computeExtent(this.spatialReference)&&(u.push(n),n.addedToSpatialIndex=!0)}this.index.load(u.data,u.length)},t.prototype.remove=function(e){e.addedToSpatialIndex&&(e.addedToSpatialIndex=!1,this.index.remove(e))},t.prototype.clear=function(){this.index.clear()},n([s.property({constructOnly:!0})],t.prototype,"spatialReference",void 0),n([s.subclass("esri.views.3d.layers.graphics.Graphics3DSpatialIndex")],t)}(s.declared(i)),u=new o,d={minX:0,minY:0,maxX:0,maxY:0};return c}.apply(null,n))||(e.exports=i)},yVFQ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("3568")],void 0===(i=function(e,t,r){function n(e){return null!=e.cachedResult}function i(e){return"0"===e?0:null}Object.defineProperty(t,"__esModule",{value:!0}),t.createContext=function(e,t,n){var a=null,o=e&&e.expression;if("string"==typeof o){var s=i(o);if(null!=s)a={cachedResult:s};else{var l=r.createSyntaxTree(o);r.dependsOnView(l)?(null!=n&&n.error("Expressions containing '$view' are not supported on ElevationInfo"),a={cachedResult:0}):a={arcade:{func:r.createFunction(l),context:r.createExecContext(null,{sr:t})}}}}return a},t.createFeature=function(e,t){return r.createFeature(e.attributes,e.geometry,t)},t.setContextFeature=function(e,t){null==e||n(e)||r.updateExecContext(e.arcade.context,t)},t.execute=function(e){if(null!=e){if(n(e))return e.cachedResult;var t=e.arcade,i=r.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0},t.extractExpressionInfo=function(e,t){void 0===t&&(t=!1);var r=e&&e.featureExpressionInfo,n=r&&r.expression;return t||"0"===n||(r=null),r},t.zeroContext={cachedResult:0}}.apply(null,n))||(e.exports=i)},ybft:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("LxLY"),r("K9FT")],void 0===(i=function(e,t,r,n){function i(e,t){return"center"===e?.5*t:"right"===e?t:0}function a(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,r){void 0===r&&(r=2048),this.text=e,this.maxSize=r,this._renderPixelRatio=null,this._displayWidth=null,t instanceof n.default?this.parameters=t:this.parameters=new n.default(t),this.key=this.parameters.key+"--"+e,this.textLines=e.split(/\r?\n/),this.lineHeight=this.computeLineHeight()}return Object.defineProperty(e.prototype,"displayWidth",{get:function(){return r.isNone(this._displayWidth)&&(this._displayWidth=this.computeTextWidth()),this._displayWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayHeight",{get:function(){return this.lineHeight*this.textLines.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedWidth",{get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedHeight",{get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedLineHeight",{get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedFontSize",{get:function(){return this.parameters.definition.size*this.renderPixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderedHaloSize",{get:function(){return this.parameters.haloSize*this.renderPixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderPixelRatio",{get:function(){if(r.isNone(this._renderPixelRatio)){var e=this.parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this.maxSize/(this.displayWidth*e),this.maxSize/(this.displayHeight*e))):this._renderPixelRatio=e}return this._renderPixelRatio},enumerable:!0,configurable:!0}),e.prototype.render=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=0);var n=this.renderedLineHeight,a=this.renderedHaloSize,o=i(e.textAlign,this.renderedWidth)+a,s=a;e.save(),a>0&&this.renderHalo(e,o,s,t,r),this.setFontProperties(e,this.renderedFontSize),r+=s,t+=o;for(var l=0,c=this.textLines;l<c.length;l++){var u=c[l];e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",e.fillText(u,t,r),e.globalCompositeOperation="source-over",e.fillStyle=this.parameters.fillStyle,e.fillText(u,t,r),r+=n}e.restore()},e.prototype.renderHalo=function(e,t,r,n,i){var o=this.renderedWidth,s=this.renderedHeight,l=a(c,Math.max(o,u),Math.max(s,u)),d=l.getContext("2d");d.clearRect(0,0,o,s),this.setFontProperties(d,this.renderedFontSize),d.fillStyle=this.parameters.haloStyle,d.strokeStyle=this.parameters.haloStyle;var f=this.renderedHaloSize<3;d.lineJoin=f?"miter":"round",f?this.renderHaloEmulated(d,t,r):this.renderHaloNative(d,t,r),e.globalAlpha=this.parameters.definition.halo.color[3],e.drawImage(l,0,0,o,s,n,i,o,s),e.globalAlpha=1},e.prototype.renderHaloEmulated=function(e,t,r){for(var n=this.renderedLineHeight,i=this.renderedHaloSize,a=0,o=this.textLines;a<o.length;a++){for(var l=o[a],c=0,u=s;c<u.length;c++){var d=u[c],f=d[0],p=d[1];e.fillText(l,t+i*f,r+i*p)}r+=n}},e.prototype.renderHaloNative=function(e,t,r){for(var n=this.renderedLineHeight,i=this.renderedHaloSize,a=0,o=this.textLines;a<o.length;a++){for(var s=o[a],l=2*i,c=0;c<5;c++){var u=.6+.1*c;e.lineWidth=u*l,e.strokeText(s,t,r)}r+=n}},e.prototype.setFontProperties=function(e,t){var r=this.parameters.definition.font,n=r.style+" "+r.weight+" "+t+"px "+r.family+", sans-serif";e.font=n,e.textAlign="left",e.textBaseline="top"},e.prototype.computeTextWidth=function(){var e=a(c,u,u).getContext("2d");this.setFontProperties(e,this.parameters.definition.size);for(var t=0,r=0,n=this.textLines;r<n.length;r++){var i=n[r];t=Math.max(t,e.measureText(i).width)}var o=this.parameters.definition.font;return("italic"===o.style||"oblique"===o.style||"string"==typeof o.weight&&("bold"===o.weight||"bolder"===o.weight)||"number"==typeof o.weight&&o.weight>600)&&(t+=.3*e.measureText("A").width),t+=2*this.parameters.haloSize,Math.round(t)},e.prototype.computeLineHeight=function(){var e=1.275*this.parameters.definition.size;return Math.floor(e+2*this.parameters.haloSize)},e}();t.TextRenderer=o;for(var s=[],l=0;l<360;l+=22.5)s.push([Math.cos(Math.PI*l/180),Math.sin(Math.PI*l/180)]);t.getTextHelperCanvas=a;var c={canvas:null},u=512;t.default=o}.apply(null,n))||(e.exports=i)},yqrJ:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("qsST"),r("xoE+"),r("rusB"),r("weRx"),r("AzkI"),r("EyQ4"),r("zZCp"),r("/Bau"),r("W0kZ"),r("CIy2"),r("31XB"),r("/f24"),r("qbr3"),r("Zp3t"),r("Kfys"),r("7laH")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y){var b=n.getLogger("esri.views.3d.webgl-engine.lib.Texture"),x=function(){function e(t,r,n){this.data=t,this.id=e.idGen.gen(r),this.unloadFunc=void 0,this.params=n||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=e.estimateTexMemRequired(this.data,this.params)}return e.estimateTexMemRequired=function(e,t){return null==e?0:a.isArrayBuffer(e)||a.isUint8Array(e)?e.byteLength:e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement?(t.mipmap?4/3:1)*e.width*e.height*(t.components||4):(t.mipmap?4/3:1)*t.width*t.height*(t.components||4)||0},e.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired},e.prototype.dispose=function(){this.data=void 0},e.prototype.deferredLoading=function(){return"string"==typeof this.data},e.prototype.getWidth=function(){return this.params.width},e.prototype.getHeight=function(){return this.params.height},e.prototype.initializeThroughUpload=function(t,r,n,i,o){var s=this.data;if(r.flipped=!this.params.noUnpackFlip,r.samplingMode=this.params.mipmap?9987:9729,r.hasMipmap=this.params.mipmap,r.wrapMode=this.params.wrap,r.preMultiplyAlpha=this.params.preMultiplyAlpha,"string"==typeof s)this.loadTextureFromUri(t,s,r,n,i,o);else if(s instanceof Image||s instanceof ImageData||s instanceof HTMLCanvasElement)this.loadTextureFromImageData(t,s,r,n,i,o);else if(a.isArrayBuffer(s)&&this.params.encoding===e.DDS_ENCODING){var c=l.createDDSTexture(t,r,s,this.params.mipmap);t.bindTexture(c),o(c)}else if(a.isUint8Array(s)&&this.params.encoding===e.DDS_ENCODING){c=l.createDDSTexture(t,r,s.buffer,this.params.mipmap);t.bindTexture(c),o(c)}else if(a.isUint8Array(s)){f.assert(this.params.width>0&&this.params.height>0),r.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,r.width=this.params.width,r.height=this.params.height;c=new m(t,r,s);t.bindTexture(c),o(c)}else{if(null!==s)throw new Error("Unsupported image data");c=new m(t,r,null);t.bindTexture(c),o(c)}this.data=void 0},e.prototype.loadTextureFromImageData=function(e,t,r,n,i,a){this.params.width=t.width,this.params.height=t.height,r.pixelFormat=3===this.params.components?6407:6408;var o=33071===this.params.wrap.s&&33071===this.params.wrap.t;if(y.default(e.gl)||!this.params.mipmap&&o||s.isPowerOfTwo(t.width)&&s.isPowerOfTwo(t.height)){r.width=t.width,r.height=t.height;var l=new m(e,r,t);e.bindTexture(l),a(l)}else{l=this.makePowerOfTwoTexture(e,t,r,n,i);e.bindTexture(l),a(l)}},e.prototype.loadTextureFromUri=function(e,t,r,n,i,a){var l=this,c=!1!==this.params.mipmap;o.requestImage(t).then(function(t){if(f.assert(t.width>=1&&t.height>=1),r.samplingMode=c?9987:9729,r.hasMipmap=c,!c&&33071===r.wrapMode||s.isPowerOfTwo(t.width)&&s.isPowerOfTwo(t.height)){r.width=t.width,r.height=t.height;var o=new m(e,r,t);e.bindTexture(o),a(o)}else{o=l.makePowerOfTwoTexture(e,t,r,n,i);e.bindTexture(o),a(o)}}).catch(function(e){var r=t.length>200?t.slice(0,100)+"..."+t.slice(t.length-100):t;b.error("Failed to load image from uri",r,e),a(null)})},e.prototype.makePowerOfTwoTexture=function(e,t,n,a,o){var s,l=t.width,c=t.height,u=i.nextHighestPowerOfTwo(l),d=i.nextHighestPowerOfTwo(c);switch(n.width=u,n.height=d,this.params.powerOfTwoResizeMode){case 2:n.textureCoordinateScaleFactor=[l/u,c/d],(s=new m(e,n)).updateData(0,0,0,l,c,t);break;case 1:case null:case void 0:s=this.stretchToPowerOfTwo(e,t,n,a,o);break;default:r.neverReached(this.params.powerOfTwoResizeMode)}return n.hasMipmap&&s.generateMipmap(),s},e.prototype.stretchToPowerOfTwo=function(e,t,r,n,i){var a=new m(e,r),o=h.createWithAttachments(e,a,{colorTarget:0,depthStencilTarget:0}),s=new m(e,{target:3553,pixelFormat:r.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},t);if(e.bindFramebuffer(o),void 0===i){var l=e.getViewport();i=[l.x,l.y,l.width,l.height]}e.setViewport(0,0,r.width,r.height);var d=n.getProgram(p.texOnly);e.bindProgram(d),d.setUniform4f("color",1,1,1,1),d.setUniform1i("tex",0);var f=u.createQuadVAO(e,c.Pos3Tex);return e.bindTexture(s,0),e.bindVAO(f),e.setPipelineState(_),e.drawArrays(5,0,g.vertexCount(f,"geometry")),e.bindFramebuffer(null),e.setViewport(i[0],i[1],i[2],i[3]),f.dispose(!0),s.dispose(),e.bindFramebuffer(null),o.detachColorTexture(),o.dispose(),a},e.prototype.setUnloadFunc=function(e){this.unloadFunc=e},e.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)},e.createEmpty=function(t){return void 0===t&&(t="emptyTexture"),new e(new Uint8Array([0,0,0,0]),t,{width:1,height:1,wrap:{s:33071,t:33071}})},e.idGen=new d,e.DDS_ENCODING="image/vnd-ms.dds",e}(),_=v.makePipelineState({colorWrite:v.defaultColorWriteParams});return x}.apply(null,n))||(e.exports=i)},ys4y:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("3RHn"),r("rjU6"),r("+nCE"),r("W0kZ"),r("CIy2"),r("CIy2")],void 0===(i=function(e,t,r,n,i,a,o,s){return function(){function e(t,r,n){this.singleUse=!1,this._boundingInfo=null,this._componentAABBs=null,this._id=e.__idGen.gen(r),this._data=t,this._boundingInfo=n}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e.prototype.getIndices=function(e){return this.data.getIndices(e)},Object.defineProperty(e.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),e.prototype.getAttribute=function(e){return this.data.getAttribute(e)},Object.defineProperty(e.prototype,"componentCount",{get:function(){return n.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this.data.componentOffsets},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boundingInfo",{get:function(){return null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo},enumerable:!0,configurable:!0}),e.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null,this._componentAABBs=null},e.prototype.getComponentAABB=function(e,t){null==this._componentAABBs&&(this._componentAABBs=this._computeComponentAABBs());for(var r=0;r<6;r++)t[r]=this._componentAABBs[6*e+r];return t},e.prototype._computeComponentAABBs=function(){for(var e=this.componentCount,t=new Float32Array(6*e),r=0;r<e;r++)this._calculateAABB(r,t,6*r);return t},e.prototype._calculateAABB=function(e,t,r){void 0===r&&(r=0);for(var n=this.data.getIndices(s.VertexAttrConstants.POSITION),i=this.data.getAttribute(s.VertexAttrConstants.POSITION),a=this.data.componentOffsets,o=a.length?a[e]:0,l=a.length?a[e+1]:n.length,c=1/0,u=1/0,d=1/0,f=-1/0,p=-1/0,h=-1/0,v=i.offsetIdx,m=i.strideIdx,g=o;g<l;g++){var y=v+m*n[g],b=i.data[y],x=i.data[y+1],_=i.data[y+2];c=Math.min(c,b),u=Math.min(u,x),d=Math.min(d,_),f=Math.max(f,b),p=Math.max(p,x),h=Math.max(h,_)}t[r]=c,t[r+1]=u,t[r+2]=d,t[r+3]=f,t[r+4]=p,t[r+5]=h},e.prototype._calculateBoundingInfo=function(){var e=this.data.getIndices(s.VertexAttrConstants.POSITION),t=this.data.getAttribute(s.VertexAttrConstants.POSITION),n="triangle"===this.data.primitiveType?3:1;if(0===e.length){e=new Uint32Array(n);for(var a=0;a<n;++a)e[a]=a}var l=e.length;o.assert(l%n==0);var c=i.generateDefaultIndexArray(l/n);return new r(c,n,e,t)},e.__idGen=new a,e}()}.apply(null,n))||(e.exports=i)},zDti:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("Q2wQ"),r("HZ3d"),r("0+sO"),r("qMld"),r("8uEs"),r("d466"),r("Lzvl"),r("fw2w"),r("nrlZ"),r("Fzzg"),r("+6sX"),r("Jvs9"),r("Q2Em"),r("V1i6")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v){function m(e,i,a){return n(this,void 0,void 0,function(){var n,o,u,d,f;return r(this,function(r){switch(r.label){case 0:return e?(n=e.where,e.where=n=n&&n.trim(),(!n||/^1 *= *1$/.test(n)||i&&i===n)&&(e.where=null),e.geometry?[4,g(e)]:[2,e]):[2,null];case 1:return o=r.sent(),e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel&&(u=e.geometry.spatialReference,(o=s.getGeometryExtent(o)).spatialReference=u),e.geometry=o,[4,h.checkProjectionSupport(o.spatialReference,a)];case 2:return r.sent(),[4,c.normalizeCentralMeridian(l.fromJSON(o))];case 3:return d=r.sent(),[4,h.project(d[0].toJSON(),d[0].spatialReference,a)];case 4:if(!(f=r.sent()))throw t.QUERY_ENGINE_EMPTY_RESULT;return f.spatialReference=a,e.geometry=f,[2,e]}})})}function g(e){var t=e.geometry,r=e.distance,n=e.units;if(null==r)return a.resolve(t);var i=t.spatialReference,s=n&&y.fromJSON(n)||o.getUnitString(i);return(i&&(u.isGeographic(i)||u.isWebMercator(i))?a.resolve(t):h.checkProjectionSupport(i,u.WGS84).then(function(){return h.project(t,u.WGS84)})).then(function(e){return v.getGeodesicBufferOperator().then(function(t){return t(e,r,s).toJSON()})})}Object.defineProperty(t,"__esModule",{value:!0});var y=new i.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});t.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var b=new p.default,x=new p.default,_={esriGeometryPoint:f.convertToPoint,esriGeometryPolyline:f.convertToPolyline,esriGeometryPolygon:f.convertToPolygon,esriGeometryMultipoint:f.convertToMultipoint};t.getCentroid=function(e,t,r){if("esriGeometryPolygon"!==e.geometryType)return null;if(!t.centroid&&!t.geometry)return null;if(t.centroid||(t.centroid=d.getCentroidOptimizedGeometry(new p.default,t.geometry,e.hasZ,e.hasM)),r){var n=f.quantizeOptimizedGeometry(x,t.centroid,e.hasZ,e.hasM,"esriGeometryPoint",r);return f.convertToPoint(n,e.hasZ,e.hasM)}return f.convertToPoint(t.centroid,e.hasZ,e.hasM)},t.getGeometry=function(e,t,r,n){var i="coords"in t?t:t.geometry;if(!i)return null;if(r){var a=f.generalizeOptimizedGeometry(b,i,e.hasZ,e.hasM,e.geometryType,r);return n?(a=f.quantizeOptimizedGeometry(x,a,e.hasZ,e.hasM,e.geometryType,n),_[e.geometryType](a,e.hasZ,e.hasM)):_[e.geometryType](a,e.hasZ,e.hasM)}if(n)return a=f.quantizeOptimizedGeometry(x,i,e.hasZ,e.hasM,e.geometryType,n),_[e.geometryType](a,e.hasZ,e.hasM);return _[e.geometryType](i,e.hasZ,e.hasM)},t.normalizeQuery=function(e,t,i){return n(this,void 0,void 0,function(){var n,a,o,s,l;return r(this,function(r){if(n=e.outFields,a=e.orderByFields,o=e.groupByFieldsForStatistics,s=e.outStatistics,n)for(l=0;l<n.length;l++)n[l]=n[l].trim();if(a)for(l=0;l<a.length;l++)a[l]=a[l].trim();if(o)for(l=0;l<o.length;l++)o[l]=o[l].trim();if(s)for(l=0;l<s.length;l++)s[l].onStatisticField&&(s[l].onStatisticField=s[l].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),[2,m(e,t,i)]})})},t.normalizeFilter=function(e,t,i){return n(this,void 0,void 0,function(){return r(this,function(r){return[2,m(e,t,i)]})})},t.cleanFromGeometryEngine=function(e){return e&&S in e?JSON.parse(JSON.stringify(e,w)):e};var S="_geVersion",w=function(e,t){return e!==S?t:void 0}}.apply(null,n))||(e.exports=i)},zF3d:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("pcDC"),r("FXVB"),r("1m5D"),r("Rdxj"),r("ZPQp"),r("3Zlx"),r("ZcgO"),r("BwdQ"),r("mmEe"),r("ZJC8")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d){function f(e,t,n,i,a){var o=t.z||0,s=n.featureExpressionInfoContext;switch(n.mode){case"on-the-ground":var l=e.getElevation(t,"ground")||0;return a&&(a.verticalDistanceToGround=0,a.terrainElevation=l),l;case"relative-to-ground":var c=e.getElevation(t,"ground")||0;l=n.calculateOffsetRenderUnits(i);return null==s&&(l+=o),a&&(a.verticalDistanceToGround=l,a.terrainElevation=c),l+c;case"relative-to-scene":c=e.getElevation(t,"scene")||0,l=n.calculateOffsetRenderUnits(i);return a&&(a.verticalDistanceToGround=l,a.terrainElevation=c),l+c;case"absolute-height":l=n.calculateOffsetRenderUnits(i);if(null==s&&(l+=o),a){c=e.getElevation(t,"ground")||0;a.verticalDistanceToGround=l-c,a.terrainElevation=c}return l;default:r.neverReached(n.mode)}return 0}function p(e,t,r,n,i,a,o,s){var l=s.mode,c=0,u=0,d=0,f=s.calculateOffsetRenderUnits(o),p=s.featureExpressionInfoContext;w.spatialReference=e.spatialReference,r*=3,i*=3;for(var h=0;h<a;++h){switch(w.x=t[r+0],w.y=t[r+1],w.z=t[r+2],l){case"on-the-ground":u=c=e.getElevation(w)||0,d+=c;break;case"relative-to-ground":u=(c=e.getElevation(w)||0)+f,null==p&&(u+=w.z),d+=c;break;case"relative-to-scene":u=(c=e.getElevation(w,"scene")||0)+f,d+=c;break;case"absolute-height":u=f,null==p&&(u+=w.z)}n[i+0]=t[r+0],n[i+1]=t[r+1],n[i+2]=u,r+=3,i+=3}return{terrainElevation:d/=a}}function h(e,t,r,i,a,o){var s,l=0;if(e.metadata.usesVerticalDistanceToGround)l=f(a,t,r,o,P),c.updateVertexAttributeAuxpos1w(e,P.verticalDistanceToGround),s=P.terrainElevation;else{var d="absolute-height"!==r.mode;l=f(a,t,r,o,d?P:null),d&&(s=P.terrainElevation)}var p=n.mat4.copy(C,e.objectTransformation);return _[0]=t.x,_[1]=t.y,_[2]=l,u.computeLinearTransformation(t.spatialReference,_,p,i)&&(e.objectTransformation=p),{terrainElevation:s}}function v(e,t){var r=s.pathsToTriangulationInfo(e,t);return{vertexData:r.position,polygons:r.polygons,outlines:r.outlines}}function m(e,t,r,n,i){t*=3,n*=3;for(var a=0;a<i;++a)r[n++]=e[t++],r[n++]=e[t++],r[n++]=e[t++]}function g(e,t,r,n,i,a,o){return u.bufferToBuffer(e,r,t,n,a,i,o)}function y(e,t,r){u.pointToVector(e,t,r)}function b(e,t){return!(e[0]>t[3]||e[0]<t[0]||e[1]>t[4]||e[1]<t[1])}function x(e,t){return!(t[0]>e[3]||t[3]<e[0]||t[1]>e[4]||t[4]<e[1])}Object.defineProperty(t,"__esModule",{value:!0});var _=a.vec3f64.create(),S=i.mat4f64.create(),w=l.makeDehydratedPoint(0,0,0,null);t.createStageObjectForPoint=function(e,t,r,n,i,a,o,s,l,c,u,f){var p=r?r.length:0,v=e.clippingExtent;if(y(t,_,e.elevationProvider.spatialReference),v&&!b(_,v))return null;y(t,_,e.renderSpatialReference);for(var m=e.localOriginFactory.getOrigin(_),g=new d({castShadow:!1,metadata:{layerUid:l,graphicUid:c,usesVerticalDistanceToGround:!!u},idHint:s}),x=0;x<p;x++){var w=i?i[x]:S;g.addGeometry(r[x],n[x],w,a,m,f)}return{object:g,terrainElevation:h(g,t,o,e.renderSpatialReference,e.elevationProvider,e.renderCoordsHelper).terrainElevation}},t.extendPointGraphicElevationContext=function(e,t,r){var n=e.elevationContext,i=r.spatialReference;y(t,_,i),n.centerPointInElevationSR=l.makeDehydratedPoint(_[0],_[1],t.hasZ?_[2]:0,i)},t.placePointOnGeometry=function(e){switch(e.type){case"point":return e;case"polygon":case"extent":return c.computeCentroid(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var r=o.getPointOnPath(t,o.getPathLength(t)/2);return l.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference);case"mesh":return e.extent.center}return null},t.computeElevation=f;var C=i.mat4f64.create();t.getSingleSizeDriver=function(e,t){return void 0===t&&(t=0),isFinite(e[t])?e[t]:null},t.copyPathData=v,t.copyVertices=m,t.chooseOrigin=function(e,t,r,n){var i=Math.floor(t+(r-1)/2);n[0]=e[3*i+0],n[1]=e[3*i+1],n[2]=e[3*i+2]},t.subtractCoordinates=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t++]-=n[0],e[t++]-=n[1],e[t++]-=n[2]},t.setZ=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t+2]=n,t+=3},t.offsetZ=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t+2]+=n,t+=3},t.scaleZ=function(e,t,r,n){t*=3;for(var i=0;i<r;++i)e[t+2]*=n,t+=3},t.flatArrayToArrayOfArrays=function(e,t,r){var n=[];t*=3;for(var i=0;i<r;++i)n.push([e[t++],e[t++],e[t++]]);return n},t.reproject=g,t.reprojectPoint=y,t.getGeometryVertexData3D=function(e,t,r,n,i,a,o){var s=i.spatialReference,l=v(e,t),c=l.vertexData,u=c.length/3,d=new Float64Array(c.length),f=!0;r.equals(s)?m(c,0,d,0,c.length):f=g(c,0,r,d,0,s,u);var h=p(i,d,0,c,0,u,a,o);return s.equals(n)||g(c,0,s,c,0,n,u),{geometryData:l,vertexData:c,eleVertexData:d,terrainElevation:h.terrainElevation,projectionSuccess:f}},t.getGeometryVertexDataDraped=function(e,t,r){var n=v(e,!1),i=n.vertexData,a=i.length/3,o=!0;return t.equals(r)||(o=u.bufferToBuffer(i,t,0,i,r,0,a)),{geometryData:n,vertexData:i,projectionSuccess:o}},t.computeBoundingBox=function(e,t,r,n){n[0]=Number.MAX_VALUE,n[1]=Number.MAX_VALUE,n[2]=Number.MAX_VALUE,n[3]=-Number.MAX_VALUE,n[4]=-Number.MAX_VALUE,n[5]=-Number.MAX_VALUE,t*=3;for(var i=0;i<r;++i){var a=e[t++],o=e[t++],s=e[t++];a<n[0]&&(n[0]=a),o<n[1]&&(n[1]=o),s<n[2]&&(n[2]=s),a>n[3]&&(n[3]=a),o>n[4]&&(n[4]=o),s>n[5]&&(n[5]=s)}return n},t.pointInBox2D=b,t.boxesIntersect2D=x,t.boundingBoxClipped=function(e,t){return!!t&&!x(e,t)},t.needsElevationUpdates2D=function(e){return"relative-to-ground"===e||"relative-to-scene"===e},t.needsElevationUpdates3D=function(e){return"absolute-height"!==e};var P={verticalDistanceToGround:0,terrainElevation:0}}.apply(null,n))||(e.exports=i)},"zU7+":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("2Atf"),r("xhoE"),r("0LE5"),r("Rdxj"),r("WRgd"),r("VfPl"),r("2B1V"),r("9FJH"),r("FNtW"),r("CIy2"),r("CIy2"),r("ama6"),r("hnAi"),r("s6rJ"),r("s6rJ"),r("ZeO9"),r("flZ8"),r("qbr3")],void 0===(i=function(e,t,r,n,i,a,o,s,l,c,u,d,f,p,h,v,m,g,y,b){function x(e,t,r){return e[0]=Math.min(Math.max(e[0],t[0]),r[0]),e[1]=Math.min(Math.max(e[1],t[1]),r[1]),e[2]=Math.min(Math.max(e[2],t[2]),r[2]),e}function _(e){return e?6:4}function S(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors)),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}function w(e){return!e.slicePlaneEnabled&&(e.cullFace?"none"!==e.cullFace:!e.transparent&&!e.doubleSided)}var C=f.assert,P=function(e){function t(r,n){var i=e.call(this,n)||this;return i.supportsEdges=!0,i.params=m.copyParameters(r,M),i.vertexBufferLayout=t.getVertexBufferLayout(i.params),i.textureMode=r.textureId?r.atlasRegions?"AtlasTextured":"Textured":"none",i}return n(t,e),t.prototype.isVisibleInPass=function(e){return 3!==e||this.params.castShadows},t.prototype.isVisible=function(){var t=this.params;if(!e.prototype.isVisible.call(this)||0===t.layerOpacity)return!1;var r=t.symbolColors,n=t.vvColorEnabled,i="replace"===t.colorMixMode,a=t.opacity>0,o=t.externalColor&&t.externalColor[3]>0;return n||r?!!i||a:i?o:a},t.prototype.setParameterValues=function(e){var t=this.params;for(var r in e)"textureId"===r&&C(t.textureId,"Can only change texture of material that already has a texture"),"wireframe"===r&&C(t.wireframe,"wireframe flag affects drawmode (lines instead of triangles) and therefore can only be set during contruction"),"atlasRegions"===r&&C(e.atlasRegions===t.atlasRegions,"Can not change texture atlas mode."),!e[r]||"vvSizeMinSize"!==r&&"vvSizeMaxSize"!==r&&"vvSizeOffset"!==r&&"vvSizeFactor"!==r?t[r]=e[r]:i.vec3.set(t[r],e[r][0],e[r][1],e[r][2]);this.notifyDirty("matChanged")},t.prototype.getParameters=function(){return this.params},t.prototype.computeVertexPosition=function(e,t,r,n){i.vec3.copy(n,t),this.params.vvSizeEnabled?(i.vec3.copy(N,this.params.vvSizeFactor),i.vec3.scale(N,N,r),i.vec3.add(N,N,this.params.vvSizeOffset),x(N,this.params.vvSizeMinSize,this.params.vvSizeMaxSize),i.vec3.multiply(n,n,N)):i.vec3.scale(n,n,this.params.size),i.vec3.add(n,n,e)},t.prototype.intersectTriangles=function(e,t,r,n,a,o,s,l,c,u,d){for(var f=e[0],p=e[1],h=e[2],v=t[0]-f,g=t[1]-p,y=t[2]-h,b=r;b<n;b++){var x=u?u[b]:b,_=s.offsetIdx+s.strideIdx*a[3*x],S=s.offsetIdx+s.strideIdx*a[3*x+1],w=s.offsetIdx+s.strideIdx*a[3*x+2],C=l.offsetIdx+l.strideIdx*a[3*x],P=l.offsetIdx+l.strideIdx*a[3*x+1],E=l.offsetIdx+l.strideIdx*a[3*x+2],T=0;if(this.params.vvSizeEnabled){var O=c.offsetIdx+c.strideIdx*o[3*x];T=c.data[O]}i.vec3.set(U,s.data[_],s.data[_+1],s.data[_+2]),i.vec3.set(z,l.data[C],l.data[C+1],l.data[C+2]),this.computeVertexPosition(U,z,T,B);var A=B[0],R=B[1],M=B[2];i.vec3.set(U,s.data[S],s.data[S+1],s.data[S+2]),i.vec3.set(z,l.data[P],l.data[P+1],l.data[P+2]),this.computeVertexPosition(U,z,T,B);var I=B[0],D=B[1],V=B[2];i.vec3.set(U,s.data[w],s.data[w+1],s.data[w+2]),i.vec3.set(z,l.data[E],l.data[E+1],l.data[E+2]),this.computeVertexPosition(U,z,T,B);var L=I-A,N=D-R,G=V-M,H=B[0]-A,k=B[1]-R,W=B[2]-M,q=g*W-k*y,X=y*H-W*v,Y=v*k-H*g,Q=L*q+N*X+G*Y,Z=f-A,J=p-R,K=h-M,$=J*G-N*K,ee=K*L-G*Z,te=Z*N-L*J;if(Q>F){if((re=Z*q+J*X+K*Y)<0||re>Q)continue;if((ne=v*$+g*ee+y*te)<0||re+ne>Q)continue}else{if(!(Q<-F))continue;var re,ne;if((re=Z*q+J*X+K*Y)>0||re<Q)continue;if((ne=v*$+g*ee+y*te)>0||re+ne<Q)continue}var ie=(H*$+k*ee+W*te)/Q;ie>=0&&d(ie,m.computeNormal(L,N,G,H,k,W,j),x)}},t.prototype.intersect=function(e,t,r,n,i,a,s,l){if("triangle"===e.data.primitiveType){var c;c=this.params.vvSizeEnabled?Math.max(this.params.vvSizeMaxSize[0],Math.max(this.params.vvSizeMaxSize[1],this.params.vvSizeMaxSize[2])):this.params.size;var u=o.fromValues(e.boundingInfo.bbMin[0]-c,e.boundingInfo.bbMin[1]-c,e.boundingInfo.bbMin[2]-c,e.boundingInfo.bbMax[0]+c,e.boundingInfo.bbMax[1]+c,e.boundingInfo.bbMax[2]+c),f=[a[0]-i[0],a[1]-i[1],a[2]-i[2]],p=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]),h=[p/f[0],p/f[1],p/f[2]];if(m.intersectAabbInvDir(u,i,h,n.tolerance)){var v=e.indexCount/3;this.intersectTriangles(i,a,0,v,e.getIndices(d.VertexAttrConstants.POSITION),e.getIndices(d.VertexAttrConstants.AUXPOS2),e.getAttribute(d.VertexAttrConstants.POSITION),e.getAttribute(d.VertexAttrConstants.AUXPOS1),e.getAttribute(d.VertexAttrConstants.AUXPOS2),null,s)}}},t.prototype.createBufferWriter=function(){return new I(this.vertexBufferLayout)},t.prototype.createRenderer=function(e,t){return new g(e,t,this)},t.prototype.getGLMaterials=function(){return{color:E,depth:T,depthShadowMap:this.params.castShadows?O:null,normal:A,highlight:R}},t.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]},t.getVertexBufferLayout=function(e){var t=l.newLayout().vec3f("position").vec3f("normal");return t.vec4f(d.VertexAttrConstants.AUXPOS1),e.textureId&&(t=t.vec2f("uv0"),e.atlasRegions&&(t=t.vec4u16("region",{glNormalized:!0}))),e.symbolColors&&(t=t.vec4u8("symbolColor")),(e.vvColorEnabled||e.vvSizeEnabled||e.vvOpacityEnabled)&&(t=t.vec4f(d.VertexAttrConstants.AUXPOS2)),t},t}(u),E=function(e){function t(t,r,n){var i=this,a=t.getParameters();(i=e.call(this,t,r,n,a.textureId,void 0,a.textureInitTransparent)||this).params=m.copyParameters(a);var o=i.params;return i.slot=_(o.transparent),i.textureMode=t.textureMode,i._createPrograms(),i.selectPipeline(),i}return n(t,e),t.prototype._createPrograms=function(){var e=this;this.programs=v.BindParametersMap.create(this.params,function(t){return e._createProgram(t)})},t.prototype._createProgram=function(e){var t=this.params;return this.programRep.getProgram(y.colorPass,{textureMode:this.textureMode,symbolColors:t.symbolColors,flipV:t.flipV,doubleSided:t.doubleSided&&"normal"===t.doubleSidedType,windowOrderDoubleSided:t.doubleSided&&"winding-order"===t.doubleSidedType,receiveShadows:e.receiveShadows,receiveSSAO:e.receiveSSAO,vvSize:t.vvSizeEnabled,vvColor:t.vvColorEnabled,vvOpacity:t.vvOpacityEnabled,verticalOffset:null!==t.verticalOffset,screenSizePerspective:null!==t.screenSizePerspective,slice:t.slicePlaneEnabled,compressedNormals:t.compressedNormals,transparencyDiscard:t.transparent,wireframe:t.wireframe})},t.prototype.selectPipeline=function(){var e=this.params;this.pipelineState=b.makePipelineState({blending:D(e),culling:L(e),polygonOffset:e.polygonOffset&&V,depthTest:{func:513},depthWrite:b.defaultDepthWriteParams,colorWrite:b.defaultColorWriteParams})},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program||this.getPrograms()[0]},t.prototype.getPrograms=function(){return v.BindParametersMap.programs(this.programs)},t.prototype.updateParameters=function(){this.params=m.copyParameters(this.material.getParameters()),this.slot=_(this.params.transparent),this.updateTexture(this.params.textureId),this._createPrograms(),this.selectPipeline()},t.prototype.bind=function(e,t){var r=this.params,n=this.program=v.BindParametersMap.lookup(this.programs,t);e.bindProgram(n),e.setPipelineState(this.pipelineState),n.setUniform1f("size",r.size),n.setUniform3fv("ambient",r.ambient),n.setUniform3fv("diffuse",r.diffuse),n.setUniform3fv("specular",r.specular),n.setUniform4fv("externalColor",r.externalColor),n.setUniform1i("colorMixMode",m.colorMixModes[r.colorMixMode]),n.setUniform1f("opacity",r.opacity),n.setUniform1f("layerOpacity",r.layerOpacity),m.bindVerticalOffset(r.verticalOffset,t,n),m.bindScreenSizePerspective(r.screenSizePerspective,n),S(n,r),this.bindTexture(e,n),"none"!==this.textureMode&&this.bindTextureSize(e,n)},t.prototype.release=function(e,t){},t.prototype.bindView=function(e,t){var r=this.program=v.BindParametersMap.lookup(this.programs,t),n=this.params,i=t.origin;m.bindView(i,t.view,r),m.bindCamPos(i,t.viewInvTransp,r),n.slicePlaneEnabled&&m.bindSlicePlane(i,t.slicePlane,r),t.shadowMappingEnabled&&t.shadowMap.bindView(r,i)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return this.params.wireframe?1:4},t}(c),T=function(e){function t(t,r,n,i){void 0===i&&(i=!1);var a=e.call(this,t,r,n,t.getParameters().textureId)||this;return a.textureMode=t.textureMode,a.biased=i,a.updateParameters(),a}return n(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(y.depthPass,{textureMode:this.textureMode,flipV:e.flipV,shadowMap:this.biased,vvSize:e.vvSizeEnabled,verticalOffset:null!==e.verticalOffset,screenSizePerspective:null!==e.screenSizePerspective,slice:e.slicePlaneEnabled,transparencyDiscard:e.transparent}),this.pipelineState=b.makePipelineState({culling:L(e),polygonOffset:e.polygonOffset&&V,depthTest:{func:513},depthWrite:b.defaultDepthWriteParams,colorWrite:b.defaultColorWriteParams})},t.prototype.selectSlot=function(){this.slot=_(this.params.transparent)},t.prototype.updateParameters=function(){this.params=m.copyParameters(this.material.getParameters()),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),e.setPipelineState(this.pipelineState),r.setUniform1f("size",n.size),r.setUniform2fv("nearFar",t.nearFar),m.bindVerticalOffset(n.verticalOffset,t,r),m.bindScreenSizePerspective(n.screenSizePerspective,r),S(r,n),this.bindTexture(e,r)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=t.origin;m.bindView(i,t.view,r),n.slicePlaneEnabled&&m.bindSlicePlane(t.origin,t.slicePlane,r),n.screenSizePerspective&&m.bindCamPos(i,t.viewInvTransp,r)},t.prototype.bindInstance=function(e,t){this.program.setUniformMatrix4fv("model",t.transformation)},t.prototype.getDrawMode=function(){return this.params.wireframe?1:4},t}(c),O=function(e){function t(t,r,n){return e.call(this,t,r,n,!0)||this}return n(t,e),t}(T),A=function(e){function t(t,r,n){var i=e.call(this,t,r,n,t.getParameters().textureId)||this;return i.textureMode=t.textureMode,i.updateParameters(),i}return n(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(y.normalPass,{textureMode:this.textureMode,flipV:e.flipV,vvSize:e.vvSizeEnabled,verticalOffset:null!==e.verticalOffset,screenSizePerspective:null!==e.screenSizePerspective,slice:e.slicePlaneEnabled,compressedNormals:e.compressedNormals,transparencyDiscard:e.transparent}),this.pipelineState=b.makePipelineState({polygonOffset:e.polygonOffset&&V,culling:L(e),depthTest:{func:513},depthWrite:b.defaultDepthWriteParams,colorWrite:b.defaultColorWriteParams})},t.prototype.selectSlot=function(){this.slot=_(this.params.transparent)},t.prototype.updateParameters=function(){this.params=m.copyParameters(this.material.getParameters()),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),e.setPipelineState(this.pipelineState),r.setUniform1f("size",n.size),this.bindTexture(e,r),m.bindVerticalOffset(n.verticalOffset,t,r),m.bindScreenSizePerspective(n.screenSizePerspective,r),S(r,n)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=t.origin;m.bindView(i,t.view,r),r.setUniformMatrix4fv("viewNormal",t.viewInvTransp),n.slicePlaneEnabled&&m.bindSlicePlane(t.origin,t.slicePlane,r),n.screenSizePerspective&&m.bindCamPos(i,t.viewInvTransp,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return this.params.wireframe?1:4},t}(c),R=function(e){function t(t,r,n){var i=e.call(this,t,r,n,t.getParameters().textureId)||this;return i.textureMode=t.textureMode,i.updateParameters(),i}return n(t,e),t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program},t.prototype.selectProgram=function(){var e=this.params;this.program=this.programRep.getProgram(y.highlightPass,{textureMode:this.textureMode,flipV:e.flipV,vvSize:e.vvSizeEnabled,verticalOffset:null!==e.verticalOffset,screenSizePerspective:null!==e.screenSizePerspective,slice:e.slicePlaneEnabled,transparencyDiscard:e.transparent}),this.pipelineState=b.makePipelineState({polygonOffset:e.polygonOffset&&V,culling:L(e),depthTest:{func:513},depthWrite:b.defaultDepthWriteParams,colorWrite:b.defaultColorWriteParams})},t.prototype.selectSlot=function(){this.slot=_(this.params.transparent)},t.prototype.updateParameters=function(){this.params=m.copyParameters(this.material.getParameters()),this.selectProgram(),this.selectSlot(),this.updateTexture(this.params.textureId)},t.prototype.bind=function(e,t){var r=this.program,n=this.params;e.bindProgram(r),e.setPipelineState(this.pipelineState),r.setUniform1f("size",n.size),this.bindTexture(e,r),m.bindVerticalOffset(n.verticalOffset,t,r),m.bindScreenSizePerspective(n.screenSizePerspective,r),S(r,n)},t.prototype.release=function(e){},t.prototype.bindView=function(e,t){var r=this.program,n=this.params,i=t.origin;m.bindView(i,t.view,r),n.slicePlaneEnabled&&m.bindSlicePlane(t.origin,t.slicePlane,r),n.screenSizePerspective&&m.bindCamPos(i,t.viewInvTransp,r)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},t.prototype.getDrawMode=function(){return this.params.wireframe?1:4},t}(c),M=r({size:1,wireframe:!1,textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,symbolColors:!1,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,compressedNormals:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,transparent:!1,polygonOffset:!1,atlasRegions:!1},p.Default),I=function(){function e(e){this.vertexBufferLayout=e}return e.prototype.allocate=function(e){return this.vertexBufferLayout.createBuffer(e)},e.prototype.elementCount=function(e){return e.indices.position.length},e.prototype.write=function(e,t,r,n,i){if(d.VertexAttrConstants.AUXPOS1 in t.vertexAttr){var a=t.vertexAttr[d.VertexAttrConstants.AUXPOS1],o=t.indices[d.VertexAttrConstants.AUXPOS1];C(4===a.size);var l=n.getField(d.VertexAttrConstants.AUXPOS1,s.BufferViewVec4f);if(!l)throw new Error("unable to aquire view for "+d.VertexAttrConstants.AUXPOS1);h.writeBufferVec4(o,a.data,l,i)}if(d.VertexAttrConstants.AUXPOS2 in t.vertexAttr){a=t.vertexAttr[d.VertexAttrConstants.AUXPOS2],o=t.indices[d.VertexAttrConstants.AUXPOS2];C(4===a.size);var c=n.getField(d.VertexAttrConstants.AUXPOS2,s.BufferViewVec4f);if(!c)throw new Error("unable to aquire view for "+d.VertexAttrConstants.AUXPOS2);h.writeBufferVec4(o,a.data,c,i)}h.writeDefaultAttributes(t,r,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,i)},e}(),D=function(e){return e.transparent&&b.separateBlendingParams(770,1,771,771)},V={factor:2,units:2},L=function(e){return w(e)&&{face:"front"===e.cullFace?1028:1029,mode:2305}},F=Math.pow(2,-52),B=a.vec3f64.create(),N=a.vec3f64.create(),U=a.vec3f64.create(),z=a.vec3f64.create(),j=a.vec3f64.create();return P}.apply(null,n))||(e.exports=i)},zZCp:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],t.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}],t.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}],t.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}],t.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],t.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]}.apply(null,n))||(e.exports=i)},zbgD:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("VVgn"),r("IROT")],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=new n(function(e){var t=r;return e.split("/").forEach(function(e){t&&(t=t[e])}),t});t.resolveIncludes=function(e){return i.resolveIncludes(e)}}.apply(null,n))||(e.exports=i)},zlCF:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r,n,i){void 0===r&&(r=0),this.TypedArrayConstructor=e,this.elementCount=1;var a=this.TypedArrayConstructor;void 0===n&&(n=a.BYTES_PER_ELEMENT);var o=0===t.byteLength?0:r;this.typedBuffer=null==i?new a(t,o):new a(t,o,(i-r)/a.BYTES_PER_ELEMENT),this.typedBufferStride=n/a.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}return e.prototype.get=function(e){return this.typedBuffer[e*this.typedBufferStride]},e.prototype.set=function(e,t){this.typedBuffer[e*this.typedBufferStride]=t},Object.defineProperty(e.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0}),e.ElementCount=1,e}();t.BufferViewScalarImpl=r}.apply(null,n))||(e.exports=i)},"zpp+":function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r("ff/U"),r("zbgD"),r("U+8K")],void 0===(i=function(e,t,r,n,i){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return i.glslifyDefineMap({SLICE:e.slice,VERTEXCOLORS:e.vertexColors})};t.colorPass={name:"native-line-color",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/nativeLine/colorPass.frag")}},attributes:r.Default3D},t.highlightPass={name:"native-line-highlight",shaders:function(e){return{vertexShader:a(e)+n.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:a(e)+n.resolveIncludes("materials/nativeLine/highlightPass.frag")}},attributes:r.Default3D}}.apply(null,n))||(e.exports=i)}}]);