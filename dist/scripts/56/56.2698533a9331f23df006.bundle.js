(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/data/QueryEngineCapabilities":"4/qq","esri/views/2d/engine/webgl/color":"4F/P","esri/tasks/operations/pbfOptimizedFeatureSet":"6/KI","esri/views/2d/engine/webgl/SymbolProperties":"7AYJ","esri/core/HandleOwner":"7MDj","esri/layers/support/FeatureProcessing":"B0tL","esri/tasks/operations/query":"B16N","esri/views/2d/layers/features/controllers/BaseController":"Btct","esri/views/2d/engine/webgl/number":"Dos2","esri/tasks/operations/pbfQueryUtils":"G+Sd","esri/tasks/operations/PBFWorker":"J0rm","esri/views/2d/engine/webgl/enums":"JNkf","esri/views/2d/layers/features/support/DataTile":"KgG2","esri/core/SetPool":"L6z/","esri/views/2d/layers/features/support/DataTileFeaturesIndex":"W1uT","esri/tasks/operations/pbfFeatureServiceParser":"YhCz","esri/layers/graphics/data/FeatureFilter":"Z0JH","esri/views/webgl/Texture":"Zp3t","esri/views/2d/engine/webgl/Utils":"apbF","esri/tasks/operations/urlUtils":"cGHk","esri/views/2d/layers/features/support/Tile":"fUL3","esri/views/2d/layers/features/support/TileUpdateQueue":"sOkP","esri/geometry/support/quantizationUtils":"u90+","esri/views/2d/layers/features/controllers/OnDemandController":"uqzM","esri/core/pbf":"v7zm","esri/tasks/operations/pbfDehydratedFeatureSet":"yre/"})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{"4/qq":function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,i))||(e.exports=n)},"4F/P":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("Dos2")],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.white=[255,255,255,1];var i=[0,0,0,0];function n(e,t){return Array.isArray(t)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):(e[0]=t.r,e[1]=t.g,e[2]=t.b,e[3]=t.a),e}function o(e,t,r){void 0===t&&(t=0),void 0===r&&(r=!1);var i=e[t+3];return e[t+0]*=i,e[t+1]*=i,e[t+2]*=i,r||(e[t+3]*=255),e}t.premultiplyAlpha=o,t.copyAndPremultiply=function(e){return o(n([],e))},t.premultiplyAlphaUint32=function(e){return o(n(i,e)),r.i8888to32(i[0],i[1],i[2],i[3])},t.premultiplyAlphaRGBA=function(e){var t=e.r,i=e.g,n=e.b,o=e.a,s=t*o,a=i*o,u=n*o,l=255*o;return r.i8888to32(s,a,u,l)}}.apply(null,i))||(e.exports=n)},"6/KI":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("/COu"),r("xJgq"),r("Jvs9")],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}return e.prototype.createFeatureResult=function(){return new i.default},e.prototype.prepareFeatures=function(){},e.prototype.finishFeatureResult=function(){},e.prototype.addFeature=function(e,t){e.features.push(t)},e.prototype.createFeature=function(){return new r.default},e.prototype.createSpatialReference=function(){return{wkid:0}},e.prototype.createGeometry=function(){return new n.default},e.prototype.addField=function(e,t){e.fields.push(t)},e.prototype.addCoordinate=function(e,t){e.coords.push(t)},e.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},e.prototype.addLength=function(e,t){e.lengths.push(t)},e.prototype.createPointGeometry=function(){return new n.default},e}();t.Context=o}.apply(null,i))||(e.exports=n)},"7AYJ":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("SyoC")],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.color=[0,0,0,0],this.haloColor=[0,0,0,0],this.haloSize=0,this.size=12,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0}return e.prototype.acquire=function(e,t,r,i,n,o,s,a,u){this.color=e,this.haloColor=t,this.haloSize=r,this.size=i,this.angle=n,this.offsetX=o,this.offsetY=s,this.hAnchor=a,this.vAnchor=u},e.prototype.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0,this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0,this.haloSize=0,this.size=0,this.angle=0,this.offsetX=0,this.offsetY=0,this.hAnchor=0,this.vAnchor=0},e.pool=new r(e),e}();t.TextProperties=i}.apply(null,i))||(e.exports=n)},"7MDj":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("eIBl"),r("Vx27")],void 0===(n=function(e,t,r,i,n,o,s){return function(e){function t(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=e.call(this)||this;return i.handles=new o,i}return r(t,e),t.prototype.destroy=function(){this.handles.destroy()},i([s.property({readOnly:!0})],t.prototype,"handles",void 0),i([s.subclass("esri.core.HandleOwner")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},B0tL:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("rg9i"),r("Vx27"),r("KQcO"),r("k7g7")],void 0===(n=function(e,t,r,i,n,o,s,a,u){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return r(t,e),n=t,t.fromWorker=function(e){if(!e)return null;var t=JSON.parse(e),r=new n;return r.fields=t.fields&&t.fields.map(function(e){return a.fromJSON(e)}),r.options=t.options,r.process=new(Function.bind.apply(Function,[void 0].concat(t.process.args,[t.process.body]))),r},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n(o.clone({fields:this.fields,options:this.options,process:this.process}))},t.prototype.getField=function(e){return u.getField(this.fields,e)},t.prototype.refresh=function(){this.notifyChange("version")},t.prototype.toWorker=function(){var e=this.process.toString();return JSON.stringify({fields:this.fields,options:this.options,process:{body:e.substring(e.indexOf("{")+1,e.lastIndexOf("}")),args:e.slice(e.indexOf("(")+1,e.indexOf(")")).match(/([^\s,]+)/g)}})},i([s.property({type:[a]})],t.prototype,"fields",void 0),i([s.property()],t.prototype,"options",void 0),i([s.property()],t.prototype,"process",void 0),i([s.property({readOnly:!0,dependsOn:["process","options","fields"]})],t.prototype,"version",null),n=i([s.subclass("esri.layers.support.FeatureProcessing")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},B16N:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("2Atf"),r("zp6E"),r("jfWY"),r("Lzvl"),r("fw2w"),r("G+Sd"),r("J0rm"),r("cGHk")],void 0===(n=function(e,t,r,i,n,o,s,a,u,l){function p(e,t){var r=e.geometry,i=e.toJSON(),n=i;if(r&&(n.geometry=JSON.stringify(r),n.geometryType=o.getJsonType(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete n.outFields:-1!==i.outFields.indexOf("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?n.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.source&&(n.layer=JSON.stringify({source:i.source}),delete i.source),i.timeExtent){var s=i.timeExtent,a=s.start,u=s.end;null==a&&null==u||(n.time=a===u?a:(null==a?"null":a)+","+(null==u?"null":u)),delete i.timeExtent}return n}function c(e,t,o,a,u){void 0===a&&(a={});var c="string"==typeof e?n.urlToObject(e):e,d=t.geometry?[t.geometry]:[];return a.responseType="pbf"===o?"array-buffer":"json",s.normalizeCentralMeridian(d,null,a).then(function(e){var n=e&&e[0];n&&((t=t.clone()).geometry=n);var s=l.mapParameters(r({},c.query,{f:o},u,p(t,u)));return i(c.path+"/query",r({},a,{query:s}))})}Object.defineProperty(t,"__esModule",{value:!0});var d,h="Layer does not support extent calculation.";t.queryToQueryStringParameters=p,t.executeQuery=function(e,t,r){return c(e,t,"json",r)},t.executeQueryPBF=function(e,t,r,i){return c(e,t,"pbf",i).then(function(e){var t=function(t){var r=e;return r.data=t,r};return r.useWorker?(null==d&&(d=new u.PBFWorker),d).parseFeatureQuery(e.data,r).then(function(e){return t(e)}):t(a.parsePBFFeatureQuery(e.data,r))})},t.executeQueryForIds=function(e,t,r){return c(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return c(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return c(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(h);if(t.hasOwnProperty("count"))throw new Error(h);return e})}}.apply(null,i))||(e.exports=n)},Btct:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("qKT0"),r("Q2wQ"),r("HZ3d"),r("9opi"),r("Gtr7"),r("ma1f"),r("7MDj"),r("qsST"),r("LxLY"),r("Vx27"),r("Z0JH"),r("zDti"),r("tI6k")],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c,d,h,f){Object.defineProperty(t,"__esModule",{value:!0});var y=l.getLogger("esri.views.2d.layers.features.controllers.BaseController"),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.configuration=null,t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t.filters=new Array(f.MAX_FILTERS),t}return o(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),t.prototype.setFilterBase=function(e,t){return n(this,void 0,void 0,function(){var r,n,o,s;return i(this,function(i){switch(i.label){case 0:return[4,this._getFilter(e)];case 1:return r=i.sent(),[4,h.normalizeFilter(t,null,this.spatialReference)];case 2:return n=i.sent(),this.configuration.filter=n,n?[4,r.update(n)]:[2,r.clear()];case 3:i.sent(),i.label=4;case 4:return i.trys.push([4,6,,7]),[4,this.queryObjectIds(r.createQuery().toJSON())];case 5:return o=i.sent(),[2,r.setTrue(o)];case 6:return s=i.sent(),y.error(new a("featurelayer-controller:query-filter-error","An error occurred while executing the query",{error:s})),[2,{show:[],hide:[]}];case 7:return[2]}})})},t.prototype.enableEvent=function(e){},t.prototype._getFilter=function(e){return n(this,void 0,void 0,function(){var t,r,n;return i(this,function(i){switch(i.label){case 0:return t=this.filters[e],p.isSome(t)?[2,t]:(r=new d.default({geometryType:this.service.geometryType,hasM:!1,hasZ:!1,timeInfo:this.service.timeInfo}),this.filters[e]=r,[4,this.queryObjectIds({})]);case 1:return n=i.sent(),r.setKnownIds(n),[2,r]}})})},t.prototype._getFilterFlags=function(e){for(var t=0,r=0;r<this.filters.length;r++){var i=this.filters[r];t|=(p.isNone(i)||i.check(e)?1:0)<<r}return t},t.prototype.hasGeometryFilter=function(){return this.filters.some(function(e){return p.isSome(e)&&!!e.geometry})},r([c.property()],t.prototype,"configuration",void 0),r([c.property()],t.prototype,"processor",void 0),r([c.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r([c.property({constructOnly:!0})],t.prototype,"service",void 0),r([c.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r([c.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r([c.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r([c.property()],t.prototype,"filters",void 0),r([c.subclass()],t)}(c.declared(s,u));t.default=_}.apply(null,i))||(e.exports=n)},Dos2:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("qsST")],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=new Float32Array(1),n=new Uint32Array(i.buffer),o=r.getLogger("esri.views.2d.engine.webgl.number");function s(e,t,r){var i=Math.max(Math.min(e,r),t);return i!==e&&o.warn("Value of "+e+" exceeded rendering limitations and was clamped to "+i),i}t.i8=function(e){return s(e,-128,127)},t.i16=function(e){return s(e,-32768,32767)},t.i32=function(e){return s(e,-2147483648,2147483647)},t.u8=function(e){return s(e,0,255)},t.u16=function(e){return s(e,0,65535)},t.u32=function(e){return s(e,0,4294967295)},t.nextHighestPowerOfTwo=function(e){var t=e;t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16;var r=++t>>1;return e-r<t-e?r:t},t.toUint32=function(e){return i[0]=e,n[0]},t.toFloat32=function(e){return n[0]=e,i[0]},t.i1616to32=function(e,t){return 65535&e|t<<16},t.i8888to32=function(e,t,r,i){return 255&e|(255&t)<<8|(255&r)<<16|i<<24},t.i8816to32=function(e,t,r){return 255&e|(255&t)<<8|r<<16},t.numTo32=function(e){return 0|e}}.apply(null,i))||(e.exports=n)},"G+Sd":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("YhCz")],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var i=r.parseFeatureQuery(e,t).queryResult.featureResult;if(i&&i.features&&i.features.length&&i.objectIdFieldName)for(var n=i.objectIdFieldName,o=0,s=i.features;o<s.length;o++){var a=s[o];a.attributes&&(a.objectId=a.attributes[n])}return i}}.apply(null,i))||(e.exports=n)},J0rm:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("xhoE"),r("jZlN"),r("qMld"),r("ADZV"),r("8V7H"),r("Z4y+"),r("G+Sd"),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l){Object.defineProperty(t,"__esModule",{value:!0});var p=function(){function e(){}return e.prototype._parseFeatureQuery=function(e){var t,r=u.parsePBFFeatureQuery(e.buffer,e.options);return e.options&&"dehydrated"===e.options.type&&(t=r.spatialReference.toJSON(),r.spatialReference=null),n.resolve({featureSet:r,sr:t})},e}(),c=function(t){function p(){var r=t.call(this)||this;return r._thread=void 0,s.open(o.getAbsMid("./PBFWorker",e,l),{strategy:"dedicated"}).then(function(e){void 0===r._thread?r._thread=e:e.close()}),r}return r(p,t),p.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},p.prototype.parseFeatureQuery=function(e,t){return e&&0!==e.byteLength?this._thread?this._thread.invoke("_parseFeatureQuery",{buffer:e,options:t},{transferList:[e]}).then(function(e){var t=e.featureSet;if(e.sr){var r=a.fromJSON(e.sr);t.spatialReference=r}for(var n=t.spatialReference,o=0,s=t.features;o<s.length;o++){var u=s[o];u.uid=i.generateUID(),u.geometry&&(u.geometry.spatialReference=n)}return e.featureSet}):n.resolve(u.parsePBFFeatureQuery(e,t)):n.resolve(null)},p}(p);t.PBFWorker=c,t.default=function(){return new p}}.apply(null,i))||(e.exports=n)},JNkf:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){var r,i,n,o,s,a,u,l,p,c;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.WGLGeometryType||(t.WGLGeometryType={}))[r.FILL=0]="FILL",r[r.LINE=1]="LINE",r[r.MARKER=2]="MARKER",r[r.TEXT=3]="TEXT",r[r.LABEL=4]="LABEL",(i=t.WGLGeometryTransactionStatus||(t.WGLGeometryTransactionStatus={}))[i.SUCCEEDED=0]="SUCCEEDED",i[i.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY",(n=t.WGLDrawPhase||(t.WGLDrawPhase={}))[n.NONE=0]="NONE",n[n.MAP=1]="MAP",n[n.LABEL=2]="LABEL",n[n.LABEL_ALPHA=4]="LABEL_ALPHA",n[n.HITTEST=8]="HITTEST",n[n.HIGHLIGHT=16]="HIGHLIGHT",n[n.CLIP=32]="CLIP",n[n.DEBUG=64]="DEBUG",n[n.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES",(o=t.VVType||(t.VVType={}))[o.SIZE=0]="SIZE",o[o.COLOR=1]="COLOR",o[o.OPACITY=2]="OPACITY",o[o.ROTATION=3]="ROTATION",(s=t.WGLVVFlag||(t.WGLVVFlag={}))[s.NONE=0]="NONE",s[s.OPACITY=1]="OPACITY",s[s.COLOR=2]="COLOR",s[s.ROTATION=4]="ROTATION",s[s.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",s[s.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",s[s.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",s[s.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE",(a=t.WGLVVTarget||(t.WGLVVTarget={}))[a.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",a[a.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",a[a.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",a[a.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE",(u=t.CapType||(t.CapType={}))[u.UNKNOWN=0]="UNKNOWN",u[u.BUTT=1]="BUTT",u[u.ROUND=2]="ROUND",u[u.SQUARE=3]="SQUARE",(l=t.JoinType||(t.JoinType={}))[l.UNKNOWN=0]="UNKNOWN",l[l.MITER=1]="MITER",l[l.BEVEL=2]="BEVEL",l[l.ROUND=3]="ROUND",(p=t.Alignment||(t.Alignment={}))[p.SCREEN=0]="SCREEN",p[p.MAP=1]="MAP",(c=t.MosaicType||(t.MosaicType={}))[c.SPRITE=0]="SPRITE",c[c.GLYPH=1]="GLYPH"}.apply(null,i))||(e.exports=n)},KgG2:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.displayTile=null,this.tile=null,this.done=!1,this.queryInfoHash=null,this.returnExceeded=!1}return Object.defineProperty(e.prototype,"key",{get:function(){return this.tile.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.tile.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.tile.bounds},enumerable:!0,configurable:!0}),e}();t.default=r}.apply(null,i))||(e.exports=n)},"L6z/":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("PND3")],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._pool=[],this._set=new r.default}return e.prototype.acquire=function(){if(0===this._pool.length)return new r.default;var e=this._pool.pop();return this._set.delete(e),e},e.prototype.release=function(e){e&&!this._set.has(e)&&(e.clear(),this._pool.length<5e4&&(this._pool.push(e),this._set.add(e)))},e.acquire=function(){return n.acquire()},e.release=function(e){return n.release(e)},e}();t.default=i;var n=new i}.apply(null,i))||(e.exports=n)},W1uT:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("xdHJ"),r("PND3"),r("L6z/"),r("rfv1"),r("fUL3")],void 0===(n=function(e,t,r,i,n,o,s){Object.defineProperty(t,"__esModule",{value:!0});var a=[],u=new i.default,l=function(){function e(){this._tileById=new r.default,this._tilesToFeatures=new r.default,this._featureToTiles=new r.default}return e.prototype.destroy=function(){this.clear()},e.prototype.add=function(e){var t=this;if(!this.has(e.id)){var r=e;this._tileById.set(r.id,r),this._tilesToFeatures.set(r,n.default.acquire()),this._tilesToFeatures.forEach(function(e,i){r!==i&&(s.isParentOf(r,i)?e.forEach(function(e){t._link(r,e)}):s.isChildOf(r,i)&&t.featureStore.forEachInBounds(r.bounds,function(i){e.has(i.objectId)&&t._link(r,i.objectId)}))})}},e.prototype.clear=function(){this._tilesToFeatures.forEach(function(e){return n.default.release(e)}),this._tilesToFeatures.clear(),this._featureToTiles.forEach(function(e){return n.default.release(e)}),this._featureToTiles.clear(),this._tileById.clear()},e.prototype.delete=function(e){var t=this,r=this.get(e.id);a.length=0,this._tilesToFeatures.get(r).forEach(function(e){var i=t._featureToTiles.get(e);i.has(r)&&1===i.size?a.push(e):t._unlink(r,e)});for(var i=0,n=a;i<n.length;i++){var o=n[i];this._unlink(r,o)}this.featureStore.removeManyById(a),this._tilesToFeatures.delete(r),this._tileById.delete(r.id),a.length=0},e.prototype.forEach=function(e,t){return this._tileById.forEach(e,t)},e.prototype.get=function(e){return this._tileById.get(e)},e.prototype.has=function(e){return this._tileById.has(e)},e.prototype.setTileFeatures=function(e,t){var r=this,i=this.get(e.id);this._tilesToFeatures.has(i)||(this._tileById.set(i.id,i),this._tilesToFeatures.set(i,n.default.acquire()));for(var o=0,s=t;o<s.length;o++){var l=s[o];u.add(l.objectId)}a.length=0,this._tilesToFeatures.get(i).forEach(function(e){if(!u.has(e)){var t=r._featureToTiles.get(e);t.has(i)&&1===t.size?a.push(e):r._unlink(i,e)}});for(var p=0,c=a;p<c.length;p++){var d=c[p];this._unlink(i,d)}this.featureStore.removeManyById(a),this.featureStore.addMany(t),u.forEach(function(e){r._link(i,e)}),u.clear(),a.length=0},e.prototype.addOrUpdateFeatures=function(e){for(var t=this,r=new i.default,n=new o.default({geometryType:this.featureStore.geometryType,hasM:this.featureStore.hasM,hasZ:this.featureStore.hasZ}),s=0,a=this.deleteFeaturesById(e.map(function(e){return e.objectId}));s<a.length;s++){var u=a[s];r.add(u)}n.addMany(e),this._tileById.forEach(function(e){n.forEachInBounds(e.bounds,function(i){t._link(e,i.objectId),r.add(e)})}),this.featureStore.addMany(e);var l=[];return r.forEach(function(e){return l.push(e)}),l},e.prototype.deleteFeaturesById=function(e){for(var t=this,r=new i.default,o=this,s=0,a=e;s<a.length;s++){!function(e){var i=o._featureToTiles.get(e);i&&(i.forEach(function(i){r.add(i),t._tilesToFeatures.get(i).delete(e)}),n.default.release(i),o._featureToTiles.delete(e))}(a[s])}this.featureStore.removeManyById(e);var u=[];return r.forEach(function(e){return u.push(e)}),u},e.prototype._link=function(e,t){this._featureToTiles.get(t)||this._featureToTiles.set(t,n.default.acquire()),this._featureToTiles.get(t).add(e),this._tilesToFeatures.get(e).add(t)},e.prototype._unlink=function(e,t){this._featureToTiles.get(t).delete(e),this._tilesToFeatures.get(e).delete(t),0===this._featureToTiles.get(t).size&&(n.default.release(this._featureToTiles.get(t)),this._featureToTiles.delete(t))},e}();t.default=l}.apply(null,i))||(e.exports=n)},YhCz:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("ma1f"),r("qsST"),r("v7zm"),r("yre/"),r("6/KI")],void 0===(n=function(e,t,r,i,n,o,s){function a(e){return e>=S.length?null:S[e]}function u(e){return e>=w.length?null:w[e]}function l(e){return e>=F.length?null:F[e]}function p(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function c(e,t,r){for(var i=e.createPointGeometry(t);r.next();)switch(r.tag()){case 3:for(var n=r.getUInt32(),o=r.pos()+n,s=0;r.pos()<o;)e.addCoordinatePoint(i,r.getSInt64(),0,s++);break;case 1:case 2:default:r.skip()}return i}function d(e,t,r){for(var i=e.createGeometry(t),n=2+(t.hasZ?1:0)+(t.hasM?1:0);r.next();)switch(r.tag()){case 2:for(var o=r.getUInt32(),s=r.pos()+o,a=0;r.pos()<s;)e.addLength(i,r.getUInt32(),a++);break;case 3:for(var u=r.getUInt32(),l=(s=r.pos()+u,0),p=0;r.pos()<s;)e.addCoordinate(i,r.getSInt64(),p,l),++l===n&&(p++,l=0);break;case 1:default:r.skip()}return i}function h(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function f(e){for(var t={type:a(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=a(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=u(e.getEnum());break;case 5:case 6:default:e.skip()}return t}function y(e,t,r,i){for(var n=e.createFeature(t),o=0;r.next();)switch(r.tag()){case 1:var s=i[o++].name;n.attributes[s]=h(r.getMessage());break;case 2:n.geometry=d(e,t,r.getMessage());break;case 4:n.centroid=c(e,t,r.getMessage());break;default:r.skip()}return n}function _(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function g(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function m(e){for(var t={originPosition:l(0)};e.next();)switch(e.tag()){case 1:t.originPosition=l(e.getEnum());break;case 2:t.scale=_(e.getMessage());break;case 3:t.translate=g(e.getMessage());break;default:e.skip()}return t}function T(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function v(e,t){for(var r=e.createSpatialReference();t.next();)switch(t.tag()){case 1:r.wkid=t.getUInt32();break;case 5:r.wkt=t.getString();break;case 2:case 3:case 4:default:t.skip()}return r}function I(e,t){var r=e.createFeatureResult();r.geometryType=p(e,0);for(var i=!1;t.next();)switch(t.tag()){case 1:r.objectIdFieldName=t.getString();break;case 3:r.globalIdFieldName=t.getString();break;case 4:r.geohashFieldName=t.getString();break;case 5:r.geometryProperties=T(t.getMessage());break;case 7:r.geometryType=p(e,t.getEnum());break;case 8:r.spatialReference=v(e,t.getMessage());break;case 10:r.hasZ=t.getBool();break;case 11:r.hasM=t.getBool();break;case 12:r.transform=m(t.getMessage());break;case 9:var n=t.getBool();r.exceededTransferLimit=n;break;case 13:e.addField(r,f(t.getMessage()));break;case 15:i||(e.prepareFeatures(r),i=!0),e.addFeature(r,y(e,r,t.getMessage(),r.fields));break;case 2:case 6:default:t.skip()}return e.finishFeatureResult(r),r}function E(e,t){for(var r={};t.next();)switch(t.tag()){case 1:r.featureResult=I(e,t.getMessage());break;default:t.skip()}return r}function b(e){return e&&"dehydrated"===e.type?new o.Context(e):new s.Context(e)}Object.defineProperty(t,"__esModule",{value:!0});var x=i.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),S=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],w=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],F=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e,t){var i=b(t);try{for(var o=new n(new Uint8Array(e),new DataView(e)),s={};o.next();)switch(o.tag()){case 2:s.queryResult=E(i,o.getMessage());break;default:o.skip()}return s}catch(e){var a=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return x.error(a),{queryResult:{featureResult:i.createFeatureResult()}}}}}.apply(null,i))||(e.exports=n)},Z0JH:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("HZ3d"),r("2Atf"),r("Q2wQ"),r("PND3"),r("ma1f"),r("qsST"),r("LxLY"),r("qMld"),r("lRq4"),r("hBh5"),r("Ytki"),r("V1i6"),r("/61J"),r("IpeC")],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c,d,h,f,y){Object.defineProperty(t,"__esModule",{value:!0});var _=a.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),g=1,m=2,T=function(){function e(e){var t=this;this._geometryBounds=p.create(),this._idToVisibility=new Map,this.check=function(e){var r=e.objectId,i=t._idToVisibility,n=t._applyFilter(e);return i.set(r,n?g|m:m),!!(i.get(r)&g)},this._serviceInfo=e}return e.prototype.clear=function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}},e.prototype.invalidate=function(){var e=this;this._idToVisibility.forEach(function(t,r){e._idToVisibility.set(r,0)})},e.prototype.setKnownIds=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._idToVisibility.set(i,g)}},e.prototype.setTrue=function(e){var t=this,r=[],i=[],n=new o.default(e);return this._idToVisibility.forEach(function(e,o){var s=!!(t._idToVisibility.get(o)&g),a=n.has(o);!s&&a?r.push(o):s&&!a&&i.push(o),t._idToVisibility.set(o,a?g|m:0)}),{show:r,hide:i}},e.prototype.createQuery=function(){var e=this,t=e.geometry,r=e.spatialRel,i=e.where,n=e.distance,o=e.units,s=e.timeExtent,a=e.objectIds;return y.fromJSON({geometry:t,spatialRel:r,where:i,distance:n,units:o,timeExtent:s,objectIds:a})},e.prototype.update=function(e){return void 0===e&&(e=null),r(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return[4,l.all([this._setGeometryFilter(e),this._setIdFilter(e),this._setAttributeFilter(e),this._setTimeFilter(e)])];case 1:return t.sent(),[2]}})})},e.prototype._setAttributeFilter=function(e){if(!e||!e.where)return this._clause=null,void(this.where=null);var t=d.getWhereClause(e.where);if(t.isStandardized())this._clause=t;else{var r=new s("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",t);_.error(r)}this.where=e.where},e.prototype._setIdFilter=function(e){this._idsToShow=e&&e.objectIds&&new o.default(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new o.default(e.hiddenIds),this.objectIds=e&&e.objectIds},e.prototype._setGeometryFilter=function(e){return r(this,void 0,void 0,function(){var t,r,i;return n(this,function(n){switch(n.label){case 0:return e&&e.geometry?(t=e.geometry,r=e.spatialRel||"esriSpatialRelIntersects",[4,h.getSpatialQueryOperator(r,t,this._serviceInfo)]):(this._spatialQueryOperator=null,this.geometry=null,this.spatialRel=null,[2]);case 1:return i=n.sent(),c.getBoundsXY(this._geometryBounds,t),this._spatialQueryOperator=i,this.geometry=t,this.spatialRel=r,[2]}})})},e.prototype._setTimeFilter=function(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent){if(!this._serviceInfo.timeInfo){var t=new s("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);return void _.error(t)}this.timeExtent=e.timeExtent,this._timeOperator=f.getTimeOperator(this._serviceInfo.timeInfo,e.timeExtent)}},e.prototype._applyFilter=function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)},e.prototype._filterByExpression=function(e){return!this.where||this._clause.testFeature(e.attributes)},e.prototype._filterById=function(e){return(!this._idsToHide||!this._idsToHide.has(e.objectId))&&(!this._idsToShow||this._idsToShow.has(e.objectId))},e.prototype._filterByGeometry=function(e){return!this.geometry||!!this._earlyGeometryReject(e)&&this._spatialQueryOperator(e.geometry)},e.prototype._filterByTime=function(e){return!u.isSome(this._timeOperator)||this._timeOperator(e)},e.prototype._earlyGeometryReject=function(e){return!(!e.geometry||!e.geometry.coords.length)&&(!e.centroid||"esriSpatialRelContains"!==this.spatialRel||p.containsPoint(this._geometryBounds,e.centroid.coords))},e.prototype._resetAllHiddenIds=function(){var e=this,t=[];return this._idToVisibility.forEach(function(r,i){r&g||(e._idToVisibility.set(i,g),t.push(i))}),t},e}();t.default=T}.apply(null,i))||(e.exports=n)},Zp3t:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("H1tY")],void 0===(n=function(e,t,r){function i(e){return null!=e&&"type"in e&&"compressed"===e.type}return function(){function e(t,i,n){this._context=null,this._glName=null,this._id=-1,this._desc=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._boundToUnits=new Set,this._context=t,this._desc={pixelFormat:i.pixelFormat,internalFormat:i.internalFormat,dataType:i.dataType,target:i.target?i.target:3553,samplingMode:i.samplingMode?i.samplingMode:9729,wrapMode:i.wrapMode?i.wrapMode:10497,maxAnisotropy:i.maxAnisotropy,flipped:void 0!==i.flipped&&i.flipped,hasMipmap:void 0!==i.hasMipmap&&i.hasMipmap,unpackAlignment:i.unpackAlignment?i.unpackAlignment:4,width:i.width,height:i.height,preMultiplyAlpha:void 0!==i.preMultiplyAlpha&&i.preMultiplyAlpha,textureCoordinateScaleFactor:i.textureCoordinateScaleFactor||null},this._id=++e._nextId,r("esri-webgl-debug")&&t.instanceCounter.incrementCount(0),this.setData(n)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(this._context){if(this._glName){var t=this._context.gl;this._boundToUnits.forEach(function(t){e._context.bindTexture(null,t)}),t.deleteTexture(this._glName),this._glName=null}r("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(0),this._context=null}},e.prototype.resize=function(e,t){var r=this._desc;r.width===e&&r.height===t||(r.width=e,r.height=t,this.setData(null))},e.prototype.setData=function(t){var r=this._context.gl;this._glName||(this._glName=r.createTexture()),void 0===t&&(t=null),null===t&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var n=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var o=this._desc;e._validateTexture(o),r.pixelStorei(r.UNPACK_ALIGNMENT,o.unpackAlignment),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,o.flipped?1:0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.preMultiplyAlpha?1:0);var s=o.pixelFormat,a=o.internalFormat?o.internalFormat:s;if(t instanceof ImageData||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)o.width&&o.height,r.texImage2D(r.TEXTURE_2D,0,a,s,o.dataType,t),o.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=t.width),void 0===this._desc.height&&(this._desc.height=t.height);else{null!=o.width&&o.height,r.DEPTH24_STENCIL8&&a===r.DEPTH_STENCIL&&(a=r.DEPTH24_STENCIL8);var u=o.width,l=o.height;if(i(t)){var p=Math.round(Math.log(Math.max(u,l))/Math.LN2)+1;o.hasMipmap=o.hasMipmap&&p===t.levels.length;for(var c=0;;++c){var d=t.levels[Math.min(c,t.levels.length-1)];if(r.compressedTexImage2D(r.TEXTURE_2D,c,a,u,l,0,d),1===u&&1===l||!o.hasMipmap)break;u=Math.max(1,u>>1),l=Math.max(1,l>>1)}}else if(t)r.texImage2D(r.TEXTURE_2D,0,a,u,l,0,s,o.dataType,t),o.hasMipmap&&this.generateMipmap();else for(c=0;r.texImage2D(r.TEXTURE_2D,c,a,u,l,0,s,o.dataType,null),(1!==u||1!==l)&&o.hasMipmap;++c)u=Math.max(1,u>>1),l=Math.max(1,l>>1)}e._applySamplingMode(r,this._desc),e._applyWrapMode(r,this._desc),e._applyAnisotropicFilteringParameters(this._context,this._desc),this._context.bindTexture(n,0)},e.prototype.updateData=function(e,t,r,i,n,o){this._glName;var s=this._context.gl,a=this._desc,u=this._context.getBoundTexture(0);this._context.bindTexture(this,0),t<0||r<0||i>a.width||n>a.height||t+i>a.width||a.height,o instanceof ImageData||o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement?s.texSubImage2D(s.TEXTURE_2D,e,t,r,a.pixelFormat,a.dataType,o):s.texSubImage2D(s.TEXTURE_2D,e,t,r,i,n,a.pixelFormat,a.dataType,o),this._context.bindTexture(u,0)},e.prototype.generateMipmap=function(){var t=this._desc;t.hasMipmap||(t.hasMipmap=!0,e._validateTexture(t)),9729===t.samplingMode?(this._samplingModeDirty=!0,t.samplingMode=9985):9728===t.samplingMode&&(this._samplingModeDirty=!0,t.samplingMode=9984);var r=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var i=this._context.gl;i.generateMipmap(i.TEXTURE_2D),this._context.bindTexture(r,0)},e.prototype.setSamplingMode=function(t){t!==this._desc.samplingMode&&(this._desc.samplingMode=t,e._validateTexture(this._desc),this._samplingModeDirty=!0)},e.prototype.setWrapMode=function(t){t!==this._desc.wrapMode&&(this._desc.wrapMode=t,e._validateTexture(this._desc),this._wrapModeDirty=!0)},e.prototype.applyChanges=function(){var t=this._context.gl,r=this._desc;this._samplingModeDirty&&(e._applySamplingMode(t,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(e._applyWrapMode(t,r),this._wrapModeDirty=!1)},e.prototype.setBoundToUnit=function(e,t){t?this._boundToUnits.add(e):this._boundToUnits.delete(e)},e._isPowerOfTwo=function(e){return 0==(e&e-1)},e._validateTexture=function(t){t.width<0||t.height,e._isPowerOfTwo(t.width)&&e._isPowerOfTwo(t.height)||("number"==typeof t.wrapMode?t.wrapMode:33071===t.wrapMode.s&&t.wrapMode.t,t.hasMipmap)},e._applySamplingMode=function(e,t){var r=t.samplingMode,i=t.samplingMode;9985===r||9987===r?(r=9729,t.hasMipmap||(i=9729)):9984!==r&&9986!==r||(r=9728,t.hasMipmap||(i=9728)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i)},e._applyWrapMode=function(e,t){"number"==typeof t.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode.t))},e._applyAnisotropicFilteringParameters=function(e,t){if(null!=t.maxAnisotropy){var r=e.capabilities.textureFilterAnisotropic;if(r){var i=e.gl;i.texParameterf(i.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY,t.maxAnisotropy)}}},e._nextId=0,e}()}.apply(null,i))||(e.exports=n)},apbF:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("2Atf"),r("B2KM"),r("T8lH"),r("ma1f"),r("qsST"),r("jBNx"),r("u90+"),r("3568"),r("4F/P"),r("JNkf"),r("7AYJ"),r("AzkI"),r("Zp3t")],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c,d,h,f){var y;Object.defineProperty(t,"__esModule",{value:!0});var _=s.getLogger("esri.views.2d.engine.webgl.Utils");function g(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n.name]=n.strideInBytes}return t}t.C_HITTEST_SEARCH_SIZE=4,t.C_VBO_GEOMETRY="geometry",t.C_VBO_PERINSTANCE="per_instance",t.C_VBO_PERINSTANCE_VV="per_instance_vv",t.C_VBO_VISIBILITY="visibility",t.C_VBO_VISIBILITY_RANGE="visibilityRange",t.C_ICON_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_ICON_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_FILL_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:32,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_FILL_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_FILL_VERTEX_DEF_DD=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_LINE_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:32,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_LINE_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:44,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_TEXT_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_TEXT_VERTEX_DEF_VV=[{name:t.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}],t.C_LABEL_VERTEX_DEF=[{name:t.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:t.C_VBO_VISIBILITY,strideInBytes:1,divisor:0},{name:t.C_VBO_VISIBILITY_RANGE,strideInBytes:2,divisor:0}],t.C_ICON_STRIDE_SPEC=g(t.C_ICON_VERTEX_DEF),t.C_ICON_STRIDE_SPEC_VV=g(t.C_ICON_VERTEX_DEF_VV),t.C_FILL_STRIDE_SPEC=g(t.C_FILL_VERTEX_DEF),t.C_FILL_STRIDE_SPEC_VV=g(t.C_FILL_VERTEX_DEF_VV),t.C_FILL_STRIDE_SPEC_DD=g(t.C_FILL_VERTEX_DEF_DD),t.C_LINE_STRIDE_SPEC=g(t.C_LINE_VERTEX_DEF),t.C_LINE_STRIDE_SPEC_VV=g(t.C_LINE_VERTEX_DEF_VV),t.C_TEXT_STRIDE_SPEC=g(t.C_TEXT_VERTEX_DEF),t.C_TEXT_STRIDE_SPEC_VV=g(t.C_TEXT_VERTEX_DEF_VV),t.C_LABEL_STRIDE_SPEC=g(t.C_LABEL_VERTEX_DEF),t.getStrides=function(e,r,i){switch(e){case c.WGLGeometryType.MARKER:return r?t.C_ICON_STRIDE_SPEC_VV:t.C_ICON_STRIDE_SPEC;case c.WGLGeometryType.FILL:return i?t.C_FILL_STRIDE_SPEC_DD:r?t.C_FILL_STRIDE_SPEC_VV:t.C_FILL_STRIDE_SPEC;case c.WGLGeometryType.LINE:return r?t.C_LINE_STRIDE_SPEC_VV:t.C_LINE_STRIDE_SPEC;case c.WGLGeometryType.TEXT:return r?t.C_TEXT_STRIDE_SPEC_VV:t.C_TEXT_STRIDE_SPEC;case c.WGLGeometryType.LABEL:return t.C_LABEL_STRIDE_SPEC}return null};var m=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],T=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],v=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],I=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY],E=[t.C_VBO_GEOMETRY,t.C_VBO_VISIBILITY,t.C_VBO_VISIBILITY_RANGE];function b(e){switch(e){case c.WGLGeometryType.MARKER:return m;case c.WGLGeometryType.FILL:return T;case c.WGLGeometryType.LINE:return v;case c.WGLGeometryType.TEXT:return I;case c.WGLGeometryType.LABEL:return E}return null}function x(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function S(e){switch(e){case"esriSMS":return"simple-marker";case"esriPMS":return"picture-marker";case"esriSLS":return"simple-line";case"esriPLS":return"picture-line";case"esriSFS":return"simple-fill";case"esriPFS":return"picture-fill";case"esriTS":return"text"}return e}function w(e){return"string"==typeof e}t.getNamedBuffers=b,t.strideToPackingFactor=x,t.allocateTypedArrayBuffer=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}},t.allocateTypedArrayBufferwithData=function(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}},t.normalizeSymbolType=S,t.isMarkerSymbol=function(e){var t=S(e.type);if(t){switch(t){case"simple-marker":case"picture-marker":case"CIMPointSymbol":return!0}return!1}},t.isFillSymbol=function(e){var t=S(e.type);if(t){switch(t){case"simple-fill":case"picture-fill":case"CIMPolygonSymbol":return!0}return!1}},t.isLineSymbol=function(e){var t=S(e.type);if(t){switch(t){case"simple-line":case"picture-line":case"CIMLineSymbol":return!0}return!1}},t.isPictureSymbol=function(e){var t=S(e.type);if(t){switch(t){case"picture-marker":case"picture-line":case"picture-fill":return!0}return!1}return!1},t.isTextSymbol=function(e){var t=S(e.type);if(t){switch(t){case"text":case"CIMTextSymbol":return!0}return!1}},t.getTextProperties=function(e){return d.TextProperties.pool.acquire(e.color?p.copyAndPremultiply(e.color):[255,255,255,255],e.haloColor?p.copyAndPremultiply(e.haloColor):[255,255,255,255],a.pt2px(e.haloSize),a.pt2px(e.font.size),e.angle*Math.PI/180,e.xoffset/e.font.size,e.yoffset/e.font.size,"left"===e.horizontalAlignment?0:"right"===e.horizontalAlignment?1:.5,"top"===e.verticalAlignment?0:"bottom"===e.verticalAlignment?1:.5)},t.isDefined=function(e){return null!=e},t.isNumber=function(e){return"number"==typeof e},t.isString=w,t.isStringOrNull=function(e){return null==e||w(e)},t.lerp=function(e,t,r){return e+(t-e)*r};var F=function(){function e(){this._arr=[],this._push=this._push.bind(this)}return e.prototype._push=function(e,t){this._arr.push(t)},e.prototype.getKeys=function(e){return this._arr.length=0,e&&e.forEach(this._push),this._arr},e}();t.KeysGetter=F;var C=function(){function e(){this._arr=[],this._push=this._push.bind(this)}return e.prototype._push=function(e,t){this._arr.push(e)},e.prototype.getValues=function(e){return this._arr.length=0,e&&e.forEach(this._push),this._arr},e}();function P(e){var t={};switch(e){case"esriGeometryPoint":return function(e,r,i,n){return u.hydratePoint(r,t,e,i,n)};case"esriGeometryPolygon":return function(e,r,i,n){return u.hydratePolygon(r,t,e,i,n)};case"esriGeometryPolyline":return function(e,r,i,n){return u.hydratePolyline(r,t,e,i,n)};case"esriGeometryMultipoint":return function(e,r,i,n){return u.hydrateMultipoint(r,t,e,i,n)};default:return _.error(new o("mapview-arcade","Unable to handle geometryType: "+e)),function(e,t,r,i){return e}}}t.ValuesGetter=C,t.getCapType=function(e,t){switch(e){case"butt":return c.CapType.BUTT;case"round":return t?c.CapType.SQUARE:c.CapType.ROUND;case"square":return c.CapType.SQUARE;default:return _.error(new o("mapview-invalid-type","Cap type "+e+" is not a valid option. Defaulting to round")),c.CapType.ROUND}},t.getJoinType=function(e){switch(e){case"miter":return c.JoinType.MITER;case"bevel":return c.JoinType.BEVEL;case"round":return c.JoinType.ROUND;default:return _.error(new o("mapview-invalid-type","Join type "+e+" is not a valid option. Defaulting to round")),c.JoinType.ROUND}},t.getVVType=function(e){switch(e){case"opacity":return c.VVType.OPACITY;case"color":return c.VVType.COLOR;case"rotation":return c.VVType.ROTATION;case"size":return c.VVType.SIZE;default:return _.error("Cannot interpret unknown vv: "+e),null}},t.createHydrateFactory=P,t.getTransformParams=function(e){return{transform:e.transform,hasZ:e.hasZ,hasM:e.hasM}},t.createArcadeFunction=function(e,t,r){var o=t.fields,s=t.spatialReference,a=t.hasGeometryExpr,u=t.geometryType,p=l.createFunction(e),c=new n,d=new i({viewingMode:null,scale:null}),h={},f={vars:{$feature:c,$view:null},spatialReference:s},y={fields:o},_=P(u);return function(e,t,i){if(a){var n=t.transform,o=t.hasZ,u=t.hasM,g=_(e.geometry,n,o,u);g.spatialReference=s,c.repurposeFromGraphicLikeObject(g,e.attributes,y)}else c.repurposeFromGraphicLikeObject(e.geometry,e.attributes,y);i?((f.vars.$view=d).attributes.viewingMode=i.viewingMode,d.attributes.scale=i.scale):f.vars.$view=h;var m=l.executeFunction(p,f);return r?r(m):m}},t.copyMeshData=function(e,t,r,i,n,o,s){for(var a in o)for(var u=o[a].stride,l=x(u),p=o[a].data,c=r[a].data,d=u*n.vertexCount/l,h=u*e/l,f=u*n.vertexFrom/l,y=0;y<d;++y)c[y+h]=p[y+f];var _=n.indexCount;for(y=0;y<_;++y)i[y+t]=s[y+n.indexFrom]-n.vertexFrom+e},t.C_VBO_INFO=((y={})[t.C_VBO_GEOMETRY]=35044,y[t.C_VBO_VISIBILITY]=35044,y[t.C_VBO_VISIBILITY_RANGE]=35048,y),t.createGeometryData=function(e,t){for(var r=[],i=0;i<5;++i){for(var n={},o=0,s=b(i);o<s.length;o++){var a=s[o];n[a]={data:t(i,a)}}r.push({data:e(i),buffers:n})}return r},t.resampleHermite=function(e,t,r,i,n,o,s){void 0===s&&(s=!0);for(var a=t/n,u=r/o,l=Math.ceil(a/2),p=Math.ceil(u/2),c=0;c<o;c++)for(var d=0;d<n;d++){for(var h=4*(d+(s?o-c-1:c)*n),f=0,y=0,_=0,g=0,m=0,T=0,v=0,I=(c+.5)*u,E=Math.floor(c*u);E<(c+1)*u;E++)for(var b=Math.abs(I-(E+.5))/p,x=(d+.5)*a,S=b*b,w=Math.floor(d*a);w<(d+1)*a;w++){var F=Math.abs(x-(w+.5))/l,C=Math.sqrt(S+F*F);-1<=C&&C<=1&&0<(f=2*C*C*C-3*C*C+1)&&(v+=f*e[3+(F=4*(w+E*t))],_+=f,e[F+3]<255&&(f=f*e[F+3]/250),g+=f*e[F],m+=f*e[F+1],T+=f*e[F+2],y+=f)}i[h]=g/y,i[h+1]=m/y,i[h+2]=T/y,i[h+3]=v/_}},t.createTextureFromTexelData=function(e,t){var r,i;return i=h.isPowerOfTwo(t.width)&&h.isPowerOfTwo(t.height)?(r=!0,9987):(r=!1,9729),new f(e,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:r,samplingMode:i,wrapMode:33071,flipped:!0},t)},t.geometryToMappedGeometry=function(e){return{vertexFrom:void 0,vertexTo:void 0,geometry:e}};var O=new Map;t.createProgramDescriptor=function(e,t){if(!O.has(e)){var i=function(e){var t={},i=function(i){var n=e[i],o=0;t[i]=n.map(function(e){var t=r({},e,{normalized:e.normalized||!1,divisor:e.divisor||0,offset:o,stride:0});return o+=e.count*function(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}(e.type),t}),t[i].forEach(function(e){return e.stride=o})};for(var n in e)i(n);return t}(t),n={strides:function(e){var t={};for(var r in e){var i=e[r];t[r]=i.length?i[0].stride:0}return t}(i),bufferLayouts:i,attributes:function(e){var t={};for(var r in e)for(var i=0,n=e[r];i<n.length;i++){var o=n[i];t[o.name]=o.location}return t}(t)};O.set(e,n)}return O.get(e)}}.apply(null,i))||(e.exports=n)},cGHk:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var i in t)if("declaredClass"!==i){var n=t[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[i]=[];for(var o=0;o<n.length;o++)r[i][o]=e(n[o])}else"object"==typeof n?n.toJSON&&(r[i]=JSON.stringify(n)):r[i]=n}return r}}.apply(null,i))||(e.exports=n)},fUL3:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("PND3"),r("QVms"),r("lRq4"),r("lAK8"),r("f3JK")],void 0===(n=function(e,t,r,i,n,o,s){function a(e,t){var r=e.bounds,i=t.bounds;return e.key.id!==t.key.id&&e.key.world===t.key.world&&r[0]<=i[0]&&r[1]<=i[1]&&r[2]>=i[2]&&r[3]>=i[3]}Object.defineProperty(t,"__esModule",{value:!0}),t.isParentOf=a,t.isChildOf=function(e,t){return a(t,e)};var u=function(){function e(e,t){this.bounds=n.create(),this.key=new s(0,0,0,0),this.objectIds=new r.default,this.key.set(t);var i=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=i.resolution,this.scale=i.scale,this.level=i.level,this.needsClear=!0}return Object.defineProperty(e.prototype,"id",{get:function(){return this.key.id},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.tileInfoView,this.id)},e.prototype.createChildTiles=function(){for(var t=this.key.getChildKeys(),r=i.acquire(),n=0;n<t.length;n++)r[n]=new e(this.tileInfoView,t[n]);return r},e.prototype.getQuantizationParameters=function(){return o.default.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})},e}();t.Tile=u,t.default=u}.apply(null,i))||(e.exports=n)},sOkP:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("Gtr7"),r("afW+"),r("Vx27"),r("W9tT"),r("ked+")],void 0===(n=function(e,t,r,i,n,o,s,a,u){function l(e){return e&&"function"==typeof e.then}Object.defineProperty(t,"__esModule",{value:!0});var p=[0,0],c=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=new Map,r._onGoingTile=null,r._onGoingPromise=null,r._isPaused=!1,r._scheduledNextHandle=null,r._timestamp=Date.now(),r.tileInfoView=null,r._next=r._next.bind(r),r._finalize=r._finalize.bind(r),r}return r(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this._queue.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._queue.size>0||null!=this._onGoingPromise},enumerable:!0,configurable:!0}),t.prototype.cancel=function(e){this._onGoingTile&&this._onGoingTile.tileId===e&&(this._onGoingPromise.cancel(),this._onGoingTile=this._onGoingPromise=null),this._queue.delete(e),this._scheduleNext(),this.notifyChange("updating")},t.prototype.clear=function(){this._queue.clear(),this._onGoingPromise&&(this._onGoingPromise.cancel(),this._onGoingTile=this._onGoingPromise=null),this._cancelNext(),this.notifyChange("updating")},t.prototype.has=function(e){return this._queue.has(e)},t.prototype.isOngoing=function(e){return this._onGoingTile&&this._onGoingTile.tileId===e},t.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},t.prototype.push=function(e,t){this._queue.has(e)||(this._queue.set(e,{tileId:e,key:u.TileKey.pool.acquire(e),timestamp:t||this._timestamp}),this._scheduleNext(),this.notifyChange("updating"))},t.prototype.refresh=function(){this._timestamp=Date.now(),this.reset()},t.prototype.reset=function(){var e=this._onGoingTile;if(e){var t=e.tileId;this.push(t,this._timestamp)}this.notifyChange("updating")},t.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext()),this.notifyChange("updating")},t.prototype._finalize=function(){this._onGoingTile=null,this._onGoingPromise=null,this.notifyChange("updating"),this._scheduleNext()},t.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},t.prototype._scheduleNext=function(){this._isPaused||this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingTile||(this._scheduledNextHandle=o.schedule(this._next))},t.prototype._next=function(){if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingTile)this._scheduledNextHandle=null;else{this._scheduledNextHandle=null;var e=this._peek(),t=e.tileId,r=e.key;u.TileKey.pool.release(r),this._queue.delete(t),this._onGoingTile=e,this._onGoingPromise=this.process(t,this._timestamp),l(this._onGoingPromise)?this._onGoingPromise.then(this._finalize,this._finalize):this._finalize(),this.notifyChange("updating")}},t.prototype._peek=function(){var e=this;if(!this.state)throw new Error("state not set");var t=this.tileInfoView,r=this.state.center,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=null;return this._queue.forEach(function(s,u){t.getTileCoords(p,s.key);var l=e._timestamp-s.timestamp;if(isNaN(l))(c=a.vec2.distance(p,r))<n&&(n=c,o=s);else if(l===i){var c;(c=a.vec2.distance(p,r))<n&&(n=c,o=s)}else l>i&&(i=l,n=Number.POSITIVE_INFINITY,o=s)}),o},i([s.property({readOnly:!0})],t.prototype,"length",null),i([s.property({constructOnly:!0})],t.prototype,"process",void 0),i([s.property()],t.prototype,"state",void 0),i([s.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),i([s.property({readOnly:!0})],t.prototype,"updating",null),i([s.subclass()],t)}(s.declared(n));t.default=c}.apply(null,i))||(e.exports=n)},"u90+":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("Lzvl")],void 0===(n=function(e,t,r){function i(e){return e&&"upperLeft"===e.originPosition}function n(e,t){var r=e.scale,i=e.translate;return Math.round((t-i[0])/r[0])}function o(e,t){var r=e.scale,i=e.translate;return Math.round((i[1]-t)/r[1])}function s(e,t,r){for(var i,s,a,u,l=[],p=0;p<r.length;p++){var c=r[p];p>0?(a=n(e,c[0]),u=o(e,c[1]),a===i&&u===s||(l.push(t(c,a-i,u-s)),i=a,s=u)):(i=n(e,c[0]),s=o(e,c[1]),l.push(t(c,i,s)))}return l.length>0?l:null}function a(e,t,r,i){return s(e,r?i?w:S:i?S:x,t)}function u(e,t,r,i){for(var n=[],o=r?i?w:S:i?S:x,a=0;a<t.length;a++){var u=s(e,o,t[a]);u&&u.length>=3&&n.push(u)}return n.length?n:null}function l(e,t,r,i){for(var n=[],o=r?i?w:S:i?S:x,a=0;a<t.length;a++){var u=s(e,o,t[a]);u&&u.length>=2&&n.push(u)}return n.length?n:null}function p(e,t){var r=e.scale,i=e.translate;return t*r[0]+i[0]}function c(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function d(e,t,r){var i=new Array(r.length);if(!r.length)return i;var n=e.scale,o=n[0],s=n[1],a=p(e,r[0][0]),u=c(e,r[0][1]);i[0]=t(r[0],a,u);for(var l=1;l<r.length;l++){var d=r[l];a+=d[0]*o,u-=d[1]*s,i[l]=t(d,a,u)}return i}function h(e,t,r){for(var i=new Array(r.length),n=0;n<r.length;n++)i[n]=d(e,t,r[n]);return i}function f(e,t,r,i){return d(e,r?i?w:S:i?S:x,t)}function y(e,t,r,i){return h(e,r?i?w:S:i?S:x,t)}function _(e,t,r,i){return h(e,r?i?w:S:i?S:x,t)}function g(e,t,r){for(var i=r[0],n=i[0],o=i[1],s=Math.min(n,t[0]),a=Math.min(o,t[1]),u=Math.max(n,t[2]),l=Math.max(o,t[3]),p=1;p<r.length;p++){var c=r[p],d=c[0],h=c[1];n+=d,o+=h,d<0&&(s=Math.min(s,n)),d>0&&(u=Math.max(u,n)),h<0?a=Math.min(a,o):h>0&&(l=Math.max(l,o))}return e[0]=s,e[1]=a,e[2]=u,e[3]=l,e}function m(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(var r=0;r<t.length;r++)g(e,e,t[r]);return e}function T(e,t,r,i,s){return t.xmin=n(e,r.xmin),t.ymin=o(e,r.ymin),t.xmax=n(e,r.xmax),t.ymax=o(e,r.ymax),t!==r&&(i&&(t.zmin=r.zmin,t.zmax=r.zmax),s&&(t.mmin=r.mmin,t.mmax=r.mmax)),t}function v(e,t,r,i,n){return t.points=a(e,r.points,i,n),t}function I(e,t,r,i,s){return t.x=n(e,r.x),t.y=o(e,r.y),t!==r&&(i&&(t.z=r.z),s&&(t.m=r.m)),t}function E(e,t,r,i,n){var o=u(e,r.rings,i,n);return o?(t.rings=o,t):null}function b(e,t,r,i,n){var o=l(e,r.paths,i,n);return o?(t.paths=o,t):null}Object.defineProperty(t,"__esModule",{value:!0});var x=function(e,t,r){return[t,r]},S=function(e,t,r){return[t,r,e[2]]},w=function(e,t,r){return[t,r,e[2],e[3]]};t.toQuantizationTransform=function(e){return e?{originPosition:"upperLeft",scale:[e.tolerance,e.tolerance],translate:[e.extent.xmin,e.extent.ymax]}:null},t.equals=function(e,t){return e===t||null==e&&null==t||null!=e&&null!=t&&(i(e)?(r=e.translate[0],n=e.translate[1],o=e.scale[0]):(r=e.extent.xmin,n=e.extent.ymax,o=e.tolerance),i(t)?(s=t.translate[0],a=t.translate[1],u=t.scale[0]):(s=t.extent.xmin,a=t.extent.ymax,u=t.tolerance),r===s&&n===a&&o===u);var r,n,o,s,a,u},t.quantizeX=n,t.quantizeY=o,t.quantizeBounds=function(e,t,r){return t[0]=n(e,r[0]),t[3]=o(e,r[1]),t[2]=n(e,r[2]),t[1]=o(e,r[3]),t},t.quantizePoints=a,t.quantizeRings=u,t.quantizePaths=l,t.hydrateX=p,t.hydrateY=c,t.hydrateCoordsArray=d,t.hydrateCoordsArrayArray=h,t.hydrateBounds=function(e,t,r){return r?(t[0]=p(e,r[0]),t[1]=c(e,r[3]),t[2]=p(e,r[2]),t[3]=c(e,r[1]),t):[p(e,t[0]),c(e,t[3]),p(e,t[2]),c(e,t[1])]},t.hydratePoints=f,t.hydratePaths=y,t.hydrateRings=_,t.getQuantizedBoundsCoordsArray=g,t.getQuantizedBoundsCoordsArrayArray=m,t.getQuantizedBoundsPoints=function(e){var t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return g(t,t,e)},t.getQuantizedBoundsPaths=function(e){return m([0,0,0,0],e)},t.getQuantizedBoundsRings=function(e){return m([0,0,0,0],e)},t.quantizeExtent=T,t.quantizeMultipoint=v,t.quantizePoint=I,t.quantizePolygon=E,t.quantizePolyline=b,t.quantizeGeometry=function(e,t){return e&&t?r.isPoint(t)?I(e,{},t,!1,!1):r.isPolyline(t)?b(e,{},t,!1,!1):r.isPolygon(t)?E(e,{},t,!1,!1):r.isMultipoint(t)?v(e,{},t,!1,!1):r.isExtent(t)?T(e,{},t,!1,!1):null:null},t.hydrateExtent=function(e,t,r,i,n){return t.xmin=p(e,r.xmin),t.ymin=c(e,r.ymin),t.xmax=p(e,r.xmax),t.ymax=c(e,r.ymax),t!==r&&(i&&(t.zmin=r.zmin,t.zmax=r.zmax),n&&(t.mmin=r.mmin,t.mmax=r.mmax)),t},t.hydrateMultipoint=function(e,t,r,i,n){return t.points=f(e,r.points,i,n),t},t.hydratePoint=function(e,t,r,i,n){return t.x=p(e,r.x),t.y=c(e,r.y),t!==r&&(i&&(t.z=r.z),n&&(t.m=r.m)),t},t.hydratePolygon=function(e,t,r,i,n){return t.rings=_(e,r.rings,i,n),t},t.hydratePolyline=function(e,t,r,i,n){return t.paths=y(e,r.paths,i,n),t}}.apply(null,i))||(e.exports=n)},uqzM:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("9opi"),r("qKT0"),r("2Atf"),r("Q2wQ"),r("HZ3d"),r("PND3"),r("TMur"),r("ma1f"),r("H1tY"),r("qsST"),r("qMld"),r("Vx27"),r("+6sX"),r("rfv1"),r("ZooB"),r("B0tL"),r("B16N"),r("lAK8"),r("IpeC"),r("apbF"),r("Btct"),r("KgG2"),r("W1uT"),r("fUL3"),r("sOkP"),r("EBSo"),r("vBGd")],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c,d,h,f,y,_,g,m,T,v,I,E,b,x,S,w,F,C){Object.defineProperty(t,"__esModule",{value:!0});var P=c.getLogger("esri.views.2d.layers.features.controllers.OnDemandController"),O=p("esri-featurelayer-webgl"),M=p("esri-mobile"),L={maxDrillLevel:O&&"object"==typeof O&&null!=O.maxDrillLevel?O.maxDrillLevel:M?1:4,maxRecordCountFactor:O&&"object"==typeof O&&null!=O.maxRecordCountFactor?O.maxRecordCountFactor:M?1:3,enablePBFQuery:!O||"object"!=typeof O||null==O.enablePBFQuery||O.enablePBFQuery},R=new a.default,V=[],B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="on-demand",t._queryInfoHash=null,t._processingInMainThread=!1,t._dataTileIndex=new x.default,t._editsQueue=new C({concurrency:1,ordered:!0,process:function(e){return t._processEditsEvent(e)}}),t}return r(t,e),t.prototype.initialize=function(){var e=this;this._fetchQueue=new F({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t){return e._fetchTile(t)}}),this._updateQueue=new w.default({tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._updateTile(t,r)}}),this.handles.add(this.watch("processor",this._switchProcessor.bind(this)))},t.prototype.destroy=function(){this._fetchQueue.clear(),this._updateQueue.clear(),this._editsQueue.destroy(),this.queryEngine&&(this.queryEngine.destroy(),this._set("queryEngine",null))},Object.defineProperty(t.prototype,"processing",{get:function(){return g.fromWorker(this.configuration.processing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._fetchQueue.updating||this._updateQueue.updating},enumerable:!0,configurable:!0}),t.prototype.onEdits=function(e){var t=this;this._fetchQueue.pause(),this._fetchQueue.reset(),this._editsQueue.push(e).then(function(){0===t._editsQueue.length&&t._fetchQueue.resume()})},t.prototype.queryFeatures=function(e){return this.queryEngine?this.queryEngine.executeQuery(e):d.resolve({features:[],fields:[]})},t.prototype.queryFeatureCount=function(e){return this.queryEngine?this.queryEngine.executeQueryForCount(e):d.resolve(0)},t.prototype.queryObjectIds=function(e){return this.queryEngine?this.queryEngine.executeQueryForIds(e):d.resolve([])},t.prototype.queryExtent=function(e){return this.queryEngine?this.queryEngine.executeQueryForExtent(e):d.reject({count:0,extent:null})},t.prototype.redraw=function(){this._updateQueue.pause(),this._manageTiles(this.tileStore.tiles),this._updateQueue.resume()},t.prototype.refresh=function(){if(this.queryEngine&&this.queryEngine.destroy(),this.featureStore&&this.featureStore.clear(),this._dataTileIndex.featureStore=null,this._dataTileIndex.clear(),this._editsQueue.pause(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.reset(),this._updateQueue.clear(),this.processor){var e=this.processor.queryInfo,t=e.definitionExpression,r=e.gdbVersion,i=e.historicMoment;this._set("featureStore",new y.default({geometryType:this.service.geometryType,hasM:!1,hasZ:!1})),this._set("queryEngine",new _.default({definitionExpression:t,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,gdbVersion:r,historicMoment:null!=i&&new Date(i),featureStore:this.featureStore})),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.clear(),this._fetchQueue.resume(),this._editsQueue.resume(),this._updateQueue.resume(),this._manageTiles(this.tileStore.tiles)}},t.prototype.setFilter=function(e){var t=e.index,r=e.filter;return s(this,void 0,void 0,function(){var e;return o(this,function(i){switch(i.label){case 0:return this.processor?(this._updateQueue.pause(),[4,this.setFilterBase(t,r)]):(this.setFilterBase(t,r),[2,{show:[],hide:[]}]);case 1:return e=i.sent(),this.processor.supportsTileUpdates||(this._updateQueue.clear(),this._manageTiles(this.tileStore.tiles)),this._updateQueue.resume(),[2,e]}})})},t.prototype.setViewState=function(e){this._fetchQueue.state=e,this._updateQueue.state=e},t.prototype.onTileUpdate=function(e){this.queryEngine&&this._manageTiles(e.added,e.removed)},t.prototype._manageTiles=function(e,t){void 0===t&&(t=null);for(var r=this._dataTileIndex,i=this._fetchQueue,n=this._updateQueue,o="esriGeometryPoint"===this.service.geometryType,s=this,a=0,u=e;a<u.length;a++){!function(e){var t=r.get(e.id);t?(t.displayTile=e,o?r.forEach(function(r){S.isChildOf(r,t)&&(r.displayTile=e)}):t.done=!1):((t=new b.default).tile=e.clone(),t.displayTile=e,r.add(t)),s._processDataTile(t)}(c=u[a])}if(t)for(var l=0,p=t;l<p.length;l++){var c=p[l];R.add(c),n.cancel(c.id)}r.forEach(function(e){R.has(e.displayTile)&&V.push(e)});for(var d=0,h=V;d<h.length;d++){var f=h[d];i.has(f.id)&&i.getPromise(f.id).cancel(),r.delete(f)}V.length=0,R.clear()},t.prototype._processDataTile=function(e){var t=this,r=e.displayTile,i=e.key,n=this._dataTileIndex,o=this._fetchQueue,s=i.id,a=this._queryInfoHash,u=i.level-r.key.level>=L.maxDrillLevel;if(n.add(e),e.done||o.has(s)){if(e.queryInfoHash!==a||e.returnExceeded!==u)if(e.done)e.done=!1;else{if(!o.isOngoing(s))return e.queryInfoHash=a,void(e.returnExceeded=u);o.getPromise(s).cancel()}}else e.queryInfoHash=a,e.returnExceeded=u;e.done?this._invalidateTile(e.displayTile):o.has(s)||o.push(e).then(function(r){return t._handleResponse(e,r)}).catch(function(t){"cancel"!==t.dojoType&&P.error(new l("featurelayer-controller:tile-error","Encountered an error when handling tile response",t)),e.done=!0})},t.prototype._handleResponse=function(e,t){if(e.done=!0,f.hydrateOptimizedFeatureSet(t),t.exceededTransferLimit)if(e.returnExceeded)this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);else for(var r=0,i=e.tile.createChildTiles();r<i.length;r++){var n=i[r],o=new b.default;o.tile=n,o.displayTile=e.displayTile,this._processDataTile(o)}else this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);this._invalidateTile(e.tile)},t.prototype._deleteChildrenDataTiles=function(e){this._dataTileIndex.forEach(function(t){S.isChildOf(t,e)&&V.push(t)});for(var t=0,r=V;t<r.length;t++){var i=r[t];this._fetchQueue.has(i.id)&&this._fetchQueue.getPromise(i.id).cancel(),this._dataTileIndex.delete(i)}V.length=0},t.prototype._fetchTile=function(e){var t=this,r=this._createQuery(e.displayTile,e.tile,e.returnExceeded),i=this.service.source;return L.enablePBFQuery&&this.service.capabilities.query.supportsFormatPBF?m.executeQueryPBF(i,r,{type:"optimized"}).then(function(e){return e.data}):m.executeQuery(i,r).then(function(e){return f.convertFromFeatureSet(e.data,t.service.objectIdField)})},t.prototype._invalidateTile=function(e){for(var t=this._updateQueue,r=0,i=this.tileStore.intersections(e,this.processor.queryInfo.pixelBuffer);r<i.length;r++){var n=i[r].tile;t.push(n.id,n.updateTimestamp)}},t.prototype._updateTile=function(e,t){var r=this,i=this.tileStore.get(e),n=this.processor.queryInfo,o=n.returnCentroid,s=n.returnGeometry,a={pixelBuffer:n.pixelBuffer,returnGeometry:s,returnCentroid:o},u=this._getFilterFlags.bind(this),l=this.queryEngine.executeTileQuery(i,a,u),p=l.features,c=l.objectIds,d={geometryType:this.service.geometryType,features:p,fields:this.service.fields,objectIdFieldName:this.service.objectIdField,transform:{originPosition:"upperLeft",scale:[i.resolution,i.resolution],translate:[i.bounds[0],i.bounds[3]]}};return this._applyProcessing(d).catch(function(e){return e&&"cancel"!==e.dojoType&&P.error("update-tile",e),d}).then(function(e){var n=[],o=!0;return r._dataTileIndex.forEach(function(e){i.id!==e.id&&S.isChildOf(e,i)&&o&&!e.done&&(o=!1)}),o&&i&&i.objectIds.forEach(function(e){c.has(e)||n.push(e)}),c.forEach(function(e){i.objectIds.add(e)}),i.updateTimestamp=t,r.processor.onTileData(i,{addOrUpdate:e.features,remove:n,transformParams:I.getTransformParams(e)}).catch(function(e){e&&"cancel"!==e.dojoType&&P.error("update-tile",e)})})},t.prototype._processEditsEvent=function(e){var t=this;return d.create(function(r,i){var n=function(e){return e.objectId},o=e.deletedFeatures.map(n),s=t._dataTileIndex.deleteFeaturesById(o),a=e.addedFeatures.concat(e.updatedFeatures).map(n);if(a.length){var u=t.service.source,l=t._createObjectIdsQuery(a);m.executeQuery(u,l).then(function(e){var r=e.data;if(r&&r.features&&r.features.length){var i=f.convertFromFeatureSet(r,t.service.objectIdField).features;s.push.apply(s,t._dataTileIndex.addOrUpdateFeatures(i));for(var n=0,o=s;n<o.length;n++){var a=o[n];t._invalidateTile(a.tile)}}}).then(r,r)}else{for(var p=0,c=s;p<c.length;p++){var d=c[p];t._invalidateTile(d.tile)}r()}})},t.prototype._switchProcessor=function(e,t){var r=e.queryInfo,i=r.definitionExpression,n=r.gdbVersion,o=r.historicMoment,s=this._createQueryInfoHash(e);this._queryInfoHash!==s&&(this._queryInfoHash=s,this.queryEngine&&this.queryEngine.destroy(),this.featureStore&&this.featureStore.clear(),this._set("featureStore",new y.default({geometryType:this.service.geometryType,hasM:!1,hasZ:!1})),this._set("queryEngine",new _.default({definitionExpression:i,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,gdbVersion:n,historicMoment:null!=o&&new Date(o),featureStore:this.featureStore,timeInfo:this.service.timeInfo})),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.forEach(function(e){e.done=!1})),this._editsQueue.pause(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.reset(),this._updateQueue.clear(),this._manageTiles(this.tileStore.tiles),this._fetchQueue.resume(),this._editsQueue.resume(),this._updateQueue.resume()},t.prototype._createQuery=function(e,t,r){void 0===r&&(r=!0);var i=this.service.geometryType,n=this._createDefaultQuery(),o="esriGeometryPoint"===this.service.geometryType?t:e;return n.maxRecordCountFactor=L.maxRecordCountFactor,n.resultType="tile",n.returnExceededLimitFeatures=r,n.geometry=new u.Extent({xmin:t.bounds[0],ymin:t.bounds[1],xmax:t.bounds[2],ymax:t.bounds[3],spatialReference:this.spatialReference}),this.service.capabilities.query.supportsQuantization?(n.quantizationParameters=new T.default({mode:"view",originPosition:"upper-left",tolerance:o.resolution,extent:new u.Extent({xmin:o.bounds[0],ymin:o.bounds[1],xmax:o.bounds[2],ymax:o.bounds[3],spatialReference:this.spatialReference})}),"esriGeometryPolyline"===i&&(n.maxAllowableOffset=o.resolution)):"esriGeometryPolyline"!==i&&"esriGeometryPolygon"!==i||(n.maxAllowableOffset=o.resolution),n},t.prototype._createObjectIdsQuery=function(e){var t=this._createDefaultQuery();return t.objectIds=e,t},t.prototype._createDefaultQuery=function(){var e=this,t=this.processor.queryInfo,r=new v;r.outSpatialReference=this.spatialReference;var i=t.outFields,n=t.orderByFields;return this.processing&&(i=i&&i.filter(function(t){return!e.processing.getField(t)}),n=n&&n.filter(function(t){return!e.processing.getField(t)})),i=i.length/this.service.fields.length>=.75?["*"]:i,r.gdbVersion=t.gdbVersion,r.historicMoment=null!=t.historicMoment?new Date(t.historicMoment):null,r.outFields=i,r.where=t.definitionExpression||"1=1",r.returnGeometry=!0,r.returnCentroid=t.returnCentroid,r.orderByFields=n,r},t.prototype._applyProcessing=function(e){var t=this.processing;if(!t)return d.resolve(e);if(this._processingInMainThread)return this.remoteClient.invoke("executeProcessing",{featureSet:e});try{var r=t.process(e,t.options);return r?"then"in r?r:d.resolve(r):d.reject(new l("FeatureLayer","invalid processing.process() method, returns nothing"))}catch(t){return this._processingInMainThread=!0,this.remoteClient.invoke("executeProcessing",{featureSet:e})}},t.prototype._createQueryInfoHash=function(e){var t=this,r=e.queryInfo,i=r.orderByFields,n=r.outFields,o=e.queryInfo,s=o.definitionExpression,a=o.gdbVersion,u=o.historicMoment;return this.processing&&(n=n&&n.filter(function(e){return!t.processing.getField(e)}),i=i&&i.filter(function(e){return!t.processing.getField(e)})),n&&n.sort(),i&&i.sort(),JSON.stringify({definitionExpression:s,outFields:n.length/this.service.fields.length>=.75?["*"]:n,orderByFields:i,gdbVersion:a,historicMoment:u})},i([h.property()],t.prototype,"_fetchQueue",void 0),i([h.property()],t.prototype,"_updateQueue",void 0),i([h.property({readOnly:!0,dependsOn:["configuration"]})],t.prototype,"processing",null),i([h.property({readOnly:!0})],t.prototype,"queryEngine",void 0),i([h.property({readOnly:!0})],t.prototype,"featureStore",void 0),i([h.property({dependsOn:["_fetchQueue.updating","_updateQueue.updating"]})],t.prototype,"updating",null),i([h.subclass()],t)}(h.declared(E.default));t.default=B}.apply(null,i))||(e.exports=n)},v7zm:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e,t,r,i){this._tag=0,this._dataType=99,this._data=e,this._dataView=t,this._pos=r||0,this._end=i||e.byteLength}return e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.getMessage=function(){var t=this._getLength(),r=this._pos,i=new e(this._data,this._dataView,r,r+t);return this._skip(t),i},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,i=0;if(this._end-r>=10)do{if(i|=127&(e=t[r++]),0==(128&e))break;if(i|=(127&(e=t[r++]))<<7,0==(128&e))break;if(i|=(127&(e=t[r++]))<<14,0==(128&e))break;if(i|=(127&(e=t[r++]))<<21,0==(128&e))break;if(i+=268435456*(127&(e=t[r++])),0==(128&e))break;if(i+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(i+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(i+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(i+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(i+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var n=1;r!==this._end&&0!=(128&(e=t[r]));)++r,i+=(127&e)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=e*n}return this._pos=r,i},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){var i="",n="";r=Math.min(this._end,r);for(var o=t;o<r;++o){var s=e[o];128&s?n+="%"+s.toString(16):(i+=decodeURIComponent(n)+String.fromCharCode(s),n="")}return n.length&&(i+=decodeURIComponent(n)),i},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e}()}.apply(null,i))||(e.exports=n)},"yre/":function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r("jZlN"),r("pcDC"),r("Z4y+"),r("KQcO")],void 0===(n=function(e,t,r,i,n,o){function s(e,t,r,i){return t}function a(e,t,r,i){switch(r){case 0:return c(e,t+i,0);case 1:return d(e,t+i,1)}}function u(e,t,r,i){switch(r){case 0:return c(e,t+i,0);case 1:return d(e,t+i,1);case 2:return c(e,t,2)}}function l(e,t,r,i){switch(r){case 0:return c(e,t+i,0);case 1:return d(e,t+i,1);case 2:return c(e,t,3)}}function p(e,t,r,i){switch(r){case 0:return c(e,t+i,0);case 1:return d(e,t+i,1);case 2:case 3:return c(e,t,3)}}function c(e,t,r){var i=e.translate,n=e.scale;return i[r]+t*n[r]}function d(e,t,r){var i=e.translate,n=e.scale;return i[r]-t*n[r]}Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function e(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=s,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0}return e.prototype.createFeatureResult=function(){return{exceededTransferLimit:!1,features:[],fields:[],hasM:!1,hasZ:!1,geometryType:null,objectIdFieldName:null,globalIdFieldName:null,geometryProperties:null,geohashFieldName:null,spatialReference:null,transform:null}},e.prototype.finishFeatureResult=function(e){this.options.applyTransform&&(e.transform=null)},e.prototype.createSpatialReference=function(){return new n},e.prototype.addField=function(e,t){e.fields.push(o.fromJSON(t))},e.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(var i in t.attributes){var n=t.attributes[i];"string"==typeof n&&n.length>r&&delete t.attributes[i]}e.features.push(t)},e.prototype.prepareFeatures=function(e){switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=this.addCoordinatePoint.bind(this),this.createGeometry=this.createPointGeometry.bind(this);break;case"polygon":this.addCoordinate=this.addCoordinatePolygon.bind(this),this.createGeometry=this.createPolygonGeometry.bind(this);break;case"polyline":this.addCoordinate=this.addCoordinatePolyline.bind(this),this.createGeometry=this.createPolylineGeometry.bind(this);break;case"multipoint":this.addCoordinate=this.addCoordinateMultipoint.bind(this),this.createGeometry=this.createMultipointGeometry.bind(this);break;default:i.neverReached(e.geometryType)}},e.prototype.createFeature=function(e){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{uid:r.generateUID(),objectId:null,attributes:{},geometry:null,visible:!0}},e.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},e.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},e.prototype.addCoordinatePoint=function(e,t,r,i){switch(t=this.applyTransform(this.transform,t,i,0),i){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},e.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},e.prototype.addCoordinatePolyline=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.paths,t,r,i)},e.prototype.addCoordinatePolygon=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.rings,t,r,i)},e.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var i=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(i)},e.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.dehydratedAddPointsCoordinate=function(e,t,r,i){if(null===this.coordinateBuffer){var n=this.lengths.reduce(function(e,t){return e+t},0);this.coordinateBuffer=new Float64Array(n*this.vertexDimension)}0===i&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var o=this.transformPathLikeValue(t,i),s=e[e.length-1];0===i&&s.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=o},e.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?p:t?u:r?l:a},e}();t.Context=h}.apply(null,i))||(e.exports=n)}}]);