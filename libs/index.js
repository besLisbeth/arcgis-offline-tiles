define(["esri/layers/support/LOD","esri/geometry/Point","esri/geometry/SpatialReference","esri/layers/WebTileLayer","esri/layers/TileLayer","esri/request","esri/core/promiseUtils","esri/layers/support/TileInfo","esri/geometry/Extent"],function(e,t,n,r,o,i,a,s,u){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=12)}([function(e,t,n){e.exports=n(13)},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t,n){var r,o=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var i={compressToBase64:function(e){if(null==e)return"";var n=i._compress(e,6,function(e){return t.charAt(e)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:i._decompress(e.length,32,function(n){return o(t,e.charAt(n))})},compressToUTF16:function(t){return null==t?"":i._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:i._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=i.compress(e),n=new Uint8Array(2*t.length),r=0,o=t.length;r<o;r++){var a=t.charCodeAt(r);n[2*r]=a>>>8,n[2*r+1]=a%256}return n},decompressFromUint8Array:function(t){if(null==t)return i.decompress(t);for(var n=new Array(t.length/2),r=0,o=n.length;r<o;r++)n[r]=256*t[2*r]+t[2*r+1];var a=[];return n.forEach(function(t){a.push(e(t))}),i.decompress(a.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,function(e){return n.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),i._decompress(e.length,32,function(t){return o(n,e.charAt(t))}))},compress:function(t){return i._compress(t,16,function(t){return e(t)})},_compress:function(e,t,n){if(null==e)return"";var r,o,i,a={},s={},u="",c="",l="",f=2,A=3,p=2,h=[],d=0,v=0;for(i=0;i<e.length;i+=1)if(u=e.charAt(i),Object.prototype.hasOwnProperty.call(a,u)||(a[u]=A++,s[u]=!0),c=l+u,Object.prototype.hasOwnProperty.call(a,c))l=c;else{if(Object.prototype.hasOwnProperty.call(s,l)){if(l.charCodeAt(0)<256){for(r=0;r<p;r++)d<<=1,v==t-1?(v=0,h.push(n(d)),d=0):v++;for(o=l.charCodeAt(0),r=0;r<8;r++)d=d<<1|1&o,v==t-1?(v=0,h.push(n(d)),d=0):v++,o>>=1}else{for(o=1,r=0;r<p;r++)d=d<<1|o,v==t-1?(v=0,h.push(n(d)),d=0):v++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)d=d<<1|1&o,v==t-1?(v=0,h.push(n(d)),d=0):v++,o>>=1}0==--f&&(f=Math.pow(2,p),p++),delete s[l]}else for(o=a[l],r=0;r<p;r++)d=d<<1|1&o,v==t-1?(v=0,h.push(n(d)),d=0):v++,o>>=1;0==--f&&(f=Math.pow(2,p),p++),a[c]=A++,l=String(u)}if(""!==l){if(Object.prototype.hasOwnProperty.call(s,l)){if(l.charCodeAt(0)<256){for(r=0;r<p;r++)d<<=1,v==t-1?(v=0,h.push(n(d)),d=0):v++;for(o=l.charCodeAt(0),r=0;r<8;r++)d=d<<1|1&o,v==t-1?(v=0,h.push(n(d)),d=0):v++,o>>=1}else{for(o=1,r=0;r<p;r++)d=d<<1|o,v==t-1?(v=0,h.push(n(d)),d=0):v++,o=0;for(o=l.charCodeAt(0),r=0;r<16;r++)d=d<<1|1&o,v==t-1?(v=0,h.push(n(d)),d=0):v++,o>>=1}0==--f&&(f=Math.pow(2,p),p++),delete s[l]}else for(o=a[l],r=0;r<p;r++)d=d<<1|1&o,v==t-1?(v=0,h.push(n(d)),d=0):v++,o>>=1;0==--f&&(f=Math.pow(2,p),p++)}for(o=2,r=0;r<p;r++)d=d<<1|1&o,v==t-1?(v=0,h.push(n(d)),d=0):v++,o>>=1;for(;;){if(d<<=1,v==t-1){h.push(n(d));break}v++}return h.join("")},decompress:function(e){return null==e?"":""==e?null:i._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,n,r){var o,i,a,s,u,c,l,f=[],A=4,p=4,h=3,d="",v=[],y={val:r(0),position:n,index:1};for(o=0;o<3;o+=1)f[o]=o;for(a=0,u=Math.pow(2,2),c=1;c!=u;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;switch(a){case 0:for(a=0,u=Math.pow(2,8),c=1;c!=u;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;l=e(a);break;case 1:for(a=0,u=Math.pow(2,16),c=1;c!=u;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;l=e(a);break;case 2:return""}for(f[3]=l,i=l,v.push(l);;){if(y.index>t)return"";for(a=0,u=Math.pow(2,h),c=1;c!=u;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;switch(l=a){case 0:for(a=0,u=Math.pow(2,8),c=1;c!=u;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;f[p++]=e(a),l=p-1,A--;break;case 1:for(a=0,u=Math.pow(2,16),c=1;c!=u;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;f[p++]=e(a),l=p-1,A--;break;case 2:return v.join("")}if(0==A&&(A=Math.pow(2,h),h++),f[l])d=f[l];else{if(l!==p)return null;d=i+i.charAt(0)}v.push(d),f[p++]=i+d.charAt(0),i=d,0==--A&&(A=Math.pow(2,h),h++)}}};return i}();void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r)},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t,n){(function(n){var r,o,i;o=[],void 0===(i="function"==typeof(r=function(){"use strict";function t(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){a(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function r(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,a=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype?function(e,n,a){var s=i.URL||i.webkitURL,u=document.createElement("a");n=n||e.name||"download",u.download=n,u.rel="noopener","string"==typeof e?(u.href=e,u.origin===location.origin?o(u):r(u.href)?t(e,n,a):o(u,u.target="_blank")):(u.href=s.createObjectURL(e),setTimeout(function(){s.revokeObjectURL(u.href)},4e4),setTimeout(function(){o(u)},0))}:"msSaveOrOpenBlob"in navigator?function(e,n,i){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,i),n);else if(r(e))t(e,n,i);else{var a=document.createElement("a");a.href=e,a.target="_blank",setTimeout(function(){o(a)})}}:function(e,n,r,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,r);var a="application/octet-stream"===e.type,s=/constructor/i.test(i.HTMLElement)||i.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||a&&s)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},c.readAsDataURL(e)}else{var l=i.URL||i.webkitURL,f=l.createObjectURL(e);o?o.location=f:location.href=f,o=null,setTimeout(function(){l.revokeObjectURL(f)},4e4)}});i.saveAs=a.saveAs=a,e.exports=a})?r.apply(t,o):r)||(e.exports=i)}).call(this,n(14))},function(e,t){e.exports=s},function(e,t){e.exports=u},function(e,t,n){e.exports=n(15)},function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(e,t,n,r){var o=t&&t.prototype instanceof d?t:d,i=Object.create(o.prototype),a=new k(r||[]);return i._invoke=function(e,t,n){var r=l;return function(o,i){if(r===A)throw new Error("Generator is already running");if(r===p){if("throw"===o)throw i;return L()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=A;var u=c(e,t,n);if("normal"===u.type){if(r=n.done?p:f,u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(e,n,a),i}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l="suspendedStart",f="suspendedYield",A="executing",p="completed",h={};function d(){}function v(){}function y(){}var g={};g[i]=function(){return this};var m=Object.getPrototypeOf,w=m&&m(m(B([])));w&&w!==n&&r.call(w,i)&&(g=w);var x=y.prototype=d.prototype=Object.create(g);function b(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function T(e){var t;this._invoke=function(n,o){function i(){return new Promise(function(t,i){!function t(n,o,i,a){var s=c(e[n],e,o);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==typeof l&&r.call(l,"__await")?Promise.resolve(l.__await).then(function(e){t("next",e,i,a)},function(e){t("throw",e,i,a)}):Promise.resolve(l).then(function(e){u.value=e,i(u)},function(e){return t("throw",e,i,a)})}a(s.arg)}(n,o,t,i)})}return t=t?t.then(i,i):i()}}function E(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var o=c(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,h;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function B(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:L}}function L(){return{value:t,done:!0}}return v.prototype=x.constructor=y,y.constructor=v,y[s]=v.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},b(T.prototype),T.prototype[a]=function(){return this},e.AsyncIterator=T,e.async=function(t,n,r,o){var i=new T(u(t,n,r,o));return e.isGeneratorFunction(n)?i:i.next().then(function(e){return e.done?e.value:i.next()})},b(x),x[s]="Generator",x[i]=function(){return this},x.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=B,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),c=r.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;C(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:B(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"isIndexedDBSupported",function(){return ce}),n.d(r,"getAvailableStorageSpace",function(){return le});var o=n(0),i=n.n(o),a=n(5),s=n.n(a),u=n(6),c=n.n(u),l=n(7),f=n.n(l),A=n(2),p=n.n(A),h=n(8),d=n(9),v=n.n(d),y=n(4),g=n.n(y),m={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decompress:function(e){for(var t,n,r,o,i,a,s,u=[],c=1,l=e.charCodeAt(0)>>8;c<2*e.length&&(c<2*e.length-1||0===l);)c%2==0?(t=e.charCodeAt(c/2)>>8,n=255&e.charCodeAt(c/2),r=c/2+1<e.length?e.charCodeAt(c/2+1)>>8:NaN):(t=255&e.charCodeAt((c-1)/2),(c+1)/2<e.length?(n=e.charCodeAt((c+1)/2)>>8,r=255&e.charCodeAt((c+1)/2)):n=r=NaN),c+=3,o=t>>2,i=(3&t)<<4|n>>4,a=(15&n)<<2|r>>6,s=63&r,isNaN(n)||c===2*e.length+1&&l?a=s=64:(isNaN(r)||c===2*e.length&&l)&&(s=64),u.push(m._keyStr.charAt(o)),u.push(m._keyStr.charAt(i)),u.push(m._keyStr.charAt(a)),u.push(m._keyStr.charAt(s));return u.join("")},compress:function(e){var t,n,r,o,i,a,s,u=[],c=1,l=0,f=!1;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)n=m._keyStr.indexOf(e.charAt(l++))<<2|(i=m._keyStr.indexOf(e.charAt(l++)))>>4,r=(15&i)<<4|(a=m._keyStr.indexOf(e.charAt(l++)))>>2,o=(3&a)<<6|(s=m._keyStr.indexOf(e.charAt(l++))),c%2==0?(t=n<<8,f=!0,64!==a&&(u.push(String.fromCharCode(t|r)),f=!1),64!==s&&(t=o<<8,f=!0)):(u.push(String.fromCharCode(t|n)),f=!1,64!==a&&(t=r<<8,f=!0),64!==s&&(u.push(String.fromCharCode(t|o)),f=!1)),c+=3;return f?(u.push(String.fromCharCode(t)),u=u.join(""),u=String.fromCharCode(256|u.charCodeAt(0))+u.substring(1)):u=u.join(""),u},stringToWord:function(e){for(var t=[],n=0,r=8*e.length;n<r;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},wordToBase64:function(e){for(var t=[],n=0,r=4*e.length;n<r;n+=3)for(var o=(e[n>>2]>>n%4*8&255)<<16|(e[n+1>>2]>>(n+1)%4*8&255)<<8|e[n+2>>2]>>(n+2)%4*8&255,i=0;i<4;i++)8*n+6*i>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>6*(3-i)&63));return t.join("")}};function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var x={getTileSizeInBytes:function(e){return new Promise(function(t,n){if(e){var r=new XMLHttpRequest;r.open("GET",e,!0),r.overrideMimeType("text/plain; charset=x-user-defined"),r.onload=function(){200===r.status&&""!==r.responseText?t(m.wordToBase64(m.stringToWord(r.responseText)).length+e.length):n("xhr failed for",e)},r.send(null)}else t(NaN)})},parseNum:function(e){return e.match(/[\/]\d+/g).map(function(e){return e.replace("/","")})},getLevelRowColFromURL:function(e,t){if("tile"===e){var n=w(this.parseNum(t),3),r=n[0],o=void 0===r?0:r,i=n[1],a=void 0===i?0:i,s=n[2];return{level:o,row:a,col:void 0===s?0:s}}var u=w(this.parseNum(t),3),c=u[0],l=void 0===c?0:c,f=u[1],A=void 0===f?0:f,p=u[2];return{level:l,row:void 0===p?0:p,col:A}},getTileSizeFromMinMaxLevels:function(e,t,n,r){var o=this;return this.getTileSizeInBytes(e.lastTileUrl).then(function(i){for(var a=0,s=0,u=n;u<=r;u++)s+=(a+=o.getCellsInExtent(e.tileInfo,t,u).length)*i;return{tileCount:a,sizeBytes:s}})},getCellsInExtent:function(e,t,n){for(var r=this.getCellFromXy(e,t.xmin,t.ymin,n),o=this.getCellFromXy(e,t.xmax,t.ymax,n),i=Math.max(Math.min(r[0],o[0]),e.lods[n].startTileCol),a=Math.min(Math.max(r[0],o[0]),e.lods[n].endTileCol),s=Math.max(Math.min(r[1],o[1]),e.lods[n].startTileRow),u=Math.min(Math.max(r[1],o[1]),e.lods[n].endTileRow),c=[],l=i;l<=a;l++)for(var f=s;f<=u;f++)c.push([l,f]);return c},getCellFromXy:function(e,t,n,r){return[Math.floor((t-e.origin.x)/(e.lods[r].cols*e.lods[r].resolution)),Math.floor((e.origin.y-n)/(e.lods[r].rows*e.lods[r].resolution))]}};const b=(e,t)=>t.some(t=>e instanceof t);let T,E;const I=new WeakMap,C=new WeakMap,k=new WeakMap,B=new WeakMap,L=new WeakMap;let j={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return C.get(e);if("objectStoreNames"===t)return e.objectStoreNames||k.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return N(e[t])},has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function S(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(E||(E=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(R(this),t),N(I.get(this))}:function(...t){return N(e.apply(R(this),t))}:function(t,...n){const r=e.call(R(this),t,...n);return k.set(r,t.sort?t.sort():[t]),N(r)}}function O(e){return"function"==typeof e?S(e):(e instanceof IDBTransaction&&function(e){if(C.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),r()},i=()=>{n(e.error),r()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)});C.set(e,t)}(e),b(e,T||(T=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,j):e)}function N(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(N(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&I.set(t,e)}),L.set(t,e),t}(e);if(B.has(e))return B.get(e);const t=O(e);return t!==e&&(B.set(e,t),L.set(t,e)),t}const R=e=>L.get(e);function P(e,t,{blocked:n,upgrade:r,blocking:o}={}){const i=indexedDB.open(e,t),a=N(i);return r&&i.addEventListener("upgradeneeded",e=>{r(N(i.result),e.oldVersion,e.newVersion,N(i.transaction))}),n&&i.addEventListener("blocked",()=>n()),o&&a.then(e=>e.addEventListener("versionchange",o)),a}const D=["get","getKey","getAll","getAllKeys","count"],Q=["put","add","delete","clear"],F=new Map;function M(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(F.get(t))return F.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=Q.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!D.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,o?"readwrite":"readonly");let a=i.store;r&&(a=a.index(t.shift()));const s=a[n](...t);return o&&await i.done,s};return F.set(t,i),i}function V(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function U(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){V(i,r,o,a,s,"next",e)}function s(e){V(i,r,o,a,s,"throw",e)}a(void 0)})}}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}j=(e=>({get:(t,n,r)=>M(t,n)||e.get(t,n,r),has:(t,n)=>!!M(t,n)||e.has(t,n)}))(j);var q=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"db";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexedDb=null,this.dbName=void 0,this.version=1,this.dbName=t}var t,n,r,o,a,s;return t=e,(n=[{key:"getObjectStore",value:function(e){return this.indexedDb.transaction(e).objectStore(e)}},{key:"createObjectStore",value:(s=U(i.a.mark(function e(t){var n=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.version=++this.version,e.prev=1,e.next=4,P(this.dbName,this.version,{upgrade:function(e){e.objectStoreNames.contains(t)||e.createObjectStore(t)},blocking:function(){n.indexedDb.close()}});case 4:this.indexedDb=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.log(e.t0);case 10:return e.abrupt("return",this.indexedDb);case 11:case"end":return e.stop()}},e,this,[[1,7]])})),function(e){return s.apply(this,arguments)})},{key:"addRecord",value:function(e,t,n){return this.indexedDb.put(e,t,n)}},{key:"getRecord",value:(a=U(i.a.mark(function e(t,n){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.indexedDb.get(t,n);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",Promise.reject("Record with key ".concat(n," is not existing")));case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"removeAll",value:function(e){return this.indexedDb.clear(e)}},{key:"removeRecord",value:function(e,t){return this.indexedDb.delete(e,t)}},{key:"getAllRecords",value:(o=U(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getObjectStore(t).openCursor();case 2:n=e.sent,r=[];case 4:if(!n){e.next=11;break}return r.push([n.key,n.value]),e.next=8,n.continue();case 8:n=e.sent,e.next=4;break;case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})}])&&K(t.prototype,n),r&&K(t,r),e}(),G=n(10),X=n.n(G),H=n(1),z=n.n(H),Z=n(11),Y=n.n(Z),J=n(3),W=n.n(J),_=new Y.a(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,W.a.WebMercator),$=new X.a({size:256,dpi:96,format:"PNG8",compressionQuality:0,origin:new p.a({x:-20037508.342787,y:20037508.342787,spatialReference:W.a.WebMercator}),spatialReference:W.a.WebMercator,lods:[new z.a({level:0,scale:591657527.591555,resolution:156543.033928}),new z.a({level:1,scale:295828763.795777,resolution:78271.5169639999}),new z.a({level:2,scale:147914381.897889,resolution:39135.7584820001}),new z.a({level:3,scale:73957190.948944,resolution:19567.8792409999}),new z.a({level:4,scale:36978595.474472,resolution:9783.93962049996}),new z.a({level:5,scale:18489297.737236,resolution:4891.96981024998}),new z.a({level:6,scale:9244648.868618,resolution:2445.98490512499}),new z.a({level:7,scale:4622324.434309,resolution:1222.99245256249}),new z.a({level:8,scale:2311162.217155,resolution:611.49622628138}),new z.a({level:9,scale:1155581.108577,resolution:305.748113140558}),new z.a({level:10,scale:577790.554289,resolution:152.874056570411}),new z.a({level:11,scale:288895.277144,resolution:76.4370282850732}),new z.a({level:12,scale:144447.638572,resolution:38.2185141425366}),new z.a({level:13,scale:72223.819286,resolution:19.1092570712683}),new z.a({level:14,scale:36111.909643,resolution:9.55462853563415}),new z.a({level:15,scale:18055.954822,resolution:4.77731426794937}),new z.a({level:16,scale:9027.977411,resolution:2.38865713397468}),new z.a({level:17,scale:4513.988705,resolution:1.19432856685505}),new z.a({level:18,scale:2256.994353,resolution:.597164283559817}),new z.a({level:19,scale:1128.497176,resolution:.298582141647617})]});function ee(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function te(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){ee(i,r,o,a,s,"next",e)}function s(e){ee(i,r,o,a,s,"throw",e)}a(void 0)})}}var ne,re,oe,ie,ae,se={init:(ae=te(i.a.mark(function e(t,n){var r,o=this,a=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:"tiles",this.indexedDbService=n,this.objectStoreName=r,e.next=5,this.getAllTiles(t).catch(te(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.createRecord(t);case 2:case"end":return e.stop()}},e)})));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return ae.apply(this,arguments)}),createRecord:(ie=te(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.indexedDbService.addRecord(this.objectStoreName,[],t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return ie.apply(this,arguments)}),addTile:(oe=te(i.a.mark(function e(t,n){var r,o,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.url,o=n.img,e.next=3,this.getAllTiles(t);case 3:return(a=e.sent).push({url:r,img:o}),e.next=7,this.indexedDbService.addRecord(this.objectStoreName,a,t);case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}},e,this)})),function(e,t){return oe.apply(this,arguments)}),getTileImg:(re=te(i.a.mark(function e(t,n){var r,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllTiles(t);case 2:if(!(r=e.sent)){e.next=8;break}if(!(o=r.find(function(e){return e.url===n}))){e.next=7;break}return e.abrupt("return",o.img);case 7:return e.abrupt("return",Promise.reject("Not Found"));case 8:case"end":return e.stop()}},e,this)})),function(e,t){return re.apply(this,arguments)}),removeAllTiles:(ne=te(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createRecord(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(e){return ne.apply(this,arguments)}),getAllTiles:function(e){return this.indexedDbService.getRecord(this.objectStoreName,e)}};function ue(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function ce(){return!!window.indexedDB}function le(){return fe.apply(this,arguments)}function fe(){var e;return e=i.a.mark(function e(){var t,n,r,o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("storage"in navigator&&"estimate"in navigator.storage)){e.next=8;break}return e.next=3,navigator.storage.estimate();case 3:return t=e.sent,n=t.usage,r=t.quota,o=Math.round(n/r*100),e.abrupt("return",{percent:o,usage:n,quota:r,left:r-n});case 8:return e.abrupt("return",{usage:NaN,quota:NaN,left:NaN});case 9:case"end":return e.stop()}},e)}),(fe=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){ue(i,r,o,a,s,"next",e)}function s(e){ue(i,r,o,a,s,"throw",e)}a(void 0)})}).apply(this,arguments)}function Ae(e){return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function he(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function de(e,t){return!t||"object"!==Ae(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ve(e){return(ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ge(e,t,n,r,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function me(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){ge(i,r,o,a,s,"next",e)}function s(e){ge(i,r,o,a,s,"throw",e)}a(void 0)})}}function we(e){return new Te(e)}function xe(e){return function(){return new be(e.apply(this,arguments))}}function be(e){var t,n;function r(t,n){try{var i=e[t](n),a=i.value,s=a instanceof Te;Promise.resolve(s?a.wrapped:a).then(function(e){s?r("next",e):o(i.done?"return":"normal",e)},function(e){r("throw",e)})}catch(e){o("throw",e)}}function o(e,o){switch(e){case"return":t.resolve({value:o,done:!0});break;case"throw":t.reject(o);break;default:t.resolve({value:o,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,o){return new Promise(function(i,a){var s={key:e,arg:o,resolve:i,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,o))})},"function"!=typeof e.return&&(this.return=void 0)}function Te(e){this.wrapped=e}"function"==typeof Symbol&&Symbol.asyncIterator&&(be.prototype[Symbol.asyncIterator]=function(){return this}),be.prototype.next=function(e){return this._invoke("next",e)},be.prototype.throw=function(e){return this._invoke("throw",e)},be.prototype.return=function(e){return this._invoke("return",e)};var Ee,Ie={dbName:"offline-layers",objectStoreName:"tiles",showNoTile:!0,noTileIcon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAABQdJREFUeNrs2yFv6mocwOH/ualYRUVJRrKKCRATCCZqJ/mOfKQJBGaiYkcguoSJigoQTc4VN222Mdhu7l0ysudJjqFAD13669u37a/lcvkngB8piYhYLBa2BPxAf9kEIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgAIACAAAACAAgACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAgAIAAAAIACAAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIACAAgAAAAgAIAPxsiU3wfbRtG1mWnVzedV3kef7q9a7rYrvdxm63i4iILMtiNBpFkiQfftdnZFkWbdtGRAzr7j+fZdnR9Xy0jiRJTv5eBOBHqaoqsiyLm5ubo8ubponFYjG8Vtd1VFV1sKMlSRI3NzdRFMXJ7/qMsixjtVpFRAzr7j9fluVBkD67jjzPoyxLf3gBoLfZbGI8Hh/dqV6q6zoeHh4iSZKYTCYxGo0iImK73Q7Luq6L6+vrg88WRfFqHfv9Puq6jjRN4+rq6tV7Ly4u/tNvKori3e9I09QfXAB4a71ex93d3ckhfNd1UVXVcIR+OZTO8zyKooj7+/uoqiouLy8Pdra3I4OmaaKu67i4uIjpdPq//p63seH7MAn4DXVdF+v1+sOjf390f+88Osuy4ci/2WxsVATgXEwmk2ia5uSOu91uIyJiPB4ffU+/rJ/AA6cAZ2A6ncbz83NUVRV5nr97hO8n104Nrftln53s+ypVVR2czpj8MwLghPl8HkmSDBN556xt22ia5tU/jAA4IU3TmE6nUVVVVFUVs9nsbH/LqUuFGAFwxPX1deR5HnVdD+f8LwPx0fl9f2OQy20IwJm6vb0dTgX2+/3wej8vcCoA/VDb3XYIwLmeoyVJzGaz6LpuOKJHRFxeXkbEP5cDj+mX9e8FAThD4/H44HJfURSRpmk0TROPj48Hn3l4eIimaSJN06O3A4NJwDMxm82ibdtXo4D5fB6r1Sp+//4dz8/Pw5H+6ekpdrtdJEkS8/n8S/9f713ie3vaceo9x557QAB451Sgfyin34HKshweunk5HzAej2MymXz5+f9nbjJyI9L39Wu5XP55+XQZ39uxR4Z3u90wSXjqEV0wAjhjx47oaZq63Me/ZhIQBAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEAAbAJQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAQAAAAQAEABAAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEABAAAABAAQAEAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEABAAQAEAAAAEAvqe/BwCeKjUweoA8pQAAAABJRU5ErkJggg=="};function Ce(){return ke.apply(this,arguments)}function ke(){return(ke=me(i.a.mark(function e(){var t,n,r,o,a,s,u,c,l,f=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.length>0&&void 0!==f[0]?f[0]:Ie,n=t.dbName,r=void 0===n?Ie.dbName:n,o=t.objectStoreName,a=void 0===o?Ie.objectStoreName:o,s=t.showNoTile,u=void 0===s?Ie.showNoTile:s,c=t.noTileIcon,l=void 0===c?Ie.noTileIcon:c,Ee=new q((Ie={dbName:r,objectStoreName:a,showNoTile:u,noTileIcon:l}).dbName),e.next=5,Ee.createObjectStore(Ie.objectStoreName);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Be(e,t){if(!ce())return new e(t);if(e===c.a||e===s.a){if(!Ee)throw new Error("Init offline features once with 'initOfflineFeatures' function before creating OfflineLayer");return new(Le(e))(t,Ee)}throw new Error("Layer is not TileLayer or WebTileLayer")}var Le=function(e){return function(t){function n(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(r=de(this,ve(n).call(this,e))).lastTileUrl="",r.isOnline=!0,r.fullExtent=_,r.tileInfo=$,r.offlineKey="",r.goOffline=function(){r.isOnline=!1,r.refresh()},r.goOnline=function(){r.isOnline=!0,r.refresh()},r.deleteAllTiles=function(){return se.removeAllTiles(r.offlineKey)},r.extendTileLOD(),ce()&&(r.offlineKey=r.title||r.id,se.init(r.offlineKey,t,Ie.objectStoreName)),r}var r,o,a,s,u,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(n,e),r=n,(o=[{key:"fetchTile",value:function(e,t,n,r){var o=this;if(this.lastTileUrl=this.getTileUrl(e,t,n).split("?")[0],this.isOnline)return f()(this.lastTileUrl,{responseType:"image"}).then(function(e){return o.createCanvasImage(e.data,o.tileInfo.size[0])},function(e){return console.log(e),o.createCanvasImage(null,o.tileInfo.size[0])});var i=document.createElement("img");return h.create(function(e){i.onload=function(){return e(i)},se.getTileImg(o.offlineKey,g.a.compressToUTF16(o.lastTileUrl)).then(function(e){return i.src="data:image/"+o.tileInfo.format.toLowerCase()+";base64,"+m.decompress(e)}).catch(function(){Ie.showNoTile&&(i.src=Ie.noTileIcon)})}).then(function(e){return o.createCanvasImage(e,o.tileInfo.size[0])})}},{key:"createCanvasImage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;!e&&Ie.showNoTile&&((e=document.createElement("img")).src=Ie.noTileIcon);var n=document.createElement("canvas"),r=n.getContext("2d");return n.width=t,n.height=t,r.drawImage(e,0,0,t,t),n}},{key:"isSavedToIndexedDB",value:(c=me(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se.getAllTiles(this.offlineKey).catch(function(){});case 2:return t=e.sent,e.abrupt("return",!(!t||!t.length));case 4:case"end":return e.stop()}},e,this)})),function(){return c.apply(this,arguments)})},{key:"saveToFile",value:(u=me(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se.getAllTiles(this.offlineKey);case 2:n=e.sent,(r=[]).push("url,img"),n.forEach(function(e){var t=e.url,n=e.img;return r.push(t+","+m.decompress(n))}),v.a.saveAs(new Blob([r.join("\r\n")],{type:"text/plain;charset=utf-16"}),t);case 7:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"loadFromFile",value:(s=me(i.a.mark(function e(t,n){var r=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,o){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return o("The File APIs are not fully supported in this browser.");var a=new FileReader,s=r.offlineKey;a.onload=function(r){return e(xe(i.a.mark(function e(){var o,a,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("url,img"===(o=r.target.result.split("\r\n"))[0]){e.next=3;break}return e.abrupt("return",Promise.reject("File "+t.name+" doesn't contain tiles that can be loaded"));case 3:return e.next=5,we(se.removeAllTiles(s));case 5:o.shift(),a=i.a.mark(function e(t){var r,a,u,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o[t].split(","),a=pe(r,2),u=a[0],c=a[1],e.next=3,se.addTile(s,{url:u,img:m.compress(c)}).catch(function(){}).finally(function(){n({percent:Math.round(o.length?t/o.length*100:0).toFixed(1)+"%",done:t===o.length-1})});case 3:case"end":return e.stop()}},e)}),u=0;case 8:if(!(u<o.length)){e.next=13;break}return e.delegateYield(a(u),"t0",10);case 10:u++,e.next=8;break;case 13:case"end":return e.stop()}},e)}))())},a.readAsText(t[0])}));case 1:case"end":return e.stop()}},e)})),function(e,t){return s.apply(this,arguments)})},{key:"uploadTile",value:function(e){var t=e.level,n=e.row,r=e.col;return this.saveTileToDB(this.getTileUrl(t,n,r))}},{key:"uploadTilesToIndexedDb",value:function(e,t,n,r){var o=this;return xe(i.a.mark(function a(){var s,u,c,l,f;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:for(s=[],u=function(e){x.getCellsInExtent(o.tileInfo,n,e).forEach(function(t){s.push({level:e,row:t[1],col:t[0]})})},c=e;c<=t;c++)u(c);return a.next=5,we(se.removeAllTiles(o.offlineKey));case 5:l=i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.uploadTile(s[t]).catch(function(){}).finally(function(){r({percent:Math.round(s.length?t/s.length*100:0).toFixed(1)+"%",done:t===s.length-1})});case 2:case"end":return e.stop()}},e)}),f=0;case 7:if(!(f<s.length)){a.next=12;break}return a.delegateYield(l(f),"t0",9);case 9:f++,a.next=7;break;case 12:case"end":return a.stop()}},a)}))()}},{key:"getContainingTileCoords",value:function(e,t,n){return{row:Math.floor((e.origin.y-t.y)/(e.size[0]*n)),col:Math.floor((t.x-e.origin.x)/(e.size[1]*n))}}},{key:"extendTileLOD",value:function(){var e=this,t=new p.a({x:this.fullExtent.xmin,y:this.fullExtent.ymax,spatialReference:this.spatialReference}),n=new p.a({x:this.fullExtent.xmax,y:this.fullExtent.ymin,spatialReference:this.spatialReference});return this.tileInfo.lods.forEach(function(r){var o=e.getContainingTileCoords(e.tileInfo,t,r.resolution);r.startTileRow=0>o.row?0:o.row,r.startTileCol=0>o.col?0:o.col;var i=e.getContainingTileCoords(e.tileInfo,n,r.resolution);r.endTileRow=i.row,r.endTileCol=i.col,r.rows=256,r.cols=256}),this.tileInfo.lods}},{key:"saveTileToDB",value:function(e){var t=this;return new Promise(function(n,r){var o=e.split("?")[0],a=new XMLHttpRequest;a.open("GET",o,!0),a.overrideMimeType("text/plain; charset=x-user-defined"),a.onload=me(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(200!==a.status||""===a.responseText){e.next=6;break}return e.next=3,se.addTile(t.offlineKey,{url:g.a.compressToUTF16(o),img:m.compress(m.wordToBase64(m.stringToWord(a.responseText)))});case 3:n(),e.next=8;break;case 6:console.log("xhr failed for",o),r(a.status+" "+a.statusText+": "+a.response+" when downloading "+o);case 8:case"end":return e.stop()}},e)})),a.onerror=function(e){console.log("xhr failed for",o),r(e)},a.send(null)})}}])&&he(r.prototype,o),a&&he(r,a),n}()};n.d(t,"initOfflineFeatures",function(){return Ce}),n.d(t,"OfflineLayer",function(){return Be}),n.d(t,"TileHelpers",function(){return x}),n.d(t,"IndexedDBHelpers",function(){return r})}])});